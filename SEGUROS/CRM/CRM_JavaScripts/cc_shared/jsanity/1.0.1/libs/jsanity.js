if(typeof MarketingJSanity2!=="undefined")throw"MarketingJSanity2 has been defined, please check if there's any duplicate reference.";MarketingJSanity2={};(function(ns){"use strict";var defaults={inputString:"",maxWidth:"600px",maxHeight:"200px",overflow:"hidden",allowLinks:true,linkClickCallback:null,linkTargetCallback:null,customProtocols:{},allowRelativeURLs:false,allowAudioVideo:false,validPropertyRegularExpression:new RegExp("^[a-zA-Z0-9_().-/:?&$%=]*"),externalContentCallback:function(context,name,data,knownProtocols){var validatedProtocol;if(context==="attribute"&&(name==="src"||name==="href")){for(var protocol in knownProtocols){if(!knownProtocols.hasOwnProperty(protocol)){continue}if(data.substring(0,protocol.length)===protocol&&this.validPropertyRegularExpression.test(data)){validatedProtocol=true;break}}}if(!validatedProtocol){if(context==="CSSURL"){data='url("about:blank")'}else{data="about:blank"}}return data},isolatedTargetDOM:false,directModifySource:true,attributePrefix:"jSanity",dataAttributeCallback:null,tagCallback:null,debugLevel:0,onFinishedCallback:null};var schedulerClass=function(){this.sync=true;this.jobs=[];this.id=schedulerClass.globalId++;this.listnerPosfix=0;this.onCompletedListners={};this.onNewJobAddedListners={};this.useSync=function(){this.sync=true};this.useAsync=function(){this.sync=false};this.addNewJob=function(fn){this.jobs.push(fn);for(var key in this.onNewJobAddedListners){if(this.onNewJobAddedListners.hasOwnProperty(key)){try{this.onNewJobAddedListners[key](fn)}catch(e){}}}};this.registerOnJobCompleted=function(callback){var handler;this.listnerPosfix+=1;handler=this.id.toString()+this.listnerPosfix.toString();this.onCompletedListners[handler]=callback;return handler};this.registerOnNewJobAdded=function(callback){var handler;this.listnerPosfix+=1;handler=this.id.toString()+this.listnerPosfix.toString();this.onNewJobAddedListners[handler]=callback;return handler};this.unRegisterListner=function(handlerId){if(this.onCompletedListners[handlerId]){delete this.onCompletedListners[handlerId]}else if(this.onNewJobAddedListners[handlerId]){delete this.onNewJobAddedListners[handlerId]}};this.run=function(){var currJob=null;var conti=this.sync;var start,end;start=(new Date).getTime();do{currJob=this.jobs.pop();if(currJob){try{currJob()}catch(e){}}else{for(var key in this.onCompletedListners){if(this.onCompletedListners.hasOwnProperty(key)){try{this.onCompletedListners[key]()}catch(e){}}}}end=(new Date).getTime();if(currJob&&!this.sync){if(end-start<schedulerClass.maxExecutionTimeForMergedAsyncJobs){conti=true}else{conti=false}}}while(conti&&currJob);if(!this.sync&&currJob){var stepMethod=function(method,context){return function(){method.apply(context)}}(this.run,this);setTimeout(stepMethod,0)}}};schedulerClass.globalId=0;schedulerClass.maxExecutionTimeForMergedAsyncJobs=15;var jSanityClass=function(schedulerClass,options){var sch=new schedulerClass;if(options.onFinishedCallback){sch.useAsync()}else{sch.useSync()}var knownHTML={"default":{knownElements:{html:1,style:1,noscript:1,body:1,section:1,nav:1,article:1,aside:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hgroup:1,header:1,footer:1,address:1,main:1,p:1,hr:1,pre:1,blockquote:1,ol:1,ul:1,li:1,dl:1,dt:1,dd:1,figure:1,figcaption:1,div:1,a:1,em:1,strong:1,small:1,s:1,cite:1,q:1,dfn:1,abbr:1,code:1,"var":1,samp:1,kbd:1,sub:1,sup:1,i:1,b:1,u:1,mark:1,ruby:1,rt:1,rp:1,bdi:1,bdo:1,span:1,br:1,wbr:1,big:1,tt:1,ins:1,del:1,img:1,video:1,audio:1,source:1,map:1,area:1,svg:1,math:1,table:1,caption:1,colgroup:1,col:1,tbody:1,thead:1,tfoot:1,tr:1,td:1,th:1,input:1,button:1,select:1,datalist:1,optgroup:1,option:1,textarea:1,progress:1,meter:1,details:1,summary:1,command:1,menu:1,center:1,font:1,"class":1,label:1,link:1,form:1,legend:1,fieldset:1},knownAttributes:{"class":1,contenteditable:1,dir:1,hidden:1,id:1,lang:1,spellcheck:1,tabindex:1,title:1,cite:1,reversed:1,start:1,value:1,href:1,hreflang:1,target:1,rel:1,datetime:1,alt:1,height:1,ismap:1,src:1,width:1,usemap:1,autoplay:1,controls:1,loop:1,muted:1,preload:1,coords:1,shape:1,span:1,colspan:1,headers:1,rowspan:1,scope:1,checked:1,disabled:1,max:1,maxlength:1,min:1,name:1,placeholder:1,readonly:1,selectiondirection:1,size:1,step:1,selectedindex:1,label:1,selected:1,cols:1,rows:1,selectionend:1,selectionstart:1,wrap:1,low:1,high:1,optimum:1,open:1,align:1,face:1,hspace:1,vspace:1,border:1,cellpadding:1,cellspacing:1,"font-variant-caps":1,"font-variant-numeric":1,valign:1,halign:1,bgcolor:1,background:1,"for":1,type:1,required:1,"aria-role":1,"aria-label":1,list:1}},"http://www.w3.org/2000/svg":{knownElements:{circle:1},knownAttributes:{cx:1,cy:1,r:1,stroke:1,"stroke-width":1,fill:1}}};var knownProtocols={"http://":1,"https://":1,"mailto:":1};var knownCSSProperties={"background-attachment":1,"background-color":1,"background-image":1,"background-position":1,"background-position-y":1,"background-position-x":1,"background-repeat":1,"background-repeat-y":1,"background-repeat-x":1,"background-clip":1,"background-origin":1,"background-size":1,border:1,"border-bottom":1,"border-bottom-color":1,"border-bottom-style":1,"border-bottom-width":1,"border-color":1,"border-left":1,"border-left-color":1,"border-left-style":1,"border-left-width":1,"border-right":1,"border-right-color":1,"border-right-style":1,"border-right-width":1,"border-style":1,"border-top":1,"border-top-color":1,"border-top-style":1,"border-top-width":1,"border-width":1,outline:1,"outline-color":1,"outline-style":1,"outline-width":1,"border-bottom-left-radius":1,"border-bottom-right-radius":1,"border-radius":1,"border-top-left-radius":1,"border-top-right-radius":1,"box-decoration-break":1,"box-shadow":1,"box-sizing":1,"overflow-x":1,"overflow-y":1,"overflow-style":1,rotation:1,"rotation-point":1,opacity:1,height:1,"max-height":1,"max-width":1,"min-height":1,"min-width":1,width:1,"box-align":1,"box-direction":1,"box-flex":1,"box-flex-group":1,"box-lines":1,"box-ordinal-group":1,"box-orient":1,"box-pack":1,font:1,"font-family":1,"font-size":1,"font-style":1,"font-variant":1,"font-weight":1,"font-size-adjust":1,"font-stretch":1,"grid-columns":1,"grid-rows":1,"flex-direction":1,"order":1,"align-items":1,margin:1,"margin-bottom":1,"margin-left":1,"margin-right":1,"margin-top":1,"column-count":1,"column-fill":1,"column-gap":1,"column-rule":1,"column-rule-color":1,"column-rule-style":1,"column-rule-width":1,"column-span":1,"column-width":1,columns:1,padding:1,"padding-bottom":1,"padding-left":1,"padding-right":1,"padding-top":1,bottom:1,clear:1,clip:1,display:1,"float":1,left:1,overflow:1,position:1,right:1,top:1,visibility:1,"z-index":1,"border-collapse":1,"border-spacing":1,"caption-side":1,"empty-cells":1,"table-layout":1,color:1,direction:1,"letter-spacing":1,"line-height":1,"text-align":1,"text-decoration":1,"text-decoration-color":1,"text-decoration-line":1,"text-decoration-style":1,"text-decoration-thickness":1,"text-indent":1,"text-transform":1,"unicode-bidi":1,"vertical-align":1,"white-space":1,"word-spacing":1,"hanging-punctuation":1,"punctuation-trim":1,"text-align-last":1,"text-justify":1,"text-outline":1,"text-shadow":1,"text-wrap":1,"word-break":1,"word-wrap":1};var tw,itemOptions,targetElementID,destDoc,srcDoc;var setOnClickArray=[];var setOnSubmitArray=[];function nodeFilter(node){return NodeFilter.FILTER_ACCEPT}function consoleLog(level,message){if(window.console&&itemOptions.debugLevel>=level){console.log("jSanity: "+message)}}function createWalkerJob(contextNode,ns,destElt){return function walkerJob(){var savedCurrentNode=tw.currentNode;tw.currentNode=contextNode;treeWalk(ns,destElt);tw.currentNode=savedCurrentNode}}function scheduleNewWalkerJob(contextNode,ns,destElt){var job=createWalkerJob(contextNode,ns,destElt);sch.addNewJob(job)}function treeWalk(ns,destElt){var savedCurrentNode,cElt,tagN,oldNS,killElt,validatedProtocol,fullPrefix,output,outAttribute,attN;savedCurrentNode=tw.currentNode;var nodesToRemove=new Array;var setOnclick;var modifiedProperty;var childStyle;var setOnSubmit;var setRel;for(var child=tw.firstChild();child!==null;child=tw.nextSibling()){switch(child.nodeType){case child.ELEMENT_NODE:tagN=child.tagName.toLowerCase();if(tagN in knownHTML[ns].knownElements||itemOptions.tagCallback!==null&&itemOptions.tagCallback(tagN)){oldNS=ns;if(tagN==="svg"){ns="http://www.w3.org/2000/svg"}if(!itemOptions.directModifySource){if(ns=="default"){cElt=destDoc.createElement(tagN)}else{cElt=destDoc.createElementNS(ns,tagN)}}else{cElt=child}killElt=false;if(!itemOptions.allowAudioVideo&&(tagN==="video"||tagN==="audio"||tagN==="source")){killElt=true}if(tagN==="style"){}setOnSubmit=null;if(tagN==="form"){setOnSubmit="jSanityReturnFalseCallback"}if(!killElt){setOnclick=null;setRel=null;if(!(child.attributes instanceof NamedNodeMap)||typeof child.removeAttribute!=="function"||typeof child.setAttribute!=="function"){nodesToRemove.push(child)}for(var i=0;i<child.attributes.length;i++){attN=child.attributes[i].name.toLowerCase();if(attN in knownHTML[ns].knownAttributes){if(attN==="href"){validatedProtocol=false;if(itemOptions.allowLinks){for(var protocol in knownProtocols){if(!knownProtocols.hasOwnProperty(protocol)){continue}if(child.attributes[i].value.substring(0,protocol.length)===protocol){validatedProtocol=itemOptions.validPropertyRegularExpression.test(child.attributes[i].value);cElt.setAttribute("href",child.attributes[i].value);if(itemOptions.linkClickCallback!==null){setOnclick="/*jSanityClickCallback*/"}break}}}if(!validatedProtocol){setOnclick="/*jSanityReturnFalseCallback*/"}}else if(attN==="target"){outAttribute=null;if(itemOptions.linkTargetCallback!==null){outAttribute=itemOptions.linkTargetCallback(child.attributes[i].value)}if(outAttribute!==null){cElt.setAttribute(child.attributes[i].name,outAttribute);setRel="noopener"}else{if(itemOptions.directModifySource){child.removeAttribute(child.attributes[i].name);i--}consoleLog(1,"Encountered unsupported attribute: "+attN)}}else if(attN==="class"){if(itemOptions.directModifySource){}}else if(attN==="name"||attN==="id"){fullPrefix=itemOptions.attributePrefix+"_";if(typeof targetElementID!=="undefined"){fullPrefix+=targetElementID+"_"}if(child.attributes[i].value.length>0){if(child.attributes[i].value.length>fullPrefix.length&&child.attributes[i].value.substring(0,fullPrefix.length)===fullPrefix){cElt.setAttribute(child.attributes[i].name,child.attributes[i].value)}else{cElt.setAttribute(child.attributes[i].name,fullPrefix+child.attributes[i].value)}}}else if(attN==="src"){output=child.attributes[i].value;if(itemOptions.externalContentCallback!==null){output=itemOptions.externalContentCallback("attribute","src",output,knownProtocols)}if(output!==null){cElt.setAttribute("src",output)}else{killElt=true;break}}else{cElt.setAttribute(child.attributes[i].name,child.attributes[i].value)}}else if(itemOptions.dataAttributeCallback!==null&&attN.substring(0,5)==="data-"){outAttribute=itemOptions.dataAttributeCallback(child.attributes[i].name,child.attributes[i].value);if(outAttribute!==null){try{cElt.setAttribute(child.attributes[i].name,outAttribute)}catch(e){consoleLog(0,"Unable to set attribute: "+child.attributes[i].name+" to "+outAttribute)}}else{if(itemOptions.directModifySource){child.removeAttribute(child.attributes[i].name);i--}consoleLog(1,"Encountered unsupported attribute: "+attN)}}else{if(itemOptions.directModifySource){if(attN!=="style"){child.removeAttribute(child.attributes[i].name);i--}}consoleLog(1,"Encountered unsupported attribute: "+attN)}}if(setOnclick){if(setOnclick==="/*jSanityReturnFalseCallback*/"){cElt.setAttribute("href","#")}cElt.setAttribute("onclick",setOnclick);setOnClickArray.push(cElt)}if(setOnSubmit){cElt.setAttribute("onsubmit",setOnSubmit);setOnSubmitArray.push(cElt)}if(setRel){cElt.setAttribute("rel",setRel)}}if(!killElt&&child.style){for(var i=0;i<child.style.length;i++){childStyle=child.style[i];if(childStyle in knownCSSProperties){modifiedProperty=false;output=child.style.getPropertyValue(childStyle);if(output.substring(0,4)==="url("){if(itemOptions.externalContentCallback!==null){output=itemOptions.externalContentCallback("CSSURL",childStyle,output,knownProtocols);modifiedProperty=true}}if(childStyle==="position"&&output!=="static"&&output!=="relative"&&output!=="inherit"){output="inherit";modifiedProperty=true}try{if(itemOptions.directModifySource){if(modifiedProperty){cElt.style.setProperty(childStyle,output)}}else{cElt.style.setProperty(childStyle,output)}}catch(e){consoleLog(0,"Unable to set CSS property: "+childStyle)}}else{if(itemOptions.directModifySource){cElt.style.setProperty(childStyle,null)}consoleLog(1,"Encountered unsupported style property: "+childStyle)}}}if(!killElt){if(!itemOptions.directModifySource){destElt.appendChild(cElt)}}else if(itemOptions.directModifySource){nodesToRemove.push(child)}if(!killElt){scheduleNewWalkerJob(child,ns,cElt)}ns=oldNS}else{if(itemOptions.directModifySource){nodesToRemove.push(child)}consoleLog(1,"Encountered unsupported element: "+tagN)}break;case child.TEXT_NODE:if(!itemOptions.directModifySource){cElt=destDoc.createTextNode(child.nodeValue);destElt.appendChild(cElt)}break;case child.COMMENT_NODE:break;default:if(itemOptions.directModifySource){nodesToRemove.push(child)}consoleLog(1,"Unknown node type: "+child.nodeType)}}for(i=0;i<nodesToRemove.length;i++){try{nodesToRemove[i].removeNode(true)}catch(e){try{nodesToRemove[i].remove()}catch(e){nodesToRemove[i].parentNode.removeChild(nodesToRemove[i])}}}tw.currentNode=savedCurrentNode}function shadowCopy(output){if(!output){throw"invalid number of parameters. At least one is expected"}if(output.toString()!="[object Object]"){throw"Invalid type of parameter"}var i=0;var source=null;for(;i<arguments.length;i++){source=arguments[i];if(source.toString()!="[object Object]"){throw"Invalid type of parameter"}for(var key in source){if(source.hasOwnProperty(key)){output[key]=source[key]}}}return output}function safeBody(srcDoc){if(Object.getOwnPropertyDescriptor(Document.prototype,"body")){return Object.getOwnPropertyDescriptor(Document.prototype,"body").get.call(srcDoc)}else{return Object.getOwnPropertyDescriptor(document.__proto__,"body").get.call(srcDoc)}}this.sanitizeMethod=function sanitizeMethod(options){var spanBuffer,iSpan,output,i,elem,onclickSet;itemOptions=shadowCopy({},defaults,options);shadowCopy(knownProtocols,itemOptions.customProtocols);if(itemOptions.isolatedTargetDOM){itemOptions.directModifySource=false;destDoc=document.implementation.createHTMLDocument("destDoc")}else{itemOptions.directModifySource=true;spanBuffer=document.createElement("span");destDoc=document}srcDoc=document.implementation.createHTMLDocument("sourceDoc");iSpan=srcDoc.createElement("span");iSpan.innerHTML=itemOptions.inputString;safeBody(srcDoc).appendChild(iSpan);if(srcDoc.createTreeWalker!==Document.prototype.createTreeWalker){srcDoc=document.implementation.createHTMLDocument("sourceDoc");iSpan=srcDoc.createElement("span");srcDoc.body.appendChild(iSpan)}tw=srcDoc.createTreeWalker(safeBody(srcDoc),NodeFilter.SHOW_ALL,null,false);scheduleNewWalkerJob(tw.currentNode,"default",itemOptions.isolatedTargetDOM?destDoc.body:spanBuffer);var hdler=sch.registerOnJobCompleted(function(){if(itemOptions.isolatedTargetDOM){var newNode=document.importNode(destDoc.documentElement,true);output=newNode.lastChild.firstChild}else{if(itemOptions.directModifySource){output=iSpan}else{output=spanBuffer}}for(i=0;i<setOnClickArray.length;i++){elem=setOnClickArray[i];onclickSet=elem.getAttribute("onclick");if(onclickSet==="/*jSanityClickCallback*/"){elem.removeAttribute("onclick");elem.onclick=function(){return itemOptions.linkClickCallback()}}else if(onclickSet==="/*jSanityReturnFalseCallback*/"){elem.removeAttribute("onclick");elem.onclick=function(){return false}}}for(i=0;i<setOnSubmitArray.length;i++){elem=setOnSubmitArray[i];elem.removeAttribute("onsubmit");elem.onsubmit=function(){return false}}try{output.style.setProperty("display","inline-block");if(itemOptions.maxWidth){output.style.setProperty("max-width",itemOptions.maxWidth)}if(itemOptions.maxHeight){output.style.setProperty("max-height",itemOptions.maxHeight)}if(itemOptions.overflow){output.style.setProperty("overflow",itemOptions.overflow)}}catch(e){}setOnClickArray=[];sch.unRegisterListner(hdler);if(itemOptions.onFinishedCallback){itemOptions.onFinishedCallback(output)}});sch.run();return output}};var inSupportedEnvironment=function(){if(typeof document.documentMode!=="undefined"){if(document.documentMode<10){return false}}return true}();ns.isSupport=function(){return inSupportedEnvironment};ns.sanitize=function(options){var sanitizer;if(!inSupportedEnvironment){throw"jSanity does not support run in current browser version."}sanitizer=new jSanityClass(schedulerClass,options);return sanitizer.sanitizeMethod(options)}})(MarketingJSanity2);