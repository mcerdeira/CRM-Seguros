"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var TraceLevel = MktSvc.Controls.Common.TraceLevel;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var jSanityContentSanitizer = ControlsCommon.Utils.jSanityContentSanitizer2;
    var DefaultExecutionContext = /** @class */ (function () {
        function DefaultExecutionContext(localizationProvider, logger, cdnPath, customization, libsFolder, configurationProvider, isShimApplication, maximumNumberOfBlocksOnCanvas) {
            this.localizationProvider = localizationProvider;
            this.logger = logger;
            this.cdnPath = cdnPath;
            this.configurationProvider = configurationProvider;
            this.isShimApplication = isShimApplication;
            this.maximumNumberOfBlocksOnCanvas = maximumNumberOfBlocksOnCanvas || 0;
            if (Utility.isNullOrUndefined(libsFolder)) {
                this.libsFolder = String.Empty;
            }
            else {
                this.libsFolder = libsFolder;
            }
            this.customization = customization || new Editor.EditorCustomization();
            this.configurationProvider = configurationProvider;
            this.contentSanitizer = new jSanityContentSanitizer(this.getLibsPath(), Editor.ContentSanitizerContract.supportedAttributes, Editor.ContentSanitizerContract.supportedTags, Editor.ContentSanitizerContract.supportedAttributesWithUrl);
        }
        /**
         * @see IEditorExecutionContext.getLocalizationProvider
         */
        DefaultExecutionContext.prototype.getLocalizationProvider = function () {
            return this.localizationProvider;
        };
        /**
         * @see IEditorExecutionContext.getLogger
         */
        DefaultExecutionContext.prototype.getLogger = function () {
            return this.logger;
        };
        /**
         * @see IEditorExecutionContext.getDelaySchedulerTime
         */
        DefaultExecutionContext.prototype.getDelaySchedulerTime = function () {
            return 1000; // tslint:disable-line
        };
        /**
         * @see IEditorExecutionContext.getBasePath
         */
        DefaultExecutionContext.prototype.getBasePath = function () {
            return this.cdnPath;
        };
        /**
         * @see IEditorExecutionContext.getLibsPath
         */
        DefaultExecutionContext.prototype.getLibsPath = function () {
            return this.cdnPath + "/" + this.libsFolder;
        };
        /**
         * @see IEditorExecutionContext.getContentSanitizer
         */
        DefaultExecutionContext.prototype.getContentSanitizer = function () {
            return this.contentSanitizer;
        };
        /**
         * @see IEditorExecutionContext.getMaximumNumberOfBlocksOnCanvas
         */
        DefaultExecutionContext.prototype.getMaximumNumberOfBlocksOnCanvas = function () {
            return this.maximumNumberOfBlocksOnCanvas;
        };
        /**
         * @see IPreviewContext.isSandboxed
         */
        DefaultExecutionContext.prototype.isSandboxed = function () {
            return true;
        };
        /**
         * @see IPreviewContext.shouldPreviewBeSanitized
         */
        DefaultExecutionContext.prototype.shouldPreviewBeSanitized = function () {
            return true;
        };
        /**
         * @see IEditorExecutionContext.shouldFullPageEditorBeSanitized
         */
        DefaultExecutionContext.prototype.shouldFullPageEditorBeSanitized = function () {
            return false;
        };
        /**
         * @see IPreviewContext.shouldLinksBeEnabled
         */
        DefaultExecutionContext.prototype.shouldLinksBeEnabled = function () {
            return false;
        };
        /**
         * @see IEditorExecutionContext.getConfigurationProvider
         */
        DefaultExecutionContext.prototype.getConfigurationProvider = function () {
            return this.configurationProvider;
        };
        /**
         * @see IEditorExecutionContext.isShimApp
         */
        DefaultExecutionContext.prototype.isShimApp = function () {
            if (Utility.isNullOrUndefined(this.isShimApplication)) {
                return false;
            }
            return this.isShimApplication;
        };
        /**
         * @see IEditorExecutionContext.isFocused
         */
        DefaultExecutionContext.prototype.isFocused = function () {
            return false;
        };
        /**
         * @see IEditorExecutionContext.tryExecute
         */
        DefaultExecutionContext.prototype.tryExecute = function (action, event, throwError, onErrorAction, additionalData, logStackTrace) {
            if (logStackTrace === void 0) { logStackTrace = true; }
            try {
                action();
            }
            catch (e) {
                var eventName = "Editor.DefaultExecutionContext.tryExecute";
                var eventData = Utility.isNullOrUndefined(additionalData) ? new Dictionary() : additionalData;
                eventData.addOrUpdate("EventName", event);
                if (logStackTrace) {
                    eventData.addOrUpdate("Exception", e.stack);
                }
                else {
                    eventData.addOrUpdate("Exception", "[removed]");
                }
                this.getLogger().log(TraceLevel.Error, eventName, eventData);
                if (Editor.CommonUtils.isFunction(onErrorAction)) {
                    onErrorAction(e);
                }
                if (throwError) {
                    throw e;
                }
            }
        };
        /**
         * @see IEditorExecutionContext.getCustomizations
         */
        DefaultExecutionContext.prototype.getCustomizations = function () {
            return this.customization;
        };
        DefaultExecutionContext.prototype.getOrganizationConfigurationProvider = function () {
            return null;
        };
        /**
         * @see IEditorExecutionContext.dispose
         */
        DefaultExecutionContext.prototype.dispose = function () {
            this.contentSanitizer.dispose();
            this.contentSanitizer = null;
            this.localizationProvider = null;
            this.logger = null;
        };
        return DefaultExecutionContext;
    }());
    Editor.DefaultExecutionContext = DefaultExecutionContext;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CkEditorCommand = /** @class */ (function () {
        function CkEditorCommand() {
        }
        CkEditorCommand.prototype.setupCkEditor = function (ckEditorProxy) {
            this.ckEditorProxy = ckEditorProxy;
        };
        return CkEditorCommand;
    }());
    Editor.CkEditorCommand = CkEditorCommand;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /** Renders the popup container using the jquery */
    var PopupRenderer = /** @class */ (function () {
        function PopupRenderer() {
            this.okButton = "[OK]";
            this.cancelButton = "[Cancel]";
        }
        PopupRenderer.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        /** Renders the popup */
        PopupRenderer.prototype.render = function (title, onOkClick, onCancelClick, showButtons, cssClass, width, height, top) {
            var _this = this;
            var popup = $("<div></div>");
            popup.attr("title", title);
            this.popupId = UniqueId.generate();
            Editor.CommonUtils.setId(popup, this.popupId);
            var popupButtons = [];
            if (showButtons) {
                popupButtons = [
                    {
                        class: PopupRenderer.okButtonCssClassName,
                        text: Editor.CommonUtils.getLocalizedString(this.okButton),
                        title: Editor.CommonUtils.getLocalizedString(this.okButton),
                        click: function (event) {
                            // tslint:disable-line
                            var status = onOkClick();
                            if (status) {
                                _this.close();
                            }
                            event.stopPropagation();
                            event.preventDefault();
                        }
                    },
                    {
                        text: Editor.CommonUtils.getLocalizedString(this.cancelButton),
                        title: Editor.CommonUtils.getLocalizedString(this.cancelButton),
                        class: PopupRenderer.cancelButtonCssClassName,
                        click: function (event) {
                            if (!Utility.isNullOrUndefined(onCancelClick)) {
                                onCancelClick();
                            }
                            _this.close();
                            event.stopPropagation();
                            event.preventDefault();
                        }
                    }
                ];
            }
            var dialogCssClass = Utility.isNullOrUndefined(cssClass)
                ? Editor.CommonConstants.popupCssClassName
                : String.Format("{0} {1}", cssClass, Editor.CommonConstants.popupCssClassName);
            var dialogOptions = {
                autoOpen: true,
                modal: true,
                dialogClass: dialogCssClass,
                width: "auto",
                height: "auto",
                close: function (event) {
                    if (!Utility.isNullOrUndefined(onCancelClick)) {
                        onCancelClick();
                    }
                    _this.close();
                    event.stopPropagation();
                    event.preventDefault();
                },
                buttons: popupButtons
            };
            this.dialog = popup.dialog(dialogOptions);
            this.dialog.css({ "min-width": "350px" });
            this.dialog.css({ width: width || "auto" });
            this.dialog.css({ height: height || "auto" });
            if (!Utility.isNullOrUndefined(top)) {
                var updateTopInStyle = this.dialog.parent().attr("style")
                    .split(";")
                    .map(function (item) { return !!item.match(/top\s*\:/) ? "top: " + top : item; })
                    .join(";");
                this.dialog.parent().attr("style", updateTopInStyle);
            }
            if (!!height) {
                this.dialog.css({ "overflow-y": "scroll" });
            }
            $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.popupCssClassName) +
                "," +
                Editor.CommonUtils.getClassSelector(Editor.CommonConstants.overlayCssClassName)).click(function (event) {
                event.stopPropagation();
                event.preventDefault();
            });
            this.editorVisibilityChangedHandler = function (eventArgs) {
                if (!eventArgs.isVisible) {
                    _this.close();
                }
            };
            this.eventBroker.subscribe(Editor.EventConstants.editorVisibilityChanged, this.editorVisibilityChangedHandler);
            return this.popupId;
        };
        PopupRenderer.prototype.close = function () {
            if (!Utility.isNullOrUndefined(this.popupId) && Editor.CommonUtils.getById(this.popupId).length > 0) {
                this.dialog.dialog("destroy").remove();
            }
            this.dialog = null;
        };
        PopupRenderer.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.eventBroker)) {
                this.eventBroker.unsubscribe(Editor.EventConstants.editorVisibilityChanged, this.editorVisibilityChangedHandler);
                this.editorVisibilityChangedHandler = null;
            }
            this.close();
        };
        PopupRenderer.okButtonCssClassName = "editorPopupOkButton";
        PopupRenderer.cancelButtonCssClassName = "editorPopupCancelButton";
        return PopupRenderer;
    }());
    Editor.PopupRenderer = PopupRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
var Editor;
(function (Editor) {
    /** Defines the base class for control renderer. */
    var Control = /** @class */ (function () {
        /** Initializes a new instance of type
         * @param element - parent element
         */
        function Control(elementId) {
            this.id = elementId;
        }
        /**
         * Initializes the view - renders the view and/or attach proper event to render/refresh the view content
         */
        Control.prototype.init = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        /**
         * Activates the view - the view becomes visible
         */
        Control.prototype.activate = function () {
            this.isActive = true;
        };
        /**
         *Set focus into control
         */
        Control.prototype.setFocus = function () { };
        /**
         * Dectivates the view - the view becomes invisible
         */
        Control.prototype.deactivate = function () {
            this.isActive = false;
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        Control.prototype.dispose = function () { };
        /** Gets the parent element
         * @returns jquery element
         */
        Control.prototype.getElement = function () {
            return Editor.CommonUtils.getById(this.id);
        };
        return Control;
    }());
    Editor.Control = Control;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Common utility methods
     */
    var CommonUtils = /** @class */ (function () {
        function CommonUtils() {
        }
        /**
         * Gets name of class (RTL or LTR) according to language direction.
         */
        CommonUtils.getLangDirectionClass = function () {
            return this.localizationProvider.isRtl()
                ? Editor.CommonConstants.rightToLeftTextDirectionCssClass
                : Editor.CommonConstants.leftToRightTextDirectionCssClass;
        };
        /**
         * Get JQuery element(s) by id
         * @param id - element id
         * @param $rootElement The root - where to start from (e.g. in a test to verify explicitly)
         */
        CommonUtils.getById = function (id, $rootElement) {
            return CommonUtils.getBySelector("#" + id, $rootElement);
        };
        /**
         * Sets JQuery element(s)'s id
         * @param element - element
         * @param id - the id to set
         */
        CommonUtils.setId = function (element, id) {
            if (element) {
                element.attr("id", id);
            }
        };
        /**
         * Get JQuery element(s)'s id
         * @param element - element
         */
        CommonUtils.getId = function (element) {
            // Use native implementation to prevent "Object expected" errors in Edge when JQuery context is undefined
            return element && element.get(0) ? element.get(0).id : "";
        };
        /**
         * Get JQuery element(s) by class name
         * @param className The class to look for
         * @param $rootElement The root - where to start from (e.g. in a test to verify explicitly)
         */
        CommonUtils.getByClass = function (className, $rootElement) {
            return CommonUtils.getBySelector(CommonUtils.getClassSelector(className), $rootElement);
        };
        /**
         * Get CSS class selector from class name
         * @param className
         */
        CommonUtils.getClassSelector = function (className) {
            return String.Format(".{0}", className);
        };
        /**
         * Get CSS not class selector from class name
         * @param className
         */
        CommonUtils.getNotClassSelector = function (className) {
            return String.Format(":not(.{0})", className);
        };
        /**
         * Returns the attribute selector as a string
         * @param attrName
         */
        CommonUtils.getAttrSelector = function (attrName) {
            return String.Format("[{0}]", attrName);
        };
        /**
         * Returns the "attribute equals value" selector as a string
         * @param attrName
         * @param value
         */
        CommonUtils.getAttrEqualsSelector = function (attrName, value) {
            return String.Format("[{0}='{1}']", attrName, value);
        };
        /**
         * Sets element(s) content editable attribute to true
         * @param element - element to make content editable
         */
        CommonUtils.setEditable = function (element) {
            return element ? element.attr("contenteditable", "true") : $();
        };
        /**
         * Sets element(s) content editable attribute to false
         * @param element - element to make content *non*editable
         */
        CommonUtils.setNonEditable = function (element) {
            return element ? element.attr("contenteditable", "false") : $();
        };
        /**
         * Removes the element(s) esitable flags.
         * @param element - to remve the editable flags
         */
        CommonUtils.removeEditable = function (element) {
            return element ? element.removeAttr("contenteditable") : $();
        };
        /**
         * Removes the element(s) class attribute
         * @param element - element to remove the class attribute
         * @param className - name of class to remove
         */
        CommonUtils.removeClass = function (element, className) {
            if (!element) {
                return;
            }
            element.removeClass(className);
            element.each(function (_, el) {
                if (String.isNullOrWhitespace($(el).attr("class"))) {
                    $(el).removeAttr("class");
                }
            });
        };
        /* Returns the localized string for the string resource- id.
         * @param element - to remve the editable flags
         */
        CommonUtils.getLocalizedString = function (resource) {
            if (!CommonUtils.localizationProvider) {
                throw new Error("CommonUtils.getLocalizedString:ILocalizationProvider has not been initialized.");
            }
            return CommonUtils.localizationProvider.getLocalizedString(resource);
        };
        /**
         * Returns the localized string for the string key - id, in case of offline mode.
         */
        CommonUtils.getOfflineLocalizedString = function (key) {
            if (!CommonUtils.localizationProvider) {
                throw new Error("CommonUtils.getLocalizedString:ILocalizationProvider has not been initialized.");
            }
            return Editor.OfflineMessages.getLocalizedString(key, CommonUtils.localizationProvider.getLocaleId());
        };
        /**
         * Returns the editor id from the block.
         * @param block - block element.
         */
        CommonUtils.getEditorIdFromBlock = function (block) {
            return this.getEditorFromBlock(block).attr("id");
        };
        /**
         * Returns the editor element from the block.
         * @param block - block element.
         */
        CommonUtils.getEditorFromBlock = function (block) {
            return block ? block.find("[contenteditable]") : $();
        };
        /**
         * Create a style element with the specified CSS and id.
         * @param css The CSS.
         * @param id The id.
         */
        CommonUtils.createStyleElementFromCode = function (id, css, doc) {
            var curDocument = doc || document;
            var stylesElement = curDocument.createElement("style");
            var textNode = document.createTextNode(css);
            stylesElement.id = id;
            stylesElement.appendChild(textNode);
            return stylesElement;
        };
        /**
         * Create a style element with the specified CSS and id.
         * @param href The url.
         * @param id The id.
         */
        CommonUtils.createLinkElementFromUrl = function (id, href, doc) {
            var curDocument = doc || document;
            var link = curDocument.createElement("link");
            link.id = id;
            link.rel = "stylesheet";
            link.type = "text/css";
            link.href = href;
            return link;
        };
        /**
         * Create a style element with the specified url and id.
         * @param url The url.
         * @param id The id.
         */
        CommonUtils.createScriptElementFromUrl = function (id, url, doc) {
            var curDocument = doc || document;
            var scriptElement = curDocument.createElement("script");
            scriptElement.setAttribute("type", "text/javascript");
            scriptElement.setAttribute("src", url);
            scriptElement.setAttribute("id", id);
            return scriptElement;
        };
        /**
         * Search accross the dom, including iframes.
         * @param selector The selector.
         * @param $rootElement The root - where to start from.
         * @param resultCollection - The result collection.
         */
        CommonUtils.getBySelector = function (selector, $rootElement) {
            if (!$rootElement) {
                $rootElement = $(document); // tslint:disable-line
            }
            // Result collection
            var $resultCollection = $();
            var $queue = $($rootElement);
            var currentIndex = 0;
            while (currentIndex < $queue.length) {
                // Start with the current element and move the index in the queue
                var currentElement = $($queue[currentIndex]);
                currentIndex++;
                // Loop through all frames (.layoutFrameClassName to narrow down scope) and add it to the queue
                $queue = $queue.add(currentElement.find(CommonUtils.getClassSelector(Editor.CommonConstants.layoutFrameClassName)).contents());
                // Select all elements matching the selector under the root
                $resultCollection = $resultCollection.add(currentElement.find(selector));
            }
            return $resultCollection;
        };
        /**
         * Checks if the browser used is firefox.
         **/
        CommonUtils.isFirefox = function () {
            return navigator.userAgent.indexOf("Firefox") !== -1 && navigator.userAgent.indexOf("Trident/") === -1;
        };
        CommonUtils.isEdge = function () {
            return /edge/.test(navigator.userAgent.toLowerCase());
        };
        CommonUtils.isIOS = function () {
            return /(ipad|iphone|ipod)/.test(navigator.userAgent.toLowerCase()) && !window.MSStream;
        };
        CommonUtils.isAndroid = function () {
            return /android/.test(navigator.userAgent.toLowerCase()) && !window.MSStream;
        };
        /**
         * Returns the version of Internet Explorer or a -1
         * (indicating the use of another browser).
         */
        CommonUtils.getInternetExplorerVersion = function () {
            var rv = -1;
            var ua = navigator.userAgent;
            if (navigator.appName === "Microsoft Internet Explorer") {
                var re = new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");
                if (re.exec(ua) != null) {
                    rv = parseFloat(RegExp.$1);
                }
                return rv;
            }
            if (!!ua.match(/Trident\/7\./)) {
                rv = 11; // tslint:disable-line
            }
            return rv;
        };
        /**
         * Checks if the variable is function.
         **/
        CommonUtils.isFunction = function (variable) {
            return typeof variable === "function";
        };
        /**
         * Checks if jQuery object is defined.
         **/
        CommonUtils.isElementDefined = function (block) {
            return block && block.length > 0;
        };
        /**
         * Write the content in the iframe element.
         * @param iframe The iframe.
         * @param html The html content.
         */
        CommonUtils.writeFrameContent = function (iframe, html) {
            iframe.contentWindow.document.open();
            iframe.contentWindow.document.write(String.isNullOrWhitespace(html) ? "" : html);
            iframe.contentWindow.document.close();
        };
        /**
         * Returns a well formed html from the iframe content document.
         * @param iframe The iframe.
         */
        CommonUtils.getFrameContent = function (iframe) {
            return CommonUtils.getWithDoctype(CommonUtils.getDocType(iframe.contentDocument) + iframe.contentDocument.documentElement.outerHTML);
        };
        /**
         * Returns the doc type of the document.
         * @param document The document
         */
        CommonUtils.getDocType = function (document) {
            return !document || !document.doctype ? "" : new XMLSerializer().serializeToString(document.doctype);
        };
        /**
         * Returns the doc type from a html string.
         * @param html The html containing the doctype
         */
        CommonUtils.getDocTypeFromString = function (html) {
            var doctype = "";
            var doctypeIndex = html.toLowerCase().indexOf("<!doctype");
            if (doctypeIndex >= 0) {
                var iframeIndex = html.toLowerCase().indexOf("iframe");
                // If doctype is inside an iframe - we should ignore it as it's not this document's doctype
                if (iframeIndex === -1 || doctypeIndex < iframeIndex) {
                    var doctypeLength = html.indexOf(">", doctypeIndex) - doctypeIndex + 1;
                    doctype = html.substr(doctypeIndex, doctypeLength);
                }
            }
            return doctype;
        };
        /**
         * Returns the html of the document and ensures there is DOCTYPE tag to it.
         * @param document The document
         */
        CommonUtils.getWithDoctype = function (html) {
            if (String.isNullOrWhitespace(html)) {
                return html;
            }
            if (CommonUtils.isContentContainingDoctype(html)) {
                // Already has a doctype declaration
                return html;
            }
            return "<!DOCTYPE html>" + html;
        };
        /**
         * Returns the HTML document with a specific content.
         * @param html The document content
         * @param supportHandleBar The boolean flag to support handlebars in html.
         */
        CommonUtils.getNewContentDocument = function (html, supportHandleBar) {
            if (supportHandleBar === void 0) { supportHandleBar = false; }
            var contentDocument = document.implementation.createHTMLDocument("");
            CommonUtils.writeDocumentContent(contentDocument, html, supportHandleBar);
            return contentDocument;
        };
        /**
         * Returns the html of the document and ensures there is DOCTYPE tag to it.
         * @param document The document
         */
        CommonUtils.getDocumentContent = function (document, docType) {
            var content = document.documentElement.outerHTML;
            if (!String.isNullUndefinedOrWhitespace(docType) && !CommonUtils.isContentContainingDoctype(content)) {
                content = docType + content;
            }
            content = this.fixUrls(content);
            return this.fixTextWrapping(content);
        };
        CommonUtils.fixUrls = function (content) {
            //removing " and ' around urls as it will make this html unreadable for IE and Edge - when when they return url with " or ' they will not parse it back properly
            // IE is adding double quotes, Edge is adding single quotes
            var result = content;
            var start = -1;
            var end = -1;
            while ((start = result.indexOf("url(\"")) !== -1) {
                end = result.indexOf("\")", start);
                result = this.replace(result, start + 4, " ");
                result = this.replace(result, end, " ");
            }
            while ((start = result.indexOf("url('")) !== -1) {
                end = result.indexOf("')", start);
                result = this.replace(result, start + 4, " ");
                result = this.replace(result, end, " ");
            }
            return result;
        };
        /**
         * Fixing word wrapping for all major browsers, different browsers supports different css property for wrapping text
         * and also returning different css property when asked about their HTML content
         * I also cannot query this content as a HTML using JQuery or internal DOM engine, because than it will return the same wrong HTML based on a browser used
         * @param content
         */
        CommonUtils.fixTextWrapping = function (content) {
            var ieWrapPosition = content.indexOf("-ms-word-wrap: break-word;");
            var wordBreakPosition = content.indexOf("word-break: break-word;");
            var wordWrapPosition = content.indexOf("word-wrap: break-word;");
            var overflowWrapPosition = content.indexOf("overflow-wrap: break-word;");
            var correctAttributes = "word-wrap: break-word; word-break: break-word;";
            if (ieWrapPosition !== -1) {
                // ie is replacing word-wrap with -ms-word-wrap
                return this.replaceAll(content, "-ms-word-wrap: break-word;", correctAttributes);
            }
            else if (wordBreakPosition !== -1 && wordWrapPosition === -1) {
                // chrome is replacing word-wrap with word-break only
                return this.replaceAll(content, "word-break: break-word;", correctAttributes);
            }
            else if (overflowWrapPosition !== -1) {
                // this happens in Edge
                var removedOverflowWrap = this.replaceAll(content, "overflow-wrap: break-word;", correctAttributes);
                return this.equalizeNumberOfWordWrapAndWordBreakAttributes(removedOverflowWrap);
            }
            else if (wordBreakPosition !== -1 && wordWrapPosition !== -1) {
                // seems like we have everything we need and we are in chrome, but we need to make sure that we have the same amount of word-wrap as for word-break
                return this.equalizeNumberOfWordWrapAndWordBreakAttributes(content);
            }
            return content;
        };
        CommonUtils.equalizeNumberOfWordWrapAndWordBreakAttributes = function (content) {
            var numberOfWordBreakAttributes = content.split("word-break: break-word;").length;
            var numberofWordWrapAttributes = content.split("word-wrap: break-word;").length;
            if (numberOfWordBreakAttributes > numberofWordWrapAttributes) {
                var noWraps = this.replaceAll(content, "word-wrap: break-word;", "");
                return this.replaceAll(noWraps, "word-break: break-word;", "word-wrap: break-word; word-break: break-word;");
            }
            else if (numberOfWordBreakAttributes < numberofWordWrapAttributes) {
                var noBreaks = this.replaceAll(content, "word-break: break-word;", "");
                return this.replaceAll(noBreaks, "word-wrap: break-word;", "word-wrap: break-word; word-break: break-word;");
            }
            return content;
        };
        CommonUtils.replaceAll = function (str, find, replace) {
            return str.replace(new RegExp(find, "g"), replace);
        };
        CommonUtils.replace = function (source, index, replacement) {
            return source.substr(0, index) + replacement + source.substr(index + replacement.length);
        };
        /**
         * Returns the html of the document and ensures there is DOCTYPE tag to it.
         * @param document The document
         * @param html The content
         * @param supportHandleBar The boolean flag to support handlebars in html.
         *                         When the html contains handlebars, then assigning innerHTML can break the html structure.
         *                         See : https://dynamicscrm.visualstudio.com/OneCRM/_workitems/edit/1483276
         */
        CommonUtils.writeDocumentContent = function (document, html, supportHandleBar) {
            if (supportHandleBar === void 0) { supportHandleBar = false; }
            if (html || html === "") {
                document.documentElement.innerHTML = html;
                if (supportHandleBar) {
                    var regexResultSize = 3;
                    var headRegex = /<head[^>]*>((.|[\n\r])*)<\/head>/im;
                    var head = headRegex.exec(html);
                    var bodyRegex = /<body[^>]*>((.|[\n\r])*)<\/body>/im;
                    var body = bodyRegex.exec(html);
                    var headCondition = head && head.length >= regexResultSize;
                    var bodyCondition = body && body.length >= regexResultSize;
                    if (headCondition) {
                        document.head.innerHTML = head[1];
                    }
                    if (bodyCondition) {
                        document.body.innerHTML = body[1];
                    }
                }
            }
        };
        CommonUtils.getOutlookVmlElement = function (block) {
            var comments = $(Editor.CommonUtils.getComments(block.get(0)));
            // Gets all comments with outlook data
            var vmlElement = comments.filter(function (index, element) {
                return element.data.indexOf(CommonUtils.msoOpeningTag) >= 0;
            });
            return vmlElement;
        };
        /**
         * Sets tab index for the element
         * @param element - element
         * @param tabIndex - the tab index to set
         */
        CommonUtils.setTabIndex = function (element, tabIndex) {
            element.attr("tabindex", tabIndex);
        };
        /**
         * Get normalized value of boolean attribute
         * @param element - the element
         * @param attributeName - the boolean attribute name
         * @param defaultValue - the default value (true by default)
         */
        CommonUtils.getNormalizedBooleanAttributeValue = function (element, attributeName, defaultValue) {
            var defaultValueString = defaultValue === undefined
                ? Editor.CommonConstants.normalizedBooleanTrue
                : defaultValue
                    ? Editor.CommonConstants.normalizedBooleanTrue
                    : Editor.CommonConstants.normalizedBooleanFalse;
            var dataValue = element.attr(attributeName)
                ? element
                    .attr(attributeName)
                    .trim()
                    .toLowerCase()
                : defaultValueString;
            return dataValue !== Editor.CommonConstants.normalizedBooleanTrue &&
                dataValue !== Editor.CommonConstants.normalizedBooleanFalse
                ? defaultValueString
                : dataValue;
        };
        /**
         * Get normalized value of track attribute
         * @param element - the element
         */
        CommonUtils.getNormalizedTrackAttributeValue = function (element) {
            var attributeValue = CommonUtils.getNormalizedBooleanAttributeValue(element, Editor.CommonConstants.dataTrackAttributeName);
            return CommonUtils.convertNormalizedBooleanToTrackAttributeValue(attributeValue);
        };
        /**
         * Converts normalized boolean attribute value to normalized track attribute value.
         * @param element - the normalized boolean attribute value
         */
        CommonUtils.convertNormalizedBooleanToTrackAttributeValue = function (booleanAttributeValue) {
            return booleanAttributeValue === Editor.CommonConstants.normalizedBooleanTrue ? null : booleanAttributeValue;
        };
        /**
         * Gets link with default protocol if current link does not contain protocols
         * @param link The input link
         */
        CommonUtils.getLinkWithProtocol = function (link) {
            if (String.isNullUndefinedOrWhitespace(link)) {
                return link;
            }
            var trimmedLink = link.trim();
            if (!Editor.CommonConstants.protocolRegex.exec(trimmedLink.toLowerCase())) {
                return Editor.CommonConstants.defaultProtocol + trimmedLink;
            }
            return trimmedLink;
        };
        CommonUtils.setRole = function (element, role) {
            if (element) {
                element.attr("role", role);
            }
        };
        CommonUtils.setAriaAttribute = function (element, ariaAttrName, ariaAttrValue) {
            if (element) {
                element.attr(ariaAttrName, ariaAttrValue);
            }
        };
        CommonUtils.isVisible = function (elemment) {
            return elemment ? elemment.is(":visible") : false;
        };
        CommonUtils.isContentContainingDoctype = function (content) {
            return content.toLowerCase().indexOf("<!doctype") !== -1;
        };
        CommonUtils.overlayBlockElement = function (block, activeElement, overlayImageSource, blockType, setMaxWidth, copyAttrsFromBlockToOverlay) {
            if (setMaxWidth === void 0) { setMaxWidth = false; }
            CommonUtils.removeBlockOverlay(block);
            block.append(this.createOverlay(overlayImageSource, blockType, setMaxWidth).attr("contenteditable", "false"));
            if (copyAttrsFromBlockToOverlay) {
                copyAttrsFromBlockToOverlay(block);
            }
            activeElement.addClass(Editor.CommonConstants.designerOverlayHiddenElementCssClassName);
        };
        CommonUtils.overlayImageElement = function (image, overlayImageSource) {
            image
                .attr("src", overlayImageSource)
                .css("max-width", "125px")
                .addClass(Editor.CommonConstants.designerUnconfiguredContentOverlayCssClassName);
        };
        CommonUtils.createOverlay = function (overlayImageSource, blockType, setMaxWidth) {
            if (setMaxWidth === void 0) { setMaxWidth = false; }
            var overlayIcon = this.getOverlayIcon(blockType);
            var overlay = $("<div></div>").addClass(Editor.CommonConstants.designerUnconfiguredContentOverlayCssClassName);
            overlay.attr("align", "center");
            overlay.append(overlayIcon);
            return overlay;
        };
        CommonUtils.removeBlockOverlay = function (block) {
            if (CommonUtils.getByClass(Editor.CommonConstants.designerUnconfiguredContentOverlayCssClassName, block).length > 0) {
                CommonUtils.getByClass(Editor.CommonConstants.designerUnconfiguredContentOverlayCssClassName, block).remove();
                CommonUtils.removeClass(CommonUtils.getByClass(Editor.CommonConstants.designerOverlayHiddenElementCssClassName, block), Editor.CommonConstants.designerOverlayHiddenElementCssClassName);
            }
        };
        CommonUtils.removeImageOverlay = function (image) {
            image.attr("src", image.attr(Editor.CommonConstants.designerImageSourceAttributeName));
            image.css("max-width", "");
            image.removeClass(Editor.CommonConstants.designerUnconfiguredContentOverlayCssClassName);
        };
        CommonUtils.walkTree = function (node, visit) {
            var _this = this;
            var children = node.children();
            children.each(function (i, c) {
                _this.walkTree($(c), visit);
            });
            visit(node);
        };
        CommonUtils.getComments = function (element) {
            var currentNode;
            var comments = [];
            // prettier-ignore
            var iterator = this.isInternetExplorer() ?
                // prettier-ignore
                // @ts-ignore
                // IE 11 throws "TypeError: Argument not optional" when not initialized with 4 input parameters
                document.createNodeIterator(element, NodeFilter.SHOW_COMMENT, null, false) :
                // prettier-ignore
                document.createNodeIterator(element, NodeFilter.SHOW_COMMENT);
            while ((currentNode = iterator.nextNode())) {
                comments.push(currentNode);
            }
            return comments;
        };
        CommonUtils.isInternetExplorer = function () {
            return this.getInternetExplorerVersion() > -1;
        };
        CommonUtils.isHighContrastModeEnabled = function () {
            // Create a test div and set background color
            var initialColor = "rgb(255, 0, 0)";
            var indicatorElement = $("<div>")
                .css("background-color", initialColor)
                .height(0)
                .width(0);
            // Append element into body and inspect color
            $(document)
                .find("body")
                .append(indicatorElement);
            var actualColor = indicatorElement.css("background-color");
            indicatorElement.remove();
            // Browser is in high contrast mode if inline background color was changed for indicator element
            if (actualColor !== initialColor) {
                return true;
            }
            return false;
        };
        /**
         * Returns domain with port and protocol from URL
         * @param url source URL
         */
        CommonUtils.getDomainFromUrl = function (url) {
            var anchor = document.createElement("a");
            anchor.href = url;
            // This line needed for IE which returns protocol and port in all cases
            var port = !anchor.port ||
                (anchor.port === "443" && anchor.protocol === "https:") ||
                (anchor.port === "80" && anchor.protocol === "http:")
                ? ""
                : ":" + anchor.port;
            return anchor.protocol && anchor.hostname ? anchor.protocol + "//" + anchor.hostname + port : "";
        };
        /**
         * Adds elements to content head.
         */
        CommonUtils.appendElementToHead = function (content, element) {
            content.find("head").append(element);
        };
        CommonUtils.getColumnPlaceholder = function () {
            return "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjMiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyMyAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTkgMTkuNUgxMC41VjIxSDlWMTkuNVpNMTIgMTkuNUgxMy41VjIxSDEyVjE5LjVaTTYgMTkuNUg3LjVWMjFINlYxOS41Wk0xOS41IDlIMThWNy41SDE5LjVWOVpNMjIuNSA0LjVWMjRIM1YxNi41SDBWMEg4LjU2NjQxTDEzLjA2NjQgNC41SDIyLjVaTTkgNC41SDEwLjkzMzZMOSAyLjU2NjQxVjQuNVpNMTIgMTVWNkg3LjVWMS41SDEuNVYxNUgxMlpNMjEgNkgxMy41VjE2LjVINy41VjE4SDZWMTYuNUg0LjVWMjIuNUgyMVY2Wk0xNi41IDIxSDE1VjE5LjVIMTYuNVYyMVpNMTkuNSAyMUgxOFYxOS41SDE5LjVWMjFaTTE5LjUgMTJIMThWMTAuNUgxOS41VjEyWk0xNi41IDlIMTVWNy41SDE2LjVWOVpNMTkuNSAxNUgxOFYxMy41SDE5LjVWMTVaTTE5LjUgMThIMThWMTYuNUgxOS41VjE4WiIgZmlsbD0iIzIyNjZFMyIvPgo8L3N2Zz4=";
        };
        CommonUtils.getLocalizedImagePlaceholder = function () {
            return "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTI0IDBWMThIMFYwSDI0Wk0xLjUgMS41VjkuNDMzNTlMNi43NSA0LjE5NTMxTDE0LjI1IDExLjY5NTNMMTcuMjUgOC42OTUzMUwyMi41IDEzLjkzMzZWMS41SDEuNVpNMS41IDE2LjVIMTYuOTMzNkw2Ljc1IDYuMzA0NjlMMS41IDExLjU2NjRWMTYuNVpNMjIuNSAxNi41VjE2LjA2NjRMMTcuMjUgMTAuODA0N0wxNS4zMDQ3IDEyLjc1TDE5LjA2NjQgMTYuNUgyMi41Wk0xOC43NSA2QzE4LjU0NjkgNiAxOC4zNzExIDUuOTI1NzggMTguMjIyNyA1Ljc3NzM0QzE4LjA3NDIgNS42Mjg5MSAxOCA1LjQ1MzEyIDE4IDUuMjVDMTggNS4wNDY4OCAxOC4wNzQyIDQuODcxMDkgMTguMjIyNyA0LjcyMjY2QzE4LjM3MTEgNC41NzQyMiAxOC41NDY5IDQuNSAxOC43NSA0LjVDMTguOTUzMSA0LjUgMTkuMTI4OSA0LjU3NDIyIDE5LjI3NzMgNC43MjI2NkMxOS40MjU4IDQuODcxMDkgMTkuNSA1LjA0Njg4IDE5LjUgNS4yNUMxOS41IDUuNDUzMTIgMTkuNDI1OCA1LjYyODkxIDE5LjI3NzMgNS43NzczNEMxOS4xMjg5IDUuOTI1NzggMTguOTUzMSA2IDE4Ljc1IDZaIiBmaWxsPSIjMjI2NkUzIi8+Cjwvc3ZnPg==";
        };
        CommonUtils.getLocalizedDynamicImagePlaceholder = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAykAAAJZCAMAAACa4YotAAAABGdBTUEAALGPC/xhBQAAAwBQTFRFs7OztLS0tbW1tra2t7e3uLi4ubm5urq6u7u7vLy8vb29vr6+v7+/wMDAwcHBwsLCw8PDxMTExcXFxsbGx8fHyMjIycnJysrKy8vLzMzMzc3Nzs7Oz8/P0NDQ0dHR0tLS09PT1NTU1dXV1tbW19fX2NjY2dnZ2tra29vb3Nzc3d3d3t7e39/f4ODg4eHh4uLi4+Pj5OTk5eXl5ubm5+fn6Ojo6enp6urq6+vr7Ozs7e3t7u7u7+/v8PDw8fHx8vLy8/Pz9PT09fX19vb29/f3+Pj4+fn5+vr6+/v7/Pz8/f39/v7+////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAQ71AAAAAlwSFlzAAAScwAAEnMBjCK5BwAAABl0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4xMzQDW3oAACEXSURBVHhe7d3pYhS3EoZhNgecnDiELUAwhM1sCVsgCQQIwRA23//1HHtcsj2yRl3dLfVIpff5c3Iaezwe65tujUrVR7YAdCMpgAZJATRICqBBUgANkgJokBRAg6QAGiQF0CApgAZJATRICqBBUgANkgJokBRAg6QAGiQF0CApgAZJATRICqBBUgANkgJokBRAg6QAGiQF0CApgAZJATS6krIBNEMGfVBXUo4AzZBBH0RSAEcGfRBJARwZ9EEkBXBk0AeRFMCRQR9EUgBHBn0QSQEcGfRBJAVwZNAHkRTAkUEfRFIARwZ9EEkBHBn0QSQFcGTQB5EUwJFBH0RSAEcGfRBJARwZ9EEkBXBk0AeRFMCRQR9EUgBHBn0QSQEcGfRBJAVwZNAHkRTAkUEfRFIARwZ9EEkBHBn0QSQFcGTQB5EUwJFBH0RSAEcGfRBJARwZ9EEkBXBk0AeRFMCRQR9EUgBHBn0QSQEcGfRBJAVwZNAHkRTAkUEfRFIARwZ9EEkBHBn0QSQFcGTQB5EUwJFBH0RSAEcGfRBJARwZ9EEkBXBk0AeRFMCRQR+ULClrL4AirckQ7SaDPihZUs7KNwCFOStDtJt8QxBJgXUkBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABotJuXNy42N9bMzGxsbL9/IYfTwQP63HY0l5c3j64HfeHX98aZ8AVSeHXks/9WMlpLy5vqq/JiA1fXn8mXotLlyZFX+sxnNJCUak12r17kQ01nbfrU25L9b0UhSHit/z7PNXVQMcX3npVr5JP+vEU0k5XHn6WTfKlnp8nj3lWrspNJAUp71yMmO1WfyjQh6syIvVFufgphPyqb+N9xzlk/CFvu0M0mZuSJH2mA9KRvywD21Nl3tYV1eom1NfQBiOymbe+9/fa1xWgmTScpMnllloUwn5Zm7oh5ghdlKyN4kZeaFHG2B5aQcuE4Y4ro8DPbtT1JmWlp+tJuUTxflMQe72NiKgYL/mjb0kbrZpHjvfoOsEZV5D+SF2bPazitkNSkpgkJUPG/kZTmgnQ8JjSYlTVCIypxPgSXcdmpabCYlVVCIykHBiV8zn3vYTIr+t+qUbuZUu0OTlF2tLDyZTMrIj4fnrcuDtu6FvB6+i/Lv1llMyoI3v6EoLt7xaeEqbiPLjwaTMr+MPN4K+7u2LR4ojVyf2ktKutm8w6w+XmnaRt2PvaTMNuSlRV3LoknKTBs1LeaSEv2bDtVSJWDI4knKTBMzOXNJSX7ttWNNHrxVHS9qE8uP1pKS+HMvp71GcAd1XtC2UNNiLCkdlwmDtdaIZM4zeREWa+HlMZaUgZuBuzW8XXhT8e7TwJZ6W0nJdUpp+qSimvnZr2mxlZRsp5SGZyq60qDRE8zi2UpKz85efTTXh1cc7DARY/6DdFNJ0f5VB2mz/EtdGmT+pGIqKfpfZgD71xcBPUqDrL+TWErKpjxIJi12AOuxf8H65amlpGRadXQanNP3upw1/vpYSsrotkVxrWxZ2tdv/4LxD9ItJSXbYsquFfkxzQh1mIixvTprKCmBHjtptbajq+85esX0TM5QUjJPU5qbqPR/PU3XtBhKSuZpSmsTlSGnaMtnXUNJyTxNaWyi0neSMjNqmlk4O0nJPk1pa6Iy7AxtuKbFTlKylrLsaqigZWCtqeHNoXaSkrGO2Glnk8rgbgR230xISg/NJGX4Ph+7NS12knJFHiIjulV3M/tuYicpI/66WiOeXVXGnJ7N1rSQlB4aScq4lmlWT7x2kpKl0de8Ntp+aTpMxBitabGTFHmErORH2Tb2LcdoTQtJ6UN+lGnj+zrbXH4kKX3Ij7Ksuw1eJ5vTOTtJOSEPkdEJ+VGGjZ2kzJg8qdhJiv43Gczmm+WcJJ+LmFx+JCk92E9KojtkWqxpISk9mE9KqirTVYPLj3aSQt3XaOnukGnwlbKTlOybg81vD054h0yDNS12kpLltnXzjPfeTXkbf3vLj3aSkrmD5A7bXSTTboUz91rZSUr+BRXbyymJd1eba89hKCn0ZhljUIeJGGuXqoaSkn1Kb3obffL3mTF/yhIZSkr25iyWpykZ3maeyUMbYSgpuScqlm97kONdxtjrZSkp4+vFowzvok8+SZmxdbVqKSmZL78M98XTj4I+bC0/WkpKzhuimr74ylUIZKqmxVRSspZ+2S1lyVbdYOo2EaaSknWZ3uwnX8Pb4HWyVNNiKik5u+PZvTdInknKLkNvL7aSkvGkYvaUkvWSdeTfsyS2kpLv/dFsJUuCDhMxdmpajCUl2+TUasF9kg4TEXZOKsaSkqtM0uwpJXvnTTPLj9aSspmlpOWE1VlK5rKGbWaWoawlJc8E1eoG+syTlBkrr525pORYqLe6PJ97kjJjpabFXlIyVH8ZrfhK2GEixshJxV5S0m+1sFrHkrLDRIyNSZ7BpKT+/Mvq514T3Gx5l43yBotJ+ZT08y+L/RB3pGuD18nE1avFpGy9SRiVE0xSRkvzV10yk0lJOKu3GpTJJikzFiocbCYl3TW41X4sk01SZizcINNoUlKNBKtByd7HxmPgdbSalDRRsRqUPB0mIgx8LGI2KQmm9WbnKPnbbR5S//Kj3aSMjordoExwAw1f/TUthpOy9Un/ywWcNbqOMv0kZab6bmmWkzKqsNhq+fASJim7aq9psZ2UrRcDR8Wq4ZsKjTrTDld7TYvxpGx9GnRa2TB75ZW5w0RM5W8+1pOytbXZ+z30rNk+LNsmuMnfAhn+tlOyn5StrWe9snLW2N0M5mVsg9ep7pNKC0nZfiNV/5pnDU9QdvQ+wSZU99bRNpKynZUritWVE1eM52SCDhMxVZc8tJKUbc86wnLR9GXXzBQdJiKqXn5sKCnbnl1f8PuuXX9m+OMuZ5IOEzE1L1K1lZQdbx5fP3tgF9Pq2Y0HLxpIyY4JN2+F1XxSaS8pzuaLVgLiLHeSMlPx8mO7SWnOkicpu+pdqiIprZiww0REvY1uSEojpuwwEVPt5/AkpRGTdpiIqPYvTFLaMG2HiZhalx9JShPKmKTM1FrTQlJaUMokZabSNs8kpQWlTFJmKl1+JCkNWEKHiZg6a1pIin1L6TARsVLl8iNJMW9JHSYiqqxpISnmTd8Gr1ONJxWSYl1hk5SZGv/MJMW40iYpuyqsaSEpti2zw0REhbeJICm26f++06qvpoWkmLa0Nnhd6qtpISmWLa8NXqfqlh9JimGFTlJmqqtpISmGlVQXeUhtJxWSYlcBHSZiKlt+JClmFdFhIqKymhaSYtXS2+B1quvugCTFqqInKTN1/bFJilGFT1JmqqppISk2ldNhIqKq5UeSYlJBHSZiaqppISkWFdVhImK1ouVHkmJRUR0mYipafiQpBlUxSZmpqKaFpNhTySRl5ro85/KRFHNqmaTsqqamhaSYU2CHiYhqbhNBUqwpscNETC3LjyTFmDI7TETU8icnKbaU1wavUyU3NycpttQ1SZmppKaFpJhS2yRlpo6aFpJiScEdJiLqWH4kKYaU3GEipoqaFpJiiP6PWZYqTiokxY5i2+B1qmFLPUkxo85Jyq4KalpIihW1TlJmKvi7kxQrqqqLPKT8mhaSYkQNHSYiyv/DkxQbSm+D16n45UeSYkL5bfC6FF/TQlJMqHuSMvNAfpVSkRQLqukwEVH68iNJMaCeDhMxhde0kJT61dRhIqbs5UeSUr26OkxElF3TQlKqZ2GSsqvo20SQlNrZmKTMFP3XJymVszJJmSm5poWk1K3CDhMRa/JblYikZPFmqsWBCjtMxBRc00JScthcWZtmdlplh4mIgmtaSEoOa0eOrEzx9lhdG7xO5S4/kpQMdivg17NfgdmapMyUW9NCUtJzFfDZr8CMTVJmir1NBElJbr8CPvMVWL0dJmJKrWkhKckdfElzXoHV3GEiotSaFpKS2vw7fb4rsKo7TMQUuvxIUhLz3+mzXYHp/3KVKXQMkJS0Au/0ea7AbE5SZso8qZCUtEKvZ44rMKOTlJkylx9JSlLhd/r0V2D1d5iIKbKmhaSktHDNPPUVmJXNW2GrJS4/kpSEImvmaa/AKm+D16nEmhaSklBszTzlFVj1bfC6lFjTQlLS6SjsXV+XrxvL9iRlpsDlR5KSTHdhb6IrsBImKd/efvjn69evXjy/f/mEHEqqvJoWkpKKorA3zRVYCR0mrnyVJ7Pty205mNJFefBykJRUVAM4wWdgJXSYuCzPRZyWwykVt/xIUhJRDuDRn4EV0WHilTwZkeMsV9xIIClpqAfwyCuwItrg/ShPxjknx5N6Jg9eCpKSRJ8BPOoKrIg2eL/KkxEf5HBapdW0kJQkeg3gEVdgZbTB+0+ejcjU9qKw20SQlBR6LgUOvgIro8OE/7nUj3I8scKWH0lKAv2XAoddgRXSYeKpPB2RLb5l1bSQlAQGzLIHXYGV0WFiRZ6Nc0uOJ7dS1PIjSRlvUL3igCuwQtrgXZOn43wrx9MrqqaFpIw2tF6x7xVYKW3wvDXBv+RwDiWdVEjKWMPrFftdgZXSBu9/8nycq3I8h5KGA0kZS/8KHtLrCmzEz0nKm2d/zVIg6RRU00JSRhrX+UF/BVZMh4m38oTEEzmcR0HjgaSMM7bzg/YKrJgOE2fkCTk/yfFMklRfJ0FSRhnfnk53BVZOG7zf5BmJ93I4l3JqWkjKKCkmD5orsBQ/Jw2vkuW+HM6mmOVHkjJGmslD9xVYOW3wLskzcnJsTZlTTE0LSRkh1QpH1xVYQR0mfpenJF7L4YxKOamQlOESrnBEr8AK6jDxjTwlJ1slywGFLD+SlOFSlmHFrsAKaoP3izwlZ4rV0EJqWkjKYGnLsBZfgZXUBu+lPCfxpxzOa0gxaXokZajkZVgLrsBKaoP3vTwnZ5odmGUMCpIyUIYyrOAVWFFt8O7IkxJfjsvxzIqoaSEpA+XYKxK4Aiuiw8Sef+VZian2Kq/Jz1sqkjJMpkFy6AqsiA4Tjv/XuSDHsyuhpoWkDJKt65Z3BVZGhwnHq2TZlMP5lXCbCJIyRMZrorkrsCLa4O37KE9LZK9k2VfA8iNJGSLrNdH+FVhZkxS/x+rWD3J8AgXUtJCUATJfE+1dgRU1STnU1XGCSpZ91+WHLg9J6S/7B7dyBVbWJOXIydmT2ndTjk9j6TUtJKW/Ca6Jdq7ASukw4fhv69Pu6196TQtJ6W2S6pK1N6V0mNjzt/z+4g85PJVlLz+SlL4mqi5ZKWs2f3j574ocn8qyhwZJ6amo6pIpeZUsn4/J8cks+TYRJKWn0t7qJ+NVsjySw9NZ8pZ6ktJPOft0J3ZOXgDnvByf0HJrWkhKL8U0E5rcQ3kFxHSVLPuWu/xIUvoop5nQMCfvvf86rAj6qDdK78nxQ16/u5OtpfdSa1pISh/6V6tE39zbuTf2sE93f959AfYsmq5d3fnHXzNlZaknFZLSQ9WTlG/ufpn9El/k//fzfPa9e17J4UPkFpAP8iwGLXP5kaTo1TxJWbmzm5NtQz7ePSXf69yQ44fszbofnJIjSS2xpoWkqBW3aK63cuez/BLbvpGDffiVLAtjcGDR436GrPi3mJwQSVEr495xA5zYOJCTYfVaXiXLczl82B/yFTMZsrK8mhaSolXIveN6O77hzYO/k3/owa9k+VmOH/aXfIW4d1KOp7K8AUJSlEqr7FU6fvvQ50UDknJXvlV8PirHD/OSsvX13pCLvYilLT+SFJ06JynHbnkbencMSMo7+VYRqWTxk7K19eVu0qwsraaFpOjUOEk5dsu7hcOu/qun5+U7nXNyPGBuniK+3E25YPtAHnVqJEWlsO2HGkdvBnMyZD3lkXyreCeHQ7xe+OLznXRZWdbyI0nRKKxHisbND/LcfbFxHnZs7qOzra27cjxk0Tt+wqwsqaaFpCgU1iNF4cainAw5Pfor47FXY1bNEvR5I9FdhleWs/xIUhQK65HS6fp7eeIh+r+44809/pbDQbEJ96eNNH2Ml1PTQlK6VTZJuR59z/1VvkrPr2SJ9xGIthv6eDtJVpZyUiEpneraDxzPyfMf5ct6uCHf63QsJp77U74u6OOtBLuKlzJKSEqnmiYpv3grH/OenZEv6+WVfLdYXMninPMKj+f9lyAry6hpISldSrolVodr0Zz8PignR36Qb3cuy/GYM+EPi8V/txav8ess4zYRJKVDSbfEirvm9YSY93TAddfMPXkA8UkOdzgdrTr5cHNkVpZQ00JS4qqZpFx9K8846Onw+8Z7856HcrjT997O+3kfxvVqXUJNC0mJq2SSEs/JkxFd6S/IYzj6AXPkO9kAGfZ+4W4wjemXH0lKVB37gdf/kacb9HhU2r3rnH/lsM4p79Jt3vsRU8Dpa1pISkwV+4GvRHPy6H/yZcMc29tUvOuOHNda8VpPztscnpXJTyokJaKGpkVXondrfzi2S4q/Hv69HNc7fmunI8wiw7My9fIjSYnocU2+JD+/lqca9Nv43bleJctLOdzL0RteieWcd7/Il/U0dU0LSVms+ElKR04S7KDyP2MaOKqPXAvvANj17pp8VT8TLz+SlIVKn6Rc9hbP5/2apHL3pjyaMzx867GrpX+HZGXisUJSFil8knIpmpMHie7Z4J20Ri3DXo6tjP57Vb6qh2lPKiRlkaL3A1/y2grNS3b769PygM4lOT7QxdindG97Z2Xa5UeSskDJTYsuxnLydWFz7f7uy2OKj3J4uPOxM2HvrExa00JSwgpuWnTxpTzHkC+xrbu9eTvCfpPDY5yNPft/+u2ZW51y+ZGkBJXbtOin2NX5574Lg3EjKlkiTh/udLTvn163j5xy+ZGkBJU6SbkQy8mn2/JVqTyRBxZv5fBoa7ENLG96ZGXKmhaSElLoJOVC7N3447jq3IDj3uJ6wvWl757KY4b0yEp0L3JaJCWgzKZF56M5ybDhbF0e2xlXQeZZjU3HXy9ufOyZrqaFpBxWZNOi87Ht6f8NW+Xu4P3E1CuxJ2MbWF5rtlZum+42ESTlsAKbFp0LdTF1PuR5wt/Kwzvp03gi1jn1lS4rky0/kpRDymtadDqWk/fKd9/ebskPcHJckh6LbWB5pVnonGzEkBRfeZOUM/LMQjbzfUrnlfP/LodTi33Sq1lEPXAXsKxIiq+8ScrisbB5Qb4kgx/lZzgjK1ki/JPXAYoPEaaqaSEpnvKaFh2XZ3bIu8jdGcbz5hD/yeEsFn7Yq/lgeqKaFpIyr8CmRQtek7fD2nepeT3A+3dp7eWa/BiP5s8x0fIjSZlTYtOiYPv4N8PbEun8JD/IyZzLI0fWQ5uIVQ0upqlpISlzSlxJ8fsCb3uV/3l6i+j/yOGcLh/eRPxB/ilqmpMKSTmovEnKtkPdTV4OuFNjXyfkZzmpS8rCLvqbiD/LP8RNsqWepBxQ5n7g2/Ls9qjbOI7gX/JNEM5th1Yiv8o/dJiipoWk7Ct0P3Dgg6FHiTb/LubVmE3yHhJoOancOzbFsCEp+/SvxaT8QsWZJ4luBbfAd/JjnL67EQcIVoFtyj92maCmhaTsKbVp0YIl+t+T3ubd41/xZT/bercndv6Sf+4ywbghKU6xTYv8yfWe5+Mb3y3itYZ4KoczOeZtGdun3uucf/mRpIiCmxYtro/8c2wz1QX801jWLaAnIru6zsvXdMpf00JSRMFNiy7JUwz5K+n2KsebW6tWNQZaiVU4/ilfpBAr4E+CpOwquWnRkbWFVyfb/s6wCukta+R7cU5GbwnZpx9T9uVHkjJTcNOimR9i+85fpa5s8TcSDr3xXZdTsX03W/f7TcNy17SQlB3lNi3aczraoyFtVZb3ozK9jXwbvR13z5xsy7z8SFJ2FN1Z1fkxdkPetwkr8FfkMZ1bcjyp76I5eTDgrStzTQtJ2Vb0JOWAM7HZ77tku7r8CvgMH7B9H+szs/XrsFN89J5Lo5GUEvcDL3QmNgNOtVPYW/DWrv7prcVzMjSZeQcPSSmzadFCZ2NZ+ZCi+8T/5MGc1JUs0W6rW7+NqMXMWtNCUkpsWhQV7Wj0sVdf3yDvQ6SvaSvMfowO5zE52T5XyaNkQVLKa1rUKdol7/PYc4B3a/sncjiJs9GcPBy7jJqzpqX5pFQ0STkg2qH469C7Mc74lSw/yfEEzsXuCDH2fuA7cta0tJ6UuiYpB0S73m/dOCpf1t9v8hDivRwe70I8J/3v3x2Qcfmx9aQUuR9Y56foyLt1XL6sL6+SJdWd8OLP9lGiN6yMNS2NJ6XApkU9RO9it7Ux6LrSL8dMUykTvy/l43Qn9ny3iWg7KSU2LeolPgLvnpQv68ErBHgth0eJP8snP8iXJZGtpqXtpNQ6STkgflf6+31Xu7+Rb3QSVLJMmZOMNS1NJ6XiScoBl72bxs/7td8KxS/ybc7o0tF4kp+mb/CXa/mx5aTUPUk54OdoVh72+VTJm3f32EoVNHlO8g2hhpNS8H7g3q5EqwMfq69wvpfvcMbVL8QT/HumbS+ZTioNJ0X/q9dg3WsSMe+pclR6/Sq/DP2oeUc8J8+yNTrOtPzYblJKbVo02FWvDGXeM9Vf2nuIEZU+V5aUk215alqaTUqxTYtGuPqv/HJBf3Q3OvFf/sFbXuJXg8/zns5Xsyw/tpoUS5OUA669k98v6K+uGi6vkkXbwdG31Jxsy1LT0mpSsv+1luWX6NLby/hmr4/yZaJPb5R969Gc/JH1RmK7stS0NJqUWvYDD3E9mpVYV8bL8jXOkEXB09H6rj/Vre5GybH82GZSSm9aNNKN9/J7hkTOKt42/UGVLLGgTJSTbRlqWppMSgVNi0a64d2l8YDn8iWHnZSvcG7K8T4i/S7/ynijY5/fsSyBJpNSRdOicY7e9G9v5Syepvt1uEPeT+7K9x4yZU62pV9+bDEplicp+47dCmdl8W2uvErGP+RwLwvWMl4k3Dmpkn4gNZgU45OUfcdue59l7Vr0+bhfyTKod0Wwc8zLqXOyLdYabZD2klLtfuABjm8EPi9dVFzsVbJ8HnSHvMD+/o5PpjNJXtPSXlJqa1o0zok7h25dvSgp3gL/Izncz6Gk/H1J/mVqqW8T0VxSKmxaNM7KnS/yq4sFSTkn/+wM+0TXS8qrZeUk/fJja0mps2nRON/c/Sq//cyCpHh3JB1YyTLXiexVipaWgyWuaWksKS1NUg44ee9AVsJJOeq9BavvsDjvwET69VJzsn1SSbv82FhSbOwHHuDUfXkFtrbCbSh+ln91Br6l7H1K/PpnObI8aWta2kqKmf3AA5ySKe6C9RTv491XcrgvqUZ+M749cgJJTypNJaX6pkXjrM6yEq7mOjV7gfbdkON9Xd355jJykng0NZWUNicpB3z74L8FGfArWYbe6v7Y262X5XwOn7KmpaWkNDtJOWjBbXy8HiqLyyi7HB2asRxSDqeGktLyJKWLf+eR5U/H00i4pb6dpDQ+SYnzSoA/D2+VX5aENS3tJEX/mzbI237/UA7XL93yYzNJMde0KKXz8iI5E+x1n0i6mpZWkmKxaVE6j+RVEu/ksAXJTiqNJMVo06JEjnn1xgMrWcqUavmxkaQwSYnxyz5MrTulqmlpIylMUqK823b/LYeNiLYf02siKc3sBx7Gr2QxtkKbaEy1kBT7TYvGuSGvkzPgnndFS1PT0kJSGmhaNIpXyWKuliHN8mMDSWmjadFwP8jr5Cx5A1YGSWpa7CeFSUqHe/JCiU9y2JAkt4kwnxQmKV28BYff5LAlKZYfzSelraZFA1yQF8rRj4h6pKhpsZ6U5poW9eZdxP8rh23xN6oNYDwpLTYt6ueY1w3sjhw3ZnxNi+2kNNq0qA+/2KPPzesrMr6mxXZSmKR0mmtlt7X1Ug6bM3r50XRS2A/cyV+V+0WOmzN6ZFlOCvuBu92U18r5Ro7bM/Y2EZaTwiSl22t5rcTvctigsTUthpNC06Jup+W1cpbXmj6/kTUtdpPCJEVhv1vxzEc5bNLI5UezSWGSouHdjttiJcu+cTUtZpOi/8Ua9pO8WI7tF23cScVqUtgPrPFEXi3xVg5bNWr50WhSaFqkcXzuXl0NvL2MqWmxmRSaFqmsy8vl/E+OmzVmeNlMiu3r7WS8SpYGTsQjalpMJoVJispxebmca3LcsBHjy2JS2A+sc0JeL8duJcu+4cuPBpPCfmCt+XbETdQ0DK9pMZgUmhapXf1bXrOtT89PyzHj5L6w/dlLCk2L+jixdv7ipQtn2ikmHbz8aC4pTFIQNbSmxVpSmKQgbmXg8qO1pLAfGB0G1rQYSwpNi9Bp2G0ibCWFpkXoNmyQmUoKTYugMaimxVRSmKRAY03GSy+WksIkBTpDaloMJYX9wFAaUtNiKClMUqA1YPnRTlJoWgS1ATUtpmb0QDYkBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABokBdAgKYAGSQE0SAqgQVIADZICaJAUQIOkABqFJWXtJVCkNRmi3WTQByVLClA9GfRBJAVwZNAHkRTAkUEfRFIARwZ9EEkBHBn0QSQFcGTQB5EUwJFBH0RSAEcGfRBJARwZ9EEkBXBk0AeRFMCRQR9EUgBHBn0QSQEcGfRBJAVwZNAHkRTAkUEfRFIARwZ9EEkBHBn0QSQFcGTQB5EUwJFBH0RSAEcGfRBJARwZ9EEkBXBk0AeRFMCRQR9EUgBHBn0QSQEcGfRBJAVwZNAHkRTAkUEfRFIARwZ9EEkBHBn0QSQFcGTQB5EUwJFBH0RSAEcGfRBJARwZ9EEkBXBk0AeRFMCRQR9EUgBHBn0QSQEcGfRBJAVwZNAHkRTAkUEfRFIARwZ9EEkBHBn0QV1J2QCaIYM+qCspAHaQFECDpAAaJAXQICmABkkBNEgKoEFSAA2SAmiQFECDpAAaJAXQICmABkkBNEgKoEFSAA2SAmiQFECDpAAaJAXQICmABkkBNEgK0G1r6/+itYhTfb0XrQAAAABJRU5ErkJggg==";
        };
        CommonUtils.getContentBlockPlaceholder = function () {
            return "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjMiIGhlaWdodD0iMjMiIHZpZXdCb3g9IjAgMCAyMyAyMyIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTExIDEySDIwVjIyLjVIMC41VjNIMTFWMTJaTTIgNC41VjEySDkuNVY0LjVIMlpNOS41IDIxVjEzLjVIMlYyMUg5LjVaTTE4LjUgMjFWMTMuNUgxMVYyMUgxOC41Wk0xNCAwSDIzVjlIMTRWMFpNMjEuNSA3LjVWMS41SDE1LjVWNy41SDIxLjVaIiBmaWxsPSIjMjI2NkUzIi8+Cjwvc3ZnPg==";
        };
        CommonUtils.getVideoPlaceholder = function () {
            return "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNSAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gPHBhdGggZD0iTTEyLjUgMEMxMy42MDE2IDAgMTQuNjY0MSAwLjE0NDUzMSAxNS42ODc1IDAuNDMzNTk0QzE2LjcxMDkgMC43MTQ4NDQgMTcuNjY0MSAxLjExNzE5IDE4LjU0NjkgMS42NDA2MkMxOS40Mzc1IDIuMTY0MDYgMjAuMjQ2MSAyLjc5Mjk3IDIwLjk3MjcgMy41MjczNEMyMS43MDcgNC4yNTM5MSAyMi4zMzU5IDUuMDYyNSAyMi44NTk0IDUuOTUzMTJDMjMuMzgyOCA2LjgzNTk0IDIzLjc4NTIgNy43ODkwNiAyNC4wNjY0IDguODEyNUMyNC4zNTU1IDkuODM1OTQgMjQuNSAxMC44OTg0IDI0LjUgMTJDMjQuNSAxMy4xMDE2IDI0LjM1NTUgMTQuMTY0MSAyNC4wNjY0IDE1LjE4NzVDMjMuNzg1MiAxNi4yMTA5IDIzLjM4MjggMTcuMTY4IDIyLjg1OTQgMTguMDU4NkMyMi4zMzU5IDE4Ljk0MTQgMjEuNzA3IDE5Ljc1IDIwLjk3MjcgMjAuNDg0NEMyMC4yNDYxIDIxLjIxMDkgMTkuNDM3NSAyMS44MzU5IDE4LjU0NjkgMjIuMzU5NEMxNy42NjQxIDIyLjg4MjggMTYuNzEwOSAyMy4yODkxIDE1LjY4NzUgMjMuNTc4MUMxNC42NjQxIDIzLjg1OTQgMTMuNjAxNiAyNCAxMi41IDI0QzExLjM5ODQgMjQgMTAuMzM1OSAyMy44NTk0IDkuMzEyNSAyMy41NzgxQzguMjg5MDYgMjMuMjg5MSA3LjMzMjAzIDIyLjg4NjcgNi40NDE0MSAyMi4zNzExQzUuNTUwNzggMjEuODQ3NyA0LjczODI4IDIxLjIyMjcgNC4wMDM5MSAyMC40OTYxQzMuMjc3MzQgMTkuNzYxNyAyLjY1MjM0IDE4Ljk0OTIgMi4xMjg5MSAxOC4wNTg2QzEuNjEzMjggMTcuMTY4IDEuMjEwOTQgMTYuMjE0OCAwLjkyMTg3NSAxNS4xOTkyQzAuNjQwNjI1IDE0LjE3NTggMC41IDEzLjEwOTQgMC41IDEyQzAuNSAxMC44OTg0IDAuNjQwNjI1IDkuODM1OTQgMC45MjE4NzUgOC44MTI1QzEuMjEwOTQgNy43ODkwNiAxLjYxNzE5IDYuODM1OTQgMi4xNDA2MiA1Ljk1MzEyQzIuNjY0MDYgNS4wNjI1IDMuMjg5MDYgNC4yNTM5MSA0LjAxNTYyIDMuNTI3MzRDNC43NSAyLjc5Mjk3IDUuNTU4NTkgMi4xNjQwNiA2LjQ0MTQxIDEuNjQwNjJDNy4zMzIwMyAxLjExNzE5IDguMjg5MDYgMC43MTQ4NDQgOS4zMTI1IDAuNDMzNTk0QzEwLjMzNTkgMC4xNDQ1MzEgMTEuMzk4NCAwIDEyLjUgMFpNMTIuNSAyMi41QzEzLjQ2ODggMjIuNSAxNC4zOTg0IDIyLjM3NSAxNS4yODkxIDIyLjEyNUMxNi4xODc1IDIxLjg3NSAxNy4wMjM0IDIxLjUyMzQgMTcuNzk2OSAyMS4wNzAzQzE4LjU3ODEgMjAuNjA5NCAxOS4yODUyIDIwLjA2MjUgMTkuOTE4IDE5LjQyOTdDMjAuNTU4NiAxOC43ODkxIDIxLjEwNTUgMTguMDgyIDIxLjU1ODYgMTcuMzA4NkMyMi4wMTk1IDE2LjUyNzMgMjIuMzc1IDE1LjY5MTQgMjIuNjI1IDE0LjgwMDhDMjIuODc1IDEzLjkwMjMgMjMgMTIuOTY4OCAyMyAxMkMyMyAxMS4wMzEyIDIyLjg3NSAxMC4xMDE2IDIyLjYyNSA5LjIxMDk0QzIyLjM3NSA4LjMxMjUgMjIuMDE5NSA3LjQ3NjU2IDIxLjU1ODYgNi43MDMxMkMyMS4xMDU1IDUuOTIxODcgMjAuNTU4NiA1LjIxNDg0IDE5LjkxOCA0LjU4MjAzQzE5LjI4NTIgMy45NDE0MSAxOC41NzgxIDMuMzk0NTMgMTcuNzk2OSAyLjk0MTQxQzE3LjAyMzQgMi40ODA0NyAxNi4xODc1IDIuMTI1IDE1LjI4OTEgMS44NzVDMTQuMzk4NCAxLjYyNSAxMy40Njg4IDEuNSAxMi41IDEuNUMxMS41MzEyIDEuNSAxMC41OTc3IDEuNjI1IDkuNjk5MjIgMS44NzVDOC44MDg1OSAyLjEyNSA3Ljk3MjY2IDIuNDgwNDcgNy4xOTE0MSAyLjk0MTQxQzYuNDE3OTcgMy4zOTQ1MyA1LjcxMDk0IDMuOTQxNDEgNS4wNzAzMSA0LjU4MjAzQzQuNDM3NSA1LjIxNDg0IDMuODkwNjIgNS45MjE4NyAzLjQyOTY5IDYuNzAzMTJDMi45NzY1NiA3LjQ3NjU2IDIuNjI1IDguMzEyNSAyLjM3NSA5LjIxMDk0QzIuMTI1IDEwLjEwMTYgMiAxMS4wMzEyIDIgMTJDMiAxMi45Njg4IDIuMTI1IDEzLjkwMjMgMi4zNzUgMTQuODAwOEMyLjYyNSAxNS42OTE0IDIuOTc2NTYgMTYuNTI3MyAzLjQyOTY5IDE3LjMwODZDMy44ODI4MSAxOC4wODIgNC40Mjk2OSAxOC43ODkxIDUuMDcwMzEgMTkuNDI5N0M1LjcxMDk0IDIwLjA3MDMgNi40MTc5NyAyMC42MTcyIDcuMTkxNDEgMjEuMDcwM0M3Ljk3MjY2IDIxLjUyMzQgOC44MDg1OSAyMS44NzUgOS42OTkyMiAyMi4xMjVDMTAuNTk3NyAyMi4zNzUgMTEuNTMxMiAyMi41IDEyLjUgMjIuNVpNOS41IDZMMTguNSAxMS45NjQ4TDkuNSAxOFY2Wk0xMSAxNS4xODc1TDE1Ljc5MyAxMS45NzY2TDExIDguNzg5MDZWMTUuMTg3NVoiIGZpbGw9IiMyMjY2RTMiLz4gPC9zdmc+";
        };
        /**
         * Does filter and find for specified query in specified element.
         */
        CommonUtils.filterFindElement = function (inElement, searchQuery) {
            var temp = inElement.filter(searchQuery);
            if (temp.length === 0) {
                temp = inElement.find(searchQuery);
            }
            return temp;
        };
        /**
         * Returns template for Code Block processors.
         */
        CommonUtils.getCodeBlockHtmltemplate = function (id, code) {
            return "<div class=\"codeBlockParent partOfCodeBlock\" contenteditable=\"false\" data-code-block-id=\"" + id + "\" data-parents-block-id=\"" + id + "\" id=\"" + id + "\" style=\"display: flex; align-items: center; height: 20px; width: 100%; flex-direction: row; padding: 2px;\">\n                <div class=\"codeBlockAnnotation partOfCodeBlock\" contenteditable=\"false\" data-parents-block-id=\"" + id + "\" style=\"background-color: rgb(0, 181, 194); height: 20px; width: 20px; border-radius: 2px; margin: 0px; display: flex; align-items: center; justify-content: center; pointer-events:none;\">\n                    <div class=\"codeBlockAnnotation partOfCodeBlock\" contenteditable=\"false\" data-parents-block-id=\"" + id + "\" style=\"background-image: url(&quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CgogPGc+CiAgPHRpdGxlPmJhY2tncm91bmQ8L3RpdGxlPgogIDxyZWN0IGZpbGw9Im5vbmUiIGlkPSJjYW52YXNfYmFja2dyb3VuZCIgaGVpZ2h0PSI0MDIiIHdpZHRoPSI1ODIiIHk9Ii0xIiB4PSItMSIvPgogPC9nPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxwYXRoIGlkPSJzdmdfMSIgZmlsbD0iI2ZmZmZmZiIgZD0ibTUuNjgzNDcyLDE0LjExODAyMmMtMS4zOTkwOSwtMC4wMTgyIC0yLjA5ODY0LC0wLjcyNDYgLTIuMDk4NjQsLTIuMTE5MWwwLC0yLjA1MDgxYzAsLTAuOTIwNTcgLTAuMzU1NDcsLTEuNDAzNjQgLTEuMDY2NCwtMS40NDkyMWwwLC0wLjc5Mjk3YzAuNzEwOTMsLTAuMDQ1NTggMS4wNjY0LC0wLjUzNzc2IDEuMDY2NCwtMS40NzY1N2wwLC0xLjk5NjA5YzAsLTEuNDEyNzYgMC42OTk1NSwtMi4xMjgyNSAyLjA5ODY0LC0yLjE0NjQ4bDAsMC44NzVjLTAuNzI0NjEsMC4wMTgyMiAtMS4wODY5MiwwLjQ2OTQgLTEuMDg2OTIsMS4zNTM1MWwwLDIuMDAyOTNjMCwwLjk1NzAzIC0wLjM0MTgsMS41NDQ5MiAtMS4wMjUzOSwxLjc2MzY3bDAsMC4wMjczNWMwLjY4MzU5LDAuMjA1MDcgMS4wMjUzOSwwLjc4ODQxIDEuMDI1MzksMS43NWwwLDEuOTc1NThjMCwwLjUwNTg5IDAuMDc5NzUsMC44NjU4OSAwLjIzOTI2LDEuMDgwMDljMC4xNjQwNiwwLjIxODcgMC40NDY2MSwwLjMzMjcgMC44NDc2NiwwLjM0MThsMCwwLjg2MTN6bTcuODgxODUsLTUuNjE5MTJjLTAuNzExLDAuMDQ1NTcgLTEuMDY2NCwwLjUyODY0IC0xLjA2NjQsMS40NDkyMWwwLDIuMDUwODFjMCwxLjM5NDUgLTAuNjk3MjksMi4xMDA5IC0yLjA5MTgyLDIuMTE5MWwwLC0wLjg2MTNjMC4zOTY0OCwtMC4wMDkxIDAuNjc2NzYsLTAuMTIzMSAwLjg0MDgyLC0wLjM0MThjMC4xNjg2MiwtMC4yMTg4IDAuMjUyOTMsLTAuNTc4OCAwLjI1MjkzLC0xLjA4MDA5bDAsLTEuOTc1NThjMCwtMC45NjE1OSAwLjMzOTUyLC0xLjU0NDkzIDEuMDE4NTcsLTEuNzVsMCwtMC4wMjczNWMtMC42NzkwNSwtMC4yMTg3NSAtMS4wMTg1NywtMC44MDY2NCAtMS4wMTg1NywtMS43NjM2N2wwLC0yLjAwMjkzYzAsLTAuODg0MTEgLTAuMzY0NTksLTEuMzM1MjkgLTEuMDkzNzUsLTEuMzUzNTFsMCwtMC44NzVjMS4zOTQ1MywwLjAxODIzIDIuMDkxODIsMC43MzM3MiAyLjA5MTgyLDIuMTQ2NDhsMCwxLjk5NjA5YzAsMC45Mzg4MSAwLjM1NTQsMS40MzA5OSAxLjA2NjQsMS40NzY1N2wwLDAuNzkyOTd6Ii8+CiA8L2c+Cjwvc3ZnPg==&quot;); background-repeat: no-repeat; height: 15px; width: 15px; pointer-events:none;\"></div>\n                </div>\n                <div class=\"codeBlockAnnotation partOfCodeBlock\" contenteditable=\"false\" data-parents-block-id=\"" + id + "\" style=\"background-color: rgb(0, 181, 194); height: 2px; width: 100%; margin: 0px; pointer-events:none;\"></div>\n                <pre class=\"codeBlock partOfCodeBlock\" contenteditable=\"false\" data-parents-block-id=\"" + id + "\" style=\"display: none; pointer-events:none;\">" + (code.length === 0 ? Editor.CommonConstants.spaceSign : code) + "</pre>\n            </div>";
        };
        /**
         * Returns minized template for Code Block processors.
         */
        CommonUtils.getCodeBlockMinizedHtmltemplate = function (code) {
            return "<div class=\"codeBlock\">" + code + "</div>";
        };
        /**
         * Returns minized template for Event registration QR Code Block processors.
         */
        CommonUtils.getEventRegistrationQRCodeBlockTemplate = function (lookupId, lookupName) {
            return "<div class=\"codeBlock\" align=\"center\" data-lookup-id=\"" + lookupId + "\" data-lookup-name=\"" + lookupName + "\">\n                        <!-- {{#each contact.msevtmgt_eventregistration_contact_msevtmgt_contactid }} -->\n                        <!-- {{#if (eq this.msevtmgt_eventid '" + lookupId + "')}} -->\n                        <img id=\"base64image\" src=\"{{this.msevtmgt_qrcode}}\" alt=\"Event registration QR code\">\n                        <!-- {{/if}} -->\n                        <!-- {{/each}} -->\n                    </div>";
        };
        CommonUtils.isLayout = function (element) {
            return element.attr(Editor.Contract.dataLayoutAttrName) === "true";
        };
        /**
         * Decides if an editor is form editor based on it's bodies content
         *
         * @param form The jQuery object of the editor's body
         */
        CommonUtils.isFormEditor = function (body) {
            var forms = body.find("form");
            return (!Utility.isNullOrUndefined(forms) && forms.length === 1 // There is exactly one form
                && forms.parents("[" + Editor.Contract.blockTypeAttrName + "]").length === 0 // And that is not inside a block
            );
        };
        /**
         * For el rewrites inline property with new value.
         * @param el
         * @param property new property
         * @param value new value
         */
        CommonUtils.rewriteInlineStyleProperty = function (el, property, value) {
            var styles = el.attr("style") || "";
            var newStyles = CommonUtils.rewriteStringInlineStyleProperty(styles, property, value);
            el.attr("style", newStyles);
        };
        /**
         * Rewrites inline styles string with new value.
         * @param styles string containing all styles for element
         * @param property new property
         * @param value new value
         */
        CommonUtils.rewriteStringInlineStyleProperty = function (styles, property, value) {
            var stylesParam = styles;
            if (!stylesParam) {
                stylesParam = "";
            }
            var newStyles = "";
            var propWasAdded = false;
            stylesParam.split(";").forEach(function (style) {
                var prop = style.split(":");
                if (prop.length > 0 && prop[0].trim() === property) {
                    newStyles += property + ": " + value + ";";
                    propWasAdded = true;
                }
                else if (style.length > 0) {
                    newStyles += style + ";";
                }
            });
            if (propWasAdded === false) {
                newStyles += property + ": " + value + ";";
            }
            return newStyles;
        };
        /**
         * Return array of css styles for image aligntment.
         */
        CommonUtils.getAligmentImageCss = function (alignment) {
            var styles = [];
            if (!String.isNullUndefinedOrWhitespace(alignment)) {
                // Set alignment for outlook
                styles["align"] = alignment;
                // Set alignment for browsers
                styles["margin-left"] = "auto";
                styles["margin-right"] = "auto";
                styles["float"] = "none";
                if (alignment !== "center") {
                    styles["float"] = alignment;
                    styles["margin-" + alignment] = "0";
                }
            }
            return styles;
        };
        CommonUtils.setImageAlignmentForInlineStyles = function (element, alignment, imageModifier) {
            var cssStyles = CommonUtils.getAligmentImageCss(alignment);
            for (var key in cssStyles) {
                if (cssStyles.hasOwnProperty(key)) {
                    var value = cssStyles[key];
                    if (value) {
                        imageModifier(element, key, value);
                    }
                }
            }
        };
        CommonUtils.setImageAlignment = function (wrapper, element, alignment, wrapperModifier, imageModifier) {
            if (!String.isNullUndefinedOrWhitespace(alignment)) {
                // Set alignment for outlook
                wrapperModifier(wrapper, Editor.DetailsViewConstants.alignAttribute, alignment);
                // Set alignment for inline styles of the image
                this.setImageAlignmentForInlineStyles(element, alignment.toLowerCase(), imageModifier);
            }
        };
        CommonUtils.getClearDiv = function () {
            return $("<div>")
                .addClass("clear")
                .attr("style", "clear: both;\n                     height: 0px;\n                     width: 0px;");
        };
        CommonUtils.getCleanNumber = function (inString) {
            return inString.replace(/[^0-9.]+/g, "");
        };
        CommonUtils.getCommentedStrings = function (block) {
            var comments = [];
            Array.prototype.slice.call(block.childNodes).forEach(function (el) {
                if (el.nodeType === Node.COMMENT_NODE) {
                    comments.push(el);
                }
            });
            return comments;
        };
        CommonUtils.getOnlyPixelsValueFromString = function (value) {
            if (value.indexOf("px") !== -1) {
                return parseInt(value);
            }
            return 0;
        };
        /**
         * Used to await all promises and get result as an array
         * @param array of promises
         */
        CommonUtils.all = function (array) {
            var deferred = $.Deferred();
            var fulfilled = 0;
            var length = array.length;
            var results = [];
            if (length === 0) {
                deferred.resolve(results);
            }
            else {
                array.forEach(function (promise, i) {
                    $.when(promise).then(function (value) {
                        results[i] = value;
                        fulfilled++;
                        if (fulfilled === length) {
                            deferred.resolve(results);
                        }
                    }, function (value) {
                        results[i] = value;
                        fulfilled++;
                        if (fulfilled === length) {
                            deferred.resolve(results);
                        }
                    });
                });
            }
            return deferred.promise();
        };
        CommonUtils.isElementInDesignerFrame = function (element) {
            if (!element) {
                return false;
            }
            var designerFrame = CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            if (!designerFrame || !designerFrame.length) {
                return true;
            }
            return designerFrame.contents().find(element).length > 0;
        };
        /**
         * Used to check if certian css property of an image has a value of null, undefined, whitespace or zero.
         * @param array of promises
         */
        CommonUtils.hasValue = function (image, property) {
            var value = image.css(property);
            if (!String.isNullUndefinedOrWhitespace(value) && value.replace(/[^-\d\.]/g, "") !== "0") {
                return true;
            }
            return false;
        };
        /**
         * Check if children of given element are visible in the editor.
         * @param element of Element
         */
        CommonUtils.isAnyChildrenVisible = function (element) {
            if (!element.hasChildNodes()) {
                return false;
            }
            for (var i = 0; i < element.children.length; i++) {
                var children = element.children[i];
                var isDraggableWrapper = children.className.indexOf(Editor.CommonConstants.draggableWrapperClassName) !== -1;
                if (isDraggableWrapper) {
                    if (this.isAnyChildrenVisible(children)) {
                        return true;
                    }
                    continue;
                }
                if (children.style.display !== "none") {
                    return true;
                }
            }
            return false;
        };
        CommonUtils.setElementVisibility = function (element, isVisible) {
            if (isVisible) {
                element.style.display = "";
            }
            else {
                element.style.display = "none";
            }
        };
        CommonUtils.startsWith = function (originalString, startsWithString) {
            if (!String.isNullOrEmpty(originalString)) {
                return originalString.indexOf(startsWithString, 0) === 0;
            }
            return false;
        };
        CommonUtils.calculateContainerWidth = function (container) {
            var parent = container.parentElement;
            var marginPaddingSubstraction = 0;
            // start with current width
            var containerWidth = this.getElementWidth(container);
            while (!Utility.isNullOrUndefined(parent) && containerWidth === undefined) {
                containerWidth = this.getElementWidth(parent);
                if (containerWidth === undefined) {
                    marginPaddingSubstraction += this.getPaddingsAndMarginsForWidthCombined(parent);
                }
                parent = parent.parentElement;
            }
            if (containerWidth === undefined) {
                return 0;
            }
            return containerWidth - marginPaddingSubstraction;
        };
        CommonUtils.getElementWidth = function (element) {
            // only get width if it is explicitly specified, not in percentage
            if (!Utility.isNullOrUndefined(element.style.width) &&
                element.style.width !== "" &&
                element.style.width.indexOf("%") === -1 &&
                element.style.width.indexOf("auto") === -1) {
                return Editor.CommonUtils.getOnlyPixelsValueFromString(element.style.width);
            }
            if (element.hasAttribute("width") &&
                !Utility.isNullOrUndefined(element.getAttribute("width")) &&
                element.getAttribute("width") !== "" &&
                element.getAttribute("width").indexOf("%") === -1 &&
                element.getAttribute("width").indexOf("auto") === -1) {
                return parseInt(element.getAttribute("width"));
            }
            return undefined;
        };
        CommonUtils.getElementHeight = function (element) {
            // only get height if it is explicitly specified, not in percentage
            if (!Utility.isNullOrUndefined(element.style.height) &&
                element.style.height !== "" &&
                element.style.height.indexOf("%") === -1 &&
                element.style.height.indexOf("auto") === -1) {
                return Editor.CommonUtils.getOnlyPixelsValueFromString(element.style.height);
            }
            if (element.hasAttribute("height") &&
                !Utility.isNullOrUndefined(element.getAttribute("height")) &&
                element.getAttribute("height") !== "" &&
                element.getAttribute("height").indexOf("%") === -1 &&
                element.getAttribute("height").indexOf("auto") === -1) {
                return parseInt(element.getAttribute("height"));
            }
            return undefined;
        };
        CommonUtils.getBorderRadius = function (element) {
            return Utility.isNullOrUndefined(element.style.borderRadius)
                ? 0
                : Number(element.style.borderRadius.replace("px", ""));
        };
        CommonUtils.getPaddingsAndMarginsForWidthCombined = function (element) {
            var leftMargin = Editor.CommonUtils.getOnlyPixelsValueFromString(element.style.marginLeft);
            var rightMargin = Editor.CommonUtils.getOnlyPixelsValueFromString(element.style.marginRight);
            var leftPadding = Editor.CommonUtils.getOnlyPixelsValueFromString(element.style.paddingLeft);
            var rightPadding = Editor.CommonUtils.getOnlyPixelsValueFromString(element.style.paddingRight);
            return leftMargin + rightMargin + leftPadding + rightPadding;
        };
        CommonUtils.getOverlayIcon = function (blockType) {
            var overlayIcon = document.createElement("img");
            overlayIcon.className = Editor.CommonConstants.overlayIconImageClassName;
            switch (blockType) {
                case Editor.BlockType.Image:
                    overlayIcon.src = CommonUtils.getLocalizedImagePlaceholder();
                    break;
                case Editor.BlockType.Video:
                    overlayIcon.src = CommonUtils.getVideoPlaceholder();
                    break;
                case Editor.BlockType.ContentBlock:
                    overlayIcon.src = CommonUtils.getContentBlockPlaceholder();
                    break;
            }
            return $("<div>").append($(overlayIcon));
        };
        CommonUtils.whitelistOfHeadTags = ["TITLE", "STYLE", "BASE", "LINK", "META", "SCRIPT", "NOSCRIPT"];
        CommonUtils.msoOpeningTag = "[if mso]>";
        return CommonUtils;
    }());
    Editor.CommonUtils = CommonUtils;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BrowserQuirks = /** @class */ (function () {
        function BrowserQuirks() {
        }
        BrowserQuirks.fixCheckedNodes = function (node) {
            // prettier-ignore
            if (node && Editor.CommonUtils.getInternetExplorerVersion() === 11) { // tslint:disable-line
                node
                    .find('input[checked="checked"]')
                    .each(function (index, element) {
                    element.setAttribute("checked");
                });
            }
        };
        return BrowserQuirks;
    }());
    Editor.BrowserQuirks = BrowserQuirks;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CommonConstants = /** @class */ (function () {
        function CommonConstants() {
        }
        // TOOLS
        CommonConstants.buttonToolType = "Button";
        CommonConstants.buttonToolLabel = "[Button]";
        CommonConstants.buttonToolImageAltText = "[Button]";
        CommonConstants.buttonToolTitle = "[Button]";
        CommonConstants.buttonEmptyHref = "#";
        CommonConstants.dividerToolType = "Divider";
        CommonConstants.dividerToolLabel = "[Divider]";
        CommonConstants.dividerToolImageAltText = "[Divider]";
        CommonConstants.dividerToolTitle = "[Divider]";
        CommonConstants.imageToolType = "Image";
        CommonConstants.imageToolLabel = "[Image]";
        CommonConstants.imageToolImageAltText = "[Image]";
        CommonConstants.imageToolTitle = "[Image]";
        CommonConstants.textToolType = "Text";
        CommonConstants.textToolLabel = "[Text]";
        CommonConstants.textToolImageAltText = "[Text]";
        CommonConstants.textToolTitle = "[Text]";
        CommonConstants.sectionToolType = "Section";
        CommonConstants.columnToolType = "Column";
        CommonConstants.contentBlockToolType = "Content";
        CommonConstants.contentBlockLookupContainerId = "contentBlockLookupContainer";
        CommonConstants.contentBlockLinkInputCssClass = "contentBlockLinkInput";
        CommonConstants.subBlockProperties = "subBlockProperties";
        CommonConstants.videoToolType = "Video";
        CommonConstants.videoToolLabel = "[Video]";
        CommonConstants.videoToolTitle = "[Video]";
        CommonConstants.videoToolCss = "videoTool";
        CommonConstants.oneColumnToolType = "OneColumn";
        CommonConstants.oneColumnToolLabel = "[1 Column]";
        CommonConstants.oneColumnToolTitle = "[1 Column]";
        CommonConstants.oneColumnToolCss = "oneColumnTool";
        CommonConstants.twoColumnToolType = "TwoColumn";
        CommonConstants.twoColumnToolLabel = "[2 Column]";
        CommonConstants.twoColumnToolTitle = "[2 Column]";
        CommonConstants.twoColumnToolCss = "twoColumnTool";
        CommonConstants.threeColumnToolType = "ThreeColumn";
        CommonConstants.threeColumnToolLabel = "[3 Column]";
        CommonConstants.threeColumnToolTitle = "[3 Column]";
        CommonConstants.threeColumnToolCss = "threeColumnTool";
        CommonConstants.oneTwoColumnToolType = "OneTwoColumn";
        CommonConstants.oneTwoColumnToolLabel = "[1-2]";
        CommonConstants.oneTwoColumnToolTitle = "[1-2]";
        CommonConstants.oneTwoColumnToolCss = "oneTwoColumnTool";
        CommonConstants.twoOneColumnToolType = "TwoOneColumn";
        CommonConstants.twoOneColumnToolLabel = "[2-1]";
        CommonConstants.twoOneColumnToolTitle = "[2-1]";
        CommonConstants.twoOneColumnToolCss = "twoOneColumnTool";
        CommonConstants.customColumnToolType = "CustomColumn";
        CommonConstants.customColumnToolLabel = "[Custom Column]";
        CommonConstants.customColumnToolTitle = "[Custom Column]";
        CommonConstants.customColumnToolCss = "customColumnTool";
        // Blocks
        CommonConstants.buttonBlockTitleLabel = "[Button]";
        CommonConstants.imageBlockTitleLabel = "[Image]";
        CommonConstants.textBlockTitleLabel = "[Text]";
        CommonConstants.videoBlockTitleLabel = "[Video]";
        CommonConstants.sectionBlockTitleLabel = "[Section]";
        CommonConstants.emailBlockTitleLabel = "[Email]";
        CommonConstants.contentBlockTitleLabel = "[Content block title]";
        CommonConstants.dividerBlockTitleLabel = "[Divider]";
        CommonConstants.moveBlockLabel = "[Move Block]";
        CommonConstants.blockMovedLabel = "[Moved]";
        CommonConstants.moveLabel = "[Move]";
        CommonConstants.deleteBlockLabel = "[Delete Block]";
        CommonConstants.blockDeletedLabel = "[Deleted]";
        CommonConstants.deleteLabel = "[Delete]";
        CommonConstants.parentLabel = "[Go to Parent]";
        CommonConstants.cloneBlockLabel = "[Clone Block]";
        CommonConstants.blockClonedLabel = "[Cloned]";
        CommonConstants.enableAbTestBlockLabel = "[Enable A/B Testing]";
        CommonConstants.disableAbTestBlockLabel = "[Disable A/B Testing]";
        // EDITOR CONTROL
        /**
         * Class name to identify layout iframes.
         */
        CommonConstants.layoutFrameClassName = "editor-control-layout";
        /**
         * Class name to identify editor container.
         */
        CommonConstants.editorContainerCssClass = "editorContainer";
        /**
         * Class name to identify content editor element.
         */
        CommonConstants.contentEditorCssClass = "contentEditor";
        /**
         * Class name to identify content resolver iframe.
         */
        CommonConstants.contentResolverFrameClassName = "editor-control-content-resolver";
        /**
         * Class name to identify editor title in readonly mode.
         */
        CommonConstants.editorReadonlyTitleClassName = "editorReadonlyTitle";
        /**
         * Default type for the button
         */
        CommonConstants.buttonType = "button";
        /**
         * Class name to identify editor dialogs.
         */
        CommonConstants.popupCssClassName = "editorPopupCssClass";
        /**
         * Class name to identify JQuery-ui overlays.
         */
        CommonConstants.overlayCssClassName = "ui-widget-overlay";
        /**
         * Class name to identify hidden buttons used for accessibility navigation
         */
        CommonConstants.accessibilityButtonClassName = "editorAccessibilityButton";
        // BLOCKS
        /**
         * The block's attribute indicating that the inline toolbar was added for that block.
         */
        CommonConstants.toolbardataAttrName = "data-toolbar";
        CommonConstants.makeEditableAttrName = "data-makeeditable";
        CommonConstants.designerImageSourceAttributeName = "data-src";
        CommonConstants.designerTextBlockImageSourceAttributeName = "src";
        CommonConstants.requiredFieldAttrName = "data-required-field";
        // Video
        CommonConstants.videoWrapperClass = "videoWrapper";
        CommonConstants.videoIdAttrName = "data-video-id";
        CommonConstants.videoNameAttrName = "data-video-name";
        CommonConstants.videoUrlAttrName = "data-video-url";
        CommonConstants.videoThumbnailUrlAttrName = "data-video-thumbnail";
        CommonConstants.videoEmbedCodeAttrName = "data-video-embed-code";
        // Code Block
        CommonConstants.codeBlockId = "data-code-block-id";
        /**
         * The attribute name for the ckeditor container
         */
        CommonConstants.ckEditorAttrName = "data-ckEditor";
        CommonConstants.draggableCursor = "move";
        CommonConstants.draggableOpacity = 0.75;
        CommonConstants.draggableHelperWidth = 225;
        CommonConstants.draggableHelperHeight = 15;
        CommonConstants.draggableHandleChar = "&#x2725;";
        CommonConstants.draggableWrapperClassName = "draggableWrapper";
        CommonConstants.dragButtonClassName = "dragButton";
        CommonConstants.sortablePlaceholderClassName = "sort-highlight";
        CommonConstants.selectedSortablePlaceholderClassName = "selected-sort-highlight";
        CommonConstants.addBlockButtonClassName = "addBlockButton";
        CommonConstants.addBlockLineClassName = "addBlockLine";
        CommonConstants.dropLineBorderClassName = "dropLineBorder";
        CommonConstants.dropLineClassName = "dropLine";
        CommonConstants.addBlockMouseHoverClassName = "addBlockMouseHover";
        // TOOLBOX
        CommonConstants.toolboxItemClassName = "tool-card";
        CommonConstants.toolboxItemButtonCssClassName = "tool-card-button";
        CommonConstants.contentViewBlocksClassName = "contentViewBlocks";
        CommonConstants.toolboxDefaultSectionName = "ContentBlock";
        CommonConstants.videoIconAltName = "Video icon";
        CommonConstants.deleteBlockButtonAltName = "Delete block button";
        CommonConstants.toolboxDefaultSectionLabel = "[Content Block]";
        CommonConstants.flightedToolboxDefaultSectionName = "Basic elements";
        CommonConstants.flightedToolboxDefaultSectionLabel = "[Basic elements]";
        CommonConstants.flightedToolboxAdvancedElementsSectionName = "Advanced elements";
        CommonConstants.flightedToolboxAdvancedElementsSectionLabel = "[Advanced elements]";
        CommonConstants.toolboxEventsSectionName = "Events communication";
        CommonConstants.toolboxEventsSectionLabel = "[Events communication]";
        CommonConstants.toolboxSelectedToolItemClassName = "selectedToolItem";
        CommonConstants.toolboxLayoutSectionName = "Layout";
        CommonConstants.toolboxLayoutSectionLabel = "[Layout]";
        CommonConstants.flightedToolboxLayoutSectionName = "Sections";
        CommonConstants.flightedToolboxLayoutSectionLabel = "[Sections]";
        CommonConstants.eventAdvancedToolType = "Event";
        CommonConstants.marketingPageAdvancedToolType = "Marketing Page";
        CommonConstants.surveyAdvancedToolType = "Survey";
        CommonConstants.customerVoiceSurveyToolType = "Customer Voice Survey";
        /**
         * The toolbox items's attribute that contains the tool id.
         */
        CommonConstants.toolboxItemTypeDataAttr = "editortool-type";
        CommonConstants.toolboxItemIdDataAttr = "editortool-id";
        CommonConstants.toolboxSectionNameDataAttr = "section";
        CommonConstants.sectionTitle = "[Section]";
        CommonConstants.columnTitle = "[Column]";
        // HTML editor
        CommonConstants.htmlEditorContentAreaClassName = "htmlEditorContentTextArea";
        CommonConstants.htmlEditorComponentName = "htmlEditor";
        CommonConstants.htmlEditorTabContentClassName = "htmlEditor";
        CommonConstants.htmlInlinePreviewTabContentClassName = "htmlPreview";
        CommonConstants.htmlTabControlDataId = "htmlContentTabButton";
        CommonConstants.htmlWarningMessageId = "htmlWarningMessage";
        CommonConstants.htmlWarningMessageLabel = "[Protected Content]";
        CommonConstants.htmlEditorNotSupportedMessageClassName = "htmlEditorNotSupportedMessage";
        CommonConstants.htmlEditorTabPanel = "htmlEditorTabPanel";
        // Designer editor
        CommonConstants.contentEditableAttrName = "contenteditable";
        CommonConstants.wrapperContainerClassName = "wrapperContainer";
        CommonConstants.designerContentEditorFrameClassName = "designerContentEditorFrame";
        CommonConstants.designerContentEditorFrameId = "designer-content-editor";
        CommonConstants.designerContentEditorFrameWrapperClassName = "designerContentEditorFrameWrapper";
        CommonConstants.iosScrollClassName = "iosScroll";
        CommonConstants.designerIosContainerClassName = "designerIosContainer";
        CommonConstants.htmlContentEditorFrame = "htmlContentEditorFrame";
        CommonConstants.designerContentEditorContainerInDragModeClassName = "containerDragMode";
        CommonConstants.treeViewCssClass = "treeView";
        CommonConstants.propertiesTitleCssClass = "propertiesTitle";
        CommonConstants.propertiesTitleButtonCssClass = "propertiesTitleButton";
        CommonConstants.extrasToggleCssClass = "extrasToggle";
        CommonConstants.collapsedCssClass = "collapsed";
        CommonConstants.contentBlockItemsCssClass = "contentBlockItems";
        CommonConstants.contentBlockSectionCssClass = "contentBlockSection";
        CommonConstants.contentBlockSectionEmptyCssClass = "contentBlockSection-empty";
        CommonConstants.contentBlockSectionSubtitleCssClass = "contentBlockSection-subtitle";
        CommonConstants.contentBlockSectionSubtitleId = "headerSubtitleId";
        CommonConstants.contentBlockSectionSubtitleTextId = "headerSubtitleTextId";
        CommonConstants.contentBlockSectionSubtitleTextClass = "headerSubtitleTextClass";
        CommonConstants.contentBlockSectionEmptyMessageCssClass = "contentBlockSection-empty-message";
        CommonConstants.contentBlockSectionEmptyMessage = "[ContentBlockSectionEmptyMessage]";
        CommonConstants.contentBlockCantInsertMoreBlocks = "[ContentBlockCantInsertMoreBlocks]";
        CommonConstants.contentBlockSectionLoadingCssClass = "contentBlockSection-loading";
        CommonConstants.contentBlockSectionLoadingMessageCssClass = "contentBlockSection-loading-message";
        CommonConstants.contentBlockSectionLoadingMessage = "[ContentBlockSectionLoadingMessage]";
        CommonConstants.tabSelectedCssClass = "ui-tabs-active ui-state-active";
        CommonConstants.designerControlCssClass = "designer";
        CommonConstants.postProcessingMessageCssClass = "postProcessingMessage";
        CommonConstants.designerTabViewCssClass = "designerTabView";
        CommonConstants.designerTabButtonViewCssClass = "designerTabButtonView";
        CommonConstants.designerOverlayHiddenElementCssClassName = "designer-content-editor-hidden";
        CommonConstants.designerUnconfiguredContentOverlayCssClassName = "designer-unconfiguredcontent-overlay";
        CommonConstants.overlayIconImageClassName = "overlay-icon-image";
        CommonConstants.unconfiguredOverlayIconCssClassName = "unconfigured-overlay-icon";
        CommonConstants.unconfiguredImageOverlayIconCssClassName = "unconfigured-image-overlay-icon";
        CommonConstants.designerEditorComponentName = "designerEditor";
        CommonConstants.dataTrackAttributeName = "data-msdyn-tracking";
        CommonConstants.dataTargetAttributeName = "target";
        CommonConstants.dataTrackIdAttributeName = "data-msdyn-tracking-id";
        CommonConstants.protocolRegex = /^([a-z]+:\/\/|mailto:|#|{{)/;
        CommonConstants.defaultProtocol = "http://";
        CommonConstants.designerTabControlDataId = "designerContentTabButton";
        // Full Page editor
        CommonConstants.fullPageContentEditorcssClass = "fullPageContentEditor";
        CommonConstants.fullPageTabControlDataId = "fullPageContentTabButton";
        CommonConstants.fullPageContentEditorFrameClassName = "fullPageContentEditorFrame";
        CommonConstants.fullPageEditorComponentName = "fullPageEditor";
        // MenuBar
        CommonConstants.accessibilityInspectionHeaderCssClass = "accessibilityInspectionHeader";
        CommonConstants.accessibilityInspectionResultsCssClass = "accessibilityInspectionResults";
        CommonConstants.accessibilityInspectionResultsCardCssClass = "accessibilityInspectionResultsCard";
        CommonConstants.accessibilityInspectionResultsCardTitleCssClass = "accessibilityInspectionResultsCardTitle";
        CommonConstants.accessibilityInspectionResultsCardBodyCssClass = "accessibilityInspectionResultsCardBody";
        CommonConstants.accessibilityCheckerButtonImageCssClass = "accessibilityCheckerButtonImage";
        CommonConstants.accessibilityIssuesCssClass = "accessibilityIssues";
        CommonConstants.accessibilityCheckerCssClass = "accessibilityChecker";
        CommonConstants.accessibilityCheckerMessageCssClass = "accessibilityCheckerMessage";
        CommonConstants.accessibilityCheckerButtonCssClass = "accessibilityCheckerButton";
        CommonConstants.axeResultsGroupedListCssClass = "axeResultsGroupedList";
        CommonConstants.axeResultsGroupedListCellCssClass = "axeResultsGroupedListCell";
        CommonConstants.axeResultsGraphicCssClass = "axeResultsGraphic";
        CommonConstants.inlinePaneHeaderClass = "inlinePaneHeader";
        CommonConstants.axeResultsDivCssClass = "axeResultsDiv";
        CommonConstants.selectAxeResultImageCssClass = "selectAxeResultImage";
        CommonConstants.menuBarControlCssClass = "menuBarControlLayout";
        CommonConstants.menuBarCssClass = "menuBar";
        CommonConstants.menuBarItemsCssClass = "menuBarItems";
        CommonConstants.toolbarButtonCssClass = "toolbarButton";
        CommonConstants.undoButtonCssClass = "undoButton";
        CommonConstants.undoButtonImageCssClass = "undoButtonImage";
        CommonConstants.undoButtonLabelCssClass = "undoButtonLabel";
        CommonConstants.saveButtonCssClass = "saveButton";
        CommonConstants.saveButtonImageCssClass = "saveButtonImage";
        CommonConstants.saveButtonLabelCssClass = "saveButtonLabel";
        CommonConstants.redoButtonCssClass = "redoButton";
        CommonConstants.redoButtonImageCssClass = "redoButtonImage";
        CommonConstants.redoButtonLabelCssClass = "redoButtonLabel";
        CommonConstants.warningIndicatorLabelCssClass = "warningButtonLabel";
        CommonConstants.warningButtonImageCssClass = "warningButtonImage";
        CommonConstants.warningButtonCssClass = "warningButton";
        CommonConstants.maximizeButtonImageCssClass = "maximizeButtonImage";
        CommonConstants.maximizeButtonCssClass = "maximizeButton";
        CommonConstants.maximizeButtonLabelCssClass = "maximizeButtonLabel";
        CommonConstants.maximizeActiveCssClass = "maximizeButton-active";
        CommonConstants.fullscreenClose = "fullscreen_close";
        CommonConstants.toolsDropdownCssClass = "toolsDropdown";
        CommonConstants.selectedToolsDropdownCssClass = "selectedToolsDropdown";
        CommonConstants.menuBarDividerCssClass = "menuBarDivider";
        // Control tabs
        CommonConstants.toolboxTabContentClassName = "toolboxTabContent";
        CommonConstants.detailsTabContentClassName = "detailsTabContent";
        CommonConstants.htmlTabContentClassName = "htmlContentEditor";
        CommonConstants.designerTabContentClassName = "designerContentEditor";
        CommonConstants.previewViewClassName = "previewView";
        CommonConstants.browserPreviewTabContentClassName = "browserPreview";
        CommonConstants.tabButtonPreClassName = "tabButton_";
        CommonConstants.previewTabControlDataId = "previewContentTabButton";
        CommonConstants.basicPreviewTabControlDataId = "basicPreviewTabControlDataId";
        CommonConstants.previewTabControlCssClass = "preview";
        CommonConstants.previewTabButtonViewCssClass = "previewTabButtonView";
        CommonConstants.browserPreviewComponentName = "browserPreview";
        CommonConstants.previewTabPanel = "previewTabPanel";
        // Tab Control
        CommonConstants.designerTabContainer = "designerTabContainer";
        CommonConstants.designerTabAnchor = "designerTabAnchor";
        CommonConstants.designerTabPaneLabel = "designerTabPaneLabel";
        // Details view
        CommonConstants.detailsViewPropertiesClassName = "detailsViewProperties";
        CommonConstants.userDetailsViewSimpleInput = "userDetailsViewSimpleInput";
        CommonConstants.emptyDetailsViewCssClass = "emptyDetailsView";
        // Styles view
        CommonConstants.stylesTabContentClassName = "stylesTabContent";
        CommonConstants.stylesViewFrameClassName = "stylesViewFrame";
        // Accessibility popup
        CommonConstants.accessibilityPopupClassName = "accessibilityPopup";
        CommonConstants.accessibilityLegendClassName = "accessibilityLegend";
        CommonConstants.accessibilityLegendSectionClassName = "accessibilityLegendSection";
        CommonConstants.accessibilityLegendSectionLabelClassName = "accessibilityLegendSectionLabel";
        CommonConstants.accessibilityLegendSectionElementClassName = "accessibilityLegendSectionElement";
        CommonConstants.accessibilityLegendSectionElementCaptionClassName = "accessibilityLegendSectionElementCaption";
        // Designer accessibility notifications region
        CommonConstants.designerAccessibilityNotificationsRegion = "designerAccessibilityNotificationsRegion";
        CommonConstants.detailsViewAccessibilityNotificationRegion = "detailsViewAccessibilityNotificationRegion";
        // Aria Labels
        CommonConstants.colorFieldAriaLabel = "colorFieldAriaLabel";
        // Text Direction (localization dependent)
        CommonConstants.leftToRightTextDirectionCssClass = "ltr";
        CommonConstants.rightToLeftTextDirectionCssClass = "rtl";
        //font
        CommonConstants.editorFontCssClass = "CCFSymbolFont";
        CommonConstants.fontIconSizeCssClass = "fontIconSize";
        CommonConstants.iconContainerCssClass = "iconContainer";
        // UTILS
        CommonConstants.normalizedBooleanTrue = "true";
        CommonConstants.normalizedBooleanFalse = "false";
        CommonConstants.spaceSign = "%20";
        // Area Decorator
        CommonConstants.selectedElementCssClass = "selectedElement";
        CommonConstants.decoratedAreaMarkerCssClass = "decoratedAreaMarker";
        CommonConstants.decoratedAreaHeaderCssClass = "decoratedAreaHeader";
        CommonConstants.decoratedAreaTitleCssClass = "decoratedAreaTitle";
        CommonConstants.decoratedAreaButtonDivCssClass = "decoratedAreaButtonDiv";
        CommonConstants.decoratedAreaButtonCssClass = "decoratedAreaButton";
        CommonConstants.decoratedAreaIconDeleteCssClass = "decoratedAreaIconDelete";
        CommonConstants.decoratedAreaIconReturnCssClass = "decoratedAreaIconReturn";
        CommonConstants.decoratedAreaIconMoveCssClass = "decoratedAreaIconMove";
        CommonConstants.decoratedAreaButtonInvertedCssClass = "decoratedAreaButtonInverted";
        CommonConstants.decoratedAreaAbTestingButtonCssClass = "decoratedAreaAbTestingButton";
        CommonConstants.AbTestingButtonData = "AbTestingButtonData";
        CommonConstants.decoratedAreaAbTestingButtonInvertedCssClass = "decoratedAreaAbTestingButtonInverted";
        CommonConstants.decoratedAreaHeaderHeight = "30px";
        // A/B Testing
        CommonConstants.abTestingConfiguration = "abTestingConfiguration";
        CommonConstants.deletedBodyTestIds = "deletedBodyTestIds";
        // Email templates
        CommonConstants.emailTemplateId = "emailTemplateId";
        // Email content language
        CommonConstants.emailContentLanguageLocaleId = "emailContentLanguageLocaleId";
        CommonConstants.emailDefaultContentLanguageLocaleId = 1033;
        // Email contents
        CommonConstants.emailPreheaderValue = "preheaderValue";
        CommonConstants.emailSubjectValue = "subjectValue";
        CommonConstants.emailFromNameValue = "fromNameValue";
        CommonConstants.emailFromEmailValue = "fromEmailValue";
        CommonConstants.emailToValue = "toValue";
        CommonConstants.emailReplyToEmailValue = "replyToEmailValue";
        CommonConstants.emailBodyToolType = "EmailBody";
        CommonConstants.formBodyToolType = "FormBody";
        CommonConstants.dividerWrapper = "dividerWrapper";
        CommonConstants.resizableWrapper = "ui-wrapper";
        CommonConstants.resizable = "ui-resizable";
        CommonConstants.resizableHandleClass = "ui-resizable-handle";
        CommonConstants.allHandles = "n, e, s, w, ne, se, sw, nw";
        CommonConstants.eastWestHandle = "e, w";
        // Zero State - Email Editor
        CommonConstants.zeroStateContainerClass = "zero-state-container";
        CommonConstants.zeroStateImgContainerClass = "zero-state-img-container";
        // Inline Fix
        CommonConstants.decorativeLabel = "[Decorative]";
        return CommonConstants;
    }());
    Editor.CommonConstants = CommonConstants;
    var BlockType;
    (function (BlockType) {
        BlockType[BlockType["Image"] = 0] = "Image";
        BlockType[BlockType["ContentBlock"] = 1] = "ContentBlock";
        BlockType[BlockType["Button"] = 2] = "Button";
        BlockType[BlockType["Video"] = 3] = "Video";
    })(BlockType = Editor.BlockType || (Editor.BlockType = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var AccessibilityInstructionsPopup = /** @class */ (function () {
        function AccessibilityInstructionsPopup(logger) {
            this.logger = logger;
            this.popup = new Editor.PopupRenderer();
            this.popup.setup(new MktSvc.Controls.Common.EventBroker(this.logger));
        }
        AccessibilityInstructionsPopup.prototype.show = function (lastFocusedlement) {
            if ($("." + Editor.CommonConstants.accessibilityPopupClassName).length > 0) {
                return;
            }
            if (!AccessibilityInstructionsPopup.accessibilityInstructions) {
                AccessibilityInstructionsPopup.accessibilityInstructions =
                    Editor.EditorAccessibilityInstructions.baseControlAccessibilityInstructions;
            }
            var containerId = this.popup.render(Editor.CommonUtils.getLocalizedString("[Accessibility Instructions]"), function () {
                return true;
            }, function () { return lastFocusedlement && lastFocusedlement.focus && lastFocusedlement.focus(); }, false, Editor.CommonConstants.accessibilityPopupClassName, "500px", "250px");
            this.render().appendTo("#" + containerId);
        };
        AccessibilityInstructionsPopup.prototype.render = function () {
            var legend = $("<div>")
                .attr("role", Editor.AriaRoleConstants.document)
                .attr("tabindex", "0")
                .addClass(Editor.CommonConstants.accessibilityLegendClassName);
            var dialogData = AccessibilityInstructionsPopup.accessibilityInstructions;
            var _loop_1 = function (sectionName) {
                // tslint:disable-line
                var localizedSectionName = Editor.CommonUtils.getLocalizedString(sectionName);
                $("<h1>")
                    .text(localizedSectionName)
                    .addClass(Editor.CommonConstants.accessibilityLegendSectionLabelClassName)
                    .appendTo(legend);
                var sectionElement = $("<dl>")
                    .addClass(Editor.CommonConstants.accessibilityLegendSectionClassName)
                    .appendTo(legend);
                // Create elements inside section
                dialogData[sectionName].forEach(function (instructionElement) {
                    var elementCaption = $("<dt>")
                        .addClass(Editor.CommonConstants.accessibilityLegendSectionElementCaptionClassName)
                        .text(Editor.CommonUtils.getLocalizedString(instructionElement.caption));
                    var shortcutLabel = instructionElement.keyboardShortcut
                        ? Editor.CommonUtils.getLocalizedString("Press") + " " + instructionElement.keyboardShortcut + " "
                        : String.Empty;
                    var elementDescription = $("<dd>")
                        .addClass(Editor.CommonConstants.accessibilityLegendSectionElementClassName)
                        .text(shortcutLabel +
                        (instructionElement.description
                            ? Editor.CommonUtils.getLocalizedString(instructionElement.description)
                            : String.Empty));
                    sectionElement.append(elementCaption).append(elementDescription);
                });
            };
            for (var sectionName in dialogData) {
                _loop_1(sectionName);
            }
            return legend;
        };
        AccessibilityInstructionsPopup.prototype.dispose = function () {
            this.popup.dispose();
        };
        return AccessibilityInstructionsPopup;
    }());
    Editor.AccessibilityInstructionsPopup = AccessibilityInstructionsPopup;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var EditorAccessibilityInstructions;
    (function (EditorAccessibilityInstructions) {
        EditorAccessibilityInstructions.baseControlAccessibilityInstructions = {
            "General actions": [
                {
                    caption: "[Toggle Full Screen View]",
                    keyboardShortcut: "Alt+F11"
                }
            ],
            "Tab Navigation": [
                {
                    caption: "[Navigate to Menu bar]",
                    keyboardShortcut: "Alt+Ctrl+0"
                },
                {
                    caption: "[Navigate to Designer Editor]",
                    keyboardShortcut: "Alt+1"
                },
                {
                    caption: "[Navigate to HTML Editor]",
                    keyboardShortcut: "Alt+2"
                },
                {
                    caption: "[Navigate to Preview View]",
                    keyboardShortcut: "Alt+3"
                }
            ]
        };
        EditorAccessibilityInstructions.baseFullPageAccessibilityInstructions = $.extend({}, EditorAccessibilityInstructions.baseControlAccessibilityInstructions, {
            "General Editor Commands": [
                {
                    caption: "[Editor Toolbar]",
                    description: "Press Alt+F10 to navigate to the toolbar"
                },
                {
                    caption: "[Editor Dialog]",
                    description: "Press Tab to navigate to the next dialog element, press Shift+Tab to move to the previous dialog element"
                },
                {
                    caption: "[Editor List Box]",
                    description: "Inside a list-box, move to next list item with Tab OR Down Arrow"
                }
            ],
            "Base Commands": [
                // tslint:disable-line
                {
                    caption: "[Undo command]",
                    keyboardShortcut: "Ctrl+Z"
                },
                {
                    caption: "[Redo command]",
                    keyboardShortcut: "Shift+Ctrl+Z"
                },
                {
                    caption: "[Bold command]",
                    keyboardShortcut: "Ctrl+B"
                },
                {
                    caption: "[Italic command]",
                    keyboardShortcut: "Ctrl+I"
                },
                {
                    caption: "[Underline command]",
                    keyboardShortcut: "Ctrl+U"
                },
                {
                    caption: "[Accessibility Help]",
                    keyboardShortcut: "Alt+0"
                },
                {
                    caption: "[Cancel operation]",
                    keyboardShortcut: "ESC"
                }
            ]
        });
        EditorAccessibilityInstructions.baseDesignerAccessibilityInstructions = $.extend({}, EditorAccessibilityInstructions.baseFullPageAccessibilityInstructions, {
            "Designer Commands": [
                {
                    caption: "[Move Block]",
                    keyboardShortcut: "Alt+M"
                },
                {
                    caption: "[Clone Block]",
                    keyboardShortcut: "Alt+Shift+C"
                },
                {
                    caption: "[Delete Block]",
                    keyboardShortcut: "Alt+Shift+D"
                },
                {
                    caption: "[Focus back to the designer block]",
                    keyboardShortcut: "Alt+X"
                }
            ],
            "Designer Tab Navigation": [
                {
                    caption: "[Navigate to Toolbox view]",
                    keyboardShortcut: "Alt+4"
                },
                {
                    caption: "[Navigate to Properties View]",
                    keyboardShortcut: "Alt+5"
                },
                {
                    caption: "[Navigate to Styles View]",
                    keyboardShortcut: "Alt+6"
                }
            ]
        });
        EditorAccessibilityInstructions.basePreviewAccessibilityInstructions = $.extend({}, EditorAccessibilityInstructions.baseControlAccessibilityInstructions, {
            "Basic Preview Navigation": [
                {
                    caption: "[Navigate to Browser Preview View]",
                    keyboardShortcut: "Alt+B"
                },
                {
                    caption: "[Navigate to Desktop Preview]",
                    keyboardShortcut: "Alt+Ctrl+1"
                },
                {
                    caption: "[Navigate to Tablet Portrait Preview]",
                    keyboardShortcut: "Alt+Ctrl+2"
                },
                {
                    caption: "[Navigate to Tablet Landscape Preview]",
                    keyboardShortcut: "Alt+Ctrl+3"
                },
                {
                    caption: "[Navigate to Mobile Portrait Preview]",
                    keyboardShortcut: "Alt+Ctrl+4"
                },
                {
                    caption: "[Navigate to Mobile Landscape Preview]",
                    keyboardShortcut: "Alt+Ctrl+5"
                }
            ]
        });
    })(EditorAccessibilityInstructions = Editor.EditorAccessibilityInstructions || (Editor.EditorAccessibilityInstructions = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
var Editor;
(function (Editor) {
    var AriaAttributeNames = /** @class */ (function () {
        function AriaAttributeNames() {
        }
        AriaAttributeNames.describedBy = "aria-describedby";
        AriaAttributeNames.hasPopup = "aria-haspopup";
        AriaAttributeNames.ariaExpanded = "aria-expanded";
        AriaAttributeNames.role = "role";
        AriaAttributeNames.ariaLabelledby = "aria-labelledby";
        return AriaAttributeNames;
    }());
    Editor.AriaAttributeNames = AriaAttributeNames;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * Class responsible for setting up the droppable functionality for the layout/containers - sections/blocks can be dropped into the containers
     */
    var DroppableController = /** @class */ (function () {
        function DroppableController(eventBroker, selectionStateModel, selectedAreaDecorator, logger, enableZeroState, fcbList) {
            this.eventBroker = eventBroker;
            this.selectionStateModel = selectionStateModel;
            this.selectedAreaDecorator = selectedAreaDecorator;
            this.logger = logger;
            this.enableZeroState = enableZeroState;
            this.fcbList = fcbList;
            this.isSupportedDragObject = false;
            this.mousePositionDifference = 5;
            this.editorFeatureServiceClient = Editor.EditorFeatureServiceClient.instance;
        }
        DroppableController.prototype.getName = function () {
            return "DroppableController";
        };
        DroppableController.prototype.setupContainers = function (containers) {
            var _this = this;
            var dragendHandler = function (elements) {
                _this.restoreEditableContentBlocks(elements);
                _this.cleanupUIHints(elements);
            };
            var dragoverHandler = function (event) {
                _this.addSortableHighlightMarker(event);
            };
            var dropHandler = function (event) {
                Editor.CkEditorTelemetryUtils.sendControllerUsageTelemetry(_this.logger, event.type, _this.getName());
                var dragData = event.originalEvent.dataTransfer;
                if (dragData != null) {
                    var element = $(dragData.getData("Text"));
                    var isBlock = Editor.BlockProvider.isBlock($(element));
                    if (isBlock && _this.lastEventType === Editor.ToolCategory.Content) {
                        _this.replaceSortableHighlightMarkerWithBlock(event, dragData);
                    }
                }
            };
            this.setup(containers, dragendHandler, dragoverHandler, dropHandler);
            this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerDragStart, (this.onDesignerDragStart = function () {
                _this.isSupportedDragObject = true;
                _this.lastEventType = Editor.ToolCategory.Content;
            }));
            this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerDragEnd, (this.onDesignerDragEnd = function () {
                setTimeout(function () { this.isSupportedDragObject = false; }, 1000);
            }));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        DroppableController.prototype.setupLayout = function (layout) {
            var _this = this;
            var dragendHandler = function (elements) {
                _this.cleanupUISectionHints(elements);
            };
            var dragenterHandler = function (event) {
                _this.addSortableHighlightMarkerForSection(event);
            };
            var dropHandler = function (event) {
                var dragData = event.originalEvent.dataTransfer;
                if (dragData != null) {
                    var element = $(dragData.getData("Text"));
                    var isBlock = Editor.BlockProvider.isBlock($(element));
                    if (!isBlock && _this.lastEventType === Editor.ToolCategory.Layout) {
                        _this.replaceSortableHighlightMarkerWithSection(event, dragData);
                    }
                }
            };
            this.setup(layout, dragendHandler, dragenterHandler, dropHandler);
            this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerDragSectionStart, (this.onDesignerDragSectionStart = function () {
                _this.isSupportedDragObject = true;
                _this.lastEventType = Editor.ToolCategory.Layout;
            }));
            this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerDragSectionEnd, (this.onDesignerDragSectionEnd = function () {
                setTimeout(function () { this.isSupportedDragObject = false; }, 1000);
                if (_this.enableZeroState) {
                    _this.setupZeroState(layout);
                }
            }));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        DroppableController.prototype.setupZeroState = function (elements) {
            var _this = this;
            var elementsCollection = elements.get();
            var frameBody = $(elementsCollection).closest("body");
            var dataLayout = frameBody.find("[" + Editor.Contract.dataLayoutAttrName + "=\"true\"]");
            var isLayout = Editor.CommonUtils.isLayout(dataLayout);
            if (!isLayout) {
                return;
            }
            var dataLayoutContents = dataLayout.contents();
            var hasZeroState = frameBody.find("." + Editor.CommonConstants.zeroStateContainerClass);
            if (!hasZeroState.length) {
                var zeroStateContainer = $(document.createElement("div"));
                zeroStateContainer.addClass(Editor.CommonConstants.zeroStateContainerClass);
                var zeroStateImageContainer = $(document.createElement("div"));
                zeroStateImageContainer.addClass(Editor.CommonConstants.zeroStateImgContainerClass);
                var zeroStateImg = $(document.createElement("img"));
                var img = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgo8ZyBpZD0iRW1wdHlTdGF0ZV9EMzY1X2ZsYXQzIj4KPHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IndoaXRlIi8+CjxnIGlkPSJDcmVhdGVfRW1wdHlTdGF0ZV9EMzY1Ij4KPHBhdGggaWQ9IlZlY3RvciIgZD0iTTEwMCAyMDBDMTU1LjIyOCAyMDAgMjAwIDE1NS4yMjggMjAwIDEwMEMyMDAgNDQuNzcxNSAxNTUuMjI4IDAgMTAwIDBDNDQuNzcxNSAwIDAgNDQuNzcxNSAwIDEwMEMwIDE1NS4yMjggNDQuNzcxNSAyMDAgMTAwIDIwMFoiIGZpbGw9IiMyMjY2RTMiLz4KPHBhdGggaWQ9IlZlY3Rvcl8yIiBkPSJNODQgMjUuMjA2OUM4OS4zNjgyIDI2LjA3MTMgOTMuNTc1NiAzMC4xNzYyIDk0LjQ2MTUgMzUuNDEzOEM5NS4zNDc1IDMwLjE3NjIgOTkuNTU0OCAyNi4wNzEzIDEwNC45MjMgMjUuMjA2OUM5OS41NTQ4IDI0LjM0MjUgOTUuMzQ3NSAyMC4yMzc2IDk0LjQ2MTUgMTVDOTMuNTc1NiAyMC4yMzc2IDg5LjM2ODIgMjQuMzQyNSA4NCAyNS4yMDY5WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggaWQ9IlZlY3Rvcl8zIiBkPSJNMjYuMDc2OSA4OS4zNzkzQzIyLjcyMTggODguODM5MSAyMC4wOTIyIDg2LjI3MzUgMTkuNTM4NCA4M0MxOC45ODQ3IDg2LjI3MzUgMTYuMzU1MSA4OC44MzkxIDEzIDg5LjM3OTNDMTYuMzU1MSA4OS45MTk2IDE4Ljk4NDcgOTIuNDg1MiAxOS41Mzg0IDk1Ljc1ODZDMjAuMDkyMiA5Mi40ODUyIDIyLjcyMTggODkuOTE5NiAyNi4wNzY5IDg5LjM3OTNaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBpZD0iVmVjdG9yXzQiIGQ9Ik0zOS4wNzY5IDEwNi4zNzlDMzUuNzIxOCAxMDUuODM5IDMzLjA5MjIgMTAzLjI3MyAzMi41Mzg0IDEwMEMzMS45ODQ3IDEwMy4yNzMgMjkuMzU1MSAxMDUuODM5IDI2IDEwNi4zNzlDMjkuMzU1MSAxMDYuOTE5IDMxLjk4NDcgMTA5LjQ4NSAzMi41Mzg0IDExMi43NTlDMzMuMDkyMiAxMDkuNDg1IDM1LjcyMTggMTA2LjkxOSAzOS4wNzY5IDEwNi4zNzlaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBpZD0iVmVjdG9yXzUiIGQ9Ik05NC4wNzY5IDE3NC4zNzlDOTAuNzIxOCAxNzMuODM5IDg4LjA5MjIgMTcxLjI3MyA4Ny41Mzg0IDE2OEM4Ni45ODQ3IDE3MS4yNzMgODQuMzU1MSAxNzMuODM5IDgxIDE3NC4zNzlDODQuMzU1MSAxNzQuOTE5IDg2Ljk4NDcgMTc3LjQ4NSA4Ny41Mzg0IDE4MC43NTlDODguMDkyMiAxNzcuNDg1IDkwLjcyMTggMTc0LjkxOSA5NC4wNzY5IDE3NC4zNzlaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBpZD0iVmVjdG9yXzYiIGQ9Ik0xODAuMDc3IDkwLjM3OTNDMTc2LjcyMiA4OS44MzkxIDE3NC4wOTIgODcuMjczNSAxNzMuNTM4IDg0QzE3Mi45ODUgODcuMjczNSAxNzAuMzU1IDg5LjgzOTEgMTY3IDkwLjM3OTNDMTcwLjM1NSA5MC45MTk2IDE3Mi45ODUgOTMuNDg1MiAxNzMuNTM4IDk2Ljc1ODZDMTc0LjA5MiA5My40ODUyIDE3Ni43MjIgOTAuOTE5NiAxODAuMDc3IDkwLjM3OTNaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBpZD0iVmVjdG9yXzciIGQ9Ik0xMjMuMDc3IDE4LjM3OTNDMTE5LjcyMiAxNy44MzkxIDExNy4wOTIgMTUuMjczNSAxMTYuNTM4IDEyQzExNS45ODUgMTUuMjczNSAxMTMuMzU1IDE3LjgzOTEgMTEwIDE4LjM3OTNDMTEzLjM1NSAxOC45MTk2IDExNS45ODUgMjEuNDg1MiAxMTYuNTM4IDI0Ljc1ODZDMTE3LjA5MiAyMS40ODUyIDExOS43MjIgMTguOTE5NiAxMjMuMDc3IDE4LjM3OTNaIiBmaWxsPSJ3aGl0ZSIvPgo8ZyBpZD0iR3JvdXAiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTptdWx0aXBseSIgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZGQpIj4KPGcgaWQ9IlZlY3Rvcl84IiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiPgo8cGF0aCBkPSJNMTMwIDQ5SDQ5VjEzMEgxMzBWNDlaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjwvZz4KPGcgaWQ9Ikdyb3VwXzIiPgo8cGF0aCBpZD0iVmVjdG9yXzkiIGQ9Ik0xMzAgNDlINDlWMTMwSDEzMFY0OVoiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcikiLz4KPC9nPgo8ZyBpZD0iVmVjdG9yXzEwIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6aGFyZC1saWdodCI+CjxwYXRoIGQ9Ik0xMzAgNDlINDlWMTMwSDEzMFY0OVoiIGZpbGw9InVybCgjcGF0dGVybjApIiBmaWxsLW9wYWNpdHk9IjAuMDIiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpoYXJkLWxpZ2h0Ii8+CjxwYXRoIGQ9Ik0xMzAgNDlINDlWMTMwSDEzMFY0OVoiIGZpbGw9InVybCgjcGF0dGVybjEpIiBmaWxsLW9wYWNpdHk9IjAuMDIiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpoYXJkLWxpZ2h0Ii8+CjwvZz4KPGcgaWQ9Ikdyb3VwXzMiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTptdWx0aXBseSIgZmlsdGVyPSJ1cmwoI2ZpbHRlcjFfZGQpIj4KPGcgaWQ9IlZlY3Rvcl8xMSIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOm11bHRpcGx5Ij4KPHBhdGggZD0iTTE0MCA1OUg1OVYxNDBIMTQwVjU5WiIgZmlsbD0id2hpdGUiLz4KPC9nPgo8L2c+CjxnIGlkPSJHcm91cF80Ij4KPHBhdGggaWQ9IlZlY3Rvcl8xMiIgZD0iTTE0MCA1OUg1OVYxNDBIMTQwVjU5WiIgZmlsbD0idXJsKCNwYWludDFfbGluZWFyKSIvPgo8L2c+CjxnIGlkPSJWZWN0b3JfMTMiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpoYXJkLWxpZ2h0Ij4KPHBhdGggZD0iTTE0MCA1OUg1OVYxNDBIMTQwVjU5WiIgZmlsbD0idXJsKCNwYXR0ZXJuMikiIGZpbGwtb3BhY2l0eT0iMC4wMiIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOmhhcmQtbGlnaHQiLz4KPHBhdGggZD0iTTE0MCA1OUg1OVYxNDBIMTQwVjU5WiIgZmlsbD0idXJsKCNwYXR0ZXJuMykiIGZpbGwtb3BhY2l0eT0iMC4wMiIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOmhhcmQtbGlnaHQiLz4KPC9nPgo8ZyBpZD0iR3JvdXBfNSIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOm11bHRpcGx5IiBmaWx0ZXI9InVybCgjZmlsdGVyMl9kZCkiPgo8ZyBpZD0iVmVjdG9yXzE0IiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiPgo8cGF0aCBkPSJNMTUwIDY5SDY5VjE1MEgxNTBWNjlaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjwvZz4KPGcgaWQ9Ikdyb3VwXzYiPgo8cGF0aCBpZD0iVmVjdG9yXzE1IiBkPSJNMTUwIDY5SDY5VjE1MEgxNTBWNjlaIiBmaWxsPSJ1cmwoI3BhaW50Ml9saW5lYXIpIi8+CjwvZz4KPGcgaWQ9IlZlY3Rvcl8xNiIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOmhhcmQtbGlnaHQiPgo8cGF0aCBkPSJNMTUwIDY5SDY5VjE1MEgxNTBWNjlaIiBmaWxsPSJ1cmwoI3BhdHRlcm40KSIgZmlsbC1vcGFjaXR5PSIwLjAyIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6aGFyZC1saWdodCIvPgo8cGF0aCBkPSJNMTUwIDY5SDY5VjE1MEgxNTBWNjlaIiBmaWxsPSJ1cmwoI3BhdHRlcm41KSIgZmlsbC1vcGFjaXR5PSIwLjAyIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6aGFyZC1saWdodCIvPgo8L2c+CjxnIGlkPSJHcm91cF83IiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bXVsdGlwbHkiIGZpbHRlcj0idXJsKCNmaWx0ZXIzX2RkKSI+CjxnIGlkPSJWZWN0b3JfMTciIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTptdWx0aXBseSI+CjxwYXRoIGQ9Ik0xNDAgMTY2QzE1NC4zNTkgMTY2IDE2NiAxNTQuMzU5IDE2NiAxNDBDMTY2IDEyNS42NDEgMTU0LjM1OSAxMTQgMTQwIDExNEMxMjUuNjQxIDExNCAxMTQgMTI1LjY0MSAxMTQgMTQwQzExNCAxNTQuMzU5IDEyNS42NDEgMTY2IDE0MCAxNjZaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjwvZz4KPGcgaWQ9Ikdyb3VwXzgiPgo8cGF0aCBpZD0iVmVjdG9yXzE4IiBkPSJNMTQwIDE2NkMxNTQuMzU5IDE2NiAxNjYgMTU0LjM1OSAxNjYgMTQwQzE2NiAxMjUuNjQxIDE1NC4zNTkgMTE0IDE0MCAxMTRDMTI1LjY0MSAxMTQgMTE0IDEyNS42NDEgMTE0IDE0MEMxMTQgMTU0LjM1OSAxMjUuNjQxIDE2NiAxNDAgMTY2WiIgZmlsbD0idXJsKCNwYWludDNfbGluZWFyKSIvPgo8L2c+CjxnIGlkPSJWZWN0b3JfMTkiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpoYXJkLWxpZ2h0Ij4KPHBhdGggZD0iTTE0MCAxNjZDMTU0LjM1OSAxNjYgMTY2IDE1NC4zNTkgMTY2IDE0MEMxNjYgMTI1LjY0MSAxNTQuMzU5IDExNCAxNDAgMTE0QzEyNS42NDEgMTE0IDExNCAxMjUuNjQxIDExNCAxNDBDMTE0IDE1NC4zNTkgMTI1LjY0MSAxNjYgMTQwIDE2NloiIGZpbGw9InVybCgjcGF0dGVybjYpIiBmaWxsLW9wYWNpdHk9IjAuMDIiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpoYXJkLWxpZ2h0Ii8+CjxwYXRoIGQ9Ik0xNDAgMTY2QzE1NC4zNTkgMTY2IDE2NiAxNTQuMzU5IDE2NiAxNDBDMTY2IDEyNS42NDEgMTU0LjM1OSAxMTQgMTQwIDExNEMxMjUuNjQxIDExNCAxMTQgMTI1LjY0MSAxMTQgMTQwQzExNCAxNTQuMzU5IDEyNS42NDEgMTY2IDE0MCAxNjZaIiBmaWxsPSJ1cmwoI3BhdHRlcm43KSIgZmlsbC1vcGFjaXR5PSIwLjAyIiBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6aGFyZC1saWdodCIvPgo8L2c+CjxwYXRoIGlkPSJWZWN0b3JfMjAiIGQ9Ik0xNDAgMTI2VjE1NCIgc3Ryb2tlPSIjMjI2NkUzIiBzdHJva2Utd2lkdGg9IjQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8cGF0aCBpZD0iVmVjdG9yXzIxIiBkPSJNMTU0IDE0MEgxMjYiIHN0cm9rZT0iIzIyNjZFMyIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9nPgo8L2c+CjxkZWZzPgo8ZmlsdGVyIGlkPSJmaWx0ZXIwX2RkIiB4PSI0MSIgeT0iNDIiIHdpZHRoPSI5NyIgaGVpZ2h0PSI5NyIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiPgo8ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPgo8ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPgo8ZmVPZmZzZXQgZHk9IjEiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNCIvPgo8ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwLjA3NDUwOTggMCAwIDAgMCAwLjIxOTYwOCAwIDAgMCAwIDAuNDg2Mjc1IDAgMCAwIDAuMiAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIi8+CjxmZU9mZnNldCBkeT0iMyIvPgo8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIyIi8+CjxmZUNvbG9yTWF0cml4IHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAuMDc0NTA5OCAwIDAgMCAwIDAuMjE5NjA4IDAgMCAwIDAgMC40ODYyNzUgMCAwIDAgMC4xNCAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJlZmZlY3QxX2Ryb3BTaGFkb3ciIHJlc3VsdD0iZWZmZWN0Ml9kcm9wU2hhZG93Ii8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0Ml9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+CjwvZmlsdGVyPgo8cGF0dGVybiBpZD0icGF0dGVybjAiIHBhdHRlcm5Db250ZW50VW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiB3aWR0aD0iMSIgaGVpZ2h0PSIxIj4KPHVzZSB4bGluazpocmVmPSIjaW1hZ2UwIiB0cmFuc2Zvcm09InNjYWxlKDAuMDE2NjY2NykiLz4KPC9wYXR0ZXJuPgo8cGF0dGVybiBpZD0icGF0dGVybjEiIHBhdHRlcm5Db250ZW50VW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiB3aWR0aD0iMSIgaGVpZ2h0PSIxIj4KPHVzZSB4bGluazpocmVmPSIjaW1hZ2UwIiB0cmFuc2Zvcm09InNjYWxlKDAuMDE2NjY2NykiLz4KPC9wYXR0ZXJuPgo8ZmlsdGVyIGlkPSJmaWx0ZXIxX2RkIiB4PSI1MSIgeT0iNTIiIHdpZHRoPSI5NyIgaGVpZ2h0PSI5NyIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiPgo8ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPgo8ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPgo8ZmVPZmZzZXQgZHk9IjEiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNCIvPgo8ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwLjA3NDUwOTggMCAwIDAgMCAwLjIxOTYwOCAwIDAgMCAwIDAuNDg2Mjc1IDAgMCAwIDAuMiAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIi8+CjxmZU9mZnNldCBkeT0iMyIvPgo8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIyIi8+CjxmZUNvbG9yTWF0cml4IHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAuMDc0NTA5OCAwIDAgMCAwIDAuMjE5NjA4IDAgMCAwIDAgMC40ODYyNzUgMCAwIDAgMC4xNCAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJlZmZlY3QxX2Ryb3BTaGFkb3ciIHJlc3VsdD0iZWZmZWN0Ml9kcm9wU2hhZG93Ii8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0Ml9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+CjwvZmlsdGVyPgo8cGF0dGVybiBpZD0icGF0dGVybjIiIHBhdHRlcm5Db250ZW50VW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiB3aWR0aD0iMSIgaGVpZ2h0PSIxIj4KPHVzZSB4bGluazpocmVmPSIjaW1hZ2UwIiB0cmFuc2Zvcm09InNjYWxlKDAuMDE2NjY2NykiLz4KPC9wYXR0ZXJuPgo8cGF0dGVybiBpZD0icGF0dGVybjMiIHBhdHRlcm5Db250ZW50VW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiB3aWR0aD0iMSIgaGVpZ2h0PSIxIj4KPHVzZSB4bGluazpocmVmPSIjaW1hZ2UwIiB0cmFuc2Zvcm09InNjYWxlKDAuMDE2NjY2NykiLz4KPC9wYXR0ZXJuPgo8ZmlsdGVyIGlkPSJmaWx0ZXIyX2RkIiB4PSI2MSIgeT0iNjIiIHdpZHRoPSI5NyIgaGVpZ2h0PSI5NyIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiPgo8ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPgo8ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPgo8ZmVPZmZzZXQgZHk9IjEiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNCIvPgo8ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwLjA3NDUwOTggMCAwIDAgMCAwLjIxOTYwOCAwIDAgMCAwIDAuNDg2Mjc1IDAgMCAwIDAuMiAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIi8+CjxmZU9mZnNldCBkeT0iMyIvPgo8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIyIi8+CjxmZUNvbG9yTWF0cml4IHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAuMDc0NTA5OCAwIDAgMCAwIDAuMjE5NjA4IDAgMCAwIDAgMC40ODYyNzUgMCAwIDAgMC4xNCAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJlZmZlY3QxX2Ryb3BTaGFkb3ciIHJlc3VsdD0iZWZmZWN0Ml9kcm9wU2hhZG93Ii8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0Ml9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+CjwvZmlsdGVyPgo8cGF0dGVybiBpZD0icGF0dGVybjQiIHBhdHRlcm5Db250ZW50VW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiB3aWR0aD0iMSIgaGVpZ2h0PSIxIj4KPHVzZSB4bGluazpocmVmPSIjaW1hZ2UwIiB0cmFuc2Zvcm09InNjYWxlKDAuMDE2NjY2NykiLz4KPC9wYXR0ZXJuPgo8cGF0dGVybiBpZD0icGF0dGVybjUiIHBhdHRlcm5Db250ZW50VW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiB3aWR0aD0iMSIgaGVpZ2h0PSIxIj4KPHVzZSB4bGluazpocmVmPSIjaW1hZ2UwIiB0cmFuc2Zvcm09InNjYWxlKDAuMDE2NjY2NykiLz4KPC9wYXR0ZXJuPgo8ZmlsdGVyIGlkPSJmaWx0ZXIzX2RkIiB4PSIxMDYiIHk9IjEwNyIgd2lkdGg9IjY4IiBoZWlnaHQ9IjY4IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIi8+CjxmZU9mZnNldCBkeT0iMSIvPgo8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI0Ii8+CjxmZUNvbG9yTWF0cml4IHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAuMDc0NTA5OCAwIDAgMCAwIDAuMjE5NjA4IDAgMCAwIDAgMC40ODYyNzUgMCAwIDAgMC4yIDAiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbjI9IkJhY2tncm91bmRJbWFnZUZpeCIgcmVzdWx0PSJlZmZlY3QxX2Ryb3BTaGFkb3ciLz4KPGZlQ29sb3JNYXRyaXggaW49IlNvdXJjZUFscGhhIiB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMTI3IDAiLz4KPGZlT2Zmc2V0IGR5PSIzIi8+CjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjIiLz4KPGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMC4wNzQ1MDk4IDAgMCAwIDAgMC4yMTk2MDggMCAwIDAgMCAwLjQ4NjI3NSAwIDAgMCAwLjE0IDAiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvdyIgcmVzdWx0PSJlZmZlY3QyX2Ryb3BTaGFkb3ciLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJlZmZlY3QyX2Ryb3BTaGFkb3ciIHJlc3VsdD0ic2hhcGUiLz4KPC9maWx0ZXI+CjxwYXR0ZXJuIGlkPSJwYXR0ZXJuNiIgcGF0dGVybkNvbnRlbnRVbml0cz0ib2JqZWN0Qm91bmRpbmdCb3giIHdpZHRoPSIxIiBoZWlnaHQ9IjEiPgo8dXNlIHhsaW5rOmhyZWY9IiNpbWFnZTAiIHRyYW5zZm9ybT0ic2NhbGUoMC4wMTY2NjY3KSIvPgo8L3BhdHRlcm4+CjxwYXR0ZXJuIGlkPSJwYXR0ZXJuNyIgcGF0dGVybkNvbnRlbnRVbml0cz0ib2JqZWN0Qm91bmRpbmdCb3giIHdpZHRoPSIxIiBoZWlnaHQ9IjEiPgo8dXNlIHhsaW5rOmhyZWY9IiNpbWFnZTAiIHRyYW5zZm9ybT0ic2NhbGUoMC4wMTY2NjY3KSIvPgo8L3BhdHRlcm4+CjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQwX2xpbmVhciIgeDE9Ijg5LjUiIHkxPSIxMzAiIHgyPSI4OS41IiB5Mj0iNDkiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0id2hpdGUiIHN0b3Atb3BhY2l0eT0iMC41Ii8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0id2hpdGUiLz4KPC9saW5lYXJHcmFkaWVudD4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDFfbGluZWFyIiB4MT0iOTkuNSIgeTE9IjE0MCIgeDI9Ijk5LjUiIHkyPSI1OSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSJ3aGl0ZSIgc3RvcC1vcGFjaXR5PSIwLjUiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSJ3aGl0ZSIvPgo8L2xpbmVhckdyYWRpZW50Pgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50Ml9saW5lYXIiIHgxPSIxMDkuNSIgeTE9IjE1MCIgeDI9IjEwOS41IiB5Mj0iNjkiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0id2hpdGUiIHN0b3Atb3BhY2l0eT0iMC41Ii8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0id2hpdGUiLz4KPC9saW5lYXJHcmFkaWVudD4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDNfbGluZWFyIiB4MT0iMTQwIiB5MT0iMTY2IiB4Mj0iMTQwIiB5Mj0iMTE0IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IndoaXRlIiBzdG9wLW9wYWNpdHk9IjAuNSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IndoaXRlIi8+CjwvbGluZWFyR3JhZGllbnQ+CjxpbWFnZSBpZD0iaW1hZ2UwIiB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBRHdBQUFBOENBWUFBQUE2L05seUFBQU05RWxFUVZSb1ErV2JTNmlPM1J2RzF6di9IQ2NiaVJoUjJtSkVTbEpiakJ3bUd3T0gwbGFVSEFhRUpMWEZ3Q0cxRlJPSGdjUEVZYlJGU2FKdFJLUVl5Q2x0VEJ4aS92NzdyYy92K2U1M2VmaWMrZm8vazczMyt6N1BldGE2Nyt1Kzd1dSsxOXFObEZLejJXd21yL2Z2MzZlLy92b3JOUnFOMU5iV2xsNjhlSkZXcmx5WkRoMDZsRy9oODU2ZW5yUnExYXAwLy83OU5INzhlQWJJbjNkMWRlWDcrSHpjdUhINXVTRkRocVJkdTNhbGhRc1hwa0dEQnFYRGh3L25jWHpHOTI3Y3VESGZWMTZNeTcwN2QrNU1XN1pzeWI5em5UeDVNaTFhdENpUGUvcjA2V284eHpsNDhHQmF2WHAxeTNEdDdlMnB3V3A1Nk5TcFUzblNYRXo4eG8wYnFiT3pNMjNldkRsTm5EZ3hMMlRxMUttMWsrM3U3azdMbHk5UFQ1NDhTVy9ldkVrUEh6N01CdEZBZFF1OGQrOWVOc3F3WWNPeVViMllDOS9kdVhPbmV0ZUZDeGZTM3IxNzA4V0xGejhhMCtlWUk4OWdFTzUvL2ZwMXVuTGxTbHEzYmwzbEZOYkVDclBKdVBINTgrZHB4SWdSbFJWbnpacVZYNksxOUxqZVpJQTRNVjU2L2ZyMU5HREFnRHlQam82Ty9MeW9pQmJuZlpzMmJhcTh5ajE5ZlgxcHlwUXBHUmtnUVJSRUJPcWNpQjRkVmFLRDUwUmhiMjl2ZGtTMVlMeUpsN0hPNE1HRDArWExsN04zZ2M2UkkwZXFpVHNKNENFQ05JZ1RpeFB3L2hNblRxVEZpeGUzSU1UdldLam8wZmpSYzd0MzcwNnpaOC9PaG92akFGKys4eGtkNUxPRUFXdUlLTXFRamhOODkrNWRPbjc4ZU1aL3RLeXhWT2NWSnd1MGpUUHVaeXk5N1NRY1V6UmhPSXdzc3B4TE5LanZObDQvQ3ZRUENQVnp4K2p2NzAvRGh3OXZDWU5HVDA5UGsvaU0rTWVhV2tVSUFWL2dGaThHQnJZOFN4ejY5OHVYTC9ObmtOdllzV1BUbkRsenN2RXcxczJiTjlPQkF3ZlNqQmt6RXZkSlNCRFA3ZHUzTTE5dzhUdFhKQ1U5VnM1QkQ0TzBKVXVXWk5MbEFzNGdGVDdoM2FBaFF4cFBNQW04RXk5d0QyeVlqR3pNOXl5czlLWUxFbUo0eUVuN1RMekgrT1k3R2RoM0MxdmV2Mnpac3Z3eHhuRmhuK0lheC9rYzErUUYvMm9yOHo1SVovVG8wV255NU1rVkFsaVE2VVlZeDNERHlERHZ2SG56c2lldlhidVduL1V5aEZ5d2lBSnRSNDhlL1pzSE9qbzZtbVBHaktsWWtjQm5FdVJFWHM1MysvZnZ6eS9DeXFRTXlBcnZsZVFVWXlqR1ArR0J4eTlkdXBRaGJBcUpLT0Zka2hxeHQzVHAwZ3g3VUVkb3lDbStNNDR2V2ZFZXc2VFVDRHExeXNQQU5sN2Z3dHBZRzBQOXlhemRhR3RyYTBJNEphVWJkOFpOaEJqVzRuNDhSa3A1OU9oUlRsMklEN3hrL2tOWTRMbEpreVpsRG5Dc0ZzdCsrSVB4WlZYZmhlcUQ1VXVPUVJqaGZSRUJoUFdzT1gvSGpoM3AxcTFibWYzaEF1QU1zaHBkWFYxTllnbm9NTEN5TW5wWWxpWHV0bS9mM3BKQ21LUXBSUWthMHdLTFpUSk9LaElQS2NON0NaV1JJMGZtQlphQ2czc2tRYUQ2K1BIaktpOFRGdVJhV1JqQ08zLytmSXR5akE3S2tNWmJlb2VCbzNwU1V6UHBtRmVqQVBGK0JVUVVJTVpzalBsU29HRGN1WFBuNW5Ed3ZpaFk4Q1llWWc1NlRTYVBqTXd6SU1weFRHT20xb3hhSVUzY1FWYUlDQVlEb3BJTWkxYVVseUplNjV2SGhTYWVOVGZyWFlzT29NWENJSmx0MjdhbHExZXZaby9VaFpFZTVEc0xHM096YVVzR1ZwSnFEQkVMS3JoQVVLTzN0N2VKR0lnNTJMU0JJR0VCd0syTVFWSEJRTWF0OEdTQmE5YXNxY2FNT2RrY2F2RVE0MW1tTGxGbUxFZW9sNGEzNk1DUXpJM1V4ZTk3OXV5cE5FYXVsdHJiMjNQeHdKZktScVNlY2F0VnpaSEN4WHRkSk42Yk9YTm1qbkVHSnE2aXgvZ2RqMURGWUNDSUo1YUtwcXBvQUJkWVIzTFJLSFhQK0N5RzNiZHZYMzRYS00weHpBSVY1OGFYckkzVllXRUtDaVNhTEVqaVZ5Y3pLRVNpQ0hBTUlBYUJSSlhFNUJqNzJMRmorWjFDRy9oajNHZlBudVd4dUN3elpXME5HSE13bnhtamhNaTVjK2R5V01ZRmkwNE1ubU5ZU2llT2dURTVtWlRpQlF4aFZMd0tnV0FwaklRM1daRDFyRjdYV0xFUUlNWWhwMWlzeDVSWHBpeWVGUVZNSGkyUDBRa1Z1Q1ZtQjlEQmZDTHJSL2hqQ01Jc2h5Z2VWcFh3VXBuV3VEV254czRHTDRPVXRDWnc5bUpRdkdiWEl6WVh1QStDQW1KbGRlUUVUWWV4YUdCQkZDNWtFbjd5TjhhbDQySEJFdFdpOHRRQ3lMQWs3bHNhQU45RERpeFVJaUcrNUFWaEtITktpQmI0a1NQd0V1aXh6dVpaNWFJR2pmazh4aTdqWXdBRkVRdzliZHEwS3NYcXpKYmk0VWYwakVBQ3NCVWhwaUk4WVVjamF2QTZ3aEd1b3MxYyt5TlNad1hwc203OG5SVU5SbUJ4OXNWTVY4WjBMQ2E0ajBhaHVpRnlnV1FucHhCbTJjTmZJeXBVVzhiY3Y0a0s0amwyUENOUnhVN2xqeEFWeW1MZWdWR2VQbjJhVlZkczhMVzBlQlFJc1ZCd2dVNnVMTStJTVlwMENuK0wrcy9sVkpRVCtkcTJrTXdkKzFyK3puZ3dNaGUvSzMraitsTDZScUVUMDVha1JqTVJvdnVJdE1wQWp5cEpRckFEU0kwYUN3N2pNWHFmT3BxNDVobCszN3AxYTB1ZnErdzc4VGYzV1FreHBqRk1ha0pCbFhtZGhTQXZ5UnBvaHZpc2kxZk9OdnI2K3BwUXZibTI3RFFZeTd3WVpvMWRReGFCMklDZzRJQzZJajBpZ2dsSFVWQWFLTVpmYkJaR3dlRjR6RU5CUk5qUWY0N2F3V2Y0NlR6aGdMeGdKK0VFekoweGw1YUN3Y2xCR3ZQbno4OHZmUFhxVmU2UUVMT09FU3NXUEdkQlVaYUFzU05aVng2YSszM2V1UktydkErbnZYMzdObGRkcENkSnIxU1JPWVpMQzFvd3g4LzVIUU93cy9BMWlKQlJvNlcvQnhHeEhQd1dSRFE2T3p1YmVNYWdodFVzcG1VN29ZcTM2RzRTUXhxbGJwY0E2RkwyeGZJU09GRzUyRUsxWDRieFJFRmRqOHdRSStUb2N6a21jMU1vbGJrY3RIQk5uejQ5eDNWVVlSVkxsNVVKWkdXbmdvZUJCcERFSUxadG80VWo5VE1SbXZrV0cvRytxS3ljYUN3TytNek9TVXZoL21GVExjWm1XY2J5TitOdjJMQWg4MDFzOGx0ZE5icTd1NXQ0amRpUVZGUkhERzRzbE9tb25BeFF3NnZ1SDFudldnVFFSc0pRRkJFeVAwYkNxTEdKVDNIQ0ZjdkxXQ2hvcEcvZTVTeTNTNyttNVlrVVphRVFoZHFZQ2RtV0hUcDBhTzVrZkdwMzBpN25yOXlkckNBZEMzSVc4ZURCZzV3djNmT044RU1FR0JkQ1JaRWdPb2hSdkVYSkpuS01lNHdxbTR1Y0tHd1VPM1c3RnpGZW1TYzlMdXRxdUljR2c4cU9lNG45czJmUC9wTXlnVFM5clA5eWpVdTR4RnFZaGFyV1ltY0VoWlpaT202R1MxNHhOVVdwNkhZSHJCN2pLSlo5cGlCK29vQ3NuaEFHcXJVeUxna0Q1V0hNd3lWM01LYnppVVdFbW9IN0VTV0lFZVN1WTRGVW1oVXRlVmcyamVuaGQrM1VJNFlzVEdLRFhyMnU0WVI0MmZaaERlaDBMaHhhU2N2Ky92NG0zWWVmVVh0cTNUK3B3cW84TER0L3laWWpDMWl3WUVFNmMrYk1GeDl2aUh1N3RuNDkrQ0xEMTUzM3dEdmZlcnpCOHRCZWVZNXp0bHArVjdzRmxXV2VCbm9sdTRLOFVrVVpic0RWd3k4Z3lkWnllWC9MY1lkRzQ1ODI3WmVlNi9ndjdCQ1c1enBZTkJla1dMRzBSeHJxemxFUTN4NXk0VUZ5TEl3SCs3ckhxNmpYd3BBRW42MWZ2ejVMMG9FREIyYjFwR3dzTzZYVXVkYk9QN05UbWhzQWR2eWlUblhpa2ZvVkVEQWxLb29GbHlkd0dBdFJZVWZERk1HQ2hIQ1pEV1RZc25qd2I4VlBoRzNVL3Z3dUN6TTJBbVRVcUZHVjJMQW5scCtKNTdRYzBPNWliTnZpZVNRa1hxRHFpZHVhY1FFTXlndW9qMk5uSWhZSUhqN2h5QUlxaUlZK2hHTGx4WGltbjVoZjdhN0Vab1ZIbDJKcnVHeGlNSjdGVU5YRVE1TFo2STZCWHg0ZzBZSlVUYkg3RURmVXlweklNeGh2eFlvVkxidUVUaFlEd3lFMDZMazg4S1pLZ3B3d0NveHRrOTNRaU9JbkdqNFdMN0c1MzNMa0FhdXljejVod29US2cxaVlNNUp1ZjdwZ1ZFeGRNNDM2azhuVHh5SWMzSUpWS3p0QkpneFNQSmppdXdrRkRNRDM1U20vZUVBdGFud1F3NDRHSWVZeEtyZVA0clpQaGpRZGo3aUovTDI3Z3VYcHVGKzFLK2h4S1p6Z3hoL09zY1ZEU0s1ZHUvYnZCZi9KQmJ2UWpNZVpXRWhzSnJZazYzQnVsTU91SHFZREJhQ3Z0aTh0VzhjRFltNm54ajV5UEprblVhQ29zTENOQU5uVU9FVmR5ZmFnUWZhV2lIeTNwV0hjVzJJc09jVjRqV21RZ3NIMkVxR2sxN21uMnZMaEJNRFhIdTVpZ0svWkN1RitZeXhPdEc0cnBEenhWOWJqRWlDOXNYZ21XaVJnRUM3TFJRbVVXQ2F1ODhFMHp5SEhEV21NWUR6UXFmUXNaSVFQRXk0YkFIb21uaUxRYS9Ib0JON2xxRVhaQ0NoM0RXS09Mbk52MlF0emJyRnZGaHNNWktLcWVOQnlzQ2FUUVNYRmszUEF4ZE1BdEhhY3ZBb3JubVAyS0lNVCtKTU91VlVMTHZkcFBlTVJDM0Qza2ZBTXhvaE5BcjNJenlnelNXdm0wQ2dJeWk1cDNQeUs3elMyZVRmTkJPWWxqeWhyNHdHWktIdnJqbGxsNFZIcVlISWcyeGowcE5DL0VUcGxIOXJPaGQ2MFZmb243bEZscDlEVCtuODRObXdOMzlMVGl2MHF2Qm9MQXp3WGQrQmwyenFDaU42TzhwTTlINjg2ZU1jK1Z6eUhaUVVIbEJFUDM2TUVxeU1QVE9SbmR6M0tmeDh3OW43bVAzV1VYWStQdGxwSUs3K2p5SGRMRThOL3l6OXZ4Q0xmZnozeURCaGM1R0c1aXFYVnZQRzB6WmUyUHIvMytER3NqK3o3RmNlUHErS0JPdGNOS0N4VFYyekQ1bGpMUHJhaXdPTkdRTll5RVUvWnVPTW53Z1VwYXQvS0Rrc3Mrbi9GZjlSVWFjbHlpcnhIY1gvMzd0M2N0UkJlTEpaNmxRWFpJS2g2dlIvK295MzJnU1d6V0MxOVRrWFZGUUNRRmVkSG92UzFWeDFQNmNVVCtCcndVK2RWL2dmNW5GcnBEUTZvSVFBQUFBQkpSVTVFcmtKZ2dnPT0iLz4KPC9kZWZzPgo8L3N2Zz4K";
                zeroStateImg.attr("src", img);
                zeroStateImg.attr("alt", Editor.CommonUtils.getLocalizedString("Canvas is empty"));
                var zeroStateParagraph = $(document.createElement("p"));
                var zeroStateText = Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.createContent);
                var link = "<a href=\"https://docs.microsoft.com/en-us/dynamics365/marketing/create-marketing-email\" target=\"_blank\">" + Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.learnMore) + "</a>";
                zeroStateParagraph.append(zeroStateText + "<br/>");
                zeroStateParagraph.append(link);
                zeroStateImageContainer.append(zeroStateImg);
                zeroStateImageContainer.append(zeroStateParagraph);
                zeroStateContainer.append(zeroStateImageContainer);
                frameBody.append(zeroStateContainer);
                var dragoverHandler_1 = function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                };
                var dropHandler_1 = function (event) {
                    Editor.CkEditorTelemetryUtils.sendControllerUsageTelemetry(_this.logger, event.type, _this.getName());
                    event.preventDefault();
                    var dragData = event.originalEvent.dataTransfer;
                    if (dragData != null) {
                        var element = $(dragData.getData("Text"));
                        var isBlock = Editor.BlockProvider.isBlock($(element));
                        _this.replaceDropSpotTopLevel(event, dragData, isBlock);
                    }
                };
                var zeroStateOverlay_1 = frameBody.find("." + Editor.CommonConstants.zeroStateContainerClass);
                zeroStateOverlay_1.on("dragover", function (event) {
                    dragoverHandler_1(event);
                });
                zeroStateOverlay_1.on("drop", function (event) {
                    dropHandler_1(event);
                });
            }
            var zeroStateOverlay = frameBody.find("." + Editor.CommonConstants.zeroStateContainerClass);
            if (!dataLayoutContents.length || (dataLayoutContents.length && !dataLayout.children().length)) {
                zeroStateOverlay.css("display", "initial");
            }
            else {
                zeroStateOverlay.css("display", "none");
            }
        };
        DroppableController.prototype.setup = function (elements, dragendHandler, dragenterHandler, dropHandler) {
            var _this = this;
            if (this.enableZeroState) {
                this.setupZeroState(elements);
            }
            this.frameDocument = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName).contents();
            if (Utility.isNullOrUndefined(this.pageDropHandler)) {
                this.pageDropHandler = function () { return dragendHandler(elements); };
                // Register a handler on the page to cleanup UI hints on drop, even outside of the designer... we need to store the instance so we dont unregister too much
                $(document).on("dragend", this.pageDropHandler);
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.cleanPlaceholderForAddMode);
            }
            if (Utility.isNullOrUndefined(this.onFrameDocumentDragOver)) {
                this.onFrameDocumentDragOver = function (evt) {
                    if (!_this.isDropable($(evt.target))) {
                        // Removes the placeholder if target doesn't support drop
                        _this.cleanupSortableHighlightMarker(elements);
                    }
                };
                this.frameDocument.on("dragover", this.onFrameDocumentDragOver);
            }
            elements.on("dragover", function (evt) {
                evt.preventDefault();
            });
            elements.on("dragenter", function (evt) {
                if (_this.isSupportedDragObject &&
                    $(evt.target).attr("class") !== Editor.CommonConstants.dropLineBorderClassName) {
                    var block = !Utility.isNullOrUndefined($(evt.target).attr("contenteditable"))
                        ? $(evt.target)
                        : $(evt.target).closest(Editor.CommonUtils.getAttrSelector("contenteditable"));
                    if (block.length > 0 &&
                        Utility.isNullOrUndefined(block.attr(Editor.CommonConstants.makeEditableAttrName)) &&
                        block.attr("contenteditable") === "true") {
                        block.attr(Editor.CommonConstants.makeEditableAttrName, "");
                        Editor.CommonUtils.setNonEditable(block);
                    }
                    dragenterHandler(evt);
                }
            });
            elements.on("drop", function (event) {
                dropHandler(event);
            });
        };
        DroppableController.prototype.cleanupContainers = function (containers) {
            this.cleanup(containers);
        };
        DroppableController.prototype.cleanupLayout = function (layout) {
            this.cleanup(layout);
        };
        DroppableController.prototype.cleanup = function (elements) {
            this.cleanupEditableDataAttr(elements.find(Editor.CommonUtils.getAttrSelector(Editor.CommonConstants.makeEditableAttrName)));
            Editor.CommonUtils.removeEditable(elements);
            this.cleanupUISectionHints(elements);
            elements.each(function (_, el) {
                if (String.isNullOrWhitespace($(el).attr("class"))) {
                    $(el).removeAttr("class");
                }
            });
        };
        DroppableController.prototype.disposeContainers = function (containers) {
            this.disposeElements(containers);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerDragStart, this.onDesignerDragStart);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerDragEnd, this.onDesignerDragEnd);
        };
        DroppableController.prototype.disposeLayout = function (layout) {
            this.disposeElements(layout);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerDragSectionStart, this.onDesignerDragSectionStart);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerDragSectionEnd, this.onDesignerDragSectionEnd);
        };
        DroppableController.prototype.disposeElements = function (elements) {
            elements.off("dragover drop");
            if (!Utility.isNullOrUndefined(this.pageDropHandler)) {
                $(document).off("dragend", this.pageDropHandler);
                this.pageDropHandler = null;
            }
            if (!Utility.isNullOrUndefined(this.onFrameDocumentDragOver)) {
                if (!Utility.isNullOrUndefined(this.frameDocument)) {
                    this.frameDocument.off("dragover", this.onFrameDocumentDragOver);
                    this.frameDocument = null;
                }
                this.onFrameDocumentDragOver = null;
            }
        };
        DroppableController.prototype.dispose = function () {
            this.onFrameDocumentDragOver = null;
            this.onDesignerDragStart = null;
            this.onDesignerDragEnd = null;
            this.pageDropHandler = null;
            this.lastContainer = null;
            this.frameDocument = null;
            this.eventBroker = null;
        };
        DroppableController.prototype.addSortableHighlightMarker = function (event) {
            event.preventDefault();
            event.stopPropagation();
            var dragEvent = this.setDragPosition(event);
            // On a container - we need to display the highlighted placeholder if not already displayed (same container, same item index)
            var container = !Utility.isNullOrUndefined($(event.target).attr(Editor.Contract.containerAttrName))
                ? $(event.target)
                : $(event.target).closest(Editor.CommonUtils.getAttrSelector(Editor.Contract.containerAttrName));
            this.insertMarkers(dragEvent, container);
        };
        DroppableController.prototype.addSortableHighlightMarkerForSection = function (event) {
            event.preventDefault();
            event.stopPropagation();
            var dragEvent = this.setDragPosition(event);
            // On a layout - we need to display the highlighted placeholder if not already displayed (same section, same item index)
            var layout = !Utility.isNullOrUndefined($(event.target).attr(Editor.Contract.dataLayoutAttrName))
                ? $(event.target)
                : $(event.target).closest(Editor.CommonUtils.getAttrSelector(Editor.Contract.dataLayoutAttrName));
            this.insertMarkers(dragEvent, layout);
        };
        DroppableController.prototype.setDragPosition = function (event) {
            var dragEvent = event.originalEvent;
            if (Math.abs(dragEvent.clientY - this.dragYPosition) < this.mousePositionDifference &&
                Math.abs(dragEvent.clientX - this.dragXPosition) < this.mousePositionDifference) {
                // Perf optimization: mouse position doesn't changed much
                return dragEvent;
            }
            this.dragYPosition = dragEvent.clientY;
            this.dragXPosition = dragEvent.clientX;
            return dragEvent;
        };
        DroppableController.prototype.insertMarkers = function (dragEvent, elements) {
            var indexAtContainer = 0;
            var children = elements.children(Editor.CommonUtils.getNotClassSelector(Editor.CommonConstants.dropLineBorderClassName));
            var scrollPosition = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName)
                .contents()
                .scrollTop();
            var foundBlockBellowTheMousePointer = false;
            children.each(function (index, element) {
                indexAtContainer = index;
                // Comparison coordinates of the event with elements positions, considering scroll offset
                // prettier-ignore
                if (Editor.CommonUtils.isAnyChildrenVisible(element) && dragEvent.clientY < $(element).offset().top - scrollPosition + $(element).height() / 2) { // tslint:disable-line
                    foundBlockBellowTheMousePointer = true;
                    return false;
                }
            });
            if (this.lastContainer === elements && this.lastIndexAtContainer === indexAtContainer) {
                // Perf optimization: we don't need to repaint if nothing has changed
                return;
            }
            this.lastIndexAtContainer = indexAtContainer;
            this.lastContainer = elements;
            // Parents until to sneak a peek back in the parent hiearchy without adding dependency/knowledge
            // about particular parents and types (e.g. presence of iframes and similar)
            $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.dropLineBorderClassName), elements.parentsUntil("body html")).remove();
            var dropPlaceholder = $("<div></div>");
            dropPlaceholder.addClass(Editor.CommonConstants.dropLineBorderClassName);
            var addBlockLine = $("<div></div>");
            addBlockLine.addClass(Editor.CommonConstants.dropLineClassName);
            dropPlaceholder.append(addBlockLine);
            if (foundBlockBellowTheMousePointer) {
                dropPlaceholder.insertBefore(children[indexAtContainer]);
            }
            else {
                elements.append(dropPlaceholder);
            }
            //clear focus
            this.selectionStateModel.resetSelection();
            this.selectedAreaDecorator.resetSelection();
        };
        DroppableController.prototype.replaceSortableHighlightMarkerWithBlock = function (event, dragData) {
            var block = this.replaceSortableHighlightMarkerWithElement(event, dragData);
            Editor.ContainerProvider.cleanContainerForBlock(block);
            // Notify block added
            var eventArgs = new Editor.BlockModificationEventArgs(block);
            this.eventBroker.notify(Editor.EventConstants.blockAdded, eventArgs);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.block, null, block, null, null));
        };
        DroppableController.prototype.replaceSortableHighlightMarkerWithSection = function (event, dragData) {
            var section = this.replaceSortableHighlightMarkerWithElement(event, dragData);
            if (section) {
                section.css("padding", Editor.LayoutStyles.padding + "px");
                // Notify section added
                var eventArgs = new Editor.SectionModificationEventArgs(section);
                this.eventBroker.notify(Editor.EventConstants.sectionAdded, eventArgs);
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.section, null, null, null, section));
            }
        };
        DroppableController.prototype.replaceDropSpotTopLevel = function (event, dragData, isBlock) {
            var element = $(dragData.getData("Text"));
            var frameDocument = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName).contents();
            var zeroStateOverlay = frameDocument.find("." + Editor.CommonConstants.zeroStateContainerClass);
            zeroStateOverlay.css("display", "none");
            var layout = $(event.target)
                .closest("body")
                .find(".ui-sortable");
            if (isBlock) {
                var section = $(document.createElement("div"));
                section.attr(Editor.Contract.dataSectionAttrName, "true");
                var selectedTool = new Editor.OneColumnTool(this.fcbList);
                var content = selectedTool.getContentTransformation();
                if (String.isNullUndefinedOrWhitespace(Editor.CommonUtils.getId(section))) {
                    var id = UniqueId.generate("section");
                    Editor.CommonUtils.setId($(section), id);
                }
                section.append(content);
                layout.append(section);
                var columnContainer = layout.find(".columnContainer");
                columnContainer.addClass("ui-sortable");
                columnContainer.append(element);
                var eventArgs = new Editor.SectionModificationEventArgs(section);
                this.eventBroker.notify(Editor.EventConstants.sectionAdded, eventArgs);
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.section, null, null, null, section));
                var elementEventArgs = new Editor.BlockModificationEventArgs(element);
                this.eventBroker.notify(Editor.EventConstants.blockAdded, elementEventArgs);
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.block, null, element, null, null));
            }
            else {
                layout.append(element);
                var eventArgs = new Editor.SectionModificationEventArgs(element);
                this.eventBroker.notify(Editor.EventConstants.sectionAdded, eventArgs);
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.section, null, null, null, element));
            }
        };
        DroppableController.prototype.replaceSortableHighlightMarkerWithElement = function (event, dragData) {
            event.preventDefault();
            event.stopPropagation();
            var target = $(event.target);
            if (!this.isSupportedDragObject) {
                // Defensive - an unknown element has been dropped (only sections and blocks are supported)
                $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.dropLineBorderClassName), target.parentsUntil("body html")).replaceWith("");
                return;
            }
            var element = $(dragData.getData("Text"));
            element.removeAttr("style");
            element.removeAttr("class");
            $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.dropLineBorderClassName), target.parentsUntil("body html")).replaceWith(element);
            this.isSupportedDragObject = false;
            return element;
        };
        DroppableController.prototype.cleanupSortableHighlightMarker = function (elements) {
            $(elements)
                .find(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.dropLineBorderClassName))
                .remove();
        };
        DroppableController.prototype.isDropable = function (target) {
            return target.closest(".ui-sortable").length > 0;
        };
        /**
         * Cleans up the UI hints - gridlines, drop-markers
         * @param containers The containers.
         */
        DroppableController.prototype.cleanupUIHints = function (containers) {
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragEnd);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.cleanPlaceholderForAddMode);
            this.cleanupSortableHighlightMarker(containers);
        };
        /**
         * Cleans up the UI hints - gridlines, drop-markers
         * @param sections The sections.
         */
        DroppableController.prototype.cleanupUISectionHints = function (sections) {
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragSectionEnd);
            this.cleanupSortableHighlightMarker(sections);
        };
        /**
         * Restore content editable blocks from containers
         * @param containers The containers.
         */
        DroppableController.prototype.restoreEditableContentBlocks = function (containers) {
            var _this = this;
            var blocks = containers.find(Editor.CommonUtils.getAttrSelector(Editor.CommonConstants.makeEditableAttrName));
            blocks.each(function (indexBlock, block) {
                var $block = $(block);
                Editor.CommonUtils.setEditable($block);
                _this.cleanupEditableDataAttr($block);
            });
        };
        /**
         * Remove editable data attr
         * @param element The JQuery element.
         */
        DroppableController.prototype.cleanupEditableDataAttr = function (element) {
            if (!Utility.isNullOrUndefined(element)) {
                element.removeAttr(Editor.CommonConstants.makeEditableAttrName);
            }
        };
        return DroppableController;
    }());
    Editor.DroppableController = DroppableController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Class responsible for displaying UI/drag hints in the designer
     */
    var DragModeController = /** @class */ (function () {
        function DragModeController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        DragModeController.prototype.getName = function () {
            return "DragModeController";
        };
        DragModeController.prototype.setupContainers = function (containers) {
            var _this = this;
            this.designerDragStartDelegate = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerDragStart, function () {
                _this.setupDragMode(containers);
            });
            this.designerDragEndDelegate = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerDragEnd, function () {
                _this.cleanupDragMode(containers);
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        DragModeController.prototype.setupLayout = function (layout) {
            var _this = this;
            this.designerDragSectionStartDelegate = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerDragSectionStart, function () {
                _this.setupDragMode(layout);
            });
            this.designerDragSectionEndDelegate = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerDragSectionEnd, function () {
                _this.cleanupDragMode(layout);
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        DragModeController.prototype.cleanupContainers = function (containers) {
            this.cleanupDragMode(containers);
        };
        DragModeController.prototype.cleanupLayout = function (layout) {
            this.cleanupDragMode(layout);
        };
        DragModeController.prototype.disposeContainers = function (containers) {
            this.cleanupDragMode(containers);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerDragStart, this.designerDragStartDelegate);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerDragEnd, this.designerDragEndDelegate);
        };
        DragModeController.prototype.disposeLayout = function (layout) {
            this.cleanupDragMode(layout);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerDragSectionStart, this.designerDragSectionStartDelegate);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerDragSectionEnd, this.designerDragSectionEndDelegate);
        };
        DragModeController.prototype.dispose = function () { };
        DragModeController.prototype.setupDragMode = function (elements) {
            elements.addClass(Editor.CommonConstants.designerContentEditorContainerInDragModeClassName);
        };
        DragModeController.prototype.cleanupDragMode = function (elements) {
            elements.removeClass(Editor.CommonConstants.designerContentEditorContainerInDragModeClassName);
        };
        return DragModeController;
    }());
    Editor.DragModeController = DragModeController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var BlockProvider;
    (function (BlockProvider) {
        /**
         * Gets the closest block element for the jquery element
         */
        function getClosestBlock(element) {
            return element.closest(Editor.CommonUtils.getAttrSelector(Editor.Contract.blockTypeAttrName));
        }
        BlockProvider.getClosestBlock = getClosestBlock;
        /*
         * Gets the blocks from the editor content.
         */
        function getBlocks(selectedEditor, excludeLocked) {
            if (excludeLocked === void 0) { excludeLocked = true; }
            return getByAttribute(selectedEditor, Editor.Contract.blockTypeAttrName, excludeLocked);
        }
        BlockProvider.getBlocks = getBlocks;
        function isBlock(block) {
            return block.attr(Editor.Contract.blockTypeAttrName) != null && block.attr(Editor.Contract.blockTypeAttrName) !== "";
        }
        BlockProvider.isBlock = isBlock;
        function getSubBlocks(selectedEditor, excludeLocked) {
            if (excludeLocked === void 0) { excludeLocked = true; }
            return getByAttribute(selectedEditor, Editor.Contract.subBlockAttrName, excludeLocked);
        }
        BlockProvider.getSubBlocks = getSubBlocks;
        function getByAttribute(content, attr, excludeLocked) {
            if (excludeLocked) {
                return Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrSelector(attr), content).filter(BlockProvider.filterUneditableBlocks);
            }
            return Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrSelector(attr), content);
        }
        /**
         * Gets the blocks of a particular type from the editor content.
         * @param selectedEditor
         * @param blockType
         */
        function getBlocksOfType(selectedEditor, blockType) {
            return Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrEqualsSelector(Editor.Contract.blockTypeAttrName, blockType), selectedEditor).add(Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrEqualsSelector(Editor.Contract.blockDatatypeAttrName, blockType), selectedEditor));
        }
        BlockProvider.getBlocksOfType = getBlocksOfType;
        function getBlockContainer(selectedElement) {
            return selectedElement.closest(Editor.CommonUtils.getAttrSelector(Editor.Contract.containerAttrName));
        }
        BlockProvider.getBlockContainer = getBlockContainer;
        function getBlockSection(selectedElement) {
            return selectedElement.closest(Editor.CommonUtils.getAttrSelector(Editor.Contract.dataSectionAttrName));
        }
        BlockProvider.getBlockSection = getBlockSection;
        function getChildrenBlocks(element) {
            return element.find(Editor.CommonUtils.getAttrSelector(Editor.Contract.blockTypeAttrName));
        }
        BlockProvider.getChildrenBlocks = getChildrenBlocks;
        function filterUneditableBlocks(_, element) {
            return (BlockProvider.getBlockContainer($(element)).attr(Editor.Contract.dataLockedAttrName) !==
                Editor.BlockConstants.lockLevelHard);
        }
        BlockProvider.filterUneditableBlocks = filterUneditableBlocks;
        /**
         * Get the last element before the container, for a jquery element.
         * if the jquery element itself, is the last - this will be returned.
         * @param selectedElement selected element.
         */
        function getLastElementBeforeContainer(selectedElement, ignoreAbTesting) {
            if (ignoreAbTesting === void 0) { ignoreAbTesting = true; }
            if (Utility.isNullOrUndefined(selectedElement)) {
                return null;
            }
            var element = selectedElement[0];
            var parent = selectedElement[0];
            while (parent &&
                !parent.getAttribute(Editor.Contract.containerAttrName) &&
                (ignoreAbTesting || parent.tagName.toLocaleLowerCase() !== Editor.AbTestingUtils.constants.tagName.abVariant)) {
                element = parent;
                parent = parent.parentElement;
            }
            return $(element || selectedElement);
        }
        BlockProvider.getLastElementBeforeContainer = getLastElementBeforeContainer;
        function getEditableElements(element) {
            return element.find(Editor.CommonUtils.getAttrSelector(Editor.CommonConstants.contentEditableAttrName));
        }
        BlockProvider.getEditableElements = getEditableElements;
        /**
         * Get content editable element from container
         * @param element container
         */
        function getEditableElement(element) {
            return element.find(Editor.CommonUtils.getAttrSelector(Editor.CommonConstants.contentEditableAttrName)).first();
        }
        BlockProvider.getEditableElement = getEditableElement;
    })(BlockProvider = Editor.BlockProvider || (Editor.BlockProvider = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var BlockDefinition = /** @class */ (function () {
        function BlockDefinition(availableBlocks) {
            this.availableBlocks = availableBlocks;
        }
        /**
         * Gets the block definition for the jquery element
         */
        BlockDefinition.prototype.getBlockDefinition = function (blockElement) {
            var blockType = Editor.BlockUtils.getBlockType(blockElement);
            if (Utility.isNullOrUndefined(blockType)) {
                return null;
            }
            return this.availableBlocks.firstOrDefault(function (b) {
                var currentBlockType = b.getType().toString();
                return currentBlockType.toLowerCase() === blockType.toLowerCase();
            });
        };
        /**
         * Setup the available blocks.
         * @param eventBroker the eventBroker.
         */
        BlockDefinition.prototype.init = function (eventBroker) {
            this.availableBlocks.each(function (block) {
                block.setup(eventBroker);
            });
        };
        /**
         * Cleanup the html content of the block.
         */
        BlockDefinition.prototype.cleanup = function (blockElements) {
            var _this = this;
            blockElements.each(function (index, block) {
                var blockDefinition = _this.getBlockDefinition($(block));
                if (!Utility.isNullOrUndefined(blockDefinition)) {
                    blockDefinition.setFinalContent($(block));
                }
            });
        };
        /**
         * Dispose the available blocks.
         */
        BlockDefinition.prototype.dispose = function () {
            this.availableBlocks.each(function (block) {
                block.dispose();
            });
        };
        return BlockDefinition;
    }());
    Editor.BlockDefinition = BlockDefinition;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BlockDefinitionFactory = /** @class */ (function () {
        function BlockDefinitionFactory() {
        }
        BlockDefinitionFactory.prototype.create = function (plugin) {
            var blocks = plugin.getToolBlockMapping().getValues();
            var distinctBlocks = blocks.distinct(function (item1, item2) { return item1.getType() === item2.getType(); });
            return new Editor.BlockDefinition(distinctBlocks);
        };
        return BlockDefinitionFactory;
    }());
    Editor.BlockDefinitionFactory = BlockDefinitionFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Class responsible for setting up the draggable blocks - adds the grab handler on hover
     */
    var BlockDraggableController = /** @class */ (function () {
        function BlockDraggableController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        BlockDraggableController.prototype.getName = function () {
            return "BlockDraggableController";
        };
        BlockDraggableController.prototype.setupBlocks = function (blockElements) {
            var _this = this;
            blockElements.each(function (_, block) {
                _this.wrapElementWithBlock($(block));
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        BlockDraggableController.prototype.disposeBlocks = function (blockElements) { };
        BlockDraggableController.prototype.cleanupBlocks = function (blockElements) {
            $(Editor.CommonUtils.getAttrSelector(Editor.Contract.containerAttrName)).removeClass(Editor.CommonConstants.designerContentEditorContainerInDragModeClassName);
            var wrappedBlockElements = blockElements.filter(function (i, e) {
                return $(this)
                    .parent()
                    .hasClass(Editor.CommonConstants.draggableWrapperClassName);
            });
            wrappedBlockElements.siblings().remove();
            wrappedBlockElements.unwrap();
            var draggableElement = blockElements.closest("." + Editor.CommonConstants.selectedElementCssClass);
            var maybeDraggableWrapper = draggableElement.parents();
            if (maybeDraggableWrapper.attr("class") &&
                maybeDraggableWrapper.attr("class").indexOf(Editor.CommonConstants.draggableWrapperClassName) !== -1) {
                draggableElement.unwrap();
            }
        };
        BlockDraggableController.prototype.dispose = function () { };
        BlockDraggableController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.none;
        };
        BlockDraggableController.prototype.wrapElementWithBlock = function (block) {
            var wrapper = $("<div>");
            wrapper.addClass(Editor.CommonConstants.draggableWrapperClassName);
            block.wrap(wrapper);
        };
        BlockDraggableController.prototype.executeOnSubBlocks = function () {
            return false;
        };
        return BlockDraggableController;
    }());
    Editor.BlockDraggableController = BlockDraggableController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    /**
     * Class responsible for setting the editable attribute for blocks
     */
    var BlockEditableController = /** @class */ (function () {
        function BlockEditableController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        BlockEditableController.prototype.getName = function () {
            return "BlockEditableController";
        };
        BlockEditableController.prototype.setupBlocks = function (blockElements) {
            blockElements.each(function (_, block) {
                var $block = $(block);
                // Intercept text selection by key down
                $block.on("keydown", function (event) {
                    if (event.keyCode === KeyboardKeyCodes.backspaceKey ||
                        event.keyCode === KeyboardKeyCodes.deleteKey) {
                        if (String.isNullOrEmpty($block.text())) {
                            // Stop event for the saving styles
                            event.preventDefault();
                        }
                        if (Editor.BlockUtils.getBlockType($block) === "Button" && $block.find("a").text().length <= 1) {
                            // Stop event for the saving 'a' tag
                            event.preventDefault();
                            // Add 'br' tag for the saving 'a' tag. 'br' tag will be removed by ckeditor after adding text.
                            $block
                                .find("a")
                                .text(String.Empty)
                                .append("<br>");
                        }
                    }
                });
                // Intercept text selection by key up
                $block.on("keyup", function (event) {
                    if ((event.keyCode === KeyboardKeyCodes.backspaceKey ||
                        event.keyCode === KeyboardKeyCodes.deleteKey) &&
                        Editor.BlockUtils.getBlockType($block) === "Button" &&
                        !$block.find("a").length) {
                        var editor = Editor.CommonUtils.getEditorFromBlock($block);
                        // Restore 'a' tag if it removed
                        var aTag = $("<a></a>")
                            .addClass("button")
                            .append("<br>");
                        if (editor.length) {
                            editor.prepend(aTag);
                        }
                        else {
                            $block.prepend(aTag);
                        }
                        // Remove ckeditor br tag
                        if ($block.find("br").length > 1) {
                            $block
                                .find("br")
                                .last()
                                .remove();
                        }
                    }
                });
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        BlockEditableController.prototype.cleanupBlocks = function (blockElements) {
            Editor.CommonUtils.removeEditable(blockElements);
        };
        BlockEditableController.prototype.disposeBlocks = function (blockElements) {
            blockElements.each(function (_, block) {
                $(block).off("focusout keydown keyup");
            });
        };
        BlockEditableController.prototype.dispose = function () { };
        BlockEditableController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.none;
        };
        BlockEditableController.prototype.executeOnSubBlocks = function () {
            return true;
        };
        return BlockEditableController;
    }());
    Editor.BlockEditableController = BlockEditableController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * Class responsible for adding a unique id for the block element
     */
    var BlockIdController = /** @class */ (function () {
        function BlockIdController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        BlockIdController.prototype.getName = function () {
            return "BlockIdController";
        };
        BlockIdController.prototype.setupBlocks = function (blockElements) {
            blockElements.each(function (index, block) {
                if (String.isNullOrWhitespace(Editor.CommonUtils.getId($(block)))) {
                    var id = UniqueId.generate("block");
                    Editor.CommonUtils.setId($(block), id);
                }
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        BlockIdController.prototype.cleanupBlocks = function (blockElements) {
            blockElements.removeAttr("id");
        };
        BlockIdController.prototype.disposeBlocks = function (blockElements) { };
        BlockIdController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.none;
        };
        BlockIdController.prototype.executeOnSubBlocks = function () {
            return true;
        };
        BlockIdController.prototype.dispose = function () { };
        return BlockIdController;
    }());
    Editor.BlockIdController = BlockIdController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Class for the notification, when block is loaded.
     */
    var BlockLoadedController = /** @class */ (function () {
        function BlockLoadedController(eventBroker, blockDefinition) {
            this.eventBroker = eventBroker;
            this.blockDefinition = blockDefinition;
            this.eventBroker = eventBroker;
            this.blockDefinition = blockDefinition;
            this.blockDefinition.init(this.eventBroker);
        }
        BlockLoadedController.prototype.getName = function () {
            return "BlockLoadedController";
        };
        BlockLoadedController.prototype.setupBlocks = function (blockElements, rootEventId) {
            var _this = this;
            blockElements.each(function (i, block) {
                var blockDefinition = _this.blockDefinition.getBlockDefinition($(block));
                if (!Utility.isNullOrUndefined(blockDefinition)) {
                    blockDefinition.setup(_this.eventBroker);
                    blockDefinition.decorate($(block), rootEventId);
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.blockLoaded, new Editor.BlockLoadedEventArgs($(block), null));
                }
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        BlockLoadedController.prototype.cleanupBlocks = function (blockElements) {
            var _this = this;
            blockElements.each(function (i, block) {
                var blockDefinition = _this.blockDefinition.getBlockDefinition($(block));
                if (!Utility.isNullOrUndefined(blockDefinition)) {
                    _this.blockDefinition.getBlockDefinition($(block)).setFinalContent($(block));
                }
            });
        };
        BlockLoadedController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.hard;
        };
        BlockLoadedController.prototype.disposeBlocks = function (blockElements) { };
        BlockLoadedController.prototype.dispose = function () { };
        BlockLoadedController.prototype.executeOnSubBlocks = function () {
            return true;
        };
        return BlockLoadedController;
    }());
    Editor.BlockLoadedController = BlockLoadedController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Class for the notification, when block is loaded.
     */
    var BlockClickedController = /** @class */ (function () {
        function BlockClickedController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        BlockClickedController.prototype.getName = function () {
            return "BlockClickedController";
        };
        BlockClickedController.prototype.setupBlocks = function (blockElements) {
            var _this = this;
            var eventArgs = new Editor.BlockClickedEventArgs();
            blockElements.each(function (index, block) {
                $(block).on("click", function () {
                    eventArgs.block = $(block);
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.blockClicked, eventArgs);
                });
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        BlockClickedController.prototype.cleanupBlocks = function (blockElements) { };
        BlockClickedController.prototype.disposeBlocks = function (blockElements) {
            if (!Utility.isNullOrUndefined(blockElements)) {
                blockElements.off("click");
            }
        };
        BlockClickedController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.none;
        };
        BlockClickedController.prototype.executeOnSubBlocks = function () {
            return false;
        };
        BlockClickedController.prototype.dispose = function () { };
        return BlockClickedController;
    }());
    Editor.BlockClickedController = BlockClickedController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    /**
     * Class responsible for the adding placeholders after each block when editor is in add mode.
     */
    var BlockAddModeController = /** @class */ (function () {
        function BlockAddModeController(eventBroker, selectionStateModel, selectedAreaDecorator, logger) {
            this.selectionStateModel = selectionStateModel;
            this.selectedAreaDecorator = selectedAreaDecorator;
            this.logger = logger;
            this.blockSortablePlaceholderClassName = "block-sort-highlight";
            this.ariaLabelText = "Placeholder. Press enter to insert tool here";
            this.eventBroker = eventBroker;
        }
        BlockAddModeController.prototype.getName = function () {
            return "BlockAddModeController";
        };
        BlockAddModeController.prototype.executeOnSubBlocks = function () {
            return false;
        };
        BlockAddModeController.prototype.setupBlocks = function (blockElements) {
            var _this = this;
            if (Utility.isNullOrUndefined(this.onDesignerAddStart)) {
                this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerAddStart, (this.onDesignerAddStart = function (eventArgs) {
                    return _this.designerAddStart(eventArgs.block, eventArgs.movingExistingBlock);
                }));
            }
            if (Utility.isNullOrUndefined(this.onDesignerAddEnd)) {
                this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerAddEnd, (this.onDesignerAddEnd = function () { return _this.cleanup(); }));
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        BlockAddModeController.prototype.cleanupBlocks = function (blockElements) {
            this.cleanup();
        };
        BlockAddModeController.prototype.disposeBlocks = function (blockElements) {
            this.cleanup();
        };
        BlockAddModeController.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.onDesignerAddStart)) {
                this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddStart, this.onDesignerAddStart);
            }
            if (!Utility.isNullOrUndefined(this.onDesignerAddEnd)) {
                this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddEnd, this.onDesignerAddEnd);
            }
            this.onDesignerAddStart = this.onDesignerAddEnd = null;
            this.cleanup();
        };
        BlockAddModeController.prototype.designerAddStart = function (block, movingExistingBlock) {
            var _this = this;
            var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            var blockElements = Editor.BlockProvider.getBlocks(designerFrame.contents());
            var startTarget;
            // Remove old focuses and set editor into non event propagation mode
            blockElements.focusout();
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationStart);
            // Remove old placeholders if they exist
            Editor.CommonUtils.getByClass(this.blockSortablePlaceholderClassName, designerFrame.contents()).remove();
            // Set tabindexes for the blocks
            Editor.CommonUtils.setTabIndex(blockElements.filter(Editor.CommonUtils.getAttrSelector("tabindex")), -1);
            Editor.CommonUtils.setTabIndex(blockElements.find(Editor.CommonUtils.getAttrSelector(Editor.CommonConstants.ckEditorAttrName)), -1);
            var addDivider = $("<div></div>");
            addDivider
                .addClass(Editor.CommonConstants.sortablePlaceholderClassName)
                .addClass(this.blockSortablePlaceholderClassName)
                .attr(Editor.Contract.dataIdAttrName, Editor.TestabilityConstants.sortablePlaceholderId);
            var line = $("<div></div>");
            line.addClass(Editor.CommonConstants.addBlockLineClassName);
            var mouseHover = $("<div></div>");
            mouseHover.addClass(Editor.CommonConstants.addBlockMouseHoverClassName);
            var marker = $("<div></div>");
            marker
                .addClass(Editor.CommonConstants.addBlockButtonClassName)
                .attr("tabindex", "0")
                .attr("role", "button")
                .attr("aria-label", Editor.CommonUtils.getLocalizedString(this.ariaLabelText));
            addDivider.append(line);
            addDivider.append(mouseHover);
            addDivider.append(marker);
            var mouseDownAction = function (event) {
                startTarget = $(event.target.parentElement);
            };
            marker.on("touchstart mousedown", mouseDownAction);
            mouseHover.on("touchstart mousedown", mouseDownAction);
            var mouseUpAction = function (event) {
                var target = $(event.target.parentElement);
                if (startTarget && target.get(0) === startTarget.get(0)) {
                    _this.replacePlaceholder(target, block, movingExistingBlock);
                }
            };
            marker.on("touchend mouseup", mouseUpAction);
            mouseHover.on("touchend mouseup", mouseUpAction);
            // Cleanup start target if user scroll the placrholders
            var touchMoveAction = function () {
                startTarget = null;
            };
            marker.on("touchmove", touchMoveAction);
            mouseHover.on("touchmove", touchMoveAction);
            var keyDownAction = function (event) {
                var keyPressed = event.which || event.keyCode;
                var placeholder = $(event.target.parentElement);
                if (keyPressed === KeyCodes.Enter) {
                    event.preventDefault();
                    _this.replacePlaceholder(placeholder, block, movingExistingBlock);
                }
            };
            marker.on("keydown", keyDownAction);
            mouseHover.on("keydown", keyDownAction);
            var focusAction = function (event) {
                // Add selection on the selected placeholder
                Editor.CommonUtils.getByClass(Editor.CommonConstants.sortablePlaceholderClassName, designerFrame.contents()).removeClass(Editor.CommonConstants.selectedSortablePlaceholderClassName);
                $(event.target.parentElement).addClass(Editor.CommonConstants.selectedSortablePlaceholderClassName);
            };
            marker.on("focus focusin", focusAction);
            mouseHover.on("focus focusin", focusAction);
            var containers = designerFrame
                .contents()
                .find(Editor.CommonUtils.getAttrEqualsSelector(Editor.Contract.containerAttrName, "true"))
                .not(Editor.CommonUtils.getAttrEqualsSelector(Editor.Contract.dataLockedAttrName, Editor.BlockConstants.lockLevelHard));
            var emptyContainers = containers.not(":has(" + Editor.CommonUtils.getAttrSelector(Editor.Contract.blockTypeAttrName) + ")");
            if (Editor.CommonUtils.isElementDefined(emptyContainers)) {
                emptyContainers.append(addDivider.clone(true));
            }
            if (Editor.CommonUtils.isElementDefined(containers)) {
                containers.each(function (i, elem) {
                    if (!Editor.CommonUtils.isAnyChildrenVisible(elem)) {
                        $(elem).append(addDivider.clone(true));
                    }
                });
            }
            blockElements.filter(Editor.BlockProvider.filterUneditableBlocks).each(function (index, element) {
                var wrappedBlock = Editor.BlockProvider.getLastElementBeforeContainer($(element));
                var rootBlock = Editor.BlockProvider.getLastElementBeforeContainer($(element), true);
                if (Editor.CommonUtils.isElementDefined(wrappedBlock) && Editor.CommonUtils.isAnyChildrenVisible(wrappedBlock[0])) {
                    // Skip adding the placeholder, if we already have it before or after the block in this container
                    if (!_this.hasBlockPlaceholder(wrappedBlock.next())) {
                        rootBlock.after(addDivider.clone(true));
                    }
                    if (!_this.hasBlockPlaceholder(wrappedBlock.prev())) {
                        rootBlock.before(addDivider.clone(true));
                    }
                }
            });
            //clear focus
            this.selectionStateModel.resetSelection();
            this.selectedAreaDecorator.resetSelection();
            // Set focus on the first selected placeholder
            Editor.CommonUtils.getByClass(Editor.CommonConstants.addBlockButtonClassName, designerFrame.contents())
                .first()
                .focus()
                .focusin();
        };
        BlockAddModeController.prototype.replacePlaceholder = function (placeholder, block, movingExistingBlock) {
            Editor.CkEditorTelemetryUtils.sendControllerUsageTelemetry(this.logger, "+", this.getName());
            placeholder.replaceWith(block);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.cleanPlaceholderForAddMode);
            if (movingExistingBlock) {
                this.eventBroker.notify(Editor.EventConstants.blockMoved, new Editor.BlockModificationEventArgs(block));
            }
            else {
                this.eventBroker.notify(Editor.EventConstants.blockAdded, new Editor.BlockModificationEventArgs(block));
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddEnd);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.block, null, block, null, null));
        };
        BlockAddModeController.prototype.cleanup = function () {
            var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            var blockElements = Editor.BlockProvider.getBlocks(designerFrame.contents());
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationEnd);
            // Restore tabindexes
            Editor.CommonUtils.setTabIndex(blockElements.filter(Editor.CommonUtils.getAttrSelector("tabindex")), 0);
            Editor.CommonUtils.setTabIndex(blockElements.find(Editor.CommonUtils.getAttrSelector(Editor.CommonConstants.ckEditorAttrName)), 0);
        };
        BlockAddModeController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.none;
        };
        BlockAddModeController.prototype.hasBlockPlaceholder = function (block) {
            return block.hasClass(Editor.CommonConstants.sortablePlaceholderClassName);
        };
        return BlockAddModeController;
    }());
    Editor.BlockAddModeController = BlockAddModeController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Class responsible for disabling the droping inside the block
     */
    var BlockDroppableController = /** @class */ (function () {
        function BlockDroppableController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        BlockDroppableController.prototype.getName = function () {
            return "BlockDroppableController";
        };
        BlockDroppableController.prototype.setupBlocks = function (blockElements) {
            // Prevent the default action, but, don't stop bubling the event -> the container will safely handle it
            blockElements.on("drop", function (evt) {
                evt.preventDefault();
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        BlockDroppableController.prototype.cleanupBlocks = function (blockElements) { };
        BlockDroppableController.prototype.disposeBlocks = function (blockElements) {
            blockElements.off("drop");
        };
        BlockDroppableController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.none;
        };
        BlockDroppableController.prototype.dispose = function () { };
        BlockDroppableController.prototype.executeOnSubBlocks = function () {
            return false;
        };
        return BlockDroppableController;
    }());
    Editor.BlockDroppableController = BlockDroppableController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ContainerProvider;
    (function (ContainerProvider) {
        function getContainers(selectedEditor) {
            return selectedEditor
                .find(Editor.CommonUtils.getAttrSelector(Editor.Contract.containerAttrName))
                .not(Editor.CommonUtils.getAttrEqualsSelector(Editor.Contract.dataLockedAttrName, Editor.BlockConstants.lockLevelHard));
        }
        ContainerProvider.getContainers = getContainers;
        function getContainersWithBlocks(selectedEditor) {
            var containers = [];
            ContainerProvider.getContainers(selectedEditor)
                .toArray()
                .forEach(function (container) {
                if ($(container).children().length !== 0) {
                    containers.push($(container));
                }
            });
            return containers;
        }
        ContainerProvider.getContainersWithBlocks = getContainersWithBlocks;
        function getContainersWithoutBlocks(selectedEditor) {
            var containers = [];
            ContainerProvider.getContainers(selectedEditor)
                .toArray()
                .forEach(function (container) {
                if (!Editor.CommonUtils.isAnyChildrenVisible(container)) {
                    containers.push($(container));
                }
            });
            return containers;
        }
        ContainerProvider.getContainersWithoutBlocks = getContainersWithoutBlocks;
        function isContainer(element) {
            return (element.attr(Editor.Contract.containerAttrName) === "true" &&
                element.attr(Editor.Contract.dataLockedAttrName) !== Editor.BlockConstants.lockLevelHard);
        }
        ContainerProvider.isContainer = isContainer;
        function getBlocksFromContainer(container) {
            return container.find("[" + Editor.Contract.blockTypeAttrName + "]");
        }
        ContainerProvider.getBlocksFromContainer = getBlocksFromContainer;
        function cleanContainerForBlock(block) {
            var closestContainer = block.closest("[" + Editor.Contract.containerAttrName + "]");
            closestContainer.removeClass(Editor.LayoutStyles.emptyContainerCssClass);
        }
        ContainerProvider.cleanContainerForBlock = cleanContainerForBlock;
    })(ContainerProvider = Editor.ContainerProvider || (Editor.ContainerProvider = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Class responsible for the adding placeholders as first element when editor is in add mode.
     */
    var ContainerAddModeController = /** @class */ (function () {
        function ContainerAddModeController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        ContainerAddModeController.prototype.getName = function () {
            return "ContainerAddModeController";
        };
        ContainerAddModeController.prototype.setupContainers = function (containers) {
            var _this = this;
            if (Utility.isNullOrUndefined(this.onDesignerAddStart)) {
                this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerAddSectionStart, (this.onDesignerAddStart = function (eventArgs) {
                    return _this.designerAddStart(eventArgs.block, eventArgs.movingExistingBlock);
                }));
            }
            if (Utility.isNullOrUndefined(this.onDesignerAddEnd)) {
                this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.cleanPlaceholderForAddMode, (this.onDesignerAddEnd = function () { return _this.removePlaceholdersForAddMode(); }));
                this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerAddSectionEnd, (this.onDesignerAddEnd = function () { return _this.cleanup(); }));
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        ContainerAddModeController.prototype.cleanupContainers = function (containers) {
            this.cleanup();
        };
        ContainerAddModeController.prototype.disposeContainers = function (containers) {
            this.cleanup();
            if (!Utility.isNullOrUndefined(this.onDesignerAddStart)) {
                this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddSectionStart, this.onDesignerAddStart);
            }
            if (!Utility.isNullOrUndefined(this.onDesignerAddEnd)) {
                this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddEnd, this.onDesignerAddEnd);
                this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddSectionEnd, this.onDesignerAddEnd);
            }
            if (!Utility.isNullOrUndefined(this.onDesignerAddCanceled)) {
                this.eventBroker.unsubscribe(Editor.TabControlEventConstants.tabsStateUpdated, this.onDesignerAddCanceled);
            }
            this.onDesignerAddStart = this.onDesignerAddEnd = this.onDesignerAddCanceled = null;
        };
        ContainerAddModeController.prototype.dispose = function () { };
        ContainerAddModeController.prototype.designerAddStart = function (block, movingExistingBlock) {
            var _this = this;
            var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            if (Utility.isNullOrUndefined(this.onDesignerAddCanceled)) {
                this.onDesignerAddCanceled = function () {
                    _this.addCanceled();
                };
                // Exit from the add mode by the mousedown event on drag handler
                designerFrame.contents().one("mousedown", function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                });
                // Exit from the add mode by the click event if target is not ignored
                designerFrame.contents().one("mouseup", function (e) {
                    if (!_this.isIgnoredTarget($(e.target))) {
                        e.preventDefault();
                        e.stopPropagation();
                        _this.onDesignerAddCanceled();
                    }
                });
                this.eventBroker.subscribe(Editor.TabControlEventConstants.tabsStateUpdated, this.onDesignerAddCanceled);
            }
        };
        ContainerAddModeController.prototype.cleanup = function () {
            var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            designerFrame.contents().off("mousedown mouseup");
            if (!Utility.isNullOrUndefined(this.onDesignerAddCanceled)) {
                this.eventBroker.unsubscribe(Editor.TabControlEventConstants.tabsStateUpdated, this.onDesignerAddCanceled);
                this.onDesignerAddCanceled = null;
            }
        };
        ContainerAddModeController.prototype.removePlaceholdersForAddMode = function () {
            var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            Editor.CommonUtils.getByClass(Editor.CommonConstants.sortablePlaceholderClassName, designerFrame.contents()).remove();
        };
        ContainerAddModeController.prototype.isIgnoredTarget = function (target) {
            // Ignore move block button (button__moveblockbtn or button__moveblockbtn_icon) and placeholders
            return (target.hasClass(Editor.CommonConstants.selectedSortablePlaceholderClassName) ||
                (target.attr("class") && target.attr("class").indexOf("moveblockbtn") !== -1));
        };
        ContainerAddModeController.prototype.addCanceled = function () {
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddEnd);
        };
        return ContainerAddModeController;
    }());
    Editor.ContainerAddModeController = ContainerAddModeController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DetailsViewConstants = /** @class */ (function () {
        function DetailsViewConstants() {
        }
        DetailsViewConstants.collapsableIconClassName = "extrasToggle";
        DetailsViewConstants.headingClassName = "propertiesTitleButton";
        DetailsViewConstants.headingLabelClassName = "propertiesTitle";
        DetailsViewConstants.sectionContentClassName = "treeView";
        DetailsViewConstants.sectionContainerClassName = "detailsViewProperties";
        DetailsViewConstants.sectionContainerV2ClassName = "detailsViewPropertiesV2";
        DetailsViewConstants.emptyWatermarkClassName = "empty-watermark";
        DetailsViewConstants.inputColumnsLayout = "columnsInput";
        DetailsViewConstants.twoColumnSubsectionClassName = "twoColumnSubsection";
        DetailsViewConstants.inputControlContainerClassName = "treeViewItem";
        DetailsViewConstants.textareaControlContainerClassName = "textareaTreeViewItem";
        DetailsViewConstants.customRadioTileButton = "customRadioTileButton";
        DetailsViewConstants.customRadioTileButtonV2 = "customRadioTileButtonV2";
        DetailsViewConstants.checkboxFieldClassName = "checkboxField";
        DetailsViewConstants.inputItemField = "treeViewItemField";
        DetailsViewConstants.textareaItemField = "textareatreeViewItemField";
        DetailsViewConstants.rangeControlContainerClassName = "rangeTreeViewItem";
        DetailsViewConstants.rangeItemField = "rangetreeViewItemField";
        DetailsViewConstants.rangeItemValueField = "rangetreeViewItemValueField";
        DetailsViewConstants.attributeRangeClassName = "attributeRange";
        DetailsViewConstants.neverProtected = "neverProtected";
        DetailsViewConstants.richEditDisabled = "richEditDisabled";
        DetailsViewConstants.disabled = "disabled";
        DetailsViewConstants.propertyNameCssClass = "propertyName";
        DetailsViewConstants.inputAttributeClassName = "attributeInput";
        DetailsViewConstants.attributeTextAreaClassName = "attributeTextArea";
        DetailsViewConstants.inputColorCssClass = "inputColor";
        DetailsViewConstants.inputImageCssClass = "inputImage";
        DetailsViewConstants.inputCheckboxCssClass = "inputCheckbox";
        DetailsViewConstants.decorativeCheckboxLabel = "[Decorative]";
        DetailsViewConstants.inputRadioButtonCssClass = "inputRadioButton";
        DetailsViewConstants.colorFilledRectangleCssClass = "colorFilledRectangle";
        DetailsViewConstants.colorPickerInputCssClassName = "colorPickerInput";
        DetailsViewConstants.colorPickerFocusedCssClass = "siblingFocused";
        DetailsViewConstants.inputTag = "input";
        DetailsViewConstants.textareaTag = "textarea";
        DetailsViewConstants.selectTag = "select";
        DetailsViewConstants.inputTypeText = "text";
        DetailsViewConstants.inputTypeNumber = "number";
        DetailsViewConstants.linkSectionTitle = "Link";
        DetailsViewConstants.pixels = "px";
        DetailsViewConstants.spinButtonDebounceTime = 250;
        DetailsViewConstants.customRadioInputClassName = "customRadioInput";
        DetailsViewConstants.customRadioLabelClassName = "customRadioLabel";
        DetailsViewConstants.radioButtonIconClassName = "radioButtonIcon";
        DetailsViewConstants.customRadioOptionContainerClassName = "customRadioOptionContainer";
        DetailsViewConstants.customRadioOptionSelectedClassName = "customRadioOptionSelected";
        DetailsViewConstants.editorLookupControlClassName = "editorLookupControl";
        DetailsViewConstants.coverDropdownOption = "Cover";
        DetailsViewConstants.fullSizeDropdownOption = "FullSize";
        // ImageDetailsView constants
        DetailsViewConstants.srcInputCssClass = "srcInput";
        DetailsViewConstants.altInputCssClass = "altInput";
        DetailsViewConstants.linkInputCssClass = "linkInput";
        DetailsViewConstants.imageHSpaceInputCssClass = "imageHSpaceInput";
        DetailsViewConstants.imageVSpaceInputCssClass = "imageVSpaceInput";
        DetailsViewConstants.imageAlignmentDropDownCssClass = "imageAlignmentDropDown";
        DetailsViewConstants.imgGalleryCssClass = "detailsViewButton";
        DetailsViewConstants.imgGalleryFirstButtonCssClass = "detailsViewButtonFirst";
        DetailsViewConstants.imageSectionTitle = "Image";
        DetailsViewConstants.imageSectionLabel = "[Image]";
        DetailsViewConstants.imageAlignmentLabel = "[Alignment]";
        DetailsViewConstants.imageWrapperClassName = "imageWrapper";
        DetailsViewConstants.imageTag = "img";
        DetailsViewConstants.placeHolderAuto = "Auto";
        DetailsViewConstants.objectFitAttribute = "object-fit";
        DetailsViewConstants.importantFlag = "important";
        DetailsViewConstants.altAttribute = "alt";
        DetailsViewConstants.alignAttribute = "align";
        DetailsViewConstants.srcAttribute = Editor.CommonConstants.designerImageSourceAttributeName;
        DetailsViewConstants.titleAttribute = "title";
        DetailsViewConstants.srcLabel = "[Source]";
        DetailsViewConstants.imageSourceLabel = "[Image source]";
        DetailsViewConstants.altLabel = "[Alt Text]";
        DetailsViewConstants.linkLabel = "[Link]";
        DetailsViewConstants.hSpaceLabel = "[HSpace]";
        DetailsViewConstants.vSpaceLabel = "[VSpace]";
        DetailsViewConstants.imgHeightLabel = "[Height px]";
        DetailsViewConstants.imgHeightAttribute = "height";
        DetailsViewConstants.imgMaxHeightCssProperty = "max-height";
        DetailsViewConstants.imageHeightInputCssClass = "imageHeightInput";
        DetailsViewConstants.imgWidthLabel = "[Width px]";
        DetailsViewConstants.imgWidthAttribute = "width";
        DetailsViewConstants.imgMaxWidthCssProperty = "max-width";
        DetailsViewConstants.imageWidthInputCssClass = "imageWidthInput";
        // ButtonDetailsView constants
        DetailsViewConstants.hrefInputCssClass = "hrefInput";
        DetailsViewConstants.anchorTag = "a";
        DetailsViewConstants.hrefAttribute = "href";
        DetailsViewConstants.urlLabel = "[URL]";
        DetailsViewConstants.buttonLinkLabel = "[Link]";
        DetailsViewConstants.buttonLinkInputCssClass = "buttonLinkInput";
        DetailsViewConstants.stylesSectionTitle = "[Styles Title]";
        DetailsViewConstants.styleSectionTitle = "[Style]";
        DetailsViewConstants.buttonBackgroundColorLabel = "[Background Color]";
        DetailsViewConstants.buttonBackgroundColorInputCssClass = "buttonBackgroundColorInput";
        DetailsViewConstants.buttonTextColorLabel = "[Text Color]";
        DetailsViewConstants.buttonTextColorInputCssClass = "buttonTextColorInput";
        DetailsViewConstants.buttonAlignmentLabel = "[Alignment]";
        DetailsViewConstants.buttonAlignmentDropDownCssClass = "buttonAlignmentDropDown";
        DetailsViewConstants.sizeSectionTitle = "[Size]";
        DetailsViewConstants.buttonWidthLabel = "[Width px]";
        DetailsViewConstants.buttonWidthInputCssClass = "buttonWidthInput";
        DetailsViewConstants.buttonHeightLabel = "[Height px]";
        DetailsViewConstants.buttonHeightInputCssClass = "buttonHeightInput";
        DetailsViewConstants.backgroundColorAttribute = "background-color";
        DetailsViewConstants.textColorAttribute = "color";
        DetailsViewConstants.marginTopAttribute = "margin-top";
        DetailsViewConstants.marginTopLabel = "[Margin Top px]";
        DetailsViewConstants.marginTopInputCssClass = "marginTopInput";
        DetailsViewConstants.marginBottomAttribute = "margin-bottom";
        DetailsViewConstants.marginBottomLabel = "[Margin Bottom px]";
        DetailsViewConstants.marginBottomInputCssClass = "marginBottomInput";
        DetailsViewConstants.marginLeftAttribute = "margin-left";
        DetailsViewConstants.marginLeftLabel = "[Margin Left px]";
        DetailsViewConstants.marginLeftInputCssClass = "marginLeftInput";
        DetailsViewConstants.marginRightAttribute = "margin-right";
        DetailsViewConstants.marginRightLabel = "[Margin Right px]";
        DetailsViewConstants.marginRightInputCssClass = "marginRightInput";
        DetailsViewConstants.backgroundSrcLabel = "[Background source]";
        DetailsViewConstants.backgroundSrcInputCssClass = "backgroundSrcInput";
        DetailsViewConstants.backgroundImageLabel = "[Background image]";
        DetailsViewConstants.backgroundImageSizeLabel = "[Background Size]";
        DetailsViewConstants.backgroundImageSizeCssClass = "backgroundImageSize";
        DetailsViewConstants.backgroundImageHorizontalAlignmentLabel = "[Horizontal align]";
        DetailsViewConstants.backgroundImageHorizontalAlignmentCssClass = "backgroundImageHorizontalAlignment";
        DetailsViewConstants.backgroundImageVerticalAlignmentLabel = "[Vertical align]";
        DetailsViewConstants.backgroundImageVerticalAlignmentCssClass = "backgroundImageVerticalAlignment";
        DetailsViewConstants.lineHeightAttribute = "line-height";
        DetailsViewConstants.topAlignmentLabel = "[Top]";
        DetailsViewConstants.centerAlignmentLabel = "[Center]";
        DetailsViewConstants.bottomAlignmentLabel = "[Bottom]";
        DetailsViewConstants.leftAlignmentLabel = "[Left]";
        DetailsViewConstants.rightAlignmentLabel = "[Right]";
        DetailsViewConstants.borderStyleNoneLabel = "[None]";
        DetailsViewConstants.borderStyleSolidLabel = "[Solid]";
        DetailsViewConstants.borderStyleDottedLabel = "[Dotted]";
        DetailsViewConstants.borderStyleDashedLabel = "[Dashed]";
        DetailsViewConstants.borderStyleDoubleLabel = "[Double]";
        DetailsViewConstants.coverSizeLabel = "[Cover]";
        DetailsViewConstants.initialSizeLabel = "[Initial Size]";
        // DividerDetailsView constants
        DetailsViewConstants.dividerSectionTitle = "Divider";
        DetailsViewConstants.dividerSectionLabel = "[Divider]";
        DetailsViewConstants.tableTag = "table";
        DetailsViewConstants.tdTag = "td";
        DetailsViewConstants.pTag = "p";
        DetailsViewConstants.widthAttribute = "width";
        DetailsViewConstants.heightAttribute = "height";
        DetailsViewConstants.widthLabel = "[Width %]";
        DetailsViewConstants.dividerWidthInputCssClass = "dividerWidthInput";
        DetailsViewConstants.colorAttribute = "border-bottom-color";
        DetailsViewConstants.colorLabel = "[Color]";
        DetailsViewConstants.colorInputCssClass = "colorInput";
        DetailsViewConstants.sectionStyleTitle = "[Section style]";
        DetailsViewConstants.columnStyleTitle = "[Column style]";
        DetailsViewConstants.sectionBorderStylesTitle = "[Section border styles]";
        DetailsViewConstants.sectionBorderStylesTitleToolTip = "[Section border styles tooltip]";
        DetailsViewConstants.columnBorderStylesTitle = "[Column border styles]";
        DetailsViewConstants.columnBorderStylesTitleToolTip = "[Column border styles tooltip]";
        DetailsViewConstants.sectionBgColorLabel = "[Background Color]";
        DetailsViewConstants.sectionBgColorInputCssClass = "sectionBgColorInput";
        DetailsViewConstants.borderStyleNone = "None";
        DetailsViewConstants.borderStyleSolid = "Solid";
        DetailsViewConstants.borderWidthAttribute = "border-width";
        DetailsViewConstants.borderWidthLabel = "[Border width]";
        DetailsViewConstants.borderWidthInputCssClass = "borderWidth";
        DetailsViewConstants.borderRadiusAttribute = "border-radius";
        DetailsViewConstants.borderRadiusLabel = "[Border radius]";
        DetailsViewConstants.borderRadiusInputCssClass = "borderRadius";
        DetailsViewConstants.spinButtonCssClass = "spinButton";
        DetailsViewConstants.borderColorAttribute = "border-color";
        DetailsViewConstants.borderColorLabel = "[Border color]";
        DetailsViewConstants.borderColorInputCssClass = "borderStyle";
        DetailsViewConstants.borderStyleAttribute = "border-style";
        DetailsViewConstants.borderStyleLabel = "[Border type]";
        DetailsViewConstants.borderStyleInputCssClass = "borderStyle";
        DetailsViewConstants.borderLabel = "[Border]";
        DetailsViewConstants.paddingSectionTitle = "Padding";
        DetailsViewConstants.sectionPaddingTitle = "[Section padding]";
        DetailsViewConstants.sectionMarginTitle = "[Section margin]";
        DetailsViewConstants.columnPaddingTitle = "[Column padding]";
        DetailsViewConstants.columnMarginTitle = "[Column margin]";
        DetailsViewConstants.sectionBackgroundTitle = "[Section background]";
        DetailsViewConstants.subsectionContentClassName = "subsectionContent";
        DetailsViewConstants.subsectionClassName = "subsection";
        DetailsViewConstants.subsectionHeaderCssClass = "subsectionHeader";
        DetailsViewConstants.paddingSubsectionLabel = "[Padding (px)]";
        DetailsViewConstants.paddingSubsectionCssClass = "paddingSubsection";
        DetailsViewConstants.marginSubsectionLabel = "[Margin (px)]";
        DetailsViewConstants.marginSubsectionCssClass = "marginSubsection";
        DetailsViewConstants.backgroundSubsectionCssClass = "backgroundSubsection";
        DetailsViewConstants.borderSubsectionCssClass = "borderSubsection";
        DetailsViewConstants.sizeTitle = "[Size]";
        DetailsViewConstants.maxWidthLabel = "[Max. width px]";
        DetailsViewConstants.minHeightLabel = "[Min. height px]";
        DetailsViewConstants.maxWidthInputCssClass = "maxWidthInput";
        DetailsViewConstants.minHeightInputCssClass = "minHeightInput";
        DetailsViewConstants.maxWidthAttribute = "max-width";
        DetailsViewConstants.minHeightAttribute = "min-height";
        DetailsViewConstants.paddingTopAttribute = "padding-top";
        DetailsViewConstants.paddingTopLabel = "[Padding Top px]";
        DetailsViewConstants.paddingTopInputCssClass = "paddingTopInput";
        DetailsViewConstants.paddingBottomAttribute = "padding-bottom";
        DetailsViewConstants.paddingBottomLabel = "[Padding Bottom px]";
        DetailsViewConstants.paddingBottomInputCssClass = "paddingBottomInput";
        DetailsViewConstants.paddingLeftAttribute = "padding-left";
        DetailsViewConstants.paddingLeftLabel = "[Padding Left px]";
        DetailsViewConstants.paddingLeftInputCssClass = "paddingLeftInput";
        DetailsViewConstants.paddingRightAttribute = "padding-right";
        DetailsViewConstants.paddingRightLabel = "[Padding Right px]";
        DetailsViewConstants.paddingRightInputCssClass = "paddingRightInput";
        DetailsViewConstants.positionTitle = "[Position]";
        DetailsViewConstants.spacingTitle = "[Spacing]";
        DetailsViewConstants.contentBlockTool = "[Content block tool]";
        DetailsViewConstants.contentBlockSource = "[Content block source]";
        DetailsViewConstants.contentBlockToolCss = "contentBlockTool";
        DetailsViewConstants.contentBlockWrapper = "contentBlockWrapper";
        DetailsViewConstants.contentBlockIdAttribute = "data-contentblock-id";
        DetailsViewConstants.lookupIdAttribute = "data-lookup-id";
        DetailsViewConstants.lookupNameAttribute = "data-lookup-name";
        //VideoDetailsView constants
        DetailsViewConstants.videoSectionTitle = "[Video]";
        DetailsViewConstants.videoLookupLabel = "[VideoLookupLabel]";
        DetailsViewConstants.videoLookupCssClass = "videoLookupInput";
        DetailsViewConstants.videoLookupContainerId = "videoLookupContainer";
        // SectionDetailsView constants
        DetailsViewConstants.sectionTitle = "[Section]";
        DetailsViewConstants.sectionLayoutSectionCaption = "[Section layout]";
        DetailsViewConstants.layoutSectionLabel = "[Layout]";
        DetailsViewConstants.oneColumnOptionValue = "OneColumn";
        DetailsViewConstants.oneColumnOptionLabel = "[1 Column]";
        DetailsViewConstants.oneColumnOptionCss = "oneColumnOption";
        DetailsViewConstants.twoColumnOptionValue = "TwoColumn";
        DetailsViewConstants.twoColumnOptionLabel = "[2 Column]";
        DetailsViewConstants.twoColumnOptionCss = "twoColumnOption";
        DetailsViewConstants.threeColumnOptionValue = "ThreeColumn";
        DetailsViewConstants.threeColumnOptionLabel = "[3 Column]";
        DetailsViewConstants.threeColumnOptionCss = "threeColumnOption";
        DetailsViewConstants.oneTwoColumnOptionValue = "OneTwoColumn";
        DetailsViewConstants.oneTwoColumnOptionLabel = "[1-2]";
        DetailsViewConstants.oneTwoColumnOptionCss = "oneTwoColumnOption";
        DetailsViewConstants.twoOneColumnOptionValue = "TwoOneColumn";
        DetailsViewConstants.twoOneColumnOptionLabel = "[2-1]";
        DetailsViewConstants.twoOneColumnOptionCss = "twoOneColumnOption";
        DetailsViewConstants.customColumnOptionValue = "CustomColumn";
        DetailsViewConstants.customColumnOptionLabel = "[Custom Column]";
        DetailsViewConstants.customColumnOptionCss = "customColumnOption";
        DetailsViewConstants.columnCountInputLabel = "[Number of columns]";
        DetailsViewConstants.columnCountConfigurationLabel = "[Column configuration]";
        DetailsViewConstants.columnCountInputCssClass = "columnCountInput";
        // EmailBodyView constants
        DetailsViewConstants.emailBodyTitle = "[Body size]";
        DetailsViewConstants.emailBodyMaxWidthLabel = "[Body max width px]";
        DetailsViewConstants.emailBodyMaxWidthInputCssClass = "emailBodyMaxWidthInput";
        DetailsViewConstants.emailBodyMaxHeightLabel = "[Body max height px]";
        DetailsViewConstants.emailBodyMaxHeightInputCssClass = "emailBodyMaxHeightInput";
        DetailsViewConstants.maxHeightAttribute = "max-height";
        DetailsViewConstants.emptyStylesViewMessage = "[Empty Styles View Message]";
        DetailsViewConstants.emailBodyStyles = "[General layout]";
        // FormBodyView constants
        DetailsViewConstants.formBodyTitle = "[Form size]";
        DetailsViewConstants.formBodyMaxWidthLabel = "[Form max width px]";
        DetailsViewConstants.formBodyMaxWidthInputCssClass = "formBodyMaxWidthInput";
        DetailsViewConstants.formBodyMaxHeightLabel = "[Form max height px]";
        DetailsViewConstants.formBodyMaxHeightInputCssClass = "formBodyMaxHeightInput";
        DetailsViewConstants.formBodyStyles = "[General layout]";
        DetailsViewConstants.dataId = "data-id";
        DetailsViewConstants.createContent = "[Choose an element to start designing your email]";
        DetailsViewConstants.learnMore = "[Learn more]";
        // ColorPickerInput constants
        DetailsViewConstants.fontColor = "[Font Color]";
        DetailsViewConstants.backgroundColor = "[Background Color]";
        return DetailsViewConstants;
    }());
    Editor.DetailsViewConstants = DetailsViewConstants;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var DetailsViewPropertiesUtils = /** @class */ (function () {
        function DetailsViewPropertiesUtils() {
        }
        DetailsViewPropertiesUtils.addPadding = function (detailsViewControl, selectedBlock, section, notifyChanges, limitOnMin, limitOnMax, addToSubsection, dimensionHolder) {
            var _this = this;
            var minLimit = limitOnMin | DetailsViewPropertiesUtils.limitOnMinDefault;
            var maxLimit = limitOnMax | DetailsViewPropertiesUtils.limitOnMaxDefault;
            var inputSuffix = addToSubsection ? null : Editor.DetailsViewConstants.pixels;
            var topLabelKey = addToSubsection ? Editor.DetailsViewConstants.topAlignmentLabel : Editor.DetailsViewConstants.paddingTopLabel;
            var topReactValidate = addToSubsection ?
                function (val) { _this.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock[0], Editor.DetailsViewConstants.paddingTopAttribute, notifyChanges); }
                : function (val) { _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.paddingTopAttribute, notifyChanges); };
            detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(topLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingTopInputCssClass, this.getPadding(selectedBlock, Editor.DetailsViewConstants.paddingTopAttribute, minLimit), this.getSpacingInputAttributes(minLimit, maxLimit, Editor.DetailsViewConstants.paddingTopInputCssClass, false), function (inputField) {
                _this.onPaddingFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.paddingTopAttribute, minLimit, maxLimit, notifyChanges);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, topReactValidate, inputSuffix);
            var bottomLabelKey = addToSubsection ? Editor.DetailsViewConstants.bottomAlignmentLabel : Editor.DetailsViewConstants.paddingBottomLabel;
            var bottomReactValidate = addToSubsection ?
                function (val) { _this.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock[0], Editor.DetailsViewConstants.paddingBottomAttribute, notifyChanges); }
                : function (val) { _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.paddingBottomAttribute, notifyChanges); };
            detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(bottomLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingBottomInputCssClass, this.getPadding(selectedBlock, Editor.DetailsViewConstants.paddingBottomAttribute, minLimit), this.getSpacingInputAttributes(minLimit, maxLimit, Editor.DetailsViewConstants.paddingBottomInputCssClass, false), function (inputField) {
                _this.onPaddingFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.paddingBottomAttribute, minLimit, maxLimit, notifyChanges);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, bottomReactValidate, inputSuffix);
            var leftLabelKey = addToSubsection ? Editor.DetailsViewConstants.leftAlignmentLabel : Editor.DetailsViewConstants.paddingLeftLabel;
            var leftReactValidate = addToSubsection ?
                function (val) { _this.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock[0], Editor.DetailsViewConstants.paddingLeftAttribute, notifyChanges); }
                : function (val) { _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.paddingLeftAttribute, notifyChanges); };
            if (!!dimensionHolder) {
                this.addPaddingOrMarginInDirection(detailsViewControl, selectedBlock, section, notifyChanges, dimensionHolder, minLimit, maxLimit, Editor.DimensionHolder.FIRST_PADDING_POSITION, leftLabelKey, Editor.DetailsViewConstants.paddingLeftInputCssClass, Editor.DetailsViewConstants.paddingLeftAttribute, false, inputSuffix, false);
            }
            else {
                detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(leftLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingLeftInputCssClass, this.getPadding(selectedBlock, Editor.DetailsViewConstants.paddingLeftAttribute, minLimit), this.getSpacingInputAttributes(minLimit, maxLimit, Editor.DetailsViewConstants.paddingLeftInputCssClass, false), function (inputField) {
                    _this.onPaddingFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.paddingLeftAttribute, minLimit, maxLimit, notifyChanges);
                }, Editor.InputValidationsConstants.positiveIntNotEmpty, leftReactValidate, inputSuffix);
            }
            var rightLabelKey = addToSubsection ? Editor.DetailsViewConstants.rightAlignmentLabel : Editor.DetailsViewConstants.paddingRightLabel;
            var rightReactValidate = addToSubsection ?
                function (val) { _this.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock[0], Editor.DetailsViewConstants.paddingRightAttribute, notifyChanges); }
                : function (val) { _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.paddingRightAttribute, notifyChanges); };
            if (!!dimensionHolder) {
                this.addPaddingOrMarginInDirection(detailsViewControl, selectedBlock, section, notifyChanges, dimensionHolder, minLimit, maxLimit, Editor.DimensionHolder.SECOND_PADDING_POSITION, rightLabelKey, Editor.DetailsViewConstants.paddingRightInputCssClass, Editor.DetailsViewConstants.paddingRightAttribute, false, inputSuffix, false);
            }
            else {
                detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(rightLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingRightInputCssClass, this.getPadding(selectedBlock, Editor.DetailsViewConstants.paddingRightAttribute, minLimit), this.getSpacingInputAttributes(minLimit, maxLimit, Editor.DetailsViewConstants.paddingRightInputCssClass, false), function (inputField) {
                    _this.onPaddingFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.paddingRightAttribute, minLimit, maxLimit, notifyChanges);
                }, Editor.InputValidationsConstants.positiveIntNotEmpty, rightReactValidate, inputSuffix);
            }
        };
        DetailsViewPropertiesUtils.addMargin = function (detailsViewControl, selectedBlock, section, notifyChanges, limitOnMin, limitOnMax, addToSubsection, dimensionHolder, isDisabled) {
            var _this = this;
            var minLimit = limitOnMin | DetailsViewPropertiesUtils.limitOnMinDefault;
            var maxLimit = limitOnMax | DetailsViewPropertiesUtils.limitOnMaxDefault;
            var inputSuffix = addToSubsection ? null : Editor.DetailsViewConstants.pixels;
            var topLabelKey = addToSubsection ? Editor.DetailsViewConstants.topAlignmentLabel : Editor.DetailsViewConstants.marginTopLabel;
            var topReactValidate = addToSubsection ?
                function (val) { _this.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock[0], Editor.DetailsViewConstants.marginTopAttribute, notifyChanges); }
                : function (val) { _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.marginTopAttribute, notifyChanges); };
            detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(topLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginTopInputCssClass, this.getMargin(selectedBlock, Editor.DetailsViewConstants.marginTopAttribute, minLimit), this.getSpacingInputAttributes(minLimit, maxLimit, Editor.DetailsViewConstants.marginTopInputCssClass, isDisabled), function (inputField) {
                _this.onMarginFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.marginTopAttribute, minLimit, maxLimit, notifyChanges);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, topReactValidate, inputSuffix);
            var bottomLabelKey = addToSubsection ? Editor.DetailsViewConstants.bottomAlignmentLabel : Editor.DetailsViewConstants.marginBottomLabel;
            var bottomReactValidate = addToSubsection ?
                function (val) { _this.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock[0], Editor.DetailsViewConstants.marginBottomAttribute, notifyChanges); }
                : function (val) { _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.marginBottomAttribute, notifyChanges); };
            detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(bottomLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginBottomInputCssClass, this.getMargin(selectedBlock, Editor.DetailsViewConstants.marginBottomAttribute, minLimit), this.getSpacingInputAttributes(minLimit, maxLimit, Editor.DetailsViewConstants.marginBottomInputCssClass, isDisabled), function (inputField) {
                _this.onMarginFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.marginBottomAttribute, minLimit, maxLimit, notifyChanges);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, bottomReactValidate, inputSuffix);
            var leftLabelKey = addToSubsection ? Editor.DetailsViewConstants.leftAlignmentLabel : Editor.DetailsViewConstants.marginLeftLabel;
            var leftReactValidate = addToSubsection ?
                function (val) { _this.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock[0], Editor.DetailsViewConstants.marginLeftAttribute, notifyChanges); }
                : function (val) { _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.marginLeftAttribute, notifyChanges); };
            if (!!dimensionHolder) {
                this.addPaddingOrMarginInDirection(detailsViewControl, selectedBlock, section, notifyChanges, dimensionHolder, minLimit, maxLimit, Editor.DimensionHolder.FIRST_MARGIN_POSITION, leftLabelKey, Editor.DetailsViewConstants.marginLeftInputCssClass, Editor.DetailsViewConstants.marginLeftAttribute, true, inputSuffix, isDisabled);
            }
            else {
                detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(leftLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginLeftInputCssClass, this.getMargin(selectedBlock, Editor.DetailsViewConstants.marginLeftAttribute, minLimit), this.getSpacingInputAttributes(minLimit, maxLimit, Editor.DetailsViewConstants.marginLeftInputCssClass, isDisabled), function (inputField) {
                    _this.onMarginFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.marginLeftAttribute, minLimit, maxLimit, notifyChanges);
                }, Editor.InputValidationsConstants.positiveIntNotEmpty, leftReactValidate, inputSuffix);
            }
            var rightLabelKey = addToSubsection ? Editor.DetailsViewConstants.rightAlignmentLabel : Editor.DetailsViewConstants.marginRightLabel;
            var rightReactValidate = addToSubsection ?
                function (val) { _this.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock[0], Editor.DetailsViewConstants.marginRightAttribute, notifyChanges); }
                : function (val) { _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.marginRightAttribute, notifyChanges); };
            if (!!dimensionHolder) {
                this.addPaddingOrMarginInDirection(detailsViewControl, selectedBlock, section, notifyChanges, dimensionHolder, minLimit, maxLimit, Editor.DimensionHolder.SECOND_MARGIN_POSITION, rightLabelKey, Editor.DetailsViewConstants.marginRightInputCssClass, Editor.DetailsViewConstants.marginRightAttribute, true, inputSuffix, isDisabled);
            }
            else {
                detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(rightLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginRightInputCssClass, this.getMargin(selectedBlock, Editor.DetailsViewConstants.marginRightAttribute, minLimit), this.getSpacingInputAttributes(minLimit, maxLimit, Editor.DetailsViewConstants.marginRightInputCssClass, isDisabled), function (inputField) {
                    _this.onMarginFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.marginRightAttribute, minLimit, maxLimit, notifyChanges);
                }, Editor.InputValidationsConstants.positiveIntNotEmpty, rightReactValidate, inputSuffix);
            }
        };
        DetailsViewPropertiesUtils.addPaddingSubsection = function (detailsViewControl, selectedBlock, section, notifyChanges, minLimit, maxLimit, dimensionHolder) {
            var paddingSubsection = detailsViewControl.createSubsection(section, Editor.DetailsViewConstants.paddingSubsectionCssClass, MktSvc.Controls.Common.UniqueId.generate(Editor.DetailsViewConstants.paddingSubsectionCssClass), Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.paddingSubsectionLabel));
            paddingSubsection
                .find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            this.addPadding(detailsViewControl, selectedBlock, paddingSubsection, notifyChanges, minLimit, maxLimit, true, dimensionHolder);
        };
        DetailsViewPropertiesUtils.addMarginSubsection = function (detailsViewControl, selectedBlock, section, notifyChanges, minLimit, maxLimit, dimensionHolder, isDisabled) {
            var marginSubsection = detailsViewControl.createSubsection(section, Editor.DetailsViewConstants.marginSubsectionCssClass, MktSvc.Controls.Common.UniqueId.generate(Editor.DetailsViewConstants.marginSubsectionCssClass), Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.marginSubsectionLabel));
            marginSubsection
                .find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            this.addMargin(detailsViewControl, selectedBlock, marginSubsection, notifyChanges, minLimit, maxLimit, true, dimensionHolder, isDisabled);
        };
        DetailsViewPropertiesUtils.addPaddingOrMarginInDirection = function (detailsViewControl, selectedBlock, section, notifyChanges, dimensionHolder, minLimit, maxLimit, dimensionHolderPosition, inputLabel, inputCssClass, cssAttributeName, isMargin, inputSuffix, isDisabled) {
            var _this = this;
            var paddingOrMarginValueInDirection = isMargin ?
                this.getMargin(selectedBlock, cssAttributeName, minLimit)
                : this.getPadding(selectedBlock, cssAttributeName, minLimit);
            var reactValidate = inputSuffix ?
                function (val) { _this.onReactValidate(val, selectedBlock[0], cssAttributeName, notifyChanges); } :
                function (val) { _this.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock[0], cssAttributeName, notifyChanges); };
            dimensionHolder.createDimensionField(dimensionHolderPosition, parseFloat(paddingOrMarginValueInDirection), function (updateHandler, validateHandler) {
                return detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(inputLabel), Editor.DetailsViewConstants.inputTypeNumber, inputCssClass, paddingOrMarginValueInDirection, _this.getSpacingInputAttributes(minLimit, maxLimit, inputCssClass, isDisabled), function (inputField) {
                    updateHandler(inputField);
                }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val, event) {
                    validateHandler(val);
                }, inputSuffix);
            }, selectedBlock, function (inputField, propagateEvent) {
                if (isMargin) {
                    _this.onMarginFieldUpdated(selectedBlock, inputField, cssAttributeName, minLimit, maxLimit, notifyChanges);
                }
                else {
                    _this.onPaddingFieldUpdated(selectedBlock, inputField, cssAttributeName, minLimit, maxLimit, notifyChanges);
                }
            }, reactValidate);
        };
        DetailsViewPropertiesUtils.getPadding = function (selectedBlock, paddingAttribute, minLimit) {
            var padding = selectedBlock.css(paddingAttribute);
            var px = "px";
            var none = "none";
            if (Utility.isNullOrUndefined(padding) || padding === "" || padding === px || padding === none) {
                padding = minLimit.toString();
            }
            else {
                padding = Editor.CommonUtils.getOnlyPixelsValueFromString(padding).toString();
            }
            return padding;
        };
        DetailsViewPropertiesUtils.onPaddingFieldUpdated = function (selectedBlock, inputElement, paddingAttribute, minLimit, maxLimit, notifyChanges) {
            var padding = inputElement.val();
            if (padding > maxLimit || padding < minLimit) {
                padding = minLimit;
                inputElement.val(padding);
            }
            selectedBlock.css(paddingAttribute, padding + "px");
            notifyChanges(this.eventBroker, this.containerId, selectedBlock);
        };
        DetailsViewPropertiesUtils.getMargin = function (selectedBlock, marginAttribute, minLimit) {
            var margin = selectedBlock.css(marginAttribute);
            var px = "px";
            var none = "none";
            if (Utility.isNullOrUndefined(margin) || margin === "" || margin === px || margin === none) {
                margin = minLimit.toString();
            }
            else {
                margin = Editor.CommonUtils.getOnlyPixelsValueFromString(margin).toString();
            }
            return margin;
        };
        DetailsViewPropertiesUtils.onMarginFieldUpdated = function (selectedBlock, inputElement, marginAttribute, minLimit, maxLimit, notifyChanges) {
            var margin = inputElement.val();
            if (margin > maxLimit || margin < minLimit) {
                margin = minLimit;
                inputElement.val(margin);
            }
            selectedBlock.css(marginAttribute, margin + "px");
            notifyChanges(this.eventBroker, this.containerId, selectedBlock);
        };
        DetailsViewPropertiesUtils.onReactValidate = function (val, element, cssPropertyName, notifyChanges) {
            var _this = this;
            element.style[cssPropertyName] = val;
            this.spinButtonDebounce(function () { return notifyChanges(_this.eventBroker, _this.containerId, $(element)); }, Editor.DetailsViewConstants.spinButtonDebounceTime);
        };
        DetailsViewPropertiesUtils.spinButtonDebounce = function (func, wait) {
            var later = function () {
                this.spinButtonDebounceTimeout = null;
                func.apply(this, arguments);
            };
            clearTimeout(this.spinButtonDebounceTimeout);
            this.spinButtonDebounceTimeout = setTimeout(later.bind(this), wait);
        };
        DetailsViewPropertiesUtils.getSpacingInputAttributes = function (minLimit, maxLimit, cssClass, isDisabled) {
            return {
                min: minLimit,
                max: maxLimit,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(cssClass),
                disabled: isDisabled
            };
        };
        DetailsViewPropertiesUtils.limitOnMinDefault = 0;
        DetailsViewPropertiesUtils.limitOnMaxDefault = 500;
        return DetailsViewPropertiesUtils;
    }());
    Editor.DetailsViewPropertiesUtils = DetailsViewPropertiesUtils;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DimensionHolder = /** @class */ (function () {
        function DimensionHolder() {
            this.itemDimensions = [0, 0, 0, 0, 0];
            this.itemSetters = this.getEmptyHandlers();
            this.isRedimensioning = false;
            this.spinButtonDebounceTimeout = null;
        }
        DimensionHolder.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
        };
        DimensionHolder.prototype.setTotalDimension = function (totalDimension) {
            this.totalDimension = totalDimension;
        };
        DimensionHolder.prototype.createDimensionField = function (dimensionPosition, dimension, createField, block, htmlUpdateHandler, htmlValidateHandler) {
            var _this = this;
            this.itemDimensions[dimensionPosition] = isNaN(dimension) ? 0 : dimension;
            var field = createField(function (inputField) { return _this.handleUpdate(dimensionPosition, inputField, block, htmlUpdateHandler); }, function (value) { return htmlValidateHandler(value, !_this.isRedimensioning); });
            this.itemSetters[dimensionPosition] = function (val) {
                var input = field.find("input");
                input.val(val + "px");
                input.trigger("inputset");
            };
        };
        DimensionHolder.prototype.getEmptyHandlers = function () {
            return [function () { }, function () { }, function () { }, function () { }, function () { }];
        };
        DimensionHolder.prototype.handleUpdate = function (dimensionPosition, inputField, block, htmlUpdateHandler) {
            if (this.isRedimensioning) {
                htmlUpdateHandler(inputField, false);
                return;
            }
            var newValue = parseFloat(inputField.val());
            this.itemDimensions[dimensionPosition] = isNaN(newValue) ? 0 : newValue;
            if (this.computeItemTotalDimension() <= this.totalDimension
                || this.totalDimension === 0
                || isNaN(this.totalDimension)) {
                htmlUpdateHandler(inputField, true);
                return;
            }
            this.isRedimensioning = true;
            this.reDimension(dimensionPosition, block);
            this.isRedimensioning = false;
        };
        DimensionHolder.prototype.computeItemTotalDimension = function () {
            return this.itemDimensions.reduce(function (acc, curr) { return acc + curr; }, 0);
        };
        DimensionHolder.prototype.reDimension = function (changeSourcePosition, block) {
            var _this = this;
            var redimensionSpace = this.itemDimensions.reduce(function (acc, curr, index) {
                return index !== changeSourcePosition ? (acc + curr) : acc;
            }, 0);
            if (redimensionSpace === 0) {
                var updatedChangeDimensionValue = Math.min(this.itemDimensions[changeSourcePosition], this.totalDimension);
                this.itemDimensions[changeSourcePosition] = updatedChangeDimensionValue;
                this.itemSetters[changeSourcePosition](updatedChangeDimensionValue);
                return;
            }
            var mainDimensionUpdated = this.isMainDimension(changeSourcePosition);
            var marginOrPaddingUpdated = this.isMarginOrPaddingDimension(changeSourcePosition);
            var reduceBy = Math.max(this.computeItemTotalDimension() - this.totalDimension, 0);
            // Do the redimensioning
            var reduceLeftAfterRedimensioning = this.itemDimensions.reduce(function (reduceLeft, curr, index) {
                if (index === changeSourcePosition || reduceLeft === 0) {
                    return reduceLeft;
                }
                var newCurr = Math.max(curr - reduceLeft, 0);
                var newLeft = reduceLeft - (curr - newCurr);
                if (_this.itemDimensions[index] !== newCurr) {
                    _this.itemDimensions[index] = newCurr;
                    _this.itemSetters[index](newCurr);
                    if (_this.isMainDimension(index)) {
                        mainDimensionUpdated = true;
                    }
                    if (_this.isMarginOrPaddingDimension(index)) {
                        marginOrPaddingUpdated = true;
                    }
                }
                return newLeft;
            }, reduceBy);
            if (reduceLeftAfterRedimensioning > 0) {
                var updatedChangeDimensionValue = this.totalDimension;
                this.itemDimensions[changeSourcePosition] = updatedChangeDimensionValue;
                this.itemSetters[changeSourcePosition](updatedChangeDimensionValue);
            }
            else {
                var updatedDimensionValue = this.itemDimensions[changeSourcePosition];
                this.itemSetters[changeSourcePosition](updatedDimensionValue);
            }
            if (mainDimensionUpdated) {
                this.notifyMainDimensionUpdated(block);
            }
            else if (marginOrPaddingUpdated) {
                this.notifyPaddingOrMarginUpdated();
            }
        };
        DimensionHolder.prototype.isMainDimension = function (dimensionPosition) {
            return dimensionPosition === DimensionHolder.MAIN_DIMENSION_POSITION;
        };
        DimensionHolder.prototype.isMarginOrPaddingDimension = function (dimensionPosition) {
            return dimensionPosition !== DimensionHolder.MAIN_DIMENSION_POSITION;
        };
        DimensionHolder.prototype.notifyMainDimensionUpdated = function (block) {
            var _this = this;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(this.containerId, block));
            this.spinButtonDebounce(function () {
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(_this.containerId));
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(_this.containerId));
            }, Editor.DetailsViewConstants.spinButtonDebounceTime);
        };
        DimensionHolder.prototype.notifyPaddingOrMarginUpdated = function () {
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        DimensionHolder.prototype.spinButtonDebounce = function (func, wait) {
            var later = function () {
                this.spinButtonDebounceTimeout = null;
                func.apply(this, arguments);
            };
            clearTimeout(this.spinButtonDebounceTimeout);
            this.spinButtonDebounceTimeout = setTimeout(later.bind(this), wait);
        };
        /* Width or height */
        DimensionHolder.MAIN_DIMENSION_POSITION = 0;
        /* Top or left margin */
        DimensionHolder.FIRST_MARGIN_POSITION = 1;
        /* Right or bottom margin */
        DimensionHolder.SECOND_MARGIN_POSITION = 2;
        /* Top or left padding */
        DimensionHolder.FIRST_PADDING_POSITION = 3;
        /* Right or bottom padding */
        DimensionHolder.SECOND_PADDING_POSITION = 4;
        return DimensionHolder;
    }());
    Editor.DimensionHolder = DimensionHolder;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 *
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * Divider Details View
     */
    var DividerDetailsView = /** @class */ (function () {
        function DividerDetailsView(detailsViewControl) {
            this.limitOnMin = 0;
            this.limitOnMax = 500;
            this.minWidth = 1;
            this.maxWidth = 100;
            this.detailsViewControl = detailsViewControl;
            this.editorFeatureServiceClient = Editor.EditorFeatureServiceClient.instance;
        }
        /**
         * Initializes form control
         */
        DividerDetailsView.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.detailsViewControl.init(this.containerId, this.eventBroker);
        };
        /**
         * Disposes the form control
         */
        DividerDetailsView.prototype.dispose = function () {
            this.detailsViewControl.dispose();
        };
        /**
         * Renders the form control
         */
        DividerDetailsView.prototype.render = function (selectedBlock) {
            this.clearContainer();
            var dividerSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.dividerSectionLabel));
            dividerSection[0].style.width = "100%";
            this.addWidthRange(selectedBlock, dividerSection);
            this.addColorInputField(selectedBlock, dividerSection);
            this.addPosition(selectedBlock);
        };
        DividerDetailsView.prototype.addWidthRange = function (selectedBlock, section) {
            var _this = this;
            this.detailsViewControl.createRange(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.widthLabel), this.minWidth, this.maxWidth, Editor.DetailsViewConstants.dividerWidthInputCssClass, this.getWidth(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.dividerWidthInputCssClass)
            }, function (inputField) {
                _this.onWidthFieldUpdated(selectedBlock, inputField);
            });
        };
        DividerDetailsView.prototype.addColorInputField = function (selectedBlock, section) {
            var _this = this;
            this.detailsViewControl.createInputColorField(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.colorLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.colorInputCssClass, this.getColor(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.colorInputCssClass),
                placeholder: "#000000"
            }, function (inputField) {
                _this.onColorFieldUpdated(selectedBlock, inputField);
            });
        };
        DividerDetailsView.prototype.getWidth = function ($block) {
            // Get with percentage
            var element = this.getTable($block).get(0);
            var elementWidth = element && element.style.width;
            if (elementWidth) {
                if (elementWidth.indexOf("px") !== -1) {
                    var value = elementWidth.replace(/px/g, String.Empty);
                    var wrapper = element.parentElement.clientWidth;
                    if (Editor.CommonUtils.isInternetExplorer()) {
                        var dividerWrapper = $block.find("." + Editor.CommonConstants.dividerWrapper);
                        if (dividerWrapper && dividerWrapper.length) {
                            wrapper = dividerWrapper[0].clientWidth;
                        }
                    }
                    if (wrapper && value) {
                        return Math.round((parseInt(value) / wrapper) * 100).toString();
                    }
                    return String.Empty;
                }
                return elementWidth.replace(/%/g, String.Empty);
            }
            return this.maxWidth.toString();
        };
        DividerDetailsView.prototype.onWidthFieldUpdated = function (selectedBlock, inputElement) {
            var width = inputElement.val();
            if (width > this.maxWidth || width < this.minWidth) {
                width = this.maxWidth;
                inputElement.val(width);
            }
            var $table = this.getTable(selectedBlock);
            $table.css(Editor.DetailsViewConstants.widthAttribute, width + "%");
            //ARIA - for the divider tool, the screenreader should read the width
            var $tableCkWrapper = selectedBlock.find("[" + Editor.CommonConstants.ckEditorAttrName + "]");
            var ariaLabel = $tableCkWrapper.attr("aria-label");
            var widthTranslated = Editor.CommonUtils.getLocalizedString("[Width]");
            if (!Utility.isNullOrUndefined(ariaLabel) && ariaLabel.indexOf(widthTranslated) === -1) {
                ariaLabel = ariaLabel + (" " + widthTranslated + " = %.");
            }
            var regExpPattern = "(" + widthTranslated + ")(.+?)(?= %.)";
            var regExp = new RegExp(regExpPattern);
            ariaLabel = !Utility.isNullOrUndefined(ariaLabel) ? ariaLabel.replace(regExp, "$1 = " + width) : ariaLabel;
            $tableCkWrapper.attr("aria-label", ariaLabel);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        DividerDetailsView.prototype.getTable = function (block) {
            return block.find(Editor.DetailsViewConstants.tableTag);
        };
        DividerDetailsView.prototype.getColor = function ($block) {
            var value = this.getParagraph($block).css(Editor.DetailsViewConstants.colorAttribute);
            if (Utility.isNullOrUndefined(value)) {
                value = String.Empty;
            }
            return Editor.ColorUtils.rgbToHex(value);
        };
        DividerDetailsView.prototype.onColorFieldUpdated = function (selectedBlock, inputElement) {
            var color = inputElement.val();
            var $paragraph = this.getParagraph(selectedBlock);
            $paragraph.css(Editor.DetailsViewConstants.colorAttribute, color);
            //ARIA - for the divider tool, the screenreader should read the color
            var $paragraphCkWrapper = selectedBlock.find("[" + Editor.CommonConstants.ckEditorAttrName + "]");
            var ariaLabel = $paragraphCkWrapper.attr("aria-label");
            var colorTranslated = Editor.CommonUtils.getLocalizedString("[Color]");
            if (!Utility.isNullOrUndefined(ariaLabel) && ariaLabel.indexOf(colorTranslated) === -1) {
                ariaLabel = ariaLabel + (" " + colorTranslated + " = .");
            }
            var regExpPattern = "(" + colorTranslated + ")(.+?)(?= \\.)";
            var regExp = new RegExp(regExpPattern);
            ariaLabel = !Utility.isNullOrUndefined(ariaLabel) ? ariaLabel.replace(regExp, "$1 = " + color) : ariaLabel;
            $paragraphCkWrapper.attr("aria-label", ariaLabel);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        DividerDetailsView.prototype.getParagraph = function (block) {
            return block.find(Editor.DetailsViewConstants.pTag);
        };
        DividerDetailsView.prototype.addPosition = function (selectedBlock) {
            Editor.DetailsViewPropertiesUtils.eventBroker = this.eventBroker;
            Editor.DetailsViewPropertiesUtils.containerId = this.containerId;
            var section = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.spacingTitle));
            section.find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            Editor.DetailsViewPropertiesUtils.addPaddingSubsection(this.detailsViewControl, selectedBlock, section, this.notifyChanges, this.limitOnMin, this.limitOnMax);
            Editor.DetailsViewPropertiesUtils.addMarginSubsection(this.detailsViewControl, selectedBlock, section, this.notifyChanges, this.limitOnMin, this.limitOnMax);
        };
        DividerDetailsView.prototype.notifyChanges = function (eventBroker, containerId) {
            eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(containerId));
        };
        DividerDetailsView.prototype.getTableCell = function (block) {
            return block.find(Editor.DetailsViewConstants.tdTag);
        };
        DividerDetailsView.prototype.clearContainer = function () {
            Editor.CommonUtils.getById(this.containerId).empty();
        };
        DividerDetailsView.prototype.onReactValidate = function (val, element, cssPropertyName) {
            var _this = this;
            element.style[cssPropertyName] = val;
            this.spinButtonDebounce(function () { return _this.notifyChanges(_this.eventBroker, _this.containerId); }, Editor.DetailsViewConstants.spinButtonDebounceTime);
        };
        DividerDetailsView.prototype.spinButtonDebounce = function (func, wait) {
            var later = function () {
                this.spinButtonDebounceTimeout = null;
                func.apply(this, arguments);
            };
            clearTimeout(this.spinButtonDebounceTimeout);
            this.spinButtonDebounceTimeout = setTimeout(later.bind(this), wait);
        };
        return DividerDetailsView;
    }());
    Editor.DividerDetailsView = DividerDetailsView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var ButtonDetailsView = /** @class */ (function () {
        function ButtonDetailsView(linkSectionLabel, buttonCommonDetailsView, detailsViewControl) {
            this.linkSectionLabel = linkSectionLabel;
            this.buttonCommonDetailsView = buttonCommonDetailsView;
            this.detailsViewControl = detailsViewControl;
        }
        /**
         * @see IBlockDetailsView.init
         */
        ButtonDetailsView.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.detailsViewControl.init(this.containerId, this.eventBroker);
            this.buttonCommonDetailsView.init(eventBroker, containerId);
        };
        /**
         * @see IBlockDetailsView.dispose
         */
        ButtonDetailsView.prototype.dispose = function () {
            this.detailsViewControl.dispose();
            this.buttonCommonDetailsView.dispose();
        };
        /**
         * @see IBlockDetailsView.render
         */
        ButtonDetailsView.prototype.render = function (selectedBlock) {
            this.clearContainer();
            this.renderLinkSection(selectedBlock);
            this.updateAriaAttr(selectedBlock);
            this.buttonCommonDetailsView.render(selectedBlock);
        };
        ButtonDetailsView.prototype.getAnchor = function (block) {
            return block.find(Editor.DetailsViewConstants.anchorTag);
        };
        ButtonDetailsView.prototype.renderLinkSection = function (selectedBlock) {
            var _this = this;
            this.linkSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(this.linkSectionLabel));
            this.detailsViewControl.createLinkField(this.linkSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.buttonLinkLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.buttonLinkInputCssClass, this.getButtonLink(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.buttonLinkInputCssClass)
            }, function (inputField) {
                _this.onLinkFieldUpdated(selectedBlock, inputField);
            }, { hasFocus: false });
        };
        ButtonDetailsView.prototype.getButtonLink = function ($block) {
            var value = this.getAnchor($block).attr(Editor.DetailsViewConstants.hrefAttribute);
            if (Utility.isNullOrUndefined(value)) {
                value = String.Empty;
            }
            return value;
        };
        ButtonDetailsView.prototype.onLinkFieldUpdated = function (selectedBlock, inputElement) {
            var url = Editor.CommonUtils.getLinkWithProtocol(inputElement.val());
            var $anchor = this.getAnchor(selectedBlock);
            $anchor.attr(Editor.DetailsViewConstants.hrefAttribute, url);
            var eventArgs = new Editor.HrefAttributeChangedEventArgs($anchor, url);
            this.eventBroker.notify(Editor.EventConstants.hrefAttributeChanged, eventArgs);
            this.eventBroker.notify(selectedBlock.attr(Editor.Contract.blockTypeAttrName) + "_" + Editor.EventConstants.hrefAttributeChanged, eventArgs);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged);
        };
        ButtonDetailsView.prototype.clearContainer = function () {
            Editor.CommonUtils.getById(this.containerId).empty();
        };
        ButtonDetailsView.prototype.isConfigured = function (block) {
            var href = this.getButtonLink(block);
            return !String.isNullUndefinedOrWhitespace(href) && href !== "#";
        };
        ButtonDetailsView.prototype.updateAriaAttr = function (selectedBlock) {
            var anchor = this.getAnchor(selectedBlock);
            var wrapper = Editor.BlockProvider.getEditableElement(selectedBlock);
            var ariaLabel = selectedBlock.attr("aria-label");
            if (this.isConfigured(selectedBlock)) {
                ariaLabel += " " + anchor.text();
            }
            wrapper.attr("aria-label", ariaLabel);
        };
        return ButtonDetailsView;
    }());
    Editor.ButtonDetailsView = ButtonDetailsView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var ImageDetailsView = /** @class */ (function () {
        function ImageDetailsView(detailsViewControl, blockDefinition, fcbList) {
            this.detailsViewControl = detailsViewControl;
            this.blockDefinition = blockDefinition;
            this.fcbList = fcbList;
            this.limitOnMin = 0;
            this.limitOnMax = 500;
            this.detailsViewControl = detailsViewControl;
            this.blockDefinition = blockDefinition;
        }
        ImageDetailsView.prototype.init = function (eventBroker, containerId, isDisabled) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.isDisabled = isDisabled;
            this.detailsViewControl.init(this.containerId, this.eventBroker);
            this.imageStylesDetailsView = new Editor.ImageStylesDetailsViewRenderer(this.detailsViewControl, this, this.fcbList);
        };
        ImageDetailsView.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.detailsViewControl)) {
                this.detailsViewControl.dispose();
            }
            this.eventBroker = null;
            this.clearContainer();
            this.imageStylesDetailsView.dispose();
        };
        ImageDetailsView.prototype.render = function (selectedBlock) {
            this.clearContainer();
            this.imageStylesDetailsView.render(selectedBlock);
            this.mainSection = this.imageStylesDetailsView.mainSection;
            this.addPosition(selectedBlock, this.isDisabled);
        };
        ImageDetailsView.prototype.getBorderRadius = function (section) {
            var image = section.getElementsByTagName("img").item(0);
            return Editor.CommonUtils.getBorderRadius(image).toString();
        };
        ImageDetailsView.prototype.onBorderRadiusFieldUpdated = function (selectedBlock, inputElement) {
            var width = inputElement.val();
            var image = selectedBlock.getElementsByTagName("img").item(0);
            image.style.borderRadius = width + "px";
            this.notifyAboutChanges();
        };
        ImageDetailsView.prototype.notifyAboutChanges = function () {
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ImageDetailsView.prototype.getBackgroundImage = function (section) {
            var backgroundImage = section.style.backgroundImage;
            if (!Utility.isNullOrUndefined(backgroundImage) && backgroundImage !== "") {
                backgroundImage = backgroundImage.replace("url(\"", "");
                backgroundImage = backgroundImage.substr(0, backgroundImage.length - 2);
                return backgroundImage;
            }
            return undefined;
        };
        ImageDetailsView.prototype.getImgAttributeInitialValue = function (block, attr) {
            var $block = $(block);
            var value = this.getImage(block).attr(attr);
            value = Utility.isNullOrUndefined(value) ? "" : value;
            if (!this.blockDefinition.isConfigured($block)) {
                value = "";
            }
            return value;
        };
        ImageDetailsView.prototype.getLinkWrapperHrefValue = function (block) {
            return this.getLinkWrapperOfImg(this.getImage(block)).attr(Editor.DetailsViewConstants.hrefAttribute);
        };
        ImageDetailsView.prototype.getImageAlignment = function (selectedBlock) {
            var imageWrapper = this.getImageWrapper($(selectedBlock));
            imageWrapper.attr("width", "100%");
            imageWrapper.attr("display", "inline-block");
            return imageWrapper.attr(Editor.DetailsViewConstants.alignAttribute)
                ? imageWrapper.attr(Editor.DetailsViewConstants.alignAttribute)
                : "";
        };
        ImageDetailsView.prototype.handleWidthHeightSpecific = function (img, attr, value) {
            var maxProperty = attr === Editor.DetailsViewConstants.imgWidthAttribute
                ? Editor.DetailsViewConstants.imgMaxWidthCssProperty
                : Editor.DetailsViewConstants.imgMaxHeightCssProperty;
            var imgParent = $(img).parent();
            var isImageResizable = imgParent && imgParent.length && imgParent.hasClass(Editor.CommonConstants.resizableWrapper);
            if (String.isNullOrEmpty(value)) {
                this.removeValueAndSetMax(img, attr, maxProperty);
                if (isImageResizable) {
                    this.removeValueAndSetMax(imgParent[0], attr, maxProperty);
                }
            }
            else {
                // inline styling with !important for ios rendering
                this.setValueAndRemoveMax(img, attr, maxProperty, value);
                if (isImageResizable) {
                    this.setValueAndRemoveMax(imgParent[0], attr, maxProperty, value);
                }
            }
        };
        ImageDetailsView.prototype.removeValueAndSetMax = function (element, attr, maxProperty) {
            element.style.removeProperty(attr);
            element.style.setProperty(maxProperty, "100%");
        };
        ImageDetailsView.prototype.setValueAndRemoveMax = function (element, attr, maxProperty, value) {
            element.style.setProperty(attr, value + "px", "important");
            element.style.removeProperty(maxProperty);
        };
        ImageDetailsView.prototype.onImgAttributeFieldUpdated = function (selectedBlock, value, attr) {
            var img = this.getImage(selectedBlock);
            img.attr(attr, value);
            if (attr === Editor.DetailsViewConstants.imgWidthAttribute || attr === Editor.DetailsViewConstants.imgHeightAttribute) {
                this.handleWidthHeightSpecific(img[0], attr, value);
            }
            if (attr === Editor.DetailsViewConstants.altAttribute && !value) {
                img.removeAttr(Editor.DetailsViewConstants.altAttribute);
            }
            this.setWidthHeightToOverlayIcon(img, attr, value);
            this.eventBroker.notify(Editor.EventConstants.imageAttributeChanged, new Editor.ImageAttributeChangedEventArgs(img, attr, value, null));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ImageDetailsView.prototype.onDecorativeCheckboxFieldUpdated = function (selectedBlock, inputElement) {
            var decorativeChecked = inputElement.target.checked;
            var altTextInput = $(".altInput");
            var img = this.getImage(selectedBlock);
            if (decorativeChecked) {
                img.attr(Editor.DetailsViewConstants.altAttribute, "");
                altTextInput.val("");
                altTextInput.prop("disabled", true);
            }
            else {
                img.removeAttr(Editor.DetailsViewConstants.altAttribute);
                altTextInput.prop("disabled", false);
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ImageDetailsView.prototype.getDefaultCheckboxValue = function (selectedBlock) {
            var img = this.getImage(selectedBlock);
            if (typeof img.attr("alt") !== "undefined") {
                if (!$(".altInput").val()) {
                    return true;
                }
            }
            return false;
        };
        ImageDetailsView.prototype.setWidthHeightToOverlayIcon = function (img, attr, value) {
            var overlayIcon = img.filter("." + Editor.CommonConstants.unconfiguredImageOverlayIconCssClassName)[0];
            if (overlayIcon && (attr === "width" || attr === "height")) {
                overlayIcon.style.setProperty(attr, value);
            }
        };
        ImageDetailsView.prototype.onLinkWrapperFieldUpdated = function (selectedBlock, inputField) {
            var img = this.getImage(selectedBlock);
            var linkWrapper = this.getLinkWrapperOfImg(img);
            var newValue = inputField.val();
            if (linkWrapper.length > 0) {
                if (String.isNullOrWhitespace(newValue)) {
                    // Link wrapper should be removed if the new link field value is empty
                    img.unwrap();
                }
                else {
                    linkWrapper.attr(Editor.DetailsViewConstants.hrefAttribute, newValue);
                    linkWrapper.attr(Editor.DetailsViewConstants.titleAttribute, newValue);
                }
            }
            else if (!!newValue) {
                if (!img.parent().hasClass("imageWrapper")) {
                    // Set default alignment to center, as otherwise the link wrap would align left
                    this.setImageAlignment(selectedBlock, "Center");
                }
                img.parent().wrap($("<a>")
                    .attr(Editor.DetailsViewConstants.hrefAttribute, newValue)
                    .attr(Editor.DetailsViewConstants.titleAttribute, newValue));
            }
            else {
                return;
            }
            var eventArgs = new Editor.HrefAttributeChangedEventArgs(this.getLinkWrapperOfImg(img), newValue);
            this.eventBroker.notify(Editor.EventConstants.hrefAttributeChanged, eventArgs);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(this.containerId, $(selectedBlock)));
        };
        ImageDetailsView.prototype.onImageAlignmentUpdated = function (selectedBlock, dropdownList) {
            var alignment = dropdownList.val();
            this.setImageAlignment(selectedBlock, alignment);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ImageDetailsView.prototype.setImageAlignment = function (selectedBlock, alignment) {
            var $selectedBlock = $(selectedBlock);
            if (!this.getImageWrapper($selectedBlock).length) {
                var imageWrapper = $("<div>").addClass(Editor.DetailsViewConstants.imageWrapperClassName);
                var img = this.getImage(selectedBlock);
                if (img.parent() && img.parent().hasClass(Editor.CommonConstants.resizableWrapper)) {
                    img.parent().wrap(imageWrapper);
                }
                else {
                    img.wrap(imageWrapper);
                }
            }
            var wrapper = this.getImageWrapper($selectedBlock);
            var image = this.getImage(selectedBlock);
            Editor.CommonUtils.setImageAlignment(wrapper, image, alignment, function (wrapperValue, key, value) {
                wrapperValue.attr(key, value);
            }, Editor.CommonUtils.rewriteInlineStyleProperty);
            // Add clear div to mitigate floats of the image positioning.
            if (wrapper.find(".clear").length === 0) {
                wrapper.find("img").after(Editor.CommonUtils.getClearDiv());
            }
        };
        ImageDetailsView.prototype.addPosition = function (selectedBlock, isDisabled) {
            Editor.DetailsViewPropertiesUtils.eventBroker = this.eventBroker;
            Editor.DetailsViewPropertiesUtils.containerId = this.containerId;
            var section = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.spacingTitle));
            section.find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            Editor.DetailsViewPropertiesUtils.addMarginSubsection(this.detailsViewControl, selectedBlock, section, this.notifyChanges, this.limitOnMin, this.limitOnMax);
        };
        ImageDetailsView.prototype.notifyChanges = function (eventBroker, containerId) {
            eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(containerId));
        };
        ImageDetailsView.prototype.onReactValidate = function () {
            var _this = this;
            this.spinButtonDebounce(function () { return _this.notifyChanges(_this.eventBroker, _this.containerId); }, Editor.DetailsViewConstants.spinButtonDebounceTime);
        };
        ImageDetailsView.prototype.spinButtonDebounce = function (func, wait) {
            var later = function () {
                this.spinButtonDebounceTimeout = null;
                func.apply(this, arguments);
            };
            clearTimeout(this.spinButtonDebounceTimeout);
            this.spinButtonDebounceTimeout = setTimeout(later.bind(this), wait);
        };
        ImageDetailsView.prototype.clearContainer = function () {
            Editor.CommonUtils.getById(this.containerId).empty();
        };
        ImageDetailsView.prototype.getImage = function (block) {
            return $(block.getElementsByTagName("img").item(0));
        };
        ImageDetailsView.prototype.getLinkWrapperOfImg = function (img) {
            return img.parents("a");
        };
        ImageDetailsView.prototype.getImageWrapper = function (selectedBlock) {
            return selectedBlock.find("." + Editor.DetailsViewConstants.imageWrapperClassName);
        };
        return ImageDetailsView;
    }());
    Editor.ImageDetailsView = ImageDetailsView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     *  @see IDetailsViewControl
     */
    var DetailsViewControl = /** @class */ (function () {
        function DetailsViewControl(sectionRenderer, inputElementRenderer, textareaElementRenderer, inputColorFieldRenderer, lookupContainerRenderer, dropdownElementRenderer, linkFieldRenderer, imageFieldRenderer, ignoreChangesWhileInputStrategy, customRadioTileButtonRenderer, checkboxRenderer, rangeElementRenderer, subsectionRenderer) {
            this.sectionRenderer = sectionRenderer;
            this.inputElementRenderer = inputElementRenderer;
            this.textareaElementRenderer = textareaElementRenderer;
            this.inputColorFieldRenderer = inputColorFieldRenderer;
            this.lookupContainerRenderer = lookupContainerRenderer;
            this.dropdownElementRenderer = dropdownElementRenderer;
            this.linkFieldRenderer = linkFieldRenderer;
            this.imageFieldRenderer = imageFieldRenderer;
            this.ignoreChangesWhileInputStrategy = ignoreChangesWhileInputStrategy;
            this.customRadioTileButtonRenderer = customRadioTileButtonRenderer;
            this.checkboxRenderer = checkboxRenderer;
            this.rangeElementRenderer = rangeElementRenderer;
            this.subsectionRenderer = subsectionRenderer;
        }
        /**
         *  @see IDetailsViewControl.init
         */
        DetailsViewControl.prototype.init = function (containerId, eventBroker) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.linkFieldRenderer.setup(this.eventBroker);
        };
        /**
         *  @see IDetailsViewControl
         */
        DetailsViewControl.prototype.createSection = function (sectionTitle, content, sectionInfoMessage) {
            var section = this.sectionRenderer.render(Editor.DetailsViewConstants.sectionContainerClassName, sectionTitle, sectionInfoMessage);
            Editor.CommonUtils.getById(this.containerId).append(section);
            if (content) {
                var sectionContent = section.find("." + Editor.DetailsViewConstants.sectionContentClassName);
                sectionContent.append(content);
            }
            section.addClass(Editor.DetailsViewConstants.sectionContainerV2ClassName);
            return section;
        };
        DetailsViewControl.prototype.createTwoColumnArea = function (section) {
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            var sectionContent = section.find(sectionClass).first();
            var twoColumnArea = document.createElement("div");
            twoColumnArea.classList.add(Editor.DetailsViewConstants.sectionContentClassName);
            twoColumnArea.classList.add(Editor.DetailsViewConstants.inputColumnsLayout);
            twoColumnArea.classList.add(Editor.DetailsViewConstants.twoColumnSubsectionClassName);
            sectionContent.append(twoColumnArea);
            return $(twoColumnArea);
        };
        /**
         *  @see IDetailsViewControl.createInputField
         */
        DetailsViewControl.prototype.createInputField = function (section, label, type, className, value, attributes, onFieldUpdated, validations, onValidate, suffix) {
            var inputField = this.inputElementRenderer.render(label, type, className, value, attributes, onFieldUpdated, validations, null, onValidate, suffix);
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(inputField);
            this.ignoreChangesWhileInputStrategy.addStopEventPropogationWhileInput(this.eventBroker, inputField);
            return inputField;
        };
        DetailsViewControl.prototype.createCheckbox = function (section, label, value, attributes, onChange) {
            var checkbox = this.checkboxRenderer.render(label, value, attributes, onChange);
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(checkbox);
            return checkbox;
        };
        /**
         *  @see IDetailsViewControl.createTextArea
         */
        DetailsViewControl.prototype.createTextArea = function (section, label, rows, cols, className, value, attributes, onFieldUpdated) {
            var textarea = this.textareaElementRenderer.render(label, className, rows, cols, value, attributes, onFieldUpdated);
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(textarea);
            this.ignoreChangesWhileInputStrategy.addStopEventPropogationWhileInput(this.eventBroker, textarea);
            return textarea;
        };
        /**
         *  @see IDetailsViewControl.createLinkField
         */
        DetailsViewControl.prototype.createLinkField = function (section, label, type, className, value, attributes, onFieldUpdated, config) {
            var linkField = this.linkFieldRenderer.render(label, type, className, value, attributes, onFieldUpdated, config);
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(linkField);
            this.ignoreChangesWhileInputStrategy.addStopEventPropogationWhileInput(this.eventBroker, linkField);
            return linkField;
        };
        /**
         *  @see IDetailsViewControl.createImageField
         */
        DetailsViewControl.prototype.createImageField = function (section, label, type, className, value, attributes, onFieldUpdated, config) {
            var imageField = this.imageFieldRenderer.render(label, type, className, value, attributes, onFieldUpdated, config);
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(imageField);
            this.ignoreChangesWhileInputStrategy.addStopEventPropogationWhileInput(this.eventBroker, imageField);
            return imageField;
        };
        /**
         *  @see IDetailsViewControl.createInputColorField
         */
        DetailsViewControl.prototype.createInputColorField = function (section, label, type, className, value, attributes, onFieldUpdated, validations) {
            var inputColorField = this.inputColorFieldRenderer.render(label, type, className, value, attributes, onFieldUpdated, validations);
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(inputColorField);
            this.ignoreChangesWhileInputStrategy.addStopEventPropogationWhileInput(this.eventBroker, inputColorField);
            return inputColorField;
        };
        /**
         *  @see IDetailsViewControl.createDropdownList
         */
        DetailsViewControl.prototype.createDropdownList = function (section, label, options, className, value, onSelectedValueChanged) {
            var dropdownList = this.dropdownElementRenderer.render(label, options, className, value);
            if (!Utility.isNullOrUndefined(onSelectedValueChanged)) {
                this.setHandlerOnDropdownUpdate(dropdownList, onSelectedValueChanged);
            }
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(dropdownList);
            return dropdownList;
        };
        /**
         *  @see IDetailsViewControl.createCustomRadioTileButton
         */
        DetailsViewControl.prototype.createCustomRadioTileButton = function (section, options, className, value, onSelectedValueChanged) {
            var radioButtonRenderer = this.customRadioTileButtonRenderer.render(options, className, value, onSelectedValueChanged);
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(radioButtonRenderer);
            return radioButtonRenderer;
        };
        /**
         *  @see IDetailsViewControl.createLookupContainer
         */
        DetailsViewControl.prototype.createLookupContainer = function (section, label, className, id) {
            var lookupContainer = this.lookupContainerRenderer.render(label, className, id);
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(lookupContainer);
            this.ignoreChangesWhileInputStrategy.addStopEventPropogationWhileInput(this.eventBroker, lookupContainer);
            return lookupContainer;
        };
        /**
        *  @see IDetailsViewControl.createSubsection
        */
        DetailsViewControl.prototype.createSubsection = function (section, className, id, label) {
            var subsection = this.subsectionRenderer.render(section, className, id, label);
            return subsection;
        };
        /**
         *  @see IDetailsViewControl.createRange
         */
        DetailsViewControl.prototype.createRange = function (section, label, min, max, className, value, attributes, onFieldUpdated) {
            var range = this.rangeElementRenderer.render(label, className, min, max, value, attributes, onFieldUpdated);
            var sectionClass = "." + Editor.DetailsViewConstants.sectionContentClassName;
            section.find(sectionClass).addBack(sectionClass).first().append(range);
            this.ignoreChangesWhileInputStrategy.addStopEventPropogationWhileInput(this.eventBroker, range);
            return range;
        };
        DetailsViewControl.prototype.changeRangeElement = function (rangeElement, min, max) {
            this.rangeElementRenderer.changeRange(rangeElement, min, max);
        };
        /**
         *  @see IDetailsViewControl.addCustomElement
         */
        DetailsViewControl.prototype.addCustomElement = function (element, elementContainer) {
            elementContainer.append(element);
        };
        /**
         *  @see IDetailsViewControl.dispose
         */
        DetailsViewControl.prototype.dispose = function () {
            this.linkFieldRenderer.dispose();
            this.imageFieldRenderer.dispose();
            this.clearContainer();
        };
        DetailsViewControl.prototype.setHandlerOnDropdownUpdate = function (dropdownList, onFieldUpdated) {
            dropdownList.find(Editor.DetailsViewConstants.selectTag).on("change", function () {
                onFieldUpdated(dropdownList.find(Editor.DetailsViewConstants.selectTag));
                return false;
            });
        };
        DetailsViewControl.prototype.clearContainer = function () {
            Editor.CommonUtils.getById(this.containerId).empty();
        };
        return DetailsViewControl;
    }());
    Editor.DetailsViewControl = DetailsViewControl;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SectionRenderer = /** @class */ (function () {
        function SectionRenderer(widgetCommonFactory) {
            this.widgetCommonFactory = widgetCommonFactory;
        }
        /**
         * @see ISectionRenderer.render
         */
        SectionRenderer.prototype.render = function (sectionContainerClass, sectionTitle, sectionInfoMessage) {
            var sectionContainer = $("<div>", {
                class: sectionContainerClass + " " + Editor.CommonUtils.getLangDirectionClass(),
                role: "menu"
            });
            this.renderSectionHeading(sectionContainer, sectionTitle, sectionInfoMessage);
            this.renderSectionContentContainer(sectionContainer);
            this.render2ColumnLayout(sectionTitle, sectionContainer);
            return sectionContainer;
        };
        SectionRenderer.prototype.renderSectionHeading = function (sectionContainer, sectionHeading, sectionInfoMessage) {
            var header = $("<div>");
            header.addClass("sectionHeader");
            var ariaLabelId = MktSvc.Controls.Common.UniqueId.generate();
            var toggleButton = $("<button>", {
                class: Editor.DetailsViewConstants.collapsableIconClassName + " " + Editor.CommonConstants.editorFontCssClass
            })
                .attr(Editor.AriaAttributeNames.ariaExpanded, "true")
                .attr(Editor.AriaAttributeNames.ariaLabelledby, ariaLabelId)
                .attr(Editor.AriaAttributeNames.role, "menuitem")
                .click(function () {
                sectionContainer.find("." + Editor.DetailsViewConstants.sectionContentClassName).toggle();
                toggleButton.toggleClass(Editor.CommonConstants.collapsedCssClass);
                toggleButton.attr(Editor.AriaAttributeNames.ariaExpanded, (!toggleButton.hasClass(Editor.CommonConstants.collapsedCssClass)).toString());
            });
            // Presentation role is required for TalkBack, as otherwise it does not ignore the span)
            var sectionTitle = $("<span>")
                .addClass(Editor.DetailsViewConstants.headingClassName)
                .attr(Editor.AriaAttributeNames.role, Editor.AriaRoleConstants.presentation)
                .click(function () { return toggleButton.click(); });
            header.append(toggleButton);
            var sectionLabel = $("<p>", { id: ariaLabelId, class: Editor.DetailsViewConstants.headingLabelClassName }).text(sectionHeading);
            sectionTitle.append(sectionLabel);
            header.append(sectionTitle);
            if (this.widgetCommonFactory && sectionInfoMessage) {
                header.append(this.widgetCommonFactory.createMoreInfoControl().render(ariaLabelId, sectionInfoMessage));
            }
            sectionContainer.append(header);
        };
        SectionRenderer.prototype.renderSectionContentContainer = function (sectionContainer) {
            sectionContainer.append($("<div>", { class: Editor.DetailsViewConstants.sectionContentClassName }));
        };
        SectionRenderer.prototype.render2ColumnLayout = function (sectionTitle, sectionContainer) {
            if (sectionTitle === Editor.CommonUtils.getLocalizedString("[" + Editor.DetailsViewConstants.paddingSectionTitle + "]")) {
                sectionContainer.find("." + Editor.DetailsViewConstants.sectionContentClassName)
                    .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            }
        };
        return SectionRenderer;
    }());
    Editor.SectionRenderer = SectionRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Input Field Renderer Class
     */
    var InputFieldRenderer = /** @class */ (function () {
        function InputFieldRenderer() {
        }
        /**
         * Render the form section
         */
        InputFieldRenderer.prototype.render = function (label, type, className, value, attributes, onFieldUpdated, validations, ariaLabelKey, reactValidate, suffix) {
            var inputContainer = $("<div>", { class: Editor.DetailsViewConstants.inputControlContainerClassName });
            inputContainer.addClass(Editor.DetailsViewConstants.spinButtonCssClass);
            var renderSpinButton = null;
            if (attributes["role"] === "spinbutton") {
                renderSpinButton = function (inputValue) {
                    var spinButton = React.createElement(Editor.SpinButton, {
                        label: label,
                        className: className,
                        value: inputValue,
                        role: attributes["role"],
                        id: attributes["id"],
                        min: attributes["min"],
                        max: attributes["max"],
                        pattern: attributes["pattern"],
                        required: attributes["required"],
                        disabled: attributes["disabled"],
                        onValidate: reactValidate,
                        suffix: suffix,
                        placeholder: attributes["placeholder"]
                    }, null);
                    ReactDOM.render(spinButton, inputContainer[0]);
                };
                renderSpinButton(value);
            }
            else {
                this.renderNonReactInputElement(inputContainer, label, attributes, className, validations, type, value, ariaLabelKey, onFieldUpdated);
            }
            if (!Utility.isNullOrUndefined(onFieldUpdated)) {
                this.setHandlerOnInputUpdate(inputContainer, onFieldUpdated, validations, renderSpinButton);
            }
            return inputContainer;
        };
        InputFieldRenderer.prototype.renderNonReactInputElement = function (inputContainer, label, attributes, className, validations, type, value, ariaLabelKey, onFieldUpdated) {
            this.renderInputLabel(inputContainer, label, attributes["id"]);
            var classNames = className;
            if (validations) {
                classNames += " inlineValidation";
            }
            this.renderInputField(inputContainer, type, classNames, value, attributes, label, ariaLabelKey, validations != null);
        };
        InputFieldRenderer.prototype.renderInputLabel = function (inputContainer, label, inputId) {
            var $label = $("<label>", {
                class: Editor.DetailsViewConstants.inputItemField + " " + Editor.DetailsViewConstants.propertyNameCssClass
            }).text(label);
            inputContainer.append($label);
        };
        InputFieldRenderer.prototype.renderInputField = function (inputContainer, type, className, value, attributes, label, ariaLabelKey, includeErrorMessage) {
            if (includeErrorMessage === void 0) { includeErrorMessage = false; }
            var $input = $("<input type = " + type + " />");
            if (attributes.hasOwnProperty("min")) {
                $input.attr("aria-valuemin", attributes.min);
            }
            if (attributes.hasOwnProperty("max")) {
                $input.attr("aria-valuemax", attributes.max);
            }
            $input.attr(attributes);
            $input.addClass(Editor.DetailsViewConstants.inputAttributeClassName + " " + className);
            $input.val(value);
            if (ariaLabelKey) {
                $input.attr("aria-label", label + ". " + Editor.CommonUtils.getLocalizedString(ariaLabelKey));
            }
            else {
                $input.attr("aria-label", "" + label);
            }
            var inputElementContainer = $("<div>", { class: Editor.DetailsViewConstants.inputItemField });
            inputElementContainer.append($input);
            if (includeErrorMessage) {
                var errorMessageLabel = $("<label/>");
                errorMessageLabel.addClass("errorMessage");
                errorMessageLabel.text(Editor.CommonUtils.getLocalizedString("[Field value invalid]"));
                inputElementContainer.append(errorMessageLabel);
            }
            inputContainer.append(inputElementContainer);
        };
        InputFieldRenderer.prototype.setHandlerOnInputUpdate = function (inputField, onFieldUpdated, validations, updateSpinButton) {
            var _this = this;
            var inputElement = inputField.find(Editor.DetailsViewConstants.inputTag).first();
            var initialInputValue = inputElement.val();
            var handlerInputUpdate = function () {
                var inputElem = inputField.find(Editor.DetailsViewConstants.inputTag).first();
                var currentInputElemVal = inputElem.val();
                if (_this.clearPx(initialInputValue) !== _this.clearPx(currentInputElemVal)) {
                    if (validations) {
                        currentInputElemVal = _this.checkAndFixValidations(currentInputElemVal, inputElem, validations);
                    }
                    initialInputValue = currentInputElemVal;
                    inputElem.val(currentInputElemVal);
                    onFieldUpdated(inputElem);
                }
            };
            inputElement
                .on("keydown", function (event) {
                if (event.keyCode === $.ui.keyCode.ENTER) {
                    handlerInputUpdate();
                }
            })
                .on("inputset", function (event) {
                if (!!updateSpinButton) {
                    var setValue = inputElement.val();
                    updateSpinButton(("" + setValue).replace("px", ""));
                }
            })
                .on("focusout", function () {
                handlerInputUpdate();
            })
                .on("remove", function () {
                handlerInputUpdate();
            });
        };
        InputFieldRenderer.prototype.clearPx = function (input) {
            return ("" + input).replace("px", "");
        };
        InputFieldRenderer.prototype.checkAndFixValidations = function (currentInputElemVal, inputElem, validations) {
            var val = currentInputElemVal;
            if (Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.allowEmpty, validations) && val === "") {
                return "";
            }
            else {
                if (Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.checkForInt, validations)) {
                    val = parseInt(val);
                }
                if (Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.checkForTwoDigitDecimal, validations)) {
                    val = Math.floor(Math.floor(parseFloat(val) * 100) / 100);
                }
                if (Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.checkForNumber, validations)) {
                    if (val.toString() === "NaN") {
                        val = 0;
                    }
                }
                var limitOnMin = inputElem.attr("min");
                if (Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.checkForMax, validations) && limitOnMin) {
                    if (val < limitOnMin) {
                        val = limitOnMin;
                    }
                }
                var limitOnMax = inputElem.attr("max");
                if (Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.checkForMax, validations) && limitOnMax) {
                    if (val > limitOnMax) {
                        val = limitOnMax;
                    }
                }
                if (Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.checkForSeperator, validations)) {
                    val = val
                        .toString()
                        .replace(".", "")
                        .replace(",", "");
                }
            }
            return val.toString();
        };
        return InputFieldRenderer;
    }());
    Editor.InputFieldRenderer = InputFieldRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * The base class for the event arguments for the internal events used by the event broker
     */
    var EventArgs = /** @class */ (function () {
        function EventArgs(sourceId) {
            this.sourceId = sourceId;
        }
        return EventArgs;
    }());
    Editor.EventArgs = EventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BlockModificationEventArgs = /** @class */ (function (_super) {
        __extends(BlockModificationEventArgs, _super);
        function BlockModificationEventArgs(block, cloned, shouldFocus) {
            if (cloned === void 0) { cloned = false; }
            if (shouldFocus === void 0) { shouldFocus = true; }
            var _this = _super.call(this) || this;
            _this.block = block;
            _this.cloned = cloned;
            _this.shouldFocus = shouldFocus;
            return _this;
        }
        return BlockModificationEventArgs;
    }(Editor.EventArgs));
    Editor.BlockModificationEventArgs = BlockModificationEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SectionModificationEventArgs = /** @class */ (function (_super) {
        __extends(SectionModificationEventArgs, _super);
        function SectionModificationEventArgs(section, sourceId) {
            var _this = _super.call(this, sourceId) || this;
            _this.section = section;
            return _this;
        }
        return SectionModificationEventArgs;
    }(Editor.EventArgs));
    Editor.SectionModificationEventArgs = SectionModificationEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Event args for the designer add start event.
     */
    var DesignerAddStartEventArgs = /** @class */ (function (_super) {
        __extends(DesignerAddStartEventArgs, _super);
        function DesignerAddStartEventArgs(block, movingExistingBlock) {
            var _this = _super.call(this, null) || this;
            _this.block = block;
            _this.movingExistingBlock = movingExistingBlock;
            return _this;
        }
        return DesignerAddStartEventArgs;
    }(Editor.EventArgs));
    Editor.DesignerAddStartEventArgs = DesignerAddStartEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BlockCleanupRequestedEventArgs = /** @class */ (function (_super) {
        __extends(BlockCleanupRequestedEventArgs, _super);
        function BlockCleanupRequestedEventArgs() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        return BlockCleanupRequestedEventArgs;
    }(Editor.EventArgs));
    Editor.BlockCleanupRequestedEventArgs = BlockCleanupRequestedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DesignerInternalEventConstants = /** @class */ (function () {
        function DesignerInternalEventConstants() {
        }
        DesignerInternalEventConstants.selectionChanged = "designer.selectionChanged";
        DesignerInternalEventConstants.contentChanged = "designer.contentChanged";
        DesignerInternalEventConstants.contentRefreshed = "designer.contentRefreshed";
        DesignerInternalEventConstants.contentBlockChanged = "designer.contentBlockChanged";
        DesignerInternalEventConstants.blockCleanupRequested = "designer.blockCleanupRequested";
        DesignerInternalEventConstants.blockLoaded = "designer.blockLoaded";
        DesignerInternalEventConstants.blockClicked = "designer.blockClicked";
        DesignerInternalEventConstants.sectionLoaded = "designer.sectionLoaded";
        DesignerInternalEventConstants.sectionCleanupRequested = "designer.sectionCleanupRequested";
        DesignerInternalEventConstants.sectionDecorationRequested = "designer.section.decoration.requested";
        DesignerInternalEventConstants.ckEditorInstanceReadyEvent = "designer.ckEditorInstanceReady";
        DesignerInternalEventConstants.ckEditorFocus = "designer.ckEditorFocus";
        DesignerInternalEventConstants.designerFrameInitialized = "designer.designerInitialized";
        DesignerInternalEventConstants.designerFrameDisposed = "designer.designerDisposed";
        DesignerInternalEventConstants.designerReady = "designer.designerReady";
        DesignerInternalEventConstants.designerDragStart = "designer.dragStart";
        DesignerInternalEventConstants.designerDragEnd = "designer.dragEnd";
        DesignerInternalEventConstants.designerDragSectionStart = "designer.dragSectionStart";
        DesignerInternalEventConstants.designerDragSectionEnd = "designer.dragSectionEnd";
        DesignerInternalEventConstants.controllerReady = "designer.controllerReady";
        DesignerInternalEventConstants.designerAddStart = "designer.addStart";
        DesignerInternalEventConstants.designerMoveStarted = "designer.moveStarted";
        DesignerInternalEventConstants.designerAddEnd = "designer.addEnd";
        DesignerInternalEventConstants.cleanPlaceholderForAddMode = "designer.cleanPlaceholderForAddMode";
        DesignerInternalEventConstants.designerAddSectionStart = "designer.addSectionStart";
        DesignerInternalEventConstants.designerAddSectionEnd = "designer.addSectionEnd";
        DesignerInternalEventConstants.designerNonEventPropagationStart = "designer.nonEventPropagationStart";
        DesignerInternalEventConstants.designerNonEventPropagationEnd = "designer.nonEventPropagationEnd";
        DesignerInternalEventConstants.designerToolbarPositionChanged = "designer.toolbarPositionChanged";
        DesignerInternalEventConstants.fullPageNonEventPropagationStart = "fullPage.nonEventPropagationStart";
        DesignerInternalEventConstants.fullPageNonEventPropagationEnd = "fullPage.nonEventPropagationEnd";
        DesignerInternalEventConstants.itemFocused = "designer.itemFocused";
        DesignerInternalEventConstants.resetItemStateChange = "designer.resetItemStateChange";
        DesignerInternalEventConstants.resetItemSelection = "designer.resetItemSelection";
        // View related
        DesignerInternalEventConstants.stylesViewContentUpdated = "stylesViewContentUpdated";
        return DesignerInternalEventConstants;
    }());
    Editor.DesignerInternalEventConstants = DesignerInternalEventConstants;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CkEditorInstanceReadyEventArgs = /** @class */ (function (_super) {
        __extends(CkEditorInstanceReadyEventArgs, _super);
        function CkEditorInstanceReadyEventArgs() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        return CkEditorInstanceReadyEventArgs;
    }(Editor.EventArgs));
    Editor.CkEditorInstanceReadyEventArgs = CkEditorInstanceReadyEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CkEditorFocusEventArgs = /** @class */ (function (_super) {
        __extends(CkEditorFocusEventArgs, _super);
        function CkEditorFocusEventArgs() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        return CkEditorFocusEventArgs;
    }(Editor.EventArgs));
    Editor.CkEditorFocusEventArgs = CkEditorFocusEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var ContentChangedEventArgs = /** @class */ (function (_super) {
        __extends(ContentChangedEventArgs, _super);
        function ContentChangedEventArgs(html, sourceId, originalSourceId, component, notifyOutput, rootEventId) {
            if (notifyOutput === void 0) { notifyOutput = true; }
            if (rootEventId === void 0) { rootEventId = null; }
            var _this = _super.call(this, sourceId) || this;
            _this.html = html;
            _this.originalSourceId = String.isNullUndefinedOrWhitespace(originalSourceId)
                ? _this.sourceId
                : originalSourceId;
            _this.component = component;
            _this.notifyOutput = notifyOutput;
            _this.rootEventId = rootEventId;
            return _this;
        }
        return ContentChangedEventArgs;
    }(Editor.EventArgs));
    Editor.ContentChangedEventArgs = ContentChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ImageAttributeChangedEventArgs = /** @class */ (function (_super) {
        __extends(ImageAttributeChangedEventArgs, _super);
        function ImageAttributeChangedEventArgs(imageElement, attributeName, attributeValue, sourceId) {
            var _this = _super.call(this, sourceId) || this;
            _this.imageElement = imageElement;
            _this.attributeName = attributeName.toLowerCase();
            _this.attributeValue = attributeValue;
            return _this;
        }
        return ImageAttributeChangedEventArgs;
    }(Editor.EventArgs));
    Editor.ImageAttributeChangedEventArgs = ImageAttributeChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ToolbarShownEventArgs = /** @class */ (function (_super) {
        __extends(ToolbarShownEventArgs, _super);
        function ToolbarShownEventArgs(blockId) {
            var _this = _super.call(this, null) || this;
            _this.blockId = blockId;
            return _this;
        }
        return ToolbarShownEventArgs;
    }(Editor.EventArgs));
    Editor.ToolbarShownEventArgs = ToolbarShownEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var HrefAttributeChangedEventArgs = /** @class */ (function (_super) {
        __extends(HrefAttributeChangedEventArgs, _super);
        function HrefAttributeChangedEventArgs(element, href) {
            var _this = _super.call(this) || this;
            _this.element = element;
            _this.href = href;
            return _this;
        }
        return HrefAttributeChangedEventArgs;
    }(Editor.EventArgs));
    Editor.HrefAttributeChangedEventArgs = HrefAttributeChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ControlRenderedEventArgs = /** @class */ (function (_super) {
        __extends(ControlRenderedEventArgs, _super);
        function ControlRenderedEventArgs(viewId, html) {
            var _this = _super.call(this) || this;
            _this.viewId = viewId;
            _this.html = html;
            return _this;
        }
        return ControlRenderedEventArgs;
    }(Editor.EventArgs));
    Editor.ControlRenderedEventArgs = ControlRenderedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ControllerReadyEventArgs = /** @class */ (function (_super) {
        __extends(ControllerReadyEventArgs, _super);
        function ControllerReadyEventArgs(className) {
            var _this = _super.call(this) || this;
            _this.controllerName = className;
            return _this;
        }
        return ControllerReadyEventArgs;
    }(Editor.EventArgs));
    Editor.ControllerReadyEventArgs = ControllerReadyEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SelectionChangedEventArgs = /** @class */ (function (_super) {
        __extends(SelectionChangedEventArgs, _super);
        function SelectionChangedEventArgs(type, selectedSubBlock, selectedBlock, selectedContainer, selectedSection, selectedBody, selectedForm) {
            var _this = _super.call(this) || this;
            _this.type = type;
            _this.selectedSubBlock = selectedSubBlock;
            _this.selectedBlock = selectedBlock;
            _this.selectedContainer = selectedContainer;
            _this.selectedSection = selectedSection;
            _this.selectedBody = selectedBody;
            _this.selectedForm = selectedForm;
            return _this;
        }
        SelectionChangedEventArgs.prototype.getOperableBlock = function () {
            var _a = Editor.BlockConstants.SelectableType, subBlock = _a.subBlock, block = _a.block, container = _a.container, section = _a.section, body = _a.body, form = _a.form;
            switch (this.type) {
                case subBlock: {
                    return this.selectedSubBlock;
                }
                case block: {
                    return this.selectedBlock;
                }
                case container: {
                    return this.selectedContainer;
                }
                case section: {
                    return this.selectedSection;
                }
                case body: {
                    return this.selectedBody;
                }
                case form: {
                    return this.selectedForm;
                }
                default: {
                    return null;
                }
            }
        };
        return SelectionChangedEventArgs;
    }(Editor.EventArgs));
    Editor.SelectionChangedEventArgs = SelectionChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    var MenuBarView = /** @class */ (function (_super) {
        __extends(MenuBarView, _super);
        function MenuBarView(menuBarContainerId, menuBarItems, keyboardCommandManager) {
            var _this = _super.call(this, menuBarContainerId) || this;
            _this.keyboardCommandManager = keyboardCommandManager;
            _this.menuBarItems = menuBarItems;
            return _this;
        }
        MenuBarView.prototype.init = function (eventBroker) {
            this.eventBroker = eventBroker;
            this.render();
            this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.zeroKey, [KeyboardModifierType.Alt, KeyboardModifierType.Control], function () {
                // Set focus on the first visible button
                Editor.CommonUtils.getByClass(Editor.CommonConstants.menuBarItemsCssClass)
                    .find("button:visible")
                    .eq(0)
                    .focus();
            }));
            this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.f11Key, [KeyboardModifierType.Alt], function () {
                $(Editor.CommonUtils.getByClass(Editor.CommonConstants.maximizeButtonCssClass)).click();
            }));
        };
        MenuBarView.prototype.activate = function () {
            if (!this.isActive) {
                _super.prototype.activate.call(this);
            }
        };
        MenuBarView.prototype.render = function () {
            var _this = this;
            var menuBarDivider = $("<div>").addClass(Editor.CommonConstants.menuBarDividerCssClass);
            this.getElement().append(menuBarDivider);
            this.menuBarContainer = $("<div>").addClass(Editor.CommonConstants.menuBarItemsCssClass);
            this.getElement().append(this.menuBarContainer);
            this.menuBarItems.each(function (item) {
                item.init(_this.eventBroker);
            });
            this.setupKeyboardNavigation();
            this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.id));
        };
        MenuBarView.prototype.setupKeyboardNavigation = function () {
            var _this = this;
            this.menuBarContainer.on("keydown", function (e) {
                var keyPressed = e.which || e.keyCode;
                switch (keyPressed) {
                    case KeyCodes.Left:
                        e.preventDefault();
                        e.stopPropagation();
                        _this.focusPrevItem();
                        break;
                    case KeyCodes.Right:
                        e.preventDefault();
                        e.stopPropagation();
                        _this.focusNextItem();
                        break;
                    default:
                        break;
                }
            });
        };
        MenuBarView.prototype.focusNextItem = function () {
            var menuBarButtons = $("." + Editor.CommonConstants.toolbarButtonCssClass);
            var focusIndex = this.getFocusedElementIndex(menuBarButtons);
            if (focusIndex !== -1 && focusIndex < menuBarButtons.length) {
                menuBarButtons.eq(focusIndex + 1).focus();
            }
        };
        MenuBarView.prototype.focusPrevItem = function () {
            var menuBarButtons = $("." + Editor.CommonConstants.toolbarButtonCssClass);
            var focusIndex = this.getFocusedElementIndex(menuBarButtons);
            if (focusIndex > 0) {
                menuBarButtons.eq(focusIndex - 1).focus();
            }
        };
        MenuBarView.prototype.getFocusedElementIndex = function (menuBarButtons) {
            var focusedElement = document.activeElement;
            for (var i = 0; i < menuBarButtons.length; i++) {
                if (menuBarButtons.eq(i).is(focusedElement)) {
                    return i;
                }
            }
            return -1;
        };
        MenuBarView.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.menuBarItems)) {
                this.menuBarItems.each(function (item) {
                    item.dispose();
                });
            }
            this.getElement().off();
            this.getElement().empty();
            this.keyboardCommandManager = null;
            this.menuBarContainer = null;
            this.menuBarItems = null;
        };
        return MenuBarView;
    }(Editor.Control));
    Editor.MenuBarView = MenuBarView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UndoButton = /** @class */ (function (_super) {
        __extends(UndoButton, _super);
        function UndoButton() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        UndoButton.prototype.init = function (eventBroker) {
            _super.prototype.init.call(this, eventBroker);
            this.render();
        };
        UndoButton.prototype.activate = function () { };
        UndoButton.prototype.render = function () {
            var _this = this;
            var undoButtonText = Editor.CommonUtils.getLocalizedString("[Undo]");
            var undoButtonImage = $("<span>")
                .addClass(Editor.CommonConstants.undoButtonImageCssClass)
                .addClass(Editor.CommonConstants.editorFontCssClass);
            this.undoButtonContainer = $("<button></button>")
                .addClass(Editor.CommonConstants.toolbarButtonCssClass)
                .addClass(Editor.CommonConstants.undoButtonCssClass)
                .attr("title", undoButtonText)
                .attr("aria-label", undoButtonText)
                .attr("type", Editor.CommonConstants.buttonType)
                .append(undoButtonImage);
            Editor.CommonUtils.getByClass(Editor.CommonConstants.menuBarItemsCssClass).append(this.undoButtonContainer);
            this.undoButtonContainer.on("click", function () { return _this.onClick(); });
        };
        UndoButton.prototype.onClick = function () {
            this.eventBroker.notify(MktSvcCommon.EventConstants.UndoExecuted);
        };
        UndoButton.prototype.deactivate = function () { };
        UndoButton.prototype.dispose = function () {
            this.undoButtonContainer.off("click");
            this.undoButtonContainer.remove();
        };
        return UndoButton;
    }(Editor.Control));
    Editor.UndoButton = UndoButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SaveButton = /** @class */ (function (_super) {
        __extends(SaveButton, _super);
        function SaveButton() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.showButton = function (eventArgs) {
                if (eventArgs.isFullscreen) {
                    _this.saveButtonContainer.style.display = "";
                }
            };
            _this.hideButton = function () {
                _this.saveButtonContainer.style.display = "none";
            };
            return _this;
        }
        SaveButton.prototype.init = function (eventBroker) {
            _super.prototype.init.call(this, eventBroker);
            this.render();
        };
        SaveButton.prototype.activate = function () { };
        SaveButton.prototype.render = function () {
            var _this = this;
            var saveButtonText = Editor.CommonUtils.getLocalizedString("[Save]");
            this.saveButtonImage = document.createElement("span");
            this.saveButtonImage.className =
                Editor.CommonConstants.saveButtonImageCssClass + " " + Editor.CommonConstants.editorFontCssClass;
            this.saveButtonContainer = document.createElement("button");
            this.saveButtonContainer.className =
                Editor.CommonConstants.toolbarButtonCssClass + " " + Editor.CommonConstants.saveButtonCssClass;
            this.saveButtonContainer.title = saveButtonText;
            this.saveButtonContainer.type = Editor.CommonConstants.buttonType;
            this.saveButtonContainer.setAttribute("aria-label", saveButtonText);
            this.saveButtonContainer.appendChild(this.saveButtonImage);
            Editor.CommonUtils.getByClass(Editor.CommonConstants.menuBarItemsCssClass).append(this.saveButtonContainer);
            this.saveButtonContainer.addEventListener("click", function () { return _this.onClick(); });
            this.saveButtonContainer.style.display = "none";
            this.eventBroker.subscribe(Editor.EventConstants.maximizeExecuted, this.showButton);
            this.eventBroker.subscribe(Editor.EventConstants.exitFullScreenButtonClicked, this.hideButton);
        };
        SaveButton.prototype.onClick = function () {
            this.eventBroker.notify(Editor.EventConstants.saveRequested);
        };
        SaveButton.prototype.deactivate = function () { };
        SaveButton.prototype.dispose = function () {
            this.saveButtonContainer.remove();
        };
        return SaveButton;
    }(Editor.Control));
    Editor.SaveButton = SaveButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var RedoButton = /** @class */ (function (_super) {
        __extends(RedoButton, _super);
        function RedoButton() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        RedoButton.prototype.init = function (eventBroker) {
            _super.prototype.init.call(this, eventBroker);
            this.render();
        };
        RedoButton.prototype.activate = function () { };
        RedoButton.prototype.render = function () {
            var _this = this;
            var redoButtonText = Editor.CommonUtils.getLocalizedString("[Redo]");
            var redoButtonImage = $("<span>")
                .addClass(Editor.CommonConstants.redoButtonImageCssClass)
                .addClass(Editor.CommonConstants.editorFontCssClass);
            this.redoButtonContainer = $("<button></button>")
                .addClass(Editor.CommonConstants.toolbarButtonCssClass)
                .addClass(Editor.CommonConstants.redoButtonCssClass)
                .attr("title", redoButtonText)
                .attr("aria-label", redoButtonText)
                .attr("type", Editor.CommonConstants.buttonType)
                .append(redoButtonImage);
            Editor.CommonUtils.getByClass(Editor.CommonConstants.menuBarItemsCssClass).append(this.redoButtonContainer);
            this.redoButtonContainer.on("click", function () { return _this.onClick(); });
        };
        RedoButton.prototype.onClick = function () {
            this.eventBroker.notify(MktSvcCommon.EventConstants.RedoExecuted);
        };
        RedoButton.prototype.deactivate = function () { };
        RedoButton.prototype.dispose = function () {
            this.redoButtonContainer.off("click");
            this.redoButtonContainer.remove();
        };
        return RedoButton;
    }(Editor.Control));
    Editor.RedoButton = RedoButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ToolsList = /** @class */ (function (_super) {
        __extends(ToolsList, _super);
        function ToolsList() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.createList = function () {
                var toolsListItemCssClass = "toolsListItem";
                var list = [];
                _this.props.tools.items().forEach(function (tool, i) {
                    list.push(React.createElement("li", { key: i, className: toolsListItemCssClass, role: "none", tabIndex: 0 },
                        React.createElement("button", { title: tool.getLabel(), role: "menuitem", className: tool.getCssClass(), tabIndex: 0, onClick: function () { _this.props.onClick(i); }, type: Editor.CommonConstants.buttonType, "data-type": tool.getType(), "data-tool-index": i }, tool.getLabel())));
                });
                return list;
            };
            return _this;
        }
        ToolsList.prototype.render = function () {
            var toolsListCssClass = "toolsList";
            var toolsListTitleCssClass = "toolsListTitle";
            var defaultValueText = "[Select to add a new block]";
            return (React.createElement("ul", { className: toolsListCssClass, role: "menu" },
                React.createElement("span", { className: toolsListTitleCssClass, "aria-label": Editor.CommonUtils.getLocalizedString(defaultValueText), tabIndex: 0, role: "heading" }, Editor.CommonUtils.getLocalizedString(defaultValueText)),
                this.createList()));
        };
        return ToolsList;
    }(React.Component));
    Editor.ToolsList = ToolsList;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    var ToolsDropdown = /** @class */ (function (_super) {
        __extends(ToolsDropdown, _super);
        function ToolsDropdown(id, toolsDropdownButton, tools, blockFromToolItemProvider, logger) {
            var _this = _super.call(this, id) || this;
            _this.id = id;
            _this.toolsDropdownButton = toolsDropdownButton;
            _this.tools = tools;
            _this.blockFromToolItemProvider = blockFromToolItemProvider;
            _this.logger = logger;
            _this.tooltip = "[Tooltip]";
            _this.disablePlusButton = function () {
                _this.plusButton[0].style.opacity = "0.4";
                _this.plusButton[0].style.cursor = "no-drop";
                _this.plusButton.prop("onclick", null).off("click");
            };
            _this.enablePlusButton = function () {
                _this.plusButton[0].style.opacity = "1.0";
                _this.plusButton[0].style.cursor = "pointer";
                _this.setupOnClick();
            };
            _this.toolsDropdownButton = toolsDropdownButton;
            _this.tools = tools;
            _this.renderedTools = [];
            return _this;
        }
        ToolsDropdown.prototype.init = function (eventBroker) {
            var _this = this;
            _super.prototype.init.call(this, eventBroker);
            this.eventBroker.subscribe(Editor.EventConstants.renderTools, function (eventArgs) {
                _this.tools = eventArgs.tools;
                _this.render();
            });
            // Set default value after exit from the add mode
            this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerAddEnd, (this.onDesignerAddEnd = function () { return _this.resetDropdown(); }));
            // Hide tools dropdown if we are not on the designer tab
            this.eventBroker.subscribe(Editor.TabControlEventConstants.tabsStateUpdated, (this.onTabsStateUpdated = function () { return _this.tabsStateUpdated(); }));
            this.render();
            this.eventBroker.subscribe(Editor.EventConstants.elementsCannotBeInserted, this.disablePlusButton);
            this.eventBroker.subscribe(Editor.EventConstants.elementsCanBeInserted, this.enablePlusButton);
        };
        ToolsDropdown.prototype.activate = function () { };
        ToolsDropdown.prototype.render = function () {
            var _this = this;
            var existingWrapper = Editor.CommonUtils.getByClass(Editor.CommonConstants.toolsDropdownCssClass);
            if (existingWrapper.length !== 0) {
                this.toolsDropdownContainer = existingWrapper;
                existingWrapper.empty();
            }
            else {
                this.toolsDropdownContainer = $("<div>").addClass(Editor.CommonConstants.toolsDropdownCssClass);
                // Keyboard navigation for the dropdown
                this.setupKeyboardNavigation();
            }
            this.plusButton = this.createPlusButton();
            this.toolsList = this.createPlaceholderForToolsList();
            this.toolsDropdownContainer.append(this.plusButton);
            this.toolsDropdownContainer.append(this.toolsList);
            this.toolsList.hide();
            // Toggle or untoggle the plus button
            this.setupOnClick();
            /* Hide tools List View Div once it loses focus */
            this.setupClosingOnFocusOut();
            if (existingWrapper.length === 0) {
                Editor.CommonUtils.getByClass(Editor.CommonConstants.menuBarItemsCssClass).append(this.toolsDropdownContainer);
            }
            var e = React.createElement;
            ReactDOM.render(e(Editor.ToolsList, { tools: this.tools, onClick: function (i) { _this.onToolItemSelected(i); } }), document.getElementById("toolsListContainer"));
        };
        ToolsDropdown.prototype.setupOnClick = function () {
            var _this = this;
            this.plusButton.on("click", function () {
                _this.toggleDropdownButton();
            });
        };
        ToolsDropdown.prototype.setupClosingOnFocusOut = function () {
            var _this = this;
            this.toolsList.on("mouseleave", function (e) {
                e.preventDefault();
                e.stopPropagation();
                _this.closeToolsList();
                _this.plusButton.focus();
            });
        };
        ToolsDropdown.prototype.setupKeyboardNavigation = function () {
            var _this = this;
            this.toolsDropdownContainer.on("keydown", function (e) {
                var keyPressed = e.which || e.keyCode;
                switch (keyPressed // tslint:disable-line
                ) {
                    case KeyCodes.Up:
                        if (Editor.CommonUtils.isVisible(_this.toolsList)) {
                            e.preventDefault();
                            e.stopPropagation();
                            _this.focusPrevListItem();
                        }
                        break;
                    case KeyCodes.Down:
                        if (Editor.CommonUtils.isVisible(_this.toolsList)) {
                            e.preventDefault();
                            e.stopPropagation();
                            _this.focusNextListItem();
                        }
                        break;
                    case KeyCodes.Enter:
                        // Open the add mode by the keyboard
                        e.preventDefault();
                        e.stopPropagation();
                        if (!Utility.isNullOrUndefined(_this.currentItem)) {
                            var buttonItem = _this.currentItem.find("button");
                            var toolIndex = parseInt(buttonItem.attr("data-tool-index"));
                            _this.onToolItemSelected(toolIndex);
                            _this.closeToolsList();
                        }
                        else {
                            _this.toggleDropdownButton();
                        }
                        break;
                    case KeyCodes.Esc:
                        _this.closeToolsList();
                        _this.plusButton.focus();
                        break;
                    case KeyCodes.Tab:
                        // Only activate tab events when dropdown menu is shown
                        if (_this.plusButton.hasClass(Editor.CommonConstants.selectedToolsDropdownCssClass)) {
                            e.preventDefault();
                            e.stopPropagation();
                            if (e.shiftKey) {
                                _this.focusPrevListItem();
                            }
                            else {
                                _this.focusNextListItem();
                            }
                        }
                        break;
                }
            });
        };
        ToolsDropdown.prototype.focusNextListItem = function () {
            var nextItem;
            var toolsListItems = this.toolsList.find("li");
            var currentItem = this.toolsList.find("." + ToolsDropdown.focusedToolsListItemCssClass);
            if (currentItem.length === 0 ||
                toolsListItems.last().hasClass(ToolsDropdown.focusedToolsListItemCssClass)) {
                nextItem = toolsListItems.first();
            }
            else {
                nextItem = currentItem.next();
            }
            this.focus(nextItem);
        };
        ToolsDropdown.prototype.focusPrevListItem = function () {
            var prevItem;
            var toolsListItems = this.toolsList.find("li");
            var currentItem = this.toolsList.find("." + ToolsDropdown.focusedToolsListItemCssClass);
            if (currentItem.length === 0 ||
                toolsListItems.first().hasClass(ToolsDropdown.focusedToolsListItemCssClass)) {
                prevItem = toolsListItems.last();
            }
            else {
                prevItem = currentItem.prev();
            }
            this.focus(prevItem);
        };
        ToolsDropdown.prototype.focus = function (itemToFocus) {
            if (!Utility.isNullOrUndefined(this.currentItem)) {
                this.currentItem.removeClass(ToolsDropdown.focusedToolsListItemCssClass);
            }
            itemToFocus.addClass(ToolsDropdown.focusedToolsListItemCssClass);
            this.currentItem = itemToFocus;
            itemToFocus
                .find("button")
                .focus()
                .focusin();
        };
        ToolsDropdown.prototype.onToolItemSelected = function (toolIndex) {
            var selectedTool = this.renderedTools[toolIndex];
            var block = this.blockFromToolItemProvider.getBlockFromTool(selectedTool);
            if (!Utility.isNullOrUndefined(block)) {
                Editor.CkEditorTelemetryUtils.sendToolUsageTelemetry(this.logger, this.getName(), selectedTool);
                this.blockFromToolItemProvider.notifyOnToolSelected(selectedTool, this.eventBroker, block);
            }
            this.closeToolsList();
        };
        ToolsDropdown.prototype.toggleDropdownButton = function () {
            if (this.plusButton.hasClass(Editor.CommonConstants.selectedToolsDropdownCssClass)) {
                this.closeToolsList();
            }
            else {
                this.plusButton.addClass(Editor.CommonConstants.selectedToolsDropdownCssClass);
                this.plusButton.attr(Editor.AriaAttributeNames.ariaExpanded, "true");
                this.toolsList.show();
                this.focusNextListItem();
            }
        };
        ToolsDropdown.prototype.closeToolsList = function () {
            this.plusButton.removeClass(Editor.CommonConstants.selectedToolsDropdownCssClass);
            this.plusButton.attr(Editor.AriaAttributeNames.ariaExpanded, "false");
            this.toolsList.hide();
            this.resetDropdown();
        };
        ToolsDropdown.prototype.resetDropdown = function () {
            if (!Utility.isNullOrUndefined(this.currentItem)) {
                this.currentItem.removeClass(ToolsDropdown.focusedToolsListItemCssClass);
                this.currentItem = null;
            }
        };
        ToolsDropdown.prototype.createPlusButton = function () {
            var plusButton = $("<button>")
                .attr("id", UniqueId.generate(this.toolsDropdownButton.getLabel()))
                .attr("type", this.toolsDropdownButton.getType())
                .attr("aria-label", this.toolsDropdownButton.getLabel() + ", " + Editor.CommonUtils.getLocalizedString(this.tooltip) + ": " + this.toolsDropdownButton.getTitle())
                .attr("title", this.toolsDropdownButton.getTitle())
                .addClass(Editor.CommonConstants.toolbarButtonCssClass)
                .addClass(this.toolsDropdownButton.getClass());
            ToolsDropdown.plusButtonAccasibilityAttributes.forEach(function (attribute) {
                plusButton.attr(attribute[0], attribute[1]);
            });
            var plusButtonSymbol = $("<span>")
                .addClass(this.toolsDropdownButton.getButtonImageClass())
                .addClass(Editor.CommonConstants.editorFontCssClass);
            plusButton.append(plusButtonSymbol);
            return plusButton;
        };
        ToolsDropdown.prototype.createPlaceholderForToolsList = function () {
            var _this = this;
            var toolsList = $("<div id=\"toolsListContainer\"></div>");
            this.renderedTools = [];
            this.tools.items().forEach(function (tool, i) {
                _this.renderedTools.push(tool);
            });
            return toolsList;
        };
        ToolsDropdown.prototype.tabsStateUpdated = function () {
            if (Editor.CommonUtils.isVisible(Editor.CommonUtils.getByClass(Editor.CommonConstants.designerTabContentClassName))) {
                this.toolsDropdownContainer.show();
            }
            else {
                this.toolsDropdownContainer.hide();
            }
        };
        ToolsDropdown.prototype.deactivate = function () { };
        ToolsDropdown.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddEnd, this.onDesignerAddEnd);
            this.eventBroker.unsubscribe(Editor.TabControlEventConstants.tabsStateUpdated, this.onTabsStateUpdated);
            this.toolsDropdownContainer.remove();
        };
        ToolsDropdown.prototype.getName = function () {
            return "ToolsDropdown";
        };
        ToolsDropdown.focusedToolsListItemCssClass = "focusedToolsListItem";
        ToolsDropdown.plusButtonAccasibilityAttributes = [
            [Editor.AriaAttributeNames.ariaExpanded, "false"],
            [Editor.AriaAttributeNames.hasPopup, "true"]
        ];
        return ToolsDropdown;
    }(Editor.Control));
    Editor.ToolsDropdown = ToolsDropdown;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var AxeCoreFactory = /** @class */ (function () {
        function AxeCoreFactory() {
        }
        //[dinael] Axe.js shadowElementsFromPoint method has been modified to workaround a known issue with finding elements in the iframe
        //without the modification the color-contrast test pass yields incomplete. Please consider porting the change if you plan to upgrade axe-core version
        AxeCoreFactory.prototype.runAxeCore = function (node, iframeSelector) {
            return window.axe.run(node, { include: [[iframeSelector]] });
        };
        return AxeCoreFactory;
    }());
    Editor.AxeCoreFactory = AxeCoreFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var EventBroker = MktSvc.Controls.Common.EventBroker;
    var ArrayQuery = MktSvc.Controls.Common.ArrayQuery;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var KeyboardCommandManager = MktSvc.Controls.Common.KeyboardCommandManager;
    var EditorControlFactory = /** @class */ (function () {
        function EditorControlFactory() {
        }
        EditorControlFactory.prototype.create = function (plugin, executionContext) {
            Editor.CommonUtils.localizationProvider = executionContext.getLocalizationProvider();
            var editorFeatureServiceClient = Editor.EditorFeatureServiceClient.instance;
            var eventBroker = new EventBroker(executionContext.getLogger());
            var blockDefinition = new Editor.BlockDefinitionFactory().create(plugin);
            var keyboardCommandManager = new KeyboardCommandManager();
            var tools = new ArrayQuery(plugin.getTools());
            var toolBlockMapping = plugin.getToolBlockMapping();
            var sections = plugin.getSections ? new ArrayQuery(plugin.getSections()) : null;
            var sectionToToolsMapping = plugin.getSectionToolsMapping ? plugin.getSectionToolsMapping() : null;
            var accessibilityInstructionsPopup = new Editor.AccessibilityInstructionsPopup(executionContext.getLogger());
            var controlToTabItemConverter = new Editor.ControlToTabItemConverter(eventBroker);
            var focusManagerFactory = new Editor.FocusManagerFactory();
            var designerFocusManager = focusManagerFactory.create(eventBroker, Editor.EventConstants.onElementFocusedIn, Editor.EventConstants.onKeypressToFocusPreviousElementCalled);
            var designerContentEditor = new Editor.DesignerContentEditorFactory().create(plugin, executionContext, new Editor.FCBList(), eventBroker, designerFocusManager, keyboardCommandManager, blockDefinition);
            var keyboardAccessibilityManager = new Editor.KeyboardAccessibilityManager();
            var fullPageContentEditor = new Editor.FullPageContentEditorFactory().create(plugin, executionContext, eventBroker, keyboardCommandManager);
            var blockFromToolItemProvider = new Editor.BlockFromToolItemProvider(toolBlockMapping);
            var toolboxView = new Editor.ToolboxView(UniqueId.generate("toolboxId"), tools, keyboardAccessibilityManager, keyboardCommandManager, executionContext, true, blockFromToolItemProvider, sections, new Editor.ToolTypeBasedSectionProvider(sectionToToolsMapping));
            var detailsView = new Editor.DetailsView(UniqueId.generate("detailsViewId"), plugin.getBlockDetailsViewMapping(), keyboardCommandManager);
            var browserPreviewView = new Editor.BrowserPreviewFactory().create(UniqueId.generate("browserPreviewViewId"), true, keyboardCommandManager, executionContext, undefined, undefined, undefined, new Editor.AbTestingContext(eventBroker), undefined, new Editor.MetadataParser(executionContext));
            var menuBarView = new Editor.MenuBarView(UniqueId.generate("menuBarViewId"), new ArrayQuery([
                new Editor.UndoButton(UniqueId.generate("undoButtonId")),
                new Editor.RedoButton(UniqueId.generate("redoButtonId")),
                new Editor.ToolsDropdown(UniqueId.generate("toolsDropdownId"), new Editor.AddToolsDropdownButton(), tools, blockFromToolItemProvider, executionContext.getLogger()),
                new Editor.SaveButton(UniqueId.generate("saveButtonId")),
                new Editor.MaximizeButton(UniqueId.generate("maximizeButtonId"))
            ]), keyboardCommandManager);
            var detailsViewFactory = new Editor.DetailsViewControlFactory();
            var stylesView = new Editor.StylesView(UniqueId.generate("stylesViewId"), detailsViewFactory.create(), new Editor.MetadataFieldRendererFactory(plugin.getBlockDetailsViewMapping(), detailsViewFactory.create()), keyboardCommandManager);
            var htmlContentEditor = new Editor.HtmlContentEditorFactory().create(keyboardCommandManager, executionContext);
            var layoutRenderer = new Editor.LayoutRenderer();
            var designerEditorLayout = new Editor.LayoutConfiguration();
            designerEditorLayout.cssClass = Editor.CommonConstants.designerTabContentClassName;
            var fullPageEditorLayout = new Editor.LayoutConfiguration();
            fullPageEditorLayout.cssClass = Editor.CommonConstants.fullPageContentEditorcssClass;
            var previewLayout = new Editor.LayoutConfiguration();
            previewLayout.cssClass = Editor.CommonConstants.previewTabControlCssClass;
            var layout = new Editor.LayoutConfiguration();
            layout.cssClass = Editor.CommonConstants.editorContainerCssClass;
            var menuBarControlLayout = new Editor.LayoutConfiguration();
            menuBarControlLayout.cssClass = Editor.CommonConstants.menuBarControlCssClass;
            var designerTabButtonViewLayout = new Editor.ComponentLayoutConfiguration();
            designerTabButtonViewLayout.cssClass = Editor.CommonConstants.designerTabButtonViewCssClass;
            designerTabButtonViewLayout.id = UniqueId.generate("designerTabButtonView");
            var previewTabButtonViewLayout = new Editor.ComponentLayoutConfiguration();
            previewTabButtonViewLayout.cssClass = Editor.CommonConstants.previewTabButtonViewCssClass;
            previewTabButtonViewLayout.id = UniqueId.generate("previewTabButtonView");
            var menuBarLayout = new Editor.ComponentLayoutConfiguration();
            menuBarLayout.id = menuBarView.id;
            menuBarLayout.cssClass = Editor.CommonConstants.menuBarCssClass;
            var designerLayout = new Editor.ComponentLayoutConfiguration();
            designerLayout.id = designerContentEditor.id;
            designerLayout.cssClass = Editor.CommonConstants.designerControlCssClass;
            var toolboxTab = controlToTabItemConverter.convert(toolboxView, Editor.CommonUtils.getLocalizedString("[TOOLBOX]"), Editor.CommonConstants.toolboxTabContentClassName);
            var propertiesTab = controlToTabItemConverter.convert(detailsView, Editor.CommonUtils.getLocalizedString("[PROPERTIES]"), Editor.CommonConstants.detailsTabContentClassName);
            var stylesTab = controlToTabItemConverter.convert(stylesView, Editor.CommonUtils.getLocalizedString("[STYLES]"), Editor.CommonConstants.stylesTabContentClassName);
            var stylesTabVisible = false;
            var arrayQuery = new MktSvc.Controls.Common.ArrayQuery([
                { isTabEnabled: function () { return true; }, getTabItem: function () { return toolboxTab; } },
                { isTabEnabled: function () { return true; }, getTabItem: function () { return propertiesTab; } },
                { isTabEnabled: function () { return stylesTabVisible; }, getTabItem: function () { return stylesTab; } }
            ]);
            var propertiesTabVisibilityManager = new Editor.TabControlVisibilityManager(arrayQuery, eventBroker);
            var tabButton = $(MktSvc.Controls.Common.String.Format("[aria-controls={0}]", stylesTab.tabContentElementId));
            var index = tabButton.index();
            propertiesTabVisibilityManager.init(function () {
                if (index !== -1) {
                    Editor.CommonUtils.getById(stylesTab.tabContentElementId).hide();
                    tabButton.hide();
                }
            });
            stylesTab.disable();
            eventBroker.notify(Editor.EventConstants.contentResolved);
            var designerTabView = new Editor.TabControl(UniqueId.generate("designerTabView"), new ArrayQuery([toolboxTab, propertiesTab, stylesTab]), executionContext, designerTabButtonViewLayout.id, propertiesTabVisibilityManager, false);
            stylesTab.disable();
            eventBroker.notify(Editor.EventConstants.stylesTabVisibility, new Editor.StylesTabVisibilityEventArgs(stylesTab));
            var previewTabView = new Editor.TabControl(UniqueId.generate("previewTabView"), new ArrayQuery([
                controlToTabItemConverter.convert(browserPreviewView, Editor.CommonUtils.getLocalizedString("[BASICPREVIEW]"), Editor.CommonConstants.browserPreviewTabContentClassName)
            ]), executionContext, previewTabButtonViewLayout.id);
            var designerTabViewLayout = new Editor.ComponentLayoutConfiguration();
            designerTabViewLayout.cssClass = Editor.CommonConstants.designerTabViewCssClass;
            designerTabViewLayout.id = designerTabView.id;
            designerEditorLayout.components = new ArrayQuery([
                new ArrayQuery([designerLayout, designerTabButtonViewLayout, designerTabViewLayout])
            ]);
            var previewViewLayout = new Editor.ComponentLayoutConfiguration();
            previewViewLayout.id = previewTabView.id;
            previewViewLayout.cssClass = Editor.CommonConstants.previewViewClassName;
            previewLayout.components = new ArrayQuery([
                new ArrayQuery([previewTabButtonViewLayout]),
                new ArrayQuery([previewViewLayout])
            ]);
            var designerEditor = new Editor.ComposeControl(UniqueId.generate("designerContentEditor"), new ArrayQuery([designerContentEditor, designerTabView]), layoutRenderer, designerEditorLayout);
            var previewView = new Editor.ComposeControl(UniqueId.generate("previewView"), new ArrayQuery([previewTabView]), layoutRenderer, previewLayout);
            menuBarControlLayout.components = new ArrayQuery([new ArrayQuery([menuBarLayout])]);
            var menuBarControl = new Editor.ComposeControl(UniqueId.generate("menuBarControl"), new ArrayQuery([menuBarView]), layoutRenderer, menuBarControlLayout);
            var designerTab = new Editor.TabControlItem(Editor.CommonUtils.getLocalizedString("[DESIGNER]"), designerEditor.id, function () { return designerEditor.init(eventBroker); }, function () { return designerEditor.activate(); }, function () { return designerEditor.deactivate(); }, function () { return designerEditor.dispose(); }, Editor.CommonConstants.designerTabContentClassName, Editor.CommonConstants.designerTabControlDataId);
            var fullPageTab = new Editor.TabControlItem(Editor.CommonUtils.getLocalizedString("[FULL PAGE]"), fullPageContentEditor.id, function () { return fullPageContentEditor.init(eventBroker); }, function () { return fullPageContentEditor.activate(); }, function () { return fullPageContentEditor.deactivate(); }, function () { return fullPageContentEditor.dispose(); }, Editor.CommonConstants.fullPageContentEditorcssClass, Editor.CommonConstants.fullPageTabControlDataId);
            var tabVisibilityManager = new Editor.TabControlVisibilityManager(new MktSvc.Controls.Common.ArrayQuery([
                new Editor.DesignerTabItemVisibility(designerTab),
                new Editor.FullPageTabItemVisibility(fullPageTab)
            ]), eventBroker);
            var contentEditorTabControl = new Editor.TabControl(UniqueId.generate("contentEditorTab"), new ArrayQuery([
                designerTab,
                fullPageTab,
                controlToTabItemConverter.convert(htmlContentEditor, Editor.CommonUtils.getLocalizedString("[HTML]"), Editor.CommonConstants.htmlTabContentClassName),
                controlToTabItemConverter.convert(previewView, Editor.CommonUtils.getLocalizedString("[PREVIEW]"), Editor.CommonConstants.previewViewClassName)
            ]), executionContext, menuBarView.id, tabVisibilityManager);
            var conentEditorLayout = new Editor.ComponentLayoutConfiguration();
            conentEditorLayout.id = contentEditorTabControl.id;
            conentEditorLayout.cssClass = Editor.CommonConstants.contentEditorCssClass;
            layout.components = new ArrayQuery([new ArrayQuery([menuBarLayout]), new ArrayQuery([conentEditorLayout])]);
            var documentContentModel = new Editor.DocumentContentModel(executionContext, new Editor.MetadataParser(executionContext), eventBroker, [
                new Editor.SetupEqualHeightsProcessor(),
                new Editor.SetOrphanBlockContainerWrapContentModelProcessor(),
                new Editor.SetSectionIdContentModelProcessor(),
                new Editor.SetContainerIdContentModelProcessor(),
                new Editor.SetBlockIdContentModelProcessor(),
                new Editor.TableDecoratorContentModelProcessor(),
                new Editor.AddTextBreakContentModelProcessor()
            ], [
                new Editor.RemoveSectionIdContentModelProcessor(),
                new Editor.RemoveContainerIdContentModelProcessor(),
                new Editor.RemoveBlockIdContentModelProcessor()
            ], []);
            return new Editor.EditorControl(executionContext, layoutRenderer, layout, new ArrayQuery([contentEditorTabControl, menuBarControl]), eventBroker, documentContentModel, keyboardCommandManager, new Editor.UndoRedoManager(), accessibilityInstructionsPopup);
        };
        return EditorControlFactory;
    }());
    Editor.EditorControlFactory = EditorControlFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BasicPluginFactory = /** @class */ (function () {
        function BasicPluginFactory() {
        }
        BasicPluginFactory.prototype.create = function (imagePicker, fcbList) {
            return new Editor.BasicPlugin(imagePicker, fcbList);
        };
        return BasicPluginFactory;
    }());
    Editor.BasicPluginFactory = BasicPluginFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var LoadingModal = MktSvc.Controls.Common.LoadingModal;
    var BrowserPreviewFactory = /** @class */ (function () {
        function BrowserPreviewFactory() {
        }
        BrowserPreviewFactory.prototype.create = function (previewId, showHeader, keyboardCommandManager, executionContext, defaultIcon, isOffline, accessibilityInstructions, abTestingContext, editorFeatureServiceClient, metadataParser) {
            Editor.CommonUtils.localizationProvider = executionContext.getLocalizationProvider();
            var loadingModal = new LoadingModal();
            if (isOffline) {
                return new Editor.OfflineBrowserPreviewView(previewId, executionContext);
            }
            return new Editor.BrowserPreviewView(previewId, showHeader, loadingModal, keyboardCommandManager, executionContext, null, defaultIcon, accessibilityInstructions, abTestingContext, editorFeatureServiceClient, metadataParser);
        };
        return BrowserPreviewFactory;
    }());
    Editor.BrowserPreviewFactory = BrowserPreviewFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DetailsViewControlFactory = /** @class */ (function () {
        function DetailsViewControlFactory() {
        }
        DetailsViewControlFactory.prototype.create = function (widgetCommonFactory) {
            var sectionRenderer = new Editor.SectionRenderer(widgetCommonFactory);
            var inputFieldRenderer = new Editor.InputFieldRenderer();
            var textareaRenderer = new Editor.TextAreaRenderer();
            var lookupContainerRenderer = new Editor.LookupContainerRenderer();
            var inputColorFieldRenderer = new Editor.InputColorFieldRenderer(inputFieldRenderer);
            var dropdownListRenderer = new Editor.DropdownListRenderer();
            var linkFieldRenderer = new Editor.LinkFieldRenderer(inputFieldRenderer);
            var imageFieldRenderer = new Editor.InputImageFieldRenderer(inputFieldRenderer);
            var ignoreChangesWhileInputStrategy = new Editor.IgnoreChangesWhileInputStrategy();
            var optionPickerRenderer = new Editor.CustomRadioTileButtonRenderer();
            var checkboxRenderer = new Editor.CheckboxRenderer();
            var rangeRenderer = new Editor.RangeRenderer();
            var subsectionRenderer = new Editor.SubsectionRenderer();
            return new Editor.DetailsViewControl(sectionRenderer, inputFieldRenderer, textareaRenderer, inputColorFieldRenderer, lookupContainerRenderer, dropdownListRenderer, linkFieldRenderer, imageFieldRenderer, ignoreChangesWhileInputStrategy, optionPickerRenderer, checkboxRenderer, rangeRenderer, subsectionRenderer);
        };
        return DetailsViewControlFactory;
    }());
    Editor.DetailsViewControlFactory = DetailsViewControlFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DelayScheduler = MktSvc.Controls.Common.DelayScheduler;
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    var HtmlContentEditor = /** @class */ (function (_super) {
        __extends(HtmlContentEditor, _super);
        /**
         * Creates the content editor.
         * @param containerId - An id of a container in which the content editor should be placed.
         * @param eventBroker - A content editor can raise events and subscribe to events using this class.
         */
        function HtmlContentEditor(containerId, loadingModal, localeProvider, keyboardCommandManager, executionContext, htmlChangedEventName, monacoCustomSettings) {
            if (htmlChangedEventName === void 0) { htmlChangedEventName = Editor.EventConstants.contentModelUpdated; }
            if (monacoCustomSettings === void 0) { monacoCustomSettings = null; }
            var _this = _super.call(this, containerId) || this;
            _this.html = String.Empty;
            _this.monacoVsPath = "Monaco/vs";
            _this.monacoExtendedCss = "css/monaco.extend.css";
            _this.decorations = [];
            _this.iframe = null;
            _this.defaultTheme = "vs";
            _this.highContrastTheme = "hc-black";
            _this.placeholderKeyCode = 229;
            _this.contentChangedDelay = 1000;
            _this.warningDisplayed = false;
            _this.dataProtectedHighlightTag = "div";
            _this.onContentModelUpdated = function (eventArgs) {
                var newContent = eventArgs.html;
                if (_this.html !== newContent && eventArgs.originalSourceId !== _this.id && eventArgs.sourceId !== _this.id) {
                    _this.setContent(newContent);
                }
            };
            _this.onEditorVisibilityChanged = function () {
                _this.resizeEditor();
            };
            _this.onMaximizeExecuted = function () {
                $(window).one("animationstart", _this.onAnimationStart);
                $(window).one("animationend", _this.onAnimationEnd);
                _this.resizeTimer.schedule();
            };
            _this.onAnimationStart = function (e) {
                if ($(e.target).find("#" + _this.id).length) {
                    _this.resizeTimer.stop(true);
                }
            };
            _this.onAnimationEnd = function (e) {
                if ($(e.target).find("#" + _this.id).length) {
                    _this.resizeTimer.stop(true);
                    _this.resizeEditor();
                }
            };
            _this.keyboardCommandManager = keyboardCommandManager;
            _this.executionContext = executionContext;
            _this.basePath = _this.executionContext.getLibsPath();
            _this.localeProvider = localeProvider;
            _this.loadingModal = loadingModal;
            _this.htmlChangedEventName = htmlChangedEventName;
            _this.settings = monacoCustomSettings;
            var attributes = [Editor.Contract.dataProtectedAttrName + "=\"true\"", Editor.Contract.blockTypeAttrName];
            _this.htmlContentHightlightParser = new Editor.HtmlContentHighlightParser(_this.dataProtectedHighlightTag, attributes);
            return _this;
        }
        /**
         * Initializes the designer editor.
         * @param containerId - The id of the conainer in which the desinger editor will be rendered.
         */
        HtmlContentEditor.prototype.init = function (eventBroker) {
            var _this = this;
            if (this.executionContext.getCustomizations().HTMLEditor) {
                this.eventBroker = eventBroker;
                this.eventBroker.subscribe(this.htmlChangedEventName, this.onContentModelUpdated);
                this.eventBroker.subscribe(Editor.EventConstants.editorVisibilityChanged, this.onEditorVisibilityChanged);
                this.eventBroker.subscribe(Editor.EventConstants.maximizeExecuted, this.onMaximizeExecuted);
                this.changeTimer = new DelayScheduler(this.eventBroker);
                this.changeTimer.init(function () {
                    var currentValue = Utility.isNullOrUndefined(_this.editor) ? String.Empty : _this.editor.getValue();
                    if (_this.html !== currentValue) {
                        _this.html = currentValue;
                        _this.broadcastContentChanged();
                    }
                }, this.contentChangedDelay);
                this.resizeTimer = new DelayScheduler(this.eventBroker);
                this.resizeTimer.init(function () {
                    $(window).off("animationstart", _this.onAnimationStart);
                    $(window).off("animationend", _this.onAnimationEnd);
                    _this.resizeEditor();
                });
                this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.twoKey, [KeyboardModifierType.Alt], function () {
                    $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.htmlTabContentClassName))
                        .focus()
                        .click();
                }));
            }
        };
        HtmlContentEditor.prototype.activate = function () {
            _super.prototype.activate.call(this);
            this.render();
            Editor.AccessibilityInstructionsPopup.accessibilityInstructions =
                Editor.EditorAccessibilityInstructions.baseControlAccessibilityInstructions;
        };
        HtmlContentEditor.prototype.setFocus = function () {
            _super.prototype.setFocus.call(this);
            if (!Utility.isNullOrUndefined(this.editor) &&
                (Utility.isNullOrUndefined(this.settings) ||
                    Utility.isNullOrUndefined(this.settings["readOnly"]) ||
                    !this.settings["readOnly"])) {
                this.editor.focus();
            }
        };
        HtmlContentEditor.prototype.deactivate = function () {
            _super.prototype.deactivate.call(this);
            this.changeTimer.stop();
        };
        /**
         * Sets the new editor content
         * @param content - The content to set in the editor
         */
        HtmlContentEditor.prototype.setContent = function (content) {
            if (this.changeTimer.isRunning()) {
                return;
            }
            this.html = content;
            if (!this.isActive) {
                return;
            }
            this.render();
        };
        HtmlContentEditor.prototype.mapToMonacoRange = function (offsetRange) {
            var model = this.editor.getModel();
            var start = model.getPositionAt(offsetRange.startPos);
            var end = model.getPositionAt(offsetRange.endPos);
            return new this.iframe.contentWindow.monaco.Range(start.lineNumber, start.column, end.lineNumber, end.column);
        };
        HtmlContentEditor.prototype.offsetToHighlights = function (offsets) {
            var _this = this;
            var options = { inlineClassName: "protectedInlineDecoration" };
            var ranges = offsets.map(function (value) {
                return {
                    options: options,
                    range: _this.mapToMonacoRange(value)
                };
            });
            this.decorations = this.editor.deltaDecorations(this.decorations, ranges);
        };
        HtmlContentEditor.prototype.clearHighlights = function () {
            this.decorations = this.editor.deltaDecorations(this.decorations, [
                { range: new this.iframe.contentWindow.monaco.Range(1, 1, 1, 1), options: {} }
            ]);
        };
        HtmlContentEditor.prototype.highlightContent = function (html) {
            var offsets = this.htmlContentHightlightParser.searchHighlights(html);
            if (offsets.length > 0) {
                this.offsetToHighlights(offsets);
                this.setWarningMessage(true);
            }
            else {
                this.clearHighlights();
                this.setWarningMessage(false);
            }
        };
        /**
         * Gets the content rendered in the ui.
         */
        HtmlContentEditor.prototype.getContent = function () {
            return this.html;
        };
        HtmlContentEditor.prototype.setWarningMessage = function (display) {
            if (display && !this.warningDisplayed) {
                $("#" + Editor.CommonConstants.htmlWarningMessageId).show();
                $("#" + Editor.CommonConstants.htmlWarningMessageId)
                    .children("div")
                    .text(Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.htmlWarningMessageLabel));
                this.warningDisplayed = true;
                this.resizeEditor();
            }
            else if (!display && this.warningDisplayed) {
                $("#" + Editor.CommonConstants.htmlWarningMessageId).hide();
                $("#" + Editor.CommonConstants.htmlWarningMessageId)
                    .children("div")
                    .text();
                this.warningDisplayed = false;
                this.resizeEditor();
            }
        };
        HtmlContentEditor.prototype.render = function () {
            if (!this.executionContext.getCustomizations().HTMLEditor) {
                var element = this.getElement();
                element.empty();
                var disabledMessage = $("<div>")
                    .text(Editor.CommonUtils.getLocalizedString("No html"))
                    .addClass(Editor.CommonConstants.htmlEditorNotSupportedMessageClassName);
                element.append(disabledMessage);
            }
            else if (Utility.isNullOrUndefined(this.editor) && !this.monacoEditorIsLoading) {
                this.initializeMonacoStructure();
            }
            else if (!Utility.isNullOrUndefined(this.editor)) {
                this.editor.setValue(this.html);
                this.resizeEditor();
                this.highlightContent(this.html);
                this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.id));
                this.eventBroker.notify(Editor.HtmlContentEditorInternalEventConstants.monacoEditorValueSet, new Editor.ControlRenderedEventArgs(this.id));
            }
        };
        HtmlContentEditor.prototype.initializeMonacoStructure = function () {
            var _this = this;
            var element = this.getElement();
            element.empty();
            this.iframe = this.createIFrameForEditor(element);
            Editor.IframeDecorator.applyCustomization(element, this.iframe);
            this.monacoEditorIsLoading = true;
            this.loadingModal.init(element, this.eventBroker);
            this.loadingModal.show();
            if (!Utility.isNullOrUndefined(this.basePath)) {
                var monacoLoaderScript = Editor.CommonUtils.createScriptElementFromUrl("html-editor-dependency-monaco", this.basePath + "/" + this.monacoVsPath + "/loader.js", this.iframe.contentDocument);
                monacoLoaderScript.onload = function () {
                    _this.executionContext.tryExecute(function () {
                        _this.iframe.contentWindow.require.config({
                            // prettier-ignore
                            "paths": {
                                vs: String.Format("{0}/{1}", _this.basePath, _this.monacoVsPath)
                            },
                            "vs/nls": {
                                availableLanguages: {
                                    "*": _this.localeProvider.getLanguageCode()
                                }
                            }
                        });
                        _this.createMonaco();
                    }, "Render the Html editor", true);
                };
                var monacoLoaderCss = Editor.CommonUtils.createLinkElementFromUrl("monaco-extend-style", this.executionContext.getBasePath() + "/" + this.monacoExtendedCss, this.iframe.contentDocument);
                this.iframe.contentDocument.head.appendChild(monacoLoaderScript);
                this.iframe.contentDocument.head.appendChild(monacoLoaderCss);
                this.keyboardCommandManager.registerCommandsInIframe(this.iframe);
            }
            var warningMessage = $("\n                <div>\n                    <span class=\"CCFSymbolFont fontIconSize\" draggable=\"false\" role=\"presentation\"></span>\n                    <div role=\"status\" aria-live=\"polite\"></div>\n                </div>");
            warningMessage.hide();
            warningMessage.attr("id", Editor.CommonConstants.htmlWarningMessageId);
            element.prepend(warningMessage);
            this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.id));
        };
        HtmlContentEditor.prototype.createMonaco = function () {
            var _this = this;
            var editorDimensions = this.getEditorDimensions(this.iframe);
            var div = $("<div />");
            div.attr("style", "width: 100%; height: 100%; min-height: " + editorDimensions.height + "px; overflow: hidden;");
            this.iframe.contentWindow.document.body.appendChild(div[0]);
            this.iframe.contentWindow.require(["vs/editor/editor.main"], function () {
                _this.executionContext.tryExecute(function () {
                    _this.editor = _this.iframe.contentWindow.monaco.editor.create(div[0], _this.getMonacoSettings());
                    _this.editor.layout(editorDimensions);
                    _this.editor.onDidChangeModelContent(function () {
                        var currentValue = Utility.isNullOrUndefined(_this.editor) ? String.Empty : _this.editor.getValue();
                        if (_this.html !== currentValue) {
                            _this.changeTimer.schedule();
                        }
                    });
                    _this.highlightContent(_this.editor.getModel().getValue());
                    _this.monacoEditorIsLoading = false;
                    _this.loadingModal.hide();
                    // Workaround for the issue https://github.com/Microsoft/monaco-editor/issues/563 - unable to remove text on android
                    $(_this.iframe.contentWindow.document).on("keyup", function (event) {
                        if (event.keyCode === _this.placeholderKeyCode || event.which === _this.placeholderKeyCode) {
                            var initialValue_1 = event.target.value;
                            // prettier-ignore
                            $(event.target).one("input", function (event) {
                                var currentValue = event.target.value;
                                // Use null/undefined verification, because empty string is acceptable value
                                if (!Utility.isNullOrUndefined(initialValue_1) && !Utility.isNullOrUndefined(currentValue) && currentValue.length < initialValue_1.length) {
                                    // Trigger native event with correct key code for monaco editor
                                    var keyEvent = _this.iframe.contentWindow.document.createEvent("Event");
                                    keyEvent.initEvent("keydown", true, true);
                                    keyEvent["keyCode"] = keyEvent["keyChar"] = keyEvent["which"] = KeyboardKeyCodes.backspaceKey;
                                    event.target.dispatchEvent(keyEvent);
                                }
                            });
                        }
                    });
                    // Workaround for the issue https://github.com/Microsoft/monaco-editor/issues/643 - Can't remove/add symbols inside the editor in IFrame (Firefox 57+)
                    if (Editor.CommonUtils.isFirefox()) {
                        $(_this.iframe.contentWindow.document).on("click", function () {
                            var activeElement = $(document.activeElement);
                            if (!activeElement.is($(_this.iframe))) {
                                activeElement.blur();
                                $(_this.iframe).focus();
                            }
                        });
                    }
                    _this.eventBroker.notify(Editor.HtmlContentEditorInternalEventConstants.monacoEditorCreated, new Editor.MonacoEditorCreatedEventArgs(_this.editor));
                    _this.setContent(_this.html);
                }, "Create the Monaco editor", true);
            });
        };
        HtmlContentEditor.prototype.createIFrameForEditor = function (container) {
            var iframe = document.createElement("iframe");
            var $iframe = $(iframe);
            $iframe
                .addClass(Editor.CommonConstants.htmlContentEditorFrame)
                .addClass(Editor.CommonConstants.layoutFrameClassName)
                .attr("role", "presentation");
            container.append(iframe);
            var idocument = iframe.contentDocument;
            idocument.open();
            idocument.write("<!DOCTYPE html>");
            idocument.write('<html lang="' + this.executionContext.getLocalizationProvider().getLanguageName() + '">');
            idocument.write("<head></head>");
            idocument.write('<body style="margin-top: 0; margin-bottom: 0; overflow: hidden;"></body>');
            idocument.close();
            return iframe;
        };
        HtmlContentEditor.prototype.resizeEditor = function () {
            if (!Utility.isNullOrUndefined(this.editor) &&
                !Utility.isNullOrUndefined(this.iframe) &&
                Editor.CommonUtils.isVisible($(this.iframe))) {
                this.editor.layout(this.getEditorDimensions(this.iframe));
            }
        };
        HtmlContentEditor.prototype.getEditorDimensions = function (iframe) {
            var editorPadding = 20;
            var warningPadding = 5;
            var warningOffset = this.warningDisplayed
                ? $("#" + Editor.CommonConstants.htmlWarningMessageId).height() + warningPadding
                : 0;
            return {
                height: $(iframe)
                    .parent()
                    .height() -
                    editorPadding -
                    warningOffset,
                width: $(iframe)
                    .parent()
                    .width() - editorPadding
            };
        };
        HtmlContentEditor.prototype.broadcastContentChanged = function () {
            var eventArgs = new Editor.ContentChangedEventArgs(this.html, this.id, null, Editor.CommonConstants.htmlEditorComponentName);
            this.highlightContent(this.html);
            this.eventBroker.notify(Editor.EventConstants.contentChanged, eventArgs);
        };
        HtmlContentEditor.prototype.getMonacoSettings = function () {
            var monacoSettings = {
                language: "html",
                wrappingColumn: 0,
                scrollBeyondLastLine: false,
                theme: Editor.CommonUtils.isHighContrastModeEnabled() ? this.highContrastTheme : this.defaultTheme,
                minimap: {
                    enabled: false
                }
            };
            if (!Utility.isNullOrUndefined(this.settings)) {
                for (var setting in this.settings) {
                    // tslint:disable-line
                    monacoSettings[setting] = this.settings[setting];
                }
            }
            return monacoSettings;
        };
        HtmlContentEditor.prototype.dispose = function () {
            var _this = this;
            this.executionContext.tryExecute(function () {
                _this.changeTimer.stop();
                _this.resizeTimer.stop();
                if (_this.editor) {
                    _this.loadingModal.dispose();
                    _this.loadingModal = null;
                    _this.editor.dispose();
                    _this.editor = null;
                }
                _this.getElement().empty();
                _this.monacoEditorIsLoading = false;
                if (_this.changeTimer) {
                    _this.changeTimer.dispose();
                    _this.changeTimer = null;
                }
                if (_this.resizeTimer) {
                    _this.resizeTimer.dispose();
                    _this.resizeTimer = null;
                }
                _this.keyboardCommandManager.unregisterCommandsInIframe(_this.iframe);
                $(_this.iframe).remove();
                _this.iframe = null;
                _this.keyboardCommandManager = null;
                _this.eventBroker.unsubscribe(Editor.EventConstants.maximizeExecuted, _this.onMaximizeExecuted);
                _this.eventBroker.unsubscribe(Editor.EventConstants.editorVisibilityChanged, _this.onEditorVisibilityChanged);
                _this.eventBroker.unsubscribe(Editor.EventConstants.contentModelInitialized, _this.onContentModelUpdated);
                _this.eventBroker = null;
            }, "Dispose the Html editor");
        };
        return HtmlContentEditor;
    }(Editor.Control));
    Editor.HtmlContentEditor = HtmlContentEditor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var HtmlContentHighlightParser = /** @class */ (function () {
        function HtmlContentHighlightParser(tag, attributes) {
            this.fixTagPos = 2;
            this.openTag = "<" + tag;
            this.blockSize = this.openTag.length;
            this.closedTag = "</" + tag.substring(0, tag.length - 1);
            this.attributes = attributes;
            this.dicSequences = {};
        }
        HtmlContentHighlightParser.prototype.findClosingTagForHighlight = function (str, pos) {
            var count = 1;
            for (var i = pos + this.blockSize; i < str.length; i++) {
                var chr = str.substring(i, i + this.blockSize);
                if (this.openTag === chr) {
                    count++;
                }
                else if (this.closedTag === chr) {
                    count--;
                }
                if (count === 0) {
                    return {
                        endPos: i + this.blockSize,
                        startPos: pos
                    };
                }
            }
            return null;
        };
        HtmlContentHighlightParser.prototype.searchHighlights = function (html) {
            var offsets = [];
            var offsetRange;
            var word;
            for (var i = 0; i < html.length; i++) {
                word = html.substring(i, i + this.blockSize);
                if (this.openTag === word && this.tagContainsAttribute(html, i + this.blockSize)) {
                    offsetRange = this.findClosingTagForHighlight(html, i);
                    i = offsetRange.endPos;
                    // fix element position in 2, because it has been removed at the begin.
                    offsetRange.endPos += this.fixTagPos;
                    offsets.push(offsetRange);
                }
            }
            return offsets;
        };
        HtmlContentHighlightParser.prototype.normalizeString = function (str) {
            return str.toLocaleLowerCase().replace(/'/g, '"');
        };
        HtmlContentHighlightParser.prototype.tagContainsAttribute = function (html, pos) {
            var closeTagPos = html.indexOf(">", pos);
            if (closeTagPos === -1) {
                return false;
            }
            var tagSubstring = this.normalizeString(html.substring(pos, closeTagPos));
            if (!this.dicSequences[tagSubstring]) {
                this.dicSequences[tagSubstring] = this.validateSubstring(tagSubstring);
            }
            return this.dicSequences[tagSubstring];
        };
        HtmlContentHighlightParser.prototype.validateSubstring = function (tagSubstring) {
            for (var i = 0; i < this.attributes.length; i++) {
                var attributePos = tagSubstring.indexOf(this.attributes[i]);
                if (attributePos === -1) {
                    return false;
                }
            }
            return true;
        };
        return HtmlContentHighlightParser;
    }());
    Editor.HtmlContentHighlightParser = HtmlContentHighlightParser;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var HtmlNotSupportedView = /** @class */ (function (_super) {
        __extends(HtmlNotSupportedView, _super);
        function HtmlNotSupportedView(containerId) {
            var _this = _super.call(this, containerId) || this;
            _this.htmlEditorErrorMessage = "HTML mode not supported.";
            _this.id = containerId;
            return _this;
        }
        HtmlNotSupportedView.prototype.init = function () { };
        HtmlNotSupportedView.prototype.activate = function () {
            _super.prototype.activate.call(this);
            this.render();
            Editor.AccessibilityInstructionsPopup.accessibilityInstructions =
                Editor.EditorAccessibilityInstructions.baseControlAccessibilityInstructions;
        };
        HtmlNotSupportedView.prototype.dispose = function () {
            this.getElement().empty();
        };
        HtmlNotSupportedView.prototype.render = function () {
            if (this.isActive) {
                var element = this.getElement().empty();
                var offlineErrorMessageContainer = $("<p>")
                    .text(Editor.CommonUtils.getLocalizedString(this.htmlEditorErrorMessage))
                    .addClass(Editor.CommonConstants.htmlEditorNotSupportedMessageClassName);
                element.append(offlineErrorMessageContainer);
            }
        };
        return HtmlNotSupportedView;
    }(Editor.Control));
    Editor.HtmlNotSupportedView = HtmlNotSupportedView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BasicTextInlineToolbar = /** @class */ (function () {
        function BasicTextInlineToolbar() {
        }
        BasicTextInlineToolbar.prototype.getName = function () {
            return "BasicTextInlineToolbar";
        };
        BasicTextInlineToolbar.prototype.getConfig = function () {
            var clipboard = ["Cut", "Copy"];
            if (Editor.CommonUtils.isIOS() || Editor.CommonUtils.isAndroid()) {
                clipboard = ["Cut", "Copy", "Paste", "PasteFromWord", "PasteText"];
            }
            return [
                clipboard,
                ["JustifyLeft", "AlignCenterCommand", "JustifyRight", "JustifyBlock"],
                ["Find", "Replace"],
                ["SelectAll"],
                ["BidiLtr", "BidiRtl"],
                ["Link", "Unlink", "Anchor"],
                ["NumberedList", "BulletedList"],
                ["HorizontalRule"],
                "/",
                ["Bold", "Italic", "Underline", "Strike", "Subscript", "Superscript"],
                ["RemoveFormat"],
                ["Styles", "Font", "FontSize"],
                ["TextColor", "BGColor"],
                ["SpecialChar"],
                ["cloneBlockBtn"]
            ];
        };
        return BasicTextInlineToolbar;
    }());
    Editor.BasicTextInlineToolbar = BasicTextInlineToolbar;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BasicButtonInlineToolbar = /** @class */ (function () {
        function BasicButtonInlineToolbar() {
        }
        BasicButtonInlineToolbar.prototype.getName = function () {
            return "BasicButtonInlineToolbar";
        };
        BasicButtonInlineToolbar.prototype.getConfig = function () {
            return [
                ["Font", "Styles", "FontSize"],
                ["TextColor", "BGColor"],
                ["JustifyLeft", "AlignCenterCommand", "JustifyRight", "JustifyBlock"],
                ["BidiLtr", "BidiRtl"],
                ["cloneBlockBtn"]
            ];
        };
        return BasicButtonInlineToolbar;
    }());
    Editor.BasicButtonInlineToolbar = BasicButtonInlineToolbar;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BasicImageInlineToolbar = /** @class */ (function () {
        function BasicImageInlineToolbar() {
        }
        BasicImageInlineToolbar.prototype.getName = function () {
            return "BasicImageToolbar";
        };
        BasicImageInlineToolbar.prototype.getConfig = function () {
            return [["imgGalleryBtn"], ["cloneBlockBtn"]];
        };
        return BasicImageInlineToolbar;
    }());
    Editor.BasicImageInlineToolbar = BasicImageInlineToolbar;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BasicDividerInlineToolbar = /** @class */ (function () {
        function BasicDividerInlineToolbar() {
        }
        BasicDividerInlineToolbar.prototype.getName = function () {
            return "BasicDividerToolbar";
        };
        BasicDividerInlineToolbar.prototype.getConfig = function () {
            return [
                ["dividerHeightCombo"],
                ["dividerAlignLeftBtn", "dividerAlignCenterBtn", "dividerAlignRightBtn"],
                ["dividerBorderStyleCombo"],
                ["cloneBlockBtn"]
            ];
        };
        return BasicDividerInlineToolbar;
    }());
    Editor.BasicDividerInlineToolbar = BasicDividerInlineToolbar;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var ImageBlock = /** @class */ (function () {
        function ImageBlock(imagePlaceholderHelper) {
            this.inlineToolbar = new Editor.BasicImageInlineToolbar();
            if (Utility.isNullOrUndefined(imagePlaceholderHelper)) {
                imagePlaceholderHelper = new Editor.ImagePlaceholderHelper(); // tslint:disable-line
            }
            this.imagePlaceholderHelper = imagePlaceholderHelper;
        }
        ImageBlock.prototype.getType = function () {
            return ImageBlock.type;
        };
        ImageBlock.prototype.getLocalizedTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.imageBlockTitleLabel);
        };
        ImageBlock.prototype.usePlainText = function () {
            return false;
        };
        ImageBlock.prototype.isEditable = function () {
            return false;
        };
        ImageBlock.prototype.getInlineToolbar = function () {
            return this.inlineToolbar;
        };
        ImageBlock.prototype.setup = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            if (Utility.isNullOrUndefined(this.onImageSourceChanged)) {
                this.eventBroker.subscribe(Editor.EventConstants.imageAttributeChanged, (this.onImageSourceChanged = function (eventArgs) {
                    return _this.updateImageSource(eventArgs);
                }));
            }
        };
        ImageBlock.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.eventBroker)) {
                this.eventBroker.unsubscribe(Editor.EventConstants.imageAttributeChanged, this.onImageSourceChanged);
                this.onImageSourceChanged = null;
            }
        };
        ImageBlock.prototype.isConfigured = function (block) {
            return (this.imagePlaceholderHelper.isImageConfigured(this.getSource(block)) ||
                !String.isNullUndefinedOrWhitespace(this.getWidth(block)) ||
                !String.isNullUndefinedOrWhitespace(this.getHeight(block)) ||
                !String.isNullUndefinedOrWhitespace(this.getAlt(block)) ||
                this.hasLink(block) ||
                !this.hasAlignment(block));
        };
        ImageBlock.prototype.decorate = function (block) {
            if (Editor.BlockUtils.getBlockType(block) === this.getType()) {
                var image = this.getImage(block);
                this.setMaxDimensions(image);
                this.decorateDataSrcAttribute(image);
                this.decorateBlockOverlay(image);
                this.setAriaLabel(block);
            }
        };
        ImageBlock.prototype.setFinalContent = function (block) {
            if (this.imagePlaceholderHelper.isPlaceholderNeeded(this.getSource(block))) {
                Editor.CommonUtils.removeBlockOverlay(block);
            }
            this.getImage(block).removeAttr(Editor.CommonConstants.designerImageSourceAttributeName);
            ;
            block.removeAttr("aria-label");
        };
        ImageBlock.prototype.onBlockAdded = function (block) { };
        ImageBlock.prototype.updateImageSource = function (eventArgs) {
            if (eventArgs.attributeName === Editor.CommonConstants.designerImageSourceAttributeName) {
                eventArgs.imageElement.attr("src", eventArgs.attributeValue);
                this.decorateDataSrcAttribute(eventArgs.imageElement);
                this.decorateBlockOverlay(eventArgs.imageElement);
                this.setAriaLabel(Editor.BlockUtils.getClosestBlockOrSubBlock(eventArgs.imageElement));
            }
        };
        ImageBlock.prototype.setAriaLabel = function (block) {
            var txt = "[" + (!this.isConfigured(block) ? "Unconfigured image block" : "Image block") + "]";
            var translatedText = Editor.CommonUtils.getLocalizedString(txt);
            var element = Editor.BlockProvider.getEditableElement(block);
            Editor.CommonUtils.setAriaAttribute(block, "aria-label", translatedText);
            Editor.CommonUtils.setAriaAttribute(element, "aria-label", translatedText);
            Editor.CommonUtils.setAriaAttribute(element, "title", translatedText);
        };
        ImageBlock.prototype.decorateDataSrcAttribute = function (image) {
            image.attr(Editor.CommonConstants.designerImageSourceAttributeName, image.attr("src"));
        };
        ImageBlock.prototype.setMaxDimensions = function (image) {
            image.css("max-height", "100%");
            image.css("max-width", "100%");
            image.css("box-sizing", "border-box");
        };
        ImageBlock.prototype.getImage = function (block) {
            return block.find("img").not("." + Editor.CommonConstants.unconfiguredImageOverlayIconCssClassName);
        };
        ImageBlock.prototype.getBlock = function (image) {
            return Editor.BlockUtils.getClosestBlockOrSubBlock(image);
        };
        ImageBlock.prototype.getSource = function (block) {
            return this.getImage(block).attr("src");
        };
        ImageBlock.prototype.getWidth = function (block) {
            return this.getImage(block).attr("width");
        };
        ImageBlock.prototype.getHeight = function (block) {
            return this.getImage(block).attr("height");
        };
        ImageBlock.prototype.getAlt = function (block) {
            return this.getImage(block).attr("alt");
        };
        ImageBlock.prototype.hasLink = function (block) {
            var parent = this.getImage(block).parent();
            if (parent) {
                return parent.prop("tagName") === "A";
            }
            return false;
        };
        ImageBlock.prototype.hasAlignment = function (block) {
            var parent = this.getImage(block).parent();
            if (parent) {
                return !String.isNullUndefinedOrWhitespace(parent.attr("align"));
            }
            return false;
        };
        ImageBlock.prototype.decorateBlockOverlay = function (image) {
            var block = this.getBlock(image);
            var element = image.parent();
            Editor.CommonUtils.removeBlockOverlay(block);
            if (this.imagePlaceholderHelper.isPlaceholderNeeded(this.getSource(block))) {
                Editor.CommonUtils.overlayBlockElement(element, image, this.imagePlaceholderHelper.getImagePlaceholder(this.getSource(block)), Editor.BlockType.Image, true, copyAttrsFromBlockToOverlay);
            }
        };
        ImageBlock.type = Editor.CommonConstants.imageToolType;
        return ImageBlock;
    }());
    Editor.ImageBlock = ImageBlock;
    function copyAttrsFromBlockToOverlay(block) {
        var height = $(block.find("img")[0]).attr("height");
        if (height) {
            block.find("." + Editor.CommonConstants.unconfiguredImageOverlayIconCssClassName).css("height", height + ".px");
        }
        var width = $(block.find("img")[0]).attr("width");
        if (width) {
            block.find("." + Editor.CommonConstants.unconfiguredImageOverlayIconCssClassName).css("width", width + ".px");
        }
        var alt = $(block.find("img")[0]).attr("alt");
        if (alt) {
            block.find("." + Editor.CommonConstants.unconfiguredImageOverlayIconCssClassName).attr("alt", alt);
        }
    }
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var TextBlock = /** @class */ (function () {
        function TextBlock(inlineToolbar, imagePlaceholderHelper) {
            if (Utility.isNullOrUndefined(inlineToolbar)) {
                inlineToolbar = new Editor.BasicTextInlineToolbar(); // tslint:disable-line
            }
            this.inlineToolbar = inlineToolbar;
            if (Utility.isNullOrUndefined(imagePlaceholderHelper)) {
                imagePlaceholderHelper = new Editor.ImagePlaceholderHelper(); // tslint:disable-line
            }
            this.imagePlaceholderHelper = imagePlaceholderHelper;
        }
        TextBlock.prototype.getType = function () {
            return TextBlock.type;
        };
        TextBlock.prototype.getLocalizedTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.textBlockTitleLabel);
        };
        TextBlock.prototype.usePlainText = function () {
            return true;
        };
        TextBlock.prototype.isEditable = function () {
            return true;
        };
        TextBlock.prototype.getInlineToolbar = function () {
            return this.inlineToolbar;
        };
        TextBlock.prototype.setup = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            if (Utility.isNullOrUndefined(this.onImageSourceChanged)) {
                this.eventBroker.subscribe(Editor.EventConstants.imageAttributeChanged, (this.onImageSourceChanged = function (eventArgs) {
                    return _this.updateImageSource(eventArgs);
                }));
            }
            if (Utility.isNullOrUndefined(this.onSelectionChanged)) {
                this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.selectionChanged, (this.onSelectionChanged = function (eventArgs) {
                    return _this.updateAriaLabels(eventArgs);
                }));
            }
        };
        TextBlock.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.eventBroker)) {
                this.eventBroker.unsubscribe(Editor.EventConstants.imageAttributeChanged, this.onImageSourceChanged);
                this.onImageSourceChanged = null;
                this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.selectionChanged, this.onSelectionChanged);
                this.onSelectionChanged = null;
            }
        };
        TextBlock.prototype.isConfigured = function (block) {
            return (Editor.CommonUtils.getByClass(Editor.CommonConstants.designerUnconfiguredContentOverlayCssClassName, block).length ===
                0);
        };
        TextBlock.prototype.decorate = function (block) {
            var _this = this;
            var translatedLabel = Editor.CommonUtils.getLocalizedString("[" + block.attr(Editor.Contract.blockTypeAttrName) + " block]");
            Editor.CommonUtils.setAriaAttribute(block, "aria-label", translatedLabel);
            block.find("img").each(function (index, element) {
                var image = $(element);
                image.attr(Editor.CommonConstants.designerImageSourceAttributeName, image.attr("src"));
                _this.decorateImageOverlay(image, image.attr("src"));
            });
        };
        TextBlock.prototype.updateAriaLabels = function (eventArgs) {
            var operableBlock = eventArgs.getOperableBlock();
            if (Editor.BlockUtils.getBlockType(operableBlock) === this.getType()) {
                var wrapper = Editor.BlockProvider.getEditableElement(operableBlock);
                var searchLength = 50;
                wrapper.attr("aria-label", eventArgs.getOperableBlock().attr("aria-label") + " " + eventArgs
                    .getOperableBlock()
                    .find("p")
                    .text()
                    .substr(0, searchLength));
            }
        };
        TextBlock.prototype.updateImageSource = function (eventArgs) {
            if (eventArgs.attributeName === Editor.CommonConstants.designerTextBlockImageSourceAttributeName) {
                eventArgs.imageElement.attr(Editor.CommonConstants.designerImageSourceAttributeName, eventArgs.attributeValue);
                this.decorateImageOverlay(eventArgs.imageElement, eventArgs.attributeValue);
            }
        };
        TextBlock.prototype.decorateImageOverlay = function (image, imageSrc) {
            if (this.imagePlaceholderHelper.isPlaceholderNeeded(imageSrc)) {
                Editor.CommonUtils.overlayImageElement(image, this.imagePlaceholderHelper.getImagePlaceholder(imageSrc));
            }
            else {
                Editor.CommonUtils.removeImageOverlay(image);
            }
        };
        TextBlock.prototype.setFinalContent = function (block) {
            var images = block.find("img");
            if (!this.isConfigured(block)) {
                var unconfiguredImages = images.filter(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.designerUnconfiguredContentOverlayCssClassName));
                unconfiguredImages.each(function (index, element) {
                    var image = $(element);
                    Editor.CommonUtils.removeImageOverlay(image);
                });
            }
            images.removeAttr(Editor.CommonConstants.designerImageSourceAttributeName);
            block.removeAttr("aria-label");
        };
        TextBlock.prototype.onBlockAdded = function (block) {
            block
                .children()
                .first()
                .focus();
        };
        TextBlock.type = Editor.CommonConstants.textToolType;
        return TextBlock;
    }());
    Editor.TextBlock = TextBlock;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var ButtonBlock = /** @class */ (function () {
        function ButtonBlock() {
            this.inlineToolbar = new Editor.BasicButtonInlineToolbar();
        }
        ButtonBlock.prototype.getType = function () {
            return ButtonBlock.type;
        };
        ButtonBlock.prototype.getLocalizedTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.buttonBlockTitleLabel);
        };
        ButtonBlock.prototype.usePlainText = function () {
            return true;
        };
        ButtonBlock.prototype.isEditable = function () {
            return true;
        };
        ButtonBlock.prototype.getInlineToolbar = function () {
            return this.inlineToolbar;
        };
        ButtonBlock.prototype.setup = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            if (Utility.isNullOrUndefined(this.onTargetLinkUpdated)) {
                this.eventBroker.subscribe(this.getType() + "_" + Editor.EventConstants.hrefAttributeChanged, (this.onTargetLinkUpdated = function (eventArgs) {
                    return _this.buttonHrefChanged(eventArgs);
                }));
            }
        };
        ButtonBlock.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.onTargetLinkUpdated)) {
                this.eventBroker.unsubscribe(this.getType() + "_" + Editor.EventConstants.hrefAttributeChanged, this.onTargetLinkUpdated);
                this.onTargetLinkUpdated = null;
            }
        };
        ButtonBlock.prototype.decorate = function (block) {
            this.setAriaLabel(block);
        };
        ButtonBlock.prototype.setAriaLabel = function (block) {
            var txt = "[" + (!this.isConfigured(block) ? "Unconfigured " : String.Empty) + block.attr(Editor.Contract.blockTypeAttrName) + " block]";
            var translatedText = Editor.CommonUtils.getLocalizedString(txt);
            var element = Editor.BlockProvider.getEditableElement(block);
            Editor.CommonUtils.setAriaAttribute(block, "aria-label", translatedText);
            Editor.CommonUtils.setAriaAttribute(element, "aria-label", translatedText);
            Editor.CommonUtils.setAriaAttribute(element, "title", translatedText);
        };
        ButtonBlock.prototype.isConfigured = function (block) {
            var href = this.getTargetLink(block);
            return !String.isNullUndefinedOrWhitespace(href) && href !== "#";
        };
        ButtonBlock.prototype.setFinalContent = function (block) {
            block.removeAttr("aria-label");
        };
        ButtonBlock.prototype.onBlockAdded = function (block) { };
        ButtonBlock.prototype.buttonHrefChanged = function (eventArgs) {
            this.decorate(this.getBlock(eventArgs.element));
            this.setAriaLabel(eventArgs.element.closest("[" + Editor.Contract.blockTypeAttrName + "]"));
        };
        ButtonBlock.prototype.getTargetLink = function (block) {
            return this.getLinkElement(block).attr("href");
        };
        ButtonBlock.prototype.getLinkElement = function (block) {
            return block.find("a");
        };
        ButtonBlock.prototype.getBlock = function (button) {
            return Editor.BlockProvider.getClosestBlock(button);
        };
        ButtonBlock.prototype.getButtonAlignment = function (block) {
            // Gets styles using JS, because JQuery returns values in pixels.
            var anchorElement = block.find("a").get(0);
            if (!Utility.isNullOrUndefined(anchorElement)) {
                var marginLeftValue = anchorElement.style.marginLeft;
                var marginRightValue = anchorElement.style.marginRight;
                if (marginLeftValue === "0px" && marginRightValue === "auto") {
                    return "Left";
                }
                if (marginLeftValue === "auto" && marginRightValue === "0px") {
                    return "Right";
                }
                if (marginLeftValue === "auto" && marginRightValue === "auto") {
                    return "Center";
                }
            }
            return null;
        };
        ButtonBlock.type = Editor.CommonConstants.buttonToolType;
        return ButtonBlock;
    }());
    Editor.ButtonBlock = ButtonBlock;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DividerBlock = /** @class */ (function () {
        function DividerBlock() {
            this.inlineToolbar = new Editor.BasicDividerInlineToolbar();
        }
        DividerBlock.prototype.getType = function () {
            return Editor.CommonConstants.dividerToolType;
        };
        DividerBlock.prototype.getLocalizedTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.dividerBlockTitleLabel);
        };
        DividerBlock.prototype.usePlainText = function () {
            return false;
        };
        DividerBlock.prototype.isEditable = function () {
            return false;
        };
        DividerBlock.prototype.getInlineToolbar = function () {
            return this.inlineToolbar;
        };
        DividerBlock.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        DividerBlock.prototype.dispose = function () { };
        DividerBlock.prototype.isConfigured = function (block) {
            return true;
        };
        DividerBlock.prototype.decorate = function (block) {
            var translatedLabel = Editor.CommonUtils.getLocalizedString("[" + block.attr(Editor.Contract.blockTypeAttrName) + " block]");
            Editor.CommonUtils.setAriaAttribute(block, "aria-label", translatedLabel);
        };
        DividerBlock.prototype.setFinalContent = function (block) {
            block.removeAttr("aria-label");
        };
        DividerBlock.prototype.onBlockAdded = function (block) { };
        return DividerBlock;
    }());
    Editor.DividerBlock = DividerBlock;
})(Editor || (Editor = {}));
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Command to set alignment for the selected divider block.
     */
    var DividerAlignCommand = /** @class */ (function () {
        /**
         * Initializes a new instance of the DividerAlignCommand class.
         * @param align The alignment of the divider, that must be set using the command.
         * @param commandName The name of the command.
         * @param buttonsName The names of the align buttons.
         * @param activeButtonName The name of the pressed button.
         */
        function DividerAlignCommand(align, commandName, groupButtonsNames, buttonName, defaultButton, defaultAlign) {
            this.align = align;
            this.commandName = commandName;
            this.groupButtonsNames = groupButtonsNames;
            this.buttonName = buttonName;
            this.defaultButton = defaultButton;
            this.defaultAlign = defaultAlign;
        }
        /**
         * @see ICommand.isContextSensitive
         */
        DividerAlignCommand.prototype.isContextSensitive = function () {
            return false;
        };
        /**
         * Gets the name of the command.
         */
        DividerAlignCommand.prototype.getName = function () {
            return this.commandName;
        };
        /**
         * Enabled if editor is in read only mode.
         */
        DividerAlignCommand.prototype.enabledOnReadOnly = function () {
            return true;
        };
        /**
         * Configure the command.
         * @param eventBroker An instance of event broker.
         */
        DividerAlignCommand.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        /**
         * Executes the command and sets center align for the currently selected block.
         * @param selectedBlock The currently selected block.
         * @param wrappedBlock The top-wrapping element.
         * @param selectedHtml The selected html, if any.
         */
        DividerAlignCommand.prototype.exec = function (selectedBlock, wrappedBlock, selectedHtml) {
            if (Utility.isNullOrUndefined(selectedBlock)) {
                return false;
            }
            if (Utility.isNullOrUndefined(this.eventBroker)) {
                return false;
            }
            var currentAlign = this.align;
            var toolbar = new Editor.InlineToolbar(selectedBlock.children().attr("id"));
            var groupButtons = [];
            this.groupButtonsNames.forEach(function (buttonName) {
                groupButtons.push(toolbar.getButton(buttonName));
            });
            var activeButton = toolbar.getButton(this.buttonName);
            // Setting default value when pressed again on the active button
            if (activeButton.isSelected() && currentAlign !== this.defaultAlign) {
                currentAlign = this.defaultAlign;
                activeButton = toolbar.getButton(this.defaultButton);
            }
            // Disable all buttons
            groupButtons.forEach(function (button) {
                button.turnOff();
            });
            var paragraph = selectedBlock.find("p");
            var dividerWrapper = selectedBlock.find(".dividerWrapper");
            // Set divider center alignment
            paragraph.css("margin-left", "auto");
            paragraph.css("margin-right", "auto");
            // Set active style for the active button
            activeButton.turnOn();
            // Use align for the Outlook
            dividerWrapper.attr("align", currentAlign);
            if (currentAlign !== "center") {
                // Set divider alignment
                paragraph.css("margin-" + currentAlign, "0");
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged);
            return true;
        };
        /**
         * @see ICommand.shouldSetToolHighlight
         */
        DividerAlignCommand.prototype.shouldSetToolHighlight = function (element) {
            return false;
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        DividerAlignCommand.prototype.dispose = function () { };
        /*
         * Cleans up the html elements that where added to the page
         */
        DividerAlignCommand.prototype.cleanup = function (blockElements) { };
        return DividerAlignCommand;
    }());
    Editor.DividerAlignCommand = DividerAlignCommand;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    /**
     * This class contains the constant values used in html to define the template model (where are the blocks, containers, etc)
     * All templates have to have these attributes added in the html
     */
    var Contract = /** @class */ (function () {
        function Contract() {
        }
        Contract.idAttrName = "id";
        /**
         * Identifier for new layout tools.
         */
        Contract.dataLayoutAttrName = "data-layout";
        /**
         * Data attribute for a tool in toolbox
         */
        Contract.editorToolType = "data-editortool-type";
        /**
         * The block identifier. The value of the attribute is the block type (text, image, etc.).
         */
        Contract.blockTypeAttrName = "data-editorblocktype";
        /**
         * The container identifier. The blocks can be dropped only inside the containers.
         */
        Contract.containerAttrName = "data-container";
        /**
         * The column css class identifier.
         */
        Contract.containerCssClass = "columnContainer";
        /**
         * Column width percentage identifier.
         */
        Contract.dataContainerWidth = "data-container-width";
        /**
         * The data identifier. The unique identifier of tab buttons.
         */
        Contract.dataIdAttrName = "data-id";
        /**
         * Attribute to control whether the block should appear as readonly by
         * default or not.
         */
        Contract.dataProtectedAttrName = "data-protected";
        Contract.dataLockedAttrName = "data-locked";
        /**
         * The section identifier.
         */
        Contract.dataSectionAttrName = "data-section";
        /**
         * The section identifier.
         */
        Contract.dataCustomSectionAttrName = "data-custom-section";
        /**
         * Attribute to identify sub blocks used by Content Blocks
         */
        Contract.subBlockAttrName = "data-sub-block";
        /**
         * Attribute to identify the type of a Content Block
         */
        Contract.blockDatatypeAttrName = "data-block-datatype";
        /* STYLES */
        /**
         * The type of the meta tag for the style variable
         */
        Contract.styleMetadataTypeAttr = "xrm/designer/setting";
        /**
         * The attribute name for variable name
         */
        Contract.metadataNameAttr = "name";
        /**
         * The attribute name for variable data type
         */
        Contract.metadataDatatypeAttr = "datatype";
        /**
         * The attribute name for variable data type
         */
        Contract.metadataLabelAttr = "label";
        /**
         * The attribute name for variable value
         */
        Contract.metadataValueAttr = "value";
        /**
         * The attribute name for group value
         */
        Contract.metadataGroupAttr = "group";
        /**
         * The attribute name for group value
         */
        Contract.styleMetadataGroupType = "style";
        /**
         * The attribute name for variable value format
         */
        Contract.metadataFormatAttr = "format";
        /**
         * The color data type of the style variable
         */
        Contract.styleMetadataColorDataType = "color";
        /**
         * The picture data type of the style variable
         */
        Contract.styleMetadataPictureDataType = "picture";
        /**
         * The input data type of the style variable
         */
        Contract.styleMetadataNumberDataType = "number";
        /**
         * The data type of the font specification which can be used in CKEditor
         */
        Contract.styleMetadataFontDataType = "font";
        /**
         * The test data type of the style variable
         */
        Contract.styleMetadataTestDataType = "text";
        /**
         * The document version name
         */
        Contract.metadataDocumentVersionName = "version";
        /**
         * The document version type
         */
        Contract.metadataDocumentTypeName = "type";
        /**
         * The document content
         */
        Contract.metadataDocumentContentName = "content";
        /**
         * The document meta tag for viewport
         */
        Contract.metadataViewportValue = "viewport";
        /**
         * The document version type value to show designer view
         */
        Contract.metadataDocumentTypeDesignerValue = "marketing-designer-content-editor-document";
        /**
         * The document meta tag for editable layout
         */
        Contract.metadataDocumentLayoutEditableName = "layout-editable";
        /**
         * The document meta tag for maximum layout width
         */
        Contract.metadataDocumentLayoutMaxWidthName = "layout-max-width";
        /**
         * The document meta tag for editable layout
         */
        Contract.metadataLayoutEditableValue = "marketing-designer-layout-editable";
        /**
         * The document meta tag for disabled post processing
         */
        Contract.metadataPostProcessorsDisabledName = "post-processors";
        /**
         * The document meta tag for disabled post processing
         */
        Contract.metadataPostProcessorsDisabledValue = "post-processors-off";
        /**
         * Data-protected attribute name
         */
        Contract.dataProtectedAttribute = "data-protected";
        /**
         * The block focus ID attribute
         */
        Contract.blockFocusIdAttribute = "data-block-focus-id";
        return Contract;
    }());
    Editor.Contract = Contract;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
var Editor;
(function (Editor) {
    var EventConstants = /** @class */ (function () {
        function EventConstants() {
        }
        EventConstants.refreshEditor = "refreshEditor";
        EventConstants.contentModelInitialized = "contentModelInitialized";
        EventConstants.contentModelUpdated = "contentModelUpdated";
        EventConstants.codeBlockUpdated = "codeBlockUpdated";
        EventConstants.onCodeBlockUpdatedHook = "onCodeBlockUpdatedHook";
        EventConstants.contentChanged = "contentChanged";
        EventConstants.contentResolved = "contentResolved";
        EventConstants.contentFinalized = "contentFinalized";
        EventConstants.elementsCanBeInserted = "elementsCanBeInserted";
        EventConstants.elementsCannotBeInserted = "elementsCannotBeInserted";
        EventConstants.controlRendered = "controlRendered";
        EventConstants.subBlockDetailsViewWasRendered = "subBlockDetailsViewWasRendered";
        EventConstants.browserPreviewReady = "browserPreviewReady";
        EventConstants.bringIntoView = "bringIntoView";
        EventConstants.blockAdded = "blockAdded";
        EventConstants.blockMoved = "blockMoved";
        EventConstants.blockDeleted = "blockDeleted";
        EventConstants.sectionAdded = "sectionAdded";
        EventConstants.sectionMoved = "sectionMoved";
        EventConstants.sectionDeleted = "sectionDeleted";
        EventConstants.renderTools = "renderTools";
        EventConstants.imageAttributeChanged = "imageAttributeChanged";
        EventConstants.imageInputChanged = "imageInputChanged";
        EventConstants.hrefAttributeChanged = "hrefAttributeChanged";
        EventConstants.imageGalleryCommandExecuted = "imageGalleryCommandExecuted";
        EventConstants.contentBlockAttributeChanged = "contentBlockAttributeChanged";
        EventConstants.toolbarShown = "toolbarShown";
        EventConstants.maximizeExecuted = "maximizeExecuted";
        EventConstants.saveRequested = "saveRequested";
        EventConstants.previewSizeChanged = "previewSizeChanged";
        EventConstants.exitFullScreenButtonClicked = "exitFullScreenButtonClicked";
        EventConstants.fullPageEditorContentChanged = "fullPageEditorContentChanged";
        EventConstants.standardCkEditorInitialized = "standardCkEditorInitialized";
        EventConstants.sectionToolsPublishStarted = "sectionToolsPublishStarted";
        EventConstants.sectionToolsPublishCompleted = "sectionToolsPublishCompleted";
        EventConstants.toolPublished = "toolPublished";
        EventConstants.fullPageEditorRendered = "fullPageEditorRendered";
        EventConstants.basicPreviewModeSwitched = "basicPreviewModeSwitched";
        EventConstants.onElementFocusedIn = "onElementFocusedIn";
        EventConstants.onKeypressToFocusPreviousElementCalled = "onKeypressToFocusPreviousElementCalled";
        EventConstants.onToolboxAccessibleContainerRendered = "onToolboxAccessibleContainerRendered";
        EventConstants.onToolboxAccessibleItemRendered = "onToolboxAccessibleItemRendered";
        EventConstants.onPreviewAccessibleContainerRendered = "onPreviewAccessibleContainerRendered";
        EventConstants.onPreviewAccessibleItemRendered = "onPreviewAccessibleItemRendered";
        EventConstants.editorVisibilityChanged = "editorVisibilityChanged";
        EventConstants.contentRefreshed = "contentRefreshed";
        EventConstants.contentModelProcessCompleted = "contentModelProcessCompleted";
        EventConstants.litmusStatusChanged = "litmusStatusChanged";
        EventConstants.litmusUnavailable = "litmusUnavailable";
        EventConstants.litmusTrialOrg = "litmusTrialOrg";
        EventConstants.litmusDisabled = "litmusDisabled";
        EventConstants.imagePopupRendered = "imagePopupRendered";
        EventConstants.videoSelectionChanged = "videoSelectionChanged";
        EventConstants.abTestingConfigurationChanged = "abTestingConfigurationChanged";
        EventConstants.abTestingBodyTestDeleted = "abTestingBodyTestDeleted";
        EventConstants.emailTemplateChanged = "emailTemplateChanged";
        EventConstants.emailContentLanguageLocaleChanged = "emailContentLanguageLocaleChanged";
        EventConstants.emailPreheaderValueChanged = "emailPreheaderValueChanged";
        EventConstants.emailSubjectValueChanged = "emailSubjectValueChanged";
        EventConstants.emailFromNameValueChanged = "emailFromNameValueChanged";
        EventConstants.emailFromEmailValueChanged = "emailFromEmailValueChanged";
        EventConstants.emailToValueChanged = "emailToValueChanged";
        EventConstants.emailReplyToEmailValueChanged = "emailReplyToEmailValueChanged";
        EventConstants.detailsViewOrigin = "detailsViewOrigin";
        EventConstants.linkRendererDisposed = "linkRendererDisposed";
        EventConstants.stylesTabVisibility = "stylesTabVisibility";
        return EventConstants;
    }());
    Editor.EventConstants = EventConstants;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    var TraceLevel = MktSvc.Controls.Common.TraceLevel;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var DelayScheduler = MktSvc.Controls.Common.DelayScheduler;
    /**
     * A wrapper class for the ck editor api setup.
     */
    var CkEditorProxy = /** @class */ (function () {
        function CkEditorProxy(executionContext, localeProvider, fontsProvider, eventBroker, customCkEditorConfiguration) {
            var _this = this;
            this.ckEditorBasePath = "ckeditor";
            this.ckEditorScriptId = "designer-dependency-ckeditor";
            this.cdnBasePath = executionContext.getLibsPath();
            this.localeProvider = localeProvider;
            this.fontsProvider = fontsProvider;
            this.executionContext = executionContext;
            this.customCkEditorConfiguration = customCkEditorConfiguration;
            this.eventBroker = eventBroker;
            this.changeTimer = new DelayScheduler(this.eventBroker);
            this.changeTimer.init(function () {
                _this.notifyBlockChanged();
            }, CkEditorProxy.changeDelayInMs);
        }
        /**
         * Initlializes the static ck editor configuration.
         */
        CkEditorProxy.prototype.init = function (parentIframe, callback, documentContentModel) {
            var _this = this;
            this.ckEditorInitialization = $.Deferred();
            // Register custom GETURL function, which removes timestamp parameter
            parentIframe.contentWindow.CKEDITOR_GETURL = function (resource) {
                if (resource.indexOf(_this.cdnBasePath) !== 0 &&
                    resource.indexOf(":/") === -1 &&
                    resource.indexOf("/") !== 0) {
                    resource = _this.cdnBasePath + "/" + _this.ckEditorBasePath + "/" + resource; // tslint:disable-line
                }
                if (resource.indexOf("?t=") !== -1) {
                    resource = resource.substring(0, resource.indexOf("?t=")); // tslint:disable-line
                }
                return resource;
            };
            // Init the scripts
            var ckEditorScript = Editor.CommonUtils.createScriptElementFromUrl(this.ckEditorScriptId, String.Format("{0}/{1}/{2}", this.cdnBasePath, this.ckEditorBasePath, "ckeditor.js"), parentIframe.contentDocument);
            ckEditorScript.onload = function () {
                _this.executionContext.tryExecute(function () {
                    _this.contentWindow = parentIframe.contentWindow;
                    var ckeditor = _this.getCkEditor();
                    if (ckeditor) {
                        window.CKEDITOR = ckeditor;
                        CKEDITOR.disableAutoInline = true;
                        CKEDITOR.config.fillEmptyBlocks = false;
                        CKEDITOR.config.basicEntities = true;
                        CKEDITOR.config.language = _this.localeProvider.getLanguageCode();
                        CKEDITOR.config.removePlugins = CkEditorProxy.removePlugins;
                        CKEDITOR.config.extraPlugins = CkEditorProxy.extraPlugins;
                        CKEDITOR.config.title = false;
                        CKEDITOR.config.disableNativeSpellChecker = false;
                        CKEDITOR.config.browserContextMenuOnCtrl = true;
                        CKEDITOR.config.keystrokes = [];
                        // ICM https://portal.microsofticm.com/imp/v3//incidents/details/184023487/home
                        delete CKEDITOR.dtd.$removeEmpty["font"]; // tslint:disable-line
                        delete CKEDITOR.dtd.$inline["font"]; // tslint:disable-line
                        // Setup content styles
                        if (Utility.isNullOrUndefined(CKEDITOR.stylesSet.get(CkEditorProxy.styleSetName))) {
                            CKEDITOR.stylesSet.add(CkEditorProxy.styleSetName, new Editor.CkEditorContentStyleSetFactory().createStyleSet());
                        }
                        CKEDITOR.config.stylesSet = CkEditorProxy.styleSetName;
                        var ckeditorFonts = CKEDITOR.config.font_names;
                        if (ckeditorFonts == null) {
                            ckeditorFonts = "";
                        }
                        var fonts = ckeditorFonts.split(";");
                        fonts = fonts.concat(CkEditorProxy.extraFonts).sort();
                        CKEDITOR.config.font_names = fonts.join(";");
                        // Set up additional fonts
                        if (!Utility.isNullOrUndefined(documentContentModel)) {
                            var additionalFontsString = _this.fontsProvider
                                .getAdditionalFontsString(documentContentModel.getStyleMetaEntries())
                                .items()
                                .join(";")
                                .trim();
                            if (additionalFontsString) {
                                CKEDITOR.config.font_names =
                                    additionalFontsString + ";" + CKEDITOR.config.font_names;
                            }
                        }
                        CKEDITOR.config.enterMode = CKEDITOR.ENTER_BR;
                        if (_this.customCkEditorConfiguration) {
                            var ckeditorSettings = _this.customCkEditorConfiguration.ckeditorSettings;
                            if (ckeditorSettings) {
                                for (var property in ckeditorSettings) {
                                    if (ckeditorSettings.hasOwnProperty(property)) {
                                        CKEDITOR[property] = ckeditorSettings[property];
                                    }
                                }
                            }
                            var globalConfiguration = _this.customCkEditorConfiguration.globalConfiguration;
                            if (globalConfiguration) {
                                for (var property in globalConfiguration) {
                                    if (globalConfiguration.hasOwnProperty(property)) {
                                        CKEDITOR.config[property] = globalConfiguration[property];
                                    }
                                }
                            }
                        }
                        // Add custom skin styles without timestamp and with accessibility fixes
                        $(parentIframe)
                            .contents()
                            .find("head")
                            .append(_this.getCustomCkEditorSkinStylesElement());
                        _this.registerAccessibilityFixes($(parentIframe));
                        _this.updateAccessibilityInstructions();
                        // Done
                        ckEditorScript.onload = null;
                        ckEditorScript = null;
                        _this.ckEditorInitialization.resolve();
                        callback();
                    }
                }, "Configure the static ckeditor", true);
            };
            parentIframe.contentDocument.head.appendChild(ckEditorScript);
        };
        /**
         * Returns promise which identify that ckeditor was initialized
         */
        CkEditorProxy.prototype.getCkEditorInitializedPromise = function () {
            return this.ckEditorInitialization
                ? this.ckEditorInitialization.promise()
                : (this.ckEditorInitialization = $.Deferred()).promise();
        };
        /**
         * Cleans up the specified element from CK Editor dependencies.
         */
        CkEditorProxy.prototype.cleanup = function (content) {
            var _this = this;
            // Cleanup the temp styles and scripts
            Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrSelector(Editor.CkEditorConstants.ckEditorSharedResourceAttribute), content).remove();
            Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrSelector("data-cke-temp"), content).remove();
            Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrSelector('class^="cke"'), content).remove();
            Editor.CommonUtils.getBySelector("script", content).each(function (index, value) {
                // Delete scripts coming from bellow the base cdn path
                var $script = $(value);
                var scriptSource = $script.attr("src");
                if (scriptSource && scriptSource.indexOf(_this.ckEditorBasePath) >= 0) {
                    $script.remove();
                }
            });
            Editor.CommonUtils.getBySelector("link", content).each(function (index, value) {
                // Delete links coming from bellow the base cdn path
                var $link = $(value);
                var linkSource = $link.attr("href");
                if (linkSource && linkSource.indexOf(_this.ckEditorBasePath) >= 0) {
                    $link.remove();
                }
            });
            Editor.CommonUtils.getBySelector("style", content).each(function (index, value) {
                var $style = $(value);
                if ($style.html().indexOf(".cke") >= 0) {
                    $style.remove();
                }
            });
        };
        /**
         * Dispose of all shared resources.
         */
        CkEditorProxy.prototype.dispose = function () {
            // Most probably even unloaded by this point of time
            if (!Utility.isNullOrUndefined(this.contentWindow)) {
                Editor.CommonUtils.getById("designer-dependency-ckeditor", $(this.contentWindow.document)).remove();
                this.contentWindow = null;
            }
            if (!Utility.isNullOrUndefined(this.pluginAdapter)) {
                this.pluginAdapter.dispose();
                this.pluginAdapter = null;
            }
            if (!Utility.isNullOrUndefined(this.ckEditorInitialization)) {
                this.ckEditorInitialization.reject();
            }
        };
        /**
         * Removed the ckeditor from the page.
         * @param editorId - The editor id that should be removed.
         */
        CkEditorProxy.prototype.destroyEditor = function (editorId) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                var instance = _this.getCkEditorInstance(editorId);
                if (instance) {
                    if (instance.focusManager) {
                        instance.focusManager.hasFocus = false;
                    }
                    instance.destroy();
                }
            }, "Destroy the ckeditor");
        };
        /**
         * Removed all ckeditor instances from the page.
         */
        CkEditorProxy.prototype.destroyAllEditors = function () {
            var _this = this;
            this.executionContext.tryExecute(function () {
                var instances = _this.getCkEditor().instances;
                for (var editorId in instances) {
                    if (instances.hasOwnProperty(editorId)) {
                        _this.destroyEditor(editorId);
                    }
                }
            }, "Destroy all ckeditor instances");
        };
        CkEditorProxy.prototype.setupToolbarConfiguration = function (toolbarConfig) {
            var basicConfig = {};
            basicConfig["toolbar"] = toolbarConfig.getName();
            basicConfig["toolbar_" + toolbarConfig.getName()] = toolbarConfig.getConfig();
            basicConfig["allowedContent"] = true;
            return basicConfig;
        };
        /**
         * Get the content of the editor. The content is cleaned up - does not contain any ck editor attributes
         * @param editor - The editor instance
         */
        CkEditorProxy.prototype.getContent = function (editor) {
            var data = String.Empty;
            if (!Utility.isNullOrUndefined(editor)) {
                this.executionContext.tryExecute(function () {
                    data = editor.getData();
                }, "Get ckeditor content");
            }
            return data;
        };
        /**
         * Set the content of the editor.
         * @param content - The data, that will setted in the editor
         * @param editor - The editor instance
         */
        CkEditorProxy.prototype.setContent = function (content, editor, callback) {
            this.executionContext.tryExecute(function () {
                if (!Utility.isNullOrUndefined(editor)) {
                    editor.setData(content, {
                        callback: function () {
                            editor.updateElement();
                            if (Editor.CommonUtils.isFunction(callback)) {
                                callback();
                            }
                        }
                    });
                }
            }, "Set ckeditor content");
        };
        /**
         * Set attributes on the CK Editor element
         * @param editorId - The editor id
         */
        CkEditorProxy.prototype.setRequiredAttributes = function (editor) {
            // This should actually be set by the ckeditor itself, but does not because we use ckeditor inside an iframe.
            var ckEditorElement = this.getCkEditorElement(editor);
            if (!Utility.isNullOrUndefined(ckEditorElement)) {
                ckEditorElement.setAttribute("tabIndex", "0");
                // Remove contenteditable attribute from inputs and textarea inside the editor to prevent ckeditor issues in Chrome.
                $(ckEditorElement)
                    .find("input")
                    .removeAttr(Editor.CommonConstants.contentEditableAttrName);
                $(ckEditorElement)
                    .find("textarea")
                    .removeAttr(Editor.CommonConstants.contentEditableAttrName);
            }
        };
        /**
         * Set the block to read only mode
         * @param editorId - The editor id
         */
        CkEditorProxy.prototype.setReadOnly = function (editorId) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                var instance = _this.getCkEditorInstance(editorId);
                if (!Utility.isNullOrUndefined(instance)) {
                    instance.setReadOnly();
                }
            }, "Set ckeditor readonly mode");
        };
        /**
         * Register accessibility fixes for CKeditor.
         * @param parentIframe Iframe that contains CKeditor.
         */
        CkEditorProxy.prototype.registerAccessibilityFixes = function (parentIframe) {
            var _this = this;
            // Register accessibility fixes for ckeditor dialogs
            this.getCkEditor().on("dialogDefinition", function (ev) {
                _this.executionContext.tryExecute(function () {
                    // Take the dialog attributes from the event data
                    var dialogDefinition = ev.data.definition;
                    var dialog = dialogDefinition.dialog;
                    var dialogName = ev.data.name;
                    // Apply fixes for role attribute
                    $(dialog.parts.title.$).attr("role", "heading");
                    $(dialog.parts.title.$).attr("aria-level", "1");
                    if (dialog.parts.close) {
                        setTimeout(function () {
                            // Add close "x" button into dialog focusable collection
                            dialog.addFocusable(dialog.parts.close);
                            // Remove default keydown listener before adding custom listener
                            var ckeditorNativeEvents = dialog.parts.close.getCustomData(Editor.CkEditorConstants.ckEditorNativeListeners);
                            dialog.parts.close.$.removeEventListener("keydown", ckeditorNativeEvents["keydown"]);
                            // Trigger native js event to prevent ckeditor errors
                            $(dialog.parts.close.$).on("keydown", function (event) {
                                if (event.keyCode === KeyCodes.Enter || event.keyCode === KeyCodes.Space) {
                                    event.preventDefault();
                                    event.stopPropagation();
                                    dialog.parts.close.$.click();
                                }
                            });
                        }, 0);
                    }
                    if (dialogName === "paste") {
                        // Save original handler before overriding
                        var originalHandler_1 = dialogDefinition.onShow;
                        // Use function and .call to execute original handler with correct context
                        dialogDefinition.onShow = function () {
                            originalHandler_1.call(this);
                            var focusableElement = $(dialog.parts.contents.$).find(Editor.CkEditorConstants.ckEditorDialogTextAreaSelector);
                            var edatableArea = focusableElement.find(Editor.CkEditorConstants.ckEditorDialogPasteFrameSelector);
                            edatableArea.one("load", function () {
                                edatableArea
                                    .contents()
                                    .find("body")
                                    .off("keydown");
                                // Register custom listener for shift+tab shortcut
                                edatableArea
                                    .contents()
                                    .find("body")
                                    .on("keydown", function (event) {
                                    if (event.keyCode === KeyCodes.Tab && event.shiftKey) {
                                        event.preventDefault();
                                        event.stopPropagation();
                                        var focusList = dialog._.focusList;
                                        // Retrieve index of currently focused element from CKEditor focusList
                                        var currentIndex = focusList
                                            .map(function (element) { return element.domId; })
                                            .indexOf(Editor.CommonUtils.getId(focusableElement));
                                        // Calculate index of previous focusable element and set focus manually
                                        var nextIndex = currentIndex <= 0 ? focusList.length - 1 : currentIndex - 1;
                                        focusList[nextIndex].focus();
                                    }
                                });
                            });
                        };
                    }
                }, "Apply accessibility fixes to ckeditor dialog");
            });
            // Register accessibility fixes for ckeditor buttons
            this.getCkEditor().on(Editor.CkEditorConstants.ckEditorInstanceReadyInternalEventName, function (args) {
                if (args.editor && args.editor.name) {
                    var toolbarContainer = parentIframe.contents().find("#cke_" + args.editor.name);
                    var ckeditorButtons = toolbarContainer.find(Editor.CkEditorConstants.ckEditorButtonSelector);
                    var ckeditorComboButtons = toolbarContainer.find(Editor.CkEditorConstants.ckEditorComboButtonSelector);
                    ckeditorButtons.each(function (index, button) {
                        if (String.isNullUndefinedOrWhitespace($(button).attr("name"))) {
                            var buttonName = $(button)
                                .find(Editor.CkEditorConstants.ckEditorButtonLabelSelector)
                                .text();
                            $(button).attr("name", buttonName);
                        }
                        var attrOnFocus = $(button).attr("onfocus");
                        if (attrOnFocus && Editor.CommonUtils.isIOS()) {
                            $(button).removeAttr("onfocus");
                            $(button).attr("onfocus", "keepFocus($(button));" + attrOnFocus);
                        }
                    });
                    ckeditorComboButtons.each(function (index, comboButton) {
                        if (String.isNullUndefinedOrWhitespace($(comboButton).attr("name"))) {
                            var comboButtonName = $(comboButton).attr("title");
                            $(comboButton).attr("name", comboButtonName);
                        }
                    });
                }
            });
        };
        /**
         * Update plugin specific accessibility instructions
         */
        CkEditorProxy.prototype.updateAccessibilityInstructions = function () {
            var collapserCaption = "[Expand or collapse toolbar]";
            if (CKEDITOR.config.extraPlugins.indexOf("collapser") > -1) {
                if (Editor.AccessibilityInstructionsPopup.accessibilityInstructions["Base Commands"].findIndex(function (item) { return item.caption === collapserCaption; }) < 0) {
                    var collapserAccessibilityShortCut = {
                        caption: collapserCaption,
                        keyboardShortcut: "Alt+ -"
                    };
                    Editor.AccessibilityInstructionsPopup.accessibilityInstructions["Base Commands"].push(collapserAccessibilityShortCut);
                }
            }
        };
        /**
         * Keep focus on ipad with voiceover on
         */
        CkEditorProxy.prototype.keepFocus = function (elem) {
            setTimeout(function () {
                if (!elem.is(":focus")) {
                    elem.focus();
                }
            }, 0);
        };
        /**
         * Upserts an image in the specific editor
         * @param editorId - The editor id
         * @param selectedHtml - The selected html - either empty or the image to update
         * @param imageData - The image data that should be upserted
         */
        CkEditorProxy.prototype.upsertImage = function (editor, selectedHtml, imageData, callback, hasAdditionalProperties) {
            var _this = this;
            if (hasAdditionalProperties === void 0) { hasAdditionalProperties = false; }
            var img = selectedHtml.is("img") ? selectedHtml : selectedHtml.find("img");
            this.executionContext.tryExecute(function () {
                var imageElement;
                if (img.length === 0) {
                    imageElement = editor.document.createElement("img");
                }
                else {
                    imageElement = new CKEDITOR.dom.element(img.get(0));
                }
                Editor.CkEditorUtils.setCkEditorElementAttribute(imageElement, "src", imageData.src);
                Editor.CkEditorUtils.setCkEditorElementAttribute(imageElement, "alt", imageData.alt);
                if (hasAdditionalProperties) {
                    if (imageData.width) {
                        Editor.CkEditorUtils.setCkEditorElementStyle(imageElement, "width", imageData.width);
                        Editor.CkEditorUtils.setCkEditorElementAttribute(imageElement, "width", imageData.width.replace("px", ""));
                    }
                    if (imageData.height) {
                        Editor.CkEditorUtils.setCkEditorElementStyle(imageElement, "height", imageData.height);
                        Editor.CkEditorUtils.setCkEditorElementAttribute(imageElement, "height", imageData.height.replace("px", ""));
                    }
                    Editor.CkEditorUtils.setCkEditorElementAttribute(imageElement, "vSpace", imageData.vSpace);
                    Editor.CkEditorUtils.setCkEditorElementAttribute(imageElement, "hSpace", imageData.hSpace);
                    _this.setCkEditorElementAlignment(imageElement, imageData.alignment.toLowerCase());
                }
                editor.insertElement(imageElement);
                // Add clear div to mitigate floats of the image positioning.
                var textBlock = $(imageElement.$).parents("div[" + Editor.Contract.blockTypeAttrName + "=\"" + Editor.CommonConstants.textToolType + "\"]");
                if (textBlock.find(".clear").length === 0) {
                    textBlock.append(Editor.CommonUtils.getClearDiv());
                }
                _this.setEditorFocus(editor);
                editor.getSelection().selectElement(imageElement);
                callback($(imageElement.$));
            }, "Upsert the image", false, function () {
                _this.setEditorFocus(editor);
                callback(img);
            });
        };
        CkEditorProxy.prototype.setCkEditorElementAlignment = function (element, alignment) {
            if (!String.isNullUndefinedOrWhitespace(alignment)) {
                Editor.CommonUtils.setImageAlignment(element, element, alignment, Editor.CkEditorUtils.setCkEditorElementAttribute, Editor.CkEditorUtils.setCkEditorElementStyle);
            }
        };
        /**
         * Gets a link from the selected text in the specific editor
         * @param editor - The ck editor
         */
        CkEditorProxy.prototype.getSelectedLink = function (editor) {
            var _this = this;
            var link = $();
            this.executionContext.tryExecute(function () {
                var selectedLink = _this.getCkEditor().plugins.link.getSelectedLink(editor);
                if (selectedLink != null && selectedLink.hasAttribute("href")) {
                    editor.getSelection().selectElement(selectedLink);
                    link = $(selectedLink.$);
                }
            }, "Get selected link");
            return link;
        };
        /**
         * Upserts a code in the specific editor
         * @param editorId - The editor id
         * @param codeData - The code data that should be upserted
         */
        CkEditorProxy.prototype.upsertCode = function (editor, codeData, elementId, eventBroker) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                var encodedCode = "";
                try {
                    encodedCode = encodeURIComponent(codeData);
                }
                catch (e) {
                    _this.executionContext.getLogger().log(TraceLevel.Error, "Editor.DesignerEditor.upsertCode", new Dictionary({
                        Message: "Fail on upsertCode",
                        Source: codeData
                    }));
                }
                if (elementId == null) {
                    // Creating new element
                    var classUniqueId = UniqueId.generate();
                    var codeElementWrapper = editor.document.createElement("div");
                    var block = Editor.CommonUtils.getCodeBlockHtmltemplate(classUniqueId, encodedCode);
                    codeElementWrapper.appendHtml(block);
                    editor.insertElement(codeElementWrapper);
                }
                else {
                    // Updating existing element
                    eventBroker.notify(Editor.EventConstants.codeBlockUpdated, new Editor.CodeBlockUpdatedEventArgs(elementId, encodedCode));
                }
                _this.setEditorFocus(editor);
            }, "Upserting the code", false, function () {
                _this.setEditorFocus(editor);
            });
        };
        /**
         * Registers the new code command
         * @param codeCommandName - The name of the new command
         */
        CkEditorProxy.prototype.registerCodeCommand = function (codeCommandName) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                if (Utility.isNullOrUndefined(_this.getCkEditor().plugins.get(codeCommandName))) {
                    _this.getCkEditor().config.extraPlugins = CKEDITOR.config.extraPlugins + "," + codeCommandName;
                    _this.getCkEditor().plugins.add(codeCommandName, {
                        init: function (editor) {
                            var keystroke = 76;
                            editor.setKeystroke(CKEDITOR.CTRL + keystroke, codeCommandName);
                            editor.on("doubleclick", function (eventInfo) {
                                _this.executionContext.tryExecute(function () {
                                    var ckEditorElement = eventInfo.data.element;
                                    if (!Utility.isNullOrUndefined(ckEditorElement.find("div")) &&
                                        ckEditorElement.hasClass("codeBlockParent")) {
                                        _this.preventCkEditorDefaultDialogToShow(eventInfo);
                                        // Opens the link popup for a button, instead of opening the CkEditor standard popup
                                        if (ckEditorElement.is("div")) {
                                            eventInfo.editor.execCommand(codeCommandName);
                                        }
                                    }
                                }, "Execute code command on doubleclick");
                            });
                        }
                    });
                }
            }, "Register code command");
        };
        /**
         * Upserts a link in the specific editor
         * @param editorId - The editor id
         * @param linkData - The link data that should be upserted
         */
        CkEditorProxy.prototype.upsertLink = function (editor, linkData) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                var selectedLink = _this.getCkEditor().plugins.link.getSelectedLink(editor);
                var selectedRange = editor.getSelection().getRanges()[0];
                if (selectedLink == null) {
                    // If there is nothing selected we will insert the text node to the document (the text is the same as the url) and select it.
                    if (selectedRange.collapsed) {
                        var text = new CKEDITOR.dom.text(linkData.href, editor.document);
                        selectedRange.insertNode(text);
                        selectedRange.selectNodeContents(text);
                    }
                    // We will upgrade the selected text to be a link
                    var linkStyle = new CKEDITOR.style({
                        element: "a",
                        attributes: linkData.getAttributes(),
                        type: CKEDITOR.STYLE_INLINE
                    }, null);
                    linkStyle.applyToRange(selectedRange, editor);
                    selectedRange.select();
                }
                else {
                    selectedLink.setAttribute("href", linkData.href);
                    selectedLink.setAttribute(Editor.CkEditorConstants.ckEditorHrefAttribute, linkData.href);
                    if (!!linkData.target) {
                        selectedLink.setAttribute("target", linkData.target);
                    }
                }
                _this.setEditorFocus(editor);
                editor.fire(Editor.CkEditorConstants.ckEditorChangeInternalEventName);
            }, "Upsert the link", false, function () {
                _this.setEditorFocus(editor);
            });
        };
        /**
         * Registers the new image command
         * @param imageCommandName - The name of the new command
         */
        CkEditorProxy.prototype.registerImageCommand = function (imageCommandName) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                if (Utility.isNullOrUndefined(_this.getCkEditor().plugins.get(imageCommandName))) {
                    _this.getCkEditor().config.extraPlugins = CKEDITOR.config.extraPlugins + "," + imageCommandName;
                    _this.getCkEditor().plugins.add(imageCommandName, {
                        init: function (editor) {
                            editor.on("doubleclick", function (eventInfo) {
                                _this.executionContext.tryExecute(function () {
                                    var ckEditorElement = eventInfo.data.element;
                                    if (!Utility.isNullOrUndefined(ckEditorElement.find("img")) &&
                                        !ckEditorElement.data("cke-realelement") &&
                                        !ckEditorElement.isReadOnly()) {
                                        _this.preventCkEditorDefaultDialogToShow(eventInfo);
                                        // Opens the image popup for an image block, instead of opening the CkEditor standard popup
                                        if (ckEditorElement.is("img")) {
                                            eventInfo.editor.execCommand(imageCommandName);
                                        }
                                    }
                                }, "Execute image command on doubleclick");
                            });
                        }
                    });
                }
            }, "Register image command");
        };
        /**
         * Registers the new link command
         * @param linkCommandName - The name of the new command
         */
        CkEditorProxy.prototype.registerLinkCommand = function (linkCommandName) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                if (Utility.isNullOrUndefined(_this.getCkEditor().plugins.get(linkCommandName))) {
                    _this.getCkEditor().config.extraPlugins = CKEDITOR.config.extraPlugins + "," + linkCommandName;
                    _this.getCkEditor().plugins.add(linkCommandName, {
                        init: function (editor) {
                            var keystroke = 76;
                            editor.setKeystroke(CKEDITOR.CTRL + keystroke, linkCommandName);
                            editor.on("doubleclick", function (eventInfo) {
                                _this.executionContext.tryExecute(function () {
                                    var ckEditorElement = eventInfo.data.element;
                                    if (!Utility.isNullOrUndefined(ckEditorElement.find("a")) &&
                                        !ckEditorElement.data("cke-realelement") &&
                                        !ckEditorElement.isReadOnly()) {
                                        _this.preventCkEditorDefaultDialogToShow(eventInfo);
                                        // Opens the link popup for a button, instead of opening the CkEditor standard popup
                                        if (ckEditorElement.is("a")) {
                                            eventInfo.editor.execCommand(linkCommandName);
                                        }
                                    }
                                }, "Execute link command on doubleclick");
                            });
                        }
                    });
                }
            }, "Register link command");
        };
        CkEditorProxy.prototype.preventCkEditorDefaultDialogToShow = function (eventInfo) {
            eventInfo.data.dialog = null;
        };
        /**
         * Set the focus on the block
         * @param editorId - The editor id
         * @param callback - The callback
         */
        CkEditorProxy.prototype.setEditorFocus = function (editor, callback) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                if (Utility.isNullOrUndefined(editor)) {
                    return;
                }
                if (editor && editor.focusManager && !editor.focusManager.hasFocus) {
                    if (editor.status !== Editor.CkEditorConstants.ckEditorLoadedStatus &&
                        editor.status !== Editor.CkEditorConstants.ckEditorReadyStatus) {
                        // Wait while ckeditor loaded
                        editor.on(Editor.CkEditorConstants.ckEditorInstanceReadyInternalEventName, function () {
                            // Add zero delay, because toolbar may be not load completely
                            setTimeout(function () {
                                _this.executionContext.tryExecute(function () {
                                    if (editor.editable()) {
                                        _this.getCkEditor().currentInstance = editor;
                                        editor.focus();
                                    }
                                    if (Editor.CommonUtils.isFunction(callback)) {
                                        callback();
                                    }
                                }, "Set editor focus on instance ready", false, function () {
                                    if (Editor.CommonUtils.isFunction(callback)) {
                                        callback();
                                    }
                                });
                            }, 0);
                        });
                    }
                    else {
                        if (editor.editable()) {
                            _this.getCkEditor().currentInstance = editor;
                            editor.focusManager.focus();
                            editor.focus();
                        }
                        if (Editor.CommonUtils.isFunction(callback)) {
                            callback();
                        }
                    }
                }
                else {
                    if (Editor.CommonUtils.isFunction(callback)) {
                        callback();
                    }
                }
            }, "Set editor focus", false, function () {
                if (Editor.CommonUtils.isFunction(callback)) {
                    callback();
                }
            });
        };
        CkEditorProxy.prototype.setEditorBlur = function (_) { };
        /**
         * Get the JQuery CK Editor Element
         * @param editorId - The editor id
         */
        CkEditorProxy.prototype.getCkEditorElement = function (editor) {
            var ckEditorElement = null;
            this.executionContext.tryExecute(function () {
                ckEditorElement = editor.element.$;
            }, "Get ckeditor html element", true);
            return ckEditorElement;
        };
        /**
         * Get the CKEditor instance by editorId.
         * @param editorId id of the editor element.
         */
        CkEditorProxy.prototype.getCkEditorInstance = function (editorId) {
            var _this = this;
            var ckeditorInstance = null;
            this.executionContext.tryExecute(function () {
                ckeditorInstance = (_this.getCkEditor() || CKEDITOR).instances[editorId];
            }, "Get ckeditor instance", true);
            return ckeditorInstance;
        };
        /**
         * Get the CKEditor id from container.
         * @param container The container with an editor.
         */
        CkEditorProxy.prototype.getCkEditorId = function (container) {
            return Editor.CommonUtils.getId(container.find(Editor.CommonUtils.getAttrSelector(Editor.CommonConstants.ckEditorAttrName)));
        };
        /**
         * Register custom plugins with ckeditor.
         * @param plugins array of custom plugins to register.
         */
        CkEditorProxy.prototype.registerPlugin = function (plugin, eventBroker, getSelectedElement) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                var name = UniqueId.generate();
                _this.pluginAdapter = new Editor.CKEditorPluginAdapter(CKEDITOR, plugin, eventBroker, getSelectedElement, Editor.BlockProvider.getLastElementBeforeContainer, _this.executionContext);
                _this.getCkEditor().plugins.add(name, _this.pluginAdapter);
                _this.getCkEditor().config.extraPlugins += name + ",";
                var buttons = plugin.getToolbarButtons();
                $.each(buttons, function (index, value) {
                    _this.registerToolbarStyles(value);
                });
            }, "Register custom plugins", true);
        };
        CkEditorProxy.prototype.setImageAttribute = function (imageElement, attributeValue) {
            imageElement.attr(Editor.CkEditorConstants.ckEditorImageSrcAttribute, attributeValue);
        };
        CkEditorProxy.prototype.setHrefAttribute = function (element, href) {
            if (!Utility.isNullOrUndefined(element)) {
                element.attr(Editor.CkEditorConstants.ckEditorHrefAttribute, href);
            }
        };
        /**
         * Set CkEditor toolbar to blur
         * @param eventArgs DesignerDragStartEventArgs object that refers a block
         */
        CkEditorProxy.prototype.setToolbarBlur = function (eventArgs) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                if (!Utility.isNullOrUndefined(eventArgs.block)) {
                    var ckeditorElement = Editor.BlockProvider.getEditableElement(eventArgs.block);
                    if (ckeditorElement.length) {
                        var ckEditor = _this.getCkEditorInstance(Editor.CommonUtils.getId(ckeditorElement));
                        if (!Utility.isNullOrUndefined(ckEditor) && !Utility.isNullOrUndefined(ckEditor.focusManager)) {
                            ckEditor.focusManager.blur(true);
                        }
                    }
                }
            }, "Set ckeditor toolbar to blur");
        };
        /**
         * Create style for button icon and inject it into the body of the document.
         * Added to body to ensure it gets priority over ckeditor clear styles.
         * @param button the button to register.
         */
        CkEditorProxy.prototype.registerToolbarStyles = function (button) {
            var id = "btnStyle_" + button.getName();
            var styleTag = Editor.CommonUtils.getById(id, $(this.contentWindow.document.body));
            if (styleTag.length > 0) {
                return;
            }
            var ruleid = ".cke_button__" + button.getName().toLowerCase() + "_icon";
            var css = '{ background-image: url("' + button.getIconSrc() + '"); }';
            // Changing to head will not override some of the default CKEditor styles
            var body = $(this.contentWindow.document.body);
            $("<style>")
                .prop("type", "text/css")
                .attr("id", id)
                .attr(Editor.CkEditorConstants.ckEditorSharedResourceAttribute, "yes")
                .html(ruleid + " " + css)
                .appendTo(body);
        };
        CkEditorProxy.prototype.getCustomCkEditorSkinStylesElement = function () {
            var editorSkin = this.getCkEditor().config.skin;
            if (!editorSkin) {
                editorSkin = "moono-lisa";
            }
            var baseSkinUrl = this.cdnBasePath + "/" + this.ckEditorBasePath + "/skins/" + editorSkin;
            return $("<style>")
                .attr("id", Editor.DesignerContentEditorStyles.ckEditorSkinStylesId)
                .text(String.Format(Editor.DesignerContentEditorStyles.ckEditorSkinStyles, baseSkinUrl));
        };
        /**
         * The CKEDITOR initialized dynamically after the screen is loaded.
         */
        CkEditorProxy.prototype.getCkEditor = function () {
            return this.contentWindow ? this.contentWindow.CKEDITOR : null;
        };
        CkEditorProxy.prototype.getWindow = function () {
            return this.contentWindow;
        };
        /**
         * Gets the child editable element which has the cursor
         * @param editorId - The editor id
         */
        CkEditorProxy.prototype.getChildEditableElementId = function (editorId) {
            var _this = this;
            var modifiedElementId = null;
            this.executionContext.tryExecute(function () {
                var ckEditorInstance = _this.getCkEditorInstance(editorId);
                if (!Utility.isNullOrUndefined(ckEditorInstance) &&
                    !Utility.isNullOrUndefined(ckEditorInstance.elementPath())) {
                    modifiedElementId = _this.getCkEditorInstance(editorId).elementPath().elements[0].$.id;
                }
            }, "Get the child editable element", true);
            return modifiedElementId;
        };
        CkEditorProxy.prototype.onCkEditorInitialized = function (id, callback) {
            var _this = this;
            var ckeditor = this.getCkEditor() || CKEDITOR;
            ckeditor.on(Editor.CkEditorConstants.ckEditorInstanceReadyInternalEventName, function (args) {
                var eventArgs = new Editor.CkEditorInstanceReadyEventArgs();
                eventArgs.sourceId = id;
                var editor = args.editor;
                editor.on("change", function () {
                    _this.onChange(editor);
                });
                if (!(editor && editor.name)) {
                    return;
                }
                // Enable fix for scrolling if current environment is IOS
                if (Editor.CommonUtils.isIOS() && editor.editable()) {
                    if (editor.editable().isInline()) {
                        // Apply fixes after initialization for inline editors
                        _this.registerIOSScrollFixes(editor);
                    }
                    else {
                        // Apply fixes on contentDom event for standard editor
                        args.editor.on(Editor.CkEditorConstants.ckEditorContentDomInternalEventName, function () {
                            _this.registerIOSScrollFixes(editor);
                        });
                    }
                }
                eventArgs.ckEditorInstanceName = editor.name;
                callback(editor, eventArgs);
            });
        };
        CkEditorProxy.prototype.registerIOSScrollFixes = function (editor) {
            var _this = this;
            var editable = editor.editable();
            editable.on(Editor.CkEditorConstants.ckEditorInputInternalEventName, function () {
                _this.fixIOSScroll(editor);
            });
        };
        CkEditorProxy.prototype.onChange = function (editor) {
            if (!Utility.isNullOrUndefined(this.currentlyEditingEditorInstance) &&
                this.currentlyEditingEditorInstance.id !== editor.id) {
                if (this.pendingNotifyChanges) {
                    // this will trigger bound action with the data we stored from previous editor
                    this.changeTimer.stop();
                    this.commitedData = null;
                }
            }
            this.currentlyEditingEditorInstance = editor;
            this.getPreviousData = function () { return editor.document.getBody().getHtml(); };
            this.pendingNotifyChanges = true;
            this.changeTimer.schedule();
        };
        CkEditorProxy.prototype.fixIOSScroll = function (editor) {
            this.executionContext.tryExecute(function () {
                var ckEditorSelection = editor.getSelection();
                if (ckEditorSelection) {
                    var ckEditorRange = ckEditorSelection.getRanges()[0];
                    var selection_1 = ckEditorSelection.getNative();
                    if (!(ckEditorRange &&
                        ckEditorRange.startContainer &&
                        ckEditorRange.startContainer.$ &&
                        ckEditorRange.endContainer &&
                        ckEditorRange.endContainer.$)) {
                        return;
                    }
                    // Create new range with same parameters as initial
                    var range_1 = document.createRange();
                    range_1.setStart(ckEditorRange.startContainer.$, ckEditorRange.startOffset);
                    range_1.setEnd(ckEditorRange.endContainer.$, ckEditorRange.endOffset);
                    // Remove old range to prevent scrolling issue
                    selection_1.removeAllRanges();
                    setTimeout(function () {
                        // Add range to restore caret position
                        selection_1.addRange(range_1);
                        if (!editor.editable().isInline()) {
                            // Trigger change event manually to save changes on input
                            editor.fire(Editor.CkEditorConstants.ckEditorChangeInternalEventName);
                        }
                    }, 0);
                }
            }, "Fix IOS scrolling issue when typing");
        };
        CkEditorProxy.prototype.notifyBlockChanged = function () {
            var previousData = this.getPreviousData();
            if (this.pendingNotifyChanges && this.commitedData !== previousData) {
                this.pendingNotifyChanges = false;
                this.commitedData = previousData;
                if (this.currentlyEditingEditorInstance && this.currentlyEditingEditorInstance.element) {
                    var contentBlock = this.currentlyEditingEditorInstance.element.getParent().getOuterHtml();
                    this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs("ckEditorProxy", $(contentBlock), this.currentlyEditingEditorInstance.config.toolbar));
                }
            }
        };
        /**
         * Sets the enter mode of the CkEditor according to the element type
         * @param element - The element
         */
        CkEditorProxy.prototype.setEnterMode = function (element) {
            var enterMode = CKEDITOR.ENTER_P;
            Editor.CkEditorEnterModeExceptions.enterBrTagList.forEach(function (tag) {
                if (element.children().is(tag)) {
                    enterMode = CKEDITOR.ENTER_BR;
                }
            });
            CKEDITOR.config.enterMode = enterMode;
            CKEDITOR.config.title = element.attr("aria-label");
        };
        CkEditorProxy.removePlugins = "showborders,codemirror,magicline,liststyle,scayt,a11yhelp,tableselection";
        CkEditorProxy.extraPlugins = "dialog,button,floatpanel,panel,panelbutton,justify,font,colorbutton,basicstyles,selectall,find,bidi,pastefromword,indentblock,colordialog,tabletools,contextmenu,";
        // This array expects entries in the format specified by CKEditor:
        // https://ckeditor.com/docs/ckeditor4/latest/api/CKEDITOR_config.html#cfg-font_names
        CkEditorProxy.extraFonts = ["Segoe UI/Segoe UI,Frutiger,Helvetica Neue,Arial,sans-serif"];
        CkEditorProxy.changeDelayInMs = 500;
        CkEditorProxy.styleSetName = "editorStyleSet";
        return CkEditorProxy;
    }());
    Editor.CkEditorProxy = CkEditorProxy;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * A wrapper class for the ckeditor api. The CKEDITOR can only be used inside this class.
     */
    var InlineCkEditorProxy = /** @class */ (function () {
        function InlineCkEditorProxy(eventBroker, ckEditorHelper, plugin, executionContext, customCkEditorConfiguration) {
            var _this = this;
            this.ckeditorSharedResourceAttribute = "ckEditorSharedResource";
            this.ckeditorFocusInternalEventName = "focus";
            this.ckeditorDropEventName = "drop";
            this.id = UniqueId.generate("inlineCkEditorProxy");
            /**
             * Handler of the 'Image Attribute Changed' event
             */
            this.onImageAttributeChanged = function (eventArgs) {
                if (eventArgs.attributeName === Editor.CommonConstants.designerImageSourceAttributeName &&
                    eventArgs.imageElement) {
                    _this.ckEditorHelper.setImageAttribute(eventArgs.imageElement, eventArgs.attributeValue);
                }
            };
            /**
             * Handler of the 'HREF Attribute Changed' event
             */
            this.onHrefAttributeChanged = function (eventArgs) {
                _this.ckEditorHelper.setHrefAttribute(eventArgs.element, eventArgs.href);
            };
            /**
             * Handler of the 'Designer Drag Start' event
             */
            this.onDesignerDragStart = function (eventArgs) {
                if (!Utility.isNullOrUndefined(eventArgs)) {
                    _this.ckEditorHelper.setToolbarBlur(eventArgs);
                }
            };
            this.onContentModelInitialized = function (eventArgs) {
                _this.documentContentModel = eventArgs.documentContentModel;
            };
            this.resizeEditor = function (height) { };
            this.plugin = plugin;
            this.eventBroker = eventBroker;
            this.ckEditorHelper = ckEditorHelper;
            this.executionContext = executionContext;
            this.customCkEditorConfiguration = customCkEditorConfiguration;
            this.eventBroker.subscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
        }
        /**
         * Returns the instance id.
         */
        InlineCkEditorProxy.prototype.instanceId = function () {
            return this.id;
        };
        /**
         * Initlializes the static ckeditor configuration.
         */
        InlineCkEditorProxy.prototype.init = function (designerFrame, callback) {
            var _this = this;
            this.ckEditorHelper.init(designerFrame, function () {
                _this.executionContext.tryExecute(function () {
                    _this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.selectionChanged, function (args) {
                        _this.onSelectionChanged(args);
                    });
                    _this.eventBroker.subscribe(Editor.EventConstants.imageAttributeChanged, _this.onImageAttributeChanged);
                    _this.eventBroker.subscribe(Editor.EventConstants.hrefAttributeChanged, _this.onHrefAttributeChanged);
                    _this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerDragStart, _this.onDesignerDragStart);
                    _this.registerPlugins();
                    _this.notifyOnCkEditorInstanceInitialized();
                    callback();
                }, "Initialize the inline ckeditor proxy", true);
            }, this.documentContentModel);
        };
        /**
         * Returns promise which identify that ckeditor was initialized
         */
        InlineCkEditorProxy.prototype.getCkEditorInitializedPromise = function () {
            return this.ckEditorHelper.getCkEditorInitializedPromise();
        };
        /**
         * Registers the custom plugins.
         */
        InlineCkEditorProxy.prototype.registerPlugins = function () {
            var _this = this;
            this.ckEditorHelper.registerPlugin(this.plugin, this.eventBroker, function () { return _this.selectedBlockElement; });
        };
        /**
         * Cleans up the specified element from ckeditor dependencies.
         */
        InlineCkEditorProxy.prototype.cleanup = function (content) {
            this.ckEditorHelper.cleanup(content);
        };
        /**
         * Creates the ckeditor inside the html element with the specific editor id.
         * The editor will have inline toolbar.
         * @param editor - The container in which the ckeditor will be created - this id will be also used as the ckeditor editor id.
         */
        InlineCkEditorProxy.prototype.createEditor = function (editor, toolbarConfig) {
            var _this = this;
            var editorInstance = null;
            this.executionContext.tryExecute(function () {
                _this.ckEditorHelper.setEnterMode(editor);
                if (_this.ckEditorHelper.getCkEditor()) {
                    var basicConfig = _this.ckEditorHelper.setupToolbarConfiguration(toolbarConfig);
                    if (_this.customCkEditorConfiguration) {
                        var instanceConfiguration = _this.customCkEditorConfiguration.instanceConfiguration;
                        if (instanceConfiguration) {
                            for (var property in instanceConfiguration) {
                                if (instanceConfiguration.hasOwnProperty(property)) {
                                    basicConfig[property] = instanceConfiguration[property];
                                }
                            }
                        }
                    }
                    var toolbarFloat = 33;
                    basicConfig["floatSpaceDockedOffsetY"] = toolbarFloat;
                    editorInstance = _this.ckEditorHelper.getCkEditor().inline(editor.get(0), basicConfig);
                }
            }, "Create inline editor");
            return editorInstance;
        };
        /**
         * Notify when ckeditor instance is initialized.
         */
        InlineCkEditorProxy.prototype.notifyOnCkEditorInstanceInitialized = function () {
            var _this = this;
            var callback = function (editor, eventArgs) {
                editor.on(_this.ckeditorFocusInternalEventName, function (args) {
                    var eventArgs = new Editor.CkEditorFocusEventArgs(); // tslint:disable-line
                    if (args.editor && args.editor.name) {
                        eventArgs.ckEditorInstanceName = args.editor.name;
                        eventArgs.sourceId = _this.instanceId();
                        _this.eventBroker.notify(Editor.DesignerInternalEventConstants.ckEditorFocus, eventArgs);
                    }
                });
                // Disable drop event between different inline editors to prevent ckeditor errors
                editor.on(_this.ckeditorDropEventName, function (evt) {
                    if (evt.data.dataTransfer.sourceEditor &&
                        evt.data.dataTransfer.sourceEditor.name !== evt.editor.name) {
                        evt.cancel();
                    }
                });
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.ckEditorInstanceReadyEvent, eventArgs);
            };
            this.ckEditorHelper.onCkEditorInitialized(this.instanceId(), callback);
        };
        /**
         * Removed the ckeditor from the page.
         * @param editorId - The editor id that should be removed.
         */
        InlineCkEditorProxy.prototype.destroyEditor = function (editorId) {
            this.ckEditorHelper.destroyEditor(editorId);
        };
        /**
         * Removed all ckeditor instances from the page.
         */
        InlineCkEditorProxy.prototype.destroyAllEditors = function () {
            this.ckEditorHelper.destroyAllEditors();
        };
        /**
         * @see ICKEditorProxy.dispose
         */
        InlineCkEditorProxy.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.selectionChanged, this.onSelectionChanged);
            this.eventBroker.unsubscribe(Editor.EventConstants.imageAttributeChanged, this.onImageAttributeChanged);
            this.eventBroker.unsubscribe(Editor.EventConstants.hrefAttributeChanged, this.onHrefAttributeChanged);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerDragStart, this.onDesignerDragStart);
            this.ckEditorHelper.dispose();
        };
        /**
         * Get the content of the editor by its id. The content is cleaned up - does not contain any ckeditor attributes
         * @param editorId - The editor id
         */
        InlineCkEditorProxy.prototype.getContent = function (editorId) {
            return this.ckEditorHelper.getContent(this.ckEditorHelper.getCkEditorInstance(editorId));
        };
        /**
         * Set the content of the editor by its id. The content is cleaned up - does not contain any ckeditor attributes
         * @param content - The data, that will setted in the editor
         * @param editorId - The editor id
         * @param callback - The callback
         */
        InlineCkEditorProxy.prototype.setContent = function (content, editorId, callback) {
            return this.ckEditorHelper.setContent(content, this.ckEditorHelper.getCkEditorInstance(editorId), callback);
        };
        /**
         * Set attributes on the ckeditor element
         * @param editorId - The editor id
         */
        InlineCkEditorProxy.prototype.setRequiredAttributes = function (editorId) {
            this.ckEditorHelper.setRequiredAttributes(this.ckEditorHelper.getCkEditorInstance(editorId));
        };
        /**
         * Set the block to read only mode
         * @param editorId - The editor id
         */
        InlineCkEditorProxy.prototype.setReadOnly = function (editorId) {
            this.ckEditorHelper.getCkEditorInstance(editorId).setReadOnly();
        };
        /**
         * Upserts an image in the specific editor
         * @param editorId - The editor id
         * @param selectedHtml - The selected html - either empty or the image to update
         * @param imageData - The image data that should be upserted
         */
        InlineCkEditorProxy.prototype.upsertImage = function (editorId, selectedHtml, imageData, hasAdditionalProperties) {
            var _this = this;
            if (hasAdditionalProperties === void 0) { hasAdditionalProperties = false; }
            this.ckEditorHelper.upsertImage(this.ckEditorHelper.getCkEditorInstance(editorId), selectedHtml, imageData, function (image) {
                _this.eventBroker.notify(Editor.EventConstants.imageAttributeChanged, new Editor.ImageAttributeChangedEventArgs(image, "src", imageData.src, null));
                _this.eventBroker.notify(Editor.EventConstants.imageAttributeChanged, new Editor.ImageAttributeChangedEventArgs(image, "alt", imageData.alt, null));
                _this.ckEditorHelper.setImageAttribute(image, imageData.src);
                _this.notifyContentChanged();
            }, hasAdditionalProperties);
        };
        /**
         * Gets a link from the selected text in the specific editor
         * @param editorId - The editor id
         */
        InlineCkEditorProxy.prototype.getSelectedLink = function (editorId) {
            return this.ckEditorHelper.getSelectedLink(this.ckEditorHelper.getCkEditorInstance(editorId));
        };
        /**
         * Upserts a link in the specific editor
         * @param editorId - The editor id
         * @param linkData - The link data that should be upserted
         */
        InlineCkEditorProxy.prototype.upsertLink = function (editorId, linkData) {
            this.ckEditorHelper.upsertLink(this.ckEditorHelper.getCkEditorInstance(editorId), linkData);
        };
        /**
         * Upserts a code in the specific editor
         * @param editorId - The editor id
         * @param codeData - The code data that should be upserted
         */
        InlineCkEditorProxy.prototype.upsertCode = function (editorId, codeData, elementId, eventBroker) {
            this.ckEditorHelper.upsertCode(this.ckEditorHelper.getCkEditorInstance(editorId), codeData, elementId, eventBroker);
        };
        /**
         * Registers the new image command
         * @param imageCommandName - The name of the new command
         */
        InlineCkEditorProxy.prototype.registerImageCommand = function (imageCommandName) {
            this.ckEditorHelper.registerImageCommand(imageCommandName);
        };
        /**
         * Registers the new link command
         * @param linkCommandName - The name of the new command
         */
        InlineCkEditorProxy.prototype.registerLinkCommand = function (linkCommandName) {
            this.ckEditorHelper.registerLinkCommand(linkCommandName);
        };
        /**
         * Registers the new code command
         * @param codeCommandName - The name of the new command
         */
        InlineCkEditorProxy.prototype.registerCodeCommand = function (codeCommandName) {
            this.ckEditorHelper.registerCodeCommand(codeCommandName);
        };
        /**
         * Set the focus on the block
         * @param editorId - The editor id
         * @param callback - The callback
         */
        InlineCkEditorProxy.prototype.setEditorFocus = function (editorId, callback) {
            var _this = this;
            var editor = this.ckEditorHelper.getCkEditorInstance(editorId);
            var invokeCallback = function () {
                if (callback != null) {
                    callback();
                }
            };
            var focusEditor = function () {
                setTimeout(function () {
                    if (editor.editable()) {
                        _this.ckEditorHelper.getCkEditor().currentInstance = editor;
                        var focusManager = editor.focusManager;
                        _this.setFocus(focusManager, true, invokeCallback);
                    }
                    else {
                        invokeCallback();
                    }
                }, 0);
            };
            if (editor != null) {
                if (editor.status !== Editor.CkEditorConstants.ckEditorLoadedStatus &&
                    editor.status !== Editor.CkEditorConstants.ckEditorReadyStatus) {
                    editor.on(Editor.CkEditorConstants.ckEditorInstanceReadyInternalEventName, focusEditor);
                }
                else {
                    focusEditor();
                }
            }
        };
        InlineCkEditorProxy.prototype.setFocus = function (focusManager, blur, invokeCallback) {
            var _this = this;
            if (focusManager.hasFocus) {
                if (blur) {
                    focusManager.blur();
                }
                // CKEditor internally has a delay on the blur action
                // which is set to 200ms. We have to consequently
                // delay our focus action after requesting a blur
                // by the same amount
                var blurDelay = 205;
                setTimeout(function () {
                    if (!focusManager.hasFocus) {
                        focusManager.focus();
                        invokeCallback();
                    }
                    else {
                        // If in focus, try again, but without blur because that was already called
                        _this.setFocus(focusManager, false, invokeCallback);
                    }
                }, blurDelay);
            }
            else {
                focusManager.focus();
                invokeCallback();
            }
        };
        InlineCkEditorProxy.prototype.setEditorBlur = function (editorId) {
            var editor = this.ckEditorHelper.getCkEditorInstance(editorId);
            if (editor != null) {
                editor.focusManager.blur();
            }
        };
        /**
         * Get the JQuery ckeditor Element
         * @param editorId - The editor id
         */
        InlineCkEditorProxy.prototype.getCkEditorElement = function (editorId) {
            return this.ckEditorHelper.getCkEditorElement(this.ckEditorHelper.getCkEditorInstance(editorId));
        };
        /**
         * Get the CKEditor instance by editorId.
         * @param editorId id of the editor element.
         */
        InlineCkEditorProxy.prototype.getCkEditorInstance = function (editorId) {
            return this.ckEditorHelper.getCkEditorInstance(editorId);
        };
        /**
         * Get the CKEditor id from container.
         * @param container The container with an editor.
         */
        InlineCkEditorProxy.prototype.getCkEditorId = function (container) {
            return this.ckEditorHelper.getCkEditorId(container);
        };
        InlineCkEditorProxy.prototype.notifyContentChanged = function () {
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged);
        };
        /**
         * Gets the child editable element which has the cursor
         * @param editorId - The editor id
         */
        InlineCkEditorProxy.prototype.getChildEditableElementId = function (editorId) {
            return this.ckEditorHelper.getChildEditableElementId(editorId);
        };
        /**
         * Handler of the designer internal 'Selection Changed' event
         */
        InlineCkEditorProxy.prototype.onSelectionChanged = function (eventArgs) {
            this.selectedBlockElement = eventArgs.getOperableBlock();
        };
        return InlineCkEditorProxy;
    }());
    Editor.InlineCkEditorProxy = InlineCkEditorProxy;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * A wrapper class for the ckeditor api. The CKEDITOR can only be used inside this class.
     */
    var StandardCkEditorProxy = /** @class */ (function () {
        function StandardCkEditorProxy(eventBroker, ckEditorHelper, plugin, executionContext, customCkEditorConfiguration) {
            this.eventBroker = eventBroker;
            this.ckEditorHelper = ckEditorHelper;
            this.plugin = plugin;
            this.executionContext = executionContext;
            this.customCkEditorConfiguration = customCkEditorConfiguration;
            this.id = UniqueId.generate("standardCkEditorProxy");
            this.editor = null;
            this.ckEditorTopToolbarClassName = "cke_top";
            this.ckEditorBottomToolbarClassName = "cke_bottom";
            this.ckEditorContentsPartClassName = "cke_contents";
            this.eventBroker = eventBroker;
            this.ckEditorHelper = ckEditorHelper;
            this.plugin = plugin;
            this.executionContext = executionContext;
            this.customCkEditorConfiguration = customCkEditorConfiguration;
        }
        /**
         * Returns the instance id.
         */
        StandardCkEditorProxy.prototype.instanceId = function () {
            return this.id;
        };
        /**
         * Initlializes the static ckeditor configuration.
         */
        StandardCkEditorProxy.prototype.init = function (designerFrame, callback) {
            var _this = this;
            this.designerFrame = $(designerFrame);
            // Check the get selection part
            this.ckEditorHelper.init(designerFrame, function () {
                _this.executionContext.tryExecute(function () {
                    _this.registerPlugins();
                    _this.onCkEditorInitialized();
                    callback();
                }, "Initialize the standard ckeditor proxy", true);
            });
        };
        /**
         * Returns promise which identify that ckeditor was initialized
         */
        StandardCkEditorProxy.prototype.getCkEditorInitializedPromise = function () {
            return this.ckEditorHelper.getCkEditorInitializedPromise();
        };
        /**
         * Registers the custom plugins.
         */
        StandardCkEditorProxy.prototype.registerPlugins = function () {
            var _this = this;
            this.ckEditorHelper.registerPlugin(this.plugin, this.eventBroker, function () { return _this.getSelectedElement(); });
            this.plugin.getCommands().forEach(function (command) {
                command.setup(_this.eventBroker);
                if (command instanceof Editor.CkEditorCommand) {
                    var ckEditorCommand = command;
                    ckEditorCommand.setupCkEditor(_this);
                }
            });
        };
        /**
         * Notify when ckeditor instance is initialized.
         */
        StandardCkEditorProxy.prototype.onCkEditorInitialized = function () {
            var _this = this;
            var callback = function (initializedEditor, eventArgs) {
                _this.resizeEditor();
                // CKEditor 4 has a bug: https://github.com/ckeditor/ckeditor-dev/issues/676 in IE/Edge for Japanese/Chinese languages
                // thus, used next workaround
                // For unknown to us reason editable.on("compositionstart"... is not executed simply by binding to callback's editor parameter;
                // it works only after all editor rendering is done
                var IE11 = 11;
                if (Editor.CommonUtils.getInternetExplorerVersion() === IE11 || Editor.CommonUtils.isEdge()) {
                    _this.eventBroker.subscribe(Editor.EventConstants.fullPageEditorRendered, (_this.ie11EdgeTypingHandler = function () {
                        var editable = initializedEditor.editable();
                        var data = initializedEditor.getSnapshot();
                        function triggerChangeEvent() {
                            var newData = initializedEditor.getSnapshot();
                            // Checking if content changes can be skipped as change event does not guarantee this (see docs https://ckeditor.com/docs/ckeditor4/latest/api/CKEDITOR_editor.html#event-change).
                            if (newData !== data) {
                                data = newData;
                                initializedEditor.fire("change");
                            }
                        }
                        // The compositionstart event is fired upon starting composition.
                        editable.on("compositionstart", triggerChangeEvent);
                        // The compositionupdate event is fired upon every change during composition (also after starting and before ending composition).
                        editable.on("compositionupdate", triggerChangeEvent);
                        // The compositionend event is fired when ending composition (usually with Enter or Space key).
                        editable.on("compositionend", triggerChangeEvent);
                    }));
                }
                _this.eventBroker.notify(Editor.EventConstants.standardCkEditorInitialized, eventArgs);
            };
            this.ckEditorHelper.onCkEditorInitialized(this.instanceId(), callback);
        };
        /**
         * Cleans up the specified element from ckeditor dependencies.
         */
        StandardCkEditorProxy.prototype.cleanup = function (content) {
            this.ckEditorHelper.cleanup(content);
        };
        /**
         * Creates the ckeditor inside the html element with the specific editor id.
         * The editor will have inline toolbar.
         * @param editor - The container in which the ckeditor will be created - this id will be also used as the ckeditor editor id.
         */
        StandardCkEditorProxy.prototype.createEditor = function (editor, toolbarConfig) {
            var _this = this;
            var basicConfig = {};
            basicConfig["toolbar"] = toolbarConfig.getName();
            basicConfig["toolbar_" + toolbarConfig.getName()] = toolbarConfig
                .getConfig()
                .filter(function (value) { return value !== "/"; });
            basicConfig["allowedContent"] = true;
            basicConfig["fullPage"] = true;
            basicConfig["resize_enabled"] = false;
            basicConfig["title"] = false;
            CKEDITOR.config.basicEntities = true;
            if (this.customCkEditorConfiguration) {
                var instanceConfiguration = this.customCkEditorConfiguration.instanceConfiguration;
                if (instanceConfiguration) {
                    for (var property in instanceConfiguration) {
                        if (instanceConfiguration.hasOwnProperty(property)) {
                            basicConfig[property] = instanceConfiguration[property];
                        }
                    }
                }
            }
            this.editor = this.ckEditorHelper.getCkEditor().replace(Editor.CommonUtils.getId(editor), basicConfig);
            this.editor.on("change", function () {
                _this.notifyContentChanged();
            });
            return this.editor;
        };
        /**
         * Removes the ckeditor from the page.
         * @param editorId - The editor id that should be removed.
         */
        StandardCkEditorProxy.prototype.destroyEditor = function (editorId) {
            this.ckEditorHelper.destroyEditor(editorId);
        };
        /**
         * Removes all ckeditor instances from the page.
         */
        StandardCkEditorProxy.prototype.destroyAllEditors = function () {
            this.ckEditorHelper.destroyAllEditors();
        };
        /**
         * Dispose of all shared resources.
         */
        StandardCkEditorProxy.prototype.dispose = function () {
            var IE11 = 11;
            if (Editor.CommonUtils.getInternetExplorerVersion() === IE11 || Editor.CommonUtils.isEdge()) {
                this.eventBroker.unsubscribe(Editor.EventConstants.fullPageEditorRendered, this.ie11EdgeTypingHandler);
            }
            if (!Utility.isNullOrUndefined(this.editor)) {
                this.editor.destroy();
                this.editor = null;
            }
            this.ckEditorHelper.dispose();
            this.designerFrame = null;
        };
        /**
         * Get the content of the editor. The content is cleaned up - does not contain any ckeditor attributes
         */
        StandardCkEditorProxy.prototype.getContent = function () {
            return this.ckEditorHelper.getContent(this.editor);
        };
        /**
         * Set the content of the editor.
         */
        StandardCkEditorProxy.prototype.setContent = function (content, editorId, callback) {
            this.ckEditorHelper.setContent(content, this.editor, callback);
        };
        /**
         * Set attributes on the ckeditor element
         * @param editorId - The editor id
         */
        StandardCkEditorProxy.prototype.setRequiredAttributes = function (editorId) {
            this.ckEditorHelper.setRequiredAttributes(this.ckEditorHelper.getCkEditorInstance(editorId));
        };
        /**
         * Set the block to read only mode
         * @param editorId - The editor id
         */
        StandardCkEditorProxy.prototype.setReadOnly = function (editorId) {
            this.ckEditorHelper.getCkEditorInstance(editorId).setReadOnly();
        };
        /**
         * Upserts an image in the specific editor
         * @param editorId - The editor id
         * @param selectedHtml - The selected html - either empty or the image to update
         * @param imageData - The image data that should be upserted
         */
        StandardCkEditorProxy.prototype.upsertImage = function (editorId, selectedHtml, imageData, hasAdditionalProperties) {
            var _this = this;
            if (hasAdditionalProperties === void 0) { hasAdditionalProperties = false; }
            this.ckEditorHelper.upsertImage(this.editor, selectedHtml, imageData, function (image) {
                _this.eventBroker.notify(Editor.EventConstants.imageAttributeChanged, new Editor.ImageAttributeChangedEventArgs(image, "src", imageData.src, null));
                _this.ckEditorHelper.setImageAttribute(image, imageData.src);
                _this.notifyContentChanged();
            }, hasAdditionalProperties);
        };
        /**
         * Gets a link from the selected text in the specific editor
         * @param editorId - The editor id
         */
        StandardCkEditorProxy.prototype.getSelectedLink = function (editorId) {
            return this.ckEditorHelper.getSelectedLink(this.editor);
        };
        /**
         * Upserts a link in the specific editor
         * @param editorId - The editor id
         * @param linkData - The link data that should be upserted
         */
        StandardCkEditorProxy.prototype.upsertLink = function (editorId, linkData) {
            this.ckEditorHelper.upsertLink(this.editor, linkData);
        };
        /**
         * Upserts a code in the specific editor
         * @param editorId - The editor id
         * @param codeData - The code data that should be upserted
         */
        StandardCkEditorProxy.prototype.upsertCode = function (editorId, codeData, elementId, eventBroker) {
            this.ckEditorHelper.upsertCode(this.editor, codeData, elementId, eventBroker);
        };
        /**
         * Registers the new image command
         * @param imageCommandName - The name of the new command
         */
        StandardCkEditorProxy.prototype.registerImageCommand = function (imageCommandName) {
            this.ckEditorHelper.registerImageCommand(imageCommandName);
        };
        /**
         * Registers the new link command
         * @param linkCommandName - The name of the new command
         */
        StandardCkEditorProxy.prototype.registerLinkCommand = function (linkCommandName) {
            this.ckEditorHelper.registerLinkCommand(linkCommandName);
        };
        /**
         * Registers the new code command
         * @param codeCommandName - The name of the new command
         */
        StandardCkEditorProxy.prototype.registerCodeCommand = function (codeCommandName) {
            this.ckEditorHelper.registerCodeCommand(codeCommandName);
        };
        /**
         * Set the focus on the block
         * @param editorId - The editor id
         */
        StandardCkEditorProxy.prototype.setEditorFocus = function (editorId, callback) {
            this.ckEditorHelper.setEditorFocus(this.editor, callback);
        };
        StandardCkEditorProxy.prototype.setEditorBlur = function (_) { };
        StandardCkEditorProxy.prototype.notifyContentChanged = function () {
            this.eventBroker.notify(Editor.EventConstants.fullPageEditorContentChanged);
        };
        /**
         * Get the JQuery ckeditor Element
         * @param editorId - The editor id
         */
        StandardCkEditorProxy.prototype.getCkEditorElement = function (editorId) {
            return this.ckEditorHelper.getCkEditorElement(this.editor);
        };
        /**
         * Get the CKEditor id from container.
         * @param container The container with an editor.
         */
        StandardCkEditorProxy.prototype.getCkEditorId = function (container) {
            return this.ckEditorHelper.getCkEditorId(container);
        };
        /**
         * Get the CKEditor instance by editorId.
         * @param editorId id of the editor element.
         */
        StandardCkEditorProxy.prototype.getCkEditorInstance = function (editorId) {
            return this.ckEditorHelper.getCkEditorInstance(editorId);
        };
        /**
         * Gets the child editable element which has the cursor
         * @param editorId - The editor id
         * @param defaultIdPrefix - The default prefix for id
         */
        StandardCkEditorProxy.prototype.getChildEditableElementId = function (editorId, defaultIdPrefix) {
            var modifiedElementId = null;
            if (!Utility.isNullOrUndefined(this.editor.elementPath()) &&
                !Utility.isNullOrUndefined(this.editor.elementPath().elements) &&
                this.editor.elementPath().elements.length) {
                var modifiedElements = this.editor.elementPath().elements;
                var lastModifiedElement = $(modifiedElements[modifiedElements.length - 1].$);
                // Set id for the body element to prevent issues with saving changes if the id is empty
                if (lastModifiedElement.is("body") && Utility.isNullOrUndefined(lastModifiedElement.attr("id"))) {
                    modifiedElementId = UniqueId.generate(defaultIdPrefix ? defaultIdPrefix : String.Empty);
                    lastModifiedElement.attr("id", modifiedElementId);
                }
                modifiedElements.some(function (element) {
                    modifiedElementId = element.$.id;
                    return !String.isNullOrEmpty(modifiedElementId);
                });
            }
            return modifiedElementId;
        };
        StandardCkEditorProxy.prototype.getSelectedElement = function () {
            var _this = this;
            var selectedElement = $();
            this.executionContext.tryExecute(function () {
                var selection = _this.editor.document.$.getSelection();
                if (selection.rangeCount > 0) {
                    selectedElement = $(selection.getRangeAt(0).commonAncestorContainer);
                    // If the node type is Text node return the it's parent
                    if (selectedElement[0].nodeType === Node.TEXT_NODE) {
                        selectedElement = selectedElement.parent();
                    }
                }
            }, "Get selected element");
            return selectedElement;
        };
        /**
         * Changes editor height in accordance with toolbars height
         * @param - Positive height value, excluding toolbar height.
         */
        StandardCkEditorProxy.prototype.resizeEditor = function (height) {
            if ($(this.designerFrame).is(":visible")) {
                var toolbarsHeight = Editor.CommonUtils.getByClass(this.ckEditorTopToolbarClassName, this.designerFrame.contents()).outerHeight() +
                    Editor.CommonUtils.getByClass(this.ckEditorBottomToolbarClassName, this.designerFrame.contents()).outerHeight();
                var editorHeight = height > 0 ? height : this.designerFrame.contents().innerHeight();
                // prettier-ignore
                Editor.CommonUtils.getByClass(this.ckEditorContentsPartClassName, this.designerFrame.contents()).height(editorHeight - toolbarsHeight - 20); // tslint:disable-line
            }
        };
        return StandardCkEditorProxy;
    }());
    Editor.StandardCkEditorProxy = StandardCkEditorProxy;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Class to extend/override default ckeditor config.
     */
    var CustomCkEditorConfiguration = /** @class */ (function () {
        /**
         * Custom configuration to extend/override default ckeditor config.
         * @param instanceConfiguration configuration for ckeditor instance, e.g. editorInstance.config.title.
         * @param globalConfiguration global configuration for CKEDITOR, e.g. CKEDITOR.config.extraPlugins.
         * @param ckeditorSettings global CKEDITOR settings, e.g. CKEDITOR.stylesSet.
         */
        function CustomCkEditorConfiguration(instanceConfiguration, // tslint:disable-line
        globalConfiguration, // tslint:disable-line
        ckeditorSettings) {
            this.instanceConfiguration = instanceConfiguration;
            this.globalConfiguration = globalConfiguration;
            this.ckeditorSettings = ckeditorSettings;
            // tslint:disable-line
        }
        return CustomCkEditorConfiguration;
    }());
    Editor.CustomCkEditorConfiguration = CustomCkEditorConfiguration;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ComponentLayoutConfiguration = /** @class */ (function () {
        function ComponentLayoutConfiguration() {
        }
        return ComponentLayoutConfiguration;
    }());
    Editor.ComponentLayoutConfiguration = ComponentLayoutConfiguration;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Data class that provides the information on how the default layout for the editor control should look like
     */
    var LayoutConfiguration = /** @class */ (function () {
        function LayoutConfiguration() {
        }
        return LayoutConfiguration;
    }());
    Editor.LayoutConfiguration = LayoutConfiguration;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var BasicPlugin = /** @class */ (function () {
        function BasicPlugin(imagePicker, fcbList) {
            this.fcbList = fcbList;
            this.textTool = new Editor.TextTool();
            this.imageTool = new Editor.ImageTool();
            this.buttonTool = new Editor.ButtonTool();
            this.dividerTool = new Editor.DividerTool();
            this.textBlock = new Editor.TextBlock();
            this.imageBlock = new Editor.ImageBlock();
            this.buttonBlock = new Editor.ButtonBlock();
            this.dividerBlock = new Editor.DividerBlock();
            this.buttonDetailsViewFactory = new Editor.ButtonDetailsViewFactory();
            var imageGalleryCommand = new Editor.ImageGalleryCommand(imagePicker, new Editor.PopupRenderer());
            this.metadataStylesRendererMapping = new MktSvc.Controls.Common.Dictionary();
            this.tools = [this.textTool, this.imageTool, this.dividerTool, this.buttonTool];
            this.toolBlockMapping = new Dictionary();
            this.toolBlockMapping.addOrUpdate(this.textTool.getType(), this.textBlock);
            this.toolBlockMapping.addOrUpdate(this.imageTool.getType(), this.imageBlock);
            this.toolBlockMapping.addOrUpdate(this.buttonTool.getType(), this.buttonBlock);
            this.toolBlockMapping.addOrUpdate(this.dividerBlock.getType(), this.dividerBlock);
            this.blockDetailsViewMapping = new Dictionary();
            var detailsViewControlFactory = new Editor.DetailsViewControlFactory();
            this.blockDetailsViewMapping.addOrUpdate(this.dividerBlock.getType(), new Editor.DividerDetailsView(detailsViewControlFactory.create()));
            this.blockDetailsViewMapping.addOrUpdate(this.imageBlock.getType(), new Editor.ImageDetailsView(detailsViewControlFactory.create(), this.imageBlock, this.fcbList));
            this.blockDetailsViewMapping.addOrUpdate(this.buttonBlock.getType(), this.buttonDetailsViewFactory.create(detailsViewControlFactory.create()));
            var cloneBlockCommand = new Editor.CloneBlockCommand();
            var deleteBlockCommand = new Editor.DeleteBlockCommand();
            var imageBlockCommand = new Editor.ImageGalleryCommand(imagePicker, new Editor.PopupRenderer());
            var dividerAlignButtonsName = [
                Editor.DividerAlignLeftButton.buttonName,
                Editor.DividerAlignCenterButton.buttonName,
                Editor.DividerAlignRightButton.buttonName
            ];
            var dividerAlignLeftCommand = new Editor.DividerAlignCommand("left", "dividerAlignLeftCommand", dividerAlignButtonsName, Editor.DividerAlignLeftButton.buttonName, Editor.DividerAlignCenterButton.buttonName, "center");
            var dividerAlignCenterCommand = new Editor.DividerAlignCommand("center", "dividerAlignCenterCommand", dividerAlignButtonsName, Editor.DividerAlignCenterButton.buttonName, Editor.DividerAlignCenterButton.buttonName, "center");
            var dividerAlignRightCommand = new Editor.DividerAlignCommand("right", "dividerAlignRightCommand", dividerAlignButtonsName, Editor.DividerAlignRightButton.buttonName, Editor.DividerAlignCenterButton.buttonName, "center");
            var dividerheightComand = new Editor.SetDividerHeightCommand();
            var dividerBorderStyleComand = new Editor.SetDividerBorderStyleCommand();
            var moveBlockCommand = new Editor.MoveBlockCommand();
            this.commands = [
                cloneBlockCommand,
                deleteBlockCommand,
                imageGalleryCommand,
                dividerAlignLeftCommand,
                dividerAlignCenterCommand,
                dividerAlignRightCommand,
                dividerheightComand,
                dividerBorderStyleComand,
                moveBlockCommand
            ];
            this.toolbarButtons = [
                new Editor.CloneBlockButton(cloneBlockCommand),
                new Editor.DeleteBlockButton(deleteBlockCommand),
                new Editor.ImageGalleryButton(imageBlockCommand),
                new Editor.DividerAlignLeftButton(dividerAlignLeftCommand),
                new Editor.DividerAlignCenterButton(dividerAlignCenterCommand),
                new Editor.DividerAlignRightButton(dividerAlignRightCommand),
                new Editor.MoveBlockButton(moveBlockCommand)
            ];
            this.toolbarCombos = [
                new Editor.DividerHeightCombo(dividerheightComand),
                new Editor.DividerBorderStyleCombo(dividerBorderStyleComand)
            ];
        }
        BasicPlugin.prototype.getTools = function () {
            return this.tools;
        };
        BasicPlugin.prototype.getToolBlockMapping = function () {
            return this.toolBlockMapping;
        };
        BasicPlugin.prototype.getBlockDetailsViewMapping = function () {
            return this.blockDetailsViewMapping;
        };
        BasicPlugin.prototype.getCommands = function () {
            return this.commands;
        };
        BasicPlugin.prototype.getToolbarButtons = function () {
            return this.toolbarButtons;
        };
        BasicPlugin.prototype.getToolbarCombos = function () {
            return this.toolbarCombos;
        };
        BasicPlugin.prototype.getMetadataStylesRendererMapping = function () {
            return this.metadataStylesRendererMapping;
        };
        return BasicPlugin;
    }());
    Editor.BasicPlugin = BasicPlugin;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var DelayScheduler = MktSvc.Controls.Common.DelayScheduler;
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    /**
     * Content editor class is responsible for setting the html content and initializing all blocks and containers.
     * This class raises:
     *   - content changed event
     *   - selection changed event
     */
    var DesignerContentEditor = /** @class */ (function (_super) {
        __extends(DesignerContentEditor, _super);
        /**
         * Creates the content editor.
         * @param containerId - An id of a container in which the content editor should be placed.
         * @param focusManager - An element focus manager
         * @param keyboardCommandManager - The keyboard command manager
         * @param executionContext - The execution context
         */
        function DesignerContentEditor(containerId, blockControllers, containerControllers, layoutControllers, sectionControllers, blockDefinition, focusManager, keyboardCommandManager, executionContext, abTestingContext, accessibilityNotificator, selectionStateModel, selectedAreaDecorator, accessibilityInstructions, fcbList) {
            if (accessibilityNotificator === void 0) { accessibilityNotificator = null; }
            var _this = _super.call(this, containerId) || this;
            _this.blockControllers = blockControllers;
            _this.containerControllers = containerControllers;
            _this.layoutControllers = layoutControllers;
            _this.sectionControllers = sectionControllers;
            _this.blockDefinition = blockDefinition;
            _this.focusManager = focusManager;
            _this.keyboardCommandManager = keyboardCommandManager;
            _this.executionContext = executionContext;
            _this.abTestingContext = abTestingContext;
            _this.accessibilityNotificator = accessibilityNotificator;
            _this.selectionStateModel = selectionStateModel;
            _this.selectedAreaDecorator = selectedAreaDecorator;
            _this.accessibilityInstructions = accessibilityInstructions;
            _this.fcbList = fcbList;
            _this.propertyReference = "property-reference";
            _this.resizeTimerDelay = 3500;
            _this.contentChangedDebounceTimeout = null;
            _this.isFullscreen = false;
            _this.isDirty = true;
            _this.onMaximizeExecuted = function (eventArgs) {
                _this.isFullscreen = eventArgs.isFullscreen;
                _this.resizeTimer.schedule();
            };
            _this.onContentModelInitialized = function (eventArgs) {
                _this.documentContentModel = eventArgs.documentContentModel;
            };
            _this.onContentModelUpdated = function () {
                _this.documentContentModel.isDesignerContent()
                    ? _this.keyboardCommandManager.registerCommand(_this.keyboardCommand)
                    : _this.keyboardCommandManager.unregisterCommand(_this.keyboardCommand);
            };
            _this.contentSanitizer = executionContext.getContentSanitizer();
            _this.editorFeatureServiceClient = Editor.EditorFeatureServiceClient.instance;
            return _this;
        }
        /**
         * Initializes the designer editor.
         * @param eventBroker - The event broker.
         */
        DesignerContentEditor.prototype.init = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.onBlockCleanupRequestedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.blockCleanupRequested, function (eventArgs) {
                _this.onBlockCleanupRequested.apply(_this, [eventArgs]);
            });
            this.onBlockAddedHandler = this.eventBroker.subscribe(Editor.EventConstants.blockAdded, function (eventArgs) {
                _this.onBlockAdded.apply(_this, [eventArgs]);
                _this.broadcastContentChanged(eventArgs);
            });
            this.onSectionCleanupRequestedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.sectionCleanupRequested, function (eventArgs) {
                _this.onSectionCleanupRequested.apply(_this, [eventArgs]);
            });
            this.onSectionAddedHandler = this.eventBroker.subscribe(Editor.EventConstants.sectionAdded, function (eventArgs) {
                _this.onSectionAdded.apply(_this, [eventArgs]);
                _this.broadcastContentChanged(eventArgs);
            });
            this.onSectionDecorationRequestedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.sectionDecorationRequested, function () {
                _this.onSectionDecorationRequested.apply(_this);
            });
            this.onBlockMovedHandler = this.eventBroker.subscribe(Editor.EventConstants.blockMoved, function (eventArgs) {
                _this.onBlockMoved.call(_this, eventArgs);
                _this.broadcastContentChanged();
            });
            this.onContentBlockChangedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.contentBlockChanged, function (eventArgs) {
                _this.broadcastContentChanged(eventArgs);
            });
            this.onBlockDeletedHandler = this.eventBroker.subscribe(Editor.EventConstants.blockDeleted, function (eventArgs) {
                _this.onBlockDeleted.apply(_this, [eventArgs]);
                _this.broadcastContentChanged(eventArgs);
            });
            this.onContentChangedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.contentChanged, function (eventArgs) {
                _this.broadcastContentChanged(eventArgs);
            });
            this.onContentRefreshedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.contentRefreshed, function () {
                _this.broadcastContentRefreshed();
            });
            this.onContentResolvedHandler = this.eventBroker.subscribe(Editor.EventConstants.contentResolved, function (eventArgs) {
                _this.setContent(eventArgs);
            });
            this.eventBroker.subscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
            this.eventBroker.subscribe(Editor.EventConstants.maximizeExecuted, this.onMaximizeExecuted);
            this.focusManager.init();
            this.keyboardCommand = new KeyboardCommand(KeyboardKeyCodes.oneKey, [KeyboardModifierType.Alt], function () {
                if (_this.documentContentModel.isDesignerContent()) {
                    $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.designerTabContentClassName))
                        .focus()
                        .click();
                }
            });
            this.resizeTimer = new DelayScheduler(this.eventBroker);
            this.resizeTimer.init(function () {
                _this.setMaxHeightOnDesignerTabContent();
            }, this.resizeTimerDelay);
            this.eventBroker.subscribe(Editor.EventConstants.contentModelUpdated, this.onContentModelUpdated);
        };
        /**
         * Activates the view - the view becomes visible
         */
        DesignerContentEditor.prototype.activate = function () {
            _super.prototype.activate.call(this);
            this.render();
            Editor.AccessibilityInstructionsPopup.accessibilityInstructions =
                this.accessibilityInstructions || Editor.EditorAccessibilityInstructions.baseDesignerAccessibilityInstructions;
        };
        /**
         * Sets the new editor content
         */
        DesignerContentEditor.prototype.setContent = function (eventArgs) {
            if (eventArgs === undefined) {
                return;
            }
            if (this.html === eventArgs.html ||
                eventArgs.sourceId === this.id ||
                eventArgs.originalSourceId === this.id) {
                return;
            }
            this.html = eventArgs.html;
            this.isDirty = true;
            if (!this.isActive) {
                return;
            }
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.controllerReady, this.onControllerReady);
            this.onControllerReady = null;
            this.render(eventArgs.originalSourceId);
        };
        DesignerContentEditor.prototype.render = function (rootEventId) {
            var _this = this;
            if (rootEventId === void 0) { rootEventId = null; }
            if (this.isDirty) {
                this.contentSanitizer.init(function () {
                    var editor = _this.getElement();
                    // Dispose the previous content controllers - e.g. ckEditor toolbars setup in the previous render.... othervise, we'll leak memory
                    _this.disposeDesignerIframe();
                    // Render the html content under an iframe
                    var iframe = document.createElement("iframe");
                    var $iframe = $(iframe);
                    $iframe
                        .addClass(Editor.CommonConstants.designerContentEditorFrameClassName)
                        .addClass(Editor.CommonConstants.layoutFrameClassName)
                        .attr("id", Editor.CommonConstants.designerContentEditorFrameId)
                        .attr("title", _this.executionContext.getLocalizationProvider().getLocalizedString("[Designer canvas]"));
                    $iframe.load(function (content) {
                        var iframeContent = content.target.contentDocument.documentElement;
                        $(content.target).contents()[0].onmousedown = function (event) {
                            var target = $(event.target);
                            var ckEditorDialogOpen = target.closest(".cke_dialog:visible").length === 1
                                || target.is(".cke_dialog_background_cover:visible");
                            if (ckEditorDialogOpen) {
                                event.stopPropagation();
                                return;
                            }
                            var bodyContent = $("#" + Editor.CommonConstants.designerContentEditorFrameId)
                                .contents()
                                .find("body");
                            var isNotDecoratedElement = target.closest(".decoratedAreaMarker").length === 0;
                            var isNotCkEditorElement = target.closest(".cke").length === 0;
                            var isNotFlagButton = target.closest(".decoratedAreaHeader").length === 0;
                            var isNotAddSectionPlaceholder = target.closest(".section-add-placeholder").length === 0;
                            var isNotAddBlockPlaceholder = target.closest("[data-id='placeholder-tool-block']").length === 0;
                            var isBodyClick = false;
                            if (bodyContent && bodyContent[0]) {
                                isBodyClick = bodyContent[0].contains(target[0]) && isNotDecoratedElement
                                    && isNotCkEditorElement && isNotFlagButton
                                    && isNotAddSectionPlaceholder && isNotAddBlockPlaceholder;
                            }
                            if ($(iframeContent).find("body")[0] === event.target
                                || event.target === iframeContent
                                || isBodyClick) {
                                event.stopPropagation();
                                _this.selectionStateModel.resetSelection();
                                _this.selectedAreaDecorator.resetSelection();
                                if (Editor.CommonUtils.isFormEditor(bodyContent) && !isBodyClick) {
                                    _this.selectedAreaDecorator.onSelectBodyContent(bodyContent, Editor.BlockConstants.SelectableType.form);
                                }
                                else {
                                    _this.selectedAreaDecorator.onSelectBodyContent(bodyContent, Editor.BlockConstants.SelectableType.body);
                                }
                            }
                        };
                    });
                    var designerIframeWrapper = $("<div>").addClass(Editor.CommonConstants.designerContentEditorFrameWrapperClassName);
                    designerIframeWrapper.append($iframe);
                    // Add IOS specific classes and use separate layout for IOS
                    if (Editor.CommonUtils.isIOS()) {
                        designerIframeWrapper.addClass(Editor.CommonConstants.iosScrollClassName);
                        var designerContainer = $("<div>")
                            .addClass(Editor.CommonConstants.designerIosContainerClassName)
                            .addClass(Editor.CommonConstants.iosScrollClassName)
                            .append(designerIframeWrapper);
                        editor.append(designerContainer);
                    }
                    else {
                        editor.append(designerIframeWrapper);
                    }
                    _this.initialHeight = editor.outerHeight(true);
                    if (!_this.onWindowSizeChanged) {
                        // Use arrow function to save current scope
                        $(window).on("resize", (_this.onWindowSizeChanged = function () {
                            if (!_this.isFullscreen && _this.getElement().is(":visible")) {
                                _this.initialHeight = _this.getElement().outerHeight(true);
                                _this.setMaxHeightOnDesignerTabContent();
                            }
                        }));
                    }
                    var safeDocument = Editor.CommonUtils.getNewContentDocument(Editor.CommonUtils.getWithDoctype("<body></body>"));
                    Editor.CommonUtils.writeFrameContent(iframe, Editor.CommonUtils.getDocumentContent(safeDocument, DesignerContentEditor.safeDocumentDoctype));
                    //set margin on top so selection header will fit in when we select the first element
                    iframe.contentDocument.body.style.marginTop = Editor.CommonConstants.decoratedAreaHeaderHeight;
                    _this.contentSanitizer.getSanitizedContent(Editor.CommonUtils.getWithDoctype(_this.html), function (sanitized) {
                        _this.executionContext.tryExecute(function () {
                            $(iframe.contentDocument.body).append($(sanitized).children());
                            $(iframe.contentDocument.documentElement).attr("lang", _this.executionContext.getLocalizationProvider().getLanguageName());
                            $(sanitized).remove();
                            // Copy the required designer resources/styles
                            var iframeContents = $iframe.contents();
                            // Init the content controllers
                            var containers = Editor.ContainerProvider.getContainers(iframeContents);
                            _this.subscribeToControllersReady();
                            _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerFrameInitialized);
                            Editor.CommonUtils.appendElementToHead(iframeContents, _this.getDesignerStylesElement(_this.fcbList && _this.fcbList.isResponsiveDesign));
                            Editor.CommonUtils.appendElementToHead(iframeContents, _this.getCustomCkEditorStylesElement());
                            var layoutElements = Editor.LayoutProvider.getLayout(iframeContents);
                            _this.executeControllers(_this.layoutControllers, layoutElements, function (controller, layout) {
                                controller.setupLayout(layout);
                            }, "Setup layout");
                            var sections = Editor.SectionProvider.getSections(iframeContents);
                            _this.executeControllers(_this.sectionControllers, sections, function (controller, section) {
                                controller.setupSections(section);
                            }, "Setup section", true);
                            _this.executeControllers(_this.containerControllers, containers, function (controller, container) {
                                controller.setupContainers(container);
                            }, "Setup container", true);
                            _this.executeBlockControllers(iframeContents, function (controller, block) {
                                controller.setupBlocks(block, rootEventId);
                            }, "Setup block", true);
                            if (Editor.CommonUtils.isIOS()) {
                                iframeContents.find("html").addClass(Editor.CommonConstants.iosScrollClassName);
                                iframeContents.find("body").addClass(Editor.CommonConstants.iosScrollClassName);
                                _this.resizeIFrame(iframe);
                            }
                            // Notify with view rendered
                            _this.isDirty = false;
                            _this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.xKey, [KeyboardModifierType.Alt], function () {
                                if (_this.isActive &&
                                    !$(document.activeElement).hasClass(Editor.CommonConstants.designerContentEditorFrameClassName)) {
                                    _this.eventBroker.notify(Editor.EventConstants.onKeypressToFocusPreviousElementCalled);
                                }
                            }));
                            _this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.escapeKeyCode, [], function () {
                                if (Editor.CommonUtils.getByClass(Editor.CommonConstants.selectedSortablePlaceholderClassName, Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName).contents()).length) {
                                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddEnd);
                                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.cleanPlaceholderForAddMode);
                                }
                            }));
                            _this.keyboardCommandManager.registerCommandsInIframe(iframe);
                        }, "Initialize the designer content editor", true);
                    });
                    if (!Utility.isNullOrUndefined(_this.accessibilityNotificator)) {
                        _this.accessibilityNotificator.init(editor.get(0), Editor.CommonConstants.designerAccessibilityNotificationsRegion);
                    }
                });
            }
            else {
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerReady);
            }
            this.setMaxHeightOnDesignerTabContent();
            this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.id));
        };
        DesignerContentEditor.prototype.resizeIFrame = function (iframe) {
            var _this = this;
            if (iframe && iframe.contentDocument) {
                this.applyIFrameHeight(iframe);
            }
            $(iframe)
                .contents()
                .find("img")
                .each(function (index, imageElement) {
                var image = $(imageElement);
                image.off("load");
                image.on("load", function () {
                    _this.applyIFrameHeight(iframe);
                });
            });
        };
        DesignerContentEditor.prototype.resetIFrameHeight = function (iframe) {
            $(iframe).height(String.Empty);
            $(iframe)
                .contents()
                .find("html")
                .height(String.Empty);
            $(iframe)
                .contents()
                .find("body")
                .height(String.Empty);
        };
        DesignerContentEditor.prototype.applyIFrameHeight = function (iframe) {
            var scrollPosition = $("." + Editor.CommonConstants.designerContentEditorFrameWrapperClassName).scrollTop();
            // Reset old height to calculate new value correctly
            this.resetIFrameHeight(iframe);
            var containerHeight = $("." + Editor.CommonConstants.designerControlCssClass).height();
            var containerWidth = $("." + Editor.CommonConstants.designerControlCssClass).width();
            $("." + Editor.CommonConstants.designerIosContainerClassName)
                .height(containerHeight)
                .width(containerWidth);
            var contentHeight = $(iframe)
                .contents()
                .height();
            // Restore scroll position
            $("." + Editor.CommonConstants.designerContentEditorFrameWrapperClassName).scrollTop(scrollPosition);
            var designerFrameOffset = $(iframe).outerHeight() - $(iframe).innerHeight();
            var frameContainerHeight = $("." + Editor.CommonConstants.designerControlCssClass + ":visible").height() - designerFrameOffset;
            if (frameContainerHeight < contentHeight) {
                $(iframe).height(contentHeight);
                $(iframe)
                    .contents()
                    .find("html")
                    .height(contentHeight);
                $(iframe)
                    .contents()
                    .find("body")
                    .height(contentHeight);
            }
            else {
                $(iframe).height(frameContainerHeight);
                $(iframe)
                    .contents()
                    .find("html")
                    .height(contentHeight);
                $(iframe)
                    .contents()
                    .find("body")
                    .height(contentHeight);
            }
        };
        DesignerContentEditor.prototype.disposeDesignerIframe = function () {
            // Dispose the previous content controllers - e.g. ckEditor toolbars setup in the previous render.... othervise, we'll leak memory
            var frame = this.getElement()
                .find(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.designerContentEditorFrameClassName))
                .first();
            // Cleanup the content render the toolbar
            if (frame.length > 0) {
                this.executeBlockControllers(frame.contents(), function (controller, block) {
                    controller.disposeBlocks(block);
                }, "dispose blocks");
                var containers = Editor.ContainerProvider.getContainers(frame.contents());
                this.executeControllers(this.containerControllers, containers, function (controller, container) {
                    controller.disposeContainers(container);
                }, "Dispose containers");
                var layoutElements = Editor.LayoutProvider.getLayout(frame.contents());
                this.executeControllers(this.layoutControllers, layoutElements, function (controller, layout) {
                    controller.disposeLayout(layout);
                }, "Dispose layout");
                var sections = Editor.SectionProvider.getSections(frame.contents());
                this.executeControllers(this.sectionControllers, sections, function (controller, section) {
                    controller.disposeSections(section);
                }, "Dispose sections");
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerFrameDisposed);
                this.keyboardCommandManager.unregisterCommandsInIframe(frame[0]);
                frame.off();
                frame.remove();
                Editor.CommonUtils.getByClass(Editor.CommonConstants.designerIosContainerClassName).remove();
                Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameWrapperClassName).remove();
            }
        };
        DesignerContentEditor.prototype.onControllerReadyCallback = function (unreadyBlockElements, eventArgs) {
            var index = unreadyBlockElements.indexOf(eventArgs.controllerName);
            if (index !== -1) {
                unreadyBlockElements.splice(index, 1);
                if (unreadyBlockElements.length === 0) {
                    this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerReady);
                }
            }
        };
        DesignerContentEditor.prototype.subscribeToControllersReady = function () {
            var _this = this;
            this.controllerNames = [];
            this.layoutControllers.each(function (controller) {
                _this.controllerNames.push(controller.getName());
            });
            this.sectionControllers.each(function (controller) {
                _this.controllerNames.push(controller.getName());
            });
            this.containerControllers.each(function (controller) {
                _this.controllerNames.push(controller.getName());
            });
            this.blockControllers.each(function (controller) {
                _this.controllerNames.push(controller.getName());
            });
            if (Utility.isNullOrUndefined(this.onControllerReady)) {
                this.onControllerReady = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.controllerReady, function (eventArgs) {
                    _this.onControllerReadyCallback.apply(_this, [_this.controllerNames, eventArgs]);
                });
            }
        };
        DesignerContentEditor.prototype.broadcastContentChanged = function (originalEventArgs) {
            var _this = this;
            var _a;
            // When there are many changes at once, don't call contentChanged multiple times.
            // For example,
            // setContent -> render -> setupBlocks -> N contentBlockChanged events
            // ... must only trigger contentChanged once.
            clearTimeout(this.contentChangedDebounceTimeout);
            if (((_a = originalEventArgs) === null || _a === void 0 ? void 0 : _a.rootEventId) === "FullPageToolbar") {
                return;
            }
            this.contentChangedDebounceTimeout = setTimeout(function () {
                var _a;
                _this.contentChangedDebounceTimeout = null;
                var eventArgs = new Editor.ContentChangedEventArgs(_this.getContent(), _this.id, originalEventArgs != null ? originalEventArgs.sourceId : null, Editor.CommonConstants.designerEditorComponentName, true, (_a = originalEventArgs) === null || _a === void 0 ? void 0 : _a.rootEventId // tslint:disable-line
                );
                if (Editor.CommonUtils.isIOS()) {
                    _this.resizeIFrame($("." + Editor.CommonConstants.designerContentEditorFrameClassName).get(0));
                }
                _this.eventBroker.notify(Editor.EventConstants.contentChanged, eventArgs);
            }, 0);
        };
        DesignerContentEditor.prototype.broadcastContentRefreshed = function () {
            var eventArgs = new Editor.EventArgs(this.id);
            this.eventBroker.notify(Editor.EventConstants.contentRefreshed, eventArgs);
        };
        /**
         * Find all descendants of nodeInResolvedDocument, that have specific property and add those properties to the corrsponding descendant in nodeInDesigner.
         * @param nodeInResolvedDocument The node in resolved document.
         * @param nodeInDesigner The node in designer.
         * @param attribute The attribute.
         */
        DesignerContentEditor.prototype.copyAttrToDescendants = function (nodeInResolvedDocument, nodeInDesigner, attribute) {
            var nodeInDesignerDescendants = $(nodeInDesigner).find("*");
            var nodeInResolvedDocDescendants = $(nodeInResolvedDocument).find("*");
            // If they do not have the same length_which means the same structure_ so we couldn't use the same index.
            if (nodeInDesignerDescendants.length === nodeInResolvedDocDescendants.length) {
                nodeInResolvedDocDescendants.each(function (index, element) {
                    if (element.hasAttribute(attribute)) {
                        var elementInDesignerNode = nodeInDesignerDescendants.get(index);
                        if (!Utility.isNullOrUndefined(elementInDesignerNode) &&
                            elementInDesignerNode.tagName === element.tagName) {
                            $(nodeInDesignerDescendants.get(index)).attr(attribute, $(element).attr(attribute));
                        }
                    }
                });
            }
        };
        /**
         * Gets the editor content
         */
        DesignerContentEditor.prototype.getContent = function () {
            var _this = this;
            var iframe = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName)[0];
            if (Utility.isNullOrUndefined(iframe)) {
                return String.Empty;
            }
            // Merge the data with the content from the content model
            var tempResolvedDocument = Editor.CommonUtils.getNewContentDocument(this.html);
            Editor.CommonUtils.walkTree($(iframe)
                .contents()
                .children()
                .find("body"), function (nodeInDesigner) {
                var nodeId = nodeInDesigner.attr("id");
                var isDataLayout = Editor.CommonUtils.isLayout(nodeInDesigner);
                var isDataSection = Editor.SectionProvider.isSection(nodeInDesigner);
                var isDataContainer = Editor.ContainerProvider.isContainer(nodeInDesigner);
                var isDataBlock = !String.isNullUndefinedOrWhitespace(nodeInDesigner.attr(Editor.Contract.blockTypeAttrName));
                if (!String.isNullUndefinedOrWhitespace(nodeId) &&
                    (isDataBlock || isDataContainer || isDataSection)) {
                    // This is a node which has been set up, so, try to find it in the resolved document and merge the content
                    var nodeInResolvedDocument = Editor.CommonUtils.getById(nodeId, $(tempResolvedDocument).contents());
                    if (nodeInResolvedDocument.length > 0) {
                        // Check if the block descendants have "property-refrence" attribute.
                        if (isDataBlock) {
                            _this.copyAttrToDescendants(nodeInResolvedDocument, nodeInDesigner, _this.propertyReference);
                        }
                        // Check if the first tag of the node has "property-refrence" attribute.
                        var attrValue = nodeInResolvedDocument.attr(_this.propertyReference);
                        if (!String.isNullOrWhitespace(attrValue)) {
                            nodeInDesigner.attr(_this.propertyReference, attrValue);
                        }
                        nodeInResolvedDocument.html(nodeInDesigner.html());
                        if (isDataContainer &&
                            !String.isNullUndefinedOrWhitespace(nodeInDesigner[0].tagName) &&
                            (nodeInDesigner[0].tagName.toLowerCase() === "form" || nodeInDesigner[0].tagName.toLowerCase() === "div")) {
                            nodeInResolvedDocument[0].setAttribute("style", nodeInDesigner[0].getAttribute("style"));
                        }
                    }
                    // Otherwise, find data-layout and use it as a root node for layout enabled templates
                }
                else if (isDataLayout) {
                    var nodeInResolvedDocument = Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrEqualsSelector(Editor.Contract.dataLayoutAttrName, "true"), $(tempResolvedDocument).contents());
                    if (nodeInResolvedDocument.length > 0) {
                        // Check if the first tag of the node has "property-refrence" attribute.
                        if (!String.isNullOrWhitespace($(nodeInResolvedDocument).attr(_this.propertyReference))) {
                            nodeInDesigner.attr(_this.propertyReference, $(nodeInResolvedDocument).attr(_this.propertyReference));
                        }
                        nodeInResolvedDocument.html(nodeInDesigner.html());
                        var dataLayoutStyle = nodeInDesigner[0].getAttribute("style");
                        if (dataLayoutStyle !== null) {
                            nodeInResolvedDocument[0].setAttribute("style", dataLayoutStyle);
                        }
                    }
                }
            });
            // Cleanup the blocks, containers
            var containers = Editor.ContainerProvider.getContainers($(tempResolvedDocument).contents());
            this.executeBlockControllers($(tempResolvedDocument).contents(), function (controller, block) {
                controller.cleanupBlocks(block);
            }, "Cleanup blocks", true);
            this.executeControllers(this.containerControllers, containers, function (controller, container) {
                controller.cleanupContainers(container);
            }, "Cleanup containers", true);
            var layoutElements = Editor.LayoutProvider.getLayout($(tempResolvedDocument).contents());
            this.executeControllers(this.layoutControllers, layoutElements, function (controller, layout) {
                controller.cleanupLayout(layout);
            }, "Cleanup layout", true);
            var sections = Editor.SectionProvider.getSections($(tempResolvedDocument).contents());
            this.executeControllers(this.sectionControllers, sections, function (controller, section) {
                controller.cleanupSections(section);
            }, "Cleanup sections", true);
            this.selectedAreaDecorator.cleanup($(tempResolvedDocument).contents());
            Editor.BlockResize.cleanUpResize($(tempResolvedDocument).contents());
            return Editor.CommonUtils.getDocumentContent(tempResolvedDocument, Utility.isNullOrUndefined(this.documentContentModel)
                ? String.Empty
                : this.documentContentModel.getDoctype());
        };
        DesignerContentEditor.prototype.dispose = function () {
            var _this = this;
            this.executionContext.tryExecute(function () {
                _this.disposeDesignerIframe();
                _this.blockControllers.each(function (controller) {
                    _this.executionContext.tryExecute(function () {
                        controller.dispose();
                    }, "Dispose the " + controller.getName());
                });
                _this.executeControllers(_this.containerControllers, null, function (controller, container) {
                    controller.dispose();
                }, "Dispose containers");
                _this.executeControllers(_this.layoutControllers, null, function (controller, layout) {
                    controller.dispose();
                }, "Dispose layout");
                _this.executeControllers(_this.sectionControllers, null, function (controller, section) {
                    controller.dispose();
                }, "Dispose sections");
                if (_this.onWindowSizeChanged) {
                    $(window).off("resize", _this.onWindowSizeChanged);
                }
                if (_this.resizeTimer) {
                    _this.resizeTimer.stop(true);
                    _this.resizeTimer.dispose();
                }
                clearTimeout(_this.contentChangedDebounceTimeout);
                _this.contentChangedDebounceTimeout = null;
                _this.onWindowSizeChanged = null;
                _this.unsubscribeFromEvent(Editor.EventConstants.contentModelInitialized, _this.onContentModelInitialized);
                _this.unsubscribeFromEvent(Editor.EventConstants.blockAdded, _this.onBlockAddedHandler);
                _this.unsubscribeFromEvent(Editor.EventConstants.sectionAdded, _this.onSectionAddedHandler);
                _this.unsubscribeFromEvent(Editor.EventConstants.blockMoved, _this.onBlockMovedHandler);
                _this.unsubscribeFromEvent(Editor.EventConstants.blockDeleted, _this.onBlockDeletedHandler);
                _this.unsubscribeFromEvent(Editor.EventConstants.contentResolved, _this.onContentResolvedHandler);
                _this.unsubscribeFromEvent(Editor.EventConstants.contentModelUpdated, _this.onContentModelUpdated);
                _this.unsubscribeFromEvent(Editor.DesignerInternalEventConstants.contentBlockChanged, _this.onContentBlockChangedHandler);
                _this.unsubscribeFromEvent(Editor.DesignerInternalEventConstants.blockCleanupRequested, _this.onBlockCleanupRequestedHandler);
                _this.unsubscribeFromEvent(Editor.DesignerInternalEventConstants.contentChanged, _this.onContentChangedHandler);
                _this.unsubscribeFromEvent(Editor.DesignerInternalEventConstants.controllerReady, _this.onControllerReady);
                _this.unsubscribeFromEvent(Editor.EventConstants.maximizeExecuted, _this.onMaximizeExecuted);
                _this.onContentModelInitialized = null;
                _this.onBlockAddedHandler = null;
                _this.onSectionAddedHandler = null;
                _this.onBlockMovedHandler = null;
                _this.onBlockDeletedHandler = null;
                _this.onContentResolvedHandler = null;
                _this.onContentModelUpdated = null;
                _this.onContentBlockChangedHandler = null;
                _this.onBlockCleanupRequestedHandler = null;
                _this.onContentChangedHandler = null;
                _this.onControllerReady = null;
                _this.onMaximizeExecuted = null;
                _this.focusManager.dispose();
                _this.contentSanitizer.dispose();
                _this.documentContentModel = null;
                if (_this.selectionStateModel) {
                    _this.selectionStateModel.dispose();
                }
                if (_this.selectedAreaDecorator) {
                    _this.selectedAreaDecorator.dispose();
                }
            }, "Dispose the designer content editor");
        };
        DesignerContentEditor.prototype.unsubscribeFromEvent = function (eventName, delegate) {
            if (!Utility.isNullOrUndefined(delegate) && this.eventBroker) {
                this.eventBroker.unsubscribe(eventName, delegate);
            }
        };
        DesignerContentEditor.prototype.onBlockCleanupRequested = function (blockCleanupRequestedEventArgs) {
            // TODO: remove this event handler in favor of exposing a simple method.
            this.executeBlockControllers(blockCleanupRequestedEventArgs.block, function (controller, block) {
                controller.cleanupBlocks(block);
            }, "Cleanup block", true);
            if (blockCleanupRequestedEventArgs.onAfterBlockCleanup) {
                blockCleanupRequestedEventArgs.onAfterBlockCleanup(blockCleanupRequestedEventArgs.block);
            }
        };
        DesignerContentEditor.prototype.onSectionCleanupRequested = function (sectionCleanupArgs) {
            // TODO: remove this event handler in favor of exposing a simple method.
            this.executeControllers(this.sectionControllers, sectionCleanupArgs.section, function (controller, section) {
                controller.cleanupSections(section);
            }, "Cleanup section", true);
            if (sectionCleanupArgs.onAfterSectionCleanup) {
                sectionCleanupArgs.onAfterSectionCleanup(sectionCleanupArgs.section);
            }
        };
        DesignerContentEditor.prototype.onSectionDecorationRequested = function () {
            this.reInitSections();
        };
        DesignerContentEditor.prototype.onBlockAdded = function (blockAddedEventArgs) {
            var eventBlock = blockAddedEventArgs.block;
            this.executeBlockControllers(eventBlock, function (controller, block) {
                controller.setupBlocks(block);
            }, "setup blocks", true);
            if (blockAddedEventArgs.shouldFocus) {
                eventBlock.focusin();
                if (!Utility.isNullOrUndefined(eventBlock)) {
                    var addedBlock = this.blockDefinition.getBlockDefinition(eventBlock);
                    if (!Utility.isNullOrUndefined(addedBlock)) {
                        addedBlock.onBlockAdded(eventBlock);
                    }
                }
                if (blockAddedEventArgs.cloned && !Utility.isNullOrUndefined(blockAddedEventArgs.block[0])) {
                    var blockName = blockAddedEventArgs.block[0].getAttribute("aria-label");
                    var blockMovedLabel = this.executionContext
                        .getLocalizationProvider()
                        .getLocalizedString(Editor.CommonConstants.blockClonedLabel);
                    this.accessibilityNotify(blockName + " " + blockMovedLabel);
                }
                if (!Utility.isNullOrUndefined(eventBlock)) {
                    this.eventBroker.notify(Editor.DesignerInternalEventConstants.itemFocused, new Editor.ItemFocusedEventArgs(eventBlock[0], true));
                }
            }
        };
        DesignerContentEditor.prototype.onSectionAdded = function (sectionAddedEventArgs) {
            var eventSection = sectionAddedEventArgs.section;
            var sections = Editor.SectionProvider.getSections(eventSection);
            this.executeControllers(this.sectionControllers, sections, function (controller, section) {
                controller.setupSections(section);
            }, "Setup sections", true);
            this.reInitContainers();
            this.reInitBlocks();
            eventSection.focusin();
        };
        DesignerContentEditor.prototype.reInitSections = function () {
            var iframe = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName)[0];
            var sections = Editor.SectionProvider.getSections($(iframe.contentDocument.getElementsByTagName("body")[0]));
            this.executeControllers(this.sectionControllers, sections, function (controller, section) {
                controller.setupSections(section);
            }, "Setup sections", true);
        };
        DesignerContentEditor.prototype.reInitContainers = function () {
            var iframe = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName)[0];
            var containers = Editor.ContainerProvider.getContainers($(iframe.contentDocument.getElementsByTagName("body")[0]));
            this.executeControllers(this.containerControllers, containers, function (controller, container) {
                controller.disposeContainers(container);
            }, "Dispose containers");
            this.executeControllers(this.containerControllers, containers, function (controller, container) {
                controller.setupContainers(container);
            }, "Setup containers", true);
        };
        DesignerContentEditor.prototype.reInitBlocks = function () {
            var iframe = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName)[0];
            var iframeContents = $(iframe).contents();
            this.executeBlockControllers(iframeContents.contents(), function (controller, block) {
                if (!(controller instanceof Editor.BlockInlineToolbarController) &&
                    !(controller instanceof Editor.BlockIdController)) {
                    controller.cleanupBlocks(block);
                }
            }, "Cleanup blocks", true);
            this.executeBlockControllers(iframeContents, function (controller, block) {
                if (!(controller instanceof Editor.BlockInlineToolbarController) &&
                    !(controller instanceof Editor.BlockIdController)) {
                    controller.setupBlocks(block);
                }
            }, "Setup block", true);
        };
        DesignerContentEditor.prototype.onBlockMoved = function (blockMovedEventArgs) {
            // Same solution as in CkEditorProxy, the zero timeout is required or else the element
            // will lose its focus later on in the event chain and the toolbox will not appear.
            setTimeout(function () {
                Editor.BlockProvider.getEditableElement(blockMovedEventArgs.block).focus();
            }, 0);
            var blockName = blockMovedEventArgs.block[0].getAttribute("aria-label");
            var blockMovedLabel = this.executionContext
                .getLocalizationProvider()
                .getLocalizedString(Editor.CommonConstants.blockMovedLabel);
            this.accessibilityNotify(blockName + " " + blockMovedLabel);
        };
        DesignerContentEditor.prototype.onBlockDeleted = function (blockDeletedEventArgs) {
            this.executeBlockControllers(blockDeletedEventArgs.block, function (controller, block) {
                controller.disposeBlocks(block);
            }, "dispose blocks");
            if (!blockDeletedEventArgs.partOfUpdate && !Utility.isNullOrUndefined(blockDeletedEventArgs.block[0])) {
                var blockName = blockDeletedEventArgs.block[0].getAttribute("aria-label");
                var blockDeletedLabel = this.executionContext
                    .getLocalizationProvider()
                    .getLocalizedString(Editor.CommonConstants.blockDeletedLabel);
                this.accessibilityNotify(blockName + " " + blockDeletedLabel);
            }
        };
        DesignerContentEditor.prototype.accessibilityNotify = function (message) {
            if (!Utility.isNullOrUndefined(this.accessibilityNotificator)) {
                this.accessibilityNotificator.notify(message);
            }
        };
        /**
         * Custom Control Framework doesn't allow us to load additional resources; we need the styles hardcoded into the product.
         */
        DesignerContentEditor.prototype.getDesignerStylesElement = function (isResponsiveDesign) {
            return $("<style>")
                .attr("id", Editor.DesignerContentEditorStyles.designerStylesId)
                .text(Editor.DesignerContentEditorStyles.getDesignerStyles(isResponsiveDesign));
        };
        DesignerContentEditor.prototype.setMaxHeightOnDesignerTabContent = function () {
            var designerEditor = this.getElement();
            var designerTabView = designerEditor.siblings(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.designerTabViewCssClass));
            if (this.isFullscreen || this.isNarrowView()) {
                designerTabView.css("max-height", String.Empty);
            }
            else {
                var designerTabHeaderHeight = designerEditor
                    .siblings(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.designerTabButtonViewCssClass))
                    .outerHeight(true);
                if (designerTabHeaderHeight !== 0) {
                    designerTabView.css("max-height", this.initialHeight - designerTabHeaderHeight);
                }
            }
            if (Editor.CommonUtils.isIOS()) {
                // prettier-ignore
                this.resizeIFrame($("." + Editor.CommonConstants.designerContentEditorFrameClassName).get(0));
            }
        };
        DesignerContentEditor.prototype.isNarrowView = function () {
            try {
                var containerWidth = $("body").width();
                return !!containerWidth && containerWidth < 800;
            }
            catch (e) {
                return false;
            }
        };
        DesignerContentEditor.prototype.getCustomCkEditorStylesElement = function () {
            return $("<style>")
                .attr("id", Editor.DesignerContentEditorStyles.ckEditorStylesId)
                .text(Editor.DesignerContentEditorStyles.ckEditorStyles);
        };
        DesignerContentEditor.prototype.executeBlockControllers = function (blockSource, callback, logMessage, failOnError) {
            var _this = this;
            var blocks = Editor.BlockProvider.getBlocks(blockSource, true);
            var lockedBlocks = Editor.BlockProvider.getBlocks(blockSource, false);
            if (Editor.BlockProvider.isBlock(blockSource)) {
                blocks = blocks.add(blockSource);
                if (Editor.BlockProvider.filterUneditableBlocks(null, blockSource[0])) {
                    lockedBlocks = lockedBlocks.add(blockSource);
                }
            }
            var subBlocks = Editor.BlockProvider.getSubBlocks(blockSource, true);
            var lockedSubBlocks = Editor.BlockProvider.getSubBlocks(blockSource, false);
            this.blockControllers.each(function (controller) {
                _this.executionContext.tryExecute(function () {
                    var operableBlocks = controller.executionLockLevel() === Editor.BlockConstants.LockLevel.hard ? lockedBlocks : blocks;
                    callback(controller, operableBlocks);
                    if (controller.executeOnSubBlocks()) {
                        var operableSubBlocks = controller.executionLockLevel() === Editor.BlockConstants.LockLevel.hard
                            ? lockedSubBlocks
                            : subBlocks;
                        callback(controller, operableSubBlocks);
                    }
                }, controller.getName() + " " + logMessage, failOnError);
            });
        };
        DesignerContentEditor.prototype.executeControllers = function (controllers, elements, callback, logMessage, failOnError) {
            var _this = this;
            controllers.each(function (controller) {
                _this.executionContext.tryExecute(function () {
                    callback(controller, elements);
                }, controller.getName() + " " + logMessage, failOnError);
            });
        };
        DesignerContentEditor.safeDocumentDoctype = "<!DOCTYPE html>";
        return DesignerContentEditor;
    }(Editor.Control));
    Editor.DesignerContentEditor = DesignerContentEditor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var LayoutRenderer = /** @class */ (function () {
        function LayoutRenderer() {
        }
        /**
         * Renders the containers for the editor components
         * @param containerId - The id of the container in which the editor will be rendered.
         * @param layoutConfiguration - The layout configuration for the editor.
         */
        LayoutRenderer.prototype.render = function (container, layoutConfiguration) {
            if (this.isNarrowView()) {
                this.renderNarrow(container, layoutConfiguration);
                return;
            }
            this.renderWide(container, layoutConfiguration);
        };
        /**
         * Renders the containers for the editor components
         * @param containerId - The id of the container in which the editor will be rendered.
         * @param layoutConfiguration - The layout configuration for the editor.
         */
        LayoutRenderer.prototype.renderNarrow = function (container, layoutConfiguration) {
            container.addClass(layoutConfiguration.cssClass);
            var tableLayout = $("<div></div>");
            tableLayout.attr("role", "presentation");
            layoutConfiguration.components.each(function (rowComponent) {
                var rowContainer = $("<div></div>");
                rowComponent.each(function (cellComponent) {
                    var componentContainer = $("<div></div>");
                    componentContainer.addClass(cellComponent.cssClass);
                    Editor.CommonUtils.setId(componentContainer, cellComponent.id);
                    rowContainer.append(componentContainer);
                });
                tableLayout.append(rowContainer);
            });
            container.append(tableLayout);
        };
        /**
         * Renders the containers for the editor components
         * @param containerId - The id of the container in which the editor will be rendered.
         * @param layoutConfiguration - The layout configuration for the editor.
         */
        LayoutRenderer.prototype.renderWide = function (container, layoutConfiguration) {
            container.addClass(layoutConfiguration.cssClass);
            var tableLayout = $("<table></table>");
            tableLayout.attr("role", "presentation");
            var tableComponentsLayout = $("<tbody></tbody>");
            layoutConfiguration.components.each(function (rowComponent) {
                var rowContainer = $("<tr></tr>");
                rowComponent.each(function (cellComponent) {
                    var componentContainer = $("<td></td>");
                    componentContainer.addClass(cellComponent.cssClass);
                    Editor.CommonUtils.setId(componentContainer, cellComponent.id);
                    rowContainer.append(componentContainer);
                });
                tableComponentsLayout.append(rowContainer);
            });
            tableLayout.append(tableComponentsLayout);
            container.append(tableLayout);
        };
        LayoutRenderer.prototype.isNarrowView = function () {
            try {
                var containerWidth = $("body").width();
                return !!containerWidth && containerWidth < 800;
            }
            catch (e) {
                return false;
            }
        };
        LayoutRenderer.prototype.dispose = function () { };
        return LayoutRenderer;
    }());
    Editor.LayoutRenderer = LayoutRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ComposeControl = /** @class */ (function (_super) {
        __extends(ComposeControl, _super);
        function ComposeControl(id, controls, layoutRenderer, layoutConfiguration) {
            var _this = _super.call(this, id) || this;
            _this.controls = controls;
            _this.layoutRenderer = layoutRenderer;
            _this.layoutConfiguration = layoutConfiguration;
            return _this;
        }
        /**
         * Initializes the view - renders the view and/or attach proper event to render/refresh the view content
         */
        ComposeControl.prototype.init = function (eventBroker) {
            this.layoutRenderer.render(Editor.CommonUtils.getById(this.id), this.layoutConfiguration);
            this.controls.each(function (control) { return control.init(eventBroker); });
        };
        /**
         * Activates the view - the view becomes visible
         */
        ComposeControl.prototype.activate = function () {
            _super.prototype.activate.call(this);
            this.controls.each(function (control) { return control.activate(); });
        };
        /**
         * Dectivates the view - the view becomes invisible
         */
        ComposeControl.prototype.deactivate = function () {
            _super.prototype.deactivate.call(this);
            this.controls.each(function (control) { return control.deactivate(); });
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        ComposeControl.prototype.dispose = function () {
            this.controls.each(function (control) { return control.dispose(); });
        };
        return ComposeControl;
    }(Editor.Control));
    Editor.ComposeControl = ComposeControl;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /** Represents data item for the tab control */
    var TabControlItem = /** @class */ (function () {
        /** Initializes a new instance of type TabControlItem
         * @param caption - caption of the tab
         * @param tabContentElementId - id for the content div
         * @param tabContentElementStyle - class name for the tab content element
         * @param tabContentElementDataId - data-id attribute for the anchor element and id attribute for li element
         */
        function TabControlItem(caption, tabContentElementId, tabContentInitAction, tabContentActivateAction, tabContentDeactivateAction, tabContentDisposeAction, tabContentElementStyle, tabContentElementDataId, tabContentFocusAction, enabledOnDefault) {
            if (enabledOnDefault === void 0) { enabledOnDefault = true; }
            this.tabContentElementId = tabContentElementId;
            this.tabContentActivateAction = tabContentActivateAction;
            this.tabContentFocusAction = tabContentFocusAction;
            this.tabContentElementStyle = tabContentElementStyle;
            this.tabContentElementDataId = tabContentElementDataId;
            this.tabContentDisposeAction = tabContentDisposeAction;
            this.tabContentDeactivateAction = tabContentDeactivateAction;
            this.tabContentInitAction = tabContentInitAction;
            this.caption = caption;
            this.enabled = enabledOnDefault;
        }
        /** Initializes the control. */
        TabControlItem.prototype.init = function () {
            this.tabContentInitAction();
        };
        /** Activates the control. */
        TabControlItem.prototype.activate = function () {
            this.tabContentActivateAction();
        };
        TabControlItem.prototype.focus = function () {
            if (this.tabContentFocusAction != null) {
                this.tabContentFocusAction();
            }
        };
        /** Enable the tab item */
        TabControlItem.prototype.enable = function () {
            this.enabled = true;
        };
        /** Disable the tab item */
        TabControlItem.prototype.disable = function () {
            this.enabled = false;
        };
        /** Get the enabled status */
        TabControlItem.prototype.isEnabled = function () {
            return this.enabled;
        };
        /** Deactivates the control. */
        TabControlItem.prototype.deactivate = function () {
            this.tabContentDeactivateAction();
        };
        /** Disposes the control. */
        TabControlItem.prototype.dispose = function () {
            this.tabContentDisposeAction();
        };
        return TabControlItem;
    }());
    Editor.TabControlItem = TabControlItem;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    /** Represents the tab control on the right pane */
    var TabControl = /** @class */ (function (_super) {
        __extends(TabControl, _super);
        /** Initializes a new instance of type
         * @param element - parent element
         */
        function TabControl(elementId, tabItems, executionContext, tabButtonsContainerId, tabVisibilityManager, internalTabulationEnabled, onTabActivate, tabBarRightAreaId) {
            if (internalTabulationEnabled === void 0) { internalTabulationEnabled = true; }
            if (onTabActivate === void 0) { onTabActivate = null; }
            if (tabBarRightAreaId === void 0) { tabBarRightAreaId = null; }
            var _this = _super.call(this, elementId) || this;
            _this.internalTabulationEnabled = internalTabulationEnabled;
            _this.onTabActivate = onTabActivate;
            _this.tabBarRightAreaId = tabBarRightAreaId;
            /** Tab panels */
            _this.tabsPanels = [];
            _this.updateTabVisibility = function () {
                _this.tabItems.each(function (tabItem) {
                    tabItem.isEnabled() ? _this.showTab(tabItem) : _this.hideTab(tabItem);
                });
                if (!_this.selectedTabIsVisible()) {
                    _this.selectTab(_this.getFirstVisibleTab().tabContentElementId);
                }
            };
            _this.bringIntoViewRequested = function (eventArgs) {
                var panelId = eventArgs.viewId;
                if (_this.tabItems.where(function (t) { return t.tabContentElementId === panelId; }).count() === 0) {
                    return;
                }
                _this.selectTab(panelId, false);
                var tabIndex = _this.getTabIndex(panelId);
                _this.selectedTab = _this.tabItems[tabIndex];
            };
            _this.tabItems = tabItems;
            _this.executionContext = executionContext;
            if (!Utility.isNullOrUndefined(tabButtonsContainerId)) {
                _this.tabButtonsContainerId = tabButtonsContainerId;
            }
            if (!Utility.isNullOrUndefined(tabVisibilityManager)) {
                _this.tabVisibilityManager = tabVisibilityManager;
            }
            return _this;
        }
        /** Renders the tab control */
        TabControl.prototype.init = function (eventBroker) {
            var _this = this;
            if (!Utility.isNullOrUndefined(this.tabVisibilityManager)) {
                this.tabVisibilityManager.init(this.updateTabVisibility);
            }
            this.eventBroker = eventBroker;
            this.renderContainer();
            this.initializeControl();
            if (Editor.CommonUtils.isVisible(this.getElement())) {
                this.activateFirstTab();
            }
            if (!this.onFocusFirstElement) {
                eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerReady, (this.onFocusFirstElement = function () {
                    if (_this.executionContext.isFocused()) {
                        _this.focusFirstElement();
                    }
                }));
            }
            eventBroker.subscribe(Editor.EventConstants.bringIntoView, this.bringIntoViewRequested);
        };
        /**
         * Activates the view - the view becomes visible
         */
        TabControl.prototype.activate = function () {
            _super.prototype.activate.call(this);
            var selectedTabIndex = this.getSelectedTabIndex();
            this.activateTabByIndex(selectedTabIndex);
        };
        /**
         * Dectivates the view - the view becomes invisible
         */
        TabControl.prototype.deactivate = function () {
            _super.prototype.deactivate.call(this);
            this.tabItems.each(function (item) {
                item.deactivate();
            });
            this.selectedTab = null;
        };
        /** Dispose */
        TabControl.prototype.dispose = function () {
            var _this = this;
            this.executionContext.tryExecute(function () {
                if (_this.eventBroker) {
                    _this.eventBroker.unsubscribe(Editor.EventConstants.bringIntoView, _this.bringIntoViewRequested);
                    if (_this.onFocusFirstElement) {
                        _this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerReady, _this.onFocusFirstElement);
                    }
                }
                if (!Utility.isNullOrUndefined(_this.tabVisibilityManager)) {
                    _this.tabVisibilityManager.dispose();
                }
                _this.onFocusFirstElement = null;
                _this.tabItems.each(function (tabItem) {
                    tabItem.dispose();
                });
                if (_this.tabs) {
                    _this.tabs.tabs("destroy");
                    _this.tabs.off();
                    if (_this.tabBarContainer && _this.tabItemsContainer) {
                        _this.tabItemsContainer.removeData();
                        _this.tabItemsContainer.remove();
                        _this.tabBarContainer.remove();
                        _this.tabItemsContainer = null;
                        _this.tabBarContainer = null;
                    }
                    if (_this.tabsPanels) {
                        for (var i = 0; i < _this.tabsPanels.length; i++) {
                            _this.tabsPanels[i].remove();
                            _this.tabsPanels[i] = null;
                        }
                        _this.tabsPanels = [];
                    }
                    _this.getElement().empty();
                    _this.tabs.remove();
                    _this.tabs = null;
                    _this.tabItems = null;
                }
            }, "Dispose the tabs");
        };
        /** the arrow key navigation should behave as the following:
           - by using arrow keys we only move throygh the tabs (without activating the tab that we focus on)
           - only when we press enter we activate the selected tab */
        TabControl.prototype.setupKeyboardNavigation = function (element) {
            var _this = this;
            element.on("keydown", function (e) {
                var keyPressed = e.which || e.keyCode;
                var nextElement;
                if (_this.internalTabulationEnabled && keyPressed === KeyCodes.Tab && e.shiftKey) {
                    nextElement =
                        element.length === 0
                            ? _this.tabBarContainer.children("li").last()
                            : element.prevAll(":visible").first();
                    if (nextElement.length === 0) {
                        return;
                    }
                    else {
                        e.preventDefault();
                        e.stopImmediatePropagation();
                        _this.focusNextElement(nextElement);
                        return;
                    }
                }
                if (_this.internalTabulationEnabled && keyPressed === KeyCodes.Tab) {
                    nextElement =
                        element.length === 0
                            ? _this.tabBarContainer.children("li").first()
                            : element.nextAll(":visible").first();
                    if (nextElement.length === 0) {
                        return;
                    }
                    else {
                        e.preventDefault();
                        e.stopImmediatePropagation();
                        _this.focusNextElement(nextElement);
                        return;
                    }
                }
                // prettier-ignore
                if (keyPressed === KeyCodes.Up || keyPressed === KeyCodes.Down || keyPressed === KeyCodes.Left || keyPressed === KeyCodes.Right) { // tslint:disable-line
                    e.stopImmediatePropagation();
                    e.preventDefault();
                }
                if (keyPressed === KeyCodes.Up || keyPressed === KeyCodes.Left) {
                    nextElement =
                        element.length === 0
                            ? _this.tabBarContainer.children("li").last()
                            : element.prevAll(":visible").first();
                    _this.focusNextElement(nextElement);
                    return;
                }
                if (keyPressed === KeyCodes.Right || keyPressed === KeyCodes.Down) {
                    nextElement =
                        element.length === 0
                            ? _this.tabBarContainer.children("li").first()
                            : element.nextAll(":visible").first();
                    _this.focusNextElement(nextElement);
                    return;
                }
            });
        };
        TabControl.prototype.focusNextElement = function (nextElement) {
            if (Editor.CommonUtils.isEdge()) {
                nextElement.children("." + Editor.CommonConstants.designerTabContainer).focus();
            }
            else {
                nextElement.focus();
            }
        };
        TabControl.prototype.renderContainer = function () {
            var container = this.getElement();
            container.hide();
            this.tabItemsContainer = $("<ul>");
            this.tabsPanels = this.renderTabsPanel();
            var tabBarContainerStyle = !this.tabBarRightAreaId ? "" : "display: flex; justify-content: space-between;";
            this.tabBarContainer = $("<div style=\"" + tabBarContainerStyle + "\"/>");
            container.append(this.tabBarContainer);
            container.append(this.tabsPanels);
            var leftTabsBox = $("<div />");
            this.tabBarContainer.append(leftTabsBox);
            leftTabsBox.append(this.tabItemsContainer);
            if (!!this.tabBarRightAreaId) {
                var rightTabsBox = $("<div id=\"" + this.tabBarRightAreaId + "\"/>");
                this.tabBarContainer.append(rightTabsBox);
            }
        };
        TabControl.prototype.initializeControl = function () {
            var _this = this;
            this.tabs = this.getElement().tabs();
            if (!Utility.isNullOrUndefined(this.tabButtonsContainerId)) {
                // Moves the tabs container to the tabButtons container after initialization the tabs.
                Editor.CommonUtils.getById(this.tabButtonsContainerId).append(this.tabBarContainer);
            }
            this.getElement().show();
            this.tabItems.each(function (tabItem) {
                if (!Utility.isNullOrUndefined(_this.tabVisibilityManager)) {
                    _this.hideTab(tabItem);
                }
                tabItem.init();
            });
        };
        TabControl.prototype.activateTabById = function (id) {
            var tabIndex = this.getTabButton(id).index();
            this.activateTabByIndex(tabIndex);
        };
        TabControl.prototype.activateTabByIndex = function (tabIndex) {
            // deactivate all tabs first
            this.tabItems.each(function (item, index) {
                if (index !== tabIndex) {
                    item.deactivate();
                }
            });
            var toActivate = this.tabItems.items()[tabIndex];
            toActivate.activate();
            this.notifyTabActivated(tabIndex);
            this.selectedTab = toActivate;
            this.eventBroker.notify(Editor.TabControlEventConstants.tabsStateUpdated);
        };
        TabControl.prototype.notifyTabActivated = function (index) {
            var activatedTab = this.tabsPanels[index];
            if (this.onTabActivate != null) {
                this.onTabActivate(activatedTab);
            }
        };
        TabControl.prototype.renderTabsPanel = function () {
            var _this = this;
            var tabsPanels = [];
            var tabItemRepresentations = [];
            this.tabItems.each(function (currentItem, index) {
                var tabItemRepresentation = $("<li/>");
                var anchor = $("<a/>");
                anchor.attr("href", "#" + currentItem.tabContentElementId);
                anchor.attr("aria-label", currentItem.caption);
                if (currentItem.tabContentElementDataId && currentItem.tabContentElementDataId !== "") {
                    tabItemRepresentation.attr(Editor.Contract.idAttrName, currentItem.tabContentElementDataId);
                    anchor.attr(Editor.Contract.dataIdAttrName, currentItem.tabContentElementDataId);
                }
                // We hide the anchor tag because giving it focus causes
                // Windows Narrator to treat it as a URL (correctly), which is
                // undesirable because it reads out the entire URL.
                anchor.addClass(Editor.CommonConstants.designerTabAnchor);
                anchor.click(function (event) {
                    _this.selectTab(currentItem.tabContentElementId);
                    _this.setAriaSelectedOnPanel(tabItemRepresentation, fauxTab, tabItemRepresentations);
                });
                var fauxTab = $("<div/>");
                //The ARIA tab role indicates an interactive element inside a tablist that, when activated, displays its associated tabpanel.
                // <button role="tab" aria-selected="true" aria-controls="tabpanel-id" id="tab-id">Tab label</button>
                // When we use tab role on an element, it
                //  1) indicates the element serves as a tab control.
                //  2) When focused, is automatically activated, causing its associated tabpanel to be displayed.
                //  3) Provides a title for its associated tabpanel.
                // In this case, the role="tab" and "aria-selected" is already being set in the parent <li> element of this div. Hence, since there are 2 elements nested within each other with the role="tab" property - this causes the narrator/screen-reader to read both selected and non selected elements
                // When we tab/focus on Designer tab - the <li> element is selected and has role="tab" - screen reader reads out - the nested <div> also has a role="tab" causing the narrator to read out the unselected elements as well - instead of just the selected ones.
                // Removing this property for only the nested div as a part of A11y bugs -  https://dynamicscrm.visualstudio.com/OneCRM/_workitems/edit/1482457/ and https://dynamicscrm.visualstudio.com/OneCRM/_workitems/edit/1482449/
                // fauxTab.attr("role", "tab");
                // On IE, we give the inner div the focus to prevent issues
                // with narrator blocking the OnEnter event when the li element
                // is focused. This is required to allow the div to
                // recieve focus.
                fauxTab.attr("tabindex", "-1");
                fauxTab.addClass(Editor.CommonConstants.designerTabContainer);
                // Needed explicity for Edge, otherwise keyboard focus
                // outline is not displayed for some tab headers
                fauxTab.css("outline-color", "#666666");
                tabItemRepresentation.css("outline-color", "#666666");
                fauxTab.click(function (event) {
                    _this.selectTab(currentItem.tabContentElementId);
                    _this.setAriaSelectedOnPanel(tabItemRepresentation, fauxTab, tabItemRepresentations);
                });
                var span = $("<span/>");
                span.addClass(Editor.CommonConstants.designerTabPaneLabel + " ellipsis");
                fauxTab.append(span);
                tabItemRepresentation.append(fauxTab);
                tabItemRepresentation.append(anchor);
                // prettier-ignore
                if (index == 0) { // tslint:disable-line
                    fauxTab.attr("aria-selected", "true");
                    tabItemRepresentation.attr("aria-selected", "true");
                }
                tabItemRepresentation
                    .find("." + Editor.CommonConstants.designerTabPaneLabel)
                    .attr("title", currentItem.caption)
                    .text(currentItem.caption);
                tabItemRepresentation.off().on("keydown", function (e) {
                    var key = e.which || e.keyCode || 0;
                    if (key === 13) {
                        // we need to prevent internal jquery event listener from processing enter key if we want to focus into tab content (iframe)
                        // otherwise, we will experience switching to previous tabs as a focus will be on an unexpected (for jquery) element (iframe)
                        e.preventDefault();
                        e.stopImmediatePropagation();
                        _this.selectTab(currentItem.tabContentElementId);
                        _this.setAriaSelectedOnPanel(tabItemRepresentation, fauxTab, tabItemRepresentations);
                        if (!Utility.isNullOrUndefined(_this.selectedTab)) {
                            _this.selectedTab.focus();
                        }
                    }
                });
                tabItemRepresentations.push(tabItemRepresentation);
                _this.setupKeyboardNavigation(tabItemRepresentation);
                _this.tabItemsContainer.append(tabItemRepresentation);
                var divContainer = $('<div id="' + currentItem.tabContentElementId + '"></div>');
                if (currentItem.tabContentElementStyle) {
                    tabItemRepresentation
                        .find("div")
                        .addClass(Editor.CommonConstants.tabButtonPreClassName + currentItem.tabContentElementStyle);
                    divContainer.addClass(currentItem.tabContentElementStyle);
                }
                tabsPanels.push(divContainer);
            });
            return tabsPanels;
        };
        TabControl.prototype.setAriaSelectedOnPanel = function (selectedTabRepresentation, selectedTab, tabItemRepresentations) {
            tabItemRepresentations.forEach(function (tabItemRep) {
                tabItemRep.attr("aria-selected", "false");
                tabItemRep.children("." + Editor.CommonConstants.designerTabContainer).attr("aria-selected", "false");
            });
            selectedTab.attr("aria-selected", "true");
            selectedTabRepresentation.attr("aria-selected", "true");
        };
        TabControl.prototype.activateFirstTab = function () {
            var firstTab = this.tabItems.firstOrDefault();
            if (!Utility.isNullOrUndefined(firstTab)) {
                firstTab.activate();
                this.selectedTab = firstTab;
                this.notifyTabActivated(0);
            }
        };
        TabControl.prototype.showTab = function (tabItem) {
            var tabButton = this.getTabButton(tabItem.tabContentElementId);
            var index = tabButton.index();
            if (index !== -1) {
                if (index === this.getSelectedTabIndex()) {
                    Editor.CommonUtils.getById(tabItem.tabContentElementId).show();
                }
                tabButton.show();
            }
        };
        TabControl.prototype.hideTab = function (tabItem) {
            var tabButton = this.getTabButton(tabItem.tabContentElementId);
            var index = tabButton.index();
            if (index !== -1) {
                Editor.CommonUtils.getById(tabItem.tabContentElementId).hide();
                tabButton.hide();
            }
        };
        TabControl.prototype.selectTab = function (id, activate) {
            var _this = this;
            if (activate === void 0) { activate = true; }
            var tabIndex = this.getTabIndex(id);
            this.tabs.tabs({
                activate: function (_, ui) {
                    if (_this.onTabActivate != null) {
                        _this.onTabActivate(ui.newPanel);
                    }
                    if (activate) {
                        _this.activateTabById(id);
                    }
                },
                active: tabIndex
            });
        };
        TabControl.prototype.getTabButton = function (id) {
            return $(String.Format("[aria-controls={0}]", id));
        };
        TabControl.prototype.getSelectedTabIndex = function () {
            return this.tabs.tabs("option", "active");
        };
        TabControl.prototype.selectedTabIsVisible = function () {
            return this.tabItems.items()[this.getSelectedTabIndex()].isEnabled();
        };
        TabControl.prototype.getTabIndex = function (id) {
            return this.getTabButton(id).index();
        };
        TabControl.prototype.getFirstVisibleTab = function () {
            var visibleTabs = [];
            this.tabItems.each(function (tabItem) {
                if (tabItem.isEnabled()) {
                    visibleTabs.push(tabItem);
                }
            });
            return visibleTabs[0];
        };
        TabControl.prototype.focusFirstElement = function () {
            // Focus on first visible tab
            var firstVisibleElement = this.tabItemsContainer.find("li:visible:first a");
            // If first visible element exist and current tabs is menu bar tabs then focus the first element
            if (firstVisibleElement.length !== 0 && this.tabBarContainer.parent().is(".menuBar")) {
                $(firstVisibleElement).focus();
                this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerReady, this.onFocusFirstElement);
                this.onFocusFirstElement = null;
            }
        };
        return TabControl;
    }(Editor.Control));
    Editor.TabControl = TabControl;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /** Data class for the image element */
    var ImageData = /** @class */ (function () {
        function ImageData() {
        }
        return ImageData;
    }());
    Editor.ImageData = ImageData;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /** Data class for the link element */
    var LinkData = /** @class */ (function () {
        function LinkData() {
        }
        LinkData.prototype.getAttributes = function () {
            var attrs = {
                href: this.href
            };
            if (!!this.target) {
                attrs["target"] = this.target;
            }
            return attrs;
        };
        return LinkData;
    }());
    Editor.LinkData = LinkData;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var DelayScheduler = MktSvc.Controls.Common.DelayScheduler;
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    /**
     * Editor control class that is responsible for putting all components together (views - property, styles, toolbox, content editor).
     */
    var EditorControl = /** @class */ (function () {
        function EditorControl(executionContext, layoutRenderer, layoutConfiguration, controls, eventBroker, editorContentModel, keyboardCommandManager, undoRedoManager, accessibilityInstructionsPopup, externalFocusElements, editorFeatureServiceClient) {
            var _this = this;
            this.isFullscreen = false;
            this.externalFocusElements = ["#closeButton"];
            this.onMaximizeExecuted = function (eventArgs) {
                _this.isFullscreen = eventArgs.isFullscreen;
            };
            this.controls = controls;
            this.layoutRenderer = layoutRenderer;
            this.layoutConfiguration = layoutConfiguration;
            this.eventBroker = eventBroker;
            this.undoRedoManager = undoRedoManager;
            this.editorContentModel = editorContentModel;
            this.keyboardCommandManager = keyboardCommandManager;
            this.executionContext = executionContext;
            this.accessibilityInstructionsPopup = accessibilityInstructionsPopup;
            Editor.CommonUtils.localizationProvider = executionContext.getLocalizationProvider();
            DelayScheduler.defaultSchedulerDelay = executionContext.getDelaySchedulerTime();
            if (externalFocusElements) {
                this.externalFocusElements = this.externalFocusElements.concat(externalFocusElements);
            }
            this.editorFeatureServiceClient = editorFeatureServiceClient;
        }
        EditorControl.prototype.init = function (container) {
            var _this = this;
            this.container = container;
            this.keyboardCommandManager.init(container);
            this.layoutRenderer.render(container, this.layoutConfiguration);
            this.controls.each(function (control) { return control.init(_this.eventBroker); });
            this.editorContentModel.init();
            this.undoRedoManager.init(this);
            this.regsterGlobalShortcuts();
            this.registerGlobalKeyEvent();
            this.adjustEditorStyling();
            this.eventBroker.subscribe(Editor.EventConstants.maximizeExecuted, this.onMaximizeExecuted);
            if (Editor.CommonUtils.isIOS() && Utility.isNullOrUndefined(this.onEditorVisibilityChanged)) {
                this.eventBroker.subscribe(Editor.EventConstants.editorVisibilityChanged, (this.onEditorVisibilityChanged = function (eventArgs) {
                    if (eventArgs.isVisible) {
                        // Trigger click on IOS to prevent issue with page reloading after clicking on JQueryUI tab elements.
                        _this.container.click();
                        _this.eventBroker.unsubscribe(Editor.EventConstants.editorVisibilityChanged, _this.onEditorVisibilityChanged);
                    }
                }));
            }
        };
        EditorControl.prototype.setContent = function (content, sourceId, notifyOutput, forceUpdate) {
            var _this = this;
            if (notifyOutput === void 0) { notifyOutput = true; }
            if (forceUpdate === void 0) { forceUpdate = false; }
            return this.editorContentModel.setContent(content, sourceId, "editorControl", forceUpdate, notifyOutput).then(function (isContentChanged) {
                if (isContentChanged) {
                    var eventArgs = new Editor.ContentChangedEventArgs(content, sourceId, null, null, notifyOutput);
                    _this.eventBroker.notify(Editor.EventConstants.contentChanged, eventArgs);
                }
                return isContentChanged;
            });
        };
        EditorControl.prototype.getContent = function () {
            return this.editorContentModel.getContent();
        };
        EditorControl.prototype.getEventBroker = function () {
            return this.eventBroker;
        };
        EditorControl.prototype.adjustEditorStyling = function () {
            var designSection = $("section[data-id='DesignSection']");
            //Removing border and padding around email editor injected by UCI
            designSection.css({
                "border-width": "0",
                "padding-left": "0",
                "padding-right": "0"
            });
        };
        EditorControl.prototype.regsterGlobalShortcuts = function () {
            var _this = this;
            this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.zeroKey, [KeyboardModifierType.Alt], function () {
                _this.accessibilityInstructionsPopup.show(document.activeElement);
            }));
        };
        EditorControl.prototype.registerGlobalKeyEvent = function () {
            var _this = this;
            if (!this.onKeyUpEventFired) {
                $(document).on("keyup", (this.onKeyUpEventFired = function (event) {
                    // Set focus inside control if editor in full screen mode and active element outside the editor control
                    if (_this.isFullscreen &&
                        event.keyCode === MktSvc.Controls.Common.KeyCodes.Tab &&
                        !_this.isActiveElementInsideControl() &&
                        !_this.externalFocusElements.some(function (selector) { return $(document.activeElement).is(selector); })) {
                        if (event.shiftKey) {
                            _this.getTabbableElements()
                                .last()
                                .focus();
                        }
                        else {
                            _this.getTabbableElements()
                                .first()
                                .focus();
                        }
                    }
                }));
            }
        };
        EditorControl.prototype.isActiveElementInsideControl = function () {
            return this.container.has(document.activeElement).length > 0;
        };
        EditorControl.prototype.getTabbableElements = function () {
            return this.container.find(":tabbable");
        };
        EditorControl.prototype.dispose = function () {
            var _this = this;
            this.executionContext.tryExecute(function () {
                if (_this.onEditorVisibilityChanged) {
                    _this.eventBroker.unsubscribe(Editor.EventConstants.editorVisibilityChanged, _this.onEditorVisibilityChanged);
                }
                if (_this.onKeyUpEventFired) {
                    $(document).off("keyup", _this.onKeyUpEventFired);
                }
                _this.eventBroker.unsubscribe(Editor.EventConstants.maximizeExecuted, _this.onMaximizeExecuted);
                _this.accessibilityInstructionsPopup.dispose();
                _this.layoutRenderer.dispose();
                _this.controls.each(function (control) { return control.dispose(); });
                _this.undoRedoManager.dispose();
                _this.editorContentModel.dispose();
                _this.keyboardCommandManager.dispose();
                _this.eventBroker.dispose();
            }, "Dispose the editor control");
            this.executionContext.dispose();
            if (this.container) {
                this.container.empty();
            }
            this.container = null;
            this.controls = null;
            this.layoutRenderer = null;
            this.layoutConfiguration = null;
            this.undoRedoManager = null;
            this.editorContentModel = null;
            this.keyboardCommandManager = null;
            this.eventBroker = null;
            this.executionContext = null;
            this.onEditorVisibilityChanged = null;
            this.onKeyUpEventFired = null;
        };
        EditorControl.editorContolInitCollection = "Editor Init";
        return EditorControl;
    }());
    Editor.EditorControl = EditorControl;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var OfflineNotSupportedPreviewView = /** @class */ (function (_super) {
        __extends(OfflineNotSupportedPreviewView, _super);
        function OfflineNotSupportedPreviewView(previewContainerId) {
            var _this = _super.call(this, previewContainerId) || this;
            _this.id = previewContainerId;
            return _this;
        }
        OfflineNotSupportedPreviewView.prototype.init = function () { };
        OfflineNotSupportedPreviewView.prototype.activate = function () {
            _super.prototype.activate.call(this);
            this.render();
        };
        OfflineNotSupportedPreviewView.prototype.dispose = function () {
            this.getElement().empty();
        };
        OfflineNotSupportedPreviewView.prototype.render = function () {
            if (this.isActive) {
                var element = this.getElement().empty();
                var offlineErrorMessageContainer = $("<p>")
                    .text(Editor.CommonUtils.getOfflineLocalizedString(OfflineNotSupportedPreviewView.offlineErrorMessage))
                    .addClass(Editor.CommonConstants.editorReadonlyTitleClassName);
                element.append(offlineErrorMessageContainer);
            }
        };
        OfflineNotSupportedPreviewView.offlineErrorMessage = "[OfflineErrorMessage]";
        return OfflineNotSupportedPreviewView;
    }(Editor.Control));
    Editor.OfflineNotSupportedPreviewView = OfflineNotSupportedPreviewView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var OfflineBrowserPreviewView = /** @class */ (function (_super) {
        __extends(OfflineBrowserPreviewView, _super);
        function OfflineBrowserPreviewView(previewContainerId, executionContext) {
            var _this = _super.call(this, previewContainerId) || this;
            _this.isDirty = true;
            _this.previewResizePostMessageDelay = 100;
            _this.contentChangedHandler = function (eventArgs) {
                if (_this.html === eventArgs.html) {
                    return;
                }
                _this.getElement().empty();
                _this.setContent(eventArgs.html);
            };
            _this.id = previewContainerId;
            _this.executionContext = executionContext;
            _this.contentSanitizer = executionContext.getContentSanitizer();
            return _this;
        }
        OfflineBrowserPreviewView.prototype.init = function (eventBroker) {
            this.eventBroker = eventBroker;
            this.eventBroker.subscribe(Editor.EventConstants.contentResolved, this.contentChangedHandler);
        };
        OfflineBrowserPreviewView.prototype.activate = function () {
            _super.prototype.activate.call(this);
            this.render();
        };
        OfflineBrowserPreviewView.prototype.dispose = function () {
            if (this.eventBroker) {
                this.eventBroker.unsubscribe(Editor.EventConstants.contentResolved, this.contentChangedHandler);
            }
            $(window).off("resize", this.setPreviewContentSize);
            $(this.iframe).off();
            $(this.iframe).remove();
            this.iframe = null;
            this.getElement().empty();
        };
        OfflineBrowserPreviewView.prototype.setContent = function (html) {
            this.html = html;
            this.refreshView();
        };
        OfflineBrowserPreviewView.prototype.render = function () {
            if (this.isActive && this.isDirty) {
                this.setupContent(this.html);
            }
        };
        OfflineBrowserPreviewView.prototype.onContentSetupCompleted = function () {
            this.isDirty = false;
            this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.id));
        };
        OfflineBrowserPreviewView.prototype.setupContent = function (content) {
            var _this = this;
            var element = this.getElement().empty();
            var iframe = document.createElement("iframe");
            $(iframe)
                .addClass(Editor.BrowserPreviewConstants.browserPreviewFrameClassName)
                .addClass(Editor.BrowserPreviewConstants.tabletPortraitPreviewCssClass);
            var frameContainer = $("<div>")
                .addClass(Editor.BrowserPreviewConstants.browserPreviewFrameContainerCssClass)
                .addClass(Editor.BrowserPreviewConstants.tabletPortraitPreviewCssClass)
                .addClass(Editor.BrowserPreviewConstants.lightweightMode);
            var frameBorder = $("<div>")
                .addClass(Editor.BrowserPreviewConstants.browserPreviewFrameBorderClassName)
                .addClass(Editor.BrowserPreviewConstants.tabletPortraitPreviewCssClass);
            Editor.CommonUtils.setTabIndex(frameBorder, 0);
            if (Editor.CommonUtils.isIOS()) {
                frameContainer.addClass(Editor.CommonConstants.iosScrollClassName);
            }
            var previewContent = $("<div>").addClass(Editor.BrowserPreviewConstants.browserPreviewContentCssClass);
            var contentWarning = $("<span>")
                .addClass(Editor.BrowserPreviewConstants.browserPreviewContentTitleCssClass)
                .addClass(Editor.BrowserPreviewConstants.browserPreviewContentTitleWarningCssClass)
                .text(Editor.CommonUtils.getOfflineLocalizedString(OfflineBrowserPreviewView.offlineWarningMessage));
            frameContainer.append(frameBorder);
            previewContent.append(contentWarning);
            previewContent.append(frameContainer);
            element.append(previewContent);
            frameBorder.append($(iframe));
            $(window).on("resize", this.setPreviewContentSize);
            this.setPreviewContentSize();
            var isRtl = this.executionContext.getLocalizationProvider().isRtl();
            this.contentSanitizer.init(function () {
                _this.contentSanitizer.getSanitizedContent(content, function (sanitized) {
                    var contentFrame = Editor.CommonUtils.getByClass(Editor.BrowserPreviewConstants.browserPreviewFrameClassName).get(0);
                    if (contentFrame) {
                        Editor.CommonUtils.writeFrameContent(contentFrame, sanitized.html());
                        contentFrame.tabIndex = -1;
                        $(sanitized).remove();
                        if (isRtl) {
                            Editor.CommonUtils.getBySelector("html", $(iframe).contents()).attr("dir", "rtl");
                        }
                        setTimeout(function () {
                            if (_this.iframe && _this.iframe.contentDocument && _this.iframe.contentDocument.body) {
                                var contentHeight = _this.iframe.contentDocument.body.getClientRects()[0].top +
                                    _this.iframe.contentDocument.body.getClientRects()[0].bottom;
                                _this.resizeIframe(contentHeight);
                            }
                        }, _this.previewResizePostMessageDelay);
                        // Timeout needed for IE and Edge, because sometimes "load" event fired when content height is not calculated
                        $(_this.iframe)
                            .contents()
                            .find("img")
                            .each(function (index, image) {
                            $(image).one("load", function () {
                                var contentHeight = _this.iframe.contentDocument.body.getClientRects()[0].top +
                                    _this.iframe.contentDocument.body.getClientRects()[0].bottom;
                                _this.resizeIframe(contentHeight);
                            });
                        });
                        _this.onContentSetupCompleted();
                    }
                });
            });
        };
        OfflineBrowserPreviewView.prototype.setPreviewContentSize = function () {
            var frameContainer = $("." + Editor.BrowserPreviewConstants.browserPreviewFrameContainerCssClass + ":visible");
            var contentTitle = $("." + Editor.BrowserPreviewConstants.browserPreviewContentTitleCssClass + ":visible");
            if (frameContainer.length) {
                // Change title width manually (required for IE)
                contentTitle.width(frameContainer.width() - 50); // tslint:disable-line
            }
        };
        OfflineBrowserPreviewView.prototype.resizeIframe = function (contentHeight) {
            if (contentHeight === $(this.iframe).height()) {
                return;
            }
            var browserPreviewFrameBorder = $("." + Editor.BrowserPreviewConstants.browserPreviewFrameBorderClassName + ":visible");
            // PreviewFrameBorder padding + PreviewFrameBorder border height + iframe border height
            var previewFrameOffset = browserPreviewFrameBorder.innerHeight() -
                browserPreviewFrameBorder.height() +
                (browserPreviewFrameBorder.outerHeight() - browserPreviewFrameBorder.innerHeight()) +
                ($(this.iframe).outerHeight() - $(this.iframe).innerHeight());
            var frameContainerHeight = $("." + Editor.BrowserPreviewConstants.browserPreviewFrameContainerCssClass + ":visible").height() -
                previewFrameOffset;
            if (frameContainerHeight < contentHeight) {
                $(this.iframe).height(contentHeight);
            }
            else {
                $(this.iframe).height(frameContainerHeight);
            }
        };
        OfflineBrowserPreviewView.prototype.refreshView = function () {
            this.isDirty = true;
            if (this.isActive) {
                this.render();
            }
        };
        OfflineBrowserPreviewView.offlineWarningMessage = "[OfflineWarningMessage]";
        return OfflineBrowserPreviewView;
    }(Editor.Control));
    Editor.OfflineBrowserPreviewView = OfflineBrowserPreviewView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var HeaderItemDescription = /** @class */ (function () {
        function HeaderItemDescription(titleDescription, icons) {
            this.titleDescription = titleDescription;
            this.icons = icons;
        }
        return HeaderItemDescription;
    }());
    Editor.HeaderItemDescription = HeaderItemDescription;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var IconDescription = /** @class */ (function () {
        function IconDescription(src, cssClass, cssClassForIframe, altTextForImage, title, elementId) {
            if (elementId === void 0) { elementId = ""; }
            this.src = src;
            this.cssClass = cssClass;
            this.cssClassForIframe = cssClassForIframe;
            this.altTextForImage = altTextForImage;
            this.title = title;
            this.elementId = elementId;
        }
        return IconDescription;
    }());
    Editor.IconDescription = IconDescription;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TitleDescription = /** @class */ (function () {
        function TitleDescription(title, cssClass) {
            this.title = title;
            this.cssClass = cssClass;
        }
        return TitleDescription;
    }());
    Editor.TitleDescription = TitleDescription;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    var BrowserPreviewView = /** @class */ (function (_super) {
        __extends(BrowserPreviewView, _super);
        function BrowserPreviewView(previewContainerId, showHeader, loadingModal, keyboardCommandManager, executionContext, basicPreviewProvider, defaultIcon, accessibilityInstructions, abTestingContext, editorFeatureServiceClient, metadataParser) {
            var _this = _super.call(this, previewContainerId) || this;
            _this.abTestingContext = abTestingContext;
            _this.editorFeatureServiceClient = editorFeatureServiceClient;
            _this.metadataParser = metadataParser;
            _this.enterKeyCode = 13;
            _this.isDirty = true;
            _this.sandboxAttributes = "allow-scripts";
            _this.linkSandboxAttribute = "allow-popups allow-popups-to-escape-sandbox";
            _this.setRtlMessage = "setRtl";
            _this.getHeightMessage = "getHeight";
            _this.setHeightMessage = "setHeight";
            _this.setContentMessage = "setContent";
            _this.setIsShimAppMessage = "setIsShimApp";
            _this.setLangMessage = "setLang";
            _this.enableLinksMessage = "enableLinks";
            _this.previewResizePostMessageDelay = 100;
            _this.onIconSelected = function (iconDescription, allPreviewCssClasses) {
                _this.changeBrowserPreviewIframeCssClasses(iconDescription.cssClassForIframe, allPreviewCssClasses);
                _this.changeActiveIcon(iconDescription.cssClass);
                _this.changeIFrameHeight();
                _this.eventBroker.notify(Editor.EventConstants.basicPreviewModeSwitched);
            };
            _this.contentChangedHandler = function (eventArgs) {
                _this.getElement().empty();
                _this.setContent(eventArgs.html);
            };
            _this.contentResolvedHandler = function (eventArgs) {
                if (eventArgs && eventArgs.sourceId === Editor.BrowserPreviewConstants.lightweightMode) {
                    _this.contentChangedHandler(eventArgs);
                }
            };
            _this.subjectContentChangedHandler = function (eventArgs) {
                if (_this.subject !== eventArgs.subjectValue && _this.showHeader) {
                    _this.getElement().empty();
                    _this.setSubjectContent(eventArgs.subjectValue);
                }
            };
            _this.refreshView = function () {
                _this.isDirty = true;
                if (_this.isActive) {
                    _this.loadingModal.addLoadingModal();
                    _this.render();
                }
            };
            _this.defaultIcon =
                defaultIcon ||
                    new Editor.IconDescription(Editor.BrowserPreviewConstants.tabletPortraitIcon, Editor.BrowserPreviewConstants.tabletPortraitPreviewIconCssClass, Editor.BrowserPreviewConstants.tabletPortraitPreviewCssClass, Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.tabletPortraitPreviewIconAltText), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.tabletPortraitPreviewIconTitle), Editor.BrowserPreviewConstants.tabletPortraitPreviewId);
            _this.id = previewContainerId;
            _this.showHeader = showHeader;
            _this.loadingModal = loadingModal;
            _this.keyboardCommandManager = keyboardCommandManager;
            _this.basicPreviewProvider = basicPreviewProvider;
            _this.executionContext = executionContext;
            _this.contentSanitizer = executionContext.getContentSanitizer();
            _this.accessibilityInstructions = accessibilityInstructions;
            _this.registeredKeyboardCommands = [];
            return _this;
        }
        BrowserPreviewView.prototype.init = function (eventBroker) {
            this.eventBroker = eventBroker;
            this.eventBroker.subscribe(Editor.EventConstants.contentFinalized, this.contentChangedHandler);
            this.eventBroker.subscribe(Editor.EventConstants.contentResolved, this.contentResolvedHandler);
            this.eventBroker.subscribe(Editor.EventConstants.emailSubjectValueChanged, this.subjectContentChangedHandler);
            if (!Utility.isNullOrUndefined(this.basicPreviewProvider)) {
                this.basicPreviewProvider.init(eventBroker, this.refreshView);
            }
            this.loadingModal.init(this.getElement(), this.eventBroker);
            this.activeIcon = this.defaultIcon;
            this.registerGlobalKeyboardShortcuts();
        };
        BrowserPreviewView.prototype.addSandboxAttributes = function (sandboxAttribute) {
            if (this.sandboxAttributes.includes(sandboxAttribute)) {
                return;
            }
            this.sandboxAttributes = this.sandboxAttributes.concat(' ', sandboxAttribute);
        };
        BrowserPreviewView.prototype.activate = function () {
            var _this = this;
            this.loadingModal.addLoadingModal();
            _super.prototype.activate.call(this);
            if (!Utility.isNullOrUndefined(this.basicPreviewProvider)) {
                this.basicPreviewProvider.getProviderReadyPromise().done(function () {
                    _this.loadingModal.hide();
                    _this.render();
                });
            }
            else {
                this.render();
            }
            this.registerKeyboardShortcuts();
            Editor.AccessibilityInstructionsPopup.accessibilityInstructions =
                this.accessibilityInstructions || Editor.EditorAccessibilityInstructions.basePreviewAccessibilityInstructions;
        };
        BrowserPreviewView.prototype.deactivate = function () {
            _super.prototype.deactivate.call(this);
            this.unregisterKeyboardShortcuts();
        };
        BrowserPreviewView.prototype.dispose = function () {
            if (this.eventBroker) {
                this.eventBroker.unsubscribe(Editor.EventConstants.contentFinalized, this.contentChangedHandler);
                this.eventBroker.unsubscribe(Editor.EventConstants.contentResolved, this.contentResolvedHandler);
                this.eventBroker.unsubscribe(Editor.EventConstants.emailSubjectValueChanged, this.subjectContentChangedHandler);
            }
            if (this.basicPreviewProvider) {
                this.basicPreviewProvider.dispose();
            }
            if (this.onWindowSizeChanged) {
                $(window).off("resize", this.onWindowSizeChanged);
            }
            if (this.onMessageReceived) {
                window.removeEventListener("message", this.onMessageReceived);
                this.onMessageReceived = null;
            }
            this.onWindowSizeChanged = null;
            $(this.iframe).off();
            $(this.iframe).remove();
            this.iframe = null;
            this.loadingModal.dispose();
            this.getElement().empty();
        };
        BrowserPreviewView.prototype.setContent = function (html) {
            this.html = html;
            this.refreshView();
        };
        BrowserPreviewView.prototype.setSubjectContent = function (subject) {
            this.subject = subject;
            this.refreshView();
        };
        BrowserPreviewView.prototype.render = function () {
            var _this = this;
            if (this.isActive && this.isDirty) {
                var additionalMessageContents = new Editor.AdditionalMessagePreviewContentData();
                additionalMessageContents.SubjectContentData = this.subject;
                if (!MktSvc.Controls.Common.Utility.isNullOrUndefined(this.basicPreviewProvider)) {
                    this.basicPreviewProvider.resolveMessageTemplate(this.html, function (resolvedMessageHTML, resolveAdditionaldMessageContentParts) {
                        _this.setupContent(resolvedMessageHTML, resolveAdditionaldMessageContentParts, function () {
                            return _this.onContentSetupCompleted();
                        });
                    }, additionalMessageContents);
                }
                else {
                    this.setupContent(this.html, additionalMessageContents, function () { return _this.onContentSetupCompleted(); });
                }
            }
        };
        BrowserPreviewView.prototype.onContentSetupCompleted = function () {
            this.isDirty = false;
            this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.id));
            this.eventBroker.notify(Editor.EventConstants.browserPreviewReady, new Editor.ControlRenderedEventArgs(this.id));
        };
        BrowserPreviewView.prototype.setupContent = function (content, additionalContentParts, onContentSetupCompleted) {
            var _this = this;
            var element = this.getElement().empty();
            this.iframe = document.createElement("iframe");
            Editor.IframeDecorator.applyCustomization(element, this.iframe);
            var $iframe = $(this.iframe);
            var localizationProvider = this.executionContext.getLocalizationProvider();
            $iframe.find("html").attr("lang", localizationProvider.getLanguageName());
            $iframe
                .addClass(Editor.BrowserPreviewConstants.browserPreviewFrameClassName)
                .addClass(this.activeIcon.cssClassForIframe)
                .attr("title", Editor.BrowserPreviewConstants.browserPreviewIframeTitle);
            var frameContainer = $("<div>")
                .addClass(Editor.BrowserPreviewConstants.browserPreviewFrameContainerCssClass)
                .addClass(this.activeIcon.cssClassForIframe)
                .addClass(this.showHeader ? Editor.BrowserPreviewConstants.editorMode : Editor.BrowserPreviewConstants.lightweightMode);
            var frameBorder = $("<div>")
                .addClass(Editor.BrowserPreviewConstants.browserPreviewFrameBorderClassName)
                .addClass(this.activeIcon.cssClassForIframe);
            Editor.CommonUtils.setTabIndex(frameBorder, 0);
            if (Editor.CommonUtils.isIOS()) {
                frameContainer.addClass(Editor.CommonConstants.iosScrollClassName);
            }
            if (this.showHeader) {
                element.append(this.createHeaderElements());
            }
            var previewContent = $("<div>").addClass(Editor.BrowserPreviewConstants.browserPreviewContentCssClass);
            var previewContentHeader = $("<div>").addClass(Editor.BrowserPreviewConstants.browserPreviewHeaderContrainerCssClass);
            var warningText = localizationProvider.getLocalizedString(Editor.BrowserPreviewConstants.browserPreviewContentTitle);
            if (this.executionContext.shouldLinksBeEnabled()) {
                warningText = warningText + " " + localizationProvider.getLocalizedString(Editor.BrowserPreviewConstants.browserPreviewLinkWarning);
            }
            var contentWarning = $("<div>")
                .addClass(Editor.BrowserPreviewConstants.browserPreviewContentTitleCssClass)
                .addClass("previewIcon")
                .addClass("infoIcon")
                .text(warningText);
            previewContentHeader.append(contentWarning);
            if (this.shouldShowPostProcessingWaring()) {
                var postProcessingWarning = $("<div>")
                    .addClass(Editor.BrowserPreviewConstants.browserPreviewContentTitleCssClass)
                    .addClass("previewIcon")
                    .addClass("warningIcon")
                    .text(localizationProvider.getLocalizedString("[Warning for HTMLPOSTPROCESSING]"));
                previewContentHeader.append(postProcessingWarning);
            }
            frameContainer.append(previewContentHeader);
            frameContainer.append(frameBorder);
            if (!Utility.isNullOrUndefined(additionalContentParts)) {
                if (this.showHeader) {
                    frameBorder.append(this.getPreviewSubjectContentDiv(additionalContentParts.SubjectContentData));
                }
            }
            previewContent.append(frameContainer);
            element.append(previewContent);
            if (!this.onWindowSizeChanged) {
                // Use arrow function to save current scope
                $(window).on("resize", (this.onWindowSizeChanged = function () {
                    _this.setPreviewContentSize();
                }));
            }
            this.setPreviewContentSize();
            // We should not apply content if it's null or undefined. Empty content is valid.
            if (Utility.isNullOrUndefined(content)) {
                return;
            }
            if (this.executionContext.shouldPreviewBeSanitized()) {
                // Sanitize content before sending to frame
                this.contentSanitizer.init(function () {
                    _this.contentSanitizer.getSanitizedContent(content, function (sanitized) {
                        var sanitizedContent = sanitized.html();
                        _this.applyContent(sanitizedContent, frameBorder, onContentSetupCompleted);
                    });
                });
            }
            else {
                this.applyContent(content, frameBorder, onContentSetupCompleted);
            }
        };
        BrowserPreviewView.prototype.resolveABTestingContext = function (content) {
            if (!this.abTestingContext) {
                return content;
            }
            var contentDocument = document.implementation.createHTMLDocument("");
            contentDocument.documentElement.innerHTML = content;
            for (var _i = 0, _a = Editor.DomOperation.collectionToArray(contentDocument.body.getElementsByTagName(Editor.AbTestingUtils.constants.tagName.abTesting)); _i < _a.length; _i++) {
                var root = _a[_i];
                Editor.AbTestingUtils.refreshAbTestingVisibility(root, this.abTestingContext);
            }
            return contentDocument.documentElement.innerHTML;
        };
        BrowserPreviewView.prototype.applyContent = function (content, frameContainer, onContentSetupCompleted) {
            var _this = this;
            var isRtl = this.executionContext.getLocalizationProvider().isRtl();
            if (this.executionContext.isSandboxed()) {
                if (String.isNullUndefinedOrWhitespace(this.executionContext.getBasePath())) {
                    this.executionContext
                        .getLogger()
                        .log(MktSvc.Controls.Common.TraceLevel.Error, "Editor.BrowserPreviewView.pathNotSet", new MktSvc.Controls.Common.Dictionary({ Message: "Cdn Path is null or undefined" }));
                }
                else {
                    var basePath_1 = this.executionContext.getBasePath();
                    $(this.iframe).one("load", function () {
                        _this.iframe.contentWindow.postMessage(new Editor.BrowserPreviewMessage(_this.setIsShimAppMessage, _this.executionContext.isShimApp().toString()), "*");
                        _this.iframe.contentWindow.postMessage(new Editor.BrowserPreviewMessage(_this.enableLinksMessage, _this.executionContext.shouldLinksBeEnabled().toString()), "*"); // tslint:disable-line
                        _this.iframe.contentWindow.postMessage(new Editor.BrowserPreviewMessage(_this.setLangMessage, _this.executionContext.getLocalizationProvider().getLanguageName()), "*"); // lang
                        _this.iframe.contentWindow.postMessage(new Editor.BrowserPreviewMessage(_this.setContentMessage, _this.resolveABTestingContext(content)), "*");
                        if (isRtl) {
                            _this.iframe.contentWindow.postMessage(new Editor.BrowserPreviewMessage(_this.setRtlMessage, String.Empty), "*");
                        }
                        if (!_this.onMessageReceived) {
                            window.addEventListener("message", (_this.onMessageReceived = function (event) {
                                // Origin should be null (or iframe domain in IE/Edge) because IFrame is sandboxed
                                if (event.origin === "null" ||
                                    event.origin === Editor.CommonUtils.getDomainFromUrl(basePath_1)) {
                                    if (!event.data || !event.data.message) {
                                        return;
                                    }
                                    var data = event.data;
                                    if (data && data.message === _this.setHeightMessage && data.content) {
                                        // Encode data to prevent possible security issues
                                        var contentHeight = parseFloat($("<div>")
                                            .text(data.content)
                                            .html());
                                        _this.resizeIframe(contentHeight);
                                    }
                                }
                                if (event.data.message === "openURL") {
                                    if (typeof _this.executionContext.openUrl === "function") {
                                        _this.executionContext.openUrl(event.data.content);
                                    }
                                }
                            }));
                        }
                        _this.changeIFrameHeight();
                        onContentSetupCompleted();
                    });
                    var sandboxAttributes = this.sandboxAttributes;
                    if (this.executionContext.shouldLinksBeEnabled()) {
                        sandboxAttributes = sandboxAttributes + " " + this.linkSandboxAttribute;
                    }
                    this.iframe.sandbox = sandboxAttributes;
                    this.iframe.src = basePath_1 + "/Preview/browserPreivewFrame.html";
                    this.iframe.tabIndex = -1;
                    this.iframe.title = this.executionContext.getLocalizationProvider().getLocalizedString("[PREVIEW]");
                    frameContainer.append($(this.iframe));
                }
            }
            else {
                $(this.iframe).one("load", function () {
                    Editor.CommonUtils.writeFrameContent(_this.iframe, content);
                    _this.iframe.tabIndex = -1;
                    if (isRtl) {
                        Editor.CommonUtils.getBySelector("html", $(_this.iframe).contents()).attr("dir", "rtl");
                    }
                    _this.changeIFrameHeight();
                    onContentSetupCompleted();
                });
                frameContainer.append($(this.iframe));
            }
        };
        BrowserPreviewView.prototype.changeIFrameHeight = function () {
            var _this = this;
            if (this.executionContext.isSandboxed()) {
                // Timeout needed for IE and Edge, because sometimes "load" event fired when content height is not calculated
                setTimeout(function () {
                    if (_this.iframe && _this.iframe.contentWindow) {
                        _this.iframe.contentWindow.postMessage(new Editor.BrowserPreviewMessage(_this.getHeightMessage, String.Empty), "*");
                    }
                }, this.previewResizePostMessageDelay);
            }
            else {
                // Timeout needed for IE and Edge, because sometimes "load" event fired when content height is not calculated
                setTimeout(function () {
                    if (_this.iframe &&
                        _this.iframe.contentDocument &&
                        _this.iframe.contentDocument.body &&
                        _this.iframe.contentDocument.body.getClientRects()[0]) {
                        var contentHeight = _this.iframe.contentDocument.body.getClientRects()[0].top +
                            _this.iframe.contentDocument.body.getClientRects()[0].bottom;
                        _this.resizeIframe(contentHeight);
                    }
                }, this.previewResizePostMessageDelay);
                // Resize frame when images are loaded
                $(this.iframe)
                    .contents()
                    .find("img")
                    .each(function (index, image) {
                    $(image).one("load", function () {
                        var contentHeight = _this.iframe.contentDocument.body.getClientRects()[0].top +
                            _this.iframe.contentDocument.body.getClientRects()[0].bottom;
                        _this.resizeIframe(contentHeight);
                    });
                });
            }
        };
        BrowserPreviewView.prototype.resizeIframe = function (contentHeight) {
            var browserPreviewFrameBorder = $("." + Editor.BrowserPreviewConstants.browserPreviewFrameBorderClassName + ":visible");
            // PreviewFrameBorder padding + PreviewFrameBorder border height + iframe border height
            var previewFrameOffset = browserPreviewFrameBorder.innerHeight() -
                browserPreviewFrameBorder.height() +
                (browserPreviewFrameBorder.outerHeight() - browserPreviewFrameBorder.innerHeight()) +
                ($(this.iframe).outerHeight() - $(this.iframe).innerHeight());
            var frameContainerHeight = $("." + Editor.BrowserPreviewConstants.browserPreviewFrameContainerCssClass + ":visible").height() -
                previewFrameOffset;
            // If content height less than frame container size then set 100% height for iframe
            if (frameContainerHeight < contentHeight) {
                // Prevent unnecessary updates
                if (contentHeight !== $(this.iframe).height()) {
                    $(this.iframe).height(contentHeight);
                }
            }
            else {
                $(this.iframe).height(frameContainerHeight);
            }
            this.eventBroker.notify(Editor.EventConstants.previewSizeChanged);
        };
        BrowserPreviewView.prototype.changeBrowserPreviewIframeCssClasses = function (cssClassesToAdd, cssClassesToRemove) {
            this.getElement()
                .find(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.browserPreviewFrameClassName))
                .removeClass(cssClassesToRemove)
                .addClass(cssClassesToAdd);
            this.getElement()
                .find(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.browserPreviewFrameBorderClassName))
                .removeClass(cssClassesToRemove)
                .addClass(cssClassesToAdd);
            this.getElement()
                .find(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.browserPreviewFrameContainerCssClass))
                .removeClass(cssClassesToRemove)
                .addClass(cssClassesToAdd);
        };
        BrowserPreviewView.prototype.setPreviewContentSize = function () {
            var frameContainer = $("." + Editor.BrowserPreviewConstants.browserPreviewFrameContainerCssClass + ":visible");
            if (frameContainer.length) {
                this.changeIFrameHeight();
                if (this.showHeader) {
                    // Change size in accordance with positions including paddings
                    var framePosition = frameContainer.position().top + (frameContainer.innerHeight() - frameContainer.height());
                    frameContainer.css("height", "calc(100% - " + framePosition + "px)");
                }
            }
        };
        BrowserPreviewView.prototype.changeActiveIcon = function (activeIconCssClass) {
            var allIcons = this.getElement().find(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.headerIconCssClass));
            //update aria-label for current selection
            var oldActiveButton = allIcons.filter(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.activeCssClass));
            var unselectedAriaLabel = String.Format("{0}. {1} {2}", oldActiveButton.parent().attr("title"), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.ariaNotSelected), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.ariaOptionToActivate));
            oldActiveButton.parent().attr("aria-label", unselectedAriaLabel);
            // Deactivate all the icons
            allIcons.removeClass(Editor.BrowserPreviewConstants.activeCssClass);
            // Activate only specified icon
            var newActiveButton = allIcons
                .filter(Editor.CommonUtils.getClassSelector(activeIconCssClass))
                .addClass(Editor.BrowserPreviewConstants.activeCssClass);
            var selectedAriaLabel = String.Format("{0}. {1}", newActiveButton.parent().attr("title"), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.ariaSelected));
            newActiveButton.parent().attr("aria-label", selectedAriaLabel);
        };
        BrowserPreviewView.prototype.createHeaderElements = function () {
            var headerDescription = this.getHeaderPreviewTypesDescription();
            return this.createHeaderColumn(headerDescription);
        };
        BrowserPreviewView.prototype.createHeaderColumn = function (headerDescriptions) {
            var _this = this;
            var allPreviewCssClasses = this.getAllPreviewTypeCssClassesForIframe(headerDescriptions);
            var headerColumn = headerDescriptions
                .map(function (headerItemDescription) {
                var headerTitle = $("<span>")
                    .addClass(Editor.BrowserPreviewConstants.headerTitleCssClass)
                    .addClass(headerItemDescription.titleDescription.cssClass)
                    .text(headerItemDescription.titleDescription.title);
                var iconButtons = headerItemDescription.icons
                    .map(function (iconDescription) {
                    var icon = $("<span>")
                        .addClass(Editor.BrowserPreviewConstants.headerIconCssClass)
                        .addClass(iconDescription.cssClass)
                        .addClass(Editor.CommonConstants.editorFontCssClass)
                        .attr("alt", iconDescription.altTextForImage);
                    var buttonContainer = $("<button>")
                        .addClass(Editor.BrowserPreviewConstants.previewButtonContainerCssClass)
                        .attr("title", iconDescription.title)
                        .attr("type", Editor.CommonConstants.buttonType)
                        .keypress(function (e) {
                        if (e.which === _this.enterKeyCode) {
                            _this.onIconSelected(iconDescription, allPreviewCssClasses);
                            _this.activeIcon = iconDescription;
                        }
                    })
                        .on("click", function () {
                        _this.onIconSelected(iconDescription, allPreviewCssClasses);
                        _this.activeIcon = iconDescription;
                    })
                        .append(icon);
                    if (iconDescription.elementId && iconDescription.elementId !== "") {
                        buttonContainer.attr(Editor.Contract.idAttrName, iconDescription.elementId);
                    }
                    var ariaLabel = String.Format("{0}. {1} {2}", iconDescription.title, Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.ariaNotSelected), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.ariaOptionToActivate));
                    Editor.CommonUtils.setAriaAttribute(buttonContainer, "aria-label", ariaLabel);
                    return buttonContainer;
                })
                    .reduce(function (iconButtonsJQuery, iconButton) { return iconButtonsJQuery.add(iconButton); });
                // Buttons under the same title
                var iconButtonsGroup = $("<div>")
                    .addClass(Editor.BrowserPreviewConstants.headerIconButtonsContainerCssClass)
                    .append(iconButtons);
                return headerTitle.add(iconButtonsGroup);
            })
                .reduce(function (headerItems, headerItem) { return headerItems.add(_this.createDivider()).add(headerItem); });
            // Activating 'tablet portrait preview' icon by default;
            var selectedAriaLabel = String.Format("{0}. {1}", this.activeIcon.title, Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.ariaSelected));
            headerColumn
                .find(Editor.CommonUtils.getClassSelector(this.activeIcon.cssClass))
                .addClass(Editor.BrowserPreviewConstants.activeCssClass);
            headerColumn
                .find(Editor.CommonUtils.getClassSelector(this.activeIcon.cssClass))
                .attr("aria-label", selectedAriaLabel);
            return $("<div>")
                .addClass(Editor.BrowserPreviewConstants.headerCssClass)
                .append(headerColumn);
        };
        BrowserPreviewView.prototype.createDivider = function () {
            // Gets divider
            return $("<div>").addClass(Editor.BrowserPreviewConstants.headerDividerCssClass);
        };
        BrowserPreviewView.prototype.getAllPreviewTypeCssClassesForIframe = function (headerDescription) {
            // Gets all possible preview type css classes, which can be applied to the iframe, as space-separated string
            return headerDescription
                .map(function (description) { return description.icons; })
                .reduce(function (icons, iconArray) { return icons.concat(iconArray); })
                .map(function (icon) { return icon.cssClassForIframe; })
                .join(" ");
        };
        BrowserPreviewView.prototype.getPreviewSubjectContentDiv = function (subjectContent) {
            var subjectContainerDiv = $("<div/>");
            subjectContainerDiv.addClass(Editor.BrowserPreviewConstants.browserPreviewContentSubjectContainerCssClass);
            Editor.CommonUtils.setTabIndex(subjectContainerDiv, 0);
            var labelSpan = $("<span/>");
            labelSpan.addClass(Editor.BrowserPreviewConstants.browserPreviewContentSubjectLabelCssClass);
            labelSpan.text(Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.browserPreviewSubjectLabelText) + ":");
            var subjectContentSpan = $("<span/>");
            subjectContentSpan.addClass(Editor.BrowserPreviewConstants.browserPreviewContentSubjectContentCssClass);
            subjectContentSpan.append(subjectContent);
            subjectContainerDiv.append(labelSpan);
            subjectContainerDiv.append(subjectContentSpan);
            return subjectContainerDiv;
        };
        BrowserPreviewView.prototype.getHeaderPreviewTypesDescription = function () {
            return [
                new Editor.HeaderItemDescription(new Editor.TitleDescription(Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.desktopTitle), Editor.BrowserPreviewConstants.desktopTitleCssClass), [
                    new Editor.IconDescription(Editor.BrowserPreviewConstants.desktopIcon, Editor.BrowserPreviewConstants.desktopPreviewIconCssClass, Editor.BrowserPreviewConstants.desktopPreviewCssClass, Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.desktopPreviewIconAltText), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.desktopPreviewIconTitle), Editor.BrowserPreviewConstants.desktopPreviewId)
                ]),
                new Editor.HeaderItemDescription(new Editor.TitleDescription(Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.tabletTitle), Editor.BrowserPreviewConstants.tabletTitleCssClass), [
                    new Editor.IconDescription(Editor.BrowserPreviewConstants.tabletPortraitIcon, Editor.BrowserPreviewConstants.tabletPortraitPreviewIconCssClass, Editor.BrowserPreviewConstants.tabletPortraitPreviewCssClass, Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.tabletPortraitPreviewIconAltText), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.tabletPortraitPreviewIconTitle), Editor.BrowserPreviewConstants.tabletPortraitPreviewId),
                    new Editor.IconDescription(Editor.BrowserPreviewConstants.tabletLandscapeIcon, Editor.BrowserPreviewConstants.tabletLandscapePreviewIconCssClass, Editor.BrowserPreviewConstants.tabletLandscapePreviewCssClass, Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.tabletLandscapePreviewIconAltText), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.tabletLandscapePreviewIconTitle), Editor.BrowserPreviewConstants.tabletLandscapePreviewId)
                ]),
                new Editor.HeaderItemDescription(new Editor.TitleDescription(Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.mobileTitle), Editor.BrowserPreviewConstants.mobileTitleCssClass), [
                    new Editor.IconDescription(Editor.BrowserPreviewConstants.mobilePortraitIcon, Editor.BrowserPreviewConstants.mobilePortraitPreviewIconCssClass, Editor.BrowserPreviewConstants.mobilePortraitPreviewCssClass, Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.mobilePortraitPreviewIconAltText), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.mobilePortraitPreviewIconTitle), Editor.BrowserPreviewConstants.mobilePortraitPreviewId),
                    new Editor.IconDescription(Editor.BrowserPreviewConstants.mobileLandscapeIcon, Editor.BrowserPreviewConstants.mobileLandscapePreviewIconCssClass, Editor.BrowserPreviewConstants.mobileLandscapePreviewCssClass, Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.mobileLandscapePreviewIconAltText), Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.mobileLandscapePreviewIconTitle), Editor.BrowserPreviewConstants.mobileLandscapePreviewId)
                ])
            ];
        };
        BrowserPreviewView.prototype.registerGlobalKeyboardShortcuts = function () {
            this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.bKey, [KeyboardModifierType.Alt], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.browserPreviewTabContentClassName))
                    .focus()
                    .click();
            }));
            this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.threeKey, [KeyboardModifierType.Alt], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.previewViewClassName))
                    .focus()
                    .click();
            }));
        };
        BrowserPreviewView.prototype.registerKeyboardShortcuts = function () {
            this.registerKeyboardShortcut(new KeyboardCommand(KeyboardKeyCodes.oneKey, [KeyboardModifierType.Alt, KeyboardModifierType.Control], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.desktopPreviewIconCssClass))
                    .focus()
                    .click();
            }));
            this.registerKeyboardShortcut(new KeyboardCommand(KeyboardKeyCodes.twoKey, [KeyboardModifierType.Alt, KeyboardModifierType.Control], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.tabletPortraitPreviewIconCssClass))
                    .focus()
                    .click();
            }));
            this.registerKeyboardShortcut(new KeyboardCommand(KeyboardKeyCodes.threeKey, [KeyboardModifierType.Alt, KeyboardModifierType.Control], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.tabletLandscapePreviewIconCssClass))
                    .focus()
                    .click();
            }));
            this.registerKeyboardShortcut(new KeyboardCommand(KeyboardKeyCodes.fourKey, [KeyboardModifierType.Alt, KeyboardModifierType.Control], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.mobilePortraitPreviewIconCssClass))
                    .focus()
                    .click();
            }));
            this.registerKeyboardShortcut(new KeyboardCommand(KeyboardKeyCodes.fiveKey, [KeyboardModifierType.Alt, KeyboardModifierType.Control], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.BrowserPreviewConstants.mobileLandscapePreviewIconCssClass))
                    .focus()
                    .click();
            }));
        };
        BrowserPreviewView.prototype.registerKeyboardShortcut = function (command) {
            this.keyboardCommandManager.registerCommand(command);
            this.registeredKeyboardCommands.push(command);
        };
        BrowserPreviewView.prototype.unregisterKeyboardShortcuts = function () {
            for (var _i = 0, _a = this.registeredKeyboardCommands; _i < _a.length; _i++) {
                var command = _a[_i];
                this.keyboardCommandManager.unregisterCommand(command);
            }
            this.registeredKeyboardCommands = [];
        };
        BrowserPreviewView.prototype.shouldShowPostProcessingWaring = function () {
            if (!this.metadataParser) {
                return false;
            }
            return this.metadataParser.getValue(Editor.Contract.metadataPostProcessorsDisabledName, new DOMParser().parseFromString(this.html, 'text/html')) === Editor.Contract.metadataPostProcessorsDisabledValue;
        };
        return BrowserPreviewView;
    }(Editor.Control));
    Editor.BrowserPreviewView = BrowserPreviewView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    var DetailsView = /** @class */ (function (_super) {
        __extends(DetailsView, _super);
        function DetailsView(detailsContainerId, blockDetailsViewMapping, keyboardCommandManager) {
            var _this = _super.call(this, detailsContainerId) || this;
            _this.blockDetailsViewMapping = blockDetailsViewMapping;
            _this.keyboardCommandManager = keyboardCommandManager;
            _this.onSelectionChanged = function (eventArgs) {
                if (_this.selectedBlock == null ||
                    eventArgs.selectedBlock == null ||
                    !_this.selectedBlock.is(eventArgs.selectedBlock)) {
                    _this.setupDetailsView(eventArgs);
                    if (!Utility.isNullOrUndefined(_this.blockDetailsView)) {
                        // Supported element selected, so, activate the view
                        if (_this.isActive) {
                            _this.render();
                        }
                        else {
                            _this.activate();
                        }
                    }
                }
            };
            _this.onContentChanged = function (eventArgs) {
                // Render the content in case the view is activated
                if (_this.selectedBlock) {
                    var selectedBlockId = Editor.CommonUtils.getId(_this.selectedBlock);
                    if (selectedBlockId !== "" && Editor.CommonUtils.getById(selectedBlockId).length === 0) {
                        _this.cleanDetailsViewContent();
                    }
                    else {
                        if (selectedBlockId !== "") {
                            _this.selectedBlock = Editor.CommonUtils.getById(selectedBlockId);
                        }
                        if (_this.isActive) {
                            _this.render(eventArgs.originalSourceId, eventArgs.rootEventId);
                        }
                    }
                }
            };
            _this.detailsContainerId = detailsContainerId;
            return _this;
        }
        /**
         * Initializes the property view - attaches to the on selection change event to rerender the property view on the the block selection change
         */
        DetailsView.prototype.init = function (eventBroker) {
            this.eventBroker = eventBroker;
            this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.selectionChanged, this.onSelectionChanged);
            this.eventBroker.subscribe(Editor.EventConstants.contentChanged, this.onContentChanged);
            this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.fiveKey, [KeyboardModifierType.Alt], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.detailsTabContentClassName))
                    .parent()
                    .focus();
                $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.detailsTabContentClassName)).click();
            }));
        };
        DetailsView.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.blockDetailsView)) {
                this.blockDetailsView.dispose();
                this.blockDetailsView = null;
            }
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.selectionChanged, this.onSelectionChanged);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentChanged, this.onContentChanged);
            this.blockDetailsViewMapping = null;
            this.keyboardCommandManager = null;
            this.selectedBlock = null;
            this.eventBroker = null;
        };
        DetailsView.prototype.activate = function () {
            if (!this.isActive) {
                _super.prototype.activate.call(this);
            }
            if (!Utility.isNullOrUndefined(this.selectedBlock)) {
                var selectedBlockId = Editor.CommonUtils.getId(this.selectedBlock);
                if (selectedBlockId !== "" && Editor.CommonUtils.getById(selectedBlockId).length) {
                    this.render();
                }
            }
            else {
                this.cleanDetailsViewContent();
            }
        };
        DetailsView.prototype.setupDetailsView = function (args) {
            this.cleanDetailsViewContent();
            var block = args.selectedBlock;
            if (block != null) {
                this.blockDetailsView = this.blockDetailsViewMapping.get(Editor.BlockUtils.getBlockType(block));
                this.selectedBlock = block;
            }
            else if (args.selectedContainer != null) {
                this.blockDetailsView = this.blockDetailsViewMapping.get(Editor.CommonConstants.columnToolType);
                this.selectedBlock = args.selectedContainer;
            }
            else if (args.selectedSection != null) {
                this.blockDetailsView = this.blockDetailsViewMapping.get(Editor.CommonConstants.sectionToolType);
                this.selectedBlock = args.selectedSection;
            }
            else if (args.selectedBody != null) {
                this.blockDetailsView = this.blockDetailsViewMapping.get(Editor.CommonConstants.emailBodyToolType);
                this.selectedBlock = args.selectedBody;
            }
            else if (args.selectedForm != null) {
                this.blockDetailsView = this.blockDetailsViewMapping.get(Editor.CommonConstants.formBodyToolType);
                this.selectedBlock = args.selectedForm;
            }
        };
        DetailsView.prototype.render = function (originalSourceId, rootEventId) {
            if (!Utility.isNullOrUndefined(this.blockDetailsView) && !Utility.isNullOrUndefined(this.selectedBlock)) {
                if (originalSourceId !== this.id &&
                    originalSourceId !== Editor.CommonUtils.getId(this.selectedBlock) &&
                    originalSourceId !== Editor.EventConstants.detailsViewOrigin &&
                    rootEventId !== Editor.EventConstants.detailsViewOrigin &&
                    rootEventId !== this.id) {
                    this.blockDetailsView.init(this.eventBroker, this.id);
                    this.resetDetailsViewContent();
                    this.blockDetailsView.render(this.selectedBlock);
                    Editor.BlockDetailsUtils.protectBlocksIfNeeded(this.selectedBlock, this.blockDetailsView);
                    this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.id));
                    this.eventBroker.notify(Editor.EventConstants.bringIntoView, new Editor.ControlRenderedEventArgs(this.id));
                }
            }
        };
        DetailsView.prototype.resetDetailsViewContent = function () {
            // explicitly resetting color-picker container
            var colorPicker = document.querySelector(".marketing-color-picker");
            if (colorPicker) {
                colorPicker.remove();
            }
        };
        DetailsView.prototype.cleanDetailsViewContent = function () {
            // Clean react elements in children that are about to be abandoned
            $("." + Editor.DetailsViewConstants.colorFilledRectangleCssClass).each(function (index, elm) { return ReactDOM.unmountComponentAtNode(elm); });
            if (!Utility.isNullOrUndefined(this.blockDetailsView)) {
                this.blockDetailsView.dispose();
            }
            Editor.CommonUtils.getById(this.detailsContainerId).empty();
            var emptyString = Editor.CommonUtils.getLocalizedString("There are no properties available");
            var emptyStringContainer = $("<div>" + emptyString + "</div>")
                .addClass(Editor.CommonConstants.emptyDetailsViewCssClass);
            Editor.CommonUtils.getById(this.detailsContainerId).append(emptyStringContainer);
            this.blockDetailsView = this.selectedBlock = null;
        };
        return DetailsView;
    }(Editor.Control));
    Editor.DetailsView = DetailsView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ArrayQuery = MktSvc.Controls.Common.ArrayQuery;
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var TraceLevel = MktSvc.Controls.Common.TraceLevel;
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    var ToolboxView = /** @class */ (function (_super) {
        __extends(ToolboxView, _super);
        function ToolboxView(toolboxId, tools, keyboardAccessibilityManager, keyboardCommandManager, executionContext, hideEmptySections, blocksFromToolItemProvider, sections, toolSectionProvider) {
            if (hideEmptySections === void 0) { hideEmptySections = false; }
            var _this = _super.call(this, toolboxId) || this;
            _this.toolboxId = toolboxId;
            _this.tools = tools;
            _this.keyboardAccessibilityManager = keyboardAccessibilityManager;
            _this.keyboardCommandManager = keyboardCommandManager;
            _this.executionContext = executionContext;
            _this.hideEmptySections = hideEmptySections;
            _this.blocksFromToolItemProvider = blocksFromToolItemProvider;
            _this.sections = sections;
            _this.toolSectionProvider = toolSectionProvider;
            _this.clickDragstartEvent = "click dragstart";
            _this.accessibleItemList = new Array();
            _this.disableToolboxAccessibility = function () {
                $(_this.draggableSelector)
                    .toArray()
                    .forEach(function (el) {
                    el.draggable = "false";
                    el.style.cursor = "no-drop";
                    el.style.opacity = "0.4";
                });
                $("." + Editor.CommonConstants.contentBlockSectionSubtitleCssClass).show();
                $("." + Editor.CommonConstants.contentBlockSectionSubtitleTextClass).text(Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.contentBlockCantInsertMoreBlocks));
                Editor.CommonUtils.getBySelector(_this.draggableSelector).off(_this.clickDragstartEvent);
            };
            _this.enableToolboxAccessibility = function () {
                _this.render(true);
            };
            _this.draggableSelector = String.Format("#{0} .{1}", toolboxId, Editor.CommonConstants.toolboxItemClassName);
            _this.renderedToolIdToToolMapping = new Dictionary();
            _this.ensureDefaultSection();
            _this.keyboardCommandManager = keyboardCommandManager;
            if (typeof toolSectionProvider === "undefined" || !toolSectionProvider) {
                _this.toolSectionProvider = new Editor.ToolTypeBasedSectionProvider(new Dictionary());
            }
            return _this;
        }
        /**
         * Ensure that the default section is added to the toolbox.
         * If is defined in the sections parameter then will be added as defined in the corresponding order, else the default section is added
         * using the default name and label at the beginning of the list.
         */
        ToolboxView.prototype.ensureDefaultSection = function () {
            this.sections = this.sections || new ArrayQuery([]);
            this.defaultSection = this.sections.firstOrDefault(function (section) { return section.getName() === Editor.CommonConstants.toolboxDefaultSectionName; });
            if (!this.defaultSection) {
                this.defaultSection = new Editor.Section(Editor.CommonConstants.toolboxDefaultSectionName, Editor.CommonConstants.toolboxDefaultSectionLabel);
                this.sections = this.sections.clone().addAt(this.defaultSection, 0);
            }
        };
        ToolboxView.prototype.init = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            //accessibility
            this.keyboardAccessibilityManager.initialize(this);
            this.eventBroker.subscribe(Editor.EventConstants.onToolboxAccessibleContainerRendered, this.keyboardAccessibilityManager.onContainerRenderedHandler);
            this.eventBroker.subscribe(Editor.EventConstants.onToolboxAccessibleItemRendered, this.keyboardAccessibilityManager.onItemRenderedHandler);
            this.eventBroker.subscribe(Editor.EventConstants.renderTools, function (eventArgs) {
                _this.tools = eventArgs.tools;
                _this.render(false);
            });
            this.eventBroker.subscribe(Editor.EventConstants.elementsCannotBeInserted, this.disableToolboxAccessibility);
            this.eventBroker.subscribe(Editor.EventConstants.elementsCanBeInserted, this.enableToolboxAccessibility);
            this.render(true);
            this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.fourKey, [KeyboardModifierType.Alt], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.toolboxTabContentClassName))
                    .parent()
                    .focus();
                $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.toolboxTabContentClassName)).click();
            }));
        };
        ToolboxView.prototype.activate = function () {
            _super.prototype.activate.call(this);
        };
        /**
         * implementation of IAccessibleCollection
         */
        ToolboxView.prototype.getAllAccessibleItems = function () {
            return this.accessibleItemList;
        };
        ToolboxView.prototype.getSelectedAccesibleItem = function () {
            var selectedElement = document.activeElement;
            if ($(selectedElement).hasClass(ToolboxView.toolItemCellCssClass)) {
                return selectedElement;
            }
            else {
                return null;
            }
        };
        ToolboxView.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.EventConstants.sectionToolsPublishStarted, this.sectionToolsPublishStartedEventHandler);
            this.eventBroker.unsubscribe(Editor.EventConstants.sectionToolsPublishCompleted, this.sectionToolsPublishEndedEventHandler);
            this.eventBroker.unsubscribe(Editor.EventConstants.toolPublished, this.toolPublishedEventHandler);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddEnd, this.designerAddEndEventHandler);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddSectionEnd, this.designerAddEndEventHandler);
            this.eventBroker.unsubscribe(Editor.EventConstants.onToolboxAccessibleContainerRendered, this.keyboardAccessibilityManager.onContainerRenderedHandler);
            this.eventBroker.unsubscribe(Editor.EventConstants.onToolboxAccessibleItemRendered, this.keyboardAccessibilityManager.onItemRenderedHandler);
            Editor.CommonUtils.getBySelector(this.draggableSelector).off(this.clickDragstartEvent);
            this.renderedToolIdToToolMapping = null;
            this.keyboardAccessibilityManager = null;
            this.keyboardCommandManager = null;
            this.sections = null;
            this.accessibleItemList = null;
        };
        ToolboxView.prototype.render = function (notify) {
            Editor.CommonUtils.getById(this.toolboxId)
                .empty()
                .append(this.renderToolbox());
            this.setupSectionToolsPublishStartedEvent();
            this.setupSectionToolsPublishEndedEvent();
            this.setupToolPublishedEvent();
            if (notify) {
                this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.id));
            }
        };
        ToolboxView.prototype.setupSectionToolsPublishStartedEvent = function () {
            var _this = this;
            this.sectionToolsPublishStartedEventHandler = function (eventArgs) {
                _this.setSectionIsLoading(eventArgs.getSectionName(), true);
            };
            this.eventBroker.subscribe(Editor.EventConstants.sectionToolsPublishStarted, this.sectionToolsPublishStartedEventHandler);
        };
        ToolboxView.prototype.setupSectionToolsPublishEndedEvent = function () {
            var _this = this;
            this.sectionToolsPublishEndedEventHandler = function (eventArgs) {
                _this.setSectionIsLoading(eventArgs.getSectionName(), false);
            };
            this.eventBroker.subscribe(Editor.EventConstants.sectionToolsPublishCompleted, this.sectionToolsPublishEndedEventHandler);
        };
        ToolboxView.prototype.setupToolPublishedEvent = function () {
            var _this = this;
            this.toolPublishedEventHandler = function (eventArgs) {
                var tool = eventArgs.getTool();
                var sectionName = eventArgs.getSectionName() || _this.defaultSection.getName();
                if (_this.sections.where(function (section) { return section.getName() === sectionName; }).count() === 0) {
                    sectionName = _this.defaultSection.getName();
                }
                _this.toolSectionProvider.setSectionName(tool, sectionName);
                _this.renderTool(tool);
                _this.tools.add(tool);
            };
            this.eventBroker.subscribe(Editor.EventConstants.toolPublished, this.toolPublishedEventHandler);
        };
        ToolboxView.prototype.renderToolbox = function () {
            this.toolboxContainer = $("<div></div>")
                .addClass(Editor.CommonConstants.contentViewBlocksClassName)
                .addClass(Editor.CommonUtils.getLangDirectionClass())
                .attr(Editor.AriaAttributeNames.role, "menu");
            this.renderAllSections();
            this.renderTools();
            this.eventBroker.notify(Editor.EventConstants.onToolboxAccessibleContainerRendered, new Editor.ContainerRenderedEventArgs(this.toolboxContainer));
            return this.toolboxContainer;
        };
        ToolboxView.prototype.renderTools = function () {
            var _this = this;
            // add tools to container
            this.tools.items().forEach(function (tool, i) {
                if (typeof tool.getId === "function") {
                    var sectionName_1 = _this.toolSectionProvider.getSectionName(tool);
                    var section = sectionName_1 ? _this.sections.firstOrDefault(function (s) { return s.getName() === sectionName_1; }) : null;
                    var sectionContainer = _this.getOrRenderSection(section);
                    if (!Utility.isNullOrUndefined(section) && sectionContainer.find("div[data-" + Editor.CommonConstants.toolboxItemIdDataAttr + "=\"" + tool.getId() + "\"]").length === 0) {
                        _this.renderTool(tool, i);
                    }
                }
                else {
                    _this.renderTool(tool, i);
                }
            });
        };
        ToolboxView.prototype.renderTool = function (tool, index, prepend) {
            var sectionName = this.toolSectionProvider.getSectionName(tool);
            var section;
            section = sectionName
                ? this.sections.firstOrDefault(function (s) { return s.getName() === sectionName; })
                : this.defaultSection;
            // if the tool is associated with an invalid section then add the tool to the default section and log the error.
            if (Utility.isNullOrUndefined(section)) {
                var errorMessage = "No toolbox section name '" + sectionName + "' was found for tool '" + tool.getType() + "'.";
                this.executionContext
                    .getLogger()
                    .log(TraceLevel.Error, "Editor.ToolboxView.renderTool", new Dictionary({ Message: errorMessage, SectionName: sectionName, ToolType: tool.getType() }));
                section = this.defaultSection;
            }
            this.renderToolInSection(tool, section, index, prepend);
            return true;
        };
        ToolboxView.prototype.renderToolIfNotAlreadyRendered = function (tool, prepend) {
            var sectionName = this.toolSectionProvider.getSectionName(tool);
            var section = sectionName ? this.sections.firstOrDefault(function (s) { return s.getName() === sectionName; }) : null;
            var sectionContainer = this.getOrRenderSection(section);
            if (!Utility.isNullOrUndefined(section) &&
                sectionContainer.find("div[data-" + Editor.CommonConstants.toolboxItemIdDataAttr + "=\"" + tool.getId() + "\"]").length === 0) {
                this.renderTool(tool, null, prepend);
            }
        };
        ToolboxView.prototype.renderToolInSection = function (tool, section, index, prepend) {
            var sectionContainer = this.getOrRenderSection(section);
            var imgContainer = $("<span>")
                .addClass(ToolboxView.toolItemIconCssClass)
                .addClass(Editor.CommonConstants.iconContainerCssClass)
                .attr("draggable", "false"); // Prevents dragging of the icon only instead of the whole block
            var toolName = $("<span>")
                .addClass(ToolboxView.toolItemLabelCssClass)
                .text(tool.getLabel())
                .addClass(Editor.CommonUtils.getLangDirectionClass());
            var renderedToolId = typeof tool.getId === "function" ? tool.getId() : UniqueId.generate();
            var toolBoxDraggableContainer = $("<div>")
                .addClass(Editor.CommonConstants.toolboxItemClassName)
                .attr("data-" + Editor.CommonConstants.toolboxItemTypeDataAttr, tool.getType())
                .attr("data-" + Editor.CommonConstants.toolboxItemIdDataAttr, renderedToolId);
            var toolBoxIcon = $("<button>")
                .addClass(Editor.CommonConstants.toolboxItemButtonCssClassName)
                .attr("type", Editor.CommonConstants.buttonType)
                .attr("title", tool.getTitle())
                .append(imgContainer, toolName);
            toolBoxDraggableContainer.append(toolBoxIcon);
            var toolCell = $("<div>")
                .attr("title", tool.getLabel())
                .attr(Editor.AriaAttributeNames.role, "menuitem")
                .addClass(ToolboxView.toolItemCellCssClass)
                .append(toolBoxDraggableContainer);
            var toolsCount = this.getSectionToolsCount(section.getName());
            ReactDOM.render(React.createElement(Editor.ToolIconButton, {
                tool: tool,
                i: index,
                key: index
            }, null), toolBoxDraggableContainer[0]);
            var contentBlockItems = sectionContainer.find("." + Editor.CommonConstants.contentBlockItemsCssClass);
            if (!prepend) {
                contentBlockItems.append(toolCell);
            }
            else {
                var toolItems = contentBlockItems.find("." + ToolboxView.toolItemCellCssClass);
                if (toolItems.length) {
                    toolItems.first().before(toolCell);
                }
                else {
                    contentBlockItems.append(toolCell);
                }
            }
            if (toolsCount === 0) {
                // We are adding the first tool in this section, let's mark is as non-empty
                this.setSectionIsEmpty(section.getName(), false);
                if (this.hideEmptySections) {
                    // Do not forget to show the section; the section is hidden by default in this mode
                    sectionContainer.css("display", "block");
                }
            }
            this.setupEventsOnTools(toolBoxDraggableContainer);
            this.renderedToolIdToToolMapping.addOrUpdate(renderedToolId, tool);
            // accessibility
            var accessibleItemOnClickHandler = function () {
                toolBoxIcon.click();
            };
            var accessibleItem = new Editor.ToolboxAccessibleItem(toolBoxIcon, accessibleItemOnClickHandler);
            this.accessibleItemList.push(accessibleItem);
            this.eventBroker.notify(Editor.EventConstants.onToolboxAccessibleItemRendered, new Editor.ElementRenderedEventArgs(accessibleItem));
        };
        ToolboxView.prototype.getOrRenderSection = function (section) {
            var sectionContainer = this.getSectionContainer(section.getName());
            if (sectionContainer.length > 0) {
                return sectionContainer;
            }
            sectionContainer = this.renderSection(section);
            return sectionContainer;
        };
        ToolboxView.prototype.renderAllSections = function () {
            var _this = this;
            this.sections.items().forEach(function (section) { return _this.renderSection(section); });
        };
        ToolboxView.prototype.renderSection = function (section) {
            var treeView = $("<div></div>").addClass(Editor.CommonConstants.treeViewCssClass);
            var toolCellContainer = $("<div>")
                .addClass(Editor.CommonConstants.contentBlockItemsCssClass)
                .attr(Editor.AriaAttributeNames.role, "menu");
            treeView.append(toolCellContainer);
            var ariaLabelId = MktSvc.Controls.Common.UniqueId.generate();
            // The icon which shows if the table of the attribute editors is collapsed or not
            var toggleButton = $("<button></button>")
                .addClass(Editor.CommonConstants.extrasToggleCssClass)
                .addClass(Editor.CommonConstants.editorFontCssClass)
                .attr(Editor.AriaAttributeNames.ariaExpanded, "true")
                .attr(Editor.AriaAttributeNames.ariaLabelledby, ariaLabelId)
                .attr(Editor.AriaAttributeNames.role, "menuitem")
                .click(function () {
                treeView.toggle();
                toggleButton.toggleClass(Editor.CommonConstants.collapsedCssClass);
                toggleButton.attr(Editor.AriaAttributeNames.ariaExpanded) === "true"
                    ? toggleButton.attr(Editor.AriaAttributeNames.ariaExpanded, "false")
                    : toggleButton.attr(Editor.AriaAttributeNames.ariaExpanded, "true");
            });
            // Section title (presentation role is required for TalkBack, as otherwise it does not ignore the span)
            var treeViewTitle = $("<span></span>")
                .addClass(Editor.CommonConstants.propertiesTitleButtonCssClass)
                .attr(Editor.AriaAttributeNames.role, Editor.AriaRoleConstants.presentation)
                .click(function () { return toggleButton.click(); });
            //Section subtitle
            var treeViewSubTitle = $("<div\n                                            class=\"" + Editor.CommonConstants.contentBlockSectionSubtitleCssClass + "\"\n                                            aria-live=\"polite\"\n                                            style=\"display:none\">\n                                            <span class=\"CCFSymbolFont fontIconSize\" draggable=\"false\"></span>\n                                            <div class=\"" + Editor.CommonConstants.contentBlockSectionSubtitleTextClass + "\">\n                                            </div>\n                                        </div>");
            var treeViewLabel = $("<p></p>", { id: ariaLabelId })
                .addClass(Editor.CommonConstants.propertiesTitleCssClass)
                .text(section.getLabel());
            treeViewTitle.append(treeViewLabel);
            var propertiesHeader = toggleButton.add(treeViewTitle);
            var sectionContainer = $("<div></div>")
                .addClass(Editor.CommonConstants.contentBlockSectionCssClass)
                .addClass(Editor.CommonUtils.getLangDirectionClass())
                .attr("data-" + Editor.CommonConstants.toolboxSectionNameDataAttr, section.getName())
                .append(treeViewSubTitle)
                .append(propertiesHeader)
                .append(treeView);
            this.toolboxContainer.append(sectionContainer);
            this.setSectionIsEmpty(section.getName(), true);
            if (this.hideEmptySections) {
                sectionContainer.css("display", "none");
            }
            return sectionContainer;
        };
        ToolboxView.prototype.setSectionIsEmpty = function (sectionName, isEmpty) {
            var sectionContainer = this.getSectionContainer(sectionName);
            if (sectionContainer.length === 0) {
                sectionContainer = this.getSectionContainer(Editor.CommonConstants.toolboxDefaultSectionName);
            }
            var treeView = sectionContainer.find("." + Editor.CommonConstants.treeViewCssClass);
            sectionContainer.removeClass(Editor.CommonConstants.contentBlockSectionEmptyCssClass);
            treeView.find("." + Editor.CommonConstants.contentBlockSectionEmptyMessageCssClass).remove();
            if (isEmpty) {
                sectionContainer.addClass(Editor.CommonConstants.contentBlockSectionEmptyCssClass);
                var sectionEmptyMessage = $("<div></div>")
                    .addClass(Editor.CommonConstants.contentBlockSectionEmptyMessageCssClass)
                    .text(Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.contentBlockSectionEmptyMessage));
                treeView.append(sectionEmptyMessage);
            }
        };
        ToolboxView.prototype.setSectionIsLoading = function (sectionName, isLoading) {
            var sectionContainer = this.getSectionContainer(sectionName);
            if (sectionContainer.length === 0) {
                sectionContainer = this.getSectionContainer(Editor.CommonConstants.toolboxDefaultSectionName);
            }
            var treeView = sectionContainer.find("." + Editor.CommonConstants.treeViewCssClass);
            sectionContainer.removeClass(Editor.CommonConstants.contentBlockSectionLoadingCssClass);
            treeView.find("." + Editor.CommonConstants.contentBlockSectionLoadingMessageCssClass).remove();
            if (isLoading) {
                sectionContainer.addClass(Editor.CommonConstants.contentBlockSectionLoadingCssClass);
                var sectionLoadingMessage = $("<div></div>")
                    .addClass(Editor.CommonConstants.contentBlockSectionLoadingMessageCssClass)
                    .text(Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.contentBlockSectionLoadingMessage));
                treeView.append(sectionLoadingMessage);
            }
            else {
                var toolsCount = this.getSectionToolsCount(sectionName);
                this.setSectionIsEmpty(sectionName, toolsCount === 0);
            }
        };
        ToolboxView.prototype.getSectionToolsCount = function (sectionName) {
            return this.getSectionContainer(sectionName).find("." + ToolboxView.toolItemCellCssClass).length;
        };
        ToolboxView.prototype.getSectionContainer = function (sectionName) {
            return this.toolboxContainer.find("." + Editor.CommonConstants.contentBlockSectionCssClass + "[data-" + Editor.CommonConstants.toolboxSectionNameDataAttr + "=\"" + sectionName + "\"]");
        };
        ToolboxView.prototype.getToolById = function (toolId) {
            return this.renderedToolIdToToolMapping.get(toolId);
        };
        ToolboxView.prototype.setupEventsOnTools = function (draggableToolItems) {
            var _this = this;
            draggableToolItems.attr("draggable", "true");
            draggableToolItems.on("dragstart", function (event) {
                var tool = _this.getToolBlockFromEvent(event);
                var selectedTool = _this.getToolById(tool.data(Editor.CommonConstants.toolboxItemIdDataAttr).toString());
                Editor.CkEditorTelemetryUtils.sendToolUsageTelemetry(_this.executionContext.getLogger(), _this.getName(), selectedTool);
                Editor.CkEditorTelemetryUtils.sendControllerUsageTelemetry(_this.executionContext.getLogger(), event.type, _this.getName());
                // Stop event propagation because in the web client there is event listener
                // for the dragstart event (on the document) in the MicrosoftAjax.js with a preventDefault.
                event.stopPropagation();
                var dragEventDataTransfer = event.originalEvent.dataTransfer;
                // Set identification that this object is draggable
                if (selectedTool && selectedTool.getCategory() === Editor.ToolCategory.Layout) {
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragSectionStart);
                }
                else {
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragStart);
                }
                var block = _this.blocksFromToolItemProvider.getBlockFromTool(selectedTool);
                if (block.length) {
                    dragEventDataTransfer.setData("Text", block.get(0).outerHTML);
                }
            });
            this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerAddEnd, (this.designerAddEndEventHandler = function (eventArgs) {
                _this.removeSelectionsOnTools(eventArgs);
            }));
            this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerAddSectionEnd, (this.designerAddEndEventHandler = function (eventArgs) {
                return _this.removeSelectionsOnTools(eventArgs);
            }));
            draggableToolItems.on("click", function (event) {
                var tool = _this.getToolBlockFromEvent(event);
                if (!tool.hasClass(Editor.CommonConstants.toolboxSelectedToolItemClassName)) {
                    // Remove old selections
                    _this.removeSelectionsOnTools();
                    // Add selection
                    tool.addClass(Editor.CommonConstants.toolboxSelectedToolItemClassName);
                    _this.lastSelectedTool = tool;
                    _this.lastSelectedToolType = Editor.ToolCategory.Content;
                    var selectedTool = _this.getToolById(tool.data(Editor.CommonConstants.toolboxItemIdDataAttr).toString());
                    var block = _this.blocksFromToolItemProvider.getBlockFromTool(selectedTool);
                    if (block.length) {
                        // Activate add mode
                        if (selectedTool && selectedTool.getCategory() === Editor.ToolCategory.Layout) {
                            _this.lastSelectedToolType = Editor.ToolCategory.Layout;
                        }
                        Editor.CkEditorTelemetryUtils.sendToolUsageTelemetry(_this.executionContext.getLogger(), _this.getName(), selectedTool);
                        _this.blocksFromToolItemProvider.notifyOnToolSelected(selectedTool, _this.eventBroker, block);
                    }
                }
                else {
                    // Exit from the add mode
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.cleanPlaceholderForAddMode);
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddSectionEnd);
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddEnd);
                }
            });
        };
        ToolboxView.prototype.getToolBlockFromEvent = function (event) {
            var tool = $(event.target).hasClass(Editor.CommonConstants.toolboxItemClassName)
                ? $(event.target)
                : $(event.target).closest(this.draggableSelector);
            return tool;
        };
        ToolboxView.prototype.removeSelectionsOnTools = function (eventArgs) {
            if (this.lastSelectedTool) {
                if (eventArgs) {
                    if (eventArgs.category !== this.lastSelectedToolType) {
                        this.lastSelectedTool.removeClass(Editor.CommonConstants.toolboxSelectedToolItemClassName);
                    }
                }
                else {
                    this.lastSelectedTool.removeClass(Editor.CommonConstants.toolboxSelectedToolItemClassName);
                }
            }
        };
        ToolboxView.prototype.getName = function () {
            return "ToolboxView";
        };
        ToolboxView.toolItemCellCssClass = "toolItemCell";
        ToolboxView.toolItemRowCssClass = "toolItemRow";
        ToolboxView.toolItemLabelCssClass = "toolItemLabel";
        ToolboxView.toolItemIconCssClass = "toolItemIcon";
        ToolboxView.buttonsPerRow = 2;
        return ToolboxView;
    }(Editor.Control));
    Editor.ToolboxView = ToolboxView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ImageTool = /** @class */ (function () {
        function ImageTool() {
        }
        ImageTool.prototype.getContentTransformation = function () {
            return '<div align="Center" class="imageWrapper"><img src="" /></div>';
        };
        ImageTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.imageToolLabel);
        };
        ImageTool.prototype.getType = function () {
            return Editor.CommonConstants.imageToolType;
        };
        ImageTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.imageToolTitle);
        };
        ImageTool.prototype.getCssClass = function () {
            return "imageTool";
        };
        ImageTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Content;
        };
        return ImageTool;
    }());
    Editor.ImageTool = ImageTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ButtonTool = /** @class */ (function () {
        function ButtonTool() {
        }
        ButtonTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.buttonToolLabel);
        };
        ButtonTool.prototype.getType = function () {
            return Editor.CommonConstants.buttonToolType;
        };
        ButtonTool.prototype.getContentTransformation = function () {
            var style = "display: block; text-align: center; margin-right: auto; margin-left: auto;background-color: rgb(242, 242, 242)";
            return "<a href=\"" + Editor.CommonConstants.buttonEmptyHref + "\" style=\"" + style + "\">Click me</a>";
        };
        ButtonTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.buttonToolTitle);
        };
        ButtonTool.prototype.getCssClass = function () {
            return "buttonTool";
        };
        ButtonTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Content;
        };
        return ButtonTool;
    }());
    Editor.ButtonTool = ButtonTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TextTool = /** @class */ (function () {
        function TextTool() {
        }
        TextTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.textToolLabel);
        };
        TextTool.prototype.getType = function () {
            return Editor.CommonConstants.textToolType;
        };
        TextTool.prototype.getContentTransformation = function () {
            return "<p>" + Editor.CommonUtils.getLocalizedString("Please input your text here...") + "</p>";
        };
        TextTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.textToolTitle);
        };
        TextTool.prototype.getCssClass = function () {
            return "textTool";
        };
        TextTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Content;
        };
        return TextTool;
    }());
    Editor.TextTool = TextTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DividerTool = /** @class */ (function () {
        function DividerTool() {
        }
        DividerTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.dividerToolLabel);
        };
        DividerTool.prototype.getType = function () {
            return Editor.CommonConstants.dividerToolType;
        };
        DividerTool.prototype.getContentTransformation = function () {
            // Use additional dividerWrapper div for the correct alignment in the all Outlook versions.
            return '<div class="dividerWrapper" align="center"><table style="padding: 0px; margin: 0px; border-spacing: 0px; width: 100%" role="presentation"><tbody><tr style="padding: 0px;"><td style="margin:0px; padding-left: 0px; padding-right: 0px; padding-top: 5px; padding-bottom: 5px; vertical-align:top;"><p style="margin: 0px; padding: 0px; border-bottom-width: 3px; border-bottom-style: solid; border-bottom-color: rgb(0, 0, 0); line-height: 0px; width: 100%;"><span><!--[if gte mso 9]><br/><![endif]-->&nbsp;</span></p></td></tr></tbody></table></div>';
        };
        DividerTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.dividerToolTitle);
        };
        DividerTool.prototype.getCssClass = function () {
            return "dividerTool";
        };
        DividerTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Content;
        };
        return DividerTool;
    }());
    Editor.DividerTool = DividerTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ToolCategory;
    (function (ToolCategory) {
        ToolCategory[ToolCategory["Content"] = 0] = "Content";
        ToolCategory[ToolCategory["Layout"] = 1] = "Layout";
    })(ToolCategory = Editor.ToolCategory || (Editor.ToolCategory = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Adapter between IPlugin and CKEDITOR.plugins.IPluginDefinition.
     */
    var CKEditorPluginAdapter = /** @class */ (function () {
        /**
         * Initializes a new instance of the CKEditorCommandAdapter class.
         * @param _CKEDITOR CKEDITOR.
         * @param plugin plugin to wrap.
         * @param eventBroker event broker used.
         * @param getElement function to get the currently selected element.
         * @param getWrappedBlockFunction function to get the top-wrapping element, for the selected element.
         * @param logger the logger.
         */
        function CKEditorPluginAdapter(_CKEDITOR, plugin, eventBroker, getElement, getWrappedBlockFunction, executionContext) {
            this.ckEditorKeyboardAdapter = new Editor.CkEditorKeyboardAdapter();
            this._CKEDITOR = _CKEDITOR;
            this.plugin = plugin;
            this.eventBroker = eventBroker;
            this.getElementFunction = getElement;
            this.getWrappedBlockFunction = getWrappedBlockFunction;
            this.executionContext = executionContext;
        }
        /**
         * Initialize the editor. This is called from CKEditor.
         * @param editor an instance of CKEditor.editor.
         */
        CKEditorPluginAdapter.prototype.init = function (editor) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                if (_this.plugin.getDialogs) {
                    $.each(_this.plugin.getDialogs(), function (index, dialog) {
                        _this.registerDialog(dialog);
                    });
                }
                if (_this.plugin.getWidgets) {
                    $.each(_this.plugin.getWidgets(), function (index, widget) {
                        _this.registerWidget(widget, editor);
                    });
                }
                // register commands
                $.each(_this.plugin.getCommands(), function (index, command) {
                    _this.registerCommand(command, editor);
                });
                // register buttons
                $.each(_this.plugin.getToolbarButtons(), function (index, button) {
                    _this.registerButton(button, editor);
                });
                // register combos
                $.each(_this.plugin.getToolbarCombos(), function (index, combo) {
                    _this.registerCombo(combo, editor);
                });
            }, "Initialize the ckeditor", true);
        };
        CKEditorPluginAdapter.prototype.dispose = function () {
            var _this = this;
            this.executionContext.tryExecute(function () {
                // Dispose
                $.each(_this.plugin.getCommands(), function (index, command) {
                    command.dispose();
                });
            }, "Dispose the ckeditor commands");
            this.getWrappedBlockFunction = null;
            this.ckEditorKeyboardAdapter = null;
            this.getElementFunction = null;
            this.eventBroker = null;
            this.plugin = null;
        };
        /**
         * Register a command with ckeditor.
         * @param command a command instance.
         * @param editor a CKEditor instance.
         */
        CKEditorPluginAdapter.prototype.registerCommand = function (command, editor) {
            if (!!command.shouldBeRegistered && !command.shouldBeRegistered()) {
                return;
            }
            var commandDefinition = new Editor.CKEditorCommandAdapter(command, this.getElementFunction, this.getWrappedBlockFunction, this.executionContext);
            editor.addCommand(command.getName(), commandDefinition);
        };
        /**
         * Register a toolbar button with CKEditor.
         * @param button an instance of IButton.
         * @param editor an instance of CKEditor.
         */
        CKEditorPluginAdapter.prototype.registerButton = function (button, editor) {
            editor.ui.addButton(button.getName(), new Editor.CKEditorButtonAdapter(button));
            // Adding the keyboard shortcut for the button
            var keyCommand = button.getKeyboardShortcut();
            if (!Utility.isNullOrUndefined(keyCommand)) {
                editor.setKeystroke(this.ckEditorKeyboardAdapter.getCkEditorKeyCode(keyCommand), button.getCommand().getName());
            }
        };
        /**
         * Register a toolbar combo with CKEditor.
         * @param combo an instance of ICombo.
         * @param editor an instance of CKEditor.
         */
        CKEditorPluginAdapter.prototype.registerCombo = function (combo, editor) {
            editor.ui.addRichCombo(combo.getName(), new Editor.CKEditorComboAdapter(this._CKEDITOR.skin.getPath("editor"), combo, editor, this.executionContext));
        };
        CKEditorPluginAdapter.prototype.registerDialog = function (dialog) {
            CKEDITOR.dialog.add(dialog.getName(), function () { return Editor.CKEditorDialogAdapter.create(dialog); });
        };
        CKEditorPluginAdapter.prototype.registerWidget = function (widget, editor) {
            editor.widgets.add(widget.getName(), Editor.CKEditorWidgetAdapter.create(widget));
        };
        CKEditorPluginAdapter.prototype.afterInit = function (editor) {
            var _this = this;
            if (this.plugin.getTextRules) {
                $.each(this.plugin.getTextRules(), function (index, textRule) {
                    _this.registerTextRule(textRule, editor);
                });
            }
        };
        CKEditorPluginAdapter.prototype.registerTextRule = function (textRule, editor) {
            editor.dataProcessor.dataFilter.addRules({
                text: function (text, node) { return textRule.execute(editor, text, node); },
                elements: {
                    'span': function (element) { return textRule.spanExecute(editor, element); }
                }
            });
        };
        return CKEditorPluginAdapter;
    }());
    Editor.CKEditorPluginAdapter = CKEditorPluginAdapter;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Adapter between IButton and CKEDITOR.buttonDefinition
     */
    var CKEditorButtonAdapter = /** @class */ (function () {
        /**
         * Initializes a new instance of the CKEditorCommandAdapter.
         * @param button an instance of ICommand.
         */
        function CKEditorButtonAdapter(button) {
            this.toolbar = "";
            this.button = button;
            this.label = Editor.CommonUtils.getLocalizedString(button.getLabel());
            this.command = button.getCommand().getName();
        }
        /**
         * Gets the name of the command.
         */
        CKEditorButtonAdapter.prototype.getName = function () {
            return this.button.getName();
        };
        return CKEditorButtonAdapter;
    }());
    Editor.CKEditorButtonAdapter = CKEditorButtonAdapter;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Adapter between ICombo and object expected by CKEDITOR.ui.addRichCombo
     */
    var CKEditorComboAdapter = /** @class */ (function () {
        /**
         * Initializes a new instance of the CKEditorCommandAdapter.
         * @param editorSkinPath the ckeditor skin path.
         * @param combo an instance of ICommand.
         * @param editor the Ckeditor instance.
         * @param logger the logger.
         */
        function CKEditorComboAdapter(editorSkinPath, combo, editor, executionContext) {
            var _this = this;
            this.multiSelect = false;
            this.saveEditorState = "saveSnapshot";
            this.combo = combo;
            this.editor = editor;
            this.executionContext = executionContext;
            this.executionContext.tryExecute(function () {
                _this.readOnly = _this.combo.getCommand().enabledOnReadOnly() ? 1 : 0;
                // Set the styles of the combo
                var styles = [editorSkinPath];
                if (Array.isArray(_this.editor.config.contentsCss)) {
                    _this.editor.config.contentsCss.forEach(function (style) {
                        styles.push(style);
                    });
                }
                else {
                    styles.push(_this.editor.config.contentsCss);
                }
                _this.panel = { css: styles };
                _this.label = Editor.CommonUtils.getLocalizedString(_this.combo.getLabel());
                _this.command = combo.getCommand().getName();
            }, "Initialize ckeditor combo", true);
        }
        // Define the richCombo function.
        CKEditorComboAdapter.prototype.startGroup = function (name) { };
        CKEditorComboAdapter.prototype.add = function (value, html, text) { };
        CKEditorComboAdapter.prototype.setValue = function (value, text) { };
        /**
         * Configures combo items.
         */
        CKEditorComboAdapter.prototype.init = function () {
            var _this = this;
            this.content = this.combo.getItems();
            this.startGroup(Editor.CommonUtils.getLocalizedString(this.combo.getGroup()));
            $.each(this.content, function (index, item) {
                var textValue = Editor.CommonUtils.getLocalizedString(item.text);
                _this.executionContext.tryExecute(function () {
                    // value, html, text
                    _this.add(item.value, textValue, textValue);
                }, "Add ckeditor combo elements");
            });
        };
        /**
         * Sets action by clicking on the combo item.
         * @param value of the combo item.
         */
        CKEditorComboAdapter.prototype.onClick = function (value) {
            var _this = this;
            var selectedItem = this.content.filter(function (item) {
                // prettier-ignore
                if (item.value == value) { // tslint:disable-line
                    return true;
                }
            })[0];
            var textValue = Editor.CommonUtils.getLocalizedString(selectedItem.text);
            this.label = textValue;
            this.executionContext.tryExecute(function () {
                _this.setValue(selectedItem.value, textValue);
                _this.editor.focus();
                // execute command
                _this.combo.getCommand().exec($(_this.editor.element.$), null, null, value);
                // We need to save the state to display the selected value in the dropdown
                _this.editor.focus();
                _this.editor.fire(_this.saveEditorState);
            }, "Set ckeditor combo value", true, function () {
                _this.editor.focus();
            });
        };
        /**
         * Gets the name of the command.
         */
        CKEditorComboAdapter.prototype.getName = function () {
            return this.combo.getName();
        };
        return CKEditorComboAdapter;
    }());
    Editor.CKEditorComboAdapter = CKEditorComboAdapter;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    /**
     * Adapter between ICommand and CKEDITOR.commandDefinition.
     */
    var CKEditorCommandAdapter = /** @class */ (function () {
        /**
         * Initializes a new instance of the CKEditorCommandAdapter.
         * @param command an instance of ICommand.
         * @param getElementFunction function to get the currently selected element.
         * @param getWrappedBlockFunction function to get the top-wrapping element for the selected element.
         * @param logger the logger.
         */
        function CKEditorCommandAdapter(command, getElementFunction, getWrappedBlockFunction, executionContext) {
            /**
             * Indicates that this command is sensitive to the selection context.
             * If true, the CKEDITOR.command.refresh method will be called for this command on selection changes,
             * with a single parameter representing the current elements path.
             */
            this.contextSensitive = false;
            this.readOnly = command.enabledOnReadOnly();
            this.command = command;
            this.getElementFunction = getElementFunction;
            this.getWrappedBlockFunction = getWrappedBlockFunction;
            this.executionContext = executionContext;
            this.contextSensitive = command.isContextSensitive();
        }
        /**
         * Gets the name of the command.
         */
        CKEditorCommandAdapter.prototype.getName = function () {
            return this.command.getName();
        };
        /**
         * Command executed from CKEditor.
         * Maps between the CKEditor version and ICommand.execute.
         * @param editor an instance of CKEditor.Editor.
         * @param data data, if any.
         */
        CKEditorCommandAdapter.prototype.exec = function (editor, data) {
            var _this = this;
            var result = false;
            this.executionContext.tryExecute(function () {
                var selectedBlock = _this.getElementFunction();
                var containerBlock = _this.getWrappedBlockFunction(selectedBlock);
                var selectedHtmlObject = editor.getSelectedHtml();
                var selectedHtml = Utility.isNullOrUndefined(selectedHtmlObject) ? $() : $(selectedHtmlObject.$);
                // Selected HTML jQuery object needs to be normalized (IE and FX wrap selection into DocumentFragment and jQuery doesn't 'find' inside it)
                var normalizedSelectedHtml = !Utility.isNullOrUndefined(selectedHtml.prop) &&
                    selectedHtml.prop("nodeName") === "#document-fragment"
                    ? selectedHtml.contents()
                    : selectedHtml;
                result = _this.command.exec(selectedBlock, containerBlock, normalizedSelectedHtml);
            }, "Execute CKEditor command", false, null, new Dictionary({ CommandName: this.getName() }));
            this.setSelected();
            return result;
        };
        /**
         * Defined by the command definition, a function to determine the command state.
         * It will be invoked when the editor has its states or selection changed.
         * @param editor
         * @param path selected element
         */
        CKEditorCommandAdapter.prototype.refresh = function (editor, path) {
            var element = $(path.lastElement.getOuterHtml());
            if (this.command.shouldSetToolHighlight(element)) {
                this.setSelected();
            }
            else {
                this.setVisible();
            }
        };
        CKEditorCommandAdapter.prototype.setSelected = function () {
            this.setState(CKEDITOR.TRISTATE_ON);
        };
        CKEditorCommandAdapter.prototype.setVisible = function () {
            this.setState(CKEDITOR.TRISTATE_OFF);
        };
        return CKEditorCommandAdapter;
    }());
    Editor.CKEditorCommandAdapter = CKEditorCommandAdapter;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="ContextExecution/IExecutionContext.ts" />
/// <reference path="ContextExecution/DefaultExecutionContext.ts" />
/// <reference path="DesignerEditor/CkEditorCommand.ts" />
/// <reference path="Popups/IPopupRenderer.ts" />
/// <reference path="Popups/PopupRenderer.ts" />
/// <reference path="IControl.ts" />
/// <reference path="Control.ts" />
/// <reference path="Utils\CommonUtils.ts" />
/// <reference path="Utils\BrowserQuirks.ts" />
/// <reference path="CommonConstants.ts" />
/// <reference path="Popups\AccessibilityInstructionsPopup.ts" />
/// <reference path="Accessibility\AccessibilityInstructionsDialog\IAccessibilityDialogElement.ts" />
/// <reference path="Accessibility\AccessibilityInstructionsDialog\EditorAccessibilityInstructions.ts" />
/// <reference path="Accessibility\AriaAttributeNames.ts" />
// Controllers
/// <reference path="DesignerEditor\CommonControllers\DroppableController.ts" />
/// <reference path="DesignerEditor\CommonControllers\DragModeController.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockProvider.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockDefinition.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockDefinitionFactory.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockDraggableController.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockEditableController.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockIdController.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockLoadedController.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockClickedController.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockAddModeController.ts" />
/// <reference path="DesignerEditor\BlockControllers\IBlockController.ts" />
/// <reference path="DesignerEditor\BlockControllers\BlockDroppableController.ts" />
/// <reference path="DesignerEditor\ContainerControllers\ContainerProvider.ts" />
/// <reference path="DesignerEditor\ContainerControllers\ContainerAddModeController.ts" />
/// <reference path="DesignerEditor\ContainerControllers\IContainerController.ts" />
// End Controllers
/// <reference path="Configuration\BlockDetailsView\DetailsViewConstants.ts" />
/// <reference path="Configuration\BlockDetailsView\DetailsViewPropertiesUtils.ts" />
/// <reference path="Configuration\BlockDetailsView\DimensionHolder.ts" />
/// <reference path="Configuration\BlockDetailsView\IBlockDetailsView.ts" />
/// <reference path="Configuration\BlockDetailsView\DividerDetailsView.ts" />
/// <reference path="Configuration\BlockDetailsView\ButtonDetailsView.ts" />
/// <reference path="Configuration\BlockDetailsView\ImageDetailsView.ts" />
/// <reference path="Configuration\BlockDetailsView\DetailsViewControl.ts" />
/// <reference path="Configuration\BlockDetailsView\IDetailsViewControl.ts" />
/// <reference path="Configuration\BlockDetailsView\Renderers\ISectionRenderer.ts" />
/// <reference path="Configuration\BlockDetailsView\Renderers\SectionRenderer.ts" />
/// <reference path="Configuration\BlockDetailsView\Renderers\IInputFieldRenderer.ts" />
/// <reference path="Configuration\BlockDetailsView\Renderers\InputFieldRenderer.ts" />
/// <reference path="Configuration\Blocks\IBlock.ts" />
/// <reference path="EventArgs\EventArgs.ts" />
/// <reference path="DesignerEditor\EventArgs\BlockModificationEventArgs.ts" />
/// <reference path="DesignerEditor\EventArgs\SectionModificationEventArgs.ts" />
/// <reference path="DesignerEditor\EventArgs\DesignerAddStartEventArgs.ts" />
/// <reference path="DesignerEditor\EventArgs\BlockCleanupRequestedEventArgs.ts" />
/// <reference path="DesignerEditor\DesignerInternalEventConstants.ts" />
/// <reference path="DesignerEditor\EventArgs\CKEditorInstanceReadyEventArgs.ts" />
/// <reference path="DesignerEditor\EventArgs\CkEditorFocusEventArgs.ts" />
/// <reference path="EventArgs\ContentChangedEventArgs.ts" />
/// <reference path="EventArgs\ImageAttributeChangedEventArgs.ts" />
/// <reference path="EventArgs\ToolbarShownEventArgs.ts"/>
/// <reference path="EventArgs\HrefAttributeChangedEventArgs.ts" />
/// <reference path="EventArgs\ControlRenderedEventArgs.ts" />
/// <reference path="EventArgs\ControllerReadyEventArgs.ts" />
/// <reference path="DesignerEditor\EventArgs\SelectionChangedEventArgs.ts" />
/// <reference path="DesignerEditor\MenuBar\MenuBarView.ts" />
/// <reference path="DesignerEditor\MenuBar\UndoButton.ts"/>
/// <reference path="DesignerEditor\MenuBar\SaveButton.ts"/>
/// <reference path="DesignerEditor\MenuBar\RedoButton.ts"/>
/// <reference path="DesignerEditor\MenuBar\ToolsList.tsx"/>
/// <reference path="DesignerEditor\MenuBar\ToolsDropdown.tsx"/>
/// <reference path="Factory\AxeCoreFactory.ts" />
/// <reference path="Factory\EditorControlFactory.ts" />
/// <reference path="Factory\BasicPluginFactory.ts" />
/// <reference path="Factory\BrowserPreviewFactory.ts" />
/// <reference path="Factory\DetailsViewControlFactory.ts" />
/// <reference path="Layout\ILayoutRenderer.ts" />
/// <reference path="HtmlEditor\HtmlContentEditor.ts" />
/// <reference path="HtmlEditor\HtmlContentHighlightParser.ts" />
/// <reference path="HtmlEditor\IHtmlContentHighlightRangeModel.ts" />
/// <reference path="HtmlEditor\HtmlNotSupportedView.ts" />
/// <reference path="Configuration\InlineToolbars\BasicTextInlineToolbar.ts" />
/// <reference path="Configuration\InlineToolbars\BasicButtonInlineToolbar.ts" />
/// <reference path="Configuration\InlineToolbars\BasicImageInlineToolbar.ts" />
/// <reference path="Configuration\InlineToolbars\BasicDividerInlineToolbar.ts" />
/// <reference path="Configuration\Blocks\ImageBlock.ts" />
/// <reference path="Configuration\Blocks\TextBlock.ts" />
/// <reference path="Configuration\Blocks\ButtonBlock.ts" />
/// <reference path="Configuration\Blocks\DividerBlock.ts" />
/// <reference path="Configuration\Command\DividerAlignCommand.ts" />
/// <reference path="DocumentContentModel\Contract.ts" />
/// <reference path="EventConstants.ts" />
/// <reference path="DesignerEditor\CkEditorProxy.ts" />
/// <reference path="DesignerEditor\InlineCkEditorProxy.ts" />
/// <reference path="DesignerEditor\StandardCkEditorProxy.ts" />
/// <reference path="DesignerEditor\ICkEditorProxy.ts" />
/// <reference path="DesignerEditor\CustomCkEditorConfiguration.ts" />
/// <reference path="IDisposable.ts" />
/// <reference path="Layout\ComponentLayoutConfiguration.ts" />
/// <reference path="Layout\LayoutConfiguration.ts" />
/// <reference path="Configuration\plugins\BasicPlugin.ts" />
/// <reference path="DesignerEditor\DesignerContentEditor.ts" />
/// <reference path="Layout\LayoutRenderer.ts" />
/// <reference path="ComposeControl.ts" />
/// <reference path="TabControl\TabControlItem.ts" />
/// <reference path="TabControl\TabControl.ts" />
/// <reference path="elementdata\imagedata.ts" />
/// <reference path="elementdata\linkdata.ts" />
/// <reference path="EditorControl.ts" />
/// <reference path="Configuration\plugins\IPlugin.ts" />
/// <reference path="Preview\OfflineNotSupportedPreviewView.ts" />
/// <reference path="Preview\BrowserPreview\OfflineBrowserPreviewView.ts" />
/// <reference path="Preview\BrowserPreview\PreviewHeaderItemDescription.ts" />
/// <reference path="Preview\BrowserPreview\PreviewIconDescription.ts" />
/// <reference path="Preview\BrowserPreview\PreviewTitleDescription.ts" />
/// <reference path="Preview\BrowserPreview\BrowserPreviewView.ts" />
/// <reference path="DesignerEditor\DetailsView.ts" />
/// <reference path="DesignerEditor\IDetailsViewModel.ts" />
/// <reference path="DesignerEditor\ToolboxView.ts" />
/// <reference path="Configuration\Tool\ImageTool.ts" />
/// <reference path="Configuration\Tool\ButtonTool.ts" />
/// <reference path="Configuration\Tool\TextTool.ts" />
/// <reference path="Configuration\Tool\DividerTool.ts" />
/// <reference path="Configuration\Tool\ITool.ts" />
/// <reference path="Configuration\Adapters\CKEditorPluginAdapter.ts" />
/// <reference path="Configuration\Adapters\CKEditorButtonAdapter.ts" />
/// <reference path="Configuration\Adapters\CKEditorComboAdapter.ts" />
/// <reference path="Configuration\Adapters\CKEditorCommandAdapter.ts" />
/// <reference path="typings\ckeditor.d.ts" />
/// <reference path="..\..\..\Client\OpenSource\typings\react\react.d.ts" />
/// <reference path="..\..\..\Client\OpenSource\typings\react\reactdom.d.ts" />
/// <reference path="..\..\..\Client\OpenSource\typings\react\reactglobal.d.ts" />
/// <reference path="..\..\..\Client\OpenSource\typings\csstype\index.d.ts" />
/// <reference path="..\..\..\Client\OpenSource\typings\prop-types\index.d.ts" />
/// <reference path="..\..\..\Client\OpenSource\typings\jquery\jquery.d.ts" />
/// <reference path="..\..\..\Client\OpenSource\typings\jqueryui.TypeScript.DefinitelyTyped\jqueryui.d.ts" />
/// <reference path="typings\monaco.d.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var InlineFix = /** @class */ (function (_super) {
        __extends(InlineFix, _super);
        function InlineFix(props) {
            var _this = _super.call(this, props) || this;
            _this.handleChange = function (event) {
                var _a = event.target, value = _a.value, type = _a.type, checked = _a.checked;
                value ? _this.setState({ enabled: true }) : _this.setState({ enabled: false });
                if (type === "checkbox") {
                    checked
                        ? _this.setState({ isDecorative: true, enabled: true, value: "" })
                        : _this.setState({ isDecorative: false, enabled: false });
                    _this.props.toggleDecorative(event);
                }
                else {
                    _this.setState({ value: value });
                }
            };
            _this.updateElement = function () {
                _this.setState({ enabled: false });
                _this.props.onUpdateElement();
            };
            _this.state = {
                value: "",
                isDecorative: false,
                enabled: false
            };
            if (_this.props && _this.props.violationType) {
                _this.elementToShow = _this.getInlineFixElement(_this.props.violationType);
            }
            return _this;
        }
        InlineFix.prototype.getInlineFixElement = function (violationType) {
            var elementType;
            switch (violationType) {
                case "color-contrast":
                    elementType = this.colorPickerControl;
                    break;
                case "image-alt":
                    elementType = this.imgAltFix;
                    break;
                case "document-title":
                    elementType = this.missingTitleFix;
                    break;
                default:
                    elementType = this.emptyNoHandlerFound;
                    break;
            }
            return elementType;
        };
        InlineFix.prototype.colorPickerControl = function () {
            return (React.createElement("div", { className: "colorPickerStyles" },
                React.createElement("p", { className: "inlineFixHeader" }, Editor.CommonUtils.getLocalizedString("[Details]")),
                React.createElement("div", { className: "inlineFixTextContainer" },
                    React.createElement("p", { className: "inlineFixText" }, Editor.CommonUtils.getLocalizedString("[There's not enough contrast]"))),
                React.createElement("p", { className: "inlineFixHeader statusHeader" }, Editor.CommonUtils.getLocalizedString("[Status]")),
                this.props.passed ? (React.createElement("p", { className: "inlineFixTextPassed" }, Editor.CommonUtils.getLocalizedString("[Passed]"))) : (React.createElement("p", { className: "inlineFixTextFailed" }, Editor.CommonUtils.getLocalizedString("[Failed]"))),
                React.createElement("div", { className: "inlineFixHeader" }, Editor.CommonUtils.getLocalizedString("[Resolve]")),
                React.createElement("p", { className: "inlineFixText resolveText" }, Editor.CommonUtils.getLocalizedString("[Change the font color or background color to adjust the contrast ratio.]")),
                React.createElement(Editor.ColorPickerInput, { initialTextColor: this.props.initialTextColor, handleChange: this.handleChange, initialBgColor: this.props.initialBgColor, updateTextColor: this.props.updateTextColor, updateBgColor: this.props.updateBgColor })));
        };
        InlineFix.prototype.emptyNoHandlerFound = function () {
            return React.createElement("div", null);
        };
        InlineFix.prototype.imgAltFix = function () {
            var _this = this;
            return (React.createElement("div", { className: "altFixStyles" },
                React.createElement("p", { className: "inlineFixHeader" }, Editor.CommonUtils.getLocalizedString("[Details]")),
                React.createElement("div", { className: "inlineFixTextContainer" },
                    React.createElement("p", { className: "inlineFixText" }, Editor.CommonUtils.getLocalizedString("[Alternate text should be added to all objects in the user experience.]"))),
                React.createElement("p", { className: "inlineFixHeader statusHeader" }, Editor.CommonUtils.getLocalizedString("[Status]")),
                this.props.passed ? (React.createElement("p", { className: "inlineFixTextPassed" }, Editor.CommonUtils.getLocalizedString("[Passed]"))) : (React.createElement("p", { className: "inlineFixTextFailed" }, Editor.CommonUtils.getLocalizedString("[Failed]"))),
                React.createElement("div", { className: "inlineFixHeader" }, Editor.CommonUtils.getLocalizedString("[Resolve]")),
                React.createElement("p", { className: "inlineFixText resolveText" }, Editor.CommonUtils.getLocalizedString("[Add descriptive alt text for the image.]")),
                React.createElement("label", { style: { display: "block" }, className: "inlineFixText inlineFixControlHeader" },
                    Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.altLabel),
                    " "),
                React.createElement("input", { className: "inlineFixInput axeInputBox", name: "altTextInput", type: "text", "aria-label": Editor.CommonUtils.getLocalizedString("[Enter alt text]"), placeholder: Editor.CommonUtils.getLocalizedString("[Enter alt text]"), value: this.state.value, onChange: this.handleChange, onBlur: function (event) { return _this.props.updateImgAttr(event); } }),
                React.createElement("label", { className: "decorativeCheckboxLabel" },
                    React.createElement("input", { className: Editor.DetailsViewConstants.inputItemField + " decorativeCheckbox", type: "checkbox", onChange: this.handleChange, checked: this.state.isDecorative }),
                    React.createElement("span", { className: "decorativeCheckboxIcon" }),
                    React.createElement("p", null, Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.decorativeLabel)))));
        };
        InlineFix.prototype.missingTitleFix = function () {
            var _this = this;
            return (React.createElement("div", { className: "altFixStyles" },
                React.createElement("p", { className: "inlineFixHeader" }, Editor.CommonUtils.getLocalizedString("[Details]")),
                React.createElement("div", { className: "inlineFixTextContainer" },
                    React.createElement("p", { className: "inlineFixText" }, Editor.CommonUtils.getLocalizedString("[Titles are meant to offer additional information about a web page.]"))),
                React.createElement("p", { className: "inlineFixHeader statusHeader" }, Editor.CommonUtils.getLocalizedString("[Status]")),
                this.props.passed ? (React.createElement("p", { className: "inlineFixTextPassed" }, Editor.CommonUtils.getLocalizedString("[Passed]"))) : (React.createElement("p", { className: "inlineFixTextFailed" }, Editor.CommonUtils.getLocalizedString("[Failed]"))),
                React.createElement("div", { className: "inlineFixHeader" }, Editor.CommonUtils.getLocalizedString("[Resolve]")),
                React.createElement("p", { className: "inlineFixText resolveText" }, Editor.CommonUtils.getLocalizedString("[Add a title for the email. This will be seen within the browser tab and helps users understand the context of their email for the image.]")),
                React.createElement("label", { style: { display: "block" }, className: "inlineFixText inlineFixControlHeader" }, Editor.CommonUtils.getLocalizedString("[Email title]")),
                React.createElement("input", { style: { display: "inline-block" }, className: "inlineFixInput axeInputBox", type: "text", "aria-label": Editor.CommonUtils.getLocalizedString("[Enter email title]"), placeholder: Editor.CommonUtils.getLocalizedString("[Enter email title]"), value: this.state.value, onChange: this.handleChange, onBlur: function (event) { return _this.props.updateTitleAttr(event); } })));
        };
        InlineFix.prototype.render = function () {
            var rerunAxe = Editor.CommonUtils.getLocalizedString("[Check it again]");
            return (React.createElement("div", null,
                React.createElement("button", { onClick: this.props.onDetailsDisabled, className: Editor.CommonConstants.inlinePaneHeaderClass, title: this.props.elementType }),
                React.createElement("span", { className: Editor.CommonConstants.inlinePaneHeaderClass }, this.props.elementType),
                React.createElement("p", { className: "violationType" }, this.props.title),
                this.elementToShow(),
                React.createElement("button", { className: this.state.enabled ? "checkAgainEnabled" : "checkAgainDisabled", onClick: this.updateElement, disabled: !this.state.enabled, title: rerunAxe }, rerunAxe)));
        };
        return InlineFix;
    }(React.Component));
    Editor.InlineFix = InlineFix;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Adapter between IPlugin and CKEDITOR.plugins.widget.definition.
     */
    var CKEditorDialogAdapter = /** @class */ (function () {
        function CKEditorDialogAdapter() {
            this.contents = [];
        }
        CKEditorDialogAdapter.create = function (dialog) {
            var dialogAdapter = new CKEditorDialogAdapter();
            dialogAdapter.title = dialog.getTitle();
            dialogAdapter.minHeight = dialog.getMinHeight();
            dialogAdapter.minWidth = dialog.getMinWidth();
            var dialogContents = dialog.getContents();
            for (var i = 0; i < dialogContents.length; i++) {
                var newContent = {
                    id: dialogContents[i].getId(),
                    title: dialogContents[i].getTitle(),
                    label: dialogContents[i].getLabel(),
                    elements: []
                };
                var dialogElements = dialogContents[i].getDialogElements();
                for (var j = 0; j < dialogElements.length; j++) {
                    var dialogElement = dialogElements[j];
                    var element = {
                        id: dialogElements[j].getId(),
                        label: dialogElements[j].getLabel(),
                        type: dialogElements[j].getType(),
                        style: dialogElements[j].getStyle(),
                        setup: dialogElement.setupFactory(dialogElement),
                        commit: dialogElements[j].commitFactory(dialogElement),
                        items: dialogElements[j].items && dialogElements[j].items()
                    };
                    if (!!dialogElement.onChangeFactory) {
                        element.onChange = dialogElement.onChangeFactory(dialogElement);
                    }
                    newContent.elements.push(element);
                }
                dialogAdapter.contents.push(newContent);
            }
            return dialogAdapter;
        };
        return CKEditorDialogAdapter;
    }());
    Editor.CKEditorDialogAdapter = CKEditorDialogAdapter;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Adapter between IPlugin and CKEDITOR.plugins.widget.definition.
     */
    var CKEditorWidgetAdapter = /** @class */ (function () {
        function CKEditorWidgetAdapter() {
        }
        CKEditorWidgetAdapter.create = function (widget) {
            var widgetAdapter = new CKEditorWidgetAdapter();
            if (widget.getTemplate) {
                widgetAdapter.template = widget.getTemplate();
            }
            if (widget.getDialog) {
                widgetAdapter.dialog = widget.getDialog();
            }
            if (widget.getPathName) {
                widgetAdapter.pathName = widget.getPathName();
            }
            widgetAdapter.init = widget.initFactory(widget);
            widgetAdapter.data = widget.dataFactory(widget);
            widgetAdapter.downcast = widget.downcastFactory(widget);
            widgetAdapter.getLabel = widget.getLabelFactory(widget);
            return widgetAdapter;
        };
        return CKEditorWidgetAdapter;
    }());
    Editor.CKEditorWidgetAdapter = CKEditorWidgetAdapter;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * EmailBody Details View
     */
    var EmailBodyView = /** @class */ (function () {
        function EmailBodyView(detailsViewControl, metadataFieldRendererFactory, eventBroker, editorFeatureServiceClient) {
            var _this = this;
            this.detailsViewControl = detailsViewControl;
            this.metadataFieldRendererFactory = metadataFieldRendererFactory;
            this.eventBroker = eventBroker;
            this.editorFeatureServiceClient = editorFeatureServiceClient;
            this.minDimension = 0;
            this.minDimensionForPadding = 0;
            this.maxDimensionForPadding = 200;
            this.contentChangedHandler = function (eventArgs) {
                if (eventArgs.sourceId !== _this.containerId && eventArgs.rootEventId !== _this.containerId) {
                    _this.render($(eventArgs.html));
                }
                else {
                    // Restore scroll position
                    if (_this.previousScrollPosition) {
                        if (Editor.CommonUtils.isIOS()) {
                            $("." + Editor.CommonConstants.designerContentEditorFrameWrapperClassName).scrollTop(_this.previousScrollPosition);
                        }
                        else {
                            $("." + Editor.CommonConstants.designerContentEditorFrameClassName)
                                .contents()
                                .scrollTop(_this.previousScrollPosition);
                        }
                        _this.previousScrollPosition = 0;
                    }
                }
            };
            this.onContentModelInitialized = function (eventArgs) {
                _this.documentContentModel = eventArgs.documentContentModel;
            };
            this.checkFlightForStylesTabVisibility = function (stylesTabArgs) {
                _this.stylesTab = stylesTabArgs.stylesTab;
            };
            this.detailsViewControl = detailsViewControl;
            this.metadataFieldRendererFactory = metadataFieldRendererFactory;
            this.eventBroker.subscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
            this.eventBroker.subscribe(Editor.EventConstants.stylesTabVisibility, this.checkFlightForStylesTabVisibility);
        }
        /**
         * Initializes form control
         */
        EmailBodyView.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.detailsViewControl.init(this.containerId, this.eventBroker);
            this.eventBroker.subscribe(Editor.EventConstants.contentChanged, this.contentChangedHandler);
        };
        /**
         * Disposes the form control
         */
        EmailBodyView.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.EventConstants.stylesTabVisibility, this.checkFlightForStylesTabVisibility);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentChanged, this.contentChangedHandler);
            this.detailsViewControl.dispose();
        };
        /**
         * Renders the form control
         */
        EmailBodyView.prototype.render = function (selectedBlock) {
            this.clearContainer();
            /*
            if (false) {
                 renderEmailBodyProperties inside if(false) because it is not for early access and
                when the design is finalized this can be reused.
                Email body properties are: maxWidth, maxHeight, padding -top, bottom, left and right
                this.renderEmailBodyProperties(selectedBlock);
            }*/
            this.renderStyles(selectedBlock);
        };
        EmailBodyView.prototype.renderEmailBodyProperties = function (selectedBlock) {
            var _this = this;
            var emailBodySection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.emailBodyTitle));
            emailBodySection.find("." + Editor.DetailsViewConstants.sectionContentClassName).addClass("columnsInput");
            this.detailsViewControl.createInputField(emailBodySection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.emailBodyMaxWidthLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.emailBodyMaxWidthInputCssClass, this.getMaxWidth(selectedBlock), {
                min: this.minDimension,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.emailBodyMaxWidthInputCssClass)
            }, function (inputField) {
                _this.onMaxWidthFieldUpdated(selectedBlock, inputField);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val, event) {
                _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.widthAttribute);
            }, Editor.DetailsViewConstants.pixels);
            this.detailsViewControl.createInputField(emailBodySection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.emailBodyMaxHeightLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.emailBodyMaxHeightInputCssClass, this.getMaxHeight(selectedBlock), {
                min: this.minDimension,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.emailBodyMaxHeightInputCssClass)
            }, function (inputField) {
                _this.onMaxHeightFieldUpdated(selectedBlock, inputField);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val, event) {
                _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.maxHeightAttribute);
            }, Editor.DetailsViewConstants.pixels);
            this.detailsViewControl.createInputField(emailBodySection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.paddingTopLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingTopInputCssClass, this.getPadding(selectedBlock, Editor.DetailsViewConstants.paddingTopAttribute), {
                min: this.minDimensionForPadding,
                max: this.maxDimensionForPadding,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.paddingTopInputCssClass)
            }, function (inputField) {
                _this.onPaddingFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.paddingTopAttribute);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val, event) {
                _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.paddingTopAttribute);
            }, Editor.DetailsViewConstants.pixels);
            this.detailsViewControl.createInputField(emailBodySection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.paddingBottomLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingBottomInputCssClass, this.getPadding(selectedBlock, Editor.DetailsViewConstants.paddingBottomAttribute), {
                min: this.minDimensionForPadding,
                max: this.maxDimensionForPadding,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.paddingBottomInputCssClass)
            }, function (inputField) {
                _this.onPaddingFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.paddingBottomAttribute);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val, event) {
                _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.paddingBottomAttribute);
            }, Editor.DetailsViewConstants.pixels);
            this.detailsViewControl.createInputField(emailBodySection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.paddingLeftLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingLeftInputCssClass, this.getPadding(selectedBlock, Editor.DetailsViewConstants.paddingLeftAttribute), {
                min: this.minDimensionForPadding,
                max: this.maxDimensionForPadding,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.paddingLeftInputCssClass)
            }, function (inputField) {
                _this.onPaddingFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.paddingLeftAttribute);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val, event) {
                _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.paddingLeftAttribute);
            }, Editor.DetailsViewConstants.pixels);
            this.detailsViewControl.createInputField(emailBodySection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.paddingRightLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingRightInputCssClass, this.getPadding(selectedBlock, Editor.DetailsViewConstants.paddingRightAttribute), {
                min: this.minDimensionForPadding,
                max: this.maxDimensionForPadding,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.paddingRightInputCssClass)
            }, function (inputField) {
                _this.onPaddingFieldUpdated(selectedBlock, inputField, Editor.DetailsViewConstants.paddingRightAttribute);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val, event) {
                _this.onReactValidate(val, selectedBlock[0], Editor.DetailsViewConstants.paddingRightAttribute);
            }, Editor.DetailsViewConstants.pixels);
        };
        EmailBodyView.prototype.onReactValidate = function (val, element, cssPropertyName) {
            var _this = this;
            element.style[cssPropertyName] = val;
            this.spinButtonDebounce(function () {
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(_this.containerId));
            }, Editor.DetailsViewConstants.spinButtonDebounceTime);
        };
        EmailBodyView.prototype.spinButtonDebounce = function (func, wait) {
            var later = function () {
                this.spinButtonDebounceTimeout = null;
                func.apply(this, arguments);
            };
            clearTimeout(this.spinButtonDebounceTimeout);
            this.spinButtonDebounceTimeout = setTimeout(later.bind(this), wait);
        };
        EmailBodyView.prototype.getMaxWidth = function ($block) {
            var maxWidth = $block.css(Editor.DetailsViewConstants.maxWidthAttribute);
            if (Utility.isNullOrUndefined(maxWidth) || maxWidth === "" || maxWidth === "px") {
                maxWidth = this.minDimension.toString();
            }
            else {
                maxWidth = Editor.CommonUtils.getOnlyPixelsValueFromString(maxWidth).toString();
            }
            return maxWidth;
        };
        EmailBodyView.prototype.onMaxWidthFieldUpdated = function (selectedBlock, inputElement) {
            var maxWidth = inputElement.val();
            if (maxWidth < this.minDimension) {
                maxWidth = this.minDimension;
                inputElement.val(maxWidth);
            }
            selectedBlock.css(Editor.DetailsViewConstants.maxWidthAttribute, maxWidth + "px");
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        EmailBodyView.prototype.getMaxHeight = function (selectedBlock) {
            var maxHeight = selectedBlock.css(Editor.DetailsViewConstants.maxHeightAttribute);
            var px = "px";
            var none = "none";
            if (Utility.isNullOrUndefined(maxHeight) || maxHeight === "" || maxHeight === px || maxHeight === none) {
                maxHeight = this.minDimension.toString();
            }
            else {
                maxHeight = Editor.CommonUtils.getOnlyPixelsValueFromString(maxHeight).toString();
            }
            return maxHeight;
        };
        EmailBodyView.prototype.onMaxHeightFieldUpdated = function (selectedBlock, inputElement) {
            var maxHeight = inputElement.val();
            if (maxHeight < this.minDimension) {
                maxHeight = this.minDimension;
                inputElement.val(maxHeight);
            }
            selectedBlock.css(Editor.DetailsViewConstants.maxHeightAttribute, maxHeight + "px");
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        EmailBodyView.prototype.getPadding = function (selectedBlock, paddingAttribute) {
            var padding = selectedBlock.css(paddingAttribute);
            var px = "px";
            var none = "none";
            if (Utility.isNullOrUndefined(padding) || padding === "" || padding === px || padding === none) {
                padding = this.minDimensionForPadding.toString();
            }
            else {
                padding = Editor.CommonUtils.getOnlyPixelsValueFromString(padding).toString();
            }
            return padding;
        };
        EmailBodyView.prototype.onPaddingFieldUpdated = function (selectedBlock, inputElement, paddingAttribute) {
            var padding = inputElement.val();
            if (padding > this.maxDimensionForPadding || padding < this.minDimensionForPadding) {
                padding = this.minDimensionForPadding;
                inputElement.val(padding);
            }
            selectedBlock.css(paddingAttribute, padding + "px");
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        EmailBodyView.prototype.clearContainer = function () {
            Editor.CommonUtils.getById(this.containerId).empty();
        };
        EmailBodyView.prototype.renderStyles = function (selectedBlock) {
            var _this = this;
            if (Utility.isNullOrUndefined(this.documentContentModel)) {
                return;
            }
            if (this.stylesTab) {
                var tabButton = $(MktSvc.Controls.Common.String.Format("[aria-controls={0}]", this.stylesTab.tabContentElementId));
                var index = tabButton.index();
                if (index !== -1) {
                    Editor.CommonUtils.getById(this.stylesTab.tabContentElementId).hide();
                    tabButton.hide();
                }
                this.stylesTab.disable();
            }
            var styleSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.emailBodyStyles));
            var metaEntries = this.documentContentModel.getStyleMetaEntries();
            var contentDocument = this.documentContentModel.getContentNode();
            var hasMetaEntries = false;
            metaEntries.forEach(function (metaEntry) {
                // Only show variables used/referenced in the HTML
                var onFieldUpdate = function (inputField) {
                    var newValue = inputField.val();
                    _this.documentContentModel.updateStyleMetaValue(metaEntry, newValue);
                    var html = Editor.CommonUtils.getDocumentContent(_this.documentContentModel.getContentNode(), _this.documentContentModel.getDoctype());
                    // Save scroll position before notifying that content was changed
                    if (Editor.CommonUtils.isIOS()) {
                        _this.previousScrollPosition = $("." + Editor.CommonConstants.designerContentEditorFrameWrapperClassName).scrollTop();
                    }
                    else {
                        _this.previousScrollPosition = $("." + Editor.CommonConstants.designerContentEditorFrameClassName)
                            .contents()
                            .scrollTop();
                    }
                    _this.eventBroker.notify(Editor.EventConstants.contentChanged, new Editor.ContentChangedEventArgs(html, _this.containerId));
                };
                if (metaEntry.isReferenced &&
                    !Utility.isNullOrUndefined(metaEntry.dataType) &&
                    !Utility.isNullOrUndefined(metaEntry.value)) {
                    var metadataFieldRenderer = _this.metadataFieldRendererFactory.create(metaEntry.dataType);
                    metadataFieldRenderer.render(styleSection, metaEntry, _this.eventBroker, _this.containerId, onFieldUpdate);
                    hasMetaEntries = true;
                }
            });
            if (!hasMetaEntries) {
                var emptyViewMessage = Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.emptyStylesViewMessage);
                var emptyWatermark = $("<div>")
                    .addClass(Editor.DetailsViewConstants.emptyWatermarkClassName)
                    .text(emptyViewMessage);
                Editor.CommonUtils.getById(this.containerId).append(emptyWatermark);
            }
            Editor.CommonUtils.getById(this.containerId)
                .find("." + Editor.DetailsViewConstants.sectionContainerClassName)
                .toggle(hasMetaEntries);
            this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.containerId, Editor.CommonUtils.getDocumentContent(contentDocument, this.documentContentModel.getDoctype())));
        };
        return EmailBodyView;
    }());
    Editor.EmailBodyView = EmailBodyView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CheckboxRenderer = /** @class */ (function () {
        function CheckboxRenderer() {
        }
        CheckboxRenderer.prototype.render = function (label, value, attributes, onChange) {
            var inputContainer = $("<div>", { class: Editor.DetailsViewConstants.inputControlContainerClassName });
            var fieldWrapper = $("<div>", {
                class: Editor.DetailsViewConstants.inputItemField + " " + Editor.DetailsViewConstants.checkboxFieldClassName
            });
            var $checkbox = $("<input>")
                .attr(__assign(__assign({}, attributes), { type: "checkbox", class: Editor.DetailsViewConstants.inputCheckboxCssClass }))
                .prop("checked", value)
                .on("change", onChange);
            var $label = $("<label>", {
                for: attributes.id
            }).text(label);
            fieldWrapper.append($checkbox, $label);
            inputContainer.append(fieldWrapper);
            return inputContainer;
        };
        return CheckboxRenderer;
    }());
    Editor.CheckboxRenderer = CheckboxRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Input Color Field Renderer Class
     */
    var InputColorFieldRenderer = /** @class */ (function () {
        function InputColorFieldRenderer(inputFieldRenderer) {
            this.inputFieldRenderer = inputFieldRenderer;
        }
        /**
         * @see IInputFieldRenderer.render
         */
        InputColorFieldRenderer.prototype.render = function (label, type, className, value, attributes, onFieldUpdated, validations) {
            var _this = this;
            var inputElement;
            var classNames = Editor.DetailsViewConstants.inputColorCssClass + " " + className;
            if (validations) {
                classNames += " inlineValidation";
            }
            var inputContainer = this.inputFieldRenderer.render(label, type, classNames, value, attributes, function () {
                _this.updatePicker(inputElement.val(), inputElement, onFieldUpdated, validations);
            }, [], Editor.CommonConstants.colorFieldAriaLabel);
            inputElement = inputContainer.find(Editor.DetailsViewConstants.inputTag);
            InputColorFieldRenderer.prototype.renderFabricColorPicker(value, onFieldUpdated, validations, inputElement);
            return inputContainer;
        };
        InputColorFieldRenderer.prototype.renderFabricColorPicker = function (value, onFieldUpdated, validations, inputElement) {
            this.renderFabricColorPickerInternal(value, inputElement, onFieldUpdated, validations);
        };
        InputColorFieldRenderer.prototype.renderColorFilledRectangle = function (inputElement, initialValue) {
            var coloredRectangle = $("<div>")
                .addClass(Editor.DetailsViewConstants.colorFilledRectangleCssClass)
                .insertAfter(inputElement);
            this.setColorFilledRectangle(coloredRectangle, initialValue);
            return coloredRectangle;
        };
        InputColorFieldRenderer.prototype.renderFabricColorPickerInternal = function (value, inputElement, onFieldUpdated, validations) {
            var _this = this;
            var coloredRectangle = this.renderColorFilledRectangle(inputElement, value);
            if (coloredRectangle) {
                if (inputElement[0] && inputElement[0].id) {
                    InputColorFieldRenderer.colorPickers[inputElement[0].id] = ReactDOM.render(React.createElement(Editor.ColorPickerRenderer, {
                        targetElement: coloredRectangle[0],
                        pickerClicked: true,
                        action: function (color) {
                            _this.updatePicker(color, inputElement, onFieldUpdated, validations);
                        }
                    }, null), coloredRectangle[0]);
                }
                else {
                    ReactDOM.render(React.createElement(Editor.ColorPickerRenderer, {
                        targetElement: coloredRectangle[0],
                        pickerClicked: true,
                        action: function (color) {
                            _this.updatePicker(color, inputElement, onFieldUpdated, validations);
                        }
                    }, null), coloredRectangle[0]);
                }
            }
        };
        InputColorFieldRenderer.prototype.updatePicker = function (newColorValue, inputElement, onFieldUpdated, validations) {
            if (!Utility.isNullOrUndefined(newColorValue)) {
                var newColor = newColorValue;
                if (validations) {
                    newColor = this.checkAndFixValidations(newColor, validations);
                }
                inputElement.val(newColor);
                if (!Utility.isNullOrUndefined(onFieldUpdated)) {
                    onFieldUpdated(inputElement);
                }
                // If the DOM is rebuilt we need to query the inputElement again, since the old inputElement references an unattached element.
                var inputElementRebuilt = $("#" + inputElement.attr("id"));
                this.setColorFilledRectangle(inputElementRebuilt.siblings("." + Editor.DetailsViewConstants.colorFilledRectangleCssClass), newColor);
            }
        };
        InputColorFieldRenderer.prototype.setColorFilledRectangle = function (coloredRectangle, newColorValue) {
            coloredRectangle.css(Editor.DetailsViewConstants.backgroundColorAttribute, newColorValue);
        };
        InputColorFieldRenderer.prototype.checkAndFixValidations = function (currentInputElemVal, validations) {
            var val = currentInputElemVal;
            if (Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.allowEmpty, validations) && val === "") {
                return "";
            }
            else {
                if (Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.checkForHex, validations) &&
                    Editor.InputValidationsUtils.hasToValidate(Editor.InputValidations.checkForRgb, validations)) {
                    var regex = new RegExp(Editor.InputValidationsConstants.validateHexAndRgbColor);
                    if (regex.test(val) === false) {
                        val = Editor.ColorUtils.white;
                    }
                }
            }
            return val.toString();
        };
        InputColorFieldRenderer.colorPickers = {};
        return InputColorFieldRenderer;
    }());
    Editor.InputColorFieldRenderer = InputColorFieldRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ColorPickerInput = /** @class */ (function (_super) {
        __extends(ColorPickerInput, _super);
        function ColorPickerInput(props) {
            var _this = _super.call(this, props) || this;
            _this.state = {
                textColor: Editor.ColorUtils.rgbToHex(_this.props.initialTextColor).toLocaleUpperCase(),
                bgColor: Editor.ColorUtils.rgbToHex(_this.props.initialBgColor, true).toLocaleUpperCase()
            };
            _this.bgRectColor = _this.state.bgColor;
            _this.textRectColor = _this.state.textColor;
            return _this;
        }
        ColorPickerInput.prototype.setColorFilledTextRectangle = function (newColorValue) {
            this.coloredRectTextRefEl.style.backgroundColor = newColorValue;
        };
        ColorPickerInput.prototype.setColorFilledBgRectangle = function (newColorValue) {
            this.coloredRectBgRefEl.style.backgroundColor = newColorValue;
        };
        ColorPickerInput.prototype.updateTextPicker = function (color) {
            var event = { target: { value: color } };
            var textColor = Editor.ColorUtils.rgbToHex(color).toLocaleUpperCase();
            this.setColorFilledTextRectangle(color);
            this.props.updateTextColor(color);
            this.setState({ textColor: textColor });
            this.props.handleChange(event);
            this.textRectColor = textColor;
        };
        ColorPickerInput.prototype.updateBgPicker = function (color) {
            var event = { target: { value: color } };
            var bgColor = Editor.ColorUtils.rgbToHex(color).toLocaleUpperCase();
            this.setColorFilledBgRectangle(color);
            this.props.updateBgColor(color);
            this.setState({ bgColor: bgColor });
            this.props.handleChange(event);
            this.bgRectColor = bgColor;
        };
        ColorPickerInput.prototype.updateBgPickerFromInput = function (event) {
            var color = event.target.value;
            this.setState({ bgColor: Editor.ColorUtils.rgbToHex(color).toLocaleUpperCase() });
            this.props.handleChange(event);
        };
        ColorPickerInput.prototype.updateTextPickerFromInput = function (event) {
            var color = event.target.value;
            this.setState({ textColor: Editor.ColorUtils.rgbToHex(color).toLocaleUpperCase() });
            this.props.handleChange(event);
        };
        ColorPickerInput.prototype.updateBgColorOnBlur = function (event) {
            var color = event.target.value;
            this.props.updateBgColor(color);
            this.setState({ bgColor: Editor.ColorUtils.rgbToHex(color).toLocaleUpperCase() });
            this.props.handleChange(event);
            this.bgRectColor = this.state.bgColor;
        };
        ColorPickerInput.prototype.updateTextColorOnBlur = function (event) {
            var color = event.target.value;
            this.props.updateTextColor(color);
            this.setState({ textColor: Editor.ColorUtils.rgbToHex(color).toLocaleUpperCase() });
            this.props.handleChange(event);
            this.textRectColor = this.state.textColor;
        };
        ColorPickerInput.prototype.render = function () {
            var _this = this;
            return (React.createElement("div", { className: "detailsViewProperties colorPickerInputContainer", style: { background: "none" } },
                React.createElement("div", { style: { display: "block" }, className: Editor.DetailsViewConstants.inputItemField + " " },
                    React.createElement("label", { className: "inlineFixText inlineFixControlHeader" }, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.fontColor)),
                    React.createElement("input", { className: "inlineFixInput colorPickerControl", type: "text", value: this.state.textColor, "aria-label": Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.fontColor), onChange: function (event) { return _this.updateTextPickerFromInput(event); }, onBlur: function (event) { return _this.updateTextColorOnBlur(event); } }),
                    React.createElement("div", { style: { backgroundColor: this.textRectColor, position: "absolute", top: "25px", left: "3px" }, ref: function (colorPickerTextRef) { return _this.coloredRectTextRefEl = colorPickerTextRef; }, className: Editor.DetailsViewConstants.colorFilledRectangleCssClass },
                        React.createElement(Editor.ColorPickerRenderer, { action: function (color) { return _this.updateTextPicker(color); } }))),
                React.createElement("div", { className: "treeViewItemField" },
                    React.createElement("label", { className: "inlineFixText inlineFixControlHeader" }, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundColor)),
                    React.createElement("input", { className: "inlineFixInput colorPickerControl", type: "text", "aria-label": Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundColor), value: this.state.bgColor, onBlur: function (event) { return _this.updateBgColorOnBlur(event); }, onChange: function (event) { return _this.updateBgPickerFromInput(event); } }),
                    React.createElement("div", { style: { backgroundColor: this.bgRectColor, position: "absolute", top: "101px", left: "3px" }, ref: function (colorPickerBgRef) { return _this.coloredRectBgRefEl = colorPickerBgRef; }, className: Editor.DetailsViewConstants.colorFilledRectangleCssClass },
                        React.createElement(Editor.ColorPickerRenderer, { action: function (color) { return _this.updateBgPicker(color); } })))));
        };
        return ColorPickerInput;
    }(React.Component));
    Editor.ColorPickerInput = ColorPickerInput;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ColorPickerRenderer = /** @class */ (function (_super) {
        __extends(ColorPickerRenderer, _super);
        function ColorPickerRenderer(props) {
            var _this = _super.call(this, props) || this;
            _this.colorButtonClicked = function () {
                _this.setState({ colorPickerVisible: !_this.state.colorPickerVisible });
            };
            _this.closeColorPicker = function (visible, e) {
                _this.setState({ colorPickerVisible: false });
            };
            _this.childCompProps = {
                properties: {
                    initColorValue: '#fffff',
                    action: function (color) {
                        if (color && color !== _this.state.color) {
                            _this.setState({ color: color });
                            _this.props.action(color);
                        }
                    },
                }
            };
            _this.state = { colorPickerVisible: false };
            return _this;
        }
        ColorPickerRenderer.prototype.shouldComponentUpdate = function (nextProp, nextState) {
            return nextState !== this.state;
        };
        ColorPickerRenderer.prototype.render = function () {
            var _this = this;
            return (React.createElement("div", null,
                React.createElement("div", { onClick: this.colorButtonClicked, className: "colorFilledRectangle-internal", ref: function (colorPickerToggleRef) { return (_this.colorPickerToggleRefEl = colorPickerToggleRef); } }),
                this.state.colorPickerVisible && React.createElement(Editor.Callout, { targetElement: this.colorPickerToggleRefEl, calloutDismissed: this.closeColorPicker, childComponent: Editor.ColorPicker, childComponentProps: this.childCompProps })));
        };
        return ColorPickerRenderer;
    }(React.Component));
    Editor.ColorPickerRenderer = ColorPickerRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var HtmlParsers = /** @class */ (function () {
        function HtmlParsers() {
        }
        HtmlParsers.text = function (value) {
            return new CKEDITOR.htmlParser.text(value);
        };
        HtmlParsers.element = function (name, attributes) {
            return new CKEDITOR.htmlParser.element(name, attributes);
        };
        return HtmlParsers;
    }());
    Editor.HtmlParsers = HtmlParsers;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CustomColumnTool = /** @class */ (function () {
        function CustomColumnTool(fcbList) {
            this.fcbList = fcbList;
        }
        CustomColumnTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.customColumnToolLabel);
        };
        CustomColumnTool.prototype.getType = function () {
            return Editor.CommonConstants.customColumnToolType;
        };
        CustomColumnTool.prototype.getContentTransformation = function () {
            var isResponsiveDesign = this.fcbList && this.fcbList.isResponsiveDesign;
            return "<div style=\"" + Editor.LayoutStyles.defaultSection + "\" class=\"containerWrapper\">\n                        <div style=\"clear:both;\"></div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.oneThirdOfSectionContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getOneThirdOfSectionContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.oneThirdOfSectionContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getOneThirdOfSectionContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.oneThirdOfSectionContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getOneThirdOfSectionContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div style=\"clear:both;\"></div>\n                    </div>";
        };
        CustomColumnTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.customColumnToolLabel);
        };
        CustomColumnTool.prototype.getCssClass = function () {
            return Editor.CommonConstants.customColumnToolCss;
        };
        CustomColumnTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Layout;
        };
        return CustomColumnTool;
    }());
    Editor.CustomColumnTool = CustomColumnTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /** Decorates Iframe element */
    var IframeDecorator = /** @class */ (function () {
        function IframeDecorator() {
        }
        /**
         *  Decorates Iframe
         * @param element the iframe container object
         * @param iframe the iframe
         */
        IframeDecorator.applyCustomization = function (element, iframe) {
            if (element && iframe) {
                IframeDecorator.customizeIframeForAutomationTest(element, iframe);
            }
        };
        /**
         * Decorate iframe with static id for automation test unless there is an id predefined
         * @param element the iframe container object
         * @param iframe the iframe
         */
        IframeDecorator.customizeIframeForAutomationTest = function (element, iframe) {
            if (iframe.id !== "") {
                return;
            }
            var idPrefix = null;
            if (element.hasClass(Editor.CommonConstants.htmlEditorTabContentClassName)) {
                idPrefix = Editor.CommonConstants.htmlEditorTabPanel;
            }
            else if (element.hasClass(Editor.CommonConstants.browserPreviewTabContentClassName) ||
                element.hasClass(Editor.CommonConstants.previewViewClassName)) {
                idPrefix = Editor.CommonConstants.previewTabPanel;
            }
            if (idPrefix) {
                iframe.id = idPrefix + IframeDecorator.iFrameSuffix;
            }
        };
        IframeDecorator.iFrameSuffix = "_iframe";
        return IframeDecorator;
    }());
    Editor.IframeDecorator = IframeDecorator;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var AccessibilityNotificator = /** @class */ (function () {
        function AccessibilityNotificator() {
        }
        AccessibilityNotificator.prototype.init = function (placeholder, id) {
            if (Utility.isNullOrUndefined(this.notificationBlock) && !Utility.isNullOrUndefined(placeholder)) {
                this.notificationBlock = document.createElement("div");
                this.notificationBlock.id = id;
                this.notificationBlock.setAttribute("aria-live", "polite");
                this.notificationBlock.setAttribute("role", "status");
                this.notificationBlock.setAttribute("aria-atomic", "false");
                this.notificationBlock.style.position = "absolute";
                this.notificationBlock.style.left = "-10000px";
                this.notificationBlock.style.top = "auto";
                this.notificationBlock.style.width = "1px";
                this.notificationBlock.style.height = "1px";
                this.notificationBlock.style.overflow = "hidden";
                placeholder.appendChild(this.notificationBlock);
            }
        };
        AccessibilityNotificator.prototype.notify = function (message) {
            if (!Utility.isNullOrUndefined(this.notificationBlock)) {
                var newMessage = document.createElement("p");
                newMessage.innerHTML = message;
                this.notificationBlock.appendChild(newMessage);
            }
        };
        return AccessibilityNotificator;
    }());
    Editor.AccessibilityNotificator = AccessibilityNotificator;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var BlockDetailsUtils;
    (function (BlockDetailsUtils) {
        function protectBlocksIfNeeded(selectedBlock, blockDetailsView) {
            if (selectedBlock == null) {
                return;
            }
            var isProtected = Editor.BlockUtils.isProtected(selectedBlock);
            if (isProtected) {
                var container = $("#" + blockDetailsView.containerId);
                var itemsToBlock = container.find("." + Editor.DetailsViewConstants.inputItemField + ":not(." + Editor.DetailsViewConstants.neverProtected + "), ." + Editor.DetailsViewConstants.textareaItemField + ":not(." + Editor.DetailsViewConstants.neverProtected + ")");
                itemsToBlock.addClass("" + Editor.DetailsViewConstants.disabled);
                itemsToBlock.find("input,select,button,textarea").prop("disabled", true);
                var disabledEls = container.find("." + Editor.DetailsViewConstants.disabled);
                if (disabledEls.length > 0) {
                    var propertiesTile = container.find("." + Editor.DetailsViewConstants.headingLabelClassName);
                    propertiesTile.toArray().forEach(function (element) {
                        var protectedText = Editor.CommonUtils.getLocalizedString("[PROTECTED]");
                        var elementHtmlText = $(element).html();
                        if (elementHtmlText.indexOf(protectedText) === -1) {
                            $(element).html(elementHtmlText + " (" + protectedText + ")");
                        }
                    });
                }
                var richDivs = container.find("[contenteditable='true']");
                richDivs.removeAttr("contenteditable");
                richDivs.addClass("" + Editor.DetailsViewConstants.richEditDisabled);
            }
        }
        BlockDetailsUtils.protectBlocksIfNeeded = protectBlocksIfNeeded;
    })(BlockDetailsUtils = Editor.BlockDetailsUtils || (Editor.BlockDetailsUtils = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var BlockFromToolItemProvider = /** @class */ (function () {
        function BlockFromToolItemProvider(toolBlockMapping) {
            this.toolBlockMapping = toolBlockMapping;
        }
        /**
         * Gets the block from the toolbox item.
         * TODO: the draggable object is the actual content transformation. We might want to change it to a thumbnail.
         * @param selectedTool - currently selected tool
         */
        BlockFromToolItemProvider.prototype.getBlockFromTool = function (selectedTool) {
            if (Utility.isNullOrUndefined(selectedTool)) {
                return $();
            }
            var blockDefinition = this.toolBlockMapping.get(selectedTool.getType());
            if (Utility.isNullOrUndefined(blockDefinition)) {
                return $();
            }
            if (selectedTool.getCategory() === Editor.ToolCategory.Layout) {
                var layoutBlock = $("<div>");
                layoutBlock.attr(Editor.Contract.dataSectionAttrName, "true");
                if (selectedTool.getType() === Editor.CommonConstants.customColumnToolType) {
                    layoutBlock.attr(Editor.Contract.dataCustomSectionAttrName, "true");
                }
                var content = selectedTool.getContentTransformation();
                layoutBlock.append(content);
                return layoutBlock;
            }
            var blockType = blockDefinition.getType();
            var block = $("<div>");
            block.attr(Editor.Contract.blockTypeAttrName, blockType);
            var contentTransformation = selectedTool.getContentTransformation();
            block.append(contentTransformation);
            return block;
        };
        BlockFromToolItemProvider.prototype.notifyOnToolSelected = function (selectedTool, eventBroker, block) {
            if (selectedTool.getCategory() === Editor.ToolCategory.Layout) {
                eventBroker.notify(Editor.DesignerInternalEventConstants.cleanPlaceholderForAddMode);
                eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddEnd, new Editor.DesignerAddEndEventArgs(Editor.ToolCategory.Layout));
                eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddSectionStart, new Editor.DesignerAddSectionStartEventArgs(block));
            }
            else {
                eventBroker.notify(Editor.DesignerInternalEventConstants.cleanPlaceholderForAddMode);
                eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddSectionEnd, new Editor.DesignerAddEndEventArgs(Editor.ToolCategory.Content));
                eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddStart, new Editor.DesignerAddStartEventArgs(block));
            }
        };
        return BlockFromToolItemProvider;
    }());
    Editor.BlockFromToolItemProvider = BlockFromToolItemProvider;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var Utility = MktSvc.Controls.Common.Utility;
    var BlockResize = /** @class */ (function () {
        function BlockResize() {
        }
        BlockResize.setResizeOnElement = function (resizableBlock, notifyContentChanged) {
            if (Utility.isNullOrUndefined(resizableBlock)) {
                return null;
            }
            var resizableElement;
            var blockType = resizableBlock.attr(Editor.Contract.blockTypeAttrName);
            switch (blockType) {
                case Editor.CommonConstants.imageToolType:
                    resizableElement = BlockResize.resizeImage(resizableBlock, notifyContentChanged);
                    break;
                case Editor.CommonConstants.dividerToolType:
                    resizableElement = BlockResize.resizeDivider(resizableBlock, notifyContentChanged);
                    break;
                case Editor.CommonConstants.buttonToolType:
                case Editor.CommonConstants.eventAdvancedToolType:
                case Editor.CommonConstants.marketingPageAdvancedToolType:
                case Editor.CommonConstants.surveyAdvancedToolType:
                case Editor.CommonConstants.customerVoiceSurveyToolType:
                    resizableElement = BlockResize.resizeButton(resizableBlock, notifyContentChanged);
                    break;
                default:
                    break;
            }
            return resizableElement;
        };
        BlockResize.resizeImage = function (resizableBlock, notifyContentChanged) {
            var _this = this;
            if (Utility.isNullOrUndefined(resizableBlock)) {
                return null;
            }
            var resizableElement = resizableBlock.find(Editor.DetailsViewConstants.imageTag);
            resizableElement.each(function (i, element) {
                // do not make placeholder image resizable
                var $element = $(element);
                if (!$element.hasClass(Editor.CommonConstants.unconfiguredImageOverlayIconCssClassName) && !$element.hasClass(Editor.CommonConstants.overlayIconImageClassName)) {
                    $element.resizable({
                        handles: Editor.CommonConstants.allHandles,
                        minWidth: 0,
                        maxWidth: 10000,
                        minHeight: 0,
                        maxHeight: 10000,
                        aspectRatio: false,
                        stop: function (event, ui) {
                            element.setAttribute(Editor.DetailsViewConstants.imgWidthAttribute, ui.size.width);
                            element.setAttribute(Editor.DetailsViewConstants.imgHeightAttribute, ui.size.height);
                            notifyContentChanged();
                        }
                    });
                    var uiWrapperElement = $element.parent();
                    var uiWrapperPresent = !Utility.isNullOrUndefined(uiWrapperElement) &&
                        uiWrapperElement.hasClass(Editor.CommonConstants.resizableWrapper);
                    if (uiWrapperPresent) {
                        // remove height and width added by ui wrapper class if image is in auto mode
                        _this.removeImageStyleWhenAttributeEmpty($element, Editor.DetailsViewConstants.imgWidthAttribute, uiWrapperElement);
                        _this.removeImageStyleWhenAttributeEmpty($element, Editor.DetailsViewConstants.imgHeightAttribute, uiWrapperElement);
                        if ($element.hasClass(Editor.CommonConstants.designerOverlayHiddenElementCssClassName)) {
                            uiWrapperElement.css({ overflow: "hidden" });
                        }
                        else {
                            uiWrapperElement.css({ overflow: "visible" });
                        }
                    }
                }
            });
            return resizableElement;
        };
        BlockResize.removeImageStyleWhenAttributeEmpty = function (element, attribute, uiWrapper) {
            if (String.isNullUndefinedOrWhitespace(element.attr(attribute))) {
                uiWrapper[0].style.removeProperty(attribute);
                element[0].style.removeProperty(attribute);
            }
        };
        BlockResize.resizeDivider = function (resizableBlock, notifyContentChanged) {
            var _this = this;
            if (Utility.isNullOrUndefined(resizableBlock)) {
                return null;
            }
            var resizableElement = resizableBlock.find(Editor.DetailsViewConstants.tableTag);
            if (resizableElement.length > 0) {
                if (Editor.CommonUtils.isInternetExplorer()) {
                    var dividerWidth = resizableElement[0].style.width;
                    resizableElement = resizableElement
                        .wrap("<div class=" + Editor.CommonConstants.resizableWrapper + "></div>")
                        .parent();
                    resizableElement.css({ width: dividerWidth });
                }
                var dividerWrapper = resizableBlock.find("." + Editor.CommonConstants.dividerWrapper);
                if (dividerWrapper.length > 0) {
                    resizableElement.resizable({
                        handles: Editor.CommonConstants.eastWestHandle,
                        minWidth: dividerWrapper.width() * 0.01,
                        maxWidth: dividerWrapper.width(),
                        resize: function (event, ui) {
                            _this.setWidthOnElementInIE(resizableElement, ui);
                        },
                        stop: function (event, ui) {
                            _this.setWidthOnElementInIE(resizableElement, ui);
                            notifyContentChanged();
                        }
                    });
                }
            }
            return resizableElement;
        };
        BlockResize.setWidthOnElementInIE = function (resizableElement, ui) {
            if (Editor.CommonUtils.isInternetExplorer()) {
                var divider = resizableElement.children().first();
                divider.css({ width: ui.size.width });
            }
        };
        BlockResize.resizeButton = function (resizableBlock, notifyContentChanged) {
            if (Utility.isNullOrUndefined(resizableBlock)) {
                return null;
            }
            var resizableElement = resizableBlock.find("a");
            if (resizableElement.length > 0) {
                resizableElement.resizable({
                    handles: Editor.CommonConstants.allHandles,
                    maxHeight: 3840,
                    minHeight: 1,
                    maxWidth: 3840,
                    minWidth: 1,
                    resize: function (event, ui) {
                        if (ui && ui.size && ui.size.height) {
                            resizableElement.css("line-height", ui.size.height + "px");
                        }
                    },
                    stop: function (event, ui) {
                        if (ui && ui.size && ui.size.height) {
                            resizableElement.css("line-height", ui.size.height + "px");
                        }
                        notifyContentChanged();
                    }
                });
            }
            return resizableElement;
        };
        BlockResize.removeResizeOnElement = function (resizableBlock, resizableElement) {
            if (!Utility.isNullOrUndefined(resizableBlock)) {
                var blockType = resizableBlock.attr(Editor.Contract.blockTypeAttrName);
                if (!Utility.isNullOrUndefined(resizableElement) && resizableElement.length > 0) {
                    switch (blockType) {
                        case Editor.CommonConstants.imageToolType:
                            this.removeResizeOnImage(resizableElement);
                            break;
                        case Editor.CommonConstants.dividerToolType:
                            this.removeResizeOnDivider(resizableElement);
                            break;
                        case Editor.CommonConstants.buttonToolType:
                        case Editor.CommonConstants.eventAdvancedToolType:
                        case Editor.CommonConstants.marketingPageAdvancedToolType:
                        case Editor.CommonConstants.surveyAdvancedToolType:
                        case Editor.CommonConstants.customerVoiceSurveyToolType:
                            this.removeResizeOnButton(resizableElement);
                            break;
                        default:
                            break;
                    }
                }
            }
        };
        BlockResize.removeResizeOnButton = function (resizableElement) {
            resizableElement.each(function (i, element) {
                var $element = $(element);
                if ($element.hasClass(Editor.CommonConstants.resizable)) {
                    $element.resizable("destroy");
                }
            });
        };
        BlockResize.removeResizeOnDivider = function (resizableElement) {
            resizableElement.each(function (i, element) {
                var $element = $(element);
                if ($element.hasClass(Editor.CommonConstants.resizable)) {
                    $element.resizable("destroy");
                    if (Editor.CommonUtils.isInternetExplorer() && $element.hasClass(Editor.CommonConstants.resizableWrapper)) {
                        var divider = $element.children();
                        if (!Utility.isNullOrUndefined(divider) && divider.length) {
                            divider.first().unwrap();
                        }
                    }
                }
            });
        };
        BlockResize.removeResizeOnImage = function (resizableElement) {
            var _this = this;
            resizableElement.each(function (i, element) {
                var $element = $(element);
                var isParentLink = function (elm) { var _a, _b; return (((_b = (_a = elm) === null || _a === void 0 ? void 0 : _a.parent()[0]) === null || _b === void 0 ? void 0 : _b.tagName.toLowerCase()) === "a"); };
                var hasLinkBeforeDestroy = isParentLink($element);
                var linkHref = hasLinkBeforeDestroy && $element.parent().attr(Editor.DetailsViewConstants.hrefAttribute);
                var linkTitle = hasLinkBeforeDestroy && $element.parent().attr(Editor.DetailsViewConstants.titleAttribute);
                if ($element.hasClass(Editor.CommonConstants.resizable)) {
                    $element.resizable("destroy");
                }
                _this.removeDimensionOrMaxDimension($element, Editor.DetailsViewConstants.imgWidthAttribute, Editor.DetailsViewConstants.imgMaxWidthCssProperty);
                _this.removeDimensionOrMaxDimension($element, Editor.DetailsViewConstants.imgHeightAttribute, Editor.DetailsViewConstants.imgMaxHeightCssProperty);
                var hasLinkAfterDestroy = isParentLink($element);
                if (hasLinkBeforeDestroy && !hasLinkAfterDestroy) {
                    // Restore img link in case it was removed by resizable destroy.
                    // This happens when the link was not present before user clicked on the link
                    // and selected the block.
                    var wrapElement = $element.parent().hasClass("imageWrapper") ? $element.parent() : $element;
                    wrapElement.wrap($("<a>")
                        .attr(Editor.DetailsViewConstants.hrefAttribute, linkHref)
                        .attr(Editor.DetailsViewConstants.titleAttribute, linkTitle));
                }
            });
        };
        BlockResize.removeDimensionOrMaxDimension = function (element, property, maxProperty) {
            if (String.isNullUndefinedOrWhitespace(element.attr(property))) {
                element[0].style.removeProperty(property);
            }
            else {
                element[0].style.removeProperty(maxProperty);
            }
        };
        BlockResize.cleanUpResize = function (content) {
            var resizableWrapper = content.find("." + Editor.CommonConstants.resizableWrapper);
            if (resizableWrapper.length > 0 && !Utility.isNullOrUndefined(resizableWrapper.children())) {
                var wrappedResizableElement = resizableWrapper.children().first();
                if (wrappedResizableElement.length > 0) {
                    wrappedResizableElement.unwrap();
                }
            }
            var resizableHandle = content.find("." + Editor.CommonConstants.resizableHandleClass);
            if (resizableHandle.length > 0) {
                resizableHandle.remove();
            }
            var resizable = content.find("." + Editor.CommonConstants.resizable);
            if (resizable.length > 0) {
                resizable.removeClass(Editor.CommonConstants.resizable);
            }
        };
        return BlockResize;
    }());
    Editor.BlockResize = BlockResize;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var RemoveAbTestingContentModelProcessor = /** @class */ (function () {
        function RemoveAbTestingContentModelProcessor(abTestingContext) {
            this.abTestingContext = abTestingContext;
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        RemoveAbTestingContentModelProcessor.prototype.process = function (documentContent) {
            var _this = this;
            documentContent.querySelectorAll("" + Editor.AbTestingUtils.constants.tagName.abTesting).forEach(function (abBlock) {
                Editor.AbTestingUtils.unwrapAbBlock(abBlock, _this.abTestingContext, false);
            });
        };
        /**
         * Returns the name of the content model processor.
         */
        RemoveAbTestingContentModelProcessor.prototype.getName = function () {
            return "RemoveAbTestingContentModelProcessor";
        };
        /**
         * Dispose.
         */
        RemoveAbTestingContentModelProcessor.prototype.dispose = function () { };
        return RemoveAbTestingContentModelProcessor;
    }());
    Editor.RemoveAbTestingContentModelProcessor = RemoveAbTestingContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var AbTestingBodyTestDeletedEventArgs = /** @class */ (function (_super) {
        __extends(AbTestingBodyTestDeletedEventArgs, _super);
        function AbTestingBodyTestDeletedEventArgs(testIds) {
            var _this = _super.call(this) || this;
            _this.deletedTests = typeof testIds === "object" ? testIds : JSON.parse(testIds);
            return _this;
        }
        return AbTestingBodyTestDeletedEventArgs;
    }(Editor.EventArgs));
    Editor.AbTestingBodyTestDeletedEventArgs = AbTestingBodyTestDeletedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var EmailTemplateChangedEventArgs = /** @class */ (function (_super) {
        __extends(EmailTemplateChangedEventArgs, _super);
        function EmailTemplateChangedEventArgs(templateId) {
            var _this = _super.call(this, null) || this;
            _this.templateId = templateId;
            return _this;
        }
        return EmailTemplateChangedEventArgs;
    }(Editor.EventArgs));
    Editor.EmailTemplateChangedEventArgs = EmailTemplateChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var EmailContentLanguageLocaleChangedEventArgs = /** @class */ (function (_super) {
        __extends(EmailContentLanguageLocaleChangedEventArgs, _super);
        function EmailContentLanguageLocaleChangedEventArgs(localeId) {
            var _this = _super.call(this, null) || this;
            _this.localeId = localeId;
            return _this;
        }
        return EmailContentLanguageLocaleChangedEventArgs;
    }(Editor.EventArgs));
    Editor.EmailContentLanguageLocaleChangedEventArgs = EmailContentLanguageLocaleChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var EmailPreheaderValueChangedEventArgs = /** @class */ (function (_super) {
        __extends(EmailPreheaderValueChangedEventArgs, _super);
        function EmailPreheaderValueChangedEventArgs(preheaderValue) {
            var _this = _super.call(this, "preheader") || this;
            _this.preheaderValue = preheaderValue;
            return _this;
        }
        return EmailPreheaderValueChangedEventArgs;
    }(Editor.EventArgs));
    Editor.EmailPreheaderValueChangedEventArgs = EmailPreheaderValueChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var EmailSubjectValueChangedEventArgs = /** @class */ (function (_super) {
        __extends(EmailSubjectValueChangedEventArgs, _super);
        function EmailSubjectValueChangedEventArgs(subjectValue) {
            var _this = _super.call(this, null) || this;
            _this.subjectValue = subjectValue;
            return _this;
        }
        return EmailSubjectValueChangedEventArgs;
    }(Editor.EventArgs));
    Editor.EmailSubjectValueChangedEventArgs = EmailSubjectValueChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var EmailFromNameValueChangedEventArgs = /** @class */ (function (_super) {
        __extends(EmailFromNameValueChangedEventArgs, _super);
        function EmailFromNameValueChangedEventArgs(fromNameValue) {
            var _this = _super.call(this, null) || this;
            _this.fromNameValue = fromNameValue;
            return _this;
        }
        return EmailFromNameValueChangedEventArgs;
    }(Editor.EventArgs));
    Editor.EmailFromNameValueChangedEventArgs = EmailFromNameValueChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var EmailFromEmailValueChangedEventArgs = /** @class */ (function (_super) {
        __extends(EmailFromEmailValueChangedEventArgs, _super);
        function EmailFromEmailValueChangedEventArgs(fromEmailValue) {
            var _this = _super.call(this, null) || this;
            _this.fromEmailValue = fromEmailValue;
            return _this;
        }
        return EmailFromEmailValueChangedEventArgs;
    }(Editor.EventArgs));
    Editor.EmailFromEmailValueChangedEventArgs = EmailFromEmailValueChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var EmailToValueChangedEventArgs = /** @class */ (function (_super) {
        __extends(EmailToValueChangedEventArgs, _super);
        function EmailToValueChangedEventArgs(toValue) {
            var _this = _super.call(this, null) || this;
            _this.toValue = toValue;
            return _this;
        }
        return EmailToValueChangedEventArgs;
    }(Editor.EventArgs));
    Editor.EmailToValueChangedEventArgs = EmailToValueChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var EmailReplyToEmailValueChangedEventArgs = /** @class */ (function (_super) {
        __extends(EmailReplyToEmailValueChangedEventArgs, _super);
        function EmailReplyToEmailValueChangedEventArgs(replyToEmailValue) {
            var _this = _super.call(this, null) || this;
            _this.replyToEmailValue = replyToEmailValue;
            return _this;
        }
        return EmailReplyToEmailValueChangedEventArgs;
    }(Editor.EventArgs));
    Editor.EmailReplyToEmailValueChangedEventArgs = EmailReplyToEmailValueChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SectionCleanupRequestedEventArgs = /** @class */ (function (_super) {
        __extends(SectionCleanupRequestedEventArgs, _super);
        function SectionCleanupRequestedEventArgs() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        return SectionCleanupRequestedEventArgs;
    }(Editor.EventArgs));
    Editor.SectionCleanupRequestedEventArgs = SectionCleanupRequestedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SwitchAbTestFlagButton = /** @class */ (function () {
        function SwitchAbTestFlagButton(eventBroker, localizationProvider, abTestingContext) {
            this.eventBroker = eventBroker;
            this.localizationProvider = localizationProvider;
            this.abTestingContext = abTestingContext;
        }
        SwitchAbTestFlagButton.prototype.render = function (context) {
            var _this = this;
            var button = Editor.DomOperation.newHtmlElement("button", {
                "setAttribute": ["type", Editor.CommonConstants.buttonType],
                "onclick": function (e) {
                    e.stopPropagation();
                    _this.switchContext(button, context);
                },
                "textContent": "A/B",
                "className": Editor.CommonConstants.decoratedAreaAbTestingButtonCssClass + " " + Editor.CommonConstants.decoratedAreaButtonCssClass,
                "data-type": Editor.CommonConstants.AbTestingButtonData
            });
            var block = context.selectedBlock;
            var isAbBlock = Editor.AbTestingUtils.hasVariantForCurrentTest(block, this.abTestingContext);
            if (isAbBlock) {
                this.switchButtonOn(button);
            }
            else {
                this.switchButtonOff(button);
            }
            return button;
        };
        SwitchAbTestFlagButton.prototype.switchContext = function (button, context) {
            var block = context.selectedBlock;
            var isAbBlock = Editor.AbTestingUtils.hasVariantForCurrentTest(block, this.abTestingContext);
            var selectedBlock;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.resetItemSelection);
            selectedBlock = isAbBlock
                ? Editor.AbTestingUtils.removeAbBlock(block, this.abTestingContext)
                : Editor.AbTestingUtils.addAbBlock(block, this.abTestingContext);
            if (isAbBlock) {
                this.switchButtonOff(button);
            }
            else {
                this.switchButtonOn(button);
            }
            context.selectBlock(selectedBlock);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs("AbTestButton"));
        };
        SwitchAbTestFlagButton.prototype.switchButtonOff = function (button) {
            button.classList.remove(Editor.CommonConstants.decoratedAreaAbTestingButtonInvertedCssClass);
            button.classList.remove(Editor.CommonConstants.decoratedAreaButtonInvertedCssClass);
            button.setAttribute("aria-label", this.localizationProvider.getLocalizedString(Editor.CommonConstants.enableAbTestBlockLabel));
            button.setAttribute("title", this.localizationProvider.getLocalizedString(Editor.CommonConstants.enableAbTestBlockLabel));
        };
        SwitchAbTestFlagButton.prototype.switchButtonOn = function (button) {
            button.classList.add(Editor.CommonConstants.decoratedAreaButtonInvertedCssClass);
            button.classList.add(Editor.CommonConstants.decoratedAreaAbTestingButtonInvertedCssClass);
            button.setAttribute("aria-label", this.localizationProvider.getLocalizedString(Editor.CommonConstants.disableAbTestBlockLabel));
            button.setAttribute("title", this.localizationProvider.getLocalizedString(Editor.CommonConstants.disableAbTestBlockLabel));
        };
        SwitchAbTestFlagButton.prototype.position = function () {
            return Editor.FlagButtonPosition.Top;
        };
        SwitchAbTestFlagButton.prototype.getName = function () {
            return "DeleteFlagButton";
        };
        SwitchAbTestFlagButton.prototype.shouldRender = function (context) {
            var isSectionAndContainsNoAbTestedBlocks = function () {
                return Editor.SectionProvider.isSection($(context.selectedBlock)) &&
                    Editor.BlockProvider.getBlocks($(context.selectedBlock))
                        .get()
                        .filter(function (block) { return Editor.AbTestingUtils.isVariant(block); }).length === 0;
            };
            var blockAndParentSectionIsNotAbTested = function () {
                var parentSection = Editor.BlockUtils.getClosestSection($(context.selectedBlock))[0];
                return (context.selectedBlockType === Editor.BlockConstants.SelectableType.block &&
                    (!parentSection || !Editor.AbTestingUtils.isVariant(parentSection)));
            };
            var isBodyTestingEnabled = this.abTestingContext.testProperty === "all" /* All */ || this.abTestingContext.testProperty === "body" /* EmailBody */;
            return (this.abTestingContext.isEnabled &&
                isBodyTestingEnabled &&
                context.selectedBlockType !== Editor.BlockConstants.SelectableType.subBlock &&
                (isSectionAndContainsNoAbTestedBlocks() || blockAndParentSectionIsNotAbTested()));
        };
        SwitchAbTestFlagButton.prototype.dispose = function () { };
        return SwitchAbTestFlagButton;
    }());
    Editor.SwitchAbTestFlagButton = SwitchAbTestFlagButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var AccessibilityCheckerButton = /** @class */ (function (_super) {
        __extends(AccessibilityCheckerButton, _super);
        function AccessibilityCheckerButton() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.axeCoreFactory = new Editor.AxeCoreFactory();
            _this.accessibilityCheckerEnabled = null;
            _this.editorFeatureServiceClient = null;
            return _this;
        }
        AccessibilityCheckerButton.prototype.init = function (eventBroker) {
            var _this = this;
            _super.prototype.init.call(this, eventBroker);
            this.logger = new MktSvcCommon.Logger.TelemetryLogger("EditorControl.AccessibilityCheckerButton");
            this.eventBroker.subscribe(Editor.TabControlEventConstants.tabsStateUpdated, (this.onTabsStateUpdated = function () { return _this.tabsStateUpdated(); }));
            this.editorFeatureServiceClient = Editor.EditorFeatureServiceClient.instance;
            if (this.editorFeatureServiceClient) {
                this.editorFeatureServiceClient.isAccessibilityCheckerEnabled().then(function (enabled) {
                    if (enabled) {
                        _this.render();
                    }
                });
            }
        };
        AccessibilityCheckerButton.prototype.dispose = function () {
            if (this.accessibilityCheckerButtonContainer) {
                this.accessibilityCheckerButtonContainer.remove();
            }
            this.eventBroker.unsubscribe(Editor.TabControlEventConstants.tabsStateUpdated, this.onTabsStateUpdated);
        };
        AccessibilityCheckerButton.prototype.render = function () {
            var menuBarDivider = $("<div>").addClass(Editor.CommonConstants.menuBarDividerCssClass);
            this.accessibilityCheckerButtonContainer = $("<div>").addClass("accessibility-checker");
            Editor.CommonUtils.getByClass(Editor.CommonConstants.menuBarItemsCssClass).append(menuBarDivider, this.accessibilityCheckerButtonContainer);
            var panel = React.createElement(Editor.AccessibilityCheckerCommandButton, {
                eventBroker: this.eventBroker,
                logger: this.logger,
                isAccessibilityCheckerEnabled: true
            }, null);
            ReactDOM.render(panel, this.accessibilityCheckerButtonContainer[0]);
        };
        AccessibilityCheckerButton.prototype.tabsStateUpdated = function () {
            this.toggleAccessiblityButton();
        };
        AccessibilityCheckerButton.prototype.toggleAccessiblityButton = function () {
            if (!this.accessibilityCheckerButtonContainer) {
                return;
            }
            if (Editor.CommonUtils.isVisible(Editor.CommonUtils.getByClass(Editor.CommonConstants.designerTabContentClassName))) {
                this.accessibilityCheckerButtonContainer.show();
            }
            else {
                this.accessibilityCheckerButtonContainer.hide();
            }
        };
        return AccessibilityCheckerButton;
    }(Editor.Control));
    Editor.AccessibilityCheckerButton = AccessibilityCheckerButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var AccessibilityCheckerCommandButton = /** @class */ (function (_super) {
        __extends(AccessibilityCheckerCommandButton, _super);
        function AccessibilityCheckerCommandButton(props) {
            var _this = _super.call(this, props) || this;
            _this.onPanelDismiss = function () {
                _this.setState({ isAccessibilityOpen: false });
            };
            var item = null;
            if (props.isAccessibilityCheckerEnabled) {
                item = {
                    key: 'accessibilityChecker',
                    text: Editor.CommonUtils.getLocalizedString("[Accessibility checker]"),
                    onClick: function () {
                        _this.setState({
                            isAccessibilityOpen: true
                        });
                    }
                };
            }
            _this.menuProps = { item: item };
            _this.state = {
                isAccessibilityOpen: false
            };
            return _this;
        }
        AccessibilityCheckerCommandButton.prototype.render = function () {
            var isAccessibilityOpen = this.state.isAccessibilityOpen;
            var isAccessibilityCheckerEnabled = this.props.isAccessibilityCheckerEnabled;
            return (React.createElement("div", { className: "checker-content" },
                this.renderButton(),
                isAccessibilityCheckerEnabled && isAccessibilityOpen && this.renderAccessibilityChecker()));
        };
        AccessibilityCheckerCommandButton.prototype.renderButton = function () {
            var CommandButton = window.Fabric.CommandButton;
            var getTheme = window.Fabric.getTheme;
            var theme = getTheme();
            return (React.createElement(CommandButton, { className: "checker-button", text: Editor.CommonUtils.getLocalizedString("[Accessibility checker]"), iconProps: { iconName: 'AccessibiltyChecker' }, style: {
                    'color': theme.palette.darkgrey,
                    ':hover': {
                        backgroundColor: theme.palette.lightgray
                    }
                }, onClick: this.menuProps.item.onClick }));
        };
        AccessibilityCheckerCommandButton.prototype.renderAccessibilityChecker = function () {
            return React.createElement(Editor.AccessibilityChecker, { eventBroker: this.props.eventBroker, isPanelOpen: this.state.isAccessibilityOpen, onPanelDismiss: this.onPanelDismiss });
        };
        return AccessibilityCheckerCommandButton;
    }(React.Component));
    Editor.AccessibilityCheckerCommandButton = AccessibilityCheckerCommandButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var SpinButton = /** @class */ (function (_super) {
        __extends(SpinButton, _super);
        function SpinButton(props) {
            var _this = _super.call(this, props) || this;
            _this.fabric = window.Fabric;
            _this.increment = function (val) {
                val = _this.removePlaceholder(val);
                val = _this.removeSuffix(val);
                var validNumber = Number(val).toString() === "NaN" ? 0 : Number(val);
                _this.onValidate("" + (validNumber + 1));
            };
            _this.decrement = function (val) {
                val = _this.removePlaceholder(val);
                val = _this.removeSuffix(val);
                var validNumber = Number(val).toString() === "NaN" ? 0 : Number(val);
                _this.onValidate("" + (validNumber - 1));
            };
            _this.onValidate = function (val) {
                val = _this.removeSuffix(val);
                var newVal;
                if (_this.props.placeholder && (val === "" || Number(val).toString() === "NaN")) {
                    newVal = _this.props.placeholder;
                }
                else {
                    var validNumber = Number(val).toString() === "NaN" ? 0 : Number(val);
                    newVal = _this.addSuffix("" + Math.min(_this.getMaxValue(), Math.max(_this.getMinValue(), validNumber)));
                }
                _this.setState({ value: newVal });
                _this.props.onValidate(newVal);
            };
            _this.removeSuffix = function (val) {
                if (_this.props.suffix) {
                    var index = val.indexOf(_this.props.suffix);
                    if (index >= 0) {
                        return val.substr(0, index);
                    }
                }
                return val;
            };
            _this.addSuffix = function (val) {
                if (_this.props.suffix) {
                    return val + _this.props.suffix;
                }
                return val;
            };
            if (props.placeholder && props.value === "") {
                _this.state = {
                    value: props.placeholder
                };
            }
            else {
                var suffix = props.suffix || "";
                _this.state = {
                    value: Number(props.value) + suffix
                };
            }
            return _this;
        }
        SpinButton.prototype.render = function () {
            var SpinButton = this.fabric.SpinButton;
            var _a = this.props, className = _a.className, label = _a.label, min = _a.min, max = _a.max, id = _a.id;
            var disabled = !!this.props.disabled;
            var optionalProps = MktSvc.Controls.Common.Utility.isNullOrUndefined(id)
                ? {}
                : { inputProps: { id: id } };
            return (React.createElement(SpinButton, __assign({ className: className, label: label, disabled: disabled, value: this.state.value, min: min, max: max, incrementButtonAriaLabel: Editor.CommonUtils.getLocalizedString("Increment"), decrementButtonAriaLabel: Editor.CommonUtils.getLocalizedString("Decrement"), onIncrement: this.increment, onDecrement: this.decrement, onValidate: this.onValidate }, optionalProps)));
        };
        SpinButton.prototype.componentDidUpdate = function (prevProps) {
            if (prevProps.value !== this.props.value) {
                this.setState({ value: this.props.value + this.props.suffix });
            }
        };
        SpinButton.prototype.removePlaceholder = function (val) {
            if (this.props.placeholder && val === this.props.placeholder) {
                return "" + this.getMinValue();
            }
            return val;
        };
        SpinButton.prototype.getMinValue = function () {
            return Utility.isNullOrUndefined(this.props.min) ? Number.MIN_VALUE : this.props.min;
        };
        SpinButton.prototype.getMaxValue = function () {
            return Utility.isNullOrUndefined(this.props.max) ? Number.MAX_VALUE : this.props.max;
        };
        return SpinButton;
    }(React.Component));
    Editor.SpinButton = SpinButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Toggle = /** @class */ (function (_super) {
        __extends(Toggle, _super);
        function Toggle(props) {
            var _this = _super.call(this, props) || this;
            _this.locStrings = null;
            _this.onChange = function (ev, checked) {
                _this.props.action(checked);
            };
            _this.locStrings = {
                on: Editor.CommonUtils.getLocalizedString('[on]'),
                off: Editor.CommonUtils.getLocalizedString('[off]')
            };
            return _this;
        }
        Toggle.prototype.render = function () {
            var Stack = this.props.fabric.Stack;
            var Toggle = this.props.fabric.Toggle;
            var stackTokens = { childrenGap: 10 };
            var optionalProps = MktSvc.Controls.Common.Utility.isNullOrUndefined(this.props.checkedValue)
                ? { defaultChecked: this.props.checked }
                : { checked: this.props.checkedValue };
            return (React.createElement(Stack, { tokens: stackTokens, id: this.props.containerId },
                React.createElement(Toggle, __assign({ label: this.props.label, onText: this.locStrings.on, offText: this.locStrings.off, onChange: this.onChange, role: "checkbox", id: this.props.toggleId, disabled: this.props.disabled }, optionalProps))));
        };
        return Toggle;
    }(React.Component));
    Editor.Toggle = Toggle;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ToolIconButton = /** @class */ (function (_super) {
        __extends(ToolIconButton, _super);
        function ToolIconButton(props) {
            return _super.call(this, props) || this;
        }
        ToolIconButton.prototype.render = function () {
            var _a = this.props, tool = _a.tool, i = _a.i;
            return (React.createElement("button", { title: tool.getLabel(), className: "tool-card-button", role: "menuitem", tabIndex: 0, type: Editor.CommonConstants.buttonType, "data-type": tool.getType(), "data-tool-index": i },
                React.createElement("div", { className: "toolItemIcon" },
                    React.createElement("div", { className: tool.getCssClass() }),
                    tool.getLabel())));
        };
        return ToolIconButton;
    }(React.Component));
    Editor.ToolIconButton = ToolIconButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var ToolTypeBasedSectionProvider = /** @class */ (function () {
        function ToolTypeBasedSectionProvider(sectionToToolTypeMapping) {
            this.editorFeatureServiceClient = Editor.EditorFeatureServiceClient.instance;
            this.setToolSectionMapping(sectionToToolTypeMapping);
        }
        /**
         * Set a map between tools and sections based on the map between sections and tools.
         * This is in order to be efficient while adding a new tool.
         * Thus this enable obtaining the section based on a tool.
         * @param sectionToToolTypeMapping Mapping between sections and tool types.
         */
        ToolTypeBasedSectionProvider.prototype.setToolSectionMapping = function (sectionToToolTypeMapping) {
            var _this = this;
            this.toolSectionMapping = new Dictionary();
            if (sectionToToolTypeMapping) {
                sectionToToolTypeMapping
                    .getKeys()
                    .items()
                    .forEach(function (sectionName) {
                    if (sectionName !== Editor.CommonConstants.toolboxLayoutSectionName &&
                        sectionName !== Editor.CommonConstants.toolboxDefaultSectionName) {
                        sectionToToolTypeMapping.get(sectionName).forEach(function (toolType) {
                            _this.toolSectionMapping.addOrUpdate(toolType, sectionName);
                        });
                    }
                });
            }
        };
        ToolTypeBasedSectionProvider.prototype.getSectionName = function (tool) {
            return this.toolSectionMapping.get(tool.getType());
        };
        ToolTypeBasedSectionProvider.prototype.setSectionName = function (tool, sectionName) {
            this.toolSectionMapping.addOrUpdate(tool.getType(), sectionName);
        };
        return ToolTypeBasedSectionProvider;
    }());
    Editor.ToolTypeBasedSectionProvider = ToolTypeBasedSectionProvider;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Callout = /** @class */ (function (_super) {
        __extends(Callout, _super);
        function Callout(props) {
            var _this = _super.call(this, props) || this;
            _this.fabric = window.Fabric;
            _this.onCalloutDismiss = function (e) {
                _this.setState({ calloutVisible: false });
                _this.props.calloutDismissed(false, e);
            };
            _this.setState({ calloutVisible: true });
            return _this;
        }
        Callout.prototype.componentDidUpdate = function () {
        };
        Callout.prototype.shouldComponentUpdate = function (nextProp, nextState) {
            return nextState !== this.state;
        };
        Callout.prototype.render = function () {
            var FocusTrapZone = this.fabric.FocusTrapZone;
            var FocusZone = this.fabric.FocusZone;
            var ChildComponent = this.props.childComponent;
            var Callout = this.fabric.Callout;
            return (React.createElement(Callout, { className: "ms-callout", gapSpace: "15", target: this.props.targetElement, isBeakVisible: "true", breakWidth: "12", onDismiss: this.onCalloutDismiss, directionalHint: Editor.DirectionalHint.leftCenter },
                React.createElement(FocusTrapZone, { isClickableOutsideFocusTrap: "true" },
                    React.createElement(FocusZone, null,
                        React.createElement(ChildComponent, __assign({}, this.props.childComponentProps.properties))))));
        };
        return Callout;
    }(React.Component));
    Editor.Callout = Callout;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DirectionalHint;
    (function (DirectionalHint) {
        /**
         * Appear above the target element, with the left edges of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["topLeftEdge"] = 0] = "topLeftEdge";
        /**
         * Appear above the target element, with the centers of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["topCenter"] = 1] = "topCenter";
        /**
         * Appear above the target element, with the right edges of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["topRightEdge"] = 2] = "topRightEdge";
        /**
         * Appear above the target element, aligning with the target element such that the callout tends toward the center of the screen.
         */
        DirectionalHint[DirectionalHint["topAutoEdge"] = 3] = "topAutoEdge";
        /**
         * Appear below the target element, with the left edges of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["bottomLeftEdge"] = 4] = "bottomLeftEdge";
        /**
         * Appear below the target element, with the centers of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["bottomCenter"] = 5] = "bottomCenter";
        /**
         * Appear below the target element, with the right edges of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["bottomRightEdge"] = 6] = "bottomRightEdge";
        /**
         * Appear below the target element, aligning with the target element such that the callout tends toward the center of the screen.
         */
        DirectionalHint[DirectionalHint["bottomAutoEdge"] = 7] = "bottomAutoEdge";
        /**
         * Appear to the left of the target element, with the top edges of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["leftTopEdge"] = 8] = "leftTopEdge";
        /**
         * Appear to the left of the target element, with the centers of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["leftCenter"] = 9] = "leftCenter";
        /**
         * Appear to the left of the target element, with the bottom edges of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["leftBottomEdge"] = 10] = "leftBottomEdge";
        /**
         * Appear to the right of the target element, with the top edges of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["rightTopEdge"] = 11] = "rightTopEdge";
        /**
         * Appear to the right of the target element, with the centers of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["rightCenter"] = 12] = "rightCenter";
        /**
         * Appear to the right of the target element, with the bottom edges of the callout and target aligning.
         */
        DirectionalHint[DirectionalHint["rightBottomEdge"] = 13] = "rightBottomEdge";
    })(DirectionalHint = Editor.DirectionalHint || (Editor.DirectionalHint = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ColorPicker = /** @class */ (function (_super) {
        __extends(ColorPicker, _super);
        function ColorPicker(props) {
            var _this = _super.call(this, props) || this;
            _this.fabric = window.Fabric;
            _this.locStrings = null;
            _this.renderStandardTabButtonText = function () {
                return _this.renderTabButtonText(_this.locStrings.standard);
            };
            _this.renderCustomTabButtonText = function () {
                return _this.renderTabButtonText(_this.locStrings.custom);
            };
            _this.renderTabButtonText = function (text) {
                return (React.createElement("div", { className: "text-with-ellipsis" }, text));
            };
            _this.renderColorGrid = function (colorSwatches) {
                return (React.createElement(Editor.SwatchColorPicker, { colorSwatches: colorSwatches, action: function (color) { return _this.setColor(color); } }));
            };
            _this.locStrings = {
                standard: Editor.CommonUtils.getLocalizedString('[Standard]'),
                custom: Editor.CommonUtils.getLocalizedString('[Custom]'),
                themeColors: Editor.CommonUtils.getLocalizedString('[Theme colors]'),
                standardColors: Editor.CommonUtils.getLocalizedString('[Standard colors]'),
            };
            _this.state = { color: _this.props.initColorValue };
            return _this;
        }
        ColorPicker.prototype.componentDidUpdate = function (prevProps, prevState, snapshot) {
        };
        ColorPicker.prototype.shouldComponentUpdate = function (nextProp, nextState) {
            return nextState !== this.state;
        };
        ColorPicker.prototype.render = function () {
            var Pivot = this.fabric.Pivot;
            var PivotItem = this.fabric.PivotItem;
            var PivotLinkFormat = this.fabric.PivotLinkFormat;
            var linkStyles = {
                height: 32,
                fontSize: 14
            };
            var pivotStyles = {
                link: linkStyles,
                linkIsSelected: linkStyles
            };
            return (React.createElement("div", { className: "marketing-color-picker", title: "Color picker", "aria-label": "Color picker", role: "presentation" },
                React.createElement(Pivot, { linkFormat: PivotLinkFormat.links, className: "color-picker-pivots", styles: pivotStyles },
                    React.createElement(PivotItem, { headerText: this.locStrings.standard, itemKey: "0", onRenderItemLink: this.renderStandardTabButtonText, ariaLabel: this.locStrings.standardColors, className: "swatch-picker-pivot", headerButtonProps: { title: this.locStrings.standardColors } }, this.renderSwatchColorPicker()),
                    React.createElement(PivotItem, { headerText: this.locStrings.custom, itemKey: "1", onRenderItemLink: this.renderCustomTabButtonText, ariaLabel: this.locStrings.custom, className: "custom-color-picker-pivot", headerButtonProps: { title: this.locStrings.custom } }, this.renderCustomColorPicker()))));
        };
        ColorPicker.prototype.renderSwatchColorPicker = function () {
            return (React.createElement("div", { className: "swatch-color-picker" },
                React.createElement("p", { className: "color-title" }, this.locStrings.themeColors),
                this.renderColorGrid(Editor.themeColors),
                React.createElement("p", { className: "color-title" }, this.locStrings.standardColors),
                this.renderColorGrid(Editor.standardColors)));
        };
        ColorPicker.prototype.renderCustomColorPicker = function () {
            var _this = this;
            return (React.createElement("div", null,
                React.createElement(Editor.CustomColorPicker, { initColorValue: this.props.initColorValue, action: function (color) { return _this.setColor(color.str); } })));
        };
        ColorPicker.prototype.setColor = function (color) {
            this.props.action(color);
            this.setState({ color: color });
        };
        return ColorPicker;
    }(React.Component));
    Editor.ColorPicker = ColorPicker;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    Editor.themeColors = [
        { id: "1", label: "#ffffff", color: "#ffffff" },
        { id: "7", label: "#3860b2", color: "#3860b2" },
        { id: "13", label: "#00126b", color: "#00126b" },
        { id: "19", label: "#bacae2", color: "#bacae2" },
        { id: "25", label: "#a6a6a6", color: "#a6a6a6" },
        { id: "31", label: "#0086d0", color: "#0086d0" },
        { id: "37", label: "#8dc63f", color: "#8dc63f" },
        { id: "43", label: "#f65810", color: "#f65810" },
        { id: "49", label: "#a80000", color: "#a80000" },
        { id: "2", label: "#e6e6e6", color: "#e6e6e6" },
        { id: "8", label: "#d7dff0", color: "#d7dff0" },
        { id: "14", label: "#ccd0ff", color: "#ccd0ff" },
        { id: "20", label: "#f1f4f9", color: "#f1f4f9" },
        { id: "26", label: "#ededed", color: "#ededed" },
        { id: "32", label: "#cce7f6", color: "#cce7f6" },
        { id: "38", label: "#e8f4d9", color: "#e8f4d9" },
        { id: "44", label: "#fddecf", color: "#fddecf" },
        { id: "50", label: "#eecccc", color: "#eecccc" },
        { id: "3", label: "#cccccc", color: "#cccccc" },
        { id: "9", label: "#afbfe0", color: "#afbfe0" },
        { id: "15", label: "#99a0c4", color: "#99a0c4" },
        { id: "21", label: "#e3eaf3", color: "#e3eaf3" },
        { id: "27", label: "#dbdbdb", color: "#dbdbdb" },
        { id: "33", label: "#99cfec", color: "#99cfec" },
        { id: "39", label: "#d1e8b2", color: "#d1e8b2" },
        { id: "45", label: "#fbbc9f", color: "#fbbc9f" },
        { id: "51", label: "#dc9999", color: "#dc9999" },
        { id: "4", label: "#b3b3b3", color: "#b3b3b3" },
        { id: "10", label: "#88a0d1", color: "#88a0d1" },
        { id: "16", label: "#6671a6", color: "#6671a6" },
        { id: "22", label: "#d6dfee", color: "#d6dfee" },
        { id: "28", label: "#cacaca", color: "#cacaca" },
        { id: "34", label: "#66b6e3", color: "#66b6e3" },
        { id: "40", label: "#b5dd8c", color: "#b5dd8c" },
        { id: "46", label: "#fa9b70", color: "#fa9b70" },
        { id: "52", label: "#cb6666", color: "#cb6666" },
        { id: "5", label: "#999999", color: "#999999" },
        { id: "11", label: "#3256a0", color: "#3256a0" },
        { id: "17", label: "#001060", color: "#001060" },
        { id: "23", label: "#a7b6cb", color: "#a7b6cb" },
        { id: "29", label: "#959595", color: "#959595" },
        { id: "35", label: "#0079bb", color: "#0079bb" },
        { id: "41", label: "#7fb239", color: "#7fb239" },
        { id: "47", label: "#dd4f0e", color: "#dd4f0e" },
        { id: "53", label: "#970000", color: "#970000" },
        { id: "6", label: "#808080", color: "#808080" },
        { id: "12", label: "#27437d", color: "#27437d" },
        { id: "18", label: "#000d4b", color: "#000d4b" },
        { id: "24", label: "#828d9e", color: "#828d9e" },
        { id: "30", label: "#747474", color: "#747474" },
        { id: "36", label: "#005e92", color: "#005e92" },
        { id: "42", label: "#638b2c", color: "#638b2c" },
        { id: "48", label: "#ac3e0b", color: "#ac3e0b" },
        { id: "54", label: "#760000", color: "#760000" }
    ];
    Editor.standardColors = [
        { id: "55", label: "#b80000", color: "#b80000" },
        { id: "56", label: "#ff0000", color: "#ff0000" },
        { id: "57", label: "#ffbf00", color: "#ffbf00" },
        { id: "58", label: "#ffff00", color: "#ffff00" },
        { id: "59", label: "#98d046", color: "#98d046" },
        { id: "60", label: "#36b04b", color: "#36b04b" },
        { id: "61", label: "#2771c2", color: "#2771c2" },
        { id: "62", label: "#092162", color: "#092162" },
        { id: "63", label: "#6d31a2", color: "#6d31a2" },
        { id: "64", label: "#ffffff", color: "#ffffff" },
        { id: "65", label: "#000000", color: "#000000" },
        { id: "66", label: "#ffffff00", color: "#ffffff00" }
    ];
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CustomColorPicker = /** @class */ (function (_super) {
        __extends(CustomColorPicker, _super);
        function CustomColorPicker(props) {
            var _this = _super.call(this, props) || this;
            _this.fabric = window.Fabric;
            _this.onColorSelected = function (color) {
                _this.setState({ customColorPickerColor: color });
                _this.props.action(color);
            };
            _this.state = {
                color: _this.fabric.getColorFromString(_this.props.initColorValue || '#ffffff'),
                alphaSliderHidden: false,
                showPreview: true
            };
            return _this;
        }
        CustomColorPicker.prototype.render = function () {
            var _this = this;
            var colorPickerStyles = {
                panel: { padding: 12 },
                root: {
                    maxWidth: 352,
                    minWidth: 352
                },
                colorRectangle: { height: 268 }
            };
            var ColorPicker = this.fabric.ColorPicker;
            return (React.createElement("div", { className: "custom-color-picker" },
                React.createElement(ColorPicker, { color: this.state.customColorPickerColor, onChange: function (event, color) { return _this.onColorSelected(color); }, alphaSliderHidden: this.state.alphaSliderHidden, showPreview: this.state.showPreview, styles: colorPickerStyles })));
        };
        return CustomColorPicker;
    }(React.Component));
    Editor.CustomColorPicker = CustomColorPicker;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SwatchColorPicker = /** @class */ (function (_super) {
        __extends(SwatchColorPicker, _super);
        function SwatchColorPicker(props) {
            var _this = _super.call(this, props) || this;
            _this.fabric = window.Fabric;
            return _this;
        }
        SwatchColorPicker.prototype.render = function () {
            return (React.createElement("div", null, this.renderColorSwatches(this.props.colorSwatches)));
        };
        SwatchColorPicker.prototype.renderColorSwatches = function (colorSwatches) {
            var _this = this;
            if (!colorSwatches) {
                return null;
            }
            var ColorSwatch = this.fabric.SwatchColorPicker;
            return (React.createElement(ColorSwatch, { cellShape: 'square', colorCells: colorSwatches, columnCount: 9, cellHeight: 27, cellWidth: 27, cellBorderWidth: 3, onCellFocused: function (id, color) { return _this.props.action(color); }, onColorChanged: function (id, color) { return _this.props.action(color); } }));
        };
        return SwatchColorPicker;
    }(React.Component));
    Editor.SwatchColorPicker = SwatchColorPicker;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SelectionMode;
    (function (SelectionMode) {
        SelectionMode[SelectionMode["none"] = 0] = "none";
        SelectionMode[SelectionMode["single"] = 1] = "single";
        SelectionMode[SelectionMode["multiple"] = 2] = "multiple";
    })(SelectionMode = Editor.SelectionMode || (Editor.SelectionMode = {}));
    var AxeGroupedList = /** @class */ (function (_super) {
        __extends(AxeGroupedList, _super);
        function AxeGroupedList(props) {
            var _this = _super.call(this, props) || this;
            _this.fabric = window.Fabric;
            _this.onDetailsDisabled = function () {
                _this.setState(function (prevState) { return (__assign(__assign({}, prevState), { showIssueDetails: false })); });
                _this.previousSelection && _this.previousSelection.css("border", "none");
                if (_this.permitPropRevert) {
                    _this.resetPropertyValues();
                }
            };
            _this.onUpdateElement = function () {
                _this.props.getAccessibilityIssues();
                _this.permitPropRevert = false;
                _this.props.setInitSelections(__assign(__assign({}, _this.initSettings), { permitPropRevert: _this.permitPropRevert }));
            };
            _this.enableDetails = function () {
                _this.setState(function (prevState) { return (__assign(__assign({}, prevState), { showIssueDetails: true })); });
            };
            _this.updateTextColor = function (color) {
                if (_this.currentSelection && _this.currentSelection.length) {
                    _this.currentSelection[0].style.color = color;
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.BlockChangedEventArgs(Editor.CommonUtils.getId(_this.currentSelection), _this.currentSelection));
                }
            };
            _this.updateBgColor = function (color) {
                if (_this.currentSelection && _this.currentSelection.length) {
                    _this.currentSelection[0].style.backgroundColor = color;
                }
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.BlockChangedEventArgs(Editor.CommonUtils.getId(_this.currentSelection), _this.currentSelection));
            };
            _this.updateImgAttr = function (event) {
                var value = event.target.value;
                if (value) {
                    _this.currentSelection &&
                        _this.currentSelection.attr &&
                        _this.currentSelection.attr(Editor.DetailsViewConstants.altAttribute, value);
                    _this.eventBroker.notify(Editor.EventConstants.imageAttributeChanged, new Editor.ImageAttributeChangedEventArgs(_this.currentSelection, "alt", value, null));
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.BlockChangedEventArgs(Editor.CommonUtils.getId(_this.currentSelection), _this.currentSelection));
                }
                else {
                    _this.currentSelection.removeAttr(Editor.DetailsViewConstants.altAttribute);
                }
            };
            _this.updateTitleAttr = function (event) {
                var value = event.target.value;
                var headElement = _this.currentSelection.find("head");
                if (_this.currentSelection.length) {
                    if (headElement.length) {
                        if (!headElement.find("title").length) {
                            var title = $("<title>");
                            title.html(value);
                            headElement.append(title);
                        }
                        else {
                            headElement.find("title").html(value);
                        }
                    }
                    else {
                        var head = $("<head>");
                        var title = $("<title>");
                        title.html(value);
                        head.append(title);
                        _this.currentSelection.append(head);
                    }
                }
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.BlockChangedEventArgs(Editor.CommonUtils.getId(_this.currentSelection), _this.currentSelection));
            };
            _this.toggleDecorative = function (event) {
                var checked = event.target.checked;
                var isDecorative = checked;
                if (isDecorative && _this.currentSelection) {
                    _this.currentSelection.attr(Editor.DetailsViewConstants.altAttribute, "");
                    var altTextInput = $("input[name='altTextInput']");
                    altTextInput.prop("disabled", true);
                    _this.eventBroker.notify(Editor.EventConstants.imageAttributeChanged, new Editor.ImageAttributeChangedEventArgs(_this.currentSelection, "alt", "", null));
                }
                else {
                    $("input[name='altTextInput']").prop("disabled", false);
                    _this.currentSelection.removeAttr(Editor.DetailsViewConstants.altAttribute);
                }
            };
            _this.showSelectedElement = function (item) {
                var targetPath = item.target;
                var iFrameDom = $("iframe#designer-content-editor").contents();
                _this.currentSelection = iFrameDom.find(targetPath);
                _this.currentItem = item;
                _this.permitPropRevert = true;
                if (_this.currentSelection.length) {
                    _this.initialBgColor = _this.currentSelection.css("background-color");
                    _this.initialTextColor = _this.currentSelection.css("color");
                }
                var currentViolation = _this.groups[item.groupIndex];
                if (currentViolation) {
                    var whyFix = currentViolation.whyFix, howFix = currentViolation.howFix, name_1 = currentViolation.name, violationType = currentViolation.id;
                    _this.setState({ whyFix: whyFix, howFix: howFix, name: name_1, violationType: violationType });
                }
                if (_this.currentSelection !== _this.previousSelection) {
                    _this.previousSelection && _this.previousSelection.css("border", "none");
                    _this.currentSelection.css("border", "2px solid #005A9E");
                    _this.currentSelection[0].scrollIntoView();
                    _this.previousSelection = _this.currentSelection;
                }
                _this.enableDetails();
                _this.props.removeBorderOnDismiss(_this.currentSelection);
                _this.initSettings = {
                    initBgColor: _this.initialBgColor,
                    initTextColor: _this.initialTextColor,
                    permitPropRevert: _this.permitPropRevert,
                    resetAlt: function () { return _this.resetAlt(); },
                    resetTitle: function () { return _this.resetTitle(); }
                };
                _this.props.setInitSelections(_this.initSettings);
            };
            _this._onRenderCell = function (nestingDepth, item, itemIndex) {
                return (React.createElement("div", { role: "row" },
                    React.createElement("button", { onClick: function () { return _this.showSelectedElement(item); }, className: Editor.CommonConstants.axeResultsDivCssClass, role: "gridcell" },
                        React.createElement("span", { className: Editor.CommonConstants.axeResultsGroupedListCellCssClass }, item.name),
                        React.createElement("span", { className: Editor.CommonConstants.selectAxeResultImageCssClass }))));
            };
            _this.createGroups(props.accessibilityIssues);
            _this.state = {
                showIssueDetails: false
            };
            _this.eventBroker = _this.props.eventBroker;
            return _this;
        }
        AxeGroupedList.prototype.createGroups = function (violations) {
            var start = 0;
            this.groups = [];
            this.items = [];
            for (var i = 0; i < violations.length; i++) {
                var violationNodes = violations[i];
                this.groups.push({
                    count: violationNodes.elements.length,
                    key: violationNodes.title,
                    name: violationNodes.title,
                    startIndex: start,
                    children: [],
                    whyFix: violationNodes.whyFix,
                    howFix: violationNodes.howFix,
                    id: violationNodes.id,
                    level: 0
                });
                start = start + violations[i].elements.length;
                for (var j = 0; j < violations[i].elements.length; j++) {
                    var violationNodes_1 = violations[i];
                    this.items.push({
                        target: violationNodes_1.elements[j].target,
                        name: violationNodes_1.elements[j].name,
                        type: violationNodes_1.elements[j].type,
                        groupIndex: i
                    });
                }
            }
        };
        AxeGroupedList.prototype.render = function () {
            var _this = this;
            var GroupedList = this.fabric.GroupedList;
            var inspectionResultsHeader = Editor.CommonUtils.getLocalizedString("[See the details]");
            var axeChecker = Editor.CommonUtils.getLocalizedString("[Accessibility checker]");
            this.createGroups(this.props.accessibilityIssues);
            if (this.currentItem) {
                this.passed = this.items.some(function (item) { return item.target === _this.currentItem.target; }) ? false : true;
            }
            return (React.createElement("div", null, this.state.showIssueDetails ? (React.createElement(Editor.InlineFix, { whyFix: this.state.whyFix, title: this.state.name, onDetailsDisabled: this.onDetailsDisabled, onUpdateElement: this.onUpdateElement, howFix: this.state.howFix, passed: this.passed, violationType: this.state.violationType, updateTextColor: this.updateTextColor, updateBgColor: this.updateBgColor, updateImgAttr: this.updateImgAttr, updateTitleAttr: this.updateTitleAttr, toggleDecorative: this.toggleDecorative, initialBgColor: this.initialBgColor, initialTextColor: this.initialTextColor, elementType: this.currentItem.name })) : (React.createElement("div", null,
                React.createElement("div", null,
                    React.createElement("p", { className: Editor.CommonConstants.accessibilityCheckerCssClass }, "" + axeChecker),
                    React.createElement("div", { className: Editor.CommonConstants.accessibilityInspectionResultsCardCssClass },
                        React.createElement("p", { className: Editor.CommonConstants.accessibilityInspectionResultsCardTitleCssClass }, Editor.CommonUtils.getLocalizedString("[Remaining issues]")),
                        React.createElement("p", { className: Editor.CommonConstants.accessibilityInspectionResultsCardBodyCssClass }, this.props.violationsCount)),
                    React.createElement("p", { className: Editor.CommonConstants.accessibilityCheckerMessageCssClass }, Editor.CommonUtils.getLocalizedString("[Resolving these issues can improve the overall accessibility and increase engagement.]")),
                    React.createElement("span", { className: Editor.CommonConstants.accessibilityInspectionHeaderCssClass }, inspectionResultsHeader)),
                React.createElement(GroupedList, { className: Editor.CommonConstants.axeResultsGroupedListCssClass, items: this.items, groups: this.groups, onRenderCell: this._onRenderCell, selectionMode: SelectionMode.none })))));
        };
        AxeGroupedList.prototype.resetPropertyValues = function () {
            this.updateBgColor(this.initialBgColor);
            this.updateTextColor(this.initialTextColor);
            this.resetAlt();
            this.resetTitle();
        };
        AxeGroupedList.prototype.resetAlt = function () {
            if (this.currentSelection.is("img")) {
                this.currentSelection.removeAttr(Editor.DetailsViewConstants.altAttribute);
            }
        };
        AxeGroupedList.prototype.resetTitle = function () {
            if (this.currentSelection.is("html")) {
                this.currentSelection.find("head > title").remove();
            }
        };
        return AxeGroupedList;
    }(React.Component));
    Editor.AxeGroupedList = AxeGroupedList;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TraceLevel = MktSvc.Controls.Common.TraceLevel;
    var AccessibilityChecker = /** @class */ (function (_super) {
        __extends(AccessibilityChecker, _super);
        function AccessibilityChecker(props) {
            var _this = _super.call(this, props) || this;
            _this.fabric = window.Fabric;
            _this.accessibilityIssues = [];
            _this.onPanelDismiss = function () {
                _this.removeBorder();
                _this.revertSelections();
                _this.props.onPanelDismiss();
            };
            _this.setAccessibilityIssues = function () {
                if (_this.props.logger) {
                    _this.props.logger.log(TraceLevel.Info, "Editor.setAccessibilityIssues");
                }
                var framebody = Editor.AccessibilityIssueAggregator.getFrameBody();
                new Editor.AxeCoreFactory()
                    .runAxeCore(framebody.childNodes, Editor.CommonConstants.designerContentEditorFrameClassName)
                    .then(function (results) {
                    if (results && results.violations.length) {
                        _this.accessibilityIssues = _this.accessibilityIssueAggregator.getAccessibilityIssues(results.violations);
                    }
                    else if (results && results.violations.length <= 0) {
                        _this.accessibilityIssues = [];
                    }
                    _this.setState({ loaded: true });
                })
                    .catch(function (e) {
                    console.log(e);
                    this.setState({ error: true });
                });
            };
            _this.getSelectedElem = function (selectedElement) {
                _this.selectedElem = selectedElement;
            };
            _this.setInitSelections = function (initSettings) {
                _this.initSettings = __assign({}, initSettings);
            };
            _this.state = {
                loaded: false,
                error: false,
                notSupported: false
            };
            // TODO: Pass type from EditorControlFactory and create accordingly for email/forms/pages
            _this.accessibilityIssueAggregator = new Editor.EmailAccessibilityIssueAggregator();
            return _this;
        }
        AccessibilityChecker.prototype.componentDidMount = function () {
            var _this = this;
            if (this.props.logger) {
                this.props.logger.log(TraceLevel.Info, "Editor.onAccessibilityCheckerClick");
            }
            if (navigator && (navigator.appVersion.indexOf('Edge') > -1 || navigator.appVersion.indexOf('Trident') > -1)) {
                this.setState({
                    notSupported: true,
                });
            }
            else {
                this.props.eventBroker.notify(Editor.DesignerInternalEventConstants.resetItemSelection);
                var framebody = Editor.AccessibilityIssueAggregator.getFrameBody();
                new Editor.AxeCoreFactory()
                    .runAxeCore(framebody.childNodes, Editor.CommonConstants.designerContentEditorFrameClassName)
                    .then(function (results) {
                    if (results && results.violations.length) {
                        _this.accessibilityIssues = _this.accessibilityIssueAggregator.getAccessibilityIssues(results.violations);
                    }
                    _this.setState({ loaded: true });
                })
                    .catch(function (e) {
                    console.log(e);
                    this.setState({ error: true });
                });
            }
        };
        AccessibilityChecker.prototype.removeBorder = function () {
            this.selectedElem && this.selectedElem.css("border", "none");
        };
        AccessibilityChecker.prototype.revertSelections = function () {
            if (this.initSettings) {
                var _a = this.initSettings, initBgColor = _a.initBgColor, initTextColor = _a.initTextColor, resetAlt = _a.resetAlt, resetTitle = _a.resetTitle, permitPropRevert = _a.permitPropRevert;
                if (permitPropRevert) {
                    if (this.selectedElem.length) {
                        this.selectedElem[0].style.color = initTextColor;
                        this.selectedElem[0].style.backgroundColor = initBgColor;
                    }
                    resetAlt();
                    resetTitle();
                }
            }
        };
        AccessibilityChecker.prototype.getViolationsCount = function (violationsArray) {
            var result = 0;
            for (var i = 0; i < violationsArray.length; i++) {
                if (violationsArray[i].elements) {
                    result += violationsArray[i].elements.length;
                }
            }
            return result;
        };
        AccessibilityChecker.prototype.render = function () {
            var Panel = this.fabric.Panel;
            var Spinner = this.fabric.Spinner;
            var violationsCount = this.getViolationsCount(this.accessibilityIssues);
            var axeChecker = Editor.CommonUtils.getLocalizedString("[Accessibility checker]");
            var resultView;
            if (this.state.notSupported) {
                var notSupported = Editor.CommonUtils.getLocalizedString("[Checker not supported]");
                resultView = (React.createElement("div", null,
                    React.createElement("p", { className: Editor.CommonConstants.accessibilityCheckerCssClass }, "" + axeChecker),
                    React.createElement("div", { className: Editor.CommonConstants.axeResultsGraphicCssClass },
                        React.createElement("img", { src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMSIgdmlld0JveD0iMCAwIDEwMCAxMDEiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAuMTA3OSIgcj0iNTAiIGZpbGw9IiMyMjY2RTMiLz4KPHBhdGggZD0iTTU4IDIyLjEwNzlIMzBDMjguODk1NCAyMi4xMDc5IDI4IDIzLjAwMzMgMjggMjQuMTA3OVY3Ni4xMDc5QzI4IDc3LjIxMjUgMjguODk1NCA3OC4xMDc5IDMwIDc4LjEwNzlINzBDNzEuMTA0NiA3OC4xMDc5IDcyIDc3LjIxMjUgNzIgNzYuMTA3OVYzNi4xMDc5SDYyQzU5Ljc5MDkgMzYuMTA3OSA1OCAzNC4zMTcgNTggMzIuMTA3OVYyMi4xMDc5WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTcyIDM0LjEwNzlINjJDNjAuODk1NCAzNC4xMDc5IDYwIDMzLjIxMjUgNjAgMzIuMTA3OVYyMi4xMDc5TDcyIDM0LjEwNzlaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTUwIDYzLjEwNzlDNTcuMTc5NyA2My4xMDc5IDYzIDU3LjI4NzYgNjMgNTAuMTA3OUM2MyA0Mi45MjgyIDU3LjE3OTcgMzcuMTA3OSA1MCAzNy4xMDc5QzQyLjgyMDMgMzcuMTA3OSAzNyA0Mi45MjgyIDM3IDUwLjEwNzlDMzcgNTcuMjg3NiA0Mi44MjAzIDYzLjEwNzkgNTAgNjMuMTA3OVoiIGZpbGw9IiMyMjY2RTMiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik01Ny4wNzExIDUxLjQ1MTFMNTAuNzA3MiA1Ny44MTVDNTAuMzE2NiA1OC4yMDU1IDQ5LjY4MzUgNTguMjA1NSA0OS4yOTI5IDU3LjgxNUw0Mi45MjkgNTEuNDUxMUM0Mi41Mzg1IDUxLjA2MDUgNDIuNTM4NSA1MC40Mjc0IDQyLjkyOSA1MC4wMzY4QzQzLjMxOTUgNDkuNjQ2MyA0My45NTI3IDQ5LjY0NjMgNDQuMzQzMiA1MC4wMzY4TDQ5LjAwMDEgNTQuNjkzN0w0OS4wMDAxIDQyLjEwNzlDNDkuMDAwMSA0MS41NTU2IDQ5LjQ0NzggNDEuMTA3OSA1MC4wMDAxIDQxLjEwNzlDNTAuNTUyMyA0MS4xMDc5IDUxLjAwMDEgNDEuNTU1NiA1MS4wMDAxIDQyLjEwNzlMNTEuMDAwMSA1NC42OTM3TDU1LjY1NjkgNTAuMDM2OEM1Ni4wNDc0IDQ5LjY0NjMgNTYuNjgwNiA0OS42NDYzIDU3LjA3MTEgNTAuMDM2OEM1Ny40NjE2IDUwLjQyNzQgNTcuNDYxNiA1MS4wNjA1IDU3LjA3MTEgNTEuNDUxMVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=", alt: Editor.CommonUtils.getLocalizedString("[Checker not supported]") }),
                        React.createElement("span", { className: Editor.CommonConstants.accessibilityIssuesCssClass }, notSupported))));
            }
            else if (this.state.error) {
                var errorResult = Editor.CommonUtils.getLocalizedString("[Checker error]");
                resultView = (React.createElement("div", null,
                    React.createElement("p", { className: Editor.CommonConstants.accessibilityCheckerCssClass }, "" + axeChecker),
                    React.createElement("div", { className: Editor.CommonConstants.axeResultsGraphicCssClass },
                        React.createElement("img", { src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAxIiBoZWlnaHQ9IjEwMSIgdmlld0JveD0iMCAwIDEwMSAxMDEiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0wLjUyMDk5NiAwLjEwNzkxSDEwMC41MjFWMTAwLjEwOEgwLjUyMDk5NlYwLjEwNzkxWiIgZmlsbD0id2hpdGUiLz4KPGNpcmNsZSBjeD0iNTAuNTIxIiBjeT0iNTAuMTA3OSIgcj0iNTAiIGZpbGw9IiMyMjY2RTMiLz4KPHJlY3QgeD0iMzguNTIxIiB5PSIyNi4xMDc5IiB3aWR0aD0iNiIgaGVpZ2h0PSI4IiBmaWxsPSJ3aGl0ZSIvPgo8cmVjdCB4PSI1Ni41MjEiIHk9IjI2LjEwNzkiIHdpZHRoPSI2IiBoZWlnaHQ9IjgiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0yNi41MjEgMzQuMTA3OUg3NC41MjFWMzcuMTA3OUM3NC41MjEgMzkuODY5MyA3Mi4yODI0IDQyLjEwNzkgNjkuNTIxIDQyLjEwNzlIMzEuNTIxQzI4Ljc1OTYgNDIuMTA3OSAyNi41MjEgMzkuODY5MyAyNi41MjEgMzcuMTA3OVYzNC4xMDc5WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTUxLjE4NzcgMTQuNDA3OVY4LjEwNzkxTDQ2LjUyMSAxNS44MDc5SDQ5Ljg1NDNWMjIuMTA3OUw1NC41MjEgMTQuNDA3OUg1MS4xODc3WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTQxLjg1NDMgMTguNzc0Nkw0MS4xODc3IDE2LjEwNzlMNDQuNTIxIDE4Ljc3NDZMNDMuMTg3NyAxOS40NDEyTDQzLjg1NDMgMjIuMTA3OUw0MC41MjEgMTkuNDQxMkw0MS44NTQzIDE4Ljc3NDZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNTkuMTg3NyAxOC43NzQ2TDU5Ljg1NDMgMTYuMTA3OUw1Ni41MjEgMTguNzc0Nkw1Ny44NTQzIDE5LjQ0MTJMNTcuMTg3NyAyMi4xMDc5TDYwLjUyMSAxOS40NDEyTDU5LjE4NzcgMTguNzc0NloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNTAuNTIxIDczLjEwNzlDNTEuMDczMyA3My4xMDc5IDUxLjUyMSA3My41NTU2IDUxLjUyMSA3NC4xMDc5TDUxLjUyMSA3OS4xMDc5QzUxLjUyMSA3OS42NjAyIDUxLjA3MzMgODAuMTA3OSA1MC41MjEgODAuMTA3OUM0OS45Njg3IDgwLjEwNzkgNDkuNTIxIDc5LjY2MDIgNDkuNTIxIDc5LjEwNzlMNDkuNTIxIDc0LjEwNzlDNDkuNTIxIDczLjU1NTYgNDkuOTY4NyA3My4xMDc5IDUwLjUyMSA3My4xMDc5WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTMwLjUyMSA0NC4xMDc5SDcwLjUyMVY1Ni4xMDc5QzcwLjUyMSA2Ny4xNTM2IDYxLjU2NjcgNzYuMTA3OSA1MC41MjEgNzYuMTA3OUMzOS40NzUzIDc2LjEwNzkgMzAuNTIxIDY3LjE1MzYgMzAuNTIxIDU2LjEwNzlWNDQuMTA3OVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik01Ni41MjEgNjAuMTA3OUM1Ni41MjEgNjMuNDIxNiA1My44MzQ3IDY2LjEwNzkgNTAuNTIxIDY2LjEwNzlDNDcuMjA3MyA2Ni4xMDc5IDQ0LjUyMSA2My40MjE2IDQ0LjUyMSA2MC4xMDc5QzQ0LjUyMSA1Ni43OTQyIDQ3LjIwNzMgNTQuMTA3OSA1MC41MjEgNTQuMTA3OUM1My44MzQ3IDU0LjEwNzkgNTYuNTIxIDU2Ljc5NDIgNTYuNTIxIDYwLjEwNzlaIiBmaWxsPSIjMjI2NkUzIi8+Cjwvc3ZnPgo=", alt: Editor.CommonUtils.getLocalizedString("[Checker error]") }),
                        React.createElement("span", { className: Editor.CommonConstants.accessibilityIssuesCssClass }, errorResult))));
            }
            else if (!this.state.loaded) {
                var medium = 2;
                resultView = React.createElement(Spinner, { size: medium });
            }
            else if (this.props.isPanelOpen) {
                if (this.accessibilityIssues.length > 0) {
                    var resultDetails = React.createElement(Editor.AxeGroupedList, { eventBroker: this.props.eventBroker, removeBorderOnDismiss: this.getSelectedElem, setInitSelections: this.setInitSelections, getAccessibilityIssues: this.setAccessibilityIssues, accessibilityIssues: this.accessibilityIssues, violationsCount: violationsCount });
                    resultView = (React.createElement("div", null,
                        React.createElement("div", { className: Editor.CommonConstants.accessibilityInspectionResultsCssClass }, resultDetails)));
                }
                else {
                    var emptyResult = Editor.CommonUtils.getLocalizedString("[Great work! There are no known accessibility issues.]");
                    this.removeBorder();
                    resultView = (React.createElement("div", null,
                        React.createElement("p", { className: Editor.CommonConstants.accessibilityCheckerCssClass }, "" + axeChecker),
                        React.createElement("div", { className: Editor.CommonConstants.axeResultsGraphicCssClass },
                            React.createElement("img", { src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAxIiBoZWlnaHQ9IjEwMSIgdmlld0JveD0iMCAwIDEwMSAxMDEiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0wLjY4MzEwNSAwLjEwNzkxSDEwMC42ODNWMTAwLjEwOEgwLjY4MzEwNVYwLjEwNzkxWiIgZmlsbD0id2hpdGUiLz4KPGNpcmNsZSBjeD0iNTAuNjgzMSIgY3k9IjUwLjEwNzkiIHI9IjUwIiBmaWxsPSIjMjI2NkUzIi8+CjxwYXRoIGQ9Ik01OC42ODMxIDIyLjEwNzlIMzAuNjgzMUMyOS41Nzg1IDIyLjEwNzkgMjguNjgzMSAyMy4wMDMzIDI4LjY4MzEgMjQuMTA3OVY3Ni4xMDc5QzI4LjY4MzEgNzcuMjEyNSAyOS41Nzg1IDc4LjEwNzkgMzAuNjgzMSA3OC4xMDc5SDcwLjY4MzFDNzEuNzg3NyA3OC4xMDc5IDcyLjY4MzEgNzcuMjEyNSA3Mi42ODMxIDc2LjEwNzlWMzYuMTA3OUg2Mi42ODMxQzYwLjQ3NCAzNi4xMDc5IDU4LjY4MzEgMzQuMzE3IDU4LjY4MzEgMzIuMTA3OVYyMi4xMDc5WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTcyLjY4MzEgMzQuMTA3OUg2Mi42ODMxQzYxLjU3ODUgMzQuMTA3OSA2MC42ODMxIDMzLjIxMjUgNjAuNjgzMSAzMi4xMDc5VjIyLjEwNzlMNzIuNjgzMSAzNC4xMDc5WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik01MC42ODMxIDYzLjEwNzlDNTcuODYyOCA2My4xMDc5IDYzLjY4MzEgNTcuMjg3NiA2My42ODMxIDUwLjEwNzlDNjMuNjgzMSA0Mi45MjgyIDU3Ljg2MjggMzcuMTA3OSA1MC42ODMxIDM3LjEwNzlDNDMuNTAzNCAzNy4xMDc5IDM3LjY4MzEgNDIuOTI4MiAzNy42ODMxIDUwLjEwNzlDMzcuNjgzMSA1Ny4yODc2IDQzLjUwMzQgNjMuMTA3OSA1MC42ODMxIDYzLjEwNzlaIiBmaWxsPSIjMjI2NkUzIi8+CjxwYXRoIGQ9Ik00NC42ODMxIDUwLjMwNzlMNDkuNDEwNCA1NS4xMDc5TDU3LjY4MzEgNDYuMTA3OSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+Cg==", alt: "success" }),
                            React.createElement("span", { className: Editor.CommonConstants.accessibilityIssuesCssClass }, emptyResult))));
                }
            }
            return (React.createElement("span", null,
                React.createElement(Panel, { className: Editor.CommonConstants.accessibilityCheckerCssClass, isOpen: this.props.isPanelOpen, isLightDismiss: true, isHiddenOnDismiss: false, onDismiss: this.onPanelDismiss, closeButtonAriaLabel: "Close" },
                    React.createElement("div", null, resultView))));
        };
        return AccessibilityChecker;
    }(React.Component));
    Editor.AccessibilityChecker = AccessibilityChecker;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Common = MktSvc.Controls.Common;
    var IssueElementType;
    (function (IssueElementType) {
        IssueElementType["Image"] = "img";
        IssueElementType["Button"] = "a";
        IssueElementType["Text"] = "p";
        IssueElementType["Other"] = "other";
    })(IssueElementType = Editor.IssueElementType || (Editor.IssueElementType = {}));
    // TODO: Strings used in this class need to be added to localization file once content is finalized.
    var AccessibilityIssueAggregator = /** @class */ (function () {
        function AccessibilityIssueAggregator() {
        }
        AccessibilityIssueAggregator.prototype.getAccessibilityIssues = function (violations) {
            var issues = [];
            for (var i = 0; i < violations.length; i++) {
                if (this.validRule(violations[i].id)) {
                    var issueTitle = this.getRuleName(violations[i].id);
                    var issueElements = AccessibilityIssueAggregator.getElements(violations[i].nodes);
                    issues.push({
                        id: violations[i].id,
                        title: issueTitle,
                        helpUrl: violations[i].helpUrl,
                        whyFix: violations[i].helpUrl,
                        howFix: violations[i].helpUrl,
                        elements: issueElements
                    });
                }
            }
            this.getMissingTitleIssue(issues);
            return issues;
        };
        AccessibilityIssueAggregator.prototype.getMissingTitleIssue = function (issues) {
            var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            var headElement;
            if (designerFrame.contents() && designerFrame.contents().find("head")) {
                headElement = designerFrame.contents().find("head");
            }
            if (headElement.length) {
                var title = headElement.find("title");
                if (title.length && !title.html()) {
                    issues.push({
                        id: "document-title",
                        title: Editor.CommonUtils.getLocalizedString("[Missing title]"),
                        helpUrl: "",
                        whyFix: "",
                        howFix: "",
                        elements: [{
                                target: "html",
                                type: IssueElementType.Other,
                                name: Editor.CommonUtils.getLocalizedString("Other")
                            }]
                    });
                }
            }
        };
        AccessibilityIssueAggregator.getFrameBody = function () {
            var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            var framebody;
            if (designerFrame.contents() && designerFrame.contents().find("body")) {
                framebody = designerFrame.contents().find("body")[0];
            }
            return framebody;
        };
        AccessibilityIssueAggregator.getElements = function (nodes) {
            var elements = [];
            var iFrameDom = $(this.getFrameBody());
            for (var i = 0; i < nodes.length; i++) {
                var issueType = AccessibilityIssueAggregator.findElementType(iFrameDom, nodes[i].target[0]);
                var issueName = AccessibilityIssueAggregator.mapTypeToName(issueType);
                elements.push({
                    target: nodes[i].target[0],
                    type: issueType,
                    name: issueName
                });
            }
            elements.sort(function (a, b) { return a.name.localeCompare(b.name); });
            return elements;
        };
        AccessibilityIssueAggregator.findElementType = function (dom, target) {
            if (!Common.Utility.isNullOrUndefined(dom) && !Common.Utility.isNullOrUndefined(target)) {
                var element = dom.find(target);
                if (element && element.length) {
                    var tag = element[0].nodeName.toLowerCase();
                    switch (tag) {
                        case IssueElementType.Image:
                            return IssueElementType.Image;
                        case IssueElementType.Button:
                            return IssueElementType.Button;
                        case IssueElementType.Text:
                            return IssueElementType.Text;
                        default:
                            if (element.parents(IssueElementType.Text).length > 0) {
                                return IssueElementType.Text;
                            }
                            break;
                    }
                }
            }
            return IssueElementType.Other;
        };
        AccessibilityIssueAggregator.mapTypeToName = function (type) {
            switch (type) {
                case IssueElementType.Image:
                    return Editor.CommonUtils.getLocalizedString("[Image]");
                case IssueElementType.Button:
                    return Editor.CommonUtils.getLocalizedString("[Button]");
                case IssueElementType.Text:
                    return Editor.CommonUtils.getLocalizedString("[Text]");
                default:
                    return Editor.CommonUtils.getLocalizedString("[Other]");
            }
        };
        return AccessibilityIssueAggregator;
    }());
    Editor.AccessibilityIssueAggregator = AccessibilityIssueAggregator;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    // TODO: Strings used in this class need to be added to localization file once content is finalized.
    var EmailAccessibilityIssueAggregator = /** @class */ (function (_super) {
        __extends(EmailAccessibilityIssueAggregator, _super);
        function EmailAccessibilityIssueAggregator() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        // TODO: Get the right content text for every rule
        EmailAccessibilityIssueAggregator.prototype.getRuleName = function (id) {
            var name = Editor.CommonUtils.getLocalizedString("Other HTML issues");
            switch (id) {
                case "color-contrast":
                    name = Editor.CommonUtils.getLocalizedString("[Insufficient color contrast]");
                    break;
                case "image-alt":
                    name = Editor.CommonUtils.getLocalizedString("[Object is missing alt text]");
                    break;
                case "heading-order":
                    name = Editor.CommonUtils.getLocalizedString("heading-order");
                    break;
                case "document-title":
                    name = Editor.CommonUtils.getLocalizedString("[Missing title]");
                    break;
                case "audio-caption":
                    name = Editor.CommonUtils.getLocalizedString("audio-caption");
                    break;
                case "video-caption":
                    name = Editor.CommonUtils.getLocalizedString("video-caption");
                    break;
                case "td-has-header":
                    name = Editor.CommonUtils.getLocalizedString("td-has-header");
                    break;
                case "td-headers-attr":
                    name = Editor.CommonUtils.getLocalizedString("td-headers-attr");
                    break;
                case "th-has-data-cells":
                    name = Editor.CommonUtils.getLocalizedString("th-has-data-cells");
                    break;
                case "scope-attr-valid":
                    name = Editor.CommonUtils.getLocalizedString("scope-attr-valid");
                    break;
                case "table-fake-caption":
                    name = Editor.CommonUtils.getLocalizedString("table-fake-caption");
                    break;
                case "table-duplicate-name":
                    name = Editor.CommonUtils.getLocalizedString("table-duplicate-name");
                    break;
                default:
                    break;
            }
            return name;
        };
        EmailAccessibilityIssueAggregator.prototype.validRule = function (id) {
            switch (id) {
                case "color-contrast":
                case "heading-order":
                case "document-title":
                case "image-alt":
                case "audio-caption":
                case "video-caption":
                case "td-has-header":
                case "td-headers-attr":
                case "th-has-data-cells":
                case "scope-attr-valid":
                case "table-fake-caption":
                case "table-duplicate-name":
                    return true;
                default:
                    return false;
            }
        };
        return EmailAccessibilityIssueAggregator;
    }(Editor.AccessibilityIssueAggregator));
    Editor.EmailAccessibilityIssueAggregator = EmailAccessibilityIssueAggregator;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var StylesTabVisibilityEventArgs = /** @class */ (function (_super) {
        __extends(StylesTabVisibilityEventArgs, _super);
        function StylesTabVisibilityEventArgs(stylesTab) {
            var _this = _super.call(this) || this;
            _this.stylesTab = stylesTab;
            return _this;
        }
        return StylesTabVisibilityEventArgs;
    }(Editor.EventArgs));
    Editor.StylesTabVisibilityEventArgs = StylesTabVisibilityEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var DEFAULT_SCOPE = "DEFAULT_SCOPE";
    var Action = /** @class */ (function () {
        /**
         * Create a new action
         * @param scope The scope that this action should execute in. Actions with the same scope cannot be invoked within each other
         */
        function Action(_scope) {
            if (_scope === void 0) { _scope = DEFAULT_SCOPE; }
            this._scope = _scope;
            this.listeners = [];
        }
        Action.prototype.invoke = function (payload) {
            if (Action.executingScopes[this._scope]) {
                throw new Error("Cannot invoke an action with scope " + this._scope + " from inside another action with the same scope");
            }
            Action.executingScopes[this._scope] = true;
            try {
                this.listeners.forEach(function (listener) {
                    listener(payload);
                });
            }
            finally {
                delete Action.executingScopes[this._scope]; // tslint:disable-line
            }
        };
        /**
         * Add listener to the action
         * @param listener Listener to add
         * @param context Optional context to bind to listener
         * @returns Listener that was added, might be different from the passed in listener if context is given
         */
        Action.prototype.addListener = function (listener, context) {
            var handler = context ? listener.bind(context) : listener;
            this.listeners.push(handler);
            return handler;
        };
        /**
         * Remove listener from the action
         * @param listener Listener to remove
         */
        Action.prototype.removeListener = function (listener) {
            var index = this.listeners.indexOf(listener);
            if (index >= 0) {
                this.listeners.splice(index, 1);
            }
        };
        /**
         * A mutex to ensure that only one action in a given scope is executing at any time.
         * This prevents cascading actions.
         */
        Action.executingScopes = {};
        return Action;
    }());
    Editor.Action = Action;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var Store = /** @class */ (function () {
        function Store() {
        }
        Store.prototype.addChangedListener = function (handler) {
            if (!this._handlers) {
                this._handlers = [];
            }
            if (handler) {
                this._handlers.push(handler);
            }
        };
        Store.prototype.removeChangedListener = function (handler) {
            if (this._handlers) {
                this._handlers = this._handlers.filter(function (h) { return h !== handler; });
            }
        };
        Store.prototype.emitChanged = function () {
            if (this._handlers && this._handlers.length > 0) {
                var handlersCopy = Array.apply(null, this._handlers);
                for (var i = handlersCopy.length - 1; i >= 0; i--) {
                    handlersCopy[i](this);
                }
            }
        };
        return Store;
    }());
    Editor.Store = Store;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SingleRowLayoutRenderer = /** @class */ (function () {
        function SingleRowLayoutRenderer() {
        }
        /**
         * Renders the containers for the editor components in vertical order
         * That is, the components in the same row of LayoutConfiguration will be rendered in the same column (<td>)
         * @param containerId - The id of the conainer in which the editor will be rendered.
         * @param layoutConfiuration - The layout configuration for the editor.
         */
        SingleRowLayoutRenderer.prototype.render = function (container, layoutConfiuration) {
            container.addClass(layoutConfiuration.cssClass);
            var tableLayout = $("<table></table>");
            tableLayout.attr("role", "presentation");
            var tableComponentsLayout = $("<tbody></tbody>");
            var rowContainer = $("<tr></tr>");
            layoutConfiuration.components.each(function (colComponent, index) {
                var colIndex = index + 1;
                var columnContainer = $("<td></td>");
                columnContainer.attr("class", layoutConfiuration.cssClass + "LayoutColumn" + colIndex);
                var innerTableLayout = $("<table></table>");
                innerTableLayout.attr("role", "presentation");
                var innerTableComponentsLayout = $("<tbody></tbody>");
                colComponent.each(function (cellComponent) {
                    var innerRowContainer = $("<tr></tr>");
                    var componentContainer = $("<td></td>");
                    componentContainer.addClass(cellComponent.cssClass);
                    Editor.CommonUtils.setId(componentContainer, cellComponent.id);
                    innerRowContainer.append(componentContainer);
                    innerTableComponentsLayout.append(innerRowContainer);
                });
                innerTableLayout.append(innerTableComponentsLayout);
                columnContainer.append(innerTableLayout);
                tableComponentsLayout.append(columnContainer);
                rowContainer.append(columnContainer);
            });
            tableComponentsLayout.append(rowContainer);
            tableLayout.append(tableComponentsLayout);
            container.append(tableLayout);
        };
        SingleRowLayoutRenderer.prototype.dispose = function () { };
        return SingleRowLayoutRenderer;
    }());
    Editor.SingleRowLayoutRenderer = SingleRowLayoutRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TraceLevel = MktSvc.Controls.Common.TraceLevel;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var CkEditorTelemetryUtils = /** @class */ (function () {
        function CkEditorTelemetryUtils() {
        }
        CkEditorTelemetryUtils.sendToolUsageTelemetry = function (logger, viewName, tool) {
            if (logger) {
                var controlName = tool.getType();
                var toolCategory = tool.getCategory() === 0 ? "Content" : "Layout";
                logger.log(TraceLevel.Verbose, "Editor.CkEditorTelemetry", new Dictionary({
                    Message: viewName + "." + controlName + " selected.",
                    ViewName: viewName,
                    ToolType: controlName,
                    ToolCategory: toolCategory,
                    TelemetryType: CkEditorTelemetryUtils.TelemetryPrefix + "." + CkEditorTelemetryUtils.ToolUsageStatistics
                }));
            }
        };
        CkEditorTelemetryUtils.sendControllerUsageTelemetry = function (logger, eventType, controllerType) {
            if (logger) {
                logger.log(TraceLevel.Verbose, "Editor.CkEditorTelemetry", new Dictionary({
                    Message: controllerType + " " + eventType + " triggered.",
                    ControllerType: controllerType,
                    EventName: eventType,
                    TelemetryType: CkEditorTelemetryUtils.TelemetryPrefix + "." + CkEditorTelemetryUtils.ControlUsageStatistics
                }));
            }
        };
        CkEditorTelemetryUtils.TelemetryPrefix = "Editor.CkEditorTelemetry";
        CkEditorTelemetryUtils.ToolUsageStatistics = "ToolUsageStatistics";
        CkEditorTelemetryUtils.ControlUsageStatistics = "ControlUsageStatistics";
        return CkEditorTelemetryUtils;
    }());
    Editor.CkEditorTelemetryUtils = CkEditorTelemetryUtils;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var DeviceInfoUtils = /** @class */ (function () {
        function DeviceInfoUtils() {
        }
        DeviceInfoUtils.isMobile = function () {
            try {
                var mobileMatch = navigator.userAgent.match(/Android/g) ||
                    navigator.userAgent.match(/webOS/g) ||
                    navigator.userAgent.match(/iPhone/g) ||
                    navigator.userAgent.match(/iPad/g) ||
                    navigator.userAgent.match(/BlackBerry/g) ||
                    navigator.userAgent.match(/Windows Phone/g);
                return !Utility.isNullOrUndefined(mobileMatch);
            }
            catch (error) {
                return false;
            }
        };
        DeviceInfoUtils.isTabletLandscape = function () {
            try {
                // note: android chrome changes width and height based on its orientation
                var smallerMeasure = Math.min(window.screen.width, window.screen.height);
                var isTablet = this.isMobile() && smallerMeasure >= 768;
                var isLandscape = false;
                var screenOrientation = window.screen.orientation;
                if (screenOrientation) {
                    isLandscape = screenOrientation.type.indexOf("landscape") !== -1;
                }
                else {
                    // Safari does not support window.screen.orientation yet
                    isLandscape = window.orientation === 90 || window.orientation === -90;
                }
                return isLandscape && isTablet;
            }
            catch (error) {
                return false;
            }
        };
        return DeviceInfoUtils;
    }());
    Editor.DeviceInfoUtils = DeviceInfoUtils;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ObjectUtils = MktSvc.Controls.Common.Utility;
    var DomOperation = /** @class */ (function () {
        function DomOperation() {
        }
        DomOperation.htmlToDom = function (html) {
            var dom = [];
            $(html).each(function (i, e) {
                if (e.nodeType === Node.ELEMENT_NODE) {
                    dom.push(e);
                }
            });
            return dom;
        };
        DomOperation.domToHtml = function (dom) {
            var html = "";
            for (var _i = 0, dom_1 = dom; _i < dom_1.length; _i++) {
                var element = dom_1[_i];
                html += element.outerHTML;
            }
            return html;
        };
        DomOperation.collectionToArray = function (collection) {
            var newArray = [];
            for (var i = collection.length >>> 0; i--;) {
                newArray[i] = collection[i];
            }
            return newArray;
        };
        DomOperation.newHtmlElement = function (type, props) {
            if (props === void 0) { props = {}; }
            var element = document.createElement(type);
            var setValues = function (to, from) {
                for (var _i = 0, _a = Object.keys(from); _i < _a.length; _i++) {
                    var key = _a[_i];
                    var value = from[key];
                    var toValue = to[key];
                    switch (typeof toValue) {
                        case "object":
                            if (ObjectUtils.isNullOrUndefined(toValue)) {
                                to[key] = value;
                            }
                            else {
                                setValues(toValue, value);
                            }
                            break;
                        case "function":
                            switch (typeof value) {
                                case "function":
                                    to[key] = value;
                                    break;
                                case "object":
                                    if (Array.isArray(value)) {
                                        toValue.apply(to, value);
                                        break;
                                    }
                                    for (var _b = 0, _c = Object.keys(value); _b < _c.length; _b++) {
                                        var arg1 = _c[_b];
                                        var extraArgs = value[arg1];
                                        var args = Array.isArray(extraArgs) ? extraArgs : [arg1, extraArgs];
                                        toValue.apply(to, args);
                                    }
                                    break;
                                default:
                                    toValue.apply(to, value);
                                    break;
                            }
                            break;
                        default:
                            to[key] = value;
                            break;
                    }
                }
            };
            setValues(element, props);
            return element;
        };
        return DomOperation;
    }());
    Editor.DomOperation = DomOperation;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Custom Radio Tile Option
     */
    var CustomRadioTileOption = /** @class */ (function () {
        function CustomRadioTileOption(className, caption) {
            this.className = className;
            this.caption = caption;
        }
        return CustomRadioTileOption;
    }());
    Editor.CustomRadioTileOption = CustomRadioTileOption;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    /**
     * Custom radio button with tile renderer
     */
    var CustomRadioTileButtonRenderer = /** @class */ (function () {
        function CustomRadioTileButtonRenderer() {
        }
        /**
         * Renders custom radio button
         * @param options the options to render
         * @param className the class name
         * @param value the initial value
         * @param valueChangeCallback the callback invoked when selected value is changed
         */
        CustomRadioTileButtonRenderer.prototype.render = function (options, className, value, valueChangeCallback) {
            var _this = this;
            var radioGroupId = UniqueId.generate(className);
            var radioName = radioGroupId + "-radio";
            var radioGroupContainer = $("<div>");
            radioGroupContainer.addClass(className);
            radioGroupContainer.attr("id", radioGroupId);
            for (var _i = 0, _a = options.getKeys().items(); _i < _a.length; _i++) {
                var key = _a[_i];
                var inputId = radioGroupId + "-" + key + "-input";
                var labelId = radioGroupId + "-" + key + "-label";
                var optionContainerId = radioGroupId + "-" + key + "-option";
                var input = this.createRadioInput(inputId, radioName, key, key === value);
                var label = this.createLabelWithIcon(inputId, labelId, options.get(key));
                var optionContainer = this.createOptionContainer(optionContainerId, input, label, options.get(key).caption);
                radioGroupContainer.append(optionContainer);
                input.on("change", function (event) {
                    var changeVal = event.target.getAttribute("value");
                    _this.updateSelection(radioGroupContainer, changeVal);
                    if (valueChangeCallback) {
                        valueChangeCallback(changeVal);
                    }
                });
                optionContainer.on("keydown", function (event) {
                    var keyPressed = event.which || event.keyCode;
                    if (keyPressed === KeyCodes.Enter) {
                        event.preventDefault();
                        var changeVal = $(event.target)
                            .children("input")
                            .first()
                            .attr("value");
                        _this.updateSelection(radioGroupContainer, changeVal);
                        if (valueChangeCallback) {
                            valueChangeCallback(changeVal);
                        }
                    }
                    if (keyPressed === KeyCodes.Right || keyPressed === KeyCodes.Down) {
                        var nextSibling = $(event.target).next("." + Editor.DetailsViewConstants.customRadioOptionContainerClassName);
                        if (nextSibling.length !== 0) {
                            nextSibling.focus();
                        }
                        else {
                            radioGroupContainer
                                .children("." + Editor.DetailsViewConstants.customRadioOptionContainerClassName)
                                .first()
                                .focus();
                        }
                    }
                    if (keyPressed === KeyCodes.Left || keyPressed === KeyCodes.Up) {
                        var prevSibling = $(event.target).prev("." + Editor.DetailsViewConstants.customRadioOptionContainerClassName);
                        if (prevSibling.length !== 0) {
                            prevSibling.focus();
                        }
                        else {
                            radioGroupContainer
                                .children("." + Editor.DetailsViewConstants.customRadioOptionContainerClassName)
                                .last()
                                .focus();
                        }
                    }
                });
            }
            this.updateSelection(radioGroupContainer, value);
            return radioGroupContainer;
        };
        CustomRadioTileButtonRenderer.prototype.createRadioInput = function (inputId, inputName, value, isChecked) {
            var input = $("<input>");
            input.attr("type", "radio");
            input.attr("id", inputId);
            input.attr("name", inputName);
            input.attr("value", value);
            input.addClass(Editor.DetailsViewConstants.customRadioInputClassName);
            if (isChecked) {
                input.attr("checked", "checked");
            }
            return input;
        };
        CustomRadioTileButtonRenderer.prototype.createLabelWithIcon = function (inputId, labelId, tileOption) {
            var label = $("<label>");
            label.attr("for", inputId);
            label.attr("id", labelId);
            label.addClass(Editor.DetailsViewConstants.customRadioLabelClassName);
            var icon = $("<span>");
            icon.addClass(Editor.DetailsViewConstants.radioButtonIconClassName);
            icon.addClass(Editor.CommonConstants.editorFontCssClass);
            icon.addClass(Editor.CommonConstants.fontIconSizeCssClass);
            icon.addClass(tileOption.className);
            var iconContainer = $("<div>");
            iconContainer.addClass(Editor.CommonConstants.iconContainerCssClass);
            iconContainer.append(icon);
            label.append(iconContainer);
            return label;
        };
        CustomRadioTileButtonRenderer.prototype.createOptionContainer = function (optionContainerId, input, label, caption) {
            var optionContainer = $("<div>");
            optionContainer.attr("id", optionContainerId);
            optionContainer.addClass(Editor.DetailsViewConstants.customRadioOptionContainerClassName);
            optionContainer.append(input);
            optionContainer.append(label);
            optionContainer.attr("tabindex", 0);
            optionContainer.attr("title", caption);
            optionContainer.attr("role", "button");
            return optionContainer;
        };
        CustomRadioTileButtonRenderer.prototype.updateSelection = function (container, value) {
            container.children().each(function (idx, element) {
                var item = $(element);
                var itemValue = item
                    .children("input")
                    .first()
                    .attr("value");
                if (itemValue === value) {
                    item.addClass(Editor.DetailsViewConstants.customRadioOptionSelectedClassName);
                }
                else {
                    item.removeClass(Editor.DetailsViewConstants.customRadioOptionSelectedClassName);
                }
            });
        };
        return CustomRadioTileButtonRenderer;
    }());
    Editor.CustomRadioTileButtonRenderer = CustomRadioTileButtonRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var VideoDetailsView = /** @class */ (function () {
        function VideoDetailsView(detailsViewControl, provider, lookupViewId) {
            this.detailsViewControl = detailsViewControl;
            this.provider = provider;
            this.lookupViewId = lookupViewId;
            this.minDimension = 0;
            this.maxDimension = 10000;
        }
        VideoDetailsView.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.detailsViewControl.init(this.containerId, this.eventBroker);
        };
        VideoDetailsView.prototype.dispose = function () {
            this.detailsViewControl.dispose();
            this.eventBroker = null;
            this.clearContainer();
        };
        VideoDetailsView.prototype.render = function (selectedBlock) {
            var _this = this;
            this.clearContainer();
            var videoWrapper = selectedBlock.find("." + Editor.CommonConstants.videoWrapperClass);
            var videoId = videoWrapper.attr(Editor.CommonConstants.videoIdAttrName);
            var videoName = videoWrapper.attr(Editor.CommonConstants.videoNameAttrName);
            var initialValue = null;
            if (videoId && videoName) {
                initialValue = { Id: videoId, Name: videoName };
            }
            var mainSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.videoSectionTitle));
            var lookupContainerId = Editor.DetailsViewConstants.videoLookupContainerId + Editor.CommonConstants.videoToolType;
            this.detailsViewControl.createLookupContainer(mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.srcLabel), Editor.DetailsViewConstants.videoLookupCssClass, lookupContainerId);
            var sizeSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.sizeSectionTitle));
            var twoColumnsArea = this.detailsViewControl.createTwoColumnArea(sizeSection);
            this.createHeightInputField(selectedBlock, twoColumnsArea);
            this.createWidthInputField(selectedBlock, twoColumnsArea);
            var lookupContainer = Editor.CommonUtils.getById(lookupContainerId);
            this.provider.getLookupField().loadLookup(lookupContainer, Editor.VideoBlockProvider.EntityName, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.videoSectionTitle), this.lookupViewId, function (lookupValue) {
                _this.onVideoSelected(selectedBlock, lookupValue);
            }, initialValue);
            this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.containerId));
        };
        VideoDetailsView.prototype.createHeightInputField = function (selectedBlock, section) {
            var _this = this;
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.imgHeightLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.imageHeightInputCssClass, this.getImgAttributeInitialValue(selectedBlock[0], Editor.DetailsViewConstants.imgHeightAttribute), {
                id: MktSvc.Controls.Common.UniqueId.generate(Editor.DetailsViewConstants.imageHeightInputCssClass),
                placeholder: Editor.DetailsViewConstants.placeHolderAuto,
                min: this.minDimension,
                max: this.maxDimension,
                role: "spinbutton"
            }, function () { }, null, function (val, event) {
                if (val === Editor.DetailsViewConstants.placeHolderAuto) {
                    val = "";
                }
                _this.onThumbnailAttributeFieldUpdated(selectedBlock[0], val, Editor.DetailsViewConstants.imgHeightAttribute);
            });
        };
        VideoDetailsView.prototype.createWidthInputField = function (selectedBlock, section) {
            var _this = this;
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.imgWidthLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.imageWidthInputCssClass, this.getImgAttributeInitialValue(selectedBlock[0], Editor.DetailsViewConstants.imgWidthAttribute), {
                id: MktSvc.Controls.Common.UniqueId.generate(Editor.DetailsViewConstants.imageWidthInputCssClass),
                placeholder: Editor.DetailsViewConstants.placeHolderAuto,
                min: this.minDimension,
                max: this.maxDimension,
                role: "spinbutton"
            }, function () { }, null, function (val, event) {
                if (val === Editor.DetailsViewConstants.placeHolderAuto) {
                    val = "";
                }
                _this.onThumbnailAttributeFieldUpdated(selectedBlock[0], val, Editor.DetailsViewConstants.imgWidthAttribute);
            });
        };
        VideoDetailsView.prototype.getImage = function (block) {
            return block.getElementsByTagName("img")[0];
        };
        VideoDetailsView.prototype.onThumbnailAttributeFieldUpdated = function (selectedBlock, value, attr) {
            var img = this.getImage(selectedBlock);
            var imgContainer = img.parentElement;
            if (value === "") {
                imgContainer.style.removeProperty("max-" + attr);
                img.style.removeProperty(attr);
            }
            else {
                imgContainer.style.setProperty("max-" + attr, value + "px", "important");
                if (attr === "width") {
                    img.style.setProperty(attr, "100%");
                }
                if (attr === "height") {
                    img.style.setProperty(attr, value + "px");
                }
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(this.containerId, $(selectedBlock)));
        };
        VideoDetailsView.prototype.getImgAttributeInitialValue = function (block, attr) {
            var value = this.getImage(block).parentElement.style.getPropertyValue("max-" + attr);
            return MktSvc.Controls.Common.Utility.isNullOrUndefined(value) || value === "" ? "" : value.match(/\d+/g).toString();
        };
        VideoDetailsView.prototype.onVideoSelected = function (selectedBlock, lookupValue) {
            var _this = this;
            if (lookupValue != null) {
                var videoId = lookupValue.id ? lookupValue.id : lookupValue.Id;
                if (videoId != null) {
                    this.provider
                        .getExecutionContext()
                        .getConfigurationProvider()
                        .getEntityData(Editor.VideoBlockProvider.EntityName, videoId, function (result) {
                        return _this.onVideoRetrieved(selectedBlock, result);
                    });
                }
            }
        };
        VideoDetailsView.prototype.onVideoRetrieved = function (selectedBlock, videoEntity) {
            if (!MktSvc.Controls.Common.Utility.isNullOrUndefined(videoEntity)) {
                var eventArgs = new Editor.VideoSelectionChangedEventArgs(selectedBlock, videoEntity.msdyncrm_videoid, videoEntity.msdyncrm_name, videoEntity.msdyncrm_videourl, videoEntity.msdyncrm_videothumbnailurl, videoEntity.msdyncrm_videoembedcode);
                this.eventBroker.notify(Editor.EventConstants.videoSelectionChanged, eventArgs);
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(this.containerId, selectedBlock));
            }
        };
        VideoDetailsView.prototype.clearContainer = function () {
            Editor.CommonUtils.getById(this.containerId).empty();
        };
        return VideoDetailsView;
    }());
    Editor.VideoDetailsView = VideoDetailsView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var InputValidations;
    (function (InputValidations) {
        // Force to be not smaller than min number
        InputValidations[InputValidations["checkForMin"] = 0] = "checkForMin";
        // Force to be not greater than max number
        InputValidations[InputValidations["checkForMax"] = 1] = "checkForMax";
        // Force to be Int number
        InputValidations[InputValidations["checkForInt"] = 2] = "checkForInt";
        // Force to be a number
        InputValidations[InputValidations["checkForNumber"] = 3] = "checkForNumber";
        // Force to remove dot/comma
        InputValidations[InputValidations["checkForSeperator"] = 4] = "checkForSeperator";
        // Force to be hex value, for instance: #aa11cc
        InputValidations[InputValidations["checkForHex"] = 5] = "checkForHex";
        // Force to be rgb value, for instance: rgb(12, 32, 22)
        InputValidations[InputValidations["checkForRgb"] = 6] = "checkForRgb";
        // Allows empty field
        InputValidations[InputValidations["allowEmpty"] = 7] = "allowEmpty";
        // Allows up to two digit decimals
        InputValidations[InputValidations["checkForTwoDigitDecimal"] = 8] = "checkForTwoDigitDecimal";
    })(InputValidations = Editor.InputValidations || (Editor.InputValidations = {}));
    var InputValidationsConstants = /** @class */ (function () {
        function InputValidationsConstants() {
        }
        InputValidationsConstants.positiveIntNotEmpty = [
            InputValidations.checkForInt,
            InputValidations.checkForNumber,
            InputValidations.checkForMin,
            InputValidations.checkForMax,
            InputValidations.checkForSeperator
        ];
        InputValidationsConstants.positiveTwoDigitNotEmpty = [
            InputValidations.checkForTwoDigitDecimal,
            InputValidations.checkForNumber,
            InputValidations.checkForMin,
            InputValidations.checkForMax,
            InputValidations.checkForSeperator
        ];
        InputValidationsConstants.positiveIntAllowEmpty = [
            InputValidations.checkForInt,
            InputValidations.checkForNumber,
            InputValidations.checkForMin,
            InputValidations.checkForMax,
            InputValidations.checkForSeperator,
            InputValidations.allowEmpty
        ];
        InputValidationsConstants.hexRgbNotEmpty = [InputValidations.checkForHex, InputValidations.checkForRgb];
        InputValidationsConstants.hexRgbAllowEmpty = [
            InputValidations.checkForHex,
            InputValidations.checkForRgb,
            InputValidations.allowEmpty
        ];
        InputValidationsConstants.validatePositiveIntNumbers = "^[1-9]d*$";
        // Valid examples:
        // #aaa
        // #12aa23
        // rgb(255, 255, 255)
        // rgb(0, 0, 0)
        // rgb(23, 23, 255)
        // rgb( 23, 23, 255)
        // rgb(23,23, 255)
        // rgb(23, 23,255)
        // rgb(23, 23,255 )
        // rgb(1, 22, 1)
        InputValidationsConstants.validateHexAndRgbColor = "(^(?:#)(?:[a-f0-9]{3}|[a-f0-9]{6})$)|(^rgb[(]( |)([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])( |)[,]( |)([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])( |)[,]( |)([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])( |)[)]$)";
        return InputValidationsConstants;
    }());
    Editor.InputValidationsConstants = InputValidationsConstants;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var InputValidationsUtils = /** @class */ (function () {
        function InputValidationsUtils() {
        }
        InputValidationsUtils.hasToValidate = function (validation, validations) {
            return validations.indexOf(validation) !== -1;
        };
        return InputValidationsUtils;
    }());
    Editor.InputValidationsUtils = InputValidationsUtils;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var VideoBlock = /** @class */ (function () {
        function VideoBlock(isEmbedCodeSupported) {
            this.inlineToolbar = new Editor.BasicVideoInlineToolbar();
            this.isEmbedCodeSupported = isEmbedCodeSupported;
        }
        VideoBlock.prototype.getType = function () {
            return VideoBlock.type;
        };
        VideoBlock.prototype.getLocalizedTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.videoBlockTitleLabel);
        };
        VideoBlock.prototype.usePlainText = function () {
            return false;
        };
        VideoBlock.prototype.isEditable = function () {
            return false;
        };
        VideoBlock.prototype.getInlineToolbar = function () {
            return this.inlineToolbar;
        };
        VideoBlock.prototype.setup = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            if (Utility.isNullOrUndefined(this.onVideoSelectionChanged)) {
                this.eventBroker.subscribe(Editor.EventConstants.videoSelectionChanged, (this.onVideoSelectionChanged = function (e) {
                    _this.videoSelectionChanged(e);
                }));
            }
        };
        VideoBlock.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.onVideoSelectionChanged)) {
                this.eventBroker.unsubscribe(Editor.EventConstants.videoSelectionChanged, this.onVideoSelectionChanged);
                this.onVideoSelectionChanged = null;
            }
        };
        VideoBlock.prototype.decorate = function (block) {
            this.decorateBlockOverlay(block);
            this.setAriaLabel(block);
            if (this.isConfigured(block)) {
                var videoWrapper = this.getVideoWrapperBlock(block);
                var videoThumbnail = videoWrapper.attr(Editor.CommonConstants.videoThumbnailUrlAttrName);
                if (this.isEmbedCodeSupported) {
                    var embedCodeAttrValue = videoWrapper.attr(Editor.CommonConstants.videoEmbedCodeAttrName);
                    if (String.isNullOrEmpty(embedCodeAttrValue)) {
                        var iframeHtml = videoWrapper.find("iframe").prop("outerHTML");
                        videoWrapper.attr(Editor.CommonConstants.videoEmbedCodeAttrName, iframeHtml);
                    }
                }
                var videoImage = $("<img/>").attr("src", videoThumbnail).css("width", "100%");
                var currentImage = videoWrapper[0].getElementsByTagName("img")[0];
                if (!Utility.isNullOrUndefined(currentImage) && currentImage.style.height) {
                    videoImage.css("height", currentImage.style.height);
                }
                else {
                    videoImage.css("height", "auto");
                }
                videoWrapper.empty();
                videoWrapper.append(videoImage);
            }
        };
        VideoBlock.prototype.decorateBlockOverlay = function (block) {
            var videoWrapper = this.getVideoWrapperBlock(block);
            var parentBlock = videoWrapper.parent();
            Editor.CommonUtils.removeBlockOverlay(block);
            if (!this.isConfigured(block)) {
                Editor.CommonUtils.overlayBlockElement(parentBlock, videoWrapper, Editor.CommonUtils.getVideoPlaceholder(), Editor.BlockType.Video);
            }
        };
        VideoBlock.prototype.setAriaLabel = function (block) {
            var txt = "[" + (!this.isConfigured(block) ? "Unconfigured " : String.Empty) + block.attr(Editor.Contract.blockTypeAttrName) + " block]";
            var translatedText = Editor.CommonUtils.getLocalizedString(txt);
            var element = Editor.BlockProvider.getEditableElement(block);
            Editor.CommonUtils.setAriaAttribute(block, "aria-label", translatedText);
            Editor.CommonUtils.setAriaAttribute(element, "aria-label", translatedText);
            Editor.CommonUtils.setAriaAttribute(element, "title", translatedText);
        };
        VideoBlock.prototype.isConfigured = function (block) {
            var videoWrapper = this.getVideoWrapperBlock(block);
            var videoId = videoWrapper.attr(Editor.CommonConstants.videoIdAttrName);
            var videoName = videoWrapper.attr(Editor.CommonConstants.videoNameAttrName);
            var videoUrl = videoWrapper.attr(Editor.CommonConstants.videoUrlAttrName);
            var videoThumbnail = videoWrapper.attr(Editor.CommonConstants.videoThumbnailUrlAttrName);
            if (!videoId || !videoName || !videoUrl || !videoThumbnail) {
                return false;
            }
            var videoEmbedCode = videoWrapper.attr(Editor.CommonConstants.videoEmbedCodeAttrName);
            if (this.isEmbedCodeSupported && String.isNullOrEmpty(videoEmbedCode)) {
                return false;
            }
            return true;
        };
        VideoBlock.prototype.makeIframeResponsive = function (videoEmbedCode) {
            if (Utility.isNullOrUndefined(videoEmbedCode)) {
                return "";
            }
            var container = document.createElement("div");
            // replace quote to be able to proper convert embedded code to HTLMElement
            container.innerHTML = videoEmbedCode.replace(/&quot;/g, '"');
            var iframe = container.getElementsByTagName("iframe")[0];
            if (Utility.isNullOrUndefined(iframe)) {
                return container.innerHTML;
            }
            iframe.style.position = "absolute";
            iframe.style.top = "0";
            iframe.style.left = "0";
            iframe.style.width = "100%";
            iframe.style.height = "100%";
            return container.innerHTML;
        };
        VideoBlock.prototype.setFinalContent = function (block) {
            Editor.CommonUtils.removeBlockOverlay(block);
            block.removeAttr("aria-label");
            var videoWrapper = this.getVideoWrapperBlock(block);
            var videoUrl = videoWrapper.attr(Editor.CommonConstants.videoUrlAttrName);
            var videoThumbnail = videoWrapper.attr(Editor.CommonConstants.videoThumbnailUrlAttrName);
            var videoEmbedCode = this.makeIframeResponsive(videoWrapper.attr(Editor.CommonConstants.videoEmbedCodeAttrName));
            var videoImage = $("<img/>").attr("src", videoThumbnail);
            var imgElement = videoWrapper[0].getElementsByTagName("img")[0];
            if (!Utility.isNullOrUndefined(imgElement) && imgElement.style.height) {
                videoImage.attr("height", Editor.CommonUtils.getOnlyPixelsValueFromString(imgElement.style.height)).css("height", imgElement.style.height);
            }
            else {
                videoImage.css("height", "auto");
            }
            var wrapper = videoWrapper[0];
            if (!Utility.isNullOrUndefined(wrapper) && wrapper.style.maxWidth && wrapper.style.maxWidth.includes("px")) {
                videoImage.attr("width", Editor.CommonUtils.getOnlyPixelsValueFromString(wrapper.style.maxWidth)).css("width", wrapper.style.maxWidth);
            }
            else {
                videoImage.attr("width", "100%").css("width", "100%");
            }
            videoWrapper.empty();
            if (this.isEmbedCodeSupported) {
                var iframe = $(videoEmbedCode);
                videoWrapper.css("position", "relative");
                videoWrapper.css("overflow", "hidden");
                videoWrapper.css("padding-bottom", this.getWrapperPadding(imgElement));
                videoWrapper.css("height", "0");
                videoImage.css("z-index", "-1");
                videoWrapper.append(videoImage);
                videoWrapper.append(iframe);
            }
            else {
                var videoLink = $("<a/>")
                    .attr("href", videoUrl)
                    .append(videoImage);
                videoWrapper.append(videoLink);
            }
        };
        VideoBlock.prototype.getWrapperPadding = function (imgHeight) {
            return Utility.isNullOrUndefined(imgHeight) ||
                imgHeight.style.height === "" ||
                imgHeight.style.height === "auto"
                ? "56.25%" : imgHeight.style.height;
        };
        VideoBlock.prototype.onBlockAdded = function (block) { };
        VideoBlock.prototype.videoSelectionChanged = function (eventArgs) {
            var videoWrapper = this.getVideoWrapperBlock(eventArgs.element);
            var videoImage = $("<img/>").attr("src", eventArgs.videoThumbnailUrl).css("width", "100%");
            var imgHeight = videoWrapper[0].getElementsByTagName("img")[0];
            if (!Utility.isNullOrUndefined(imgHeight) && imgHeight.style.height) {
                videoImage.css("height", imgHeight.style.height);
            }
            else {
                videoImage.css("height", "auto");
            }
            videoWrapper.empty();
            videoWrapper.attr(Editor.CommonConstants.videoIdAttrName, eventArgs.videoId);
            videoWrapper.attr(Editor.CommonConstants.videoNameAttrName, eventArgs.videoName);
            videoWrapper.attr(Editor.CommonConstants.videoUrlAttrName, eventArgs.videoUrl);
            videoWrapper.attr(Editor.CommonConstants.videoThumbnailUrlAttrName, eventArgs.videoThumbnailUrl);
            videoWrapper.attr(Editor.CommonConstants.videoEmbedCodeAttrName, eventArgs.videoEmbedCode);
            videoWrapper.append(videoImage);
            this.decorateBlockOverlay(eventArgs.element);
            this.setAriaLabel(eventArgs.element);
        };
        VideoBlock.prototype.getVideoWrapperBlock = function (block) {
            return block.find("." + Editor.CommonConstants.videoWrapperClass);
        };
        VideoBlock.type = Editor.CommonConstants.videoToolType;
        return VideoBlock;
    }());
    Editor.VideoBlock = VideoBlock;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BasicVideoInlineToolbar = /** @class */ (function () {
        function BasicVideoInlineToolbar() {
        }
        BasicVideoInlineToolbar.prototype.getName = function () {
            return "BasicVideoInlineToolbar";
        };
        BasicVideoInlineToolbar.prototype.getConfig = function () {
            return [["cloneBlockBtn"]];
        };
        return BasicVideoInlineToolbar;
    }());
    Editor.BasicVideoInlineToolbar = BasicVideoInlineToolbar;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var VideoTool = /** @class */ (function () {
        function VideoTool() {
        }
        VideoTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.videoToolLabel);
        };
        VideoTool.prototype.getType = function () {
            return Editor.CommonConstants.videoToolType;
        };
        VideoTool.prototype.getContentTransformation = function () {
            return "<div class=\"" + Editor.CommonConstants.videoWrapperClass + "\"></div>";
        };
        VideoTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.videoToolTitle);
        };
        VideoTool.prototype.getCssClass = function () {
            return Editor.CommonConstants.videoToolCss;
        };
        VideoTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Content;
        };
        return VideoTool;
    }());
    Editor.VideoTool = VideoTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../commonreferences.ts" />
var Editor;
(function (Editor) {
    var AbTestingContext = /** @class */ (function () {
        function AbTestingContext(eventBroker, onContextChanged) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.onContextChanged = onContextChanged;
            this._testId = null;
            this._variantId = null;
            this._testProperty = null;
            this._overrides = [];
            this.onConfigurationChanged = function (args) {
                var changed = false;
                if (args) {
                    var testId = (args.configuration && args.configuration["testId"]) || null;
                    var variantId = (args.configuration && args.configuration["variantId"]) || null;
                    var testProperty = (args.configuration && args.configuration["testProperty"]) || null;
                    var overrides = (args.configuration && args.configuration["overrides"]) || [];
                    if (testId !== _this._testId) {
                        _this._testId = testId;
                        changed = true;
                    }
                    if (variantId !== _this._variantId) {
                        _this._variantId = variantId;
                        changed = true;
                    }
                    if (testProperty !== _this._testProperty) {
                        _this._testProperty = testProperty;
                        changed = true;
                    }
                    if (overrides !== _this._overrides) {
                        _this._overrides = overrides;
                        changed = true;
                    }
                }
                if (changed) {
                    if (_this.onContextChanged) {
                        _this.onContextChanged();
                    }
                }
            };
            this.eventBroker.subscribe(Editor.EventConstants.abTestingConfigurationChanged, this.onConfigurationChanged);
        }
        Object.defineProperty(AbTestingContext.prototype, "isEnabled", {
            get: function () {
                return this._testId !== null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(AbTestingContext.prototype, "testId", {
            get: function () {
                return this._testId;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(AbTestingContext.prototype, "variantId", {
            get: function () {
                return this._variantId;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(AbTestingContext.prototype, "testProperty", {
            get: function () {
                return this._testProperty;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(AbTestingContext.prototype, "overrides", {
            get: function () {
                return this._overrides;
            },
            enumerable: true,
            configurable: true
        });
        return AbTestingContext;
    }());
    Editor.AbTestingContext = AbTestingContext;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var AbTestingUtils = /** @class */ (function () {
        function AbTestingUtils() {
        }
        AbTestingUtils.hasVariantForCurrentTest = function (block, context) {
            if (!AbTestingUtils.isVariant(block)) {
                return false;
            }
            return (context.isEnabled &&
                !!AbTestingUtils.getRoot(block).querySelectorAll(AbTestingUtils.constants.tagName.abVariant + "[" + AbTestingUtils.constants.attributeName.testId + "='" + context.testId + "']").length);
        };
        AbTestingUtils.isCurrentVariant = function (block, context) {
            if (!AbTestingUtils.isVariant(block)) {
                return false;
            }
            var currentVariant = AbTestingUtils.getCurrentVariantFromBlock(block, context);
            return currentVariant.children.length && currentVariant.children[0] === block;
        };
        AbTestingUtils.getCurrentVariantFromBlock = function (block, context) {
            if (!AbTestingUtils.isVariant(block)) {
                return null;
            }
            var root = AbTestingUtils.getRoot(block);
            return AbTestingUtils.getCurrentVariantFromAbBlock(root, context);
        };
        AbTestingUtils.getCurrentVariantFromAbBlock = function (root, context) {
            var currentVariant = root.querySelector(AbTestingUtils.constants.tagName.abVariant + "[" + AbTestingUtils.constants.attributeName.testId + "='" + AbTestingUtils.getCurrentTestId(context) + "'][" + AbTestingUtils.constants.attributeName.variantId + "='" + context.variantId + "']");
            var aVariant = root.querySelector(AbTestingUtils.constants.tagName.abVariant + "[" + AbTestingUtils.constants.attributeName.testId + "='" + AbTestingUtils.constants.defaultValue.testId + "'][" + AbTestingUtils.constants.attributeName.variantId + "='" + AbTestingUtils.constants.defaultValue.variantId + "']");
            return currentVariant || aVariant;
        };
        AbTestingUtils.getCurrentTestId = function (context) {
            return context.variantId === AbTestingUtils.constants.defaultValue.variantId
                ? AbTestingUtils.constants.defaultValue.testId
                : context.testId;
        };
        AbTestingUtils.addAbBlock = function (block, context) {
            var currentBlock = block;
            var alreadyWrapped = AbTestingUtils.isVariant(currentBlock);
            if (!alreadyWrapped) {
                currentBlock = AbTestingUtils.wrapBlock(currentBlock, context);
            }
            var isSectionTesting = Editor.SectionProvider.isSection($(block));
            var root = AbTestingUtils.getRoot(currentBlock);
            var variant = AbTestingUtils.tryGetVariant(root, context);
            var clonedBlock = AbTestingUtils.cloneBlock(currentBlock, context);
            var variantId = (root.querySelectorAll(AbTestingUtils.constants.tagName.abVariant + "[" + AbTestingUtils.constants.attributeName.testId + "='" + context.testId + "']").length + 1).toLocaleString();
            if (variant && !variant.children.length) {
                variant.appendChild(clonedBlock);
            }
            else {
                var wrapper = Editor.DomOperation.newHtmlElement(AbTestingUtils.constants.tagName.abVariant, {
                    setAttribute: [AbTestingUtils.constants.attributeName.testId, context.testId],
                    appendChild: [clonedBlock]
                });
                wrapper.setAttribute(AbTestingUtils.constants.attributeName.variantId, variantId);
                root.appendChild(wrapper);
            }
            if (isSectionTesting) {
                var currentSectionBlocks = Editor.BlockProvider.getBlocks($(currentBlock)).get();
                var newSectionBlocks = Editor.BlockProvider.getBlocks($(clonedBlock)).get();
                if (currentSectionBlocks.length === newSectionBlocks.length) {
                    for (var i = 0; i < currentSectionBlocks.length; i++) {
                        var selectionId = UniqueId.generate("selection");
                        Editor.CommonUtils.setAriaAttribute($(currentSectionBlocks[i]), AbTestingUtils.abDataAttribute, selectionId);
                        Editor.CommonUtils.setAriaAttribute($(newSectionBlocks[i]), AbTestingUtils.abDataAttribute, selectionId);
                    }
                }
                newSectionBlocks.forEach(function (blockInSection) {
                    return context.eventBroker.notify(Editor.EventConstants.blockAdded, new Editor.BlockModificationEventArgs($(blockInSection)));
                });
            }
            AbTestingUtils.notifyElementAdded(clonedBlock, context.eventBroker);
            AbTestingUtils.refreshAbTestingVisibility(root, context);
            return isSectionTesting
                ? Editor.SectionProvider.getSections($(AbTestingUtils.getCurrentVariantFromAbBlock(root, context)))[0]
                : Editor.BlockProvider.getBlocks($(AbTestingUtils.getCurrentVariantFromAbBlock(root, context)), false)[0];
        };
        AbTestingUtils.isInABTestedSection = function (block) {
            if (block && Editor.SectionProvider.isSection($(block))) {
                return false;
            }
            var parentSection = $(block).closest("[" + Editor.Contract.dataSectionAttrName + "]");
            return parentSection[0] && AbTestingUtils.isVariant(parentSection[0]);
        };
        AbTestingUtils.cloneBlock = function (block, context) {
            var clonedBlock = block.cloneNode(true);
            if (Editor.SectionProvider.isSection($(block))) {
                var eventArgs = new Editor.SectionCleanupRequestedEventArgs();
                eventArgs.section = $(clonedBlock);
                // Note: notify is synchronous
                // TODO: don't eventBroker for what should be a simple method call
                context.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionCleanupRequested, eventArgs);
                var cleanSection = eventArgs.section;
                // Section itself is cleaned up, but it is necessary to clean all blocks in this section yet
                var blockEventArgs = new Editor.BlockCleanupRequestedEventArgs();
                blockEventArgs.block = Editor.BlockProvider.getBlocks(cleanSection);
                // Note: notify is synchronous, so the cleanup will be done once the call returns
                context.eventBroker.notify(Editor.DesignerInternalEventConstants.blockCleanupRequested, blockEventArgs);
                return cleanSection[0];
            }
            else {
                var eventArgs = new Editor.BlockCleanupRequestedEventArgs();
                eventArgs.block = $(clonedBlock);
                // Note: notify is synchronous, so the cleanup will be done once the call returns
                context.eventBroker.notify(Editor.DesignerInternalEventConstants.blockCleanupRequested, eventArgs);
                return eventArgs.block[0];
            }
        };
        AbTestingUtils.tryGetVariant = function (root, context) {
            return root.querySelector(AbTestingUtils.constants.tagName.abVariant + "[" + AbTestingUtils.constants.attributeName.testId + "='" + AbTestingUtils.getCurrentTestId(context) + "'][" + AbTestingUtils.constants.attributeName.variantId + "='" + context.variantId + "']");
        };
        AbTestingUtils.removeAbBlock = function (block, context, testId) {
            if (!AbTestingUtils.isVariant(block) && !AbTestingUtils.isRoot(block)) {
                return;
            }
            var root = AbTestingUtils.isRoot(block) ? block : AbTestingUtils.getRoot(block);
            var variants = Editor.DomOperation.collectionToArray(root.querySelectorAll(AbTestingUtils.constants.tagName.abVariant + "[" + AbTestingUtils.constants.attributeName.testId + "='" + (testId || context.testId) + "']"));
            if (variants.length === 0) {
                // block not tested by current test
                return;
            }
            for (var _i = 0, variants_1 = variants; _i < variants_1.length; _i++) {
                var variant = variants_1[_i];
                variant.remove();
                var deletedElement = Editor.SectionProvider.isSection($(block))
                    ? $(Editor.SectionProvider.getSections($(variant))[0])
                    : $(Editor.BlockProvider.getBlocks($(variant))[0]);
                AbTestingUtils.notifyElementDeleted(deletedElement[0], context.eventBroker);
            }
            var children = Editor.DomOperation.collectionToArray(root.children);
            if (children.length === 1) {
                var newBlock = AbTestingUtils.unwrapVariant(children[0], context);
                return newBlock;
            }
            AbTestingUtils.refreshAbTestingVisibility(root, context);
            return Editor.BlockProvider.getBlocks($(AbTestingUtils.getCurrentVariantFromAbBlock(root, context)), false)[0];
        };
        AbTestingUtils.refreshAbTestingVisibility = function (root, context) {
            for (var _i = 0, _a = Editor.DomOperation.collectionToArray(root.getElementsByTagName(AbTestingUtils.constants.tagName.abVariant)); _i < _a.length; _i++) {
                var variant = _a[_i];
                variant.style.display = "none";
            }
            var currentVariant = AbTestingUtils.getCurrentVariantFromAbBlock(root, context);
            currentVariant.removeAttribute("style");
        };
        AbTestingUtils.wrapBlock = function (block, context) {
            if (AbTestingUtils.isVariant(block)) {
                return block;
            }
            var isSectionTesting = Editor.SectionProvider.isSection($(block));
            var wrappedBlock;
            if (isSectionTesting) {
                wrappedBlock = $(block).closest("[" + Editor.Contract.dataLayoutAttrName + "='true']")[0];
            }
            else {
                wrappedBlock = Editor.BlockProvider.getLastElementBeforeContainer($(block), false)[0];
            }
            var newBlock = AbTestingUtils.cloneBlock(block, context);
            var wrapper = Editor.DomOperation.newHtmlElement(AbTestingUtils.constants.tagName.abVariant, {
                setAttribute: [
                    AbTestingUtils.constants.attributeName.testId,
                    AbTestingUtils.constants.defaultValue.testId
                ],
                appendChild: [newBlock]
            });
            wrapper.setAttribute(AbTestingUtils.constants.attributeName.variantId, AbTestingUtils.constants.defaultValue.variantId);
            var wrapperContainer = Editor.DomOperation.newHtmlElement(AbTestingUtils.constants.tagName.abTesting, {
                appendChild: [wrapper]
            });
            if (isSectionTesting) {
                wrappedBlock.replaceChild(wrapperContainer, block);
            }
            else {
                wrappedBlock.parentElement.replaceChild(wrapperContainer, wrappedBlock);
            }
            AbTestingUtils.notifyElementAdded(newBlock, context.eventBroker);
            return newBlock;
        };
        AbTestingUtils.unwrapVariant = function (variant, context, notifyChange) {
            if (notifyChange === void 0) { notifyChange = true; }
            var root = variant.parentElement;
            if (variant.children.length) {
                var child = variant.children[0];
                var newBlock = void 0;
                if (Editor.SectionProvider.isSection($(child))) {
                    newBlock = AbTestingUtils.cloneBlock(Editor.SectionProvider.getSections($(child))[0], context);
                }
                else {
                    newBlock = AbTestingUtils.cloneBlock(Editor.BlockProvider.getBlocks($(child), false)[0], context);
                }
                root.parentElement.replaceChild(newBlock, root);
                if (notifyChange) {
                    var removedElement = (Editor.SectionProvider.isSection($(child))
                        ? $(Editor.SectionProvider.getSections($(child))[0])
                        : $(Editor.BlockProvider.getBlocks($(child))[0]))[0];
                    AbTestingUtils.notifyElementDeleted(removedElement, context.eventBroker);
                    AbTestingUtils.notifyElementAdded(newBlock, context.eventBroker);
                }
                return newBlock;
            }
            else {
                root.remove();
                return null;
            }
        };
        AbTestingUtils.unwrapAbBlock = function (abBlock, context, notifyChange) {
            if (notifyChange === void 0) { notifyChange = true; }
            return AbTestingUtils.unwrapVariant(AbTestingUtils.getCurrentVariantFromAbBlock(abBlock, context), context, notifyChange);
        };
        AbTestingUtils.getRoot = function (block) {
            if (!AbTestingUtils.isVariant(block) && !AbTestingUtils.isInABTestedSection(block)) {
                return null;
            }
            var wrappedBlock = Editor.BlockProvider.getLastElementBeforeContainer($(block), false)[0];
            return wrappedBlock.parentElement.parentElement;
        };
        AbTestingUtils.isVariant = function (block) {
            var wrappedBlock = Editor.BlockProvider.getLastElementBeforeContainer($(block), false)[0];
            var variantElement;
            var abBlockElement;
            if (Utility.isNullOrUndefined((variantElement = wrappedBlock.parentElement)) ||
                variantElement.tagName.toLocaleLowerCase() !== AbTestingUtils.constants.tagName.abVariant ||
                Utility.isNullOrUndefined(variantElement.getAttribute(AbTestingUtils.constants.attributeName.testId)) ||
                Utility.isNullOrUndefined(variantElement.getAttribute(AbTestingUtils.constants.attributeName.variantId)) ||
                Utility.isNullOrUndefined((abBlockElement = variantElement.parentElement)) ||
                abBlockElement.tagName.toLocaleLowerCase() !== AbTestingUtils.constants.tagName.abTesting) {
                return false;
            }
            return true;
        };
        AbTestingUtils.restoreSelection = function (context, selectedBlock, iframeContents) {
            var selectedBlockId = selectedBlock && selectedBlock.attr(Editor.Contract.idAttrName);
            var selectedABBlockId = selectedBlock && selectedBlock.attr(AbTestingUtils.abDataAttribute);
            if (selectedABBlockId) {
                var blocksABIds = iframeContents.find("[data-ab-id=\"" + selectedABBlockId + "\"]").get();
                if (blocksABIds.length !== 2) {
                    return;
                }
                var blockToSelect = blocksABIds[0].id === selectedBlockId ? blocksABIds[1] : blocksABIds[0];
                context.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.block, null, $(blockToSelect), null, null));
                context.eventBroker.notify(Editor.DesignerInternalEventConstants.itemFocused, new Editor.ItemFocusedEventArgs(blockToSelect, true));
                return;
            }
            if (selectedBlockId) {
                var currentVariant = AbTestingUtils.getCurrentVariantFromBlock(selectedBlock[0], context);
                if (currentVariant) {
                    var currentBlock = void 0;
                    if (Editor.SectionProvider.isSection(selectedBlock)) {
                        currentBlock = currentVariant.querySelector("[" + Editor.Contract.dataSectionAttrName + "]");
                    }
                    else {
                        currentBlock = currentVariant.querySelector("[" + Editor.Contract.blockTypeAttrName + "]");
                    }
                    selectedBlockId = currentBlock.getAttribute(Editor.Contract.idAttrName);
                }
                var element = iframeContents.find("#" + selectedBlockId);
                if (element.length > 0) {
                    context.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.block, null, element, null, null));
                    context.eventBroker.notify(Editor.DesignerInternalEventConstants.itemFocused, new Editor.ItemFocusedEventArgs(element[0], true));
                }
            }
        };
        AbTestingUtils.deleteAbTestedBlock = function (eventBroker, block) {
            if (!block) {
                return;
            }
            var abTestElement = $(AbTestingUtils.getRoot(block));
            var removedBlocks = Editor.BlockProvider.getBlocks(abTestElement).get();
            abTestElement.remove();
            removedBlocks.forEach(function (b) {
                var eventArgs = new Editor.BlockDeletedEventArgs();
                eventArgs.partOfUpdate = false;
                eventArgs.block = $(b);
                eventBroker.notify(Editor.EventConstants.blockDeleted, eventArgs);
            });
        };
        AbTestingUtils.isRoot = function (block) {
            return block.tagName.toLowerCase() === AbTestingUtils.constants.tagName.abTesting;
        };
        AbTestingUtils.notifyElementAdded = function (element, eventBroker) {
            if (!element) {
                return;
            }
            if (Editor.SectionProvider.isSection($(element))) {
                var sectionEventArgs = new Editor.SectionModificationEventArgs($(element));
                sectionEventArgs.sourceId = AbTestingUtils.constants.eventSourceId;
                eventBroker.notify(Editor.EventConstants.sectionAdded, sectionEventArgs);
                var blockEventArgs = new Editor.BlockModificationEventArgs(Editor.BlockProvider.getBlocks($(element)));
                blockEventArgs.sourceId = AbTestingUtils.constants.eventSourceId;
                blockEventArgs.shouldFocus = false;
                eventBroker.notify(Editor.EventConstants.blockAdded, blockEventArgs);
            }
            else {
                var blockEventArgs = new Editor.BlockModificationEventArgs($(element));
                blockEventArgs.sourceId = AbTestingUtils.constants.eventSourceId;
                eventBroker.notify(Editor.EventConstants.blockAdded, blockEventArgs);
            }
        };
        AbTestingUtils.notifyElementDeleted = function (element, eventBroker) {
            if (!element) {
                return;
            }
            var args = new Editor.BlockModificationEventArgs($(element));
            args.sourceId = AbTestingUtils.constants.eventSourceId;
            if (Editor.SectionProvider.isSection($(element))) {
                eventBroker.notify(Editor.EventConstants.sectionDeleted, args);
            }
            else {
                eventBroker.notify(Editor.EventConstants.blockDeleted, args);
            }
        };
        AbTestingUtils.abDataAttribute = "data-ab-id";
        AbTestingUtils.constants = {
            attributeName: {
                testId: "data-abtest-id",
                variantId: "data-abvariant-id"
            },
            defaultValue: {
                testId: "00000000-0000-0000-0000-000000000000",
                variantId: "0"
            },
            tagName: {
                abTesting: "ab-testing",
                abVariant: "ab-variant"
            },
            eventSourceId: "AbTesting"
        };
        return AbTestingUtils;
    }());
    Editor.AbTestingUtils = AbTestingUtils;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CkEditorConstants = /** @class */ (function () {
        function CkEditorConstants() {
        }
        CkEditorConstants.ckEditorImageSrcAttribute = "data-cke-saved-src";
        CkEditorConstants.ckEditorHrefAttribute = "data-cke-saved-href";
        CkEditorConstants.ckEditorSharedResourceAttribute = "ckEditorSharedResource";
        CkEditorConstants.ckEditorNativeListeners = "_cke_nativeListeners";
        CkEditorConstants.ckEditorDialogTextAreaSelector = "span.cke_dialog_ui_html";
        CkEditorConstants.ckEditorDialogPasteFrameSelector = ".cke_pasteframe";
        CkEditorConstants.ckEditorInstanceReadyInternalEventName = "instanceReady";
        CkEditorConstants.ckEditorContentDomInternalEventName = "contentDom";
        CkEditorConstants.ckEditorInputInternalEventName = "input";
        CkEditorConstants.ckEditorChangeInternalEventName = "change";
        CkEditorConstants.ckEditorFocusInternalEventName = "focus";
        CkEditorConstants.ckEditorLoadedStatus = "loaded";
        CkEditorConstants.ckEditorReadyStatus = "ready";
        CkEditorConstants.ckEditorButtonSelector = "a.cke_button";
        CkEditorConstants.ckEditorComboButtonSelector = "a.cke_combo_button";
        CkEditorConstants.ckEditorButtonLabelSelector = ".cke_button_label[id$='label']";
        return CkEditorConstants;
    }());
    Editor.CkEditorConstants = CkEditorConstants;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var ParentFlagButton = /** @class */ (function () {
        function ParentFlagButton(eventBroker, localizationProvider) {
            this.eventBroker = eventBroker;
            this.localizationProvider = localizationProvider;
        }
        ParentFlagButton.prototype.shouldRender = function (context) {
            return context.selectedBlockType !== Editor.BlockConstants.SelectableType.section;
        };
        ParentFlagButton.prototype.render = function (context) {
            var _this = this;
            // prettier-ignore
            return $("<button>", {
                "id": UniqueId.generate(),
                "type": Editor.CommonConstants.buttonType,
                "class": Editor.CommonConstants.decoratedAreaButtonCssClass + " parentBlockBtn",
                "click": function (e) {
                    e.stopPropagation();
                    if (context.selectedBlock === null) {
                        return;
                    }
                    var sectionElement;
                    switch (context.selectedBlockType) {
                        case Editor.BlockConstants.SelectableType.subBlock:
                        case Editor.BlockConstants.SelectableType.block:
                            sectionElement = $(context.selectedBlock).closest("[data-container]");
                            break;
                        case Editor.BlockConstants.SelectableType.container:
                            sectionElement = $(context.selectedBlock).closest("[data-section]");
                            break;
                        default:
                            break;
                    }
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.itemFocused, new Editor.ItemFocusedEventArgs(sectionElement));
                },
                "aria-label": this.localizationProvider.getLocalizedString(Editor.CommonConstants.parentLabel),
                "title": this.localizationProvider.getLocalizedString(Editor.CommonConstants.parentLabel),
                "append": [
                    $("<div>", {
                        class: Editor.CommonConstants.decoratedAreaIconReturnCssClass
                    })
                ]
            })[0];
        };
        ParentFlagButton.prototype.position = function () {
            return Editor.FlagButtonPosition.Top;
        };
        ParentFlagButton.prototype.getName = function () {
            return "ParentFlagButton";
        };
        ParentFlagButton.prototype.dispose = function () { };
        return ParentFlagButton;
    }());
    Editor.ParentFlagButton = ParentFlagButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var DeleteFlagButton = /** @class */ (function () {
        function DeleteFlagButton(eventBroker, localizationProvider, blockDefinition) {
            this.eventBroker = eventBroker;
            this.localizationProvider = localizationProvider;
            this.blockDefinition = blockDefinition;
        }
        DeleteFlagButton.prototype.shouldRender = function (context) {
            return true;
        };
        DeleteFlagButton.prototype.render = function (context) {
            var _this = this;
            // prettier-ignore
            return $("<button>", {
                "id": UniqueId.generate(),
                "type": Editor.CommonConstants.buttonType,
                "class": Editor.CommonConstants.decoratedAreaButtonCssClass + " deleteBlockBtn",
                "click": Editor.AbTestingUtils.isVariant(context.selectedBlock)
                    ? function (e) {
                        e.stopPropagation();
                        Editor.AbTestingUtils.deleteAbTestedBlock(_this.eventBroker, context.selectedBlock);
                    }
                    : function (e) {
                        e.stopPropagation();
                        if (context.selectedBlock === null) {
                            return;
                        }
                        switch (context.selectedBlockType) {
                            case Editor.BlockConstants.SelectableType.subBlock:
                            case Editor.BlockConstants.SelectableType.block:
                                var wrappedBlock = Editor.BlockProvider.getLastElementBeforeContainer($(context.selectedBlock), false);
                                wrappedBlock.remove();
                                break;
                            case Editor.BlockConstants.SelectableType.container:
                                var containerblocks = Editor.BlockProvider.getBlocks($(context.selectedBlock)).toArray();
                                containerblocks.forEach(function (containerBlock) {
                                    var containerBlockDef = _this.blockDefinition.getBlockDefinition($(containerBlock));
                                    if (containerBlockDef) {
                                        containerBlockDef.dispose();
                                    }
                                });
                                _this.deleteContainer(context);
                                break;
                            case Editor.BlockConstants.SelectableType.section:
                                var blocks = Editor.BlockProvider.getBlocks($(context.selectedBlock)).toArray();
                                blocks.forEach(function (block) {
                                    var blockDef = _this.blockDefinition.getBlockDefinition($(block));
                                    if (blockDef) {
                                        blockDef.dispose();
                                    }
                                });
                                $(context.selectedBlock).closest("." + Editor.CommonConstants.selectedElementCssClass).remove();
                                break;
                            default:
                                break;
                        }
                        var eventArgs = new Editor.BlockDeletedEventArgs();
                        eventArgs.partOfUpdate = false;
                        eventArgs.block = $(context.selectedBlock);
                        _this.eventBroker.notify(Editor.EventConstants.blockDeleted, eventArgs);
                    },
                "aria-label": this.localizationProvider.getLocalizedString(Editor.CommonConstants.deleteBlockLabel),
                "title": this.localizationProvider.getLocalizedString(Editor.CommonConstants.deleteLabel),
                "append": [
                    $("<div>", {
                        class: Editor.CommonConstants.decoratedAreaIconDeleteCssClass
                    })
                ]
            })[0];
        };
        DeleteFlagButton.prototype.position = function () {
            return Editor.FlagButtonPosition.Top;
        };
        DeleteFlagButton.prototype.getName = function () {
            return "DeleteFlagButton";
        };
        DeleteFlagButton.prototype.dispose = function () { };
        DeleteFlagButton.prototype.deleteContainer = function (context) {
            var sectionElement = $(context.selectedBlock).closest("[data-section]").get(0);
            if (sectionElement) {
                var containerCount = sectionElement.querySelectorAll("[data-container=\"true\"]");
                if (containerCount && containerCount.length === 1) {
                    sectionElement.parentElement.removeChild(sectionElement);
                }
                else {
                    $(context.selectedBlock)
                        .closest("." + Editor.CommonConstants.selectedElementCssClass)
                        .remove();
                    if (containerCount && containerCount.length === 2) {
                        Editor.SectionDetailsView.prototype.setColumnsWidths(sectionElement, Editor.DetailsViewConstants.oneColumnOptionValue);
                    }
                    else if (containerCount && containerCount.length === 3) {
                        Editor.SectionDetailsView.prototype.setColumnsWidths(sectionElement, Editor.DetailsViewConstants.twoColumnOptionValue);
                    }
                    else if (containerCount && containerCount.length > 3) {
                        Editor.SectionDetailsView.prototype.setColumnsWidths(sectionElement, Editor.DetailsViewConstants.customColumnOptionValue);
                    }
                    this.eventBroker.notify(Editor.EventConstants.sectionAdded, new Editor.SectionModificationEventArgs($(sectionElement), Editor.EventConstants.detailsViewOrigin));
                }
            }
            else {
                $(context.selectedBlock)
                    .closest("." + Editor.CommonConstants.selectedElementCssClass)
                    .remove();
            }
        };
        return DeleteFlagButton;
    }());
    Editor.DeleteFlagButton = DeleteFlagButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var FlagButtonPosition;
    (function (FlagButtonPosition) {
        FlagButtonPosition[FlagButtonPosition["Top"] = 0] = "Top";
        FlagButtonPosition[FlagButtonPosition["Left"] = 1] = "Left";
    })(FlagButtonPosition = Editor.FlagButtonPosition || (Editor.FlagButtonPosition = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var MoveFlagButton = /** @class */ (function () {
        function MoveFlagButton(eventBroker, localizationProvider) {
            this.eventBroker = eventBroker;
            this.localizationProvider = localizationProvider;
        }
        MoveFlagButton.prototype.shouldRender = function (context) {
            if (!context.selectBlock || !context.selectedBlock.ownerDocument) {
                return false;
            }
            if (context.selectedBlockType === Editor.BlockConstants.SelectableType.container) {
                return false;
            }
            if (context.selectedBlockType === Editor.BlockConstants.SelectableType.section) {
                var editorRoot = $(context.selectedBlock.ownerDocument.body);
                var sections = Editor.BlockUtils.getAllSections(editorRoot);
                if (sections.length < 2) {
                    // If there is only one section, no point in showing the 'move' button for the section
                    return false;
                }
            }
            return true;
        };
        MoveFlagButton.prototype.render = function (context) {
            var _this = this;
            // prettier-ignore
            return $("<div>", {
                "id": UniqueId.generate(),
                "class": Editor.CommonConstants.decoratedAreaButtonCssClass + " " + Editor.CommonConstants.dragButtonClassName + " moveBlockBtn",
                "click": function (e) {
                    e.stopPropagation();
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerMoveStarted);
                },
                "aria-label": this.localizationProvider.getLocalizedString(Editor.CommonConstants.moveBlockLabel),
                "title": this.localizationProvider.getLocalizedString(Editor.CommonConstants.moveLabel),
                "append": [
                    $("<div>", {
                        class: Editor.CommonConstants.decoratedAreaIconMoveCssClass
                    })
                ]
            })[0];
        };
        MoveFlagButton.prototype.position = function () {
            return Editor.FlagButtonPosition.Top;
        };
        MoveFlagButton.prototype.getName = function () {
            return "MoveFlagButton";
        };
        MoveFlagButton.prototype.dispose = function () { };
        return MoveFlagButton;
    }());
    Editor.MoveFlagButton = MoveFlagButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var SelectionStateModel = /** @class */ (function () {
        function SelectionStateModel(eventBroker, logger) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.logger = logger;
            this.delayOnSelectionChild = 250;
            this.currentSelectionType = Editor.BlockConstants.SelectableType.none;
            this.lastSelectionTime = 0;
            this.itemFocusedCallback = eventBroker.subscribe(Editor.DesignerInternalEventConstants.itemFocused, function (args) {
                _this.onItemFocused(args);
            });
            this.emailTemplateChangedCallback = eventBroker.subscribe(Editor.EventConstants.emailTemplateChanged, function (args) {
                _this.onEmailTemplateChanged(args);
            });
            this.resetFocusCallback = eventBroker.subscribe(Editor.DesignerInternalEventConstants.resetItemSelection, function () {
                _this.resetSelection();
            });
        }
        SelectionStateModel.prototype.getCurrentSelection = function () {
            return this.currentSelection;
        };
        SelectionStateModel.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.itemFocused, this.itemFocusedCallback);
            this.eventBroker.unsubscribe(Editor.EventConstants.emailTemplateChanged, this.emailTemplateChangedCallback);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.resetItemSelection, this.resetFocusCallback);
        };
        SelectionStateModel.prototype.onItemFocused = function (args) {
            if (this.currentSelection) {
                if (!Editor.CommonUtils.isElementInDesignerFrame(this.currentSelection)) {
                    this.logger.log(MktSvc.Controls.Common.TraceLevel.Error, "[SelectionStateModel.onItemFocused] Current selection is invalid, resetting");
                    this.resetSelection();
                }
            }
            this.selectableColumnsSelectionChanges(args);
        };
        SelectionStateModel.prototype.currentSelectionChanges = function (args) {
            var selectable = Editor.BlockUtils.getClosestSelectableItem($(args.item));
            var currentTime = new Date().getTime();
            if (this.currentSelection == null) {
                var furthestSelectableItem = args.forceSelection
                    ? selectable
                    : Editor.BlockUtils.getFurthestSelectableItem(selectable);
                // First selection!
                this.updateSelectionType(furthestSelectableItem, Editor.BlockUtils.determineSelectableType(furthestSelectableItem), currentTime);
            }
            else if (!this.currentSelection.is(selectable)) {
                var selectableType = Editor.BlockUtils.determineSelectableType(selectable);
                var fromLastSelectionTillNow = currentTime - this.lastSelectionTime;
                if (!args.forceSelection && $.contains(args.item, this.currentSelection[0])) {
                    // If the item being selected is a parent of the currently
                    // selected item, it is a no-op.
                    return;
                }
                else if (selectableType > this.currentSelectionType) {
                    this.lastSelectionTime = currentTime;
                    // If we've selected something at a higher
                    // selection level, and it is not a parent of the currently
                    // selected item, we transition to it immediately
                    this.updateSelectionType(selectable, selectableType, currentTime);
                }
                else if (selectableType === this.currentSelectionType && this.isSibling(args.item)) {
                    // If we've selected something on the same selection level,
                    // transition to it if it is a sibling
                    this.updateSelectionType(selectable, this.currentSelectionType, currentTime);
                }
                else if (this.currentSelection.length &&
                    $.contains(this.currentSelection[0], args.item) &&
                    fromLastSelectionTillNow > this.delayOnSelectionChild) {
                    // If we've selected something within the current selected
                    // item, we go one step closer
                    switch (this.currentSelectionType) {
                        case Editor.BlockConstants.SelectableType.none: {
                            this.updateSelectionType(Editor.BlockUtils.getFurthestSelectableItem(selectable), Editor.BlockUtils.determineSelectableType(Editor.BlockUtils.getFurthestSelectableItem(selectable)), currentTime);
                            break;
                        }
                        case Editor.BlockConstants.SelectableType.section: {
                            this.updateSelectionType(Editor.BlockUtils.getClosestBlock(selectable), Editor.BlockConstants.SelectableType.block, currentTime);
                            break;
                        }
                        case Editor.BlockConstants.SelectableType.block: {
                            this.updateSelectionType(selectable, Editor.BlockConstants.SelectableType.subBlock, currentTime);
                            break;
                        }
                        default: {
                            this.logger.log(MktSvc.Controls.Common.TraceLevel.Error, "[SelectionStatemModel.onItemFocused] Unknown selection type: " + this.currentSelection);
                            break;
                        }
                    }
                }
                else if (Editor.BlockUtils.isSubBlock(selectable) &&
                    Editor.BlockUtils.getParentSection(Editor.BlockUtils.getClosestBlock(selectable)[0]) ===
                        Editor.BlockUtils.getParentSection(this.currentSelection[0])) {
                    // Case of selecting content block after selection of sibling block
                    this.updateSelectionType(Editor.BlockUtils.getClosestBlock(selectable), Editor.BlockConstants.SelectableType.block, currentTime);
                }
                else {
                    // Otherwise we've selected something that is in a different
                    // selectable context. Go to the highest level selectable
                    // for that item
                    this.updateSelectionType(args.forceSelection ? selectable : Editor.BlockUtils.getFurthestSelectableItem(selectable), Editor.BlockUtils.determineSelectableType(args.forceSelection ? selectable : Editor.BlockUtils.getFurthestSelectableItem(selectable)), currentTime);
                }
            }
        };
        SelectionStateModel.prototype.selectableColumnsSelectionChanges = function (args) {
            var selectable = Editor.BlockUtils.getClosestSelectableItem($(args.item));
            if (this.currentSelection == null || !this.currentSelection.is(selectable)) {
                this.updateSelectionType(selectable, Editor.BlockUtils.determineSelectableType(selectable), new Date().getTime());
            }
        };
        SelectionStateModel.prototype.onEmailTemplateChanged = function (args) {
            this.resetSelection();
        };
        SelectionStateModel.prototype.resetSelection = function () {
            this.currentSelection = null;
            this.currentSelectionType = Editor.BlockConstants.SelectableType.none;
            this.lastSelectionTime = 0;
            this.notifyChanged();
        };
        SelectionStateModel.prototype.isSibling = function (selection) {
            switch (this.currentSelectionType) {
                case Editor.BlockConstants.SelectableType.block:
                case Editor.BlockConstants.SelectableType.container: {
                    var section = Editor.BlockUtils.getClosestSection(this.currentSelection);
                    if (section == null || section[0] == null) {
                        return false;
                    }
                    return $.contains(section[0], selection);
                }
                case Editor.BlockConstants.SelectableType.subBlock: {
                    var block = Editor.BlockUtils.getClosestBlock(this.currentSelection);
                    return $.contains(block[0], selection);
                }
                default:
                    return false;
            }
        };
        SelectionStateModel.prototype.updateSelectionType = function (currentSelection, selectionType, selectionTime) {
            this.lastSelectionTime = selectionTime;
            if (this.currentSelection == null ||
                !this.currentSelection.is(currentSelection) ||
                this.currentSelectionType !== selectionType) {
                this.currentSelection = currentSelection;
                this.currentSelectionType = selectionType;
                this.notifyChanged();
            }
        };
        SelectionStateModel.prototype.notifyChanged = function () {
            if (this.currentSelection === null) {
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(this.currentSelectionType, null, null, null, null));
            }
            else {
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(this.currentSelectionType, SelectionStateModel.getNotEmpty(Editor.BlockUtils.getClosestSubBlock(this.currentSelection)), SelectionStateModel.getNotEmpty(Editor.BlockUtils.getClosestBlock(this.currentSelection)), SelectionStateModel.getNotEmpty(Editor.BlockUtils.getClosestContainer(this.currentSelection)), SelectionStateModel.getNotEmpty(Editor.BlockUtils.getClosestSection(this.currentSelection))));
            }
        };
        SelectionStateModel.getNotEmpty = function (collection) {
            if (collection.length > 0) {
                return collection;
            }
            return null;
        };
        return SelectionStateModel;
    }());
    Editor.SelectionStateModel = SelectionStateModel;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var SelectedAreaDecorator = /** @class */ (function () {
        function SelectedAreaDecorator(eventBroker, blockDefinition, logger, localizationProvider, flagButtons, fcbList) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.blockDefinition = blockDefinition;
            this.logger = logger;
            this.localizationProvider = localizationProvider;
            this.flagButtons = flagButtons;
            this.fcbList = fcbList;
            this.cleanupHighlightedArea = function () {
                if (_this.currentDecorated != null && Editor.CommonUtils.isElementInDesignerFrame(_this.currentDecorated)) {
                    var section = Editor.BlockUtils.getClosestSection(_this.currentDecorated);
                    if (section) {
                        _this.cleanupOutlinesForSection(section);
                    }
                    _this.currentDecorated.unwrap();
                }
                if (_this.areaHeader != null && Editor.CommonUtils.isElementInDesignerFrame(_this.areaHeader)) {
                    _this.areaHeader.unwrap();
                    _this.areaHeader.remove();
                }
                if (_this.decoratedSection != null && Editor.CommonUtils.isElementInDesignerFrame(_this.decoratedSection)) {
                    _this.cleanupOutlinesForSection(_this.decoratedSection);
                    _this.decoratedSection = null;
                }
                // When blocks are cloned (for example, by AB testing), the decorations can get accidentally duplicated too.
                // Find and remove all left-over decorations, just in case.
                var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
                _this.cleanup(designerFrame.contents());
            };
            this.selectionChangedCallback = eventBroker.subscribe(Editor.DesignerInternalEventConstants.selectionChanged, function (eventArgs) {
                _this.onSelectionChanged(eventArgs);
            });
            this.resetFocusCallback = eventBroker.subscribe(Editor.DesignerInternalEventConstants.resetItemSelection, function () {
                _this.resetSelection();
            });
            this.emailTemplateChangedCallback = eventBroker.subscribe(Editor.EventConstants.emailTemplateChanged, function (eventArgs) {
                _this.onEmailTemplateChanged(eventArgs);
            });
        }
        SelectedAreaDecorator.prototype.onSelectionChanged = function (eventArgs) {
            var operableBlock = eventArgs.getOperableBlock();
            // Nothing is selected - reseting selection.
            // if body/form is selected then selection styles should not be applied - return;
            if (eventArgs.type === Editor.BlockConstants.SelectableType.none && Utility.isNullOrUndefined(operableBlock)) {
                this.resetSelection();
                return;
            }
            else if (Utility.isNullOrUndefined(operableBlock) ||
                eventArgs.type === Editor.BlockConstants.SelectableType.body ||
                eventArgs.type === Editor.BlockConstants.SelectableType.form) {
                return;
            }
            var selectedBlockType = Editor.BlockUtils.determineSelectableType(operableBlock);
            this.resetSelection();
            this.currentDecorated = operableBlock;
            var decoratedAreaMarker = $("<div>").addClass(Editor.CommonConstants.decoratedAreaMarkerCssClass);
            if (this.fcbList && this.fcbList.isResponsiveDesign && eventArgs.type == Editor.BlockConstants.SelectableType.container) {
                decoratedAreaMarker[0].style.display = "flex";
            }
            var hadFocus = false;
            // wrapping current block or a section later in this method will cause that we will lose focus, we should remember it and restore later
            if (document.activeElement instanceof HTMLIFrameElement) {
                var activeElement = document.activeElement.contentWindow.document
                    .activeElement;
                var selectedSectionIsOperableBlock = !Utility.isNullOrUndefined(eventArgs.selectedSection) &&
                    eventArgs.selectedSection[0] === operableBlock[0];
                var activeElementSectionIsOperableBlock = !Utility.isNullOrUndefined(activeElement) &&
                    $(activeElement).closest("[" + Editor.Contract.dataSectionAttrName + "]") === operableBlock;
                if (activeElement === operableBlock[0] ||
                    (selectedSectionIsOperableBlock || activeElementSectionIsOperableBlock)) {
                    hadFocus = true;
                }
            }
            var operableBlockWrapped = operableBlock.wrap(decoratedAreaMarker);
            var propertiesToCopy = [
                "width",
                "padding",
                "margin",
                "padding-left",
                "padding-right",
                "padding-top",
                "padding-bottom",
                "margin-left",
                "margin-right",
                "margin-top",
                "margin-bottom",
                "height",
                "min-width",
                "min-height"
            ];
            propertiesToCopy.forEach(function (cssPropertyName) {
                var cssPropertyValue = operableBlock.css(cssPropertyName);
                if (cssPropertyValue && cssPropertyValue.length) {
                    decoratedAreaMarker.css(cssPropertyName, cssPropertyValue);
                }
            });
            var wrapRectangle = operableBlockWrapped.parent();
            var areaHeader = $("<div>").addClass(Editor.CommonConstants.decoratedAreaHeaderCssClass);
            switch (eventArgs.type) {
                case Editor.BlockConstants.SelectableType.subBlock:
                case Editor.BlockConstants.SelectableType.block:
                    var block = this.blockDefinition.getBlockDefinition(operableBlock);
                    if (!Utility.isNullOrUndefined(block)) {
                        this.setLocalizedHeader(areaHeader, block.getLocalizedTitle());
                    }
                    this.drawOutlinesOnBlockSelection(Editor.BlockProvider.getBlockSection(eventArgs.selectedBlock));
                    break;
                case Editor.BlockConstants.SelectableType.container:
                    var columnTitle = this.localizationProvider.getLocalizedString(Editor.CommonConstants.columnTitle);
                    this.setLocalizedHeader(areaHeader, columnTitle);
                    this.drawOutlinesOnContainerSelection(eventArgs.selectedContainer);
                    break;
                case Editor.BlockConstants.SelectableType.section:
                    var title = this.localizationProvider.getLocalizedString(Editor.CommonConstants.sectionTitle);
                    this.setLocalizedHeader(areaHeader, title);
                    this.drawOutlinesOnSectionSelection(eventArgs.selectedSection);
                    break;
                default:
                    break;
            }
            var contextualButtons = this.getContextualButtons(selectedBlockType, Editor.FlagButtonPosition.Top);
            var selectedElementWrapper = $("<div>").addClass(Editor.CommonConstants.selectedElementCssClass);
            selectedElementWrapper.attr("tabindex", "0");
            var selectedElement = wrapRectangle.wrap(selectedElementWrapper);
            if (contextualButtons.length > 0) {
                var decoratedAreaButtons_1 = $("<div>").addClass(Editor.CommonConstants.decoratedAreaButtonDivCssClass);
                contextualButtons.forEach(function (button) { return decoratedAreaButtons_1.append(button); });
                areaHeader.append(decoratedAreaButtons_1);
            }
            areaHeader.insertBefore(wrapRectangle);
            this.areaHeader = areaHeader;
            if (hadFocus) {
                selectedElement.parent().focus();
            }
        };
        SelectedAreaDecorator.prototype.onSelectBodyContent = function (bodyContent, type) {
            var operableContent;
            if (!Utility.isNullOrUndefined(bodyContent)) {
                if (type === Editor.BlockConstants.SelectableType.body) {
                    operableContent = bodyContent.find("[" + Editor.Contract.dataLayoutAttrName + "=\"true\"]");
                }
                else if (type === Editor.BlockConstants.SelectableType.form) {
                    operableContent = bodyContent.find("form");
                }
                if (!Utility.isNullOrUndefined(operableContent) &&
                    !Utility.isNullOrUndefined(operableContent[0]) &&
                    operableContent.length !== 0) {
                    var content = operableContent[0];
                    var hasTabIndex = content.hasAttribute("tabindex");
                    content.focus();
                    if (!hasTabIndex) {
                        content.setAttribute("tabindex", "0");
                    }
                    this.resetSelection();
                    if (type === Editor.BlockConstants.SelectableType.body) {
                        this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.body, null, null, null, null, operableContent));
                    }
                    else if (type === Editor.BlockConstants.SelectableType.form) {
                        this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.form, null, null, null, null, null, operableContent));
                    }
                }
                else {
                    var content = bodyContent[0];
                    content.setAttribute("tabindex", "0");
                    this.resetSelection();
                    if (type === Editor.BlockConstants.SelectableType.body) {
                        content.focus({ preventScroll: true });
                        this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.body, null, null, null, null, bodyContent));
                    }
                    else {
                        content.focus();
                    }
                }
            }
        };
        SelectedAreaDecorator.prototype.drawContainerOutline = function (container) {
            if (container &&
                container.length > 0 &&
                !container[0].classList.contains(Editor.LayoutStyles.emptyContainerCssClass)) {
                container[0].classList.add(Editor.LayoutStyles.emptyContainerCssClass);
            }
        };
        SelectedAreaDecorator.prototype.removeContainerOutline = function (container) {
            if (container &&
                container.length > 0 &&
                container[0].classList.contains(Editor.LayoutStyles.emptyContainerCssClass)) {
                container[0].classList.remove(Editor.LayoutStyles.emptyContainerCssClass);
            }
        };
        SelectedAreaDecorator.prototype.onEmailTemplateChanged = function (args) {
            this.resetSelection();
        };
        SelectedAreaDecorator.prototype.resetSelection = function () {
            this.cleanupHighlightedArea();
            this.currentDecorated = null;
            this.areaHeader = null;
            this.decoratedSection = null;
        };
        SelectedAreaDecorator.prototype.setLocalizedHeader = function (areaHeader, title) {
            var decoratedAreaTitle = $("<div>")
                .text(title)
                .addClass(Editor.CommonConstants.decoratedAreaTitleCssClass);
            Editor.CommonUtils.setAriaAttribute(decoratedAreaTitle, "aria-label", title);
            areaHeader.append(decoratedAreaTitle);
        };
        SelectedAreaDecorator.prototype.drawOutlinesOnBlockSelection = function (blockHolderSection) {
            var _this = this;
            // Draw outline for the section containing the selected block
            this.decoratedSection = blockHolderSection;
            blockHolderSection.children().first().attr("style", Editor.LayoutStyles.defaultSection);
            this.drawContainerOutline(blockHolderSection);
            // Draw outline for all containers in the section which the selected block is in
            var containers = Editor.ContainerProvider.getContainers(blockHolderSection).toArray().map(function (elem) { return $(elem); });
            containers.forEach(function (container) { return _this.drawContainerOutline(container); });
        };
        SelectedAreaDecorator.prototype.drawOutlinesOnSectionSelection = function (section) {
            var _this = this;
            // Remove the outline from the section (decorated via highlight)
            this.decoratedSection = section;
            section.children().first().attr("style", Editor.LayoutStyles.defaultSection);
            this.removeContainerOutline(section);
            // Draw outline for all empty containers (without blocks) in the section
            var containersWithoutBlock = Editor.ContainerProvider.getContainersWithoutBlocks(section);
            containersWithoutBlock.forEach(function (container) { return _this.drawContainerOutline(container); });
        };
        SelectedAreaDecorator.prototype.drawOutlinesOnContainerSelection = function (container) {
            var _this = this;
            this.decoratedElements = container;
            // Draw outline for the section which the selected container is in
            var containerHolderSection = Editor.BlockUtils.getParentElement(container, Editor.Contract.dataSectionAttrName);
            this.drawContainerOutline(containerHolderSection);
            // Draw outline for all containers (even non-empty ones) which are in the same section as the selected one
            var containers = Editor.ContainerProvider.getContainers(containerHolderSection).toArray().map(function (elem) { return $(elem); });
            containers.forEach(function (containerInSection) {
                containerInSection.is(container) ?
                    _this.removeContainerOutline(containerInSection) : // Selected container
                    _this.drawContainerOutline(containerInSection); // Non-selected container
            });
        };
        SelectedAreaDecorator.prototype.cleanupOutlinesForSection = function (section) {
            var _this = this;
            section.children().first().attr("style", Editor.LayoutStyles.defaultSection);
            // Remove outlines for all containers with blocks
            var containersWithBlock = Editor.ContainerProvider.getContainersWithBlocks(section);
            containersWithBlock.forEach(function (container) { return _this.removeContainerOutline(container); });
            // Draw outlines for all containers without blocks
            var containersWithoutBlock = Editor.ContainerProvider.getContainersWithoutBlocks(section);
            containersWithoutBlock.forEach(function (container) { return _this.drawContainerOutline(container); });
            // Draw outline if the section is empty (doesn't contain any blocks)
            // Remove outline if the section is not empty (contains at leas a block)
            (containersWithBlock && containersWithBlock.length > 0) ?
                this.removeContainerOutline(section) :
                this.drawContainerOutline(section);
        };
        SelectedAreaDecorator.prototype.dispose = function () {
            this.resetSelection();
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.selectionChanged, this.selectionChangedCallback);
            this.eventBroker.unsubscribe(Editor.EventConstants.emailTemplateChanged, this.emailTemplateChangedCallback);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.resetItemSelection, this.resetFocusCallback);
        };
        SelectedAreaDecorator.prototype.cleanup = function (content) {
            var areaMarker = content.find("." + Editor.CommonConstants.decoratedAreaMarkerCssClass);
            var decoratedElement = areaMarker.children().first();
            if (!Utility.isNullOrUndefined(decoratedElement)) {
                decoratedElement.unwrap();
            }
            var areaHeader = content.find("." + Editor.CommonConstants.decoratedAreaHeaderCssClass);
            if (!Utility.isNullOrUndefined(areaHeader)) {
                areaHeader.unwrap();
                areaHeader.remove();
            }
        };
        SelectedAreaDecorator.prototype.getContextualButtons = function (selectedBlockType, position) {
            var _this = this;
            if (selectedBlockType === Editor.BlockConstants.SelectableType.subBlock ||
                selectedBlockType === Editor.BlockConstants.SelectableType.none) {
                return [];
            }
            return this.flagButtons
                .map(function (button) {
                if (!Utility.isNullOrUndefined(position) && position !== button.position()) {
                    return null;
                }
                try {
                    var context = _this.createButtonContext(selectedBlockType);
                    if (button.shouldRender(context)) {
                        return button.render(context);
                    }
                }
                catch (e) {
                }
                return null;
            })
                .filter(function (button) { return !Utility.isNullOrUndefined(button); });
        };
        SelectedAreaDecorator.prototype.createButtonContext = function (type) {
            var _this = this;
            return {
                selectedBlock: this.currentDecorated && this.currentDecorated[0],
                selectedBlockType: type,
                selectBlock: function (block) {
                    return _this.eventBroker.notify(Editor.DesignerInternalEventConstants.itemFocused, new Editor.ItemFocusedEventArgs(block, true));
                }
            };
        };
        return SelectedAreaDecorator;
    }());
    Editor.SelectedAreaDecorator = SelectedAreaDecorator;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var VideoSelectionChangedEventArgs = /** @class */ (function (_super) {
        __extends(VideoSelectionChangedEventArgs, _super);
        function VideoSelectionChangedEventArgs(element, videoId, videoName, videoUrl, videoThumbnailUrl, videoEmbedCode) {
            var _this = _super.call(this) || this;
            _this.element = element;
            _this.videoId = videoId;
            _this.videoName = videoName;
            _this.videoUrl = videoUrl;
            _this.videoThumbnailUrl = videoThumbnailUrl;
            _this.videoEmbedCode = videoEmbedCode;
            return _this;
        }
        return VideoSelectionChangedEventArgs;
    }(Editor.EventArgs));
    Editor.VideoSelectionChangedEventArgs = VideoSelectionChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
var Editor;
(function (Editor) {
    var AriaRoleConstants;
    (function (AriaRoleConstants) {
        AriaRoleConstants.listbox = "listbox";
        AriaRoleConstants.option = "option";
        AriaRoleConstants.document = "document";
        AriaRoleConstants.presentation = "presentation";
        AriaRoleConstants.textbox = "textbox";
    })(AriaRoleConstants = Editor.AriaRoleConstants || (Editor.AriaRoleConstants = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Manager for knowing which was the las selected element of a component, in order to be able to select it back
     */
    var FocusManager = /** @class */ (function () {
        function FocusManager(eventBroker, elementFocusedInEvConstant, elementToFocusEvConstant) {
            this.eventBroker = eventBroker;
            this.elementFocusedInEvConstant = elementFocusedInEvConstant;
            this.elementToFocusEvConstant = elementToFocusEvConstant;
        }
        FocusManager.prototype.init = function () {
            var _this = this;
            this.eventBroker.subscribe(this.elementFocusedInEvConstant, (this.onSetLastFocusedElement = function (eventArgs) {
                return _this.setLastFocusedElement(eventArgs.element);
            }));
            this.eventBroker.subscribe(this.elementToFocusEvConstant, (this.onFocusLastElement = function () { return _this.focusLastElement(); }));
        };
        FocusManager.prototype.dispose = function () {
            this.eventBroker.unsubscribe(this.elementFocusedInEvConstant, this.onSetLastFocusedElement);
            this.eventBroker.unsubscribe(this.elementToFocusEvConstant, this.onFocusLastElement);
            this.lastFocusedElement = null;
        };
        FocusManager.prototype.setLastFocusedElement = function (element) {
            this.lastFocusedElement = element;
        };
        FocusManager.prototype.focusLastElement = function () {
            if (!Utility.isNullOrUndefined(this.lastFocusedElement)) {
                this.lastFocusedElement.focus();
            }
        };
        return FocusManager;
    }());
    Editor.FocusManager = FocusManager;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var FocusManagerFactory = /** @class */ (function () {
        function FocusManagerFactory() {
        }
        FocusManagerFactory.prototype.create = function (eventBroker, elementFocusedInEvConstant, elementToFocusEvConstant) {
            return new Editor.FocusManager(eventBroker, elementFocusedInEvConstant, elementToFocusEvConstant);
        };
        return FocusManagerFactory;
    }());
    Editor.FocusManagerFactory = FocusManagerFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    /**
     * The keyboard accessibility manager class
     */
    var KeyboardAccessibilityManager = /** @class */ (function () {
        function KeyboardAccessibilityManager() {
            var _this = this;
            this.onContainerRenderedHandler = function (containerRenderedEventArgs) {
                _this.listContainer = containerRenderedEventArgs.element;
                _this.itemsList = _this.accessibleContainer.getAllAccessibleItems();
                _this.listContainer.off("keydown.baseAccessibleList");
                _this.listContainer.on("keydown.baseAccessibleList", function (event) {
                    return _this.handlerInnerContainerKeyDown(event);
                });
            };
            this.onItemRenderedHandler = function (itemRenderedEventArgs) {
                var itemControl = itemRenderedEventArgs.element;
                var itemInnerContainer = itemControl.getJQueryElement();
                itemInnerContainer.off("keydown.baseAccessibleList");
                itemInnerContainer.on("keydown.baseAccessibleList", function (event) {
                    return _this.handlerItemControlKeyDown(event, itemControl);
                });
            };
        }
        /**
         * Initializes the accessible list control
         */
        KeyboardAccessibilityManager.prototype.initialize = function (accessibleContainer) {
            this.accessibleContainer = accessibleContainer;
        };
        /**
         * Disposes the object.
         */
        KeyboardAccessibilityManager.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.itemsList)) {
                this.itemsList.forEach(function (item) {
                    item.getJQueryElement().off("keydown.baseAccessibleList");
                });
            }
            if (!Utility.isNullOrUndefined(this.listContainer)) {
                this.listContainer.off("keydown.baseAccessibleList");
            }
            this.accessibleContainer = null;
            this.itemsList = null;
            this.listContainer = null;
        };
        /**
         * Handles keyDown when inner container is focused.
         * @param e Event Object
         */
        KeyboardAccessibilityManager.prototype.handlerInnerContainerKeyDown = function (e) {
            if (e.keyCode !== KeyCodes.Left &&
                e.keyCode !== KeyCodes.Up &&
                e.keyCode !== KeyCodes.Right &&
                e.keyCode !== KeyCodes.Down) {
                return;
            }
            if (e.altKey || e.shiftKey || e.ctrlKey || this.itemsList.length === 0) {
                return;
            }
            // Prevents scrolling when user navigates between tools with arrow keys
            e.preventDefault();
            // Bubbled events from accessible items and their children elements should be ignored, because they are processed by handlerItemControlKeyDown
            var targetAndParents = $(e.target)
                .parents()
                .addBack();
            if (this.itemsList.some(function (accessibleItem) { return accessibleItem.getJQueryElement().is(targetAndParents); })) {
                return;
            }
            var selectedItem = this.accessibleContainer.getSelectedAccesibleItem();
            if (!Utility.isNullOrUndefined(selectedItem)) {
                this.handlerItemControlKeyDown(e, selectedItem);
                return;
            }
            var nextItemIndex = 0;
            switch (e.keyCode // tslint:disable-line
            ) {
                case KeyCodes.Right:
                case KeyCodes.Down:
                    nextItemIndex = 0;
                    break;
                case KeyCodes.Left:
                case KeyCodes.Up:
                    nextItemIndex = this.itemsList.length - 1;
                    break;
            }
            var item = this.itemsList[nextItemIndex];
            item.focus();
        };
        /**
         * Handles keyDown when one of the items is focused.
         * @param e Event object
         * @param listItem The item
         */
        KeyboardAccessibilityManager.prototype.handlerItemControlKeyDown = function (e, item) {
            if (e.keyCode !== KeyCodes.Enter &&
                e.keyCode !== KeyCodes.Space &&
                e.keyCode !== KeyCodes.Left &&
                e.keyCode !== KeyCodes.Up &&
                e.keyCode !== KeyCodes.Right &&
                e.keyCode !== KeyCodes.Down) {
                return;
            }
            if (e.altKey || e.shiftKey || e.ctrlKey || !this.itemsList.length) {
                return;
            }
            var itemIndex = -1;
            // is not certain the objects implementing IAccessibleItem are equally reference-wise, so the comparision is made against the JQuery elements.
            this.itemsList.some(function (itemList, index) {
                if (item.getJQueryElement() === itemList.getJQueryElement()) {
                    itemIndex = index;
                    return true;
                }
            });
            var nextIndex = 0;
            switch (e.keyCode // tslint:disable-line
            ) {
                case KeyCodes.Space:
                case KeyCodes.Enter:
                    this.itemsList[itemIndex].click();
                    break;
                case KeyCodes.Right:
                    nextIndex = itemIndex + 1;
                    if (nextIndex >= this.itemsList.length) {
                        nextIndex = 0;
                    }
                    this.itemsList[nextIndex].focus();
                    break;
                case KeyCodes.Left:
                    nextIndex = itemIndex - 1;
                    if (nextIndex < 0) {
                        nextIndex = this.itemsList.length - 1;
                    }
                    this.itemsList[nextIndex].focus();
                    break;
                case KeyCodes.Up:
                case KeyCodes.Down:
                    var itemRow_1 = 0;
                    var itemIndexInRow_1 = 0;
                    // grid for all items' indexes in each row
                    var itemsIndexGrid_1 = [];
                    itemsIndexGrid_1.push([]);
                    var currentIndex_1 = 0;
                    var currentIndexInRow_1 = 0;
                    var previousRowTop_1 = this.itemsList[0].getJQueryElement().position().top;
                    // prettier-ignore
                    this.itemsList.forEach(function (item) {
                        var currentRowTop = item.getJQueryElement().position().top;
                        if (currentRowTop - previousRowTop_1 > 1) {
                            previousRowTop_1 = currentRowTop;
                            currentIndexInRow_1 = 0;
                            itemsIndexGrid_1.push([]);
                        }
                        var currentRow = itemsIndexGrid_1.length - 1;
                        itemsIndexGrid_1[currentRow].push(currentIndex_1);
                        if (itemIndex === currentIndex_1) {
                            itemRow_1 = currentRow;
                            itemIndexInRow_1 = currentIndexInRow_1;
                        }
                        currentIndexInRow_1++;
                        currentIndex_1++;
                    });
                    if (this.itemsList.length === itemsIndexGrid_1[0].length) {
                        break;
                    }
                    var firstRow = 0;
                    var lastRow = itemsIndexGrid_1.length - 1;
                    // prettier-ignore
                    var nextRow = e.keyCode === KeyCodes.Up ?
                        (itemRow_1 > 0 ? itemRow_1 - 1 : lastRow) :
                        (itemRow_1 < itemsIndexGrid_1.length - 1 ? itemRow_1 + 1 : firstRow);
                    var lastIndexInRow = itemsIndexGrid_1[nextRow][itemsIndexGrid_1[nextRow].length - 1];
                    nextIndex =
                        itemsIndexGrid_1[nextRow].length > itemIndexInRow_1
                            ? itemsIndexGrid_1[nextRow][itemIndexInRow_1]
                            : lastIndexInRow;
                    this.itemsList[nextIndex].focus();
                    break;
            }
        };
        /**
         * Make the element focusable, by setting tabindex attribute to element.
         * @param element The JQuery element
         * @param index The value of the tabindex. Default 0.
         */
        KeyboardAccessibilityManager.prototype.SetTabIndex = function (element, tabIndexValue) {
            Editor.CommonUtils.setTabIndex(element, tabIndexValue === undefined ? 0 : tabIndexValue);
        };
        return KeyboardAccessibilityManager;
    }());
    Editor.KeyboardAccessibilityManager = KeyboardAccessibilityManager;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
var Editor;
(function (Editor) {
    /**
     * The implementation of accessible item interface
     */
    var ToolboxAccessibleItem = /** @class */ (function () {
        function ToolboxAccessibleItem(itemInnerContainer, onClickHandler) {
            this.itemInnerContainer = itemInnerContainer;
            this.onClickHandler = onClickHandler;
        }
        /**
         * Focus item
         */
        ToolboxAccessibleItem.prototype.focus = function () {
            this.itemInnerContainer.focus();
        };
        /**
         * Gets the JQuery element.
         */
        ToolboxAccessibleItem.prototype.getJQueryElement = function () {
            return this.itemInnerContainer;
        };
        /**
         * Click item
         */
        ToolboxAccessibleItem.prototype.click = function () {
            this.onClickHandler();
        };
        return ToolboxAccessibleItem;
    }());
    Editor.ToolboxAccessibleItem = ToolboxAccessibleItem;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var AddTextBreakContentModelProcessor = /** @class */ (function () {
        function AddTextBreakContentModelProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        AddTextBreakContentModelProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            Editor.BlockProvider.getBlocksOfType(contents, Editor.TextBlock.type)
                .find("p:empty")
                .append("<br>");
        };
        /**
         * Returns the name of the content model processor.
         */
        AddTextBreakContentModelProcessor.prototype.getName = function () {
            return "AddTextBreakContentModelProcessor";
        };
        /**
         * Dispose.
         */
        AddTextBreakContentModelProcessor.prototype.dispose = function () { };
        return AddTextBreakContentModelProcessor;
    }());
    Editor.AddTextBreakContentModelProcessor = AddTextBreakContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    /**
     * Provide the method that adds enable
     * stop event propagation logic to inputs.
     */
    var IgnoreChangesWhileInputStrategy = /** @class */ (function () {
        function IgnoreChangesWhileInputStrategy() {
            /**
             * Adds stop event propagation logic to input.
             * @param inputElement input jquery element.
             */
            this.addStopEventPropogationWhileInput = function (eventBroker, inputElement) {
                inputElement.focusin(function (event) {
                    eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationStart, new Editor.EventArgs(Editor.CommonConstants.userDetailsViewSimpleInput));
                });
                inputElement.focusout(function (event) {
                    eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationEnd, new Editor.EventArgs(Editor.CommonConstants.userDetailsViewSimpleInput));
                });
            };
        }
        return IgnoreChangesWhileInputStrategy;
    }());
    Editor.IgnoreChangesWhileInputStrategy = IgnoreChangesWhileInputStrategy;
})(Editor || (Editor = {}));
/**
* @license Copyright (c) Microsoft Corporation. All rights reserved.
*/
var Editor;
(function (Editor) {
    'use strict';
    /*
    Gets the localized string
    */
    var OfflineMessages = /** @class */ (function () {
        function OfflineMessages() {
        }
        OfflineMessages.getLocalizedString = function (key, localeId) {
            var localLocaleId = (localeId in OfflineMessages.localeMapping) ? localeId : "1033";
            if (!(key in OfflineMessages.localeMapping[localLocaleId])) {
                return key;
            }
            return OfflineMessages.localeMapping[localLocaleId][key];
        };
        OfflineMessages.messages1025 = {
            "[OfflineErrorMessage]": "???? ??????? ??? ????? ??? ???????. ?????? ???????? ??? ???? ????? ???? ?????????.",
            "[OfflineWarningMessage]": "??? ??????? ??? ?????? ????? ????? ??? ?????. ?????? ???????? ??? ???? ????? ???? ?????????."
        };
        OfflineMessages.messages1026 = {
            "[OfflineErrorMessage]": "?????????? ?? ?????????? ?? ? ????????, ?????? ??? ??????. ???????? ??????, ?????? ??? ????????.",
            "[OfflineWarningMessage]": "????? ??????? ?? ?? ???????? ??????. ???????? ??????, ?????? ?? ????????."
        };
        OfflineMessages.messages1027 = {
            "[OfflineErrorMessage]": "El dissenyador de contingut no est disponible fora de lnia. Torneu-ho a provar quan tingueu connexi.",
            "[OfflineWarningMessage]": "Algunes caracterstiques no estan disponibles fora de lnia. Torneu-ho a provar quan tingueu connexi."
        };
        OfflineMessages.messages1028 = {
            "[OfflineErrorMessage]": "??????????????????????",
            "[OfflineWarningMessage]": "??????????????????????"
        };
        OfflineMessages.messages1029 = {
            "[OfflineErrorMessage]": "Nvrhr obsahu nen v offline reimu dostupn. Zkuste to prosm znovu, a budete pripojeni.",
            "[OfflineWarningMessage]": "Nekter funkce nejsou v offline reimu dostupn. Zkuste to prosm znovu, a budete pripojeni."
        };
        OfflineMessages.messages1030 = {
            "[OfflineErrorMessage]": "Indholdsdesigneren kan ikke bruges offline. Prv igen, nr du atter er online.",
            "[OfflineWarningMessage]": "Nogle funktioner er ikke tilgngelige, nr du er offline. Prv igen, nr du er online."
        };
        OfflineMessages.messages1031 = {
            "[OfflineErrorMessage]": "Der Inhaltsdesigner ist offline nicht verfgbar. Wiederholen Sie den Vorgang, wenn eine Onlineverbindung besteht.",
            "[OfflineWarningMessage]": "Einige Funktionen sind offline nicht verfgbar. Versuchen Sie es noch einmal, wenn eine Verbindung besteht."
        };
        OfflineMessages.messages1032 = {
            "[OfflineErrorMessage]": "? s?ed?as? pe??e?????? de? e??a? d?a??s?? ????? s??des?. ?????ste ?a??, ?ta? e?ste s??dede????.",
            "[OfflineWarningMessage]": "???s??e? d??at?t?te? de? e??a? d?a??s?e? e?t?? s??des??. ???spa??ste ?a?? ?ta? s??de?e?te."
        };
        OfflineMessages.messages1033 = {
            "[OfflineErrorMessage]": "The content designer isn't available offline. Please try again when you're connected.",
            "[OfflineWarningMessage]": "Some features aren't available offline. Please try again when you're connected."
        };
        OfflineMessages.messages1035 = {
            "[OfflineErrorMessage]": "Sislln suunnitteluohjelma ei ole kytettviss offline-tilassa. Yrit uudelleen, kun yhteys on muodostettu.",
            "[OfflineWarningMessage]": "Joitakin ominaisuuksia ei voi kytt offline-tilassa. Yrit uudelleen, kun yhteys on muodostettu."
        };
        OfflineMessages.messages1036 = {
            "[OfflineErrorMessage]": "Le concepteur de contenu nest pas disponible hors connexion. Ressayez lorsque vous serez connect.",
            "[OfflineWarningMessage]": "Certaines fonctionnalits ne sont pas disponibles hors ligne. Ressayez lorsque vous serez connect."
        };
        OfflineMessages.messages1037 = {
            "[OfflineErrorMessage]": "?????? ????? ???? ???? ????? ???? ?? ?????. ??? ??? ?????? ?????.?",
            "[OfflineWarningMessage]": "?????? ??????? ???? ?????? ????? ???? ?? ?????. ??? ??? ?????? ?????."
        };
        OfflineMessages.messages1038 = {
            "[OfflineErrorMessage]": "A tartalomtervezo nem rheto el kapcsolat nlkli mdban. Prblja meg jra, miutn csatlakozott.",
            "[OfflineWarningMessage]": "Egyes szolgltatsok nem rhetok el kapcsolat nlkli mdban. Prblja meg jra, miutn csatlakozott!"
        };
        OfflineMessages.messages1040 = {
            "[OfflineErrorMessage]": "La finestra di progettazione del contenuto non  disponibile in modalit offline. Riprova quando sei connesso.",
            "[OfflineWarningMessage]": "Alcune funzionalit non sono disponibili in modalit offline. Riprova quando sei connesso."
        };
        OfflineMessages.messages1041 = {
            "[OfflineErrorMessage]": "????? ???????????????????????????????????????",
            "[OfflineWarningMessage]": "????????????????????????????????????????????"
        };
        OfflineMessages.messages1042 = {
            "[OfflineErrorMessage]": "???? ????? ??? ????? ??? ? ????. ???? ?? ??????.",
            "[OfflineWarningMessage]": "?? ??? ???? ????? ??? ? ????. ???? ?? ??????."
        };
        OfflineMessages.messages1043 = {
            "[OfflineErrorMessage]": "De functie voor contentontwerp is niet offline beschikbaar. Probeer het opnieuw als u bent verbonden.",
            "[OfflineWarningMessage]": "Sommige functies zijn niet offline beschikbaar. Probeer het opnieuw als u verbonden bent."
        };
        OfflineMessages.messages1044 = {
            "[OfflineErrorMessage]": "Innholdsutforming er ikke tilgjengelig i frakoblet modus. Prv p nytt nr du er tilkoblet.",
            "[OfflineWarningMessage]": "Noen funksjoner er ikke tilgjengelige i frakoblet modus. Prv p nytt nr du er tilkoblet."
        };
        OfflineMessages.messages1045 = {
            "[OfflineErrorMessage]": "Projektant zawartosci jest niedostepny w trybie offline. Sprbuj ponownie, gdy nawiazesz polaczenie.",
            "[OfflineWarningMessage]": "Niektre funkcje sa niedostepne w trybie offline. Sprbuj ponownie, gdy nawiazesz polaczenie."
        };
        OfflineMessages.messages1046 = {
            "[OfflineErrorMessage]": "O designer de contedo no est disponvel offline. Tente novamente quando voc estiver conectado.",
            "[OfflineWarningMessage]": "Alguns recursos do designer no esto disponveis offline. Tente novamente quando estiver conectado."
        };
        OfflineMessages.messages1048 = {
            "[OfflineErrorMessage]": "Proiectantul de con?inut nu este disponibil offline. ncerca?i din nou cnd sunte?i conectat.",
            "[OfflineWarningMessage]": "Unele caracteristici nu sunt disponibile offline. ncerca?i din nou cnd sunte?i conectat."
        };
        OfflineMessages.messages1049 = {
            "[OfflineErrorMessage]": "??????????? ??????????? ?????????? ? ?????????? ??????. ????????? ??????? ??? ??????? ???????????.",
            "[OfflineWarningMessage]": "????????? ??????? ?????????? ??? ?????? ? ?????????? ??????. ????????? ??????? ??? ??????? ???????????."
        };
        OfflineMessages.messages1050 = {
            "[OfflineErrorMessage]": "Dizajner sadraja nije dostupan izvan mree. Ponovno se poveite pa pokuajte ponovno.",
            "[OfflineWarningMessage]": "Neke znacajke nisu dostupne izvan mree. Ponovno se poveite pa pokuajte ponovno."
        };
        OfflineMessages.messages1051 = {
            "[OfflineErrorMessage]": "Nvrhr obsahu nie je vreime offline kdispozcii. Skste to znova po pripojen.",
            "[OfflineWarningMessage]": "Niektor funkcie nie s vreime offline kdispozcii. Skste toznova popripojen."
        };
        OfflineMessages.messages1053 = {
            "[OfflineErrorMessage]": "Innehllsverktyget r inte tillgngligt offline. Frsk igen nr du r ansluten.",
            "[OfflineWarningMessage]": "En del funktioner r inte tillgngliga offline. Frsk igen nr du r ansluten."
        };
        OfflineMessages.messages1054 = {
            "[OfflineErrorMessage]": "?????????????????????????????????????? ????????????????????????????????",
            "[OfflineWarningMessage]": "??????????????????????????????????????? ????????????????????????????????"
        };
        OfflineMessages.messages1055 = {
            "[OfflineErrorMessage]": "Ierik tasarimcisi evrimdisi kullanilamaz. Ltfen baglandiginizda yeniden deneyin.",
            "[OfflineWarningMessage]": "Bazi zellikler evrimdisi olarak kullanilamaz. Ltfen baglandiginizda yeniden deneyin."
        };
        OfflineMessages.messages1057 = {
            "[OfflineErrorMessage]": "Desainer konten tidak tersedia offline. Coba lagi setelah Anda tersambung.",
            "[OfflineWarningMessage]": "Fitur tertentu tidak tersedia secara offline. Coba lagi setelah Anda tersambung."
        };
        OfflineMessages.messages1058 = {
            "[OfflineErrorMessage]": "??????????? ?????? ??????????? ? ??????????? ??????. ???????????? ?? ????????? ?? ????????? ??????.",
            "[OfflineWarningMessage]": "????? ??????? ?????????? ? ??????????? ??????. ???????????? ?? ????????? ?? ????????? ??????."
        };
        OfflineMessages.messages1060 = {
            "[OfflineErrorMessage]": "Oblikovalnik vsebine ni na voljo brez povezave. Poskusite znova, ko vzpostavite povezavo.",
            "[OfflineWarningMessage]": "Nekatere funkcije niso na voljo brez povezave. Poskusite znova, ko vzpostavite povezavo."
        };
        OfflineMessages.messages1061 = {
            "[OfflineErrorMessage]": "Sisudisainerit ei saa henduseta kasutada. Proovige uuesti, kui olete hendatud.",
            "[OfflineWarningMessage]": "Mni funktsioon pole henduseta kttesaadav. Proovige uuesti, kui olete hendatud."
        };
        OfflineMessages.messages1062 = {
            "[OfflineErrorMessage]": "Satura noformetajs nav pieejams bezsaiste. Ludzu, meginiet velreiz, kad bus izveidots savienojums.",
            "[OfflineWarningMessage]": "Dai lidzekli nav pieejami bezsaiste. Meginiet velreiz pec savienojuma izveides."
        };
        OfflineMessages.messages1063 = {
            "[OfflineErrorMessage]": "Neprisijunge negalesite naudoti turinio dizaino irankio. Bandykite dar karta, kai busite prisijunge.",
            "[OfflineWarningMessage]": "Neprisijunge negalesite naudoti kai kuriu funkciju. Bandykite dar karta, kai busite prisijunge."
        };
        OfflineMessages.messages1066 = {
            "[OfflineErrorMessage]": "Khng th? s? d?ng cng c? thi?t k? n?i dung ? ch? d? ngo?i tuy?n. Vui lng th? l?i khi b?n d k?t n?i.",
            "[OfflineWarningMessage]": "Khng th? s? d?ng m?t s? tnh nang ? ch? d? ngo?i tuy?n. Vui lng th? l?i khi b?n d k?t n?i."
        };
        OfflineMessages.messages1069 = {
            "[OfflineErrorMessage]": "Eduki diseinatzailea ez dago erabilgarri lineaz kanpo bazaude. Saiatu berriro Interneteko konexioa duzunean.",
            "[OfflineWarningMessage]": "Zenbait eginbide ez daude erabilgarri lineaz kanpo zaudenean. Saiatu berriro Internetera konektatuta zaudenean."
        };
        OfflineMessages.messages1081 = {
            "[OfflineErrorMessage]": "??????? ???????? ??????? ?????? ???? ??. ????? ?????? ???? ?? ???? ?????? ????.",
            "[OfflineWarningMessage]": "??? ???????? ??????? ?????? ???? ???. ????? ?????? ???? ?? ???? ?????? ????."
        };
        OfflineMessages.messages1086 = {
            "[OfflineErrorMessage]": "Pereka kandungan tidak tersedia secara luar talian. Sila cuba lagi apabila anda kembali dalam talian.",
            "[OfflineWarningMessage]": "Beberapa ciri tidak akan tersedia sewaktu anda bekerja di luar talian. Sila cuba lagi apabila anda kembali dalam talian."
        };
        OfflineMessages.messages1087 = {
            "[OfflineErrorMessage]": "?????? ??????????? ?????? ??????? ?????????? ????. ?????? ???????? ????????? ???????? ??????????.",
            "[OfflineWarningMessage]": "?????? ???????????? ?????? ??????? ?????????? ????. ?????? ???????? ????????? ???????? ??????????."
        };
        OfflineMessages.messages1110 = {
            "[OfflineErrorMessage]": "O deseador de contidos non est dispoible sen conexin. Tnteo de novo cando se conecte.",
            "[OfflineWarningMessage]": "Algunhas funcionalidades non estn dispoibles sen conexin. Tnteo de novo cando se conecte."
        };
        OfflineMessages.messages2052 = {
            "[OfflineErrorMessage]": "???????????????????????",
            "[OfflineWarningMessage]": "??????????????????????"
        };
        OfflineMessages.messages2057 = {
            "[OfflineErrorMessage]": "The content designer isn't available offline. Please try again when you're connected.",
            "[OfflineWarningMessage]": "Some features aren't available offline. Please try again when you're connected."
        };
        OfflineMessages.messages2070 = {
            "[OfflineErrorMessage]": "O estruturador de contedos no est disponvel offline. Tente novamente quando estiver ligado.",
            "[OfflineWarningMessage]": "Algumas funcionalidades no esto disponveis offline. Tente novamente quando estiver ligado."
        };
        OfflineMessages.messages2074 = {
            "[OfflineErrorMessage]": "Dizajner sadraja nije dostupan van mree. Pokuajte ponovo kad se poveete.",
            "[OfflineWarningMessage]": "Neke funkcije nisu dostupne van mree. Pokuajte ponovo kad se poveete."
        };
        OfflineMessages.messages3076 = {
            "[OfflineErrorMessage]": "??????????????????????",
            "[OfflineWarningMessage]": "??????????????????????"
        };
        OfflineMessages.messages3081 = {
            "[OfflineErrorMessage]": "The content designer isn't available offline. Please try again when you're connected.",
            "[OfflineWarningMessage]": "Some features aren't available offline. Please try again when you're connected."
        };
        OfflineMessages.messages3082 = {
            "[OfflineErrorMessage]": "El diseador de contenido no est disponible sin conexin. Vuelva a intentarlo cuando est conectado.",
            "[OfflineWarningMessage]": "Algunas caractersticas no estn disponibles sin conexin. Vuelva a intentarlo cuando est conectado."
        };
        OfflineMessages.messages3084 = {
            "[OfflineErrorMessage]": "Le concepteur de contenu nest pas disponible hors connexion. Ressayez lorsque vous serez connect.",
            "[OfflineWarningMessage]": "Certaines fonctionnalits ne sont pas disponibles hors ligne. Ressayez lorsque vous serez connect."
        };
        OfflineMessages.messages3098 = {
            "[OfflineErrorMessage]": "???????? ???????? ???? ???????? ??? ?????. ????????? ?????? ??? ?? ????????.",
            "[OfflineWarningMessage]": "???? ???????? ???? ???????? ??? ?????. ????????? ?????? ??? ?? ????????."
        };
        OfflineMessages.messages4105 = {
            "[OfflineErrorMessage]": "The content designer isn't available offline. Please try again when you're connected.",
            "[OfflineWarningMessage]": "Some features aren't available offline. Please try again when you're connected."
        };
        OfflineMessages.localeMapping = {
            "1025": OfflineMessages.messages1025,
            "1026": OfflineMessages.messages1026,
            "1027": OfflineMessages.messages1027,
            "1028": OfflineMessages.messages1028,
            "1029": OfflineMessages.messages1029,
            "1030": OfflineMessages.messages1030,
            "1031": OfflineMessages.messages1031,
            "1032": OfflineMessages.messages1032,
            "1033": OfflineMessages.messages1033,
            "1035": OfflineMessages.messages1035,
            "1036": OfflineMessages.messages1036,
            "1037": OfflineMessages.messages1037,
            "1038": OfflineMessages.messages1038,
            "1040": OfflineMessages.messages1040,
            "1041": OfflineMessages.messages1041,
            "1042": OfflineMessages.messages1042,
            "1043": OfflineMessages.messages1043,
            "1044": OfflineMessages.messages1044,
            "1045": OfflineMessages.messages1045,
            "1046": OfflineMessages.messages1046,
            "1048": OfflineMessages.messages1048,
            "1049": OfflineMessages.messages1049,
            "1050": OfflineMessages.messages1050,
            "1051": OfflineMessages.messages1051,
            "1053": OfflineMessages.messages1053,
            "1054": OfflineMessages.messages1054,
            "1055": OfflineMessages.messages1055,
            "1057": OfflineMessages.messages1057,
            "1058": OfflineMessages.messages1058,
            "1060": OfflineMessages.messages1060,
            "1061": OfflineMessages.messages1061,
            "1062": OfflineMessages.messages1062,
            "1063": OfflineMessages.messages1063,
            "1066": OfflineMessages.messages1066,
            "1069": OfflineMessages.messages1069,
            "1081": OfflineMessages.messages1081,
            "1086": OfflineMessages.messages1086,
            "1087": OfflineMessages.messages1087,
            "1110": OfflineMessages.messages1110,
            "2052": OfflineMessages.messages2052,
            "2057": OfflineMessages.messages2057,
            "2070": OfflineMessages.messages2070,
            "2074": OfflineMessages.messages2074,
            "3076": OfflineMessages.messages3076,
            "3081": OfflineMessages.messages3081,
            "3082": OfflineMessages.messages3082,
            "3084": OfflineMessages.messages3084,
            "3098": OfflineMessages.messages3098,
            "4105": OfflineMessages.messages4105,
        };
        return OfflineMessages;
    }());
    Editor.OfflineMessages = OfflineMessages;
})(Editor || (Editor = {}));
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Renders the link popup
     */
    var LinkPopupRenderer = /** @class */ (function () {
        function LinkPopupRenderer(popupRenderer, detailsViewControl) {
            this.assistEditEnterKeyDown = "assistEditEnterKeyDown";
            this.popupRenderer = popupRenderer;
            this.detailsViewControl = detailsViewControl;
        }
        LinkPopupRenderer.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
            this.popupRenderer.setup(this.eventBroker);
        };
        /**
         * Renders the link popup.
         * @param linkData The data for the current link element.
         * @param wrappedBlock The on ok click callback.
         * @param cleanBlock The on cancel click callback.
         */
        LinkPopupRenderer.prototype.render = function (linkData, onOkClick, onCancelClick) {
            var _this = this;
            var onLinkPopupCancelClick = function () {
                _this.dispose();
                onCancelClick();
            };
            var onOkClickHandler = function () {
                _this.dispose();
                if (!MktSvc.Controls.Common.String.isNullUndefinedOrWhitespace(linkData.href)) {
                    onOkClick(linkData);
                }
                else {
                    onCancelClick();
                }
                return true;
            };
            var containerId = this.popupRenderer.render(Editor.CommonUtils.getLocalizedString("[Link]"), onOkClickHandler, onLinkPopupCancelClick, true);
            this.detailsViewControl.init(containerId, this.eventBroker);
            var section = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString("[" + Editor.DetailsViewConstants.linkSectionTitle + "]"));
            var linkField = this.detailsViewControl.createLinkField(section, Editor.CommonUtils.getLocalizedString("[Link]"), MktSvc.Controls.Common.String.Empty, MktSvc.Controls.Common.String.Empty, linkData.href, {
                // prettier-ignore
                "for": LinkPopupRenderer.urlInputId,
                // prettier-ignore
                "id": LinkPopupRenderer.urlInputId,
                "placeholder-text": Editor.CommonUtils.getLocalizedString("[Link]")
            }, function (inputElem) {
                linkData.href = Editor.CommonUtils.getLinkWithProtocol(inputElem.val());
            }, { hasFocus: true });
            // Use timeout to set focus on IOS
            setTimeout(function () {
                linkField.find("input").focus();
            }, 0);
            this.setupSaveOnEnter(onOkClickHandler);
            this.eventBroker.notify("linkPopupRendered");
        };
        LinkPopupRenderer.prototype.setupSaveOnEnter = function (onOkClickHandler) {
            var _this = this;
            var onAssistEditEnterKeyDownHandler = function () {
                onOkClickHandler();
                _this.popupRenderer.close();
            };
            this.enterKeyDownDelegate = this.eventBroker.subscribe(this.assistEditEnterKeyDown, onAssistEditEnterKeyDownHandler);
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        LinkPopupRenderer.prototype.dispose = function () {
            this.eventBroker.unsubscribe(this.assistEditEnterKeyDown, this.enterKeyDownDelegate);
            this.detailsViewControl.dispose();
            this.popupRenderer.dispose();
        };
        LinkPopupRenderer.urlInputId = "formEditor_linkpopup_urlInput";
        return LinkPopupRenderer;
    }());
    Editor.LinkPopupRenderer = LinkPopupRenderer;
})(Editor || (Editor = {}));
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    /**
     * Renders the image popup
     */
    var ImagePopupRenderer = /** @class */ (function () {
        function ImagePopupRenderer(popupRenderer, detailsViewControl) {
            this.minDimension = 0;
            this.maxDimension = 10000;
            this.popupRenderer = popupRenderer;
            this.detailsViewControl = detailsViewControl;
        }
        ImagePopupRenderer.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
            this.popupRenderer.setup(this.eventBroker);
        };
        /**
         * Renders the image popup.
         * @param imageData The data for the current image element.
         * @param wrappedBlock The on ok click callback.
         * @param cleanBlock The on cancel click callback.
         */
        ImagePopupRenderer.prototype.render = function (imageData, onOkClick, onCancelClick) {
            var _this = this;
            var windowHeight = $(window).height();
            var dialogHeight = windowHeight < 850 ? 300 : null;
            var headerAndButtonPartHeight = 150;
            var dialogTop = windowHeight < 850 ? Math.max((windowHeight - 300 - headerAndButtonPartHeight) / 2, 0) : null;
            var containerId = this.popupRenderer.render(Editor.CommonUtils.getLocalizedString("[Image]"), function () {
                imageData.src = Utility.isNullOrUndefined(imageData.src) ? String.Empty : imageData.src;
                imageData.alt = Utility.isNullOrUndefined(imageData.alt) ? String.Empty : imageData.alt;
                imageData.alignment = String.isNullUndefinedOrWhitespace(imageData.alignment)
                    ? "Left"
                    : imageData.alignment;
                onOkClick(imageData);
                return true;
            }, function () {
                onCancelClick();
            }, true, null, null, dialogHeight + "px", dialogTop + "px");
            Editor.CommonUtils.getById(containerId).empty();
            this.detailsViewControl.init(containerId, this.eventBroker);
            var mainSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString("[" + Editor.DetailsViewConstants.imageSectionTitle + "]"));
            var sourceField = this.detailsViewControl.createImageField(mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.srcLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.srcInputCssClass, imageData.src, {
                "placeholder-text": Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.srcLabel)
            }, function (inputElem) {
                imageData.src = inputElem.val();
            }, { hasFocus: false, no_assistedit: true });
            this.detailsViewControl.createInputField(mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.altLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.altInputCssClass, imageData.alt, {
                placeholder: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.altLabel)
            }, function (inputElem) {
                imageData.alt = inputElem.val();
            });
            this.detailsViewControl.createInputField(mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.buttonWidthLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.imageWidthInputCssClass, parseInt(imageData.width, 10).toString(), {
                placeholder: Editor.DetailsViewConstants.placeHolderAuto,
                min: this.minDimension,
                max: this.maxDimension,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers
            }, function (inputElem) {
                imageData.width = _this.getValueWithMeasurementUnit(inputElem.val());
            }, Editor.InputValidationsConstants.positiveIntAllowEmpty);
            this.detailsViewControl.createInputField(mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.buttonHeightLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.imageHeightInputCssClass, parseInt(imageData.height, 10).toString(), {
                placeholder: Editor.DetailsViewConstants.placeHolderAuto,
                min: this.minDimension,
                max: this.maxDimension,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers
            }, function (inputElem) {
                imageData.height = _this.getValueWithMeasurementUnit(inputElem.val());
            }, Editor.InputValidationsConstants.positiveIntAllowEmpty);
            var imageHSpace = imageData.hSpace ? imageData.hSpace : "" + this.minDimension;
            this.detailsViewControl.createInputField(mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.hSpaceLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.imageHSpaceInputCssClass, imageHSpace, {
                placeholder: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.hSpaceLabel),
                min: this.minDimension,
                max: this.maxDimension,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required"
            }, function (inputElem) {
                imageData.hSpace = inputElem.val();
            }, Editor.InputValidationsConstants.positiveIntNotEmpty);
            var imageVSpace = imageData.vSpace ? imageData.vSpace : "" + this.minDimension;
            this.detailsViewControl.createInputField(mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.vSpaceLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.imageVSpaceInputCssClass, imageVSpace, {
                placeholder: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.hSpaceLabel),
                min: this.minDimension,
                max: this.maxDimension,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required"
            }, function (inputElem) {
                imageData.vSpace = inputElem.val();
            }, Editor.InputValidationsConstants.positiveIntNotEmpty);
            this.detailsViewControl.createDropdownList(mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.buttonAlignmentLabel), new Dictionary({
                Left: Editor.CommonUtils.getLocalizedString("[Left]"),
                Center: Editor.CommonUtils.getLocalizedString("[Center]"),
                Right: Editor.CommonUtils.getLocalizedString("[Right]")
            }), Editor.DetailsViewConstants.imageAlignmentDropDownCssClass, String.isNullUndefinedOrWhitespace(imageData.alignment) ? "Left" : imageData.alignment, function (dropdownList) {
                imageData.alignment = dropdownList.val();
            });
            // Use timeout to set focus on IOS
            setTimeout(function () {
                if (sourceField) {
                    sourceField.find("input").focus();
                }
            }, 0);
            this.eventBroker.notify(Editor.EventConstants.imagePopupRendered);
        };
        ImagePopupRenderer.prototype.getValueWithMeasurementUnit = function (value) {
            return value + "px";
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        ImagePopupRenderer.prototype.dispose = function () {
            this.detailsViewControl.dispose();
            this.popupRenderer.dispose();
        };
        return ImagePopupRenderer;
    }());
    Editor.ImagePopupRenderer = ImagePopupRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BrowserPreviewMessage = /** @class */ (function () {
        function BrowserPreviewMessage(message, content) {
            this.message = message;
            this.content = content;
        }
        return BrowserPreviewMessage;
    }());
    Editor.BrowserPreviewMessage = BrowserPreviewMessage;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TestabilityConstants = /** @class */ (function () {
        function TestabilityConstants() {
        }
        TestabilityConstants.sortablePlaceholderId = "placeholder-tool-block";
        return TestabilityConstants;
    }());
    Editor.TestabilityConstants = TestabilityConstants;
})(Editor || (Editor = {}));
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var Utility = MktSvc.Controls.Common.Utility;
    var ColumnStylesDetailsViewRenderer = /** @class */ (function () {
        function ColumnStylesDetailsViewRenderer(detailsViewControl, delegate) {
            this.detailsViewControl = detailsViewControl;
            this.delegate = delegate;
            this.limitOnMinZero = 0;
            this.limitOnMaxMarginPadding = 500;
            this.limitOnMaxBoderWidth = 50;
            this.borderStyleInput = null;
            this.borderWidthInput = null;
        }
        /**
         * @see IBlockDetailsView.init
         */
        ColumnStylesDetailsViewRenderer.prototype.init = function () { };
        /**
         * @see IBlockDetailsView.dispose
         */
        ColumnStylesDetailsViewRenderer.prototype.dispose = function () {
            this.detailsViewControl.dispose();
        };
        /**
         * @see IBlockDetailsView.render
         */
        ColumnStylesDetailsViewRenderer.prototype.render = function (selectedBlock) {
            var styleSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.styleSectionTitle), null, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.columnBorderStylesTitleToolTip));
            this.addBgColorsConfig(selectedBlock[0], styleSection);
            this.addBorderConfig(selectedBlock[0], styleSection);
            this.addSizeConfig(selectedBlock[0]);
            this.addSpacing(selectedBlock[0]);
        };
        ColumnStylesDetailsViewRenderer.prototype.addBgColorsConfig = function (selectedBlock, section) {
            var _this = this;
            var backgroundSection = this.detailsViewControl.createSubsection(section, Editor.DetailsViewConstants.backgroundSubsectionCssClass, UniqueId.generate(Editor.DetailsViewConstants.backgroundSubsectionCssClass));
            this.detailsViewControl.createInputColorField(backgroundSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.sectionBgColorLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.sectionBgColorInputCssClass, this.delegate.getBgColor(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.sectionBgColorInputCssClass),
                placeholder: "#3162d5"
            }, function (inputField) {
                _this.delegate.onBgColorFieldUpdated(selectedBlock, inputField);
            });
            this.detailsViewControl.createImageField(backgroundSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundImageLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.backgroundSrcInputCssClass, this.delegate.getBackgroundImage(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.backgroundSrcInputCssClass)
            }, function (inputField) {
                var imageSource = inputField[0].value;
                _this.delegate.onBackgroundImageUpdated(selectedBlock, imageSource);
                Editor.CommonUtils.setElementVisibility(_this.imgHorizontalAlignmentDropdown, false);
                Editor.CommonUtils.setElementVisibility(_this.imgVerticalAlignmentDropdown, false);
                if (Utility.isNullOrUndefined(imageSource) || imageSource === "") {
                    Editor.CommonUtils.setElementVisibility(_this.imgSizeDropdown, false);
                }
                else {
                    // when we change source, we switch to default "cover" setting, therefore hide alignment dropdowns
                    Editor.CommonUtils.setElementVisibility(_this.imgSizeDropdown, true);
                }
            }, { hasFocus: false, no_assistedit: true });
            this.imgSizeDropdown = this.detailsViewControl.createDropdownList(backgroundSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundImageSizeLabel), new Dictionary({
                FullSize: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.initialSizeLabel),
                Cover: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.coverSizeLabel)
            }), Editor.DetailsViewConstants.backgroundImageSizeCssClass, this.delegate.getBackgroundImageSize(selectedBlock), function (dropdownList) {
                _this.delegate.onBackgroundImageSizeUpdated(selectedBlock, dropdownList[0]);
                var selectedValue = dropdownList[0].value;
                if (selectedValue === Editor.DetailsViewConstants.coverDropdownOption) {
                    Editor.CommonUtils.setElementVisibility(_this.imgHorizontalAlignmentDropdown, false);
                    Editor.CommonUtils.setElementVisibility(_this.imgVerticalAlignmentDropdown, false);
                }
                else if (selectedValue === Editor.DetailsViewConstants.fullSizeDropdownOption) {
                    Editor.CommonUtils.setElementVisibility(_this.imgHorizontalAlignmentDropdown, true);
                    Editor.CommonUtils.setElementVisibility(_this.imgVerticalAlignmentDropdown, true);
                }
            })[0];
            var twoColumns = this.detailsViewControl.createTwoColumnArea(backgroundSection);
            this.imgHorizontalAlignmentDropdown = this.detailsViewControl.createDropdownList(twoColumns, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundImageHorizontalAlignmentLabel), new Dictionary({
                left: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.leftAlignmentLabel),
                center: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.centerAlignmentLabel),
                right: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.rightAlignmentLabel)
            }), Editor.DetailsViewConstants.backgroundImageHorizontalAlignmentCssClass, this.delegate.getBackgroundImageHorizontalAlignment(selectedBlock), function (dropdownList) {
                _this.delegate.onBackgroundImageHorizontalAlignmentUpdated(selectedBlock, dropdownList[0]);
            })[0];
            this.imgVerticalAlignmentDropdown = this.detailsViewControl.createDropdownList(twoColumns, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundImageVerticalAlignmentLabel), new Dictionary({
                top: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.topAlignmentLabel),
                center: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.centerAlignmentLabel),
                bottom: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.bottomAlignmentLabel)
            }), Editor.DetailsViewConstants.backgroundImageVerticalAlignmentCssClass, this.delegate.getBackgroundImageVerticalAlignment(selectedBlock), function (dropdownList) {
                _this.delegate.onBackgroundImageVerticalAlignmentUpdated(selectedBlock, dropdownList[0]);
            })[0];
            var backgroundImage = this.delegate.getBackgroundImage(selectedBlock);
            var backgroundImageSize = this.delegate.getBackgroundImageSize(selectedBlock);
            this.toggleVisibilityOfBackgroundImageProperties(backgroundImage, backgroundImageSize);
            this.delegate.onBackgroundImageSizeChanged(function (size) {
                var selectElement = _this.imgSizeDropdown.getElementsByTagName("select").item(0);
                selectElement.value = size;
            });
            this.delegate.onBackgroundImageHorizontalAlignmentChanged(function (horizontalAlignment) {
                var selectElement = _this.imgHorizontalAlignmentDropdown.getElementsByTagName("select").item(0);
                selectElement.value = horizontalAlignment.toLowerCase();
            });
            this.delegate.onBackgroundImageVerticalAlignmentChanged(function (verticalAlignment) {
                var selectElement = _this.imgVerticalAlignmentDropdown.getElementsByTagName("select").item(0);
                selectElement.value = verticalAlignment.toLowerCase();
            });
        };
        ColumnStylesDetailsViewRenderer.prototype.addBorderConfig = function (selectedBlock, section) {
            var _this = this;
            this.borderStyleInput = this.detailsViewControl
                .createDropdownList(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderLabel), new Dictionary({
                None: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleNoneLabel),
                Solid: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleSolidLabel),
                Dotted: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleDottedLabel),
                Dashed: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleDashedLabel),
                Double: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleDoubleLabel)
            }), Editor.DetailsViewConstants.borderStyleInputCssClass, this.delegate.getBorderStyle(selectedBlock), function (inputField) {
                _this.delegate.onBorderStyleFieldUpdated(selectedBlock, inputField);
            })
                .find("select")
                .first();
            var borderWidthAndColorSection = this.detailsViewControl.createTwoColumnArea(section);
            this.borderWidthInput = this.detailsViewControl
                .createInputField(borderWidthAndColorSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderWidthLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.borderWidthInputCssClass, this.delegate.getBorderWidth(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderWidthInputCssClass),
                min: this.limitOnMinZero,
                max: this.limitOnMaxBoderWidth,
                role: "spinbutton"
            }, function () { }, Editor.InputValidationsConstants.positiveIntAllowEmpty, function (val) {
                _this.delegate.onReactBorderWidthValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock);
            })
                .find("input")
                .first();
            this.detailsViewControl.createInputColorField(borderWidthAndColorSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderColorLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.borderColorInputCssClass, this.delegate.getBorderColor(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderColorInputCssClass),
                placeholder: "#000000"
            }, function (inputField) {
                _this.delegate.onBorderColorFieldUpdated(selectedBlock, inputField);
            });
            this.detailsViewControl.createRange(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderRadiusLabel), this.limitOnMinZero, this.delegate.getMaxBorderRadius(selectedBlock), Editor.DetailsViewConstants.borderRadiusInputCssClass, this.delegate.getBorderRadius(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderRadiusInputCssClass)
            }, function (inputField) {
                _this.delegate.onBorderRadiusFieldUpdated(selectedBlock, inputField);
            });
        };
        ColumnStylesDetailsViewRenderer.prototype.addSizeConfig = function (block) {
            var _this = this;
            var sizeSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.sizeTitle));
            this.detailsViewControl.createInputField(sizeSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.minHeightLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.minHeightInputCssClass, this.delegate.getMinHeight(block), {
                min: this.limitOnMinZero,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.minHeightInputCssClass)
            }, function (inputField) {
                _this.delegate.onMinHeightFieldUpdated(block, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val) {
                _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, block, Editor.DetailsViewConstants.minHeightAttribute);
            });
        };
        ColumnStylesDetailsViewRenderer.prototype.addPosition = function (selectedBlock) {
            var columnPropertySection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.positionTitle));
            columnPropertySection
                .find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            this.addPaddingConfig(selectedBlock, columnPropertySection);
            this.addMarginConfig(selectedBlock, columnPropertySection);
        };
        ColumnStylesDetailsViewRenderer.prototype.addSpacing = function (selectedBlock) {
            var spacingSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.spacingTitle));
            spacingSection
                .find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            var paddingSubsection = this.detailsViewControl.createSubsection(spacingSection, Editor.DetailsViewConstants.paddingSubsectionCssClass, MktSvc.Controls.Common.UniqueId.generate(Editor.DetailsViewConstants.paddingSubsectionCssClass), Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.paddingSubsectionLabel));
            paddingSubsection
                .find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            this.addPaddingConfig(selectedBlock, paddingSubsection, true);
            var marginSubsection = this.detailsViewControl.createSubsection(spacingSection, Editor.DetailsViewConstants.marginSubsectionCssClass, MktSvc.Controls.Common.UniqueId.generate(Editor.DetailsViewConstants.marginSubsectionCssClass), Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.marginSubsectionLabel));
            marginSubsection
                .find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            this.addMarginConfig(selectedBlock, marginSubsection, true);
        };
        ColumnStylesDetailsViewRenderer.prototype.addPaddingConfig = function (selectedBlock, section, addToSubsection) {
            var _this = this;
            var inputSuffix = addToSubsection ? null : Editor.DetailsViewConstants.pixels;
            var topLabelKey = addToSubsection ? Editor.DetailsViewConstants.topAlignmentLabel : Editor.DetailsViewConstants.paddingTopLabel;
            var topReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.paddingTopAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.paddingTopAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(topLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingTopInputCssClass, this.delegate.getPaddingTop(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.paddingTopInputCssClass), function (inputField) {
                _this.delegate.onPaddingTopFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, topReactValidate, inputSuffix);
            var bottomLabelKey = addToSubsection ? Editor.DetailsViewConstants.bottomAlignmentLabel : Editor.DetailsViewConstants.paddingBottomLabel;
            var bottomReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.paddingBottomAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.paddingBottomAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(bottomLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingBottomInputCssClass, this.delegate.getPaddingBottom(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.paddingBottomInputCssClass), function (inputField) {
                _this.delegate.onPaddingBottomFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, bottomReactValidate, inputSuffix);
            var leftLabelKey = addToSubsection ? Editor.DetailsViewConstants.leftAlignmentLabel : Editor.DetailsViewConstants.paddingLeftLabel;
            var leftReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.paddingLeftAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.paddingLeftAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(leftLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingLeftInputCssClass, this.delegate.getPaddingLeft(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.paddingLeftInputCssClass), function (inputField) {
                _this.delegate.onPaddingLeftFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, leftReactValidate, inputSuffix);
            var rightLabelKey = addToSubsection ? Editor.DetailsViewConstants.rightAlignmentLabel : Editor.DetailsViewConstants.paddingRightLabel;
            var rightReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.paddingRightAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.paddingRightAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(rightLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingRightInputCssClass, this.delegate.getPaddingRight(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.paddingRightInputCssClass), function (inputField) {
                _this.delegate.onPaddingRightFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, rightReactValidate, inputSuffix);
        };
        ColumnStylesDetailsViewRenderer.prototype.addMarginConfig = function (selectedBlock, section, addToSubsection) {
            var _this = this;
            var inputSuffix = addToSubsection ? null : Editor.DetailsViewConstants.pixels;
            var topLabelKey = addToSubsection ? Editor.DetailsViewConstants.topAlignmentLabel : Editor.DetailsViewConstants.marginTopLabel;
            var topReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.marginTopAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.marginTopAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(topLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginTopInputCssClass, this.delegate.getMarginTop(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.marginTopInputCssClass), function (inputField) {
                _this.delegate.onMarginTopFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, topReactValidate, inputSuffix);
            var bottomLabelKey = addToSubsection ? Editor.DetailsViewConstants.bottomAlignmentLabel : Editor.DetailsViewConstants.marginBottomLabel;
            var bottomReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.marginBottomAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.marginBottomAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(bottomLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginBottomInputCssClass, this.delegate.getMarginBottom(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.marginBottomInputCssClass), function (inputField) {
                _this.delegate.onMarginBottomFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, bottomReactValidate, inputSuffix);
            var leftLabelKey = addToSubsection ? Editor.DetailsViewConstants.leftAlignmentLabel : Editor.DetailsViewConstants.marginLeftLabel;
            var leftReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.marginLeftAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.marginLeftAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(leftLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginLeftInputCssClass, this.delegate.getMarginLeft(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.marginLeftInputCssClass), function (inputField) {
                _this.delegate.onMarginLeftFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, leftReactValidate, inputSuffix);
            var rightLabelKey = addToSubsection ? Editor.DetailsViewConstants.rightAlignmentLabel : Editor.DetailsViewConstants.marginRightLabel;
            var rightReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.marginRightAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.marginRightAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(rightLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginRightInputCssClass, this.delegate.getMarginRight(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.marginRightInputCssClass), function (inputField) {
                _this.delegate.onMarginRightFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, rightReactValidate, inputSuffix);
        };
        ColumnStylesDetailsViewRenderer.prototype.toggleVisibilityOfBackgroundImageProperties = function (imageSource, backgroundSize) {
            if (Utility.isNullOrUndefined(imageSource) || imageSource === "") {
                Editor.CommonUtils.setElementVisibility(this.imgHorizontalAlignmentDropdown, false);
                Editor.CommonUtils.setElementVisibility(this.imgVerticalAlignmentDropdown, false);
                Editor.CommonUtils.setElementVisibility(this.imgSizeDropdown, false);
            }
            else {
                Editor.CommonUtils.setElementVisibility(this.imgSizeDropdown, true);
                Editor.CommonUtils.setElementVisibility(this.imgHorizontalAlignmentDropdown, false);
                Editor.CommonUtils.setElementVisibility(this.imgVerticalAlignmentDropdown, false);
                if (backgroundSize === "FullSize") {
                    Editor.CommonUtils.setElementVisibility(this.imgHorizontalAlignmentDropdown, true);
                    Editor.CommonUtils.setElementVisibility(this.imgVerticalAlignmentDropdown, true);
                }
            }
        };
        ColumnStylesDetailsViewRenderer.prototype.getSpacingInputAttributes = function (cssClass) {
            return {
                min: this.limitOnMinZero,
                max: this.limitOnMaxMarginPadding,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(cssClass)
            };
        };
        return ColumnStylesDetailsViewRenderer;
    }());
    Editor.ColumnStylesDetailsViewRenderer = ColumnStylesDetailsViewRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var ImageStylesDetailsViewRenderer = /** @class */ (function () {
        function ImageStylesDetailsViewRenderer(detailsViewControl, delegate, fcbList) {
            this.detailsViewControl = detailsViewControl;
            this.delegate = delegate;
            this.fcbList = fcbList;
            this.limitOnMinZero = 0;
            this.minDimension = 0;
            this.maxDimension = 10000;
            this.imageDimensionsProvider = new Editor.ImageNativeDimensionsProvider();
        }
        /**
         * @see IBlockDetailsView.init
         */
        ImageStylesDetailsViewRenderer.prototype.init = function () { };
        /**
         * @see IBlockDetailsView.dispose
         */
        ImageStylesDetailsViewRenderer.prototype.dispose = function () {
            this.detailsViewControl.dispose();
        };
        /**
         * @see IBlockDetailsView.init
         */
        ImageStylesDetailsViewRenderer.prototype.render = function (selectedBlock) {
            this.addProperties(selectedBlock[0]);
        };
        ImageStylesDetailsViewRenderer.prototype.getMaxRange = function (image, loadedImages, container) {
            if (loadedImages.length === 1 && !loadedImages[0].invalid) {
                var nativeHeight = loadedImages[0].height;
                var nativeWidth = loadedImages[0].width;
                var imageElementWidth = Editor.CommonUtils.getElementWidth(image);
                var imageElementHeight = Editor.CommonUtils.getElementHeight(image);
                var containerWidth = Editor.CommonUtils.calculateContainerWidth(container);
                var displayedImageWidth = 0;
                if (image.style.maxWidth === "calc(100%)" || image.style.maxWidth === "100%") {
                    displayedImageWidth = (containerWidth > 0) ? Math.min(nativeWidth, containerWidth) : nativeWidth;
                }
                else if (imageElementWidth !== undefined) {
                    displayedImageWidth = imageElementWidth;
                }
                var displayedImageHeight = 0;
                if (image.style.maxHeight === "100%") {
                    displayedImageHeight = nativeHeight * (displayedImageWidth / nativeWidth);
                }
                else if (imageElementHeight !== undefined) {
                    displayedImageHeight = imageElementHeight;
                }
                return Math.round(Math.min(displayedImageWidth, displayedImageHeight) / 2);
            }
            return 1;
        };
        ImageStylesDetailsViewRenderer.prototype.updateRange = function (container) {
            return __awaiter(this, void 0, void 0, function () {
                var image, loadedImages, maxRange;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            image = container.getElementsByTagName("img").item(0);
                            return [4 /*yield*/, this.imageDimensionsProvider.getDimensions([image.src])];
                        case 1:
                            loadedImages = _a.sent();
                            maxRange = this.getMaxRange(image, loadedImages, container);
                            this.detailsViewControl.changeRangeElement(this.rangeElement, 0, maxRange);
                            return [2 /*return*/];
                    }
                });
            });
        };
        ImageStylesDetailsViewRenderer.prototype.addProperties = function (selectedBlock) {
            var _this = this;
            this.mainSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.imageSectionLabel));
            this.detailsViewControl.createImageField(this.mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.imageSourceLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.srcInputCssClass, this.delegate.getImgAttributeInitialValue(selectedBlock, Editor.DetailsViewConstants.srcAttribute), {
                id: UniqueId.generate(Editor.DetailsViewConstants.srcInputCssClass)
            }, function (inputField) {
                _this.delegate.onImgAttributeFieldUpdated(selectedBlock, inputField.val(), Editor.DetailsViewConstants.srcAttribute);
                _this.updateRange(selectedBlock);
            }, { hasFocus: false, no_assistedit: true });
            this.detailsViewControl.createInputField(this.mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.altLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.altInputCssClass, this.delegate.getImgAttributeInitialValue(selectedBlock, Editor.DetailsViewConstants.altAttribute), {
                id: UniqueId.generate(Editor.DetailsViewConstants.altInputCssClass)
            }, function (inputField) {
                _this.delegate.onImgAttributeFieldUpdated(selectedBlock, inputField.val(), Editor.DetailsViewConstants.altAttribute);
            });
            this.decorativeCheckbox = this.detailsViewControl.createCheckbox(this.mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.decorativeCheckboxLabel), this.delegate.getDefaultCheckboxValue(selectedBlock), {
                checked: this.delegate.getDefaultCheckboxValue(selectedBlock)
            }, function (inputField) {
                _this.delegate.onDecorativeCheckboxFieldUpdated(selectedBlock, inputField);
            });
            this.decorativeCheckbox.find("input").prop("checked", this.delegate.getDefaultCheckboxValue(selectedBlock));
            if (this.decorativeCheckbox.find("input").prop("checked")) {
                var altInput = $(".altInput");
                if (altInput.length) {
                    altInput.val("");
                    altInput.prop("disabled", true);
                }
            }
            this.detailsViewControl.createLinkField(this.mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.linkLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.linkInputCssClass, this.delegate.getLinkWrapperHrefValue(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.linkInputCssClass)
            }, function (inputField) {
                _this.delegate.onLinkWrapperFieldUpdated(selectedBlock, inputField);
            }, { hasFocus: false });
            this.detailsViewControl.createDropdownList(this.mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.imageAlignmentLabel), new Dictionary({
                Left: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.leftAlignmentLabel),
                Center: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.centerAlignmentLabel),
                Right: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.rightAlignmentLabel)
            }), Editor.DetailsViewConstants.imageAlignmentDropDownCssClass, this.delegate.getImageAlignment(selectedBlock), function (dropdownList) {
                _this.delegate.onImageAlignmentUpdated(selectedBlock, dropdownList);
            });
            var sizeSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.sizeSectionTitle));
            var twoColumnsArea = this.detailsViewControl.createTwoColumnArea(sizeSection);
            this.createSizeInputFields(selectedBlock, twoColumnsArea);
            var borderRadius = this.delegate.getBorderRadius(selectedBlock);
            this.rangeElement = this.detailsViewControl.createRange(this.mainSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderRadiusLabel), this.limitOnMinZero, Number(borderRadius), //set current value as max before we calculate proper max value
            Editor.DetailsViewConstants.borderRadiusInputCssClass, borderRadius, {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderRadiusInputCssClass)
            }, function (inputField) {
                _this.delegate.onBorderRadiusFieldUpdated(selectedBlock, inputField);
            });
            return this.updateRange(selectedBlock);
        };
        ImageStylesDetailsViewRenderer.prototype.createSizeInputFields = function (selectedBlock, section) {
            var _this = this;
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.imgHeightLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.imageHeightInputCssClass, this.delegate.getImgAttributeInitialValue(selectedBlock, Editor.DetailsViewConstants.imgHeightAttribute), {
                id: UniqueId.generate(Editor.DetailsViewConstants.imageHeightInputCssClass),
                placeholder: Editor.DetailsViewConstants.placeHolderAuto,
                min: this.minDimension,
                max: this.maxDimension,
                role: "spinbutton"
            }, function () { }, null, function (val, event) {
                if (val === Editor.DetailsViewConstants.placeHolderAuto) {
                    val = "";
                }
                _this.delegate.onImgAttributeFieldUpdated(selectedBlock, val, Editor.DetailsViewConstants.imgHeightAttribute);
                _this.updateRange(selectedBlock);
                _this.delegate.onReactValidate();
            });
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.imgWidthLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.imageWidthInputCssClass, this.delegate.getImgAttributeInitialValue(selectedBlock, Editor.DetailsViewConstants.imgWidthAttribute), {
                id: UniqueId.generate(Editor.DetailsViewConstants.imageWidthInputCssClass),
                placeholder: Editor.DetailsViewConstants.placeHolderAuto,
                min: this.minDimension,
                max: this.maxDimension,
                role: "spinbutton"
            }, function () { }, null, function (val, event) {
                if (val === Editor.DetailsViewConstants.placeHolderAuto) {
                    val = "";
                }
                _this.delegate.onImgAttributeFieldUpdated(selectedBlock, val, Editor.DetailsViewConstants.imgWidthAttribute);
                _this.updateRange(selectedBlock);
                _this.delegate.onReactValidate();
            });
        };
        return ImageStylesDetailsViewRenderer;
    }());
    Editor.ImageStylesDetailsViewRenderer = ImageStylesDetailsViewRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var Utility = MktSvc.Controls.Common.Utility;
    var SectionStylesDetailsViewRenderer = /** @class */ (function () {
        function SectionStylesDetailsViewRenderer(detailsViewControl, delegate, fcbList) {
            this.detailsViewControl = detailsViewControl;
            this.delegate = delegate;
            this.fcbList = fcbList;
            this.limitOnMinZero = 0;
            this.limitOnMaxMarginPadding = 500;
            this.limitOnMaxBorderWidth = 50;
            this.borderStyleInput = null;
            this.borderWidthInput = null;
        }
        /**
         * @see IBlockDetailsView.init
         */
        SectionStylesDetailsViewRenderer.prototype.init = function () { };
        /**
         * @see IBlockDetailsView.dispose
         */
        SectionStylesDetailsViewRenderer.prototype.dispose = function () {
            this.detailsViewControl.dispose();
        };
        /**
         * @see IBlockDetailsView.init
         */
        SectionStylesDetailsViewRenderer.prototype.render = function (selectedBlock) {
            var styleSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.styleSectionTitle), null, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.sectionBorderStylesTitleToolTip));
            this.addBgColorsConfig(selectedBlock[0], styleSection);
            this.addBorderConfig(selectedBlock[0], styleSection);
            this.addSize(selectedBlock);
            this.addSpacing(selectedBlock[0]);
        };
        SectionStylesDetailsViewRenderer.prototype.addBgColorsConfig = function (selectedBlock, section) {
            var _this = this;
            var backgroundSection = this.detailsViewControl.createSubsection(section, Editor.DetailsViewConstants.backgroundSubsectionCssClass, UniqueId.generate(Editor.DetailsViewConstants.backgroundSubsectionCssClass));
            this.detailsViewControl.createInputColorField(backgroundSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.sectionBgColorLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.sectionBgColorInputCssClass, this.delegate.getBgColor(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.sectionBgColorInputCssClass),
                placeholder: "#3162d5"
            }, function (inputField) {
                _this.delegate.onBgColorFieldUpdated(selectedBlock, inputField);
            });
            this.detailsViewControl.createImageField(backgroundSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundImageLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.backgroundSrcInputCssClass, this.delegate.getBackgroundImage(selectedBlock), {}, function (inputField) {
                var imageSource = inputField[0].value;
                _this.delegate.onBackgroundImageUpdated(selectedBlock, imageSource);
                Editor.CommonUtils.setElementVisibility(_this.imgHorizontalAlignmentDropdown, false);
                Editor.CommonUtils.setElementVisibility(_this.imgVerticalAlignmentDropdown, false);
                if (Utility.isNullOrUndefined(imageSource) || imageSource === "") {
                    Editor.CommonUtils.setElementVisibility(_this.imgSizeDropdown, false);
                }
                else {
                    // when we change source, we switch to default "cover" setting, therefore hide alignment dropdowns
                    Editor.CommonUtils.setElementVisibility(_this.imgSizeDropdown, true);
                }
            }, { hasFocus: false, no_assistedit: true });
            this.imgSizeDropdown = this.detailsViewControl.createDropdownList(backgroundSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundImageSizeLabel), new Dictionary({
                FullSize: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.initialSizeLabel),
                Cover: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.coverSizeLabel)
            }), Editor.DetailsViewConstants.backgroundImageSizeCssClass, this.delegate.getBackgroundImageSize(selectedBlock), function (dropdownList) {
                _this.delegate.onBackgroundImageSizeUpdated(selectedBlock, dropdownList[0]);
                var selectedValue = dropdownList[0].value;
                if (selectedValue === Editor.DetailsViewConstants.coverDropdownOption) {
                    Editor.CommonUtils.setElementVisibility(_this.imgHorizontalAlignmentDropdown, false);
                    Editor.CommonUtils.setElementVisibility(_this.imgVerticalAlignmentDropdown, false);
                }
                else if (selectedValue === Editor.DetailsViewConstants.fullSizeDropdownOption) {
                    Editor.CommonUtils.setElementVisibility(_this.imgHorizontalAlignmentDropdown, true);
                    Editor.CommonUtils.setElementVisibility(_this.imgVerticalAlignmentDropdown, true);
                }
            })[0];
            var twoColumns = this.detailsViewControl.createTwoColumnArea(backgroundSection);
            this.imgHorizontalAlignmentDropdown = this.detailsViewControl.createDropdownList(twoColumns, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundImageHorizontalAlignmentLabel), new Dictionary({
                left: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.leftAlignmentLabel),
                center: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.centerAlignmentLabel),
                right: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.rightAlignmentLabel)
            }), Editor.DetailsViewConstants.backgroundImageHorizontalAlignmentCssClass, this.delegate.getBackgroundImageHorizontalAlignment(selectedBlock), function (dropdownList) {
                _this.delegate.onBackgroundImageHorizontalAlignmentUpdated(selectedBlock, dropdownList[0]);
            })[0];
            this.imgVerticalAlignmentDropdown = this.detailsViewControl.createDropdownList(twoColumns, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.backgroundImageVerticalAlignmentLabel), new Dictionary({
                top: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.topAlignmentLabel),
                center: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.centerAlignmentLabel),
                bottom: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.bottomAlignmentLabel)
            }), Editor.DetailsViewConstants.backgroundImageVerticalAlignmentCssClass, this.delegate.getBackgroundImageVerticalAlignment(selectedBlock), function (dropdownList) {
                _this.delegate.onBackgroundImageVerticalAlignmentUpdated(selectedBlock, dropdownList[0]);
            })[0];
            var backgroundImage = this.delegate.getBackgroundImage(selectedBlock);
            var backgroundImageSize = this.delegate.getBackgroundImageSize(selectedBlock);
            this.toggleVisibilityOfBackgroundImageProperties(backgroundImage, backgroundImageSize);
            this.delegate.onBackgroundImageSizeChanged(function (size) {
                var selectElement = _this.imgSizeDropdown.getElementsByTagName("select").item(0);
                selectElement.value = size;
            });
            this.delegate.onBackgroundImageHorizontalAlignmentChanged(function (horizontalAlignment) {
                var selectElement = _this.imgHorizontalAlignmentDropdown.getElementsByTagName("select").item(0);
                selectElement.value = horizontalAlignment.toLowerCase();
            });
            this.delegate.onBackgroundImageVerticalAlignmentChanged(function (verticalAlignment) {
                var selectElement = _this.imgVerticalAlignmentDropdown.getElementsByTagName("select").item(0);
                selectElement.value = verticalAlignment.toLowerCase();
            });
        };
        SectionStylesDetailsViewRenderer.prototype.addBorderConfig = function (selectedBlock, section) {
            var _this = this;
            this.borderStyleInput = this.detailsViewControl
                .createDropdownList(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderLabel), new Dictionary({
                None: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleNoneLabel),
                Solid: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleSolidLabel),
                Dotted: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleDottedLabel),
                Dashed: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleDashedLabel),
                Double: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleDoubleLabel)
            }), Editor.DetailsViewConstants.borderStyleInputCssClass, this.delegate.getBorderStyle(selectedBlock), function (inputField) {
                _this.delegate.onBorderStyleFieldUpdated(selectedBlock, inputField);
            })
                .find("select")
                .first();
            var borderWidthAndColorSection = this.detailsViewControl.createTwoColumnArea(section);
            this.borderWidthInput = this.detailsViewControl
                .createInputField(borderWidthAndColorSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderWidthLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.borderWidthInputCssClass, this.delegate.getBorderWidth(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderWidthInputCssClass),
                min: this.limitOnMinZero,
                max: this.limitOnMaxBorderWidth,
                role: "spinbutton"
            }, function () { }, Editor.InputValidationsConstants.positiveIntAllowEmpty, function (val) {
                _this.delegate.onReactBorderWidthValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock);
            })
                .find("input")
                .first();
            this.detailsViewControl.createInputColorField(borderWidthAndColorSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderColorLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.borderColorInputCssClass, this.delegate.getBorderColor(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderColorInputCssClass),
                placeholder: "#000000"
            }, function (inputField) {
                _this.delegate.onBorderColorFieldUpdated(selectedBlock, inputField);
            });
            this.detailsViewControl.createRange(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderRadiusLabel), this.limitOnMinZero, this.delegate.getMaxBorderRadius(selectedBlock), Editor.DetailsViewConstants.borderRadiusInputCssClass, this.delegate.getBorderRadius(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderRadiusInputCssClass)
            }, function (inputField) {
                _this.delegate.onBorderRadiusFieldUpdated(selectedBlock, inputField);
            });
        };
        SectionStylesDetailsViewRenderer.prototype.addSize = function (selectedBlock) {
            var _this = this;
            var sizeSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.sizeTitle));
            var block = selectedBlock[0];
            this.detailsViewControl.createInputField(sizeSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.minHeightLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.minHeightInputCssClass, this.delegate.getMinHeight(block), {
                min: this.limitOnMinZero,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.minHeightInputCssClass)
            }, function (inputField) {
                _this.delegate.onMinHeightFieldUpdated(block, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, block, Editor.DetailsViewConstants.minHeightAttribute); });
        };
        SectionStylesDetailsViewRenderer.prototype.addSpacing = function (selectedBlock) {
            var spacingSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.spacingTitle));
            spacingSection
                .find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            var paddingSubsection = this.detailsViewControl.createSubsection(spacingSection, Editor.DetailsViewConstants.paddingSubsectionCssClass, MktSvc.Controls.Common.UniqueId.generate(Editor.DetailsViewConstants.paddingSubsectionCssClass), Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.paddingSubsectionLabel));
            paddingSubsection
                .find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            this.addPaddingConfig(selectedBlock, paddingSubsection, true);
            var marginSubsection = this.detailsViewControl.createSubsection(spacingSection, Editor.DetailsViewConstants.marginSubsectionCssClass, MktSvc.Controls.Common.UniqueId.generate(Editor.DetailsViewConstants.marginSubsectionCssClass), Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.marginSubsectionLabel));
            marginSubsection
                .find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            this.addMarginConfig(selectedBlock, marginSubsection, true);
        };
        SectionStylesDetailsViewRenderer.prototype.addPaddingConfig = function (selectedBlock, section, addToSubsection) {
            var _this = this;
            var inputSuffix = addToSubsection ? null : Editor.DetailsViewConstants.pixels;
            var topLabelKey = addToSubsection ? Editor.DetailsViewConstants.topAlignmentLabel : Editor.DetailsViewConstants.paddingTopLabel;
            var topReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.paddingTopAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.paddingTopAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(topLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingTopInputCssClass, this.delegate.getPaddingTop(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.paddingTopInputCssClass), function (inputField) {
                _this.delegate.onPaddingTopFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, topReactValidate, inputSuffix);
            var bottomLabelKey = addToSubsection ? Editor.DetailsViewConstants.bottomAlignmentLabel : Editor.DetailsViewConstants.paddingBottomLabel;
            var bottomReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.paddingBottomAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.paddingBottomAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(bottomLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingBottomInputCssClass, this.delegate.getPaddingBottom(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.paddingBottomInputCssClass), function (inputField) {
                _this.delegate.onPaddingBottomFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, bottomReactValidate, inputSuffix);
            var leftLabelKey = addToSubsection ? Editor.DetailsViewConstants.leftAlignmentLabel : Editor.DetailsViewConstants.paddingLeftLabel;
            var leftReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.paddingLeftAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.paddingLeftAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(leftLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingLeftInputCssClass, this.delegate.getPaddingLeft(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.paddingLeftInputCssClass), function (inputField) {
                _this.delegate.onPaddingLeftFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, leftReactValidate, inputSuffix);
            var rightLabelKey = addToSubsection ? Editor.DetailsViewConstants.rightAlignmentLabel : Editor.DetailsViewConstants.paddingRightLabel;
            var rightReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.paddingRightAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.paddingRightAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(rightLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.paddingRightInputCssClass, this.delegate.getPaddingRight(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.paddingRightInputCssClass), function (inputField) {
                _this.delegate.onPaddingRightFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, rightReactValidate, inputSuffix);
        };
        SectionStylesDetailsViewRenderer.prototype.addMarginConfig = function (selectedBlock, section, addToSubsection) {
            var _this = this;
            var inputSuffix = addToSubsection ? null : Editor.DetailsViewConstants.pixels;
            var topLabelKey = addToSubsection ? Editor.DetailsViewConstants.topAlignmentLabel : Editor.DetailsViewConstants.marginTopLabel;
            var topReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.marginTopAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.marginTopAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(topLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginTopInputCssClass, this.delegate.getMarginTop(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.marginTopInputCssClass), function (inputField) {
                _this.delegate.onMarginTopFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, topReactValidate, inputSuffix);
            var bottomLabelKey = addToSubsection ? Editor.DetailsViewConstants.bottomAlignmentLabel : Editor.DetailsViewConstants.marginBottomLabel;
            var bottomReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.marginBottomAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.marginBottomAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(bottomLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginBottomInputCssClass, this.delegate.getMarginBottom(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.marginBottomInputCssClass), function (inputField) {
                _this.delegate.onMarginBottomFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, bottomReactValidate, inputSuffix);
            var leftLabelKey = addToSubsection ? Editor.DetailsViewConstants.leftAlignmentLabel : Editor.DetailsViewConstants.marginLeftLabel;
            var leftReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.marginLeftAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.marginLeftAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(leftLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginLeftInputCssClass, this.delegate.getMarginLeft(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.marginLeftInputCssClass), function (inputField) {
                _this.delegate.onMarginLeftFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, leftReactValidate, inputSuffix);
            var rightLabelKey = addToSubsection ? Editor.DetailsViewConstants.rightAlignmentLabel : Editor.DetailsViewConstants.marginRightLabel;
            var rightReactValidate = addToSubsection ?
                function (val) { _this.delegate.onReactValidate(val + Editor.DetailsViewConstants.pixels, selectedBlock, Editor.DetailsViewConstants.marginRightAttribute); }
                : function (val) { _this.delegate.onReactValidate(val, selectedBlock, Editor.DetailsViewConstants.marginRightAttribute); };
            this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(rightLabelKey), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.marginRightInputCssClass, this.delegate.getMarginRight(selectedBlock), this.getSpacingInputAttributes(Editor.DetailsViewConstants.marginRightInputCssClass), function (inputField) {
                _this.delegate.onMarginRightFieldUpdated(selectedBlock, inputField[0]);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, rightReactValidate, inputSuffix);
        };
        SectionStylesDetailsViewRenderer.prototype.toggleVisibilityOfBackgroundImageProperties = function (imageSource, backgroundSize) {
            if (Utility.isNullOrUndefined(imageSource) || imageSource === "") {
                Editor.CommonUtils.setElementVisibility(this.imgHorizontalAlignmentDropdown, false);
                Editor.CommonUtils.setElementVisibility(this.imgVerticalAlignmentDropdown, false);
                Editor.CommonUtils.setElementVisibility(this.imgSizeDropdown, false);
            }
            else {
                Editor.CommonUtils.setElementVisibility(this.imgSizeDropdown, true);
                Editor.CommonUtils.setElementVisibility(this.imgHorizontalAlignmentDropdown, false);
                Editor.CommonUtils.setElementVisibility(this.imgVerticalAlignmentDropdown, false);
                if (backgroundSize === "FullSize") {
                    Editor.CommonUtils.setElementVisibility(this.imgHorizontalAlignmentDropdown, true);
                    Editor.CommonUtils.setElementVisibility(this.imgVerticalAlignmentDropdown, true);
                }
            }
        };
        SectionStylesDetailsViewRenderer.prototype.getSpacingInputAttributes = function (cssClass) {
            return {
                min: "" + this.limitOnMinZero,
                max: "" + this.limitOnMaxMarginPadding,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(cssClass)
            };
        };
        return SectionStylesDetailsViewRenderer;
    }());
    Editor.SectionStylesDetailsViewRenderer = SectionStylesDetailsViewRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var ColumnStylesDetailsViewModel = /** @class */ (function () {
        function ColumnStylesDetailsViewModel(detailsViewControl, imageDimensionsProvider) {
            this.detailsViewControl = detailsViewControl;
            this.imageDimensionsProvider = imageDimensionsProvider;
            this.center = "center";
            this.limitOnMin = 0;
            this.limitOnMax = 500;
            this.defaultBorderColor = Editor.ColorUtils.black;
        }
        /**
         * @see IBlockDetailsView.init
         */
        ColumnStylesDetailsViewModel.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.columnStylesDetailsView = new Editor.ColumnStylesDetailsViewRenderer(this.detailsViewControl, this);
        };
        /**
         * @see IBlockDetailsView.dispose
         */
        ColumnStylesDetailsViewModel.prototype.dispose = function () {
            this.detailsViewControl.dispose();
        };
        /**
         * @see IBlockDetailsView.init
         */
        ColumnStylesDetailsViewModel.prototype.render = function (selectedBlock) {
            this.columnStylesDetailsView.render(selectedBlock);
        };
        ColumnStylesDetailsViewModel.prototype.getBgColor = function (section) {
            var value = section.style.backgroundColor;
            if (Utility.isNullOrUndefined(value)) {
                value = "";
            }
            return Editor.ColorUtils.rgbToHex(value);
        };
        ColumnStylesDetailsViewModel.prototype.onBgColorFieldUpdated = function (selectedBlock, inputElement) {
            var color = Editor.ColorUtils.rgbToHex(inputElement.val());
            selectedBlock.style.backgroundColor = color;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, // need to update based on feedback
            new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ColumnStylesDetailsViewModel.prototype.getBorderColor = function (section) {
            var value = section.style.borderColor;
            value = Utility.isNullOrUndefined(value) || value === "" ? this.defaultBorderColor : value;
            return Editor.ColorUtils.rgbToHex(value);
        };
        ColumnStylesDetailsViewModel.prototype.onBorderColorFieldUpdated = function (selectedBlock, inputElement) {
            var color = Editor.ColorUtils.rgbToHex(inputElement.val());
            selectedBlock.style.borderColor = color;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, // same as above.
            new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ColumnStylesDetailsViewModel.prototype.getBorderStyle = function (section) {
            var value = section.style.borderStyle;
            value = Utility.isNullOrUndefined(value) || value === "" ? Editor.DetailsViewConstants.borderStyleNone : value;
            return value.charAt(0).toUpperCase() + value.slice(1);
        };
        ColumnStylesDetailsViewModel.prototype.onBorderStyleFieldUpdated = function (selectedBlock, inputElement) {
            var borderStyle = inputElement.val();
            var borderColor = selectedBlock.style.borderColor;
            if (borderStyle === Editor.DetailsViewConstants.borderStyleNone && selectedBlock.style.borderWidth !== "0px") {
                selectedBlock.style.borderWidth = "0px";
                this.columnStylesDetailsView.borderWidthInput.val(0);
            }
            else if (borderStyle !== Editor.DetailsViewConstants.borderStyleNone &&
                (selectedBlock.style.borderWidth === "0px" || selectedBlock.style.borderWidth === "")) {
                selectedBlock.style.borderWidth = "1px";
                this.columnStylesDetailsView.borderWidthInput.val(1);
                if (Utility.isNullOrUndefined(borderColor) || borderColor === "") {
                    this.setDefaultBorderColor(selectedBlock);
                }
            }
            selectedBlock.style.borderStyle = borderStyle;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ColumnStylesDetailsViewModel.prototype.getBorderWidth = function (section) {
            var value = section.style.borderWidth;
            value = Utility.isNullOrUndefined(value) ? "" : value;
            return value.replace("px", "");
        };
        ColumnStylesDetailsViewModel.prototype.onBorderWidthFieldUpdated = function (selectedBlock, inputElement) {
            var width = inputElement.val();
            var borderStyle = this.getBorderStyle(selectedBlock);
            var borderColor = selectedBlock.style.borderColor;
            if (width !== "0" && borderStyle === Editor.DetailsViewConstants.borderStyleNone) {
                selectedBlock.style.borderStyle = Editor.DetailsViewConstants.borderStyleSolid;
                this.columnStylesDetailsView.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleSolid);
                if (Utility.isNullOrUndefined(borderColor) || borderColor === "") {
                    this.setDefaultBorderColor(selectedBlock);
                }
            }
            else if (width === "0" && borderStyle !== Editor.DetailsViewConstants.borderStyleNone) {
                selectedBlock.style.borderStyle = Editor.DetailsViewConstants.borderStyleNone;
                this.columnStylesDetailsView.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleNone);
            }
            selectedBlock.style.borderWidth = width + "px";
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, // same as above
            new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ColumnStylesDetailsViewModel.prototype.getBorderRadius = function (section) {
            var value = section.style.borderRadius;
            value = Utility.isNullOrUndefined(value) ? "" : value;
            return value.replace("px", "");
        };
        ColumnStylesDetailsViewModel.prototype.onBorderRadiusFieldUpdated = function (selectedBlock, inputElement) {
            var width = inputElement.val();
            selectedBlock.style.borderRadius = width + "px";
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, // same as above
            new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ColumnStylesDetailsViewModel.prototype.onMinHeightFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.minHeightAttribute, this.limitOnMin, this.limitOnMax);
        };
        ColumnStylesDetailsViewModel.prototype.getMinHeight = function (block) {
            var value = block.style[Editor.DetailsViewConstants.minHeightAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        ColumnStylesDetailsViewModel.prototype.getPaddingTop = function (section) {
            var value = section.style[Editor.DetailsViewConstants.paddingTopAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        ColumnStylesDetailsViewModel.prototype.onPaddingTopFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.paddingTopAttribute, this.limitOnMin, this.limitOnMax);
        };
        ColumnStylesDetailsViewModel.prototype.getPaddingBottom = function (section) {
            var value = section.style[Editor.DetailsViewConstants.paddingBottomAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        ColumnStylesDetailsViewModel.prototype.onPaddingBottomFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.paddingBottomAttribute, this.limitOnMin, this.limitOnMax);
        };
        ColumnStylesDetailsViewModel.prototype.getPaddingLeft = function (section) {
            var value = section.style[Editor.DetailsViewConstants.paddingLeftAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        ColumnStylesDetailsViewModel.prototype.onPaddingLeftFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.paddingLeftAttribute, this.limitOnMin, this.limitOnMax);
        };
        ColumnStylesDetailsViewModel.prototype.getPaddingRight = function (section) {
            var value = section.style[Editor.DetailsViewConstants.paddingRightAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        ColumnStylesDetailsViewModel.prototype.onPaddingRightFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.paddingRightAttribute, this.limitOnMin, this.limitOnMax);
        };
        ColumnStylesDetailsViewModel.prototype.getMarginTop = function (section) {
            var value = section.style[Editor.DetailsViewConstants.marginTopAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        ColumnStylesDetailsViewModel.prototype.onMarginTopFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.marginTopAttribute, this.limitOnMin, this.limitOnMax);
            this.updateBackgroundImage(selectedBlock);
        };
        ColumnStylesDetailsViewModel.prototype.getMarginBottom = function (section) {
            var value = section.style[Editor.DetailsViewConstants.marginBottomAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        ColumnStylesDetailsViewModel.prototype.onMarginBottomFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.marginBottomAttribute, this.limitOnMin, this.limitOnMax);
            this.updateBackgroundImage(selectedBlock);
        };
        ColumnStylesDetailsViewModel.prototype.getMarginLeft = function (section) {
            var value = section.style[Editor.DetailsViewConstants.marginLeftAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        ColumnStylesDetailsViewModel.prototype.onMarginLeftFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.marginLeftAttribute, this.limitOnMin, this.limitOnMax);
            this.updateBackgroundImage(selectedBlock);
        };
        ColumnStylesDetailsViewModel.prototype.getMarginRight = function (section) {
            var value = section.style[Editor.DetailsViewConstants.marginRightAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        ColumnStylesDetailsViewModel.prototype.onMarginRightFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.marginRightAttribute, this.limitOnMin, this.limitOnMax);
            this.updateBackgroundImage(selectedBlock);
        };
        ColumnStylesDetailsViewModel.prototype.onBackgroundImageUpdated = function (section, imageSource) {
            if (Utility.isNullOrUndefined(imageSource) || imageSource === "") {
                section.style.removeProperty("background-image");
                section.style.removeProperty("background-repeat");
                section.style.removeProperty("background-size");
                section.style.removeProperty("background-position");
                this.notifyAboutChanges();
            }
            else {
                this.setBackgroundImage(section, imageSource, true, this.center, this.center);
            }
        };
        ColumnStylesDetailsViewModel.prototype.onBackgroundImageSizeUpdated = function (section, dropdown) {
            var value = dropdown.value;
            var backgroundImage = this.getBackgroundImage(section);
            switch (value) {
                case Editor.DetailsViewConstants.fullSizeDropdownOption:
                    this.setBackgroundImage(section, backgroundImage, false, this.center, this.center);
                    break;
                case Editor.DetailsViewConstants.coverDropdownOption:
                    this.setBackgroundImage(section, backgroundImage, true, this.center, this.center);
                    break;
                default:
                    break;
            }
        };
        ColumnStylesDetailsViewModel.prototype.onBackgroundImageHorizontalAlignmentUpdated = function (section, dropdown) {
            var value = dropdown.value;
            var backgroundImage = this.getBackgroundImage(section);
            var imageSize = this.getBackgroundImageSize(section);
            var isCover = imageSize === undefined ? undefined : imageSize === "Cover" ? true : false;
            var verticalAlignment = this.getBackgroundImageVerticalAlignment(section);
            this.setBackgroundImage(section, backgroundImage, isCover, value, verticalAlignment);
        };
        ColumnStylesDetailsViewModel.prototype.onBackgroundImageVerticalAlignmentUpdated = function (section, dropdown) {
            var value = dropdown.value;
            var backgroundImage = this.getBackgroundImage(section);
            var imageSize = this.getBackgroundImageSize(section);
            var isCover = imageSize === undefined
                ? undefined
                : imageSize === Editor.DetailsViewConstants.coverDropdownOption
                    ? true
                    : false;
            var horizontalAlignment = this.getBackgroundImageHorizontalAlignment(section);
            this.setBackgroundImage(section, backgroundImage, isCover, horizontalAlignment, value);
        };
        ColumnStylesDetailsViewModel.prototype.updateBackgroundImage = function (section) {
            if (!Utility.isNullOrUndefined(section.style.backgroundImage)) {
                var imageSource = this.getBackgroundImage(section);
                var imageSize = this.getBackgroundImageSize(section);
                var isCover = imageSize === undefined
                    ? undefined
                    : imageSize === Editor.DetailsViewConstants.coverDropdownOption
                        ? true
                        : false;
                var horizontalAlignment = this.getBackgroundImageHorizontalAlignment(section);
                var verticalAlignment = this.getBackgroundImageVerticalAlignment(section);
                this.setBackgroundImage(section, imageSource, isCover, horizontalAlignment, verticalAlignment);
            }
        };
        ColumnStylesDetailsViewModel.prototype.setBackgroundImage = function (section, imageSource, isCover, horizontalAlignment, verticalAlignment) {
            var _this = this;
            this.imageDimensionsProvider.getDimensions([imageSource]).then(function (loadedImages) {
                if (loadedImages.length === 1 && !loadedImages[0].invalid) {
                    section.style.backgroundImage = "url( " + imageSource + " )";
                    section.style.backgroundRepeat = "no-repeat";
                    if (isCover === true) {
                        section.style.backgroundSize = "cover";
                        _this.backgroundImageSizeChangedCallback(Editor.DetailsViewConstants.coverDropdownOption);
                    }
                    else if (isCover === false) {
                        section.style.removeProperty("background-size");
                        _this.backgroundImageSizeChangedCallback(Editor.DetailsViewConstants.fullSizeDropdownOption);
                    }
                    if (!Utility.isNullOrUndefined(horizontalAlignment) &&
                        !Utility.isNullOrUndefined(verticalAlignment)) {
                        section.style.backgroundPosition = horizontalAlignment + " " + verticalAlignment;
                        _this.backgroundImageHorizontalAlignmentChangedCallback(horizontalAlignment);
                        _this.backgroundImageVerticalAlignmentChangedCallback(verticalAlignment);
                    }
                    else {
                        section.style.backgroundPosition = _this.center + " " + _this.center;
                        _this.backgroundImageHorizontalAlignmentChangedCallback(_this.center);
                        _this.backgroundImageVerticalAlignmentChangedCallback(_this.center);
                    }
                    _this.notifyAboutChanges();
                }
            });
        };
        ColumnStylesDetailsViewModel.prototype.notifyAboutChanges = function () {
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ColumnStylesDetailsViewModel.prototype.getBackgroundImage = function (section) {
            var backgroundImage = section.style.backgroundImage;
            if (!Utility.isNullOrUndefined(backgroundImage) && backgroundImage !== "") {
                backgroundImage = backgroundImage.replace("url(\"", "");
                backgroundImage = backgroundImage.substr(0, backgroundImage.length - 2);
                return backgroundImage;
            }
            return undefined;
        };
        ColumnStylesDetailsViewModel.prototype.getBackgroundImageSize = function (section) {
            var imageSize = section.style.backgroundSize.toUpperCase();
            if (imageSize === "COVER") {
                return Editor.DetailsViewConstants.coverDropdownOption;
            }
            else if (imageSize === "INITIAL" || imageSize.length === 0) {
                return Editor.DetailsViewConstants.fullSizeDropdownOption;
            }
            return undefined;
        };
        ColumnStylesDetailsViewModel.prototype.getBackgroundImageHorizontalAlignment = function (section) {
            var horizontalPosition = section.style.backgroundPositionX;
            if (Utility.isNullOrUndefined(horizontalPosition)) {
                return undefined;
            }
            return horizontalPosition;
        };
        ColumnStylesDetailsViewModel.prototype.getBackgroundImageVerticalAlignment = function (section) {
            var verticalPosition = section.style.backgroundPositionY;
            if (Utility.isNullOrUndefined(verticalPosition)) {
                return undefined;
            }
            return verticalPosition;
        };
        ColumnStylesDetailsViewModel.prototype.getMaxBorderRadius = function (section) {
            var maxBorderRadius = 500;
            var height = section.offsetHeight;
            var width = section.offsetWidth;
            if (Utility.isNullOrUndefined(height) || Utility.isNullOrUndefined(width)) {
                return maxBorderRadius;
            }
            return Math.ceil(Math.min(height / 2, width / 2));
        };
        ColumnStylesDetailsViewModel.prototype.onBackgroundImageSizeChanged = function (callback) {
            this.backgroundImageSizeChangedCallback = callback;
        };
        ColumnStylesDetailsViewModel.prototype.onBackgroundImageHorizontalAlignmentChanged = function (callback) {
            this.backgroundImageHorizontalAlignmentChangedCallback = callback;
        };
        ColumnStylesDetailsViewModel.prototype.onBackgroundImageVerticalAlignmentChanged = function (callback) {
            this.backgroundImageVerticalAlignmentChangedCallback = callback;
        };
        ColumnStylesDetailsViewModel.prototype.getValue = function (value, minValue) {
            var newValue = value;
            if (Utility.isNullOrUndefined(value) || value === "") {
                newValue = "" + minValue;
            }
            else {
                newValue = newValue.replace("px", "").replace("!mportant", "");
            }
            return newValue;
        };
        ColumnStylesDetailsViewModel.prototype.onFieldUpdated = function (selectedBlock, inputElement, marginType, from, to) {
            var val = parseInt(inputElement.value);
            if (val > to || val < from) {
                val = from;
                inputElement.value = val.toString();
            }
            selectedBlock.style[marginType] = val + "px";
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, // same as above.
            new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ColumnStylesDetailsViewModel.prototype.onReactValidate = function (val, element, cssPropertyName) {
            var _this = this;
            element.style[cssPropertyName] = val;
            this.spinButtonDebounce(function () {
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(_this.containerId));
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(_this.containerId));
            }, Editor.DetailsViewConstants.spinButtonDebounceTime);
        };
        ColumnStylesDetailsViewModel.prototype.onReactBorderWidthValidate = function (value, element) {
            this.setBorderStyleOnWidthChange(element, value.replace("px", ""));
            this.onReactValidate(value, element, Editor.DetailsViewConstants.borderWidthAttribute);
        };
        ColumnStylesDetailsViewModel.prototype.spinButtonDebounce = function (func, wait) {
            var later = function () {
                this.spinButtonDebounceTimeout = null;
                func.apply(this, arguments);
            };
            clearTimeout(this.spinButtonDebounceTimeout);
            this.spinButtonDebounceTimeout = setTimeout(later.bind(this), wait);
        };
        ColumnStylesDetailsViewModel.prototype.setBorderStyleOnWidthChange = function (element, borderWidth) {
            var borderStyle = this.getBorderStyle(element);
            var borderColor = element.style.borderColor;
            if (borderWidth.match(Editor.InputValidationsConstants.validatePositiveIntNumbers)
                && borderStyle === Editor.DetailsViewConstants.borderStyleNone) {
                element.style.borderStyle = Editor.DetailsViewConstants.borderStyleSolid;
                this.columnStylesDetailsView.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleSolid);
                if (Utility.isNullOrUndefined(borderColor) || borderColor === "") {
                    this.setDefaultBorderColor(element);
                }
            }
            else if (borderWidth === "0" && borderStyle !== Editor.DetailsViewConstants.borderStyleNone) {
                element.style.borderStyle = Editor.DetailsViewConstants.borderStyleNone;
                this.columnStylesDetailsView.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleNone);
            }
        };
        ColumnStylesDetailsViewModel.prototype.setDefaultBorderColor = function (section) {
            section.style.borderColor = Editor.ColorUtils.rgbToHex(this.defaultBorderColor);
        };
        return ColumnStylesDetailsViewModel;
    }());
    Editor.ColumnStylesDetailsViewModel = ColumnStylesDetailsViewModel;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var SectionStylesDetailsViewModel = /** @class */ (function () {
        function SectionStylesDetailsViewModel(detailsViewControl, imageDimensionsProvider, fcbList) {
            this.detailsViewControl = detailsViewControl;
            this.imageDimensionsProvider = imageDimensionsProvider;
            this.fcbList = fcbList;
            this.center = "center";
            this.limitOnMin = 0;
            this.limitOnMax = 500;
            this.defaultBorderColor = Editor.ColorUtils.black;
        }
        /**
         * @see IBlockDetailsView.init
         */
        SectionStylesDetailsViewModel.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.sectionStylesDetailsView = new Editor.SectionStylesDetailsViewRenderer(this.detailsViewControl, this, this.fcbList);
        };
        /**
         * @see IBlockDetailsView.dispose
         */
        SectionStylesDetailsViewModel.prototype.dispose = function () {
            this.detailsViewControl.dispose();
        };
        /**
         * @see IBlockDetailsView.init
         */
        SectionStylesDetailsViewModel.prototype.render = function (selectedBlock) {
            this.sectionStylesDetailsView.render(selectedBlock);
        };
        SectionStylesDetailsViewModel.prototype.getBgColor = function (section) {
            var value = section.style.backgroundColor;
            if (Utility.isNullOrUndefined(value)) {
                value = "";
            }
            return Editor.ColorUtils.rgbToHex(value);
        };
        SectionStylesDetailsViewModel.prototype.onBgColorFieldUpdated = function (selectedBlock, inputElement) {
            var color = Editor.ColorUtils.rgbToHex(inputElement.val());
            selectedBlock.style.backgroundColor = color;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        SectionStylesDetailsViewModel.prototype.getBorderColor = function (section) {
            var value = section.style.borderColor;
            value = Utility.isNullOrUndefined(value) || value === "" ? this.defaultBorderColor : value;
            return Editor.ColorUtils.rgbToHex(value);
        };
        SectionStylesDetailsViewModel.prototype.onBorderColorFieldUpdated = function (selectedBlock, inputElement) {
            var color = Editor.ColorUtils.rgbToHex(inputElement.val());
            selectedBlock.style.borderColor = color;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        SectionStylesDetailsViewModel.prototype.getBorderStyle = function (section) {
            var value = section.style.borderStyle;
            value = Utility.isNullOrUndefined(value) || value === "" ? Editor.DetailsViewConstants.borderStyleNone : value;
            return value.charAt(0).toUpperCase() + value.slice(1);
        };
        SectionStylesDetailsViewModel.prototype.onBorderStyleFieldUpdated = function (selectedBlock, inputElement) {
            var borderStyle = inputElement.val();
            var borderColor = selectedBlock.style.borderColor;
            if (borderStyle === Editor.DetailsViewConstants.borderStyleNone && selectedBlock.style.borderWidth !== "0px") {
                selectedBlock.style.borderWidth = "0px";
                this.sectionStylesDetailsView.borderWidthInput.val(0);
            }
            else if (borderStyle !== Editor.DetailsViewConstants.borderStyleNone &&
                (selectedBlock.style.borderWidth === "0px" || selectedBlock.style.borderWidth === "")) {
                selectedBlock.style.borderWidth = "1px";
                this.sectionStylesDetailsView.borderWidthInput.val(1);
                if (Utility.isNullOrUndefined(borderColor) || borderColor === "") {
                    this.setDefaultBorderColor(selectedBlock);
                }
            }
            selectedBlock.style.borderStyle = borderStyle;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        SectionStylesDetailsViewModel.prototype.getBorderWidth = function (section) {
            var value = section.style.borderWidth;
            value = Utility.isNullOrUndefined(value) ? "" : value;
            return value.replace("px", "");
        };
        SectionStylesDetailsViewModel.prototype.onBorderWidthFieldUpdated = function (selectedBlock, inputElement) {
            var width = inputElement.val();
            var borderStyle = this.getBorderStyle(selectedBlock);
            var borderColor = selectedBlock.style.borderColor;
            if (width !== "0" && borderStyle === Editor.DetailsViewConstants.borderStyleNone) {
                selectedBlock.style.borderStyle = Editor.DetailsViewConstants.borderStyleSolid;
                this.sectionStylesDetailsView.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleSolid);
                if (Utility.isNullOrUndefined(borderColor) || borderColor === "") {
                    this.setDefaultBorderColor(selectedBlock);
                }
            }
            else if (width === "0" && borderStyle !== Editor.DetailsViewConstants.borderStyleNone) {
                selectedBlock.style.borderStyle = Editor.DetailsViewConstants.borderStyleNone;
                this.sectionStylesDetailsView.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleNone);
            }
            selectedBlock.style.borderWidth = width + "px";
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        SectionStylesDetailsViewModel.prototype.onReactBorderWidthValidate = function (value, element) {
            this.setBorderStyleOnWidthChange(element, value.replace("px", ""));
            this.onReactValidate(value, element, Editor.DetailsViewConstants.borderWidthAttribute);
        };
        SectionStylesDetailsViewModel.prototype.getBorderRadius = function (section) {
            var value = section.style.borderRadius;
            value = Utility.isNullOrUndefined(value) ? "" : value;
            return value.replace("px", "");
        };
        SectionStylesDetailsViewModel.prototype.onBorderRadiusFieldUpdated = function (selectedBlock, inputElement) {
            var width = inputElement.val();
            selectedBlock.style.borderRadius = width + "px";
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        SectionStylesDetailsViewModel.prototype.getMaxBorderRadius = function (section) {
            var maxBorderRadius = 500;
            var height = section.offsetHeight;
            var width = section.offsetWidth;
            if (Utility.isNullOrUndefined(height) || Utility.isNullOrUndefined(width)) {
                return maxBorderRadius;
            }
            return Math.ceil(Math.min(height / 2, width / 2));
        };
        SectionStylesDetailsViewModel.prototype.getMaxWidth = function (section, limit) {
            var value = section.style[Editor.DetailsViewConstants.maxWidthAttribute];
            value = this.getValue(value, limit);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onMaxWidthFieldUpdated = function (selectedBlock, inputElement, limitOnMinWidth, limitOnMaxWidth) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.maxWidthAttribute, limitOnMinWidth, limitOnMaxWidth);
        };
        SectionStylesDetailsViewModel.prototype.getMinHeight = function (section) {
            var value = section.style[Editor.DetailsViewConstants.minHeightAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onMinHeightFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.minHeightAttribute, this.limitOnMin);
        };
        SectionStylesDetailsViewModel.prototype.getPaddingTop = function (section) {
            var value = section.style[Editor.DetailsViewConstants.paddingTopAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onPaddingTopFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.paddingTopAttribute, this.limitOnMin, this.limitOnMax);
        };
        SectionStylesDetailsViewModel.prototype.getPaddingBottom = function (section) {
            var value = section.style[Editor.DetailsViewConstants.paddingBottomAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onPaddingBottomFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.paddingBottomAttribute, this.limitOnMin, this.limitOnMax);
        };
        SectionStylesDetailsViewModel.prototype.getPaddingLeft = function (section) {
            var value = section.style[Editor.DetailsViewConstants.paddingLeftAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onPaddingLeftFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.paddingLeftAttribute, this.limitOnMin, this.limitOnMax);
        };
        SectionStylesDetailsViewModel.prototype.getPaddingRight = function (section) {
            var value = section.style[Editor.DetailsViewConstants.paddingRightAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onPaddingRightFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.paddingRightAttribute, this.limitOnMin, this.limitOnMax);
        };
        SectionStylesDetailsViewModel.prototype.getMarginTop = function (section) {
            var value = section.style[Editor.DetailsViewConstants.marginTopAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onMarginTopFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.marginTopAttribute, this.limitOnMin, this.limitOnMax);
            this.updateBackgroundImage(selectedBlock);
        };
        SectionStylesDetailsViewModel.prototype.getMarginBottom = function (section) {
            var value = section.style[Editor.DetailsViewConstants.marginBottomAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onMarginBottomFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.marginBottomAttribute, this.limitOnMin, this.limitOnMax);
            this.updateBackgroundImage(selectedBlock);
        };
        SectionStylesDetailsViewModel.prototype.getMarginLeft = function (section) {
            var value = section.style[Editor.DetailsViewConstants.marginLeftAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onMarginLeftFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.marginLeftAttribute, this.limitOnMin, this.limitOnMax);
            this.updateBackgroundImage(selectedBlock);
        };
        SectionStylesDetailsViewModel.prototype.getMarginRight = function (section) {
            var value = section.style[Editor.DetailsViewConstants.marginRightAttribute];
            value = this.getValue(value, this.limitOnMin);
            return value;
        };
        SectionStylesDetailsViewModel.prototype.onMarginRightFieldUpdated = function (selectedBlock, inputElement) {
            this.onFieldUpdated(selectedBlock, inputElement, Editor.DetailsViewConstants.marginRightAttribute, this.limitOnMin, this.limitOnMax);
            this.updateBackgroundImage(selectedBlock);
        };
        SectionStylesDetailsViewModel.prototype.onBackgroundImageUpdated = function (section, imageSource) {
            if (Utility.isNullOrUndefined(imageSource) || imageSource === "") {
                section.style.removeProperty("background-image");
                section.style.removeProperty("background-repeat");
                section.style.removeProperty("background-size");
                section.style.removeProperty("background-position");
                this.notifyAboutChanges();
            }
            else {
                this.setBackgroundImage(section, imageSource, true, this.center, this.center);
            }
        };
        SectionStylesDetailsViewModel.prototype.onBackgroundImageSizeUpdated = function (section, dropdown) {
            var value = dropdown.value;
            var backgroundImage = this.getBackgroundImage(section);
            switch (value) {
                case Editor.DetailsViewConstants.fullSizeDropdownOption:
                    this.setBackgroundImage(section, backgroundImage, false, this.center, this.center);
                    break;
                case Editor.DetailsViewConstants.coverDropdownOption:
                    this.setBackgroundImage(section, backgroundImage, true, this.center, this.center);
                    break;
                default:
                    break;
            }
        };
        SectionStylesDetailsViewModel.prototype.onBackgroundImageHorizontalAlignmentUpdated = function (section, dropdown) {
            var value = dropdown.value;
            var backgroundImage = this.getBackgroundImage(section);
            var imageSize = this.getBackgroundImageSize(section);
            var isCover = imageSize === undefined ? undefined : imageSize === "Cover" ? true : false;
            var verticalAlignment = this.getBackgroundImageVerticalAlignment(section);
            this.setBackgroundImage(section, backgroundImage, isCover, value, verticalAlignment);
        };
        SectionStylesDetailsViewModel.prototype.onBackgroundImageVerticalAlignmentUpdated = function (section, dropdown) {
            var value = dropdown.value;
            var backgroundImage = this.getBackgroundImage(section);
            var imageSize = this.getBackgroundImageSize(section);
            var isCover = imageSize === undefined
                ? undefined
                : imageSize === Editor.DetailsViewConstants.coverDropdownOption
                    ? true
                    : false;
            var horizontalAlignment = this.getBackgroundImageHorizontalAlignment(section);
            this.setBackgroundImage(section, backgroundImage, isCover, horizontalAlignment, value);
        };
        SectionStylesDetailsViewModel.prototype.setBorderStyleOnWidthChange = function (element, borderWidth) {
            var borderStyle = this.getBorderStyle(element);
            var borderColor = element.style.borderColor;
            if (borderWidth.match(Editor.InputValidationsConstants.validatePositiveIntNumbers)
                && borderStyle === Editor.DetailsViewConstants.borderStyleNone) {
                element.style.borderStyle = Editor.DetailsViewConstants.borderStyleSolid;
                this.sectionStylesDetailsView.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleSolid);
                if (Utility.isNullOrUndefined(borderColor) || borderColor === "") {
                    this.setDefaultBorderColor(element);
                }
            }
            else if (borderWidth === "0" && borderStyle !== Editor.DetailsViewConstants.borderStyleNone) {
                element.style.borderStyle = Editor.DetailsViewConstants.borderStyleNone;
                this.sectionStylesDetailsView.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleNone);
            }
        };
        SectionStylesDetailsViewModel.prototype.updateBackgroundImage = function (section) {
            if (!Utility.isNullOrUndefined(section.style.backgroundImage)) {
                var imageSource = this.getBackgroundImage(section);
                var imageSize = this.getBackgroundImageSize(section);
                var isCover = imageSize === undefined
                    ? undefined
                    : imageSize === Editor.DetailsViewConstants.coverDropdownOption
                        ? true
                        : false;
                var horizontalAlignment = this.getBackgroundImageHorizontalAlignment(section);
                var verticalAlignment = this.getBackgroundImageVerticalAlignment(section);
                return this.setBackgroundImage(section, imageSource, isCover, horizontalAlignment, verticalAlignment);
            }
            return Promise.resolve();
        };
        SectionStylesDetailsViewModel.prototype.setBackgroundImage = function (section, imageSource, isCover, horizontalAlignment, verticalAlignment) {
            return __awaiter(this, void 0, void 0, function () {
                var loadedImages;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, this.imageDimensionsProvider.getDimensions([imageSource])];
                        case 1:
                            loadedImages = _a.sent();
                            if (loadedImages.length === 1 && !loadedImages[0].invalid) {
                                section.style.backgroundImage = "url( " + imageSource + " )";
                                section.style.backgroundRepeat = "no-repeat";
                                if (isCover === true) {
                                    section.style.backgroundSize = "cover";
                                    this.backgroundImageSizeChangedCallback(Editor.DetailsViewConstants.coverDropdownOption);
                                }
                                else if (isCover === false) {
                                    section.style.removeProperty("background-size");
                                    this.backgroundImageSizeChangedCallback(Editor.DetailsViewConstants.fullSizeDropdownOption);
                                }
                                if (!Utility.isNullOrUndefined(horizontalAlignment) &&
                                    !Utility.isNullOrUndefined(verticalAlignment)) {
                                    section.style.backgroundPosition = horizontalAlignment + " " + verticalAlignment;
                                    this.backgroundImageHorizontalAlignmentChangedCallback(horizontalAlignment);
                                    this.backgroundImageVerticalAlignmentChangedCallback(verticalAlignment);
                                }
                                else {
                                    section.style.backgroundPosition = this.center + " " + this.center;
                                    this.backgroundImageHorizontalAlignmentChangedCallback(this.center);
                                    this.backgroundImageVerticalAlignmentChangedCallback(this.center);
                                }
                                this.notifyAboutChanges();
                            }
                            return [2 /*return*/];
                    }
                });
            });
        };
        SectionStylesDetailsViewModel.prototype.notifyAboutChanges = function () {
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        SectionStylesDetailsViewModel.prototype.getBackgroundImage = function (section) {
            var backgroundImage = section.style.backgroundImage;
            if (!Utility.isNullOrUndefined(backgroundImage) && backgroundImage !== "") {
                backgroundImage = backgroundImage.replace("url(\"", "");
                backgroundImage = backgroundImage.substr(0, backgroundImage.length - 2);
                return backgroundImage;
            }
            return undefined;
        };
        SectionStylesDetailsViewModel.prototype.getBackgroundImageSize = function (section) {
            var imageSize = section.style.backgroundSize.toUpperCase();
            if (imageSize === "COVER") {
                return Editor.DetailsViewConstants.coverDropdownOption;
            }
            else if (imageSize === "INITIAL" || imageSize.length === 0) {
                return Editor.DetailsViewConstants.fullSizeDropdownOption;
            }
            return undefined;
        };
        SectionStylesDetailsViewModel.prototype.getBackgroundImageHorizontalAlignment = function (section) {
            var horizontalPosition = section.style.backgroundPositionX;
            if (Utility.isNullOrUndefined(horizontalPosition)) {
                return undefined;
            }
            return horizontalPosition;
        };
        SectionStylesDetailsViewModel.prototype.getBackgroundImageVerticalAlignment = function (section) {
            var verticalPosition = section.style.backgroundPositionY;
            if (Utility.isNullOrUndefined(verticalPosition)) {
                return undefined;
            }
            return verticalPosition;
        };
        SectionStylesDetailsViewModel.prototype.onBackgroundImageSizeChanged = function (callback) {
            this.backgroundImageSizeChangedCallback = callback;
        };
        SectionStylesDetailsViewModel.prototype.onBackgroundImageHorizontalAlignmentChanged = function (callback) {
            this.backgroundImageHorizontalAlignmentChangedCallback = callback;
        };
        SectionStylesDetailsViewModel.prototype.onBackgroundImageVerticalAlignmentChanged = function (callback) {
            this.backgroundImageVerticalAlignmentChangedCallback = callback;
        };
        SectionStylesDetailsViewModel.prototype.getValue = function (value, minValue) {
            var newValue = value;
            if (Utility.isNullOrUndefined(value) || value === "") {
                newValue = "" + minValue;
            }
            else {
                newValue = newValue.replace("px", "").replace("!mportant", "");
            }
            return newValue;
        };
        SectionStylesDetailsViewModel.prototype.onFieldUpdated = function (selectedBlock, inputElement, marginType, from, to) {
            var val = parseInt(inputElement.value);
            if ((!Utility.isNullOrUndefined(to) && val > to) || val < from) {
                val = from;
                inputElement.value = val.toString();
            }
            selectedBlock.style[marginType] = val + "px";
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        SectionStylesDetailsViewModel.prototype.onReactValidate = function (val, element, cssPropertyName) {
            var _this = this;
            element.style[cssPropertyName] = val;
            this.spinButtonDebounce(function () {
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(_this.containerId));
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(_this.containerId));
            }, Editor.DetailsViewConstants.spinButtonDebounceTime);
        };
        SectionStylesDetailsViewModel.prototype.spinButtonDebounce = function (func, wait) {
            var later = function () {
                this.spinButtonDebounceTimeout = null;
                func.apply(this, arguments);
            };
            clearTimeout(this.spinButtonDebounceTimeout);
            this.spinButtonDebounceTimeout = setTimeout(later.bind(this), wait);
        };
        SectionStylesDetailsViewModel.prototype.setDefaultBorderColor = function (section) {
            section.style.borderColor = Editor.ColorUtils.rgbToHex(this.defaultBorderColor);
        };
        return SectionStylesDetailsViewModel;
    }());
    Editor.SectionStylesDetailsViewModel = SectionStylesDetailsViewModel;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Button Details View
     */
    var ColumnDetailsViewFactory = /** @class */ (function () {
        function ColumnDetailsViewFactory() {
        }
        ColumnDetailsViewFactory.prototype.create = function (detailsViewControl, imageNativeDimensionsProvider) {
            var columnStylesDetailsView = new Editor.ColumnStylesDetailsViewModel(detailsViewControl, imageNativeDimensionsProvider);
            return new Editor.ColumnDetailsView(columnStylesDetailsView, detailsViewControl);
        };
        return ColumnDetailsViewFactory;
    }());
    Editor.ColumnDetailsViewFactory = ColumnDetailsViewFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Button Details View
     */
    var SectionDetailsViewFactory = /** @class */ (function () {
        function SectionDetailsViewFactory() {
        }
        SectionDetailsViewFactory.prototype.create = function (detailsViewControl, imageNativeDimensionsProvider, fcbList, showCustomColumnsOption) {
            var sectionStylesDetailsView = new Editor.SectionStylesDetailsViewModel(detailsViewControl, imageNativeDimensionsProvider, fcbList);
            return new Editor.SectionDetailsView(sectionStylesDetailsView, detailsViewControl, fcbList, showCustomColumnsOption);
        };
        return SectionDetailsViewFactory;
    }());
    Editor.SectionDetailsViewFactory = SectionDetailsViewFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var ButtonStylesDetailsViewRenderer = /** @class */ (function () {
        function ButtonStylesDetailsViewRenderer(detailsViewControl) {
            this.detailsViewControl = detailsViewControl;
            this.limitOnMin = 0;
            this.limitOnMax = 500;
            this.limitOnMaxBoderWidth = 50;
            this.limitOnMaxBoderRadius = 500;
            this.defaultBorderColor = Editor.ColorUtils.black;
            this.borderStyleInput = null;
            this.borderWidthInput = null;
            // The IDs should be unchanged to be able to restore keyboard focus after rerendering(rebuilding DOM).
            this.buttonBackgroundColorInputId = UniqueId.generate(Editor.DetailsViewConstants.buttonBackgroundColorInputCssClass);
            this.buttonTextColorInputId = UniqueId.generate(Editor.DetailsViewConstants.buttonTextColorInputCssClass);
        }
        /**
         * @see IBlockDetailsView.init
         */
        ButtonStylesDetailsViewRenderer.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
        };
        /**
         * @see IBlockDetailsView.dispose
         */
        ButtonStylesDetailsViewRenderer.prototype.dispose = function () {
            this.detailsViewControl.dispose();
        };
        /**
         * @see IBlockDetailsView.init
         */
        ButtonStylesDetailsViewRenderer.prototype.render = function (selectedBlock) {
            var _this = this;
            var stylesSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.stylesSectionTitle));
            this.detailsViewControl.createInputColorField(stylesSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.buttonBackgroundColorLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.buttonBackgroundColorInputCssClass, this.getBackgroundColor(selectedBlock), {
                id: this.buttonBackgroundColorInputId,
                placeholder: "#FFFFFF"
            }, function (inputField) {
                _this.onBackgroundColorFieldUpdated(selectedBlock, inputField);
            });
            this.detailsViewControl.createInputColorField(stylesSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.buttonTextColorLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.buttonTextColorInputCssClass, this.getTextColor(selectedBlock), {
                id: this.buttonTextColorInputId,
                placeholder: "#000000"
            }, function (inputField) {
                _this.onTextColorFieldUpdated(selectedBlock, inputField);
            });
            this.detailsViewControl.createDropdownList(stylesSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.buttonAlignmentLabel), new Dictionary({
                Left: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.leftAlignmentLabel),
                Center: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.centerAlignmentLabel),
                Right: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.rightAlignmentLabel)
            }), Editor.DetailsViewConstants.buttonAlignmentDropDownCssClass, this.getButtonAlignment(selectedBlock), function (dropdownList) {
                _this.onButtonAlignmentUpdated(selectedBlock, dropdownList);
            });
            this.addBorderConfig(stylesSection, selectedBlock[0]);
            var sizeSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.sizeSectionTitle));
            this.detailsViewControl.createInputField(sizeSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.buttonWidthLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.buttonWidthInputCssClass, this.getButtonWidth(selectedBlock), {
                min: "0",
                max: "3840",
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.buttonWidthInputCssClass)
            }, function (inputField) {
                _this.onWidthFieldUpdated(selectedBlock, inputField);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val, event) {
                _this.onReactValidate(val, selectedBlock.find("a")[0], [Editor.DetailsViewConstants.widthAttribute]);
            }, Editor.DetailsViewConstants.pixels);
            this.detailsViewControl.createInputField(sizeSection, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.buttonHeightLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.buttonHeightInputCssClass, this.getButtonHeight(selectedBlock), {
                min: "0",
                max: "3840",
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                required: "required",
                role: "spinbutton",
                id: UniqueId.generate(Editor.DetailsViewConstants.buttonHeightInputCssClass)
            }, function (inputField) {
                _this.onHeightFieldUpdated(selectedBlock, inputField);
            }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val, event) {
                _this.onReactValidate(val, selectedBlock.find("a")[0], [Editor.DetailsViewConstants.heightAttribute, Editor.DetailsViewConstants.lineHeightAttribute]);
            }, Editor.DetailsViewConstants.pixels);
            this.addPosition(selectedBlock);
        };
        ButtonStylesDetailsViewRenderer.prototype.addPosition = function (selectedBlock) {
            Editor.DetailsViewPropertiesUtils.eventBroker = this.eventBroker;
            Editor.DetailsViewPropertiesUtils.containerId = this.containerId;
            var section = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.spacingTitle));
            section.find("." + Editor.DetailsViewConstants.sectionContentClassName)
                .addClass(Editor.DetailsViewConstants.inputColumnsLayout);
            Editor.DetailsViewPropertiesUtils.addPaddingSubsection(this.detailsViewControl, selectedBlock, section, this.notifyChanges, this.limitOnMin, this.limitOnMax);
            Editor.DetailsViewPropertiesUtils.addMarginSubsection(this.detailsViewControl, selectedBlock, section, this.notifyChanges, this.limitOnMin, this.limitOnMax);
        };
        ButtonStylesDetailsViewRenderer.prototype.notifyChanges = function (eventBroker, containerId, selectedBlock) {
            eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(containerId, selectedBlock));
        };
        ButtonStylesDetailsViewRenderer.prototype.addBorderConfig = function (section, selectedBlock) {
            var _this = this;
            this.borderStyleInput = this.detailsViewControl
                .createDropdownList(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleLabel), new Dictionary({
                None: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleNoneLabel),
                Solid: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleSolidLabel),
                Dotted: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleDottedLabel),
                Dashed: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleDashedLabel),
                Double: Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderStyleDoubleLabel)
            }), Editor.DetailsViewConstants.borderStyleInputCssClass, this.getBorderStyle(selectedBlock), function (inputField) {
                _this.onBorderStyleFieldUpdated(selectedBlock, inputField);
            })
                .find("select")
                .first();
            this.borderWidthInput = this.detailsViewControl
                .createInputField(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderWidthLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.borderWidthInputCssClass, this.getBorderWidth(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderWidthInputCssClass),
                min: this.limitOnMin,
                max: this.limitOnMaxBoderWidth,
                role: "spinbutton"
            }, function () { }, Editor.InputValidationsConstants.positiveIntAllowEmpty, function (value) {
                _this.onBorderWidthFieldUpdated(selectedBlock, value);
            })
                .find("input")
                .first();
            this.detailsViewControl.createInputColorField(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderColorLabel), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.borderColorInputCssClass, this.getBorderColor(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderColorInputCssClass),
                placeholder: "#000000"
            }, function (inputField) {
                _this.onBorderColorFieldUpdated(selectedBlock, inputField);
            });
            this.detailsViewControl.createRange(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.borderRadiusLabel), this.limitOnMin, this.getMaxBorderRadius(selectedBlock), Editor.DetailsViewConstants.borderRadiusInputCssClass, this.getBorderRadius(selectedBlock), {
                id: UniqueId.generate(Editor.DetailsViewConstants.borderRadiusInputCssClass)
            }, function (inputField) {
                _this.onBorderRadiusFieldUpdated(selectedBlock, inputField);
            });
        };
        ButtonStylesDetailsViewRenderer.prototype.getAnchor = function (block) {
            return block.find(Editor.DetailsViewConstants.anchorTag);
        };
        ButtonStylesDetailsViewRenderer.prototype.getBackgroundColor = function (block) {
            var value = this.getAnchor(block).css(Editor.DetailsViewConstants.backgroundColorAttribute);
            if (Utility.isNullOrUndefined(value)) {
                value = String.Empty;
            }
            return Editor.ColorUtils.rgbToHex(value);
        };
        ButtonStylesDetailsViewRenderer.prototype.onBackgroundColorFieldUpdated = function (selectedBlock, inputElement) {
            var color = inputElement.val();
            var anchor = this.getAnchor(selectedBlock);
            anchor.css(Editor.DetailsViewConstants.backgroundColorAttribute, color);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(this.containerId, selectedBlock));
        };
        ButtonStylesDetailsViewRenderer.prototype.getTextColor = function (block) {
            var value = this.getAnchor(block).css(Editor.DetailsViewConstants.textColorAttribute);
            if (Utility.isNullOrUndefined(value)) {
                value = String.Empty;
            }
            return Editor.ColorUtils.rgbToHex(value);
        };
        ButtonStylesDetailsViewRenderer.prototype.onTextColorFieldUpdated = function (selectedBlock, inputElement) {
            var color = inputElement.val();
            var anchor = this.getAnchor(selectedBlock);
            anchor.css(Editor.DetailsViewConstants.textColorAttribute, color);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(this.containerId, selectedBlock));
        };
        ButtonStylesDetailsViewRenderer.prototype.getButtonAlignment = function (block) {
            // Gets styles using JS, because JQuery returns values in pixels.
            var anchorElement = this.getAnchor(block).get(0);
            if (!Utility.isNullOrUndefined(anchorElement)) {
                var marginLeftValue = anchorElement.style.marginLeft;
                var marginRightValue = anchorElement.style.marginRight;
                if (marginLeftValue === "0px" && marginRightValue === "auto") {
                    return "Left";
                }
                if (marginLeftValue === "auto" && marginRightValue === "0px") {
                    return "Right";
                }
                if (marginLeftValue === "auto" && marginRightValue === "auto") {
                    return "Center";
                }
            }
            return String.Empty;
        };
        ButtonStylesDetailsViewRenderer.prototype.onButtonAlignmentUpdated = function (selectedBlock, dropdownList) {
            var alignment = dropdownList.val();
            var anchor = this.getAnchor(selectedBlock);
            switch (alignment) {
                case "Left":
                    anchor.css(Editor.DetailsViewConstants.marginLeftAttribute, "0px");
                    anchor.css(Editor.DetailsViewConstants.marginRightAttribute, "auto");
                    break;
                case "Right":
                    anchor.css(Editor.DetailsViewConstants.marginLeftAttribute, "auto");
                    anchor.css(Editor.DetailsViewConstants.marginRightAttribute, "0px");
                    break;
                case "Center":
                    anchor.css(Editor.DetailsViewConstants.marginLeftAttribute, "auto");
                    anchor.css(Editor.DetailsViewConstants.marginRightAttribute, "auto");
                    break;
                default:
                    break;
            }
            this.getUnconfiguredOverlay(selectedBlock).attr(Editor.DetailsViewConstants.alignAttribute, alignment);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(this.containerId, selectedBlock));
        };
        ButtonStylesDetailsViewRenderer.prototype.getButtonWidth = function ($block) {
            var button = this.getAnchor($block);
            return button.width().toString();
        };
        ButtonStylesDetailsViewRenderer.prototype.onWidthFieldUpdated = function (selectedBlock, inputElement) {
            var width = inputElement.val();
            if (Utility.isNullOrUndefined(width) || width < 1) {
                width = String.Empty;
            }
            this.getAnchor(selectedBlock).width(width);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(this.containerId, selectedBlock));
        };
        ButtonStylesDetailsViewRenderer.prototype.getButtonHeight = function ($block) {
            var button = this.getAnchor($block);
            var buttonHeight = button.height().toString();
            var blockHeight = $block.height().toString();
            var buttonHref = button.attr("href");
            var isButtonConfigured = buttonHref && buttonHref !== "#";
            return (buttonHeight === "0" && !isButtonConfigured) ? blockHeight : buttonHeight;
        };
        ButtonStylesDetailsViewRenderer.prototype.onHeightFieldUpdated = function (selectedBlock, inputElement) {
            var height = inputElement.val();
            if (Utility.isNullOrUndefined(height) || height < 1) {
                height = String.Empty;
            }
            // Used the line-height for the centered text vertically
            this.getAnchor(selectedBlock).css(Editor.DetailsViewConstants.lineHeightAttribute, height + "px");
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(this.containerId, selectedBlock));
        };
        ButtonStylesDetailsViewRenderer.prototype.getUnconfiguredOverlay = function (selectedBlock) {
            return selectedBlock.find("." + Editor.CommonConstants.designerUnconfiguredContentOverlayCssClassName);
        };
        ButtonStylesDetailsViewRenderer.prototype.onReactValidate = function (val, element, cssPropertyNames) {
            var _this = this;
            cssPropertyNames.forEach(function (property) { element.style[property] = val; });
            this.spinButtonDebounce(function () {
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.BlockChangedEventArgs(_this.containerId, $(element)));
            }, Editor.DetailsViewConstants.spinButtonDebounceTime);
        };
        ButtonStylesDetailsViewRenderer.prototype.spinButtonDebounce = function (func, wait) {
            var later = function () {
                this.spinButtonDebounceTimeout = null;
                func.apply(this, arguments);
            };
            clearTimeout(this.spinButtonDebounceTimeout);
            this.spinButtonDebounceTimeout = setTimeout(later.bind(this), wait);
        };
        ButtonStylesDetailsViewRenderer.prototype.onBorderColorFieldUpdated = function (selectedBlock, inputElement) {
            var color = Editor.ColorUtils.rgbToHex(inputElement.val());
            selectedBlock.querySelector("a").style.borderColor = color;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ButtonStylesDetailsViewRenderer.prototype.getBorderColor = function (selectedBlock) {
            var value = selectedBlock.querySelector("a").style.borderColor;
            value = Utility.isNullOrUndefined(value) || value === "" ? this.defaultBorderColor : value;
            return Editor.ColorUtils.rgbToHex(value);
        };
        ButtonStylesDetailsViewRenderer.prototype.onBorderStyleFieldUpdated = function (selectedBlock, inputElement) {
            var borderStyle = inputElement.val();
            var borderColor = selectedBlock.querySelector("a").style.borderColor;
            if (borderStyle === Editor.DetailsViewConstants.borderStyleNone && selectedBlock.querySelector("a").style.borderWidth !== "0px") {
                selectedBlock.querySelector("a").style.borderWidth = "0px";
                this.borderWidthInput.val(0);
            }
            else if (borderStyle !== Editor.DetailsViewConstants.borderStyleNone &&
                (selectedBlock.querySelector("a").style.borderWidth === "0px" || selectedBlock.querySelector("a").style.borderWidth === "")) {
                selectedBlock.querySelector("a").style.borderWidth = "1px";
                this.borderWidthInput.val(1);
                if (Utility.isNullOrUndefined(borderColor) || borderColor === "") {
                    this.setDefaultBorderColor(selectedBlock);
                }
            }
            selectedBlock.querySelector("a").style.borderStyle = borderStyle;
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ButtonStylesDetailsViewRenderer.prototype.setDefaultBorderColor = function (section) {
            section.querySelector("a").style.borderColor = Editor.ColorUtils.rgbToHex(this.defaultBorderColor);
        };
        ButtonStylesDetailsViewRenderer.prototype.getMaxBorderRadius = function (selectedBlock) {
            var height = selectedBlock.querySelector("a").offsetHeight;
            var width = selectedBlock.querySelector("a").offsetWidth;
            if (Utility.isNullOrUndefined(height) || Utility.isNullOrUndefined(width)) {
                return this.limitOnMaxBoderRadius;
            }
            return Math.ceil(Math.min(height / 2, width / 2));
        };
        ButtonStylesDetailsViewRenderer.prototype.getBorderRadius = function (selectedBlock) {
            var value = selectedBlock.querySelector("a").style.borderRadius;
            return Utility.isNullOrUndefined(value) ? "" : value.replace("px", "");
        };
        ButtonStylesDetailsViewRenderer.prototype.onBorderRadiusFieldUpdated = function (selectedBlock, inputElement) {
            selectedBlock.querySelector("a").style.borderRadius = inputElement.val() + "px";
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ButtonStylesDetailsViewRenderer.prototype.getBorderWidth = function (selectedBlock) {
            var value = selectedBlock.querySelector("a").style.borderWidth;
            return Utility.isNullOrUndefined(value) ? "" : value.replace("px", "");
        };
        ButtonStylesDetailsViewRenderer.prototype.onBorderWidthFieldUpdated = function (selectedBlock, width) {
            var borderStyle = this.getBorderStyle(selectedBlock);
            var borderColor = selectedBlock.querySelector("a").style.borderColor;
            if (width !== "0" && (borderStyle === Editor.DetailsViewConstants.borderStyleNone)) {
                selectedBlock.querySelector("a").style.borderStyle = Editor.DetailsViewConstants.borderStyleSolid;
                this.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleSolid);
                if (Utility.isNullOrUndefined(borderColor) || borderColor === "") {
                    this.setDefaultBorderColor(selectedBlock);
                }
            }
            else if (width === "0" && borderStyle !== Editor.DetailsViewConstants.borderStyleNone) {
                selectedBlock.querySelector("a").style.borderStyle = Editor.DetailsViewConstants.borderStyleNone;
                this.borderStyleInput.val(Editor.DetailsViewConstants.borderStyleNone);
            }
            selectedBlock.querySelector("a").style.borderWidth = width + "px";
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.sectionDecorationRequested, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged, new Editor.DesignerInternalContentChangedEventArgs(this.containerId));
        };
        ButtonStylesDetailsViewRenderer.prototype.getBorderStyle = function (selectedBlock) {
            var value = selectedBlock.querySelector("a").style.borderStyle;
            value = Utility.isNullOrUndefined(value) || value === "" ? Editor.DetailsViewConstants.borderStyleNone : value;
            return value.charAt(0).toUpperCase() + value.slice(1);
        };
        return ButtonStylesDetailsViewRenderer;
    }());
    Editor.ButtonStylesDetailsViewRenderer = ButtonStylesDetailsViewRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Button Details View
     */
    var ButtonDetailsViewFactory = /** @class */ (function () {
        function ButtonDetailsViewFactory() {
        }
        ButtonDetailsViewFactory.prototype.create = function (detailsViewControl) {
            var buttonCommonDetailsView = new Editor.ButtonStylesDetailsViewRenderer(detailsViewControl);
            return new Editor.ButtonDetailsView(Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.buttonToolLabel), buttonCommonDetailsView, detailsViewControl);
        };
        return ButtonDetailsViewFactory;
    }());
    Editor.ButtonDetailsViewFactory = ButtonDetailsViewFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DetailsViewHelper = /** @class */ (function () {
        function DetailsViewHelper() {
        }
        DetailsViewHelper.createProperty = function (label, input) {
            label.addClass(Editor.DetailsViewConstants.propertyNameCssClass).addClass(Editor.DetailsViewConstants.inputItemField);
            input.addClass(Editor.DetailsViewConstants.inputAttributeClassName);
            return DetailsViewHelper.createItemContainer()
                .append(label)
                .append(DetailsViewHelper.createItemField().append(input));
        };
        DetailsViewHelper.createItemContainer = function () {
            return $("<div>").addClass(Editor.DetailsViewConstants.inputControlContainerClassName);
        };
        DetailsViewHelper.createItemField = function () {
            return $("<div>").addClass(Editor.DetailsViewConstants.inputItemField);
        };
        return DetailsViewHelper;
    }());
    Editor.DetailsViewHelper = DetailsViewHelper;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    /**
     * Input Image Field Renderer Class
     */
    var InputBrowseImageFieldRenderer = /** @class */ (function () {
        function InputBrowseImageFieldRenderer(inputFieldRenderer, buttonRenderer, galleryButtonFactory, eventBroker) {
            this.inputFieldRenderer = inputFieldRenderer;
            this.buttonRenderer = buttonRenderer;
            this.galleryButtonFactory = galleryButtonFactory;
            this.eventBroker = eventBroker;
            this.galleryButtonDisposeDictionary = new Dictionary();
        }
        /**
         * Render the image field
         */
        InputBrowseImageFieldRenderer.prototype.render = function (label, type, className, value, attributes, onFieldUpdated, config) {
            var inputImageClassName = className + " " + Editor.DetailsViewConstants.inputImageCssClass;
            var inputField = this.inputFieldRenderer.render(label, type, inputImageClassName, value, attributes, onFieldUpdated, config);
            var inputItemField = inputField
                .find(Editor.CommonUtils.getClassSelector(Editor.DetailsViewConstants.inputItemField))
                .last();
            var noAssistEdit = !!config && !!config["no_assistedit"];
            this.renderImageGalleryButton(inputItemField, noAssistEdit);
            return inputField;
        };
        InputBrowseImageFieldRenderer.prototype.dispose = function () { };
        InputBrowseImageFieldRenderer.prototype.renderImageGalleryButton = function (inputItemField, isFirstButton) {
            var _this = this;
            var galleryPickerId = MktSvc.Controls.Common.UniqueId.generate();
            var imageSelectedHandler = function (eventArgs) {
                if (galleryPickerId === eventArgs.sourceId) {
                    _this.inputFieldRenderer.updateValue(eventArgs.imageUrl, inputItemField);
                    _this.cleanGalleryButton(galleryPickerId);
                }
            };
            // Create the gallery button
            var galleryButton = this.galleryButtonFactory.create(galleryPickerId);
            var buttonElement = this.buttonRenderer
                .renderButton(galleryButton)
                .addClass(Editor.DetailsViewConstants.imgGalleryCssClass)
                .appendTo(inputItemField)
                .on("click", function () {
                // Setup
                galleryButton.getCommand().setup(_this.eventBroker);
                var imageSelectedDelegate = _this.eventBroker.subscribe(MktSvcCommon.EventConstants.GalleryImageSelected, function (args) {
                    // Show jquery-ui dialog after closing image picker
                    _this.getActiveDialog().show();
                    imageSelectedHandler(args);
                });
                var galleryPopupClosedDelegate = _this.eventBroker.subscribe(MktSvcCommon.EventConstants.GalleryPopupClosed, function () {
                    // Show jquery-ui dialog after closing image picker
                    _this.getActiveDialog().show();
                });
                _this.galleryButtonDisposeDictionary.addOrUpdate(galleryPickerId, function () {
                    _this.eventBroker.unsubscribe(MktSvcCommon.EventConstants.GalleryImageSelected, imageSelectedDelegate);
                    _this.eventBroker.unsubscribe(MktSvcCommon.EventConstants.GalleryPopupClosed, galleryPopupClosedDelegate);
                    galleryButton.getCommand().dispose();
                });
                // Hide active jquery-ui dialog
                _this.getActiveDialog().hide();
                galleryButton.getCommand().exec(inputItemField, null, null, null);
                return false;
            });
            if (isFirstButton) {
                buttonElement.addClass(Editor.DetailsViewConstants.imgGalleryFirstButtonCssClass);
            }
            inputItemField.on("remove", function () {
                _this.cleanGalleryButton(galleryPickerId);
            });
            return buttonElement;
        };
        InputBrowseImageFieldRenderer.prototype.getActiveDialog = function () {
            return $("." + Editor.CommonConstants.popupCssClassName).add("." + Editor.CommonConstants.overlayCssClassName);
        };
        InputBrowseImageFieldRenderer.prototype.cleanGalleryButton = function (galleryPickerId) {
            if (this.galleryButtonDisposeDictionary.hasKey(galleryPickerId)) {
                this.galleryButtonDisposeDictionary.get(galleryPickerId)();
                this.galleryButtonDisposeDictionary.remove(galleryPickerId);
            }
        };
        return InputBrowseImageFieldRenderer;
    }());
    Editor.InputBrowseImageFieldRenderer = InputBrowseImageFieldRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Input Color Field Renderer Class
     */
    var LinkFieldRenderer = /** @class */ (function () {
        function LinkFieldRenderer(inputFieldRenderer) {
            this.inputFieldRenderer = inputFieldRenderer;
            this.linkValueUpdatedEventName = "linkValueUpdated";
        }
        /**
         * Setup the renderer
         */
        LinkFieldRenderer.prototype.setup = function (eventBroker) { };
        /**
         * Update the input value of the specified container
         */
        LinkFieldRenderer.prototype.updateValue = function (value, fieldContainer) {
            var input = fieldContainer.find(Editor.DetailsViewConstants.inputTag);
            if (input.length > 0) {
                input.val(value);
                input.trigger(this.linkValueUpdatedEventName);
            }
        };
        /**
         * Render the form section
         */
        LinkFieldRenderer.prototype.render = function (label, type, className, value, attributes, onFieldUpdated, config) {
            var inputField = this.inputFieldRenderer.render(label, type, className, value, attributes, onFieldUpdated);
            var initialValue = value;
            inputField.find(Editor.DetailsViewConstants.inputTag).on(this.linkValueUpdatedEventName, function (event) {
                // Call onFieldUpdated on input change
                var currentValue = $(event.target).val();
                if (initialValue !== currentValue) {
                    initialValue = currentValue;
                    if (onFieldUpdated) {
                        onFieldUpdated($(event.target));
                    }
                }
            });
            return inputField;
        };
        /**
         * Dispose the renderer
         */
        LinkFieldRenderer.prototype.dispose = function () { };
        return LinkFieldRenderer;
    }());
    Editor.LinkFieldRenderer = LinkFieldRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Input Image Field Renderer Class
     */
    var InputImageFieldRenderer = /** @class */ (function () {
        function InputImageFieldRenderer(inputFieldRenderer) {
            this.inputFieldRenderer = inputFieldRenderer;
        }
        InputImageFieldRenderer.prototype.setup = function (eventBroker) { };
        /**
         * Render the image field
         */
        InputImageFieldRenderer.prototype.render = function (label, type, className, value, attributes, onFieldUpdated) {
            return this.inputFieldRenderer.render(label, type, className, value, attributes, onFieldUpdated);
        };
        InputImageFieldRenderer.prototype.dispose = function () { };
        return InputImageFieldRenderer;
    }());
    Editor.InputImageFieldRenderer = InputImageFieldRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * Dropdown list Renderer Class
     */
    var DropdownListRenderer = /** @class */ (function () {
        function DropdownListRenderer() {
        }
        /**
         * Render the form section
         */
        DropdownListRenderer.prototype.render = function (label, options, className, value) {
            var dropdownContainer = $("<div>", { class: Editor.DetailsViewConstants.inputControlContainerClassName });
            var selectId = UniqueId.generate(className);
            this.renderDropdownLabel(dropdownContainer, label, className, selectId);
            this.renderDropdownList(dropdownContainer, options, className, value, selectId);
            return dropdownContainer;
        };
        DropdownListRenderer.prototype.renderDropdownLabel = function (dropdownContainer, label, inputCssClass, selectId) {
            var $label = $("<label>", {
                class: Editor.DetailsViewConstants.inputItemField + " " + Editor.DetailsViewConstants.propertyNameCssClass,
                for: selectId
            }).text(label);
            dropdownContainer.append($label);
        };
        DropdownListRenderer.prototype.renderDropdownList = function (dropdownContainer, options, className, value, id) {
            var $select = $("<select />");
            $select.attr("id", id);
            $select.addClass(Editor.DetailsViewConstants.inputAttributeClassName + " " + className);
            options.getKeys().each(function (key) {
                var option = $("<option></option>");
                option.val(key);
                option.text(options.get(key));
                $select.append(option);
            });
            $select.val(value);
            var dropdownElementContainer = $("<div>", { class: Editor.DetailsViewConstants.inputItemField });
            dropdownElementContainer.append($select);
            dropdownContainer.append(dropdownElementContainer);
        };
        return DropdownListRenderer;
    }());
    Editor.DropdownListRenderer = DropdownListRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var ContentBlockDetailsView = /** @class */ (function () {
        function ContentBlockDetailsView(viewId, detailsViewControl, provider, toolBlockMapping, blockDetailsViewMapping) {
            this.viewId = viewId;
            this.detailsViewControl = detailsViewControl;
            this.provider = provider;
            this.toolBlockMapping = toolBlockMapping;
            this.blockDetailsViewMapping = blockDetailsViewMapping;
            this.initialized = false;
            this.decoratedAreaMarkerClass = "decoratedAreaMarker";
        }
        ContentBlockDetailsView.prototype.init = function (eventBroker, containerId) {
            var _this = this;
            if (!this.initialized) {
                this.eventBroker = eventBroker;
                this.containerId = containerId;
                this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.selectionChanged, function (eventArgs) {
                    _this.renderSubproperties(eventArgs.selectedBlock, eventArgs.selectedSubBlock);
                });
                this.detailsViewControl.init(this.containerId, this.eventBroker);
                this.accessibilityNotificator = new Editor.AccessibilityNotificator();
                this.initialized = true;
            }
        };
        ContentBlockDetailsView.prototype.dispose = function () {
            this.detailsViewControl.dispose();
            if (this.subproperties) {
                this.subproperties.dispose();
            }
        };
        ContentBlockDetailsView.prototype.render = function (selectedBlock) {
            this.clearContainer();
            this.renderLookupField(selectedBlock);
            this.initializeSubproperties(selectedBlock);
        };
        ContentBlockDetailsView.prototype.initializeSubproperties = function (selectedBlock) {
            var _this = this;
            var selectedSubBlockFound = false;
            var subBlocks = selectedBlock.find("[" + Editor.Contract.subBlockAttrName + "='true']");
            subBlocks.each(function (idx, element) {
                if (element.parentElement.classList.contains(_this.decoratedAreaMarkerClass)) {
                    _this.renderSubproperties(selectedBlock, $(element));
                    selectedSubBlockFound = true;
                    return;
                }
            });
            //fallback will select the first subblock
            if (!selectedSubBlockFound) {
                this.renderSubproperties(selectedBlock, selectedBlock.find("[" + Editor.Contract.subBlockAttrName + "='true']"));
            }
        };
        ContentBlockDetailsView.prototype.renderLookupField = function (selectedBlock) {
            var _this = this;
            var linkSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.contentBlockTool));
            var lookupId = selectedBlock.attr(Editor.DetailsViewConstants.lookupIdAttribute);
            var lookupName = selectedBlock.attr(Editor.DetailsViewConstants.lookupNameAttribute);
            var contentBlockName = Editor.ContentBlockProvider.EntityName;
            var lookupValue = null;
            if (!String.isNullUndefinedOrWhitespace(lookupId)) {
                lookupValue = {
                    Id: lookupId,
                    LogicalName: contentBlockName,
                    Name: lookupName
                };
            }
            var containerId = Editor.CommonConstants.contentBlockLookupContainerId + Editor.CommonConstants.contentBlockToolType;
            var lookupCaption = Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.contentBlockSource);
            this.detailsViewControl.createLookupContainer(linkSection, lookupCaption, Editor.CommonConstants.contentBlockLinkInputCssClass, containerId);
            var container = Editor.CommonUtils.getById(containerId);
            this.provider.getLookupField().loadLookup(container, contentBlockName, lookupCaption, this.viewId, function (value) {
                var id = value ? value.Id || value.id : null;
                if (!String.isNullUndefinedOrWhitespace(id)) {
                    _this.onLinkFieldUpdated(selectedBlock, id, value.Name);
                }
                else {
                    _this.onLinkFieldUpdated(selectedBlock, id, String.Empty);
                }
            }, lookupValue);
            container.parent().addClass(Editor.DetailsViewConstants.neverProtected);
            this.accessibilityNotificator.init(container.get(0), Editor.CommonConstants.detailsViewAccessibilityNotificationRegion);
        };
        ContentBlockDetailsView.prototype.renderSubproperties = function (selectedBlock, selectedSubBlock) {
            if (selectedSubBlock == null || selectedSubBlock.length === 0) {
                return;
            }
            var subcontainerId = "" + Editor.CommonConstants.subBlockProperties;
            $("#" + subcontainerId).remove();
            var subpropertiesType = selectedSubBlock.attr(Editor.Contract.blockDatatypeAttrName);
            if (subpropertiesType) {
                this.subproperties = this.blockDetailsViewMapping.get(subpropertiesType);
                if (this.subproperties) {
                    $("<div/>", {
                        id: subcontainerId
                    }).appendTo($("#" + this.containerId));
                    var isDisabled = Editor.BlockUtils.isProtected(selectedBlock);
                    this.subproperties.init(this.eventBroker, subcontainerId, isDisabled);
                    this.subproperties.render(selectedSubBlock);
                    Editor.BlockDetailsUtils.protectBlocksIfNeeded(selectedBlock, this.subproperties);
                }
            }
            this.eventBroker.notify(Editor.EventConstants.subBlockDetailsViewWasRendered, null);
            this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(Editor.EventConstants.detailsViewOrigin));
        };
        ContentBlockDetailsView.prototype.onLinkFieldUpdated = function (selectedBlock, contentBlockId, lookupName) {
            var _this = this;
            this.provider
                .getExecutionContext()
                .getConfigurationProvider()
                .getEntityData(Editor.ContentBlockProvider.EntityName, contentBlockId, function (result) {
                var eventArgs = new Editor.ContentBlockAttributeChangedEventArgs(selectedBlock, result.msdyncrm_finalizedhtml, contentBlockId, lookupName);
                eventArgs.sourceId = Editor.EventConstants.detailsViewOrigin;
                _this.eventBroker.notify(Editor.EventConstants.contentBlockAttributeChanged, eventArgs);
                _this.eventBroker.notify(Editor.EventConstants.hrefAttributeChanged, eventArgs);
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentBlockChanged, new Editor.BlockChangedEventArgs(Editor.EventConstants.detailsViewOrigin, selectedBlock));
                _this.accessibilityNotificator.notify(lookupName + " " + Editor.CommonUtils.getLocalizedString(Editor.BrowserPreviewConstants.ariaSelected));
                if (lookupName === String.Empty) {
                    var subcontainerId = "" + Editor.CommonConstants.subBlockProperties;
                    $("#" + subcontainerId).remove();
                }
                else {
                    _this.initializeSubproperties(selectedBlock);
                }
                _this.previouslySelectedBlock = selectedBlock;
            });
        };
        ContentBlockDetailsView.prototype.clearContainer = function () {
            Editor.CommonUtils.getById(this.containerId).empty();
        };
        return ContentBlockDetailsView;
    }());
    Editor.ContentBlockDetailsView = ContentBlockDetailsView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Input Field Renderer Class
     */
    var LookupContainerRenderer = /** @class */ (function () {
        function LookupContainerRenderer() {
        }
        /**
         * Render the form section
         */
        LookupContainerRenderer.prototype.render = function (label, className, id) {
            var inputContainer = $("<div>", { class: Editor.DetailsViewConstants.inputControlContainerClassName });
            this.renderLookupLabel(inputContainer, label);
            this.renderLookupContainer(inputContainer, id, className);
            return inputContainer;
        };
        LookupContainerRenderer.prototype.renderLookupLabel = function (inputContainer, label) {
            var $label = $("<label>", {
                class: Editor.DetailsViewConstants.inputItemField + " " + Editor.DetailsViewConstants.propertyNameCssClass
            }).text(label);
            inputContainer.append($label);
        };
        LookupContainerRenderer.prototype.renderLookupContainer = function (inputContainer, id, className) {
            var container = $("<div />");
            container.attr("id", id);
            container.addClass(className);
            container.addClass(Editor.DetailsViewConstants.inputAttributeClassName);
            container.addClass(Editor.DetailsViewConstants.editorLookupControlClassName);
            var inputElementContainer = $("<div>", { class: Editor.DetailsViewConstants.inputItemField });
            inputElementContainer.append(container);
            inputContainer.append(inputElementContainer);
        };
        return LookupContainerRenderer;
    }());
    Editor.LookupContainerRenderer = LookupContainerRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Class used for rendering jQuery buttons using IButton implementations
     */
    var ButtonRenderer = /** @class */ (function () {
        function ButtonRenderer() {
        }
        /**
         * Renders a jQuery element with class and background image extracted from the IButton implementation
         */
        ButtonRenderer.prototype.renderButton = function (button) {
            return $("<button/>")
                .addClass(button.getName())
                .attr("title", Editor.CommonUtils.getLocalizedString(button.getLabel()))
                .attr("type", Editor.CommonConstants.buttonType)
                .css("background-image", 'url("' +
                $("<div>")
                    .text(button.getIconSrc())
                    .html() +
                '")');
        };
        return ButtonRenderer;
    }());
    Editor.ButtonRenderer = ButtonRenderer;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Plugin to align divider to center in CKEditor.
     */
    var DividerAlignCenterButton = /** @class */ (function () {
        /**
         * Initializes a new instance of the DividerAlignCenterButton class.
         */
        function DividerAlignCenterButton(command) {
            this.command = command;
        }
        /**
         * Gets the name of the button.
         */
        DividerAlignCenterButton.prototype.getName = function () {
            return DividerAlignCenterButton.buttonName;
        };
        /**
         * Gets the label used with the button.
         */
        DividerAlignCenterButton.prototype.getLabel = function () {
            return "[Align Center]";
        };
        /**
         * Get the command associated with the button
         */
        DividerAlignCenterButton.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * Gets the source of the icon base64 encoded
         */
        DividerAlignCenterButton.prototype.getIconSrc = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAQAAABjX+2PAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfgBgMHAQayUmmdAAAApklEQVQY06WQrQ7CQBCEvysLQZ4Cg0AgIEGieAseGsszIBpIqkoVLeQG0R96TYrhxuzt5L6dW/jnuK6aR/1A1b+uE00bmRBl3bbWPwFq6jcpl76tAYznd+oWjah+fcBIeilF4EnGDQMFih/fUiJ/3FNGesjLg4EL5PjdzBq8eHHH5XHyLOJWrsNvOAPJYHAAlgaYX0x6S2lXU9RwBdKx5A5krEbs6wcyZEaBNz8cjAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNi0wNi0wM1QwNzowMTowNi0wNDowMBTGlrgAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTYtMDYtMDNUMDc6MDE6MDYtMDQ6MDBlmy4EAAAAAElFTkSuQmCC";
        };
        /**
         * Gets the keyboard shortcut for the button.
         */
        DividerAlignCenterButton.prototype.getKeyboardShortcut = function () {
            return null;
        };
        DividerAlignCenterButton.buttonName = "dividerAlignCenterBtn";
        return DividerAlignCenterButton;
    }());
    Editor.DividerAlignCenterButton = DividerAlignCenterButton;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Plugin to align divider to left in CKEditor.
     */
    var DividerAlignLeftButton = /** @class */ (function () {
        /**
         * Initializes a new instance of the DividerAlignLeftButton class.
         */
        function DividerAlignLeftButton(command) {
            this.command = command;
        }
        /**
         * Gets the name of the button.
         */
        DividerAlignLeftButton.prototype.getName = function () {
            return DividerAlignLeftButton.buttonName;
        };
        /**
         * Gets the label used with the button.
         */
        DividerAlignLeftButton.prototype.getLabel = function () {
            return "[Align Left]";
        };
        /**
         * Get the command associated with the button
         */
        DividerAlignLeftButton.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * Gets the source of the icon base64 encoded
         */
        DividerAlignLeftButton.prototype.getIconSrc = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAARCAQAAAB+puRPAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfgBgMFKRVoNVKHAAAAfUlEQVQoz7XRMQrCQBCF4W9hVSxEBLX2Ct7/DLmGTcDCKhplLRKUURNB8JXzlv3nZ/h7EigfZn0y7K1lCa2j6v11OYfR7BsidBl2Nj2iy02jdhhCRFSGNH0tyzxYrGxNHmWrlpoRi2gyZkHqESyCBVydnjuUy/Aduh+Wfs8dd/kYRlCIrXcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTYtMDYtMDNUMDU6NDE6MjEtMDQ6MDBDwWmCAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE2LTA2LTAzVDA1OjQxOjIxLTA0OjAwMpzRPgAAAABJRU5ErkJggg==";
        };
        /**
         * Gets the keyboard shortcut for the button.
         */
        DividerAlignLeftButton.prototype.getKeyboardShortcut = function () {
            return null;
        };
        DividerAlignLeftButton.buttonName = "dividerAlignLeftBtn";
        return DividerAlignLeftButton;
    }());
    Editor.DividerAlignLeftButton = DividerAlignLeftButton;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Plugin to align divider to right in CKEditor.
     */
    var DividerAlignRightButton = /** @class */ (function () {
        /**
         * Initializes a new instance of the DividerAlignRightButton class.
         */
        function DividerAlignRightButton(command) {
            this.command = command;
        }
        /**
         * Gets the name of the button.
         */
        DividerAlignRightButton.prototype.getName = function () {
            return DividerAlignRightButton.buttonName;
        };
        /**
         * Gets the label used with the button.
         */
        DividerAlignRightButton.prototype.getLabel = function () {
            return "[Align Right]";
        };
        /**
         * Get the command associated with the button
         */
        DividerAlignRightButton.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * Gets the source of the icon base64 encoded
         */
        DividerAlignRightButton.prototype.getIconSrc = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAARCAQAAAB+puRPAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfgBgMHAh6KE6IIAAAAf0lEQVQoz7WRPQqEQAxGn7iilQuCjdfw/mfwCta6sIWFqAOxUJzJzNgIpgv58r38wOuReLn41Y+ut1RkgGD40YUOsiiD3Aq0dYhoqClInVEMI71FaOsIQgpI5hjCGbKSmuzKNgb+WhBiLCK+g7tF6V1MMEzAKZD1/g9H45fnsQPdyxwmlPvPHAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNi0wNi0wM1QwNzowMjozMC0wNDowMBKuH2IAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTYtMDYtMDNUMDc6MDI6MzAtMDQ6MDBj86feAAAAAElFTkSuQmCC";
        };
        /**
         * Gets the keyboard shortcut for the button.
         */
        DividerAlignRightButton.prototype.getKeyboardShortcut = function () {
            return null;
        };
        DividerAlignRightButton.buttonName = "dividerAlignRightBtn";
        return DividerAlignRightButton;
    }());
    Editor.DividerAlignRightButton = DividerAlignRightButton;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    /**
     * Plugin to move a block in CKEditor.
     */
    var MoveBlockButton = /** @class */ (function () {
        /**
         * Initializes a new instance of the MoveBlockButton class.
         */
        function MoveBlockButton(command) {
            this.command = command;
        }
        /**
         * Gets the name of the button.
         */
        MoveBlockButton.prototype.getName = function () {
            return "moveBlockBtn";
        };
        /**
         * Gets the label used with the button.
         */
        MoveBlockButton.prototype.getLabel = function () {
            return "[Move Block]";
        };
        /**
         * Get the command associated with the button
         */
        MoveBlockButton.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * Gets the source of the icon base64 encoded
         */
        MoveBlockButton.prototype.getIconSrc = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwQAADsEBuJFr7QAAABl0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4xMkMEa+wAAAF6SURBVDhPhZHNS8NAEMXzt/oBiqkgiodEiLQa/CoUawRJL6WXXDz34KkHjwXb0lspVaw2jYcGL00qPPetJIZsxMKvTN7M7s680QD8yWg0xuv0TYTFeVIokn5/iGq1DvOoAl6UzycUit3uE1y3KUJgtfqC47gYjyf8VGoVgZR2DzEYDDEPPjCdvqPXG0DXD0RKrVUE0m4/oNXyYFk2NjZLMu50HkVKrU0Dts2XeTjRrGMbW9t76ffl1bXiifyjYZyZbfO1JJm/QNf34fsBypULTJ5fpC5XRbf548xsWyIOe9496jd3MpYIPY5jRFGMU7uKQNRr3DPbots0jDPzVcLDhllOv9fWd7BcRgjDT3HmBItF+NMau3BuXen2fyNwnWfnNcxmvtRlgjDBVWXdzl/QaDRhGGX48yDV0guy0G2+xpnZNmMeztcRRSCmWZFu0zDOzO74cr6OKAKhJ1wV3aZhnDnbdhZFSOCeuSq6nRhWRKGYwD1zVXn9F2jfTdAByZ8nSAIAAAAASUVORK5CYII=";
        };
        /**
         * Gets the keyboard shortcut for the button.
         */
        MoveBlockButton.prototype.getKeyboardShortcut = function () {
            return new KeyboardCommand(KeyboardKeyCodes.mKey, [KeyboardModifierType.Alt]);
        };
        return MoveBlockButton;
    }());
    Editor.MoveBlockButton = MoveBlockButton;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var AlignCenterButton = /** @class */ (function () {
        function AlignCenterButton(command) {
            this.command = command;
        }
        /**
         * @see IButton.getName
         */
        AlignCenterButton.prototype.getName = function () {
            return "AlignCenterCommand";
        };
        /**
         * @see IButton.getLabel
         */
        AlignCenterButton.prototype.getLabel = function () {
            return "[Align Center Command]";
        };
        /**
         * @see IButton.getCommand
         */
        AlignCenterButton.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * @see IButton.getIconSrc
         */
        AlignCenterButton.prototype.getIconSrc = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAFVBMVEUAAABfX19ISEhJSUlWVlZTU1NVVVUApeMjAAAAB3RSTlMACv//FhQWIk+1hQAAAC1JREFUeJxjYMAEjEpKSspgljEQIMuwKIEBEgMJwBXDtUMBq7ExRI4Niy40AADOaQZVDS+OugAAAABJRU5ErkJggg==";
        };
        /**
         * @see IButton.getKeyboardShortcut
         */
        AlignCenterButton.prototype.getKeyboardShortcut = function () {
            return null;
        };
        return AlignCenterButton;
    }());
    Editor.AlignCenterButton = AlignCenterButton;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var AlignCenterCommand = /** @class */ (function (_super) {
        __extends(AlignCenterCommand, _super);
        function AlignCenterCommand() {
            var _this = _super.call(this) || this;
            _this.alignment = "center";
            /**
             * List of tags where command is applicable
             */
            _this.acceptedTags = ["p", "div", "a", "span", "td", "th", "h1", "h2", "h3", "h4", "h5", "h6", "h7"];
            return _this;
        }
        /**
         * @see ICommand.isContextSensitive
         */
        AlignCenterCommand.prototype.isContextSensitive = function () {
            return true;
        };
        /**
         * @see ICommand.getName
         */
        AlignCenterCommand.prototype.getName = function () {
            return "AlignCenterCommand";
        };
        /**
         * @see ICommand.enabledOnReadOnly
         */
        AlignCenterCommand.prototype.enabledOnReadOnly = function () {
            return false;
        };
        AlignCenterCommand.prototype.setupCkEditor = function (ckEditorProxy) {
            _super.prototype.setupCkEditor.call(this, ckEditorProxy);
        };
        /**
         * @see ICommand.setup
         */
        AlignCenterCommand.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        /**
         * @see ICommand.exec
         */
        AlignCenterCommand.prototype.exec = function (selectedBlock, wrappedBlock, selectedHtml) {
            var _this = this;
            if (selectedHtml) {
                if (selectedHtml.prop("tagName") === "IMG") {
                    this.toggleImageAlignment(selectedBlock);
                }
                else {
                    if (selectedBlock.prop("tagName").toLowerCase() === "body") {
                        var wrapper = $("<div/>", {
                            style: "text-align: center"
                        });
                        wrapper.append(selectedBlock.html());
                        selectedBlock.html("");
                        selectedBlock.append(wrapper);
                    }
                    else {
                        this.acceptedTags.forEach(function (tag) {
                            if (selectedBlock.prop("tagName").toLowerCase() === tag) {
                                selectedBlock.get(0).style.textAlign =
                                    selectedBlock.get(0).style.textAlign === _this.alignment ? "" : _this.alignment;
                            }
                            selectedBlock
                                .find(tag)
                                .toArray()
                                .forEach(function (el) {
                                el.style.textAlign = el.style.textAlign === _this.alignment ? "" : _this.alignment;
                            });
                        });
                    }
                }
            }
            return true;
        };
        AlignCenterCommand.prototype.toggleImageAlignment = function (selectedBlock) {
            var imgTag = selectedBlock.find("img");
            var img = imgTag.get(0);
            if (img["align"] === this.alignment) {
                img.style.cssFloat = "";
                img.style.marginLeft = "";
                img.style.marginRight = "";
                img["align"] = "";
                img.style.display = "";
            }
            else {
                img.style.cssFloat = "none";
                img.style.marginLeft = "auto";
                img.style.marginRight = "auto";
                img["align"] = this.alignment;
                img.style.display = "block";
            }
        };
        /**
         * @see ICommand.shouldSetToolHighlight
         */
        AlignCenterCommand.prototype.shouldSetToolHighlight = function (element) {
            var result = false;
            var tagName = element.prop("tagName");
            if (tagName) {
                if (tagName === "IMG") {
                    result = this.checkImgTags(element);
                }
                else {
                    result = this.checkTextTags(tagName, element);
                }
            }
            return result;
        };
        AlignCenterCommand.prototype.checkImgTags = function (element) {
            var img = element.get(0);
            if (img.style.cssFloat === "none" &&
                img.style.marginLeft === "auto" &&
                img.style.marginRight === "auto" &&
                img.style.display === "block" &&
                img["align"] === this.alignment) {
                return true;
            }
            return false;
        };
        AlignCenterCommand.prototype.checkTextTags = function (tagName, element) {
            var tagIsCentered = false;
            if (this.acceptedTags.indexOf(tagName.toLocaleLowerCase()) !== -1 &&
                element.get(0).style.textAlign === this.alignment) {
                tagIsCentered = true;
            }
            return tagIsCentered;
        };
        /**
         * @see ICommand.cleanup
         */
        AlignCenterCommand.prototype.cleanup = function (blockElements) { };
        /**
         * @see ICommand.dispose
         */
        AlignCenterCommand.prototype.dispose = function () { };
        return AlignCenterCommand;
    }(Editor.CkEditorCommand));
    Editor.AlignCenterCommand = AlignCenterCommand;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Command to clone the selected block.
     */
    var MoveBlockCommand = /** @class */ (function () {
        function MoveBlockCommand() {
        }
        /**
         * @see ICommand.isContextSensitive
         */
        MoveBlockCommand.prototype.isContextSensitive = function () {
            return false;
        };
        /**
         * Gets the name of the command.
         */
        MoveBlockCommand.prototype.getName = function () {
            return MoveBlockCommand.getName();
        };
        /**
         * Enabled if editor is in read only mode.
         */
        MoveBlockCommand.prototype.enabledOnReadOnly = function () {
            return true;
        };
        /**
         * Gets the name of the command.
         */
        MoveBlockCommand.getName = function () {
            return "moveBlockCommand";
        };
        /**
         * Configure the command.
         * @param eventBroker An instance of event broker.
         */
        MoveBlockCommand.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        /**
         * Executes the command and clones the currently selected block.
         * @param selectedBlock The currently selected block.
         * @param wrappedBlock The top-wrapping element.
         * @param cleanBlock The clean block, without any wrappers.
         * @param selectedHtml The selected html, if any.
         */
        MoveBlockCommand.prototype.exec = function (selectedBlock, wrappedBlock, selectedHtml) {
            if (Utility.isNullOrUndefined(selectedBlock)) {
                return false;
            }
            if (Utility.isNullOrUndefined(this.eventBroker)) {
                return false;
            }
            var eventArgs = new Editor.DesignerAddStartEventArgs(wrappedBlock, true);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddStart, eventArgs);
            return true;
        };
        /**
         * @see ICommand.shouldSetToolHighlight
         */
        MoveBlockCommand.prototype.shouldSetToolHighlight = function (element) {
            return false;
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        MoveBlockCommand.prototype.dispose = function () { };
        /*
         * Cleans up the html elements that where added to the page
         */
        MoveBlockCommand.prototype.cleanup = function (blockElements) { };
        return MoveBlockCommand;
    }());
    Editor.MoveBlockCommand = MoveBlockCommand;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var ImagePlaceholderHelper = /** @class */ (function () {
        function ImagePlaceholderHelper() {
            this.cleanedUpImage = "about:blank";
            this.imagePlaceholder = Editor.CommonUtils.getLocalizedImagePlaceholder();
        }
        /**
         * Identify that the image is configured
         * @param src The image source Url
         */
        ImagePlaceholderHelper.prototype.isImageConfigured = function (src) {
            return (src !== this.imagePlaceholder && !String.isNullUndefinedOrWhitespace(src) && src !== this.cleanedUpImage);
        };
        /**
         * Identify that the placeholder needed for the current image
         * @param src The image source Url
         */
        ImagePlaceholderHelper.prototype.isPlaceholderNeeded = function (src) {
            return !this.isImageConfigured(src);
        };
        /**
         * Returns the image placeholder
         */
        ImagePlaceholderHelper.prototype.getImagePlaceholder = function (src) {
            return this.imagePlaceholder;
        };
        return ImagePlaceholderHelper;
    }());
    Editor.ImagePlaceholderHelper = ImagePlaceholderHelper;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BasicFullPageToolbar = /** @class */ (function () {
        function BasicFullPageToolbar() {
        }
        BasicFullPageToolbar.prototype.getName = function () {
            return "BasicFullPageToolbar";
        };
        BasicFullPageToolbar.prototype.getConfig = function () {
            var clipboard = ["Cut", "Copy"];
            if (Editor.CommonUtils.isIOS() || Editor.CommonUtils.isAndroid()) {
                clipboard = ["Cut", "Copy", "Paste", "PasteFromWord", "PasteText"];
            }
            return [
                clipboard,
                ["JustifyLeft", "AlignCenterCommand", "JustifyRight", "JustifyBlock"],
                ["Find", "Replace"],
                ["SelectAll"],
                ["BidiLtr", "BidiRtl"],
                ["Link", "Unlink", "Anchor"],
                ["NumberedList", "BulletedList"],
                ["HorizontalRule"],
                "/",
                ["Bold", "Italic", "Underline", "Strike", "Subscript", "Superscript"],
                ["RemoveFormat"],
                ["Styles", "Font", "FontSize"],
                ["TextColor", "BGColor"],
                ["SpecialChar"]
            ];
        };
        return BasicFullPageToolbar;
    }());
    Editor.BasicFullPageToolbar = BasicFullPageToolbar;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BasicCodeBlockInlineToolbar = /** @class */ (function () {
        function BasicCodeBlockInlineToolbar() {
        }
        BasicCodeBlockInlineToolbar.prototype.getName = function () {
            return "BasicCodeBlockInlineToolbar";
        };
        BasicCodeBlockInlineToolbar.prototype.getConfig = function () {
            return [["cloneBlockBtn"]];
        };
        return BasicCodeBlockInlineToolbar;
    }());
    Editor.BasicCodeBlockInlineToolbar = BasicCodeBlockInlineToolbar;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SuperOWAToolbar = /** @class */ (function () {
        function SuperOWAToolbar() {
            this.configCollection = [
                ["CopyFormatting"],
                ["Font"],
                ["FontSize"],
                ["Bold"],
                ["Italic"],
                ["Underline"],
                ["BGColor"],
                ["TextColor"],
                ["BulletedList"],
                ["NumberedList"],
                ["Outdent"],
                ["Indent"],
                ["Blockquote"],
                ["JustifyLeft"],
                ["JustifyCenter"],
                ["JustifyRight"],
                ["Link"],
                ["Unlink"],
                ["Superscript"],
                ["Subscript"],
                ["Strike"],
                ["Image"],
                ["BidiLtr"],
                ["BidiRtl"],
                ["Undo"],
                ["Redo"],
                ["RemoveFormat"],
                ["Table"]
            ];
        }
        SuperOWAToolbar.prototype.getName = function () {
            return "SuperOWAToolbar";
        };
        SuperOWAToolbar.prototype.getConfig = function () {
            return this.configCollection;
        };
        SuperOWAToolbar.prototype.setConfig = function (newConfig) {
            this.configCollection = newConfig;
        };
        return SuperOWAToolbar;
    }());
    Editor.SuperOWAToolbar = SuperOWAToolbar;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var FullPageTabItemVisibility = /** @class */ (function () {
        function FullPageTabItemVisibility(designerTabItem) {
            this.tabItem = designerTabItem;
        }
        FullPageTabItemVisibility.prototype.isTabEnabled = function (contentModel) {
            return !contentModel.isDesignerContent();
        };
        FullPageTabItemVisibility.prototype.getTabItem = function () {
            return this.tabItem;
        };
        return FullPageTabItemVisibility;
    }());
    Editor.FullPageTabItemVisibility = FullPageTabItemVisibility;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DesignerTabItemVisibility = /** @class */ (function () {
        function DesignerTabItemVisibility(designerTabItem) {
            this.tabItem = designerTabItem;
        }
        DesignerTabItemVisibility.prototype.isTabEnabled = function (contentModel) {
            return contentModel.isDesignerContent();
        };
        DesignerTabItemVisibility.prototype.getTabItem = function () {
            return this.tabItem;
        };
        return DesignerTabItemVisibility;
    }());
    Editor.DesignerTabItemVisibility = DesignerTabItemVisibility;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    /**
     * The toolbar class.
     */
    var StandardToolbar = /** @class */ (function () {
        /**
         * Initializes a new instance of the standard toolbar class.
         */
        function StandardToolbar() {
            var editor = Editor.CommonUtils.getByClass(Editor.CommonConstants.fullPageContentEditorFrameClassName);
            this.editorContents = editor.contents();
        }
        /**
         * Gets the buttons from the current toolbar by selector.
         * @param selector buttons selector.
         */
        StandardToolbar.prototype.getButton = function (buttonName) {
            return new Editor.ToolbarButton(this.getButtonElement(buttonName));
        };
        /**
         * Gets the Jquery buttons from the current toolbar by selector.
         * @param selector buttons selector.
         */
        StandardToolbar.prototype.getButtonElement = function (buttonName) {
            return this.editorContents.find(String.Format(".cke_button__{0}", buttonName.toLocaleLowerCase()));
        };
        return StandardToolbar;
    }());
    Editor.StandardToolbar = StandardToolbar;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * ToolboxView section.
     * Holds multiple tools.
     */
    var Section = /** @class */ (function () {
        function Section(name, label) {
            this.name = name;
            this.label = label;
        }
        /**
         * Gets the section name.
         */
        Section.prototype.getName = function () {
            return this.name;
        };
        /**
         * Gets the section label.
         */
        Section.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(this.label);
        };
        return Section;
    }());
    Editor.Section = Section;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ArrayQuery = ControlsCommon.Utils.ArrayQuery;
    /**
     * This class contains the default contract values for Content Sanitizer
     */
    var ContentSanitizerContract = /** @class */ (function () {
        function ContentSanitizerContract() {
        }
        ContentSanitizerContract.supportedAttributes = new ArrayQuery([
            Editor.Contract.blockTypeAttrName,
            Editor.Contract.containerAttrName,
            Editor.Contract.dataLayoutAttrName,
            Editor.Contract.dataSectionAttrName,
            Editor.CommonConstants.dataTrackAttributeName,
            Editor.CommonConstants.dataTrackIdAttributeName,
            Editor.CommonConstants.requiredFieldAttrName,
            "data-form-block-id",
            "data-formControlsPrefix",
            "data-for",
            "data-requiredErrorMessage",
            "data-captchaObjectName",
            "data-makeeditable",
            "data-type",
            "data-entity-id",
            "data-lookup-name",
            "data-lookup-id",
            "data-lookup-type",
            "data-parent-fieldid",
            "data-parent-child-entity-logicalname",
            "data-parent-child-to-parent",
            "data-is-anonymous",
            Editor.Contract.subBlockAttrName,
            Editor.Contract.blockDatatypeAttrName,
            Editor.Contract.dataProtectedAttrName,
            Editor.Contract.dataLockedAttrName,
            Editor.Contract.dataSectionAttrName,
            Editor.Contract.dataCustomSectionAttrName,
            Editor.Contract.dataContainerWidth,
            Editor.CommonConstants.videoIdAttrName,
            Editor.CommonConstants.videoNameAttrName,
            Editor.CommonConstants.videoUrlAttrName,
            Editor.CommonConstants.videoThumbnailUrlAttrName,
            Editor.CommonConstants.videoEmbedCodeAttrName,
            Editor.CommonConstants.codeBlockId,
            Editor.AbTestingUtils.constants.attributeName.testId,
            Editor.AbTestingUtils.constants.attributeName.variantId,
            Editor.Contract.blockFocusIdAttribute
        ]);
        ContentSanitizerContract.supportedTags = new ArrayQuery([
            Editor.AbTestingUtils.constants.tagName.abTesting,
            Editor.AbTestingUtils.constants.tagName.abVariant
        ]);
        ContentSanitizerContract.supportedAttributesWithUrl = new ArrayQuery(["background-image"]);
        return ContentSanitizerContract;
    }());
    Editor.ContentSanitizerContract = ContentSanitizerContract;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Control Tabbing Manager is responsible for handling tabbing into editor control.
     * The client environment assigns positive tab indices to the controls to impose the control tabbing order.
     * As a side effect, it prevents tabbing through the editor's elements after a user has tabbed into editor control (because the elements do not have positive indices and browser skips them).
     * To fix the issue, the manager redirects the incoming tabbing to the control container (which has positive tab index) to the first tabbable element of the editor.
     * It also redirects the shift tabbing out the first tabbable element of the editor to the control that immediately precedes the editor in the tabbing chain.
     */
    var ControlTabbingManager = /** @class */ (function () {
        function ControlTabbingManager() {
            var _this = this;
            this.onControlFocused = function (event) {
                // Switching focus to the first editor's tabbable element
                _this.getFirstTabbableEditorElement(_this.controlContainer).focus();
                event.preventDefault();
            };
            this.onContainerKeyDown = function (event) {
                // Check if Shift+Tab is pressed when the editor's first tabbable element is selected
                // prettier-ignore
                if (event.which === 9 && event.shiftKey && _this.getFirstTabbableEditorElement(_this.controlContainer).is(event.target)) { // tslint:disable-line
                    // Looking for the element with positive tabindex which immediately precedes the container in the tabbing chain
                    var elementsWithPositiveTabIndex = $(_this.controlContainer.get(0).ownerDocument.body).find('[tabindex]:not([tabindex="0"]):not([tabindex^="-"])').toArray().map($);
                    var preceedingFocusElement = elementsWithPositiveTabIndex.reduce(function (closestPreceedingElement, candidateElement) {
                        var candidateElementTabIndex = Number(candidateElement.attr("tabindex"));
                        return (candidateElementTabIndex >= Number(closestPreceedingElement.attr("tabindex")) && candidateElementTabIndex < _this.assignedTabIndex) ? candidateElement : closestPreceedingElement;
                    });
                    // Focus this preceeding element if it exists
                    if (!_this.controlContainer.is(preceedingFocusElement)) {
                        preceedingFocusElement.focus();
                        event.preventDefault();
                    }
                }
            };
        }
        ControlTabbingManager.prototype.init = function (controlContainer, assignedTabIndex) {
            if (assignedTabIndex > 0) {
                this.assignedTabIndex = assignedTabIndex;
                // Setup focus handling to transfer focus to the editor's first editor's tabbable element
                this.controlContainer = $(controlContainer)
                    .attr("tabindex", assignedTabIndex)
                    .on("focus", this.onControlFocused)
                    .on("keydown", this.onContainerKeyDown);
            }
        };
        ControlTabbingManager.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.controlContainer)) {
                this.controlContainer.off("focus", this.onControlFocused).off("keydown", this.onContainerKeyDown);
            }
            this.controlContainer = this.assignedTabIndex = null;
        };
        ControlTabbingManager.prototype.getFirstTabbableEditorElement = function (controlContainer) {
            return controlContainer.find(":tabbable:first");
        };
        return ControlTabbingManager;
    }());
    Editor.ControlTabbingManager = ControlTabbingManager;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    var CkEditorKeyboardAdapter = /** @class */ (function () {
        function CkEditorKeyboardAdapter() {
        }
        CkEditorKeyboardAdapter.prototype.getCkEditorKeyCode = function (keyboardCommand) {
            return keyboardCommand.modifiers
                .map(function (modifier) {
                switch (modifier) {
                    case KeyboardModifierType.Alt:
                        return CKEDITOR.ALT;
                    case KeyboardModifierType.Control:
                        return CKEDITOR.CTRL;
                    case KeyboardModifierType.Shift:
                        return CKEDITOR.SHIFT;
                    default:
                        throw new Error("Unknown keyboard modifier - " + modifier);
                }
            })
                .reduce(function (keyCode, modifierCode) { return keyCode + modifierCode; }, keyboardCommand.inputKeyCode);
        };
        return CkEditorKeyboardAdapter;
    }());
    Editor.CkEditorKeyboardAdapter = CkEditorKeyboardAdapter;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var BlockConstants;
    (function (BlockConstants) {
        var LockLevel;
        (function (LockLevel) {
            LockLevel[LockLevel["none"] = 0] = "none";
            LockLevel[LockLevel["hard"] = 1] = "hard";
        })(LockLevel = BlockConstants.LockLevel || (BlockConstants.LockLevel = {}));
        var SelectableType;
        (function (SelectableType) {
            SelectableType[SelectableType["subBlock"] = 0] = "subBlock";
            SelectableType[SelectableType["block"] = 1] = "block";
            SelectableType[SelectableType["container"] = 2] = "container";
            SelectableType[SelectableType["section"] = 3] = "section";
            SelectableType[SelectableType["body"] = 4] = "body";
            SelectableType[SelectableType["form"] = 5] = "form";
            SelectableType[SelectableType["none"] = 10] = "none";
        })(SelectableType = BlockConstants.SelectableType || (BlockConstants.SelectableType = {}));
        BlockConstants.lockLevelHard = "hard";
        BlockConstants.lockLevelNone = "none";
    })(BlockConstants = Editor.BlockConstants || (Editor.BlockConstants = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DataTrackingAttributeContentProcessor = /** @class */ (function () {
        function DataTrackingAttributeContentProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        DataTrackingAttributeContentProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            var aTags = contents.find("a");
            aTags.each(function (index, element) {
                var $element = $(element);
                // Normalize the value of tracking attribute
                $element.attr(Editor.CommonConstants.dataTrackAttributeName, Editor.CommonUtils.getNormalizedTrackAttributeValue($element));
            });
        };
        /**
         * Returns the name of the content model processor.
         */
        DataTrackingAttributeContentProcessor.prototype.getName = function () {
            return "DataTrackingAttributeContentProcessor";
        };
        /**
         * Dispose.
         */
        DataTrackingAttributeContentProcessor.prototype.dispose = function () { };
        return DataTrackingAttributeContentProcessor;
    }());
    Editor.DataTrackingAttributeContentProcessor = DataTrackingAttributeContentProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var LinkContentProcessor = /** @class */ (function () {
        function LinkContentProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        LinkContentProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            var aTags = contents.find("a");
            aTags.each(function (index, element) {
                var $element = $(element);
                // Add default protocol if current link does not contain protocols
                $element.attr("href", Editor.CommonUtils.getLinkWithProtocol($element.attr("href")));
            });
        };
        /**
         * Returns the name of the content model processor.
         */
        LinkContentProcessor.prototype.getName = function () {
            return "LinkContentProcessor";
        };
        /**
         * Dispose.
         */
        LinkContentProcessor.prototype.dispose = function () { };
        return LinkContentProcessor;
    }());
    Editor.LinkContentProcessor = LinkContentProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var HandleChangesFromHtmlContentModelProcessor = /** @class */ (function () {
        function HandleChangesFromHtmlContentModelProcessor() {
            this.contentChangedByHtmlMetaAttrName = "html-editor";
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        HandleChangesFromHtmlContentModelProcessor.prototype.process = function (documentContent, component) {
            var contentsHead = $(documentContent)
                .contents()
                .find("head");
            var isMetaInContent = contentsHead.find("meta[name=" + this.contentChangedByHtmlMetaAttrName + "]").length > 0;
            if (component === Editor.CommonConstants.htmlEditorComponentName ||
                this.isContentChangedByHtml ||
                isMetaInContent) {
                this.isContentChangedByHtml = true;
                if (!isMetaInContent) {
                    var metaAttr = $("<meta>").attr("name", this.contentChangedByHtmlMetaAttrName);
                    contentsHead.append(metaAttr);
                }
            }
        };
        /**
         * Returns the name of the content model processor.
         */
        HandleChangesFromHtmlContentModelProcessor.prototype.getName = function () {
            return "HandleChangesFromHtmlContentModelProcessor";
        };
        /**
         * Dispose.
         */
        HandleChangesFromHtmlContentModelProcessor.prototype.dispose = function () { };
        return HandleChangesFromHtmlContentModelProcessor;
    }());
    Editor.HandleChangesFromHtmlContentModelProcessor = HandleChangesFromHtmlContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TableDecoratorContentModelProcessor = /** @class */ (function () {
        function TableDecoratorContentModelProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        TableDecoratorContentModelProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            var tables = Editor.CommonUtils.getBySelector("table, th", contents);
            tables.each(function (index, table) {
                var block = $(table).find(Editor.CommonUtils.getAttrSelector(Editor.Contract.blockTypeAttrName));
                var container = $(table).find(Editor.CommonUtils.getAttrSelector(Editor.Contract.containerAttrName));
                /* If table contains a block or container, we decorate it */
                if (container.length !== 0 || block.length !== 0) {
                    $(table).attr("role", "presentation");
                }
            });
        };
        /**
         * Returns the name of the content model processor.
         */
        TableDecoratorContentModelProcessor.prototype.getName = function () {
            return "TableDecoratorContentModelProcessor";
        };
        /**
         * Dispose.
         */
        TableDecoratorContentModelProcessor.prototype.dispose = function () { };
        return TableDecoratorContentModelProcessor;
    }());
    Editor.TableDecoratorContentModelProcessor = TableDecoratorContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SetOrphanBlockContainerWrapContentModelProcessor = /** @class */ (function () {
        function SetOrphanBlockContainerWrapContentModelProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        SetOrphanBlockContainerWrapContentModelProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            var blocks = Editor.BlockProvider.getBlocks(contents);
            blocks.each(function (i, block) {
                var $block = $(block);
                var container = $block.closest(Editor.CommonUtils.getAttrSelector(Editor.Contract.containerAttrName));
                /* If block doesn't have a container, wrap it in one */
                if (container.length === 0) {
                    var wrapperContainer = $("<div>").attr(Editor.Contract.containerAttrName, "true");
                    $(block).wrap(wrapperContainer);
                }
            });
        };
        /**
         * Returns the name of the content model processor.
         */
        SetOrphanBlockContainerWrapContentModelProcessor.prototype.getName = function () {
            return "SetOrphanBlockContainerWrapContentModelProcessor";
        };
        /**
         * Dispose.
         */
        SetOrphanBlockContainerWrapContentModelProcessor.prototype.dispose = function () { };
        return SetOrphanBlockContainerWrapContentModelProcessor;
    }());
    Editor.SetOrphanBlockContainerWrapContentModelProcessor = SetOrphanBlockContainerWrapContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var FullPageEditorRenderedEventArgs = /** @class */ (function (_super) {
        __extends(FullPageEditorRenderedEventArgs, _super);
        function FullPageEditorRenderedEventArgs(editorId) {
            var _this = _super.call(this) || this;
            _this.editorId = editorId;
            return _this;
        }
        return FullPageEditorRenderedEventArgs;
    }(Editor.EventArgs));
    Editor.FullPageEditorRenderedEventArgs = FullPageEditorRenderedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var FullScreenChangedEventArgs = /** @class */ (function (_super) {
        __extends(FullScreenChangedEventArgs, _super);
        function FullScreenChangedEventArgs(isFullscreen) {
            var _this = _super.call(this) || this;
            _this.isFullscreen = isFullscreen;
            return _this;
        }
        return FullScreenChangedEventArgs;
    }(Editor.EventArgs));
    Editor.FullScreenChangedEventArgs = FullScreenChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var VisibilityChangedEventArgs = /** @class */ (function (_super) {
        __extends(VisibilityChangedEventArgs, _super);
        function VisibilityChangedEventArgs(isVisible) {
            var _this = _super.call(this) || this;
            _this.isVisible = isVisible;
            return _this;
        }
        return VisibilityChangedEventArgs;
    }(Editor.EventArgs));
    Editor.VisibilityChangedEventArgs = VisibilityChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    var AbTestingConfigurationChangedEventArgs = /** @class */ (function (_super) {
        __extends(AbTestingConfigurationChangedEventArgs, _super);
        function AbTestingConfigurationChangedEventArgs(configuration) {
            var _this = _super.call(this) || this;
            _this.configuration = typeof configuration === "object" ? configuration : JSON.parse(configuration);
            return _this;
        }
        return AbTestingConfigurationChangedEventArgs;
    }(Editor.EventArgs));
    Editor.AbTestingConfigurationChangedEventArgs = AbTestingConfigurationChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DesignerAddEndEventArgs = /** @class */ (function (_super) {
        __extends(DesignerAddEndEventArgs, _super);
        function DesignerAddEndEventArgs(category) {
            var _this = _super.call(this, null) || this;
            _this.category = category;
            return _this;
        }
        return DesignerAddEndEventArgs;
    }(Editor.EventArgs));
    Editor.DesignerAddEndEventArgs = DesignerAddEndEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var AddToolsDropdownButton = /** @class */ (function () {
        function AddToolsDropdownButton() {
            this.localizedLabel = Editor.CommonUtils.getLocalizedString("[Add]");
            this.localizedTitle = Editor.CommonUtils.getLocalizedString("[Add a new design element]");
            this.addButtonImageCssClass = "addButtonImage";
            this.addButtonCssClass = "addButton";
            this.addButtonLabelCssClass = "addButtonLabel";
        }
        AddToolsDropdownButton.prototype.getLabel = function () {
            return this.localizedLabel;
        };
        AddToolsDropdownButton.prototype.getType = function () {
            return Editor.CommonConstants.buttonType;
        };
        AddToolsDropdownButton.prototype.getClass = function () {
            return this.addButtonCssClass;
        };
        AddToolsDropdownButton.prototype.getButtonImageClass = function () {
            return this.addButtonImageCssClass;
        };
        AddToolsDropdownButton.prototype.getButtonLabelClass = function () {
            return this.addButtonLabelCssClass;
        };
        AddToolsDropdownButton.prototype.getTitle = function () {
            return this.localizedTitle;
        };
        return AddToolsDropdownButton;
    }());
    Editor.AddToolsDropdownButton = AddToolsDropdownButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    var MaximizeButton = /** @class */ (function (_super) {
        __extends(MaximizeButton, _super);
        function MaximizeButton() {
            var _this = _super !== null && _super.apply(this, arguments) || this;
            _this.isFullscreen = false;
            _this.minimizeTitle = "[Minimize]";
            _this.maximizeTitle = "[Full Screen]";
            _this.onClick = function () {
                _this.updateFullscreenState(!_this.isFullscreen);
            };
            _this.closeButtonClicked = function () {
                _this.updateFullscreenState(false);
            };
            _this.escKeyHandler = function (event) {
                if (event.which === KeyCodes.Esc) {
                    _this.updateFullscreenState(false);
                }
            };
            return _this;
        }
        MaximizeButton.prototype.init = function (eventBroker) {
            _super.prototype.init.call(this, eventBroker);
            this.render();
        };
        MaximizeButton.prototype.activate = function () { };
        MaximizeButton.prototype.render = function () {
            var maximizeButtonText = Editor.CommonUtils.getLocalizedString(this.maximizeTitle);
            var maximizeButtonImage = $("<span>")
                .addClass(Editor.CommonConstants.maximizeButtonImageCssClass)
                .addClass(Editor.CommonConstants.editorFontCssClass);
            this.maximizeButtonContainer = $("<button></button>")
                .addClass(Editor.CommonConstants.toolbarButtonCssClass)
                .addClass(Editor.CommonConstants.maximizeButtonCssClass)
                .attr("title", maximizeButtonText)
                .attr("aria-label", maximizeButtonText)
                .attr("aria-pressed", this.isFullscreen.toString())
                .attr("type", Editor.CommonConstants.buttonType)
                .append(maximizeButtonImage);
            Editor.CommonUtils.getByClass(Editor.CommonConstants.menuBarItemsCssClass).append(this.maximizeButtonContainer);
            this.maximizeButtonContainer.on("click", this.onClick);
            this.eventBroker.subscribe(Editor.EventConstants.exitFullScreenButtonClicked, this.closeButtonClicked);
        };
        MaximizeButton.prototype.updateFullscreenState = function (isFullscreen) {
            if (this.isFullscreen === isFullscreen) {
                return;
            }
            this.isFullscreen = isFullscreen;
            this.updateButtonStyles();
            this.eventBroker.notify(Editor.EventConstants.maximizeExecuted, new Editor.FullScreenChangedEventArgs(this.isFullscreen));
            //TODO: Workaround in order to exit fullscreen mode until UClient implements generic Esc to exit fullscreen
            if (this.isFullscreen) {
                $(document).on("keyup", this.escKeyHandler);
            }
            else {
                $(document).off("keyup", this.escKeyHandler);
            }
        };
        MaximizeButton.prototype.updateButtonStyles = function () {
            var title = this.maximizeButtonContainer.hasClass(Editor.CommonConstants.maximizeActiveCssClass)
                ? this.maximizeTitle
                : this.minimizeTitle;
            this.maximizeButtonContainer.toggleClass(Editor.CommonConstants.maximizeActiveCssClass, this.isFullscreen);
            this.maximizeButtonContainer.attr("aria-pressed", this.isFullscreen.toString());
            this.maximizeButtonContainer.attr("title", Editor.CommonUtils.getLocalizedString(title));
            Editor.CommonUtils.setAriaAttribute(this.maximizeButtonContainer, "aria-label", Editor.CommonUtils.getLocalizedString(title));
        };
        MaximizeButton.prototype.deactivate = function () { };
        MaximizeButton.prototype.dispose = function () {
            $(document).off("keyup", this.escKeyHandler);
            this.maximizeButtonContainer.off("click");
            this.maximizeButtonContainer.remove();
            this.eventBroker.unsubscribe(Editor.EventConstants.exitFullScreenButtonClicked, this.closeButtonClicked);
        };
        return MaximizeButton;
    }(Editor.Control));
    Editor.MaximizeButton = MaximizeButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * Class for the representing well-formed HTML document in the content editor.
     */
    var BaseEditorContentModel = /** @class */ (function () {
        /**
         * Constructor.
         * @param eventBroker The event broker instance.
         */
        function BaseEditorContentModel(executionContext, metadataParser, eventBroker, documentPreProcessors, documentPostProcessors, documentPostProcessorsForOff) {
            var _this = this;
            if (documentPostProcessorsForOff === void 0) { documentPostProcessorsForOff = []; }
            /* The html content */
            this.html = String.Empty;
            /* The doctype of the html content */
            this.doctypeString = String.Empty;
            this.id = UniqueId.generate();
            this.initialized = false;
            this.editorBlockSelector = "div[" + Editor.Contract.blockTypeAttrName + "]";
            this.unlimitedNumberOfBlocks = 0;
            this.executionContext = executionContext;
            this.eventBroker = eventBroker;
            this.metadataParser = metadataParser;
            this.documentPreProcessors = documentPreProcessors;
            this.documentPostProcessors = documentPostProcessors;
            this.documentPostProcessorsForOff = documentPostProcessorsForOff;
            this.contentChangedHandler = this.eventBroker.subscribe(Editor.EventConstants.contentChanged, function (eventArgs) {
                var html = !Utility.isNullOrUndefined(eventArgs) && !Utility.isNullOrUndefined(eventArgs.html)
                    ? eventArgs.html
                    : String.Empty;
                var source = !Utility.isNullOrUndefined(eventArgs) && !Utility.isNullOrUndefined(eventArgs.sourceId)
                    ? eventArgs.sourceId
                    : String.Empty;
                _this.setContent(html, source, eventArgs.component);
            });
            this.refreshEditorHandler = this.eventBroker.subscribe(Editor.EventConstants.refreshEditor, function (eventArgs) {
                _this.setContent(_this.html, eventArgs.sourceId, null, true);
            });
        }
        /**
         * Intializes the document model instance on the specified container.
         */
        BaseEditorContentModel.prototype.init = function () {
            // Initialize the document container and subscribe to the content changed events
            this.initialized = true;
            var eventArgs = new Editor.DocumentContentModelInitializedEventArgs(this.id);
            eventArgs.documentContentModel = this;
            this.eventBroker.notify(Editor.EventConstants.contentModelInitialized, eventArgs);
        };
        /**
         * Sets the editor content.
         * @param content - The content.
         * @param sourceId - The source id.
         * @param component - The component, which triggered setting the content.
         * @param forceUpdate - Determines whether to force udpate.
         * @param notifyOutput - Determines whether to notify control output changed.
         */
        BaseEditorContentModel.prototype.setContent = function (content, sourceId, component, forceUpdate, notifyOutput) {
            var _this = this;
            if (forceUpdate === void 0) { forceUpdate = false; }
            if (notifyOutput === void 0) { notifyOutput = true; }
            this.html = content;
            this.doctypeString = Editor.CommonUtils.getDocTypeFromString(this.html);
            if (this.initialized) {
                // Update the source document and notify
                this.sourceDocument = Editor.CommonUtils.getNewContentDocument(this.html);
                this.onContentModelUpdated(sourceId, notifyOutput);
                this.designerResolvedDocument = Editor.CommonUtils.getNewContentDocument(this.html);
                var deferForHtmlPageUpdate_1 = $.Deferred();
                setTimeout(function () { return deferForHtmlPageUpdate_1.resolve(); }, 150);
                return deferForHtmlPageUpdate_1.then(function () {
                    return _this.runPreProcessors(_this.designerResolvedDocument, component).then(function () {
                        _this.onPreProcessorsProcessed(sourceId, notifyOutput);
                        _this.finalizedDocument = Editor.CommonUtils.getNewContentDocument(Editor.CommonUtils.getDocumentContent(_this.designerResolvedDocument, _this.doctypeString));
                        return _this.runPostProcessors(_this.finalizedDocument, component).then(function () {
                            _this.onPostProcessorsProcessed(sourceId, notifyOutput);
                            var maxNumberOfBlocks = _this.executionContext.getMaximumNumberOfBlocksOnCanvas();
                            if (maxNumberOfBlocks !== _this.unlimitedNumberOfBlocks) {
                                _this.executionContext.getContentSanitizer().getSanitizedContent(_this.html, function (output) {
                                    var numberOfBlocksInHtml = output.find(_this.editorBlockSelector).length;
                                    if (numberOfBlocksInHtml >= maxNumberOfBlocks) {
                                        _this.eventBroker.notify(Editor.EventConstants.elementsCannotBeInserted);
                                    }
                                    else {
                                        _this.eventBroker.notify(Editor.EventConstants.elementsCanBeInserted);
                                    }
                                });
                            }
                            return true;
                        });
                    });
                });
            }
            else {
                // No update required
                return $.Deferred().resolve(false);
            }
        };
        /**
         * Executes pre-processor for content.
         * @param contentDocument - The document with content that should be processed.
         * @param component - The component, which triggered execution.
         * @returns - JQueryPromise that will be resolved when the content is processed.
         */
        BaseEditorContentModel.prototype.runPreProcessors = function (contentDocument, component) {
            // Run content preprocessors (e.g. schema upgrade or runtime-id setup) and notify
            return this.prepareAndRunProcessors(contentDocument, this.documentPreProcessors, component);
        };
        /**
         * Executes post-processor for content.
         * @param contentDocument - The document with content that should be processed.
         * @param component - The component, which triggered execution.
         * @returns - JQueryPromise that will be resolved when the content is processed.
         */
        BaseEditorContentModel.prototype.runPostProcessors = function (contentDocument, component) {
            if (this.isPostProcessorsDisabled()) {
                return this.prepareAndRunProcessors(contentDocument, this.documentPostProcessorsForOff, component);
            }
            return this.prepareAndRunProcessors(contentDocument, this.documentPostProcessors, component);
        };
        /**
         * Gets the document version.
         */
        BaseEditorContentModel.prototype.getContentVersion = function () {
            return this.metadataParser.getValue(Editor.Contract.metadataDocumentVersionName, this.getContentNode());
        };
        /**
         * Gets the document type.
         */
        BaseEditorContentModel.prototype.getContentType = function () {
            return this.metadataParser.getValue(Editor.Contract.metadataDocumentTypeName, this.getContentNode());
        };
        /**
         * Gets document layout editable.
         */
        BaseEditorContentModel.prototype.getLayoutEditable = function () {
            return this.metadataParser.getValue(Editor.Contract.metadataDocumentLayoutEditableName, this.getContentNode());
        };
        BaseEditorContentModel.prototype.getPostProcessorsDisabled = function () {
            return this.metadataParser.getValue(Editor.Contract.metadataPostProcessorsDisabledName, this.getContentNode());
        };
        /**
         * Gets the document content.
         */
        BaseEditorContentModel.prototype.getContent = function () {
            return this.html;
        };
        /**
         * Extracts the content from document.
         */
        BaseEditorContentModel.prototype.extractContentFromDocument = function (document) {
            if (document) {
                return Editor.CommonUtils.getDocumentContent(document, this.doctypeString);
            }
            return String.Empty;
        };
        /**
         * Gets the document content.
         */
        BaseEditorContentModel.prototype.getResolvedContent = function () {
            if (this.designerResolvedDocument) {
                return Editor.CommonUtils.getDocumentContent(this.designerResolvedDocument, this.doctypeString);
            }
            return String.Empty;
        };
        /**
         * Gets the document content.
         */
        BaseEditorContentModel.prototype.getFinalizedContent = function () {
            if (this.finalizedDocument) {
                return Editor.CommonUtils.getDocumentContent(this.finalizedDocument, this.doctypeString);
            }
            return String.Empty;
        };
        /**
         * Gets the document content.
         */
        BaseEditorContentModel.prototype.getContentNode = function () {
            return this.sourceDocument;
        };
        /**
         * Gets the resolved document content.
         */
        BaseEditorContentModel.prototype.getResolvedContentNode = function () {
            return this.designerResolvedDocument;
        };
        /**
         * Gets the finalized document content.
         */
        BaseEditorContentModel.prototype.getFinalizedContentNode = function () {
            return this.finalizedDocument;
        };
        /**
         * Gets the current doctype of the content
         */
        BaseEditorContentModel.prototype.getDoctype = function () {
            return this.doctypeString;
        };
        /**
         * Gets the style meta entries
         */
        BaseEditorContentModel.prototype.getStyleMetaEntries = function () {
            return this.metadataParser.getStyleMetaEntries(this.getContentNode());
        };
        BaseEditorContentModel.prototype.updateStyleMetaValue = function (metaStyle, newValue) {
            this.metadataParser.updateStyleMetaValue(this.getContentNode(), metaStyle, newValue);
        };
        BaseEditorContentModel.prototype.isDesignerContent = function () {
            return this.getContentType() === Editor.Contract.metadataDocumentTypeDesignerValue;
        };
        BaseEditorContentModel.prototype.isLayoutEditable = function () {
            return this.getLayoutEditable() === Editor.Contract.metadataLayoutEditableValue;
        };
        BaseEditorContentModel.prototype.isPostProcessorsDisabled = function () {
            return this.getPostProcessorsDisabled() === Editor.Contract.metadataPostProcessorsDisabledValue;
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        BaseEditorContentModel.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.EventConstants.refreshEditor, this.refreshEditorHandler);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentChanged, this.contentChangedHandler);
            this.documentPreProcessors.forEach(function (processor) {
                processor.dispose();
            });
            this.documentPostProcessors.forEach(function (processor) {
                processor.dispose();
            });
            this.documentPostProcessorsForOff.forEach(function (processor) {
                processor.dispose();
            });
            this.eventBroker = null;
            this.documentPreProcessors = null;
            this.documentPostProcessors = null;
            this.documentPostProcessorsForOff = null;
            this.sourceDocument = null;
            this.designerResolvedDocument = null;
            this.finalizedDocument = null;
        };
        BaseEditorContentModel.prototype.prepareAndRunProcessors = function (contentDocument, processors, component) {
            var _this = this;
            var prepareToProcessPromises = [];
            var _loop_2 = function (i) {
                var processor = processors[i];
                if (processor.prepareToProcess) {
                    this_1.executionContext.tryExecute(function () {
                        var promise = processor.prepareToProcess(contentDocument);
                        prepareToProcessPromises.push(promise);
                    }, "Run prepareToProcess for the " + processor.getName() + " processor", true);
                }
            };
            var this_1 = this;
            for (var i = 0; i < processors.length; i++) {
                _loop_2(i);
            }
            if (prepareToProcessPromises.length > 0) {
                return $.when.apply($, prepareToProcessPromises).then(function () {
                    _this.runProcessors(contentDocument, processors, component);
                });
            }
            else {
                this.runProcessors(contentDocument, processors, component);
                return $.Deferred().resolve();
            }
        };
        BaseEditorContentModel.prototype.runProcessors = function (contentDocument, processors, component) {
            for (var i = 0; i < processors.length; i++) {
                this.runSingleProcessor(processors[i], contentDocument, component);
            }
        };
        BaseEditorContentModel.prototype.runSingleProcessor = function (processor, contentDocument, component) {
            var processorName = processor.getName();
            var processFailed = false;
            this.executionContext.tryExecute(function () {
                processor.process(contentDocument, component);
            }, "Run the " + processorName + " processor", false, function () {
                processFailed = true;
            });
            if (this.eventBroker) {
                this.eventBroker.notify(Editor.EventConstants.contentModelProcessCompleted, new Editor.ContentModelProcessorCompletedEventArgs(processorName, processFailed));
            }
        };
        BaseEditorContentModel.prototype.onContentModelUpdated = function (sourceId, notifyOutput) {
            this.eventBroker.notify(Editor.EventConstants.contentModelUpdated, new Editor.ContentChangedEventArgs(this.getContent(), this.id, sourceId, null, notifyOutput));
        };
        BaseEditorContentModel.prototype.onPreProcessorsProcessed = function (sourceId, notifyOutput) {
            this.eventBroker.notify(Editor.EventConstants.contentResolved, new Editor.ContentChangedEventArgs(this.getResolvedContent(), this.id, sourceId, null, notifyOutput));
        };
        BaseEditorContentModel.prototype.onPostProcessorsProcessed = function (sourceId, notifyOutput) {
            this.eventBroker.notify(Editor.EventConstants.contentFinalized, new Editor.ContentChangedEventArgs(this.getFinalizedContent(), this.id, sourceId, null, notifyOutput));
        };
        return BaseEditorContentModel;
    }());
    Editor.BaseEditorContentModel = BaseEditorContentModel;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Class for the representing a HTML fragment in the content editor. The editor generaly expects to have a document,
     * so, this class would actually just delegate the content to a full document content model and set/get the content under the body.
     */
    var FragmentContentModel = /** @class */ (function (_super) {
        __extends(FragmentContentModel, _super);
        function FragmentContentModel() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        /**
         * Sets the editor content.
         * @param content - The content.
         * @param sourceId - The source id.
         * @param component - The component, which triggered setting the content.
         * @param forceUpdate - Determines whether to force udpate.
         * @param notifyOutput - Determines whether to notify control output changed.
         */
        FragmentContentModel.prototype.setContent = function (content, sourceId, component, forceUpdate, notifyOutput) {
            if (forceUpdate === void 0) { forceUpdate = false; }
            if (notifyOutput === void 0) { notifyOutput = true; }
            var fragmentContent = this.getFragmentContent(Editor.CommonUtils.getNewContentDocument(content));
            // Compare content without new line symbols which comes from html editor
            if (String.isNullOrWhitespace(this.getContent()) || this.getContent() !== fragmentContent || forceUpdate) {
                return _super.prototype.setContent.call(this, fragmentContent, sourceId, component, forceUpdate, notifyOutput);
            }
            else {
                // No update required
                return $.Deferred().resolve(false);
            }
        };
        /**
         * Gets the source content.
         */
        FragmentContentModel.prototype.getContent = function () {
            return this.getFragmentContent(this.getContentNode());
        };
        /**
         * Extracts the content from document.
         */
        FragmentContentModel.prototype.extractContentFromDocument = function (document) {
            return this.getFragmentContent(document);
        };
        /**
         * Gets the resolved content.
         */
        FragmentContentModel.prototype.getResolvedContent = function () {
            return this.getFragmentContent(this.getResolvedContentNode());
        };
        /**
         * Gets the finalized content.
         */
        FragmentContentModel.prototype.getFinalizedContent = function () {
            return this.getFragmentContent(this.getFinalizedContentNode());
        };
        /**
         * Just an utility method to get the body.
         */
        FragmentContentModel.prototype.getFragmentContent = function (document) {
            if (!Utility.isNullOrUndefined(document)) {
                // Remove empty title tag, which added by CkEditor
                var title = $(document)
                    .contents()
                    .find("head")
                    .find("title");
                if (title.length && String.isNullOrWhitespace(title.html())) {
                    title.remove();
                }
                var fragment = ($(document)
                    .contents()
                    .find("head")
                    .html()
                    ? $(document)
                        .contents()
                        .find("head")
                        .html()
                        .trim()
                    : String.Empty) +
                    ($(document)
                        .contents()
                        .find("body")
                        .html()
                        ? $(document)
                            .contents()
                            .find("body")
                            .html()
                        : String.Empty);
                if (Editor.CommonUtils.isInternetExplorer()) {
                    // parsing the DOM in IE adds certain meta tags to the
                    // document body which we need to remove.
                    return this.removeIEMetaTag(fragment);
                }
                else {
                    return fragment;
                }
            }
            return String.Empty;
        };
        FragmentContentModel.prototype.removeIEMetaTag = function (content) {
            return content
                .replace(/<(?:META|meta) http-equiv="X-UA-Compatible" content="IE=[0-9.]+">/g, "")
                .replace(/<(?:META|meta) content="IE=[0-9.]+" http-equiv="X-UA-Compatible">/g, "");
        };
        return FragmentContentModel;
    }(Editor.BaseEditorContentModel));
    Editor.FragmentContentModel = FragmentContentModel;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Class for the representing well-formed HTML document in the content editor.
     */
    var DocumentContentModel = /** @class */ (function (_super) {
        __extends(DocumentContentModel, _super);
        function DocumentContentModel() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        /**
         * Sets the document content.
         * @param content - The content.
         * @param sourceId - The source id.
         * @param component - The component, which triggered setting the content.
         * @param forceUpdate - Determines whether to force udpate.
         * @param notifyOutput - Determines whether to notify control output changed.
         */
        DocumentContentModel.prototype.setContent = function (content, sourceId, component, forceUpdate, notifyOutput) {
            if (forceUpdate === void 0) { forceUpdate = false; }
            if (notifyOutput === void 0) { notifyOutput = true; }
            if (this.html !== content || forceUpdate) {
                return _super.prototype.setContent.call(this, content, sourceId, component, forceUpdate, notifyOutput);
            }
            else {
                return $.Deferred().resolve(false);
            }
        };
        return DocumentContentModel;
    }(Editor.BaseEditorContentModel));
    Editor.DocumentContentModel = DocumentContentModel;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ContentModelProcessorCompletedEventArgs = /** @class */ (function (_super) {
        __extends(ContentModelProcessorCompletedEventArgs, _super);
        function ContentModelProcessorCompletedEventArgs(processName, processFailed) {
            var _this = _super.call(this) || this;
            _this.processName = processName;
            _this.processFailed = processFailed;
            return _this;
        }
        return ContentModelProcessorCompletedEventArgs;
    }(Editor.EventArgs));
    Editor.ContentModelProcessorCompletedEventArgs = ContentModelProcessorCompletedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BasicImageGalleryCommandFactory = /** @class */ (function () {
        function BasicImageGalleryCommandFactory() {
        }
        /**
         * Creates a basic image gallery command plugin
         */
        BasicImageGalleryCommandFactory.prototype.create = function () {
            return new Editor.ImageGalleryCommand(new Editor.RandomImagePicker(), new Editor.PopupRenderer());
        };
        return BasicImageGalleryCommandFactory;
    }());
    Editor.BasicImageGalleryCommandFactory = BasicImageGalleryCommandFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var FCBList = /** @class */ (function () {
        function FCBList() {
            // FCB that enables AssistEditV2
            this.isAssistEditV2Enabled = false;
            // FCB that toggles availability of InlinePageStylesContentProcessor
            // that inlines styles of email.
            this.isInlinerEnabled = true;
            this.isResponsiveDesign = false;
            this.isPostProcessingSwitchEnabled = false;
        }
        return FCBList;
    }());
    Editor.FCBList = FCBList;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var GalleryButtonFactory = /** @class */ (function () {
        function GalleryButtonFactory(imagePickerFactory) {
            this.imagePickerFactory = imagePickerFactory;
        }
        GalleryButtonFactory.prototype.create = function (imagePickerId) {
            var imagePicker = this.imagePickerFactory.create(imagePickerId);
            var imagePickerCommand = new Editor.ImageGalleryCommand(imagePicker, new Editor.PopupRenderer());
            return new Editor.ImageGalleryButton(imagePickerCommand);
        };
        return GalleryButtonFactory;
    }());
    Editor.GalleryButtonFactory = GalleryButtonFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var LoadingModal = MktSvc.Controls.Common.LoadingModal;
    var HtmlContentEditorFactory = /** @class */ (function () {
        function HtmlContentEditorFactory() {
        }
        HtmlContentEditorFactory.prototype.create = function (keyboardCommandManager, executionContext) {
            return new Editor.HtmlContentEditor(UniqueId.generate("htmlEditorId"), new LoadingModal(), new Editor.MonacoLocaleProvider(executionContext.getLocalizationProvider().getLocaleId()), keyboardCommandManager, executionContext);
        };
        return HtmlContentEditorFactory;
    }());
    Editor.HtmlContentEditorFactory = HtmlContentEditorFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /*
    Gets the localized string
    */
    var MonacoLocaleProvider = /** @class */ (function () {
        function MonacoLocaleProvider(microsoftLocaleId) {
            this.defaultCode = "1033";
            this.mapping = {
                1026: "bg",
                1027: "ca",
                1028: "zh-tw",
                1029: "cs",
                1030: "da",
                1031: "de",
                1032: "el",
                1033: "",
                1035: "fi",
                1036: "fr",
                1038: "hu",
                1040: "it",
                1041: "ja",
                1042: "ko",
                1043: "nl",
                1044: "nb",
                1045: "pl",
                1046: "pt-br",
                1048: "ro",
                1049: "ru",
                1050: "hr",
                1051: "sk",
                1053: "sv",
                1054: "th",
                1055: "tr",
                1057: "id",
                1058: "uk",
                1060: "sl",
                1061: "et",
                1062: "lv",
                1063: "lt",
                1066: "vi",
                1069: "eu",
                1081: "hi",
                1086: "ms",
                1087: "kk",
                1110: "gl",
                2052: "zh-cn",
                2070: "pt",
                2074: "sr-latn",
                3076: "zh-hk",
                3082: "es",
                3098: "sr"
            };
            this.microsoftLocaleId = microsoftLocaleId;
        }
        MonacoLocaleProvider.prototype.getLanguageCode = function () {
            return this.microsoftLocaleId in this.mapping
                ? this.mapping[this.microsoftLocaleId]
                : this.mapping[this.defaultCode];
        };
        MonacoLocaleProvider.prototype.getLanguageDirection = function () {
            return "ltr";
        };
        return MonacoLocaleProvider;
    }());
    Editor.MonacoLocaleProvider = MonacoLocaleProvider;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /*
    Gets the localized string
    */
    var CkEditorLocaleProvider = /** @class */ (function () {
        function CkEditorLocaleProvider(microsoftLocaleId, isRtl) {
            this.defaultCode = "1033";
            this.mapping = {
                1025: "ar",
                1026: "bg",
                1027: "ca",
                1028: "zh",
                1029: "cs",
                1030: "da",
                1031: "de",
                1032: "el",
                1033: "en",
                1035: "fi",
                1036: "fr",
                1037: "he",
                1038: "hu",
                1040: "it",
                1041: "ja",
                1042: "ko",
                1043: "nl",
                1044: "nb",
                1045: "pl",
                1046: "pt-br",
                1048: "ro",
                1049: "ru",
                1050: "hr",
                1051: "sk",
                1053: "sv",
                1054: "th",
                1055: "tr",
                1057: "id",
                1058: "uk",
                1060: "sl",
                1061: "et",
                1062: "lv",
                1063: "lt",
                1066: "vi",
                1069: "eu",
                1081: "hi",
                1086: "ms",
                1087: "kk",
                1110: "gl",
                2052: "zh-cn",
                2070: "pt",
                2074: "sr-latn",
                3076: "zh-hk",
                3082: "es",
                3098: "sr"
            };
            this.microsoftLocaleId = microsoftLocaleId;
            this.isRtl = isRtl;
        }
        CkEditorLocaleProvider.prototype.getLanguageCode = function () {
            return this.microsoftLocaleId in this.mapping
                ? this.mapping[this.microsoftLocaleId]
                : this.mapping[this.defaultCode];
        };
        CkEditorLocaleProvider.prototype.getLanguageDirection = function () {
            return this.isRtl ? "rtl" : "ltr";
        };
        return CkEditorLocaleProvider;
    }());
    Editor.CkEditorLocaleProvider = CkEditorLocaleProvider;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BlockChangedEventArgs = /** @class */ (function (_super) {
        __extends(BlockChangedEventArgs, _super);
        function BlockChangedEventArgs(sourceId, $block, rootEventId) {
            var _this = _super.call(this, sourceId) || this;
            _this.block = $block;
            _this.rootEventId = rootEventId;
            return _this;
        }
        return BlockChangedEventArgs;
    }(Editor.EventArgs));
    Editor.BlockChangedEventArgs = BlockChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Event args for the designer add section start event.
     */
    var DesignerAddSectionStartEventArgs = /** @class */ (function (_super) {
        __extends(DesignerAddSectionStartEventArgs, _super);
        function DesignerAddSectionStartEventArgs(section, movingExistingSection) {
            var _this = _super.call(this, null) || this;
            _this.section = section;
            _this.movingExistingSection = movingExistingSection;
            return _this;
        }
        return DesignerAddSectionStartEventArgs;
    }(Editor.EventArgs));
    Editor.DesignerAddSectionStartEventArgs = DesignerAddSectionStartEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DocumentContentModelInitializedEventArgs = /** @class */ (function (_super) {
        __extends(DocumentContentModelInitializedEventArgs, _super);
        function DocumentContentModelInitializedEventArgs() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        return DocumentContentModelInitializedEventArgs;
    }(Editor.EventArgs));
    Editor.DocumentContentModelInitializedEventArgs = DocumentContentModelInitializedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var RemoveSectionIdContentModelProcessor = /** @class */ (function () {
        function RemoveSectionIdContentModelProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        RemoveSectionIdContentModelProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            Editor.SectionProvider.getSections(contents).removeAttr("id");
        };
        /**
         * Returns the name of the content model processor.
         */
        RemoveSectionIdContentModelProcessor.prototype.getName = function () {
            return "RemoveSectionIdContentModelProcessor";
        };
        /**
         * Dispose.
         */
        RemoveSectionIdContentModelProcessor.prototype.dispose = function () { };
        return RemoveSectionIdContentModelProcessor;
    }());
    Editor.RemoveSectionIdContentModelProcessor = RemoveSectionIdContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var RemoveContainerIdContentModelProcessor = /** @class */ (function () {
        function RemoveContainerIdContentModelProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        RemoveContainerIdContentModelProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            Editor.ContainerProvider.getContainers(contents).removeAttr("id");
        };
        /**
         * Returns the name of the content model processor.
         */
        RemoveContainerIdContentModelProcessor.prototype.getName = function () {
            return "RemoveContainerIdContentModelProcessor";
        };
        /**
         * Dispose.
         */
        RemoveContainerIdContentModelProcessor.prototype.dispose = function () { };
        return RemoveContainerIdContentModelProcessor;
    }());
    Editor.RemoveContainerIdContentModelProcessor = RemoveContainerIdContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var RemoveBlockIdContentModelProcessor = /** @class */ (function () {
        function RemoveBlockIdContentModelProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        RemoveBlockIdContentModelProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            Editor.BlockProvider.getBlocks(contents).removeAttr("id");
        };
        /**
         * Returns the name of the content model processor.
         */
        RemoveBlockIdContentModelProcessor.prototype.getName = function () {
            return "RemoveBlockIdContentModelProcessor";
        };
        /**
         * Dispose.
         */
        RemoveBlockIdContentModelProcessor.prototype.dispose = function () { };
        return RemoveBlockIdContentModelProcessor;
    }());
    Editor.RemoveBlockIdContentModelProcessor = RemoveBlockIdContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var SetSectionIdContentModelProcessor = /** @class */ (function () {
        function SetSectionIdContentModelProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        SetSectionIdContentModelProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            var sections = Editor.SectionProvider.getSections(contents);
            sections.each(function (i, section) {
                if (String.isNullUndefinedOrWhitespace(Editor.CommonUtils.getId($(section)))) {
                    var id = UniqueId.generate("section");
                    Editor.CommonUtils.setId($(section), id);
                }
            });
        };
        /**
         * Returns the name of the content model processor.
         */
        SetSectionIdContentModelProcessor.prototype.getName = function () {
            return "SetSectionIdContentModelProcessor";
        };
        /**
         * Dispose.
         */
        SetSectionIdContentModelProcessor.prototype.dispose = function () { };
        return SetSectionIdContentModelProcessor;
    }());
    Editor.SetSectionIdContentModelProcessor = SetSectionIdContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var SetContainerIdContentModelProcessor = /** @class */ (function () {
        function SetContainerIdContentModelProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        SetContainerIdContentModelProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            var containers = Editor.ContainerProvider.getContainers(contents);
            containers.each(function (i, container) {
                if (String.isNullUndefinedOrWhitespace(Editor.CommonUtils.getId($(container)))) {
                    var id = UniqueId.generate("container");
                    Editor.CommonUtils.setId($(container), id);
                }
            });
        };
        /**
         * Returns the name of the content model processor.
         */
        SetContainerIdContentModelProcessor.prototype.getName = function () {
            return "SetContainerIdContentModelProcessor";
        };
        /**
         * Dispose.
         */
        SetContainerIdContentModelProcessor.prototype.dispose = function () { };
        return SetContainerIdContentModelProcessor;
    }());
    Editor.SetContainerIdContentModelProcessor = SetContainerIdContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var SetBlockIdContentModelProcessor = /** @class */ (function () {
        function SetBlockIdContentModelProcessor() {
        }
        /**
         * Performs a content upgrade/resolution setup on the editor content model.
         */
        SetBlockIdContentModelProcessor.prototype.process = function (documentContent) {
            var contents = $(documentContent).contents();
            var blocks = Editor.BlockProvider.getBlocks(contents);
            blocks.each(function (_, block) {
                if (String.isNullUndefinedOrWhitespace(Editor.CommonUtils.getId($(block)))) {
                    var id = UniqueId.generate("block");
                    Editor.CommonUtils.setId($(block), id);
                }
            });
        };
        /**
         * Returns the name of the content model processor.
         */
        SetBlockIdContentModelProcessor.prototype.getName = function () {
            return "SetBlockIdContentModelProcessor";
        };
        /**
         * Dispose.
         */
        SetBlockIdContentModelProcessor.prototype.dispose = function () { };
        return SetBlockIdContentModelProcessor;
    }());
    Editor.SetBlockIdContentModelProcessor = SetBlockIdContentModelProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Adds an non-displayable div to the editor content model.
     */
    var SetupEqualHeightsProcessor = /** @class */ (function () {
        function SetupEqualHeightsProcessor(addChildMargin) {
            if (addChildMargin === void 0) { addChildMargin = false; }
            this.addChildMargin = addChildMargin;
        }
        SetupEqualHeightsProcessor.prototype.process = function (documentContent) {
            var body = $(documentContent).find("body")[0];
            this.equalSectionDefaultHeights(body);
        };
        SetupEqualHeightsProcessor.prototype.getName = function () {
            return "SetupEqualHeightsProcessor";
        };
        SetupEqualHeightsProcessor.prototype.dispose = function () {
        };
        SetupEqualHeightsProcessor.prototype.equalSectionDefaultHeights = function (workingBodyElement) {
            var _this = this;
            var iframe = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName)[0];
            var body = iframe.contentDocument.getElementsByTagName("body")[0];
            var sections = $(body).find("[" + Editor.Contract.dataSectionAttrName + "]");
            sections.each(function (index, section) { return _this.equalSectionDefaultHeightsForSection($(section), workingBodyElement); });
        };
        SetupEqualHeightsProcessor.prototype.equalSectionDefaultHeightsForSection = function (sectionEl, workingBodyElement) {
            var _this = this;
            var containers = sectionEl.find("[" + Editor.Contract.containerAttrName + "]");
            var maxHeight = 0;
            containers.each(function (containerIndex, container) {
                // Check the height with elements and max height set to choose the max value.
                // If container contains dynamic content, the height is not calculated, because it's not valid.
                var html = $(container).html();
                if (!(html.includes("{{") && html.includes("}}"))) {
                    maxHeight = Math.max(maxHeight, _this.containerHeightFromChildren(container));
                }
                maxHeight = Math.max(maxHeight, parseFloat($(container).css("min-height")) + _this.sumPaddingAndMargin(container));
            });
            containers.each(function (containerIndex, container) {
                var containerId = $(container).attr("id");
                var workingContainer = $(workingBodyElement).find("#" + containerId);
                workingContainer.css("min-height", maxHeight - _this.sumPaddingAndMargin(container));
                workingContainer.removeAttr("id");
            });
        };
        SetupEqualHeightsProcessor.prototype.containerHeightFromChildren = function (container) {
            var _this = this;
            var heightSum = 0;
            $(container).children().each(function (index, child) { return heightSum = heightSum + _this.childHeight(child); });
            heightSum = heightSum + this.sumPaddingAndMargin(container);
            return heightSum;
        };
        SetupEqualHeightsProcessor.prototype.childHeight = function (element) {
            var elementHeight = parseFloat($(element).css("height")) + this.sumChildMargin(element);
            if (element.children.length > 0) {
                // This fixes the pages css where the image wrapper element has incorrect height.
                var firstChild = element.children[0];
                var firstChildHeight = parseFloat($(firstChild).css("height")) + this.sumChildMargin(firstChild);
                return firstChildHeight > elementHeight ? firstChildHeight : elementHeight;
            }
            return elementHeight;
        };
        SetupEqualHeightsProcessor.prototype.sumPaddingAndMargin = function (element) {
            return parseFloat($(element).css("margin-top"))
                + parseFloat($(element).css("padding-top"))
                + parseFloat($(element).css("padding-bottom"))
                + parseFloat($(element).css("margin-bottom"));
        };
        SetupEqualHeightsProcessor.prototype.sumChildMargin = function (child) {
            return this.addChildMargin
                ? (parseFloat($(child).css("margin-top")) + parseFloat($(child).css("margin-bottom")))
                : 0;
        };
        SetupEqualHeightsProcessor.prototype.containsHeightMediaQuery = function (documentContent) {
            var styleTagsCount = $(documentContent).find("style").length;
            if (styleTagsCount === 0) {
                return false;
            }
            for (var i = 0; i < styleTagsCount; i++) {
                var styleContent = $(documentContent).find("style")[i].innerHTML;
                if (SetupEqualHeightsProcessor.TEST_HEIGHT_CSS_RULE_REGEX.test(styleContent)) {
                    return true;
                }
            }
            return false;
        };
        SetupEqualHeightsProcessor.TEST_HEIGHT_CSS_RULE_REGEX = /\@media\s+only\s+screen\s+and\s+\(\s*max-width:\s*768px\s*\)\s*\{[^}]*.columnContainer\s*\{[^}]*min-height\s*:\s*70px\s*!important\s*;/i;
        return SetupEqualHeightsProcessor;
    }());
    Editor.SetupEqualHeightsProcessor = SetupEqualHeightsProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Adds background images for columns to generated css, as the ones in style were getting removed by yahoo.
     */
    var YahooEmailBackgroundPostProcessor = /** @class */ (function () {
        function YahooEmailBackgroundPostProcessor() {
        }
        YahooEmailBackgroundPostProcessor.prototype.process = function (documentContent) {
            var containers = $(documentContent).find("[" + Editor.Contract.containerAttrName + "='true']");
            var sections = $(documentContent).find("[" + Editor.Contract.dataSectionAttrName + "='true']");
            var extraCss = this.updateBackgrounds(YahooEmailBackgroundPostProcessor.CONTAINER_CSS_CLASS_PREFIX + "cl", containers)
                + this.updateBackgrounds(YahooEmailBackgroundPostProcessor.CONTAINER_CSS_CLASS_PREFIX + "sc", sections);
            this.appendStyleToDocument(documentContent, extraCss);
        };
        YahooEmailBackgroundPostProcessor.prototype.getName = function () {
            return "YahooEmailBackgroundPostProcessor";
        };
        YahooEmailBackgroundPostProcessor.prototype.dispose = function () {
        };
        YahooEmailBackgroundPostProcessor.prototype.updateBackgrounds = function (cssPrefix, columnContainers) {
            var extraCss = [];
            columnContainers.each(function (index, columnContainerEl) {
                var columnContainer = $(columnContainerEl);
                var columnClass = "" + cssPrefix + index;
                var backgroundImageCssArr = columnContainer.attr("style")
                    .split(";")
                    .filter(function (item) { return !!item.match(/background-image\s*\:/); });
                if (backgroundImageCssArr.length < 1) {
                    return;
                }
                columnContainer.addClass(columnClass);
                extraCss.push("." + columnClass + "{" + backgroundImageCssArr[0] + "}");
            });
            return extraCss.join("");
        };
        YahooEmailBackgroundPostProcessor.prototype.appendStyleToDocument = function (document, newStyle) {
            $("<style>" + newStyle + "</style>").appendTo($(document).find("head"));
        };
        YahooEmailBackgroundPostProcessor.CONTAINER_CSS_CLASS_PREFIX = "yhpostbackgroundcss";
        return YahooEmailBackgroundPostProcessor;
    }());
    Editor.YahooEmailBackgroundPostProcessor = YahooEmailBackgroundPostProcessor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CkEditorContentStyleSetFactory = /** @class */ (function () {
        function CkEditorContentStyleSetFactory() {
        }
        CkEditorContentStyleSetFactory.prototype.createStyleSet = function () {
            return [
                /* Block Styles */
                { name: "Italic Title", element: "h2", styles: { "font-style": "italic" } },
                // prettier-ignore
                { name: "Subtitle", element: "h3", styles: { "color": "#aaa", "font-style": "italic" } },
                {
                    name: "Special Container",
                    element: "div",
                    styles: {
                        padding: "5px 10px",
                        background: "#eee",
                        border: "1px solid #ccc"
                    }
                },
                /* Inline Styles */
                { name: "Big", element: "big" },
                { name: "Small", element: "small" },
                { name: "Typewriter", element: "tt" },
                { name: "Computer Code", element: "code" },
                { name: "Keyboard Phrase", element: "kbd" },
                { name: "Sample Text", element: "samp" },
                { name: "Variable", element: "var" },
                { name: "Deleted Text", element: "del" },
                { name: "Inserted Text", element: "ins" },
                { name: "Cited Work", element: "cite" },
                { name: "Inline Quotation", element: "q" },
                { name: "Language: RTL", element: "span", attributes: { dir: "rtl" } },
                { name: "Language: LTR", element: "span", attributes: { dir: "ltr" } },
                /* Object Styles */
                {
                    name: "Compact table",
                    element: "table",
                    attributes: {
                        cellpadding: "5",
                        cellspacing: "0",
                        border: "1",
                        bordercolor: "#ccc"
                    },
                    styles: {
                        "border-collapse": "collapse"
                    }
                },
                {
                    name: "Borderless Table",
                    element: "table",
                    styles: { "border-style": "hidden", "background-color": "#E6E6FA" }
                },
                { name: "Square Bulleted List", element: "ul", styles: { "list-style-type": "square" } }
            ];
        };
        return CkEditorContentStyleSetFactory;
    }());
    Editor.CkEditorContentStyleSetFactory = CkEditorContentStyleSetFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * A class containing exceptions from the CkEditor ENTER_P mode.
     */
    var CkEditorEnterModeExceptions = /** @class */ (function () {
        function CkEditorEnterModeExceptions() {
        }
        /**
         * Contains a list of Html tags that require to use the CkEditor ENTER_BR mode,
         * in order to avoid having these elements wrapped in a <p> tag.
         */
        CkEditorEnterModeExceptions.enterBrTagList = ["div", "a", "img", "table"];
        return CkEditorEnterModeExceptions;
    }());
    Editor.CkEditorEnterModeExceptions = CkEditorEnterModeExceptions;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ContainerRenderedEventArgs = /** @class */ (function (_super) {
        __extends(ContainerRenderedEventArgs, _super);
        function ContainerRenderedEventArgs(element) {
            var _this = _super.call(this) || this;
            _this.element = element;
            return _this;
        }
        return ContainerRenderedEventArgs;
    }(Editor.EventArgs));
    Editor.ContainerRenderedEventArgs = ContainerRenderedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Event args for the designer drag start event.
     */
    var DesignerDragStartEventArgs = /** @class */ (function (_super) {
        __extends(DesignerDragStartEventArgs, _super);
        function DesignerDragStartEventArgs(block) {
            var _this = _super.call(this, null) || this;
            _this.block = block;
            return _this;
        }
        return DesignerDragStartEventArgs;
    }(Editor.EventArgs));
    Editor.DesignerDragStartEventArgs = DesignerDragStartEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ElementFocusedEventArgs = /** @class */ (function (_super) {
        __extends(ElementFocusedEventArgs, _super);
        function ElementFocusedEventArgs(element) {
            var _this = _super.call(this) || this;
            _this.element = element;
            return _this;
        }
        return ElementFocusedEventArgs;
    }(Editor.EventArgs));
    Editor.ElementFocusedEventArgs = ElementFocusedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ElementRenderedEventArgs = /** @class */ (function (_super) {
        __extends(ElementRenderedEventArgs, _super);
        function ElementRenderedEventArgs(element) {
            var _this = _super.call(this) || this;
            _this.element = element;
            return _this;
        }
        return ElementRenderedEventArgs;
    }(Editor.EventArgs));
    Editor.ElementRenderedEventArgs = ElementRenderedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Arguments associated to event sectionToolsPublishCompleted in order to notify that tool publishing has ended for a specific section.
     */
    var SectionToolsPublishCompletedEventArgs = /** @class */ (function (_super) {
        __extends(SectionToolsPublishCompletedEventArgs, _super);
        function SectionToolsPublishCompletedEventArgs(sectionName) {
            var _this = _super.call(this) || this;
            _this.sectionName = sectionName;
            return _this;
        }
        /**
         * Gets the section name.
         */
        SectionToolsPublishCompletedEventArgs.prototype.getSectionName = function () {
            return this.sectionName;
        };
        return SectionToolsPublishCompletedEventArgs;
    }(Editor.EventArgs));
    Editor.SectionToolsPublishCompletedEventArgs = SectionToolsPublishCompletedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Arguments associated to event sectionToolsPublishStarted in order to notify that tool publishing has started for a specific section.
     */
    var SectionToolsPublishStartedEventArgs = /** @class */ (function (_super) {
        __extends(SectionToolsPublishStartedEventArgs, _super);
        function SectionToolsPublishStartedEventArgs(sectionName) {
            var _this = _super.call(this) || this;
            _this.sectionName = sectionName;
            return _this;
        }
        /**
         * Gets the section name.
         */
        SectionToolsPublishStartedEventArgs.prototype.getSectionName = function () {
            return this.sectionName;
        };
        return SectionToolsPublishStartedEventArgs;
    }(Editor.EventArgs));
    Editor.SectionToolsPublishStartedEventArgs = SectionToolsPublishStartedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Tool published event args used to notify ToolboxView in order to add new tools and blocks dynamically.
     */
    var ToolPublishedEventArgs = /** @class */ (function (_super) {
        __extends(ToolPublishedEventArgs, _super);
        function ToolPublishedEventArgs(tool, sectionName) {
            var _this = _super.call(this) || this;
            _this.tool = tool;
            _this.sectionName = sectionName;
            return _this;
        }
        /**
         * Gets the tool.
         */
        ToolPublishedEventArgs.prototype.getTool = function () {
            return this.tool;
        };
        /**
         * Gets the section name.
         */
        ToolPublishedEventArgs.prototype.getSectionName = function () {
            return this.sectionName;
        };
        return ToolPublishedEventArgs;
    }(Editor.EventArgs));
    Editor.ToolPublishedEventArgs = ToolPublishedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DelayScheduler = MktSvc.Controls.Common.DelayScheduler;
    var ArrayQuery = MktSvc.Controls.Common.ArrayQuery;
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    var TraceLevel = MktSvc.Controls.Common.TraceLevel;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    /**
     * Content editor class is responsible for setting the html content and initializing all blocks and containers.
     * This class raises:
     *   - content changed event
     *   - selection changed event
     */
    var FullPageContentEditor = /** @class */ (function (_super) {
        __extends(FullPageContentEditor, _super);
        /**
         * Creates the content editor.
         * @param containerId - An id of a container in which the content editor should be placed.
         */
        function FullPageContentEditor(containerId, ckEditorProxy, keyboardCommandManager, executionContext, fullPageToolbarConfig, imagePlaceholderHelper, accessibilityInstructions, preProcessors, postProcessors, hooks) {
            var _this = _super.call(this, containerId) || this;
            _this.minHeight = 540;
            _this.fullPageSuffix = "FullPage_";
            _this.ckEditorProxy = null;
            _this.iframe = null;
            _this.innerIFrame = null;
            _this.fullPageToolbarConfig = new Editor.BasicFullPageToolbar();
            _this.modifiedElementIds = [];
            _this.firefoxKeydownEventDelay = 300;
            _this.onContentModelInitialized = function (eventArgs) {
                _this.documentContentModel = eventArgs.documentContentModel;
            };
            _this.onContentModelUpdated = function (eventArgs) {
                _this.documentContentModel.isDesignerContent()
                    ? _this.keyboardCommandManager.unregisterCommand(_this.keyboardCommand)
                    : _this.keyboardCommandManager.registerCommand(_this.keyboardCommand);
                _this.setContent(eventArgs);
            };
            _this.onMaximizeExecuted = function (eventArgs) {
                _this.isFullScreen = eventArgs.isFullscreen;
                $(window).one("animationstart", _this.onAnimationStart);
                $(window).one("animationend", _this.onAnimationEnd);
                _this.resizeTimer.schedule();
            };
            _this.onAnimationStart = function (event) {
                if ($(event.target).find("#" + _this.id).length) {
                    _this.resizeTimer.stop(true);
                }
            };
            _this.onAnimationEnd = function (event) {
                if ($(event.target).find("#" + _this.id).length) {
                    _this.resizeTimer.stop(true);
                    _this.resizeEditor();
                }
            };
            _this.ckEditorProxy = ckEditorProxy;
            if (!Utility.isNullOrUndefined(fullPageToolbarConfig)) {
                _this.fullPageToolbarConfig = fullPageToolbarConfig;
            }
            if (Utility.isNullOrUndefined(imagePlaceholderHelper)) {
                imagePlaceholderHelper = new Editor.ImagePlaceholderHelper(); // tslint:disable-line
            }
            _this.imagePlaceholderHelper = imagePlaceholderHelper;
            _this.keyboardCommandManager = keyboardCommandManager;
            _this.executionContext = executionContext;
            _this.accessibilityInstructions = accessibilityInstructions;
            _this.preProcessors = preProcessors;
            _this.postProcessors = postProcessors;
            _this.hooks = hooks;
            return _this;
        }
        /**
         * Initializes the designer editor.
         * @param eventBroker - The event broker.
         */
        FullPageContentEditor.prototype.init = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.eventBroker.subscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
            this.eventBroker.subscribe(Editor.EventConstants.maximizeExecuted, this.onMaximizeExecuted);
            this.changeTimer = new DelayScheduler(this.eventBroker, Editor.DesignerInternalEventConstants.fullPageNonEventPropagationStart, Editor.DesignerInternalEventConstants.fullPageNonEventPropagationEnd);
            this.changeTimer.init(function () { return _this.broadcastContentChanged(); });
            this.eventBroker.subscribe(Editor.EventConstants.fullPageEditorContentChanged, function () {
                var modifiedElementId = _this.ckEditorProxy.getChildEditableElementId(null, _this.fullPageSuffix);
                if (!String.isNullUndefinedOrWhitespace(modifiedElementId)) {
                    if (_this.modifiedElementIds.indexOf(modifiedElementId) === -1) {
                        _this.modifiedElementIds.push(modifiedElementId);
                    }
                    _this.changeTimer.schedule();
                }
            });
            this.resizeTimer = new DelayScheduler(this.eventBroker);
            this.resizeTimer.init(function () {
                $(window).off("animationstart", _this.onAnimationStart);
                $(window).off("animationend", _this.onAnimationEnd);
                _this.resizeEditor();
            });
            this.keyboardCommand = new KeyboardCommand(KeyboardKeyCodes.oneKey, [KeyboardModifierType.Alt], function () {
                if (!_this.documentContentModel.isDesignerContent()) {
                    $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.fullPageContentEditorcssClass))
                        .focus()
                        .click();
                }
            });
            this.eventBroker.subscribe(Editor.EventConstants.contentModelUpdated, this.onContentModelUpdated);
            if (Utility.isNullOrUndefined(this.onImageSourceChanged)) {
                this.eventBroker.subscribe(Editor.EventConstants.imageAttributeChanged, (this.onImageSourceChanged = function (eventArgs) {
                    return _this.updateImageSource(eventArgs);
                }));
            }
            if (this.hooks != null) {
                this.hooks.forEach(function (hook) {
                    hook.init(eventBroker, function () {
                        return _this.sourceHtml;
                    }, function (source) {
                        _this.broadcastContentChanged(source);
                        _this.updateContent();
                    });
                });
            }
        };
        /**
         * Activates the view - the view becomes visible
         */
        FullPageContentEditor.prototype.activate = function () {
            _super.prototype.activate.call(this);
            this.render();
            this.resizeEditor();
            Editor.AccessibilityInstructionsPopup.accessibilityInstructions =
                this.accessibilityInstructions || Editor.EditorAccessibilityInstructions.baseFullPageAccessibilityInstructions;
            if (Editor.CommonUtils.isIOS() && this.iframe) {
                $(this.iframe)
                    .contents()
                    .find("html")
                    .show();
            }
        };
        /**
         * Dectivates the view - the view becomes invisible
         */
        FullPageContentEditor.prototype.deactivate = function () {
            _super.prototype.deactivate.call(this);
            this.changeTimer.stop();
            if (Editor.CommonUtils.isIOS() && this.iframe) {
                $(this.iframe)
                    .contents()
                    .find("html")
                    .hide();
            }
        };
        /**
         * Sets the new editor content
         * @param eventArgs - The ContentChangedEventArgs.
         */
        FullPageContentEditor.prototype.setContent = function (eventArgs) {
            var _this = this;
            if (this.changeTimer.isRunning()) {
                return;
            }
            if (eventArgs.sourceId === this.id || eventArgs.originalSourceId === this.id) {
                return;
            }
            if (eventArgs.html === this.sourceHtml) {
                return;
            }
            this.runThroughSanitazationIfNeeded(eventArgs.html, function (html) {
                _this.sourceHtml = _this.runPreProcessors(html);
                if (!_this.isActive) {
                    return;
                }
                _this.render();
            });
        };
        /**
         * Checks if content of @html needs to be sanitized and if so -> returns sanitized content.
         */
        FullPageContentEditor.prototype.runThroughSanitazationIfNeeded = function (html, done) {
            var _this = this;
            var contentSanitizer = this.executionContext.getContentSanitizer();
            if (this.executionContext.shouldFullPageEditorBeSanitized()) {
                contentSanitizer.init(function () {
                    var doctype = "" + Editor.CommonUtils.getDocTypeFromString(html);
                    var doc = Editor.CommonUtils.getNewContentDocument(html);
                    var whiteListedHeadChildren = _this.getWhiteListedHeadChildren(doc);
                    contentSanitizer.getSanitizedContent(doc.body.outerHTML, function (sanitized) {
                        var restructuredHTML = _this.getSanitizedRestructuredHTML(sanitized.html(), whiteListedHeadChildren);
                        var finalHTML = doctype.length === 0 ? restructuredHTML : doctype + "\n" + restructuredHTML;
                        done(finalHTML);
                    });
                });
            }
            else {
                done(html);
            }
        };
        FullPageContentEditor.prototype.getWhiteListedHeadChildren = function (doc) {
            return [].slice.call(doc.head.children).filter(function (child) {
                return Editor.CommonUtils.whitelistOfHeadTags.indexOf(child.tagName) !== -1;
            });
        };
        FullPageContentEditor.prototype.getSanitizedRestructuredHTML = function (html, whiteListedHeadChildren) {
            var sanitizedDoc = Editor.CommonUtils.getNewContentDocument(html);
            whiteListedHeadChildren.forEach(function (child) {
                sanitizedDoc.head.appendChild(child);
            });
            return sanitizedDoc.documentElement.outerHTML;
        };
        FullPageContentEditor.prototype.runProcessor = function (oldHtml, processors) {
            var _this = this;
            var wipHtml = oldHtml;
            if (processors != null) {
                processors.forEach(function (processor) {
                    _this.executionContext.tryExecute(function () {
                        wipHtml = processor.process(wipHtml);
                    }, "Run the " + processor.getName() + " processor", false, function () {
                        _this.executionContext.getLogger().log(TraceLevel.Error, "Editor.FullPageContentEditor.runProcessor", new Dictionary({
                            Processor: processor.getName(),
                            Message: "Failed to process content successfully"
                        }));
                        throw new Error("\"" + processor.getName() + "\" failed to process content successfully.");
                    });
                });
            }
            return wipHtml;
        };
        FullPageContentEditor.prototype.runPreProcessors = function (oldHtml) {
            return this.runProcessor(oldHtml, this.preProcessors);
        };
        FullPageContentEditor.prototype.runPostProcessors = function (oldHtml) {
            return this.runProcessor(oldHtml, this.postProcessors);
        };
        FullPageContentEditor.prototype.render = function () {
            var _this = this;
            if (Utility.isNullOrUndefined(this.iframe)) {
                this.fullPageEditorIsLoading = true;
                // Render the html content under an iframe
                var iframeId_1 = UniqueId.generate("foreignContentEditor");
                this.setupEditorIframe(iframeId_1);
                this.ckEditorProxy.init(this.iframe, function () {
                    var ckEditor = _this.ckEditorProxy.createEditor(Editor.CommonUtils.getById(iframeId_1, $($(_this.iframe)).contents()), _this.fullPageToolbarConfig);
                    _this.onCkEditorInitialized = _this.eventBroker.subscribe(Editor.EventConstants.standardCkEditorInitialized, function (eventArgs) {
                        _this.ckEditorProxy.registerPlugins();
                        _this.keyboardCommandManager.registerCommandsInIframe(_this.iframe);
                        _this.innerIFrame = $(_this.iframe)
                            .contents()
                            .find("iframe")
                            .get(0);
                        $(_this.innerIFrame).attr("role", "presentation");
                        // Fix for the issue with focus in some browsers except Firefox: customers need to press 'tab' key twice to set focus inside editor
                        $(_this.iframe).on("focus", function () {
                            _this.ckEditorProxy.setEditorFocus(eventArgs.ckEditorInstanceName);
                        });
                        // Workaround for the issue with focus in Firefox 57+: customers can't navigate inside editor content via keyboard
                        if (Editor.CommonUtils.isFirefox()) {
                            var editorInternalFrameDocument_1 = _this.innerIFrame.contentDocument;
                            var selectionManager_1 = new MktSvcCommon.SelectionManager();
                            selectionManager_1.setup(editorInternalFrameDocument_1);
                            $(_this.iframe)
                                .contents()
                                .on("focus", function () {
                                _this.ckEditorProxy.setEditorFocus(eventArgs.ckEditorInstanceName, function () {
                                    // Set caret position inside first nested element without child elements
                                    var editableElement = $(editorInternalFrameDocument_1)
                                        .find("body")
                                        .find(":not(:has(*))")
                                        .get(0);
                                    if (editableElement) {
                                        selectionManager_1.setCaretPosition(editableElement, 0);
                                    }
                                });
                            });
                            $(_this.innerIFrame).on("load", function () {
                                // Use delay for Firefox because even if CkEditorInitialized fired internal ckeditor might be not ready
                                setTimeout(function () {
                                    $(_this.innerIFrame)
                                        .contents()
                                        .on("keydown", function (e) {
                                        var keyPressed = e.which || e.keyCode;
                                        if (keyPressed === KeyCodes.Tab && e.shiftKey) {
                                            e.preventDefault();
                                            $("." + Editor.CommonConstants.menuBarCssClass + " :tabbable:last").focus();
                                        }
                                    });
                                }, _this.firefoxKeydownEventDelay);
                            });
                        }
                        _this.elementId = ckEditor.element.getId();
                        _this.updateContent();
                        Editor.CommonUtils.appendElementToHead($(_this.iframe).contents(), _this.getCustomCkEditorStylesElement());
                        _this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(_this.id));
                        _this.fullPageEditorIsLoading = false;
                    });
                });
            }
            else if (!this.fullPageEditorIsLoading) {
                this.ckEditorProxy.registerPlugins();
                this.updateContent();
            }
        };
        FullPageContentEditor.prototype.setupEditorIframe = function (id) {
            this.iframe = document.createElement("iframe");
            var $iframe = $(this.iframe);
            $iframe.attr("title", this.executionContext.getLocalizationProvider().getLocalizedString("[FULL PAGE]"));
            $iframe.addClass(Editor.CommonConstants.fullPageContentEditorFrameClassName);
            // Cleanup the content render the toolbar
            var wrapper = document.createElement("div");
            wrapper.classList.add("fullPageEditorFrameWrapper");
            wrapper.appendChild(this.iframe);
            var $editor = this.getElement();
            $editor.empty();
            $editor[0].appendChild(wrapper);
            this.initialHeight = this.isFullScreen ? this.minHeight : $iframe.height();
            this.iframe.contentWindow.document.open();
            this.iframe.contentWindow.document.write(String.Format('{0}<html lang="{1}"><head></head><body tabindex="-1"><textarea style="display:none" id={2} contenteditable="true">' +
                this.getFullPageHtmlDocument().outerHTML +
                "</textarea></body></html>", FullPageContentEditor.safeDocumentDoctype, this.executionContext.getLocalizationProvider().getLanguageName(), id));
            this.iframe.contentWindow.document.close();
        };
        FullPageContentEditor.prototype.updateContent = function () {
            var _this = this;
            // Set data in the editor and update textarea.
            var contentDocument = this.getFullPageHtmlDocument();
            // Add image placeholders if needed
            var allImages = $(contentDocument)
                .find("img")
                .toArray();
            if (this.hooks != null) {
                allImages = allImages.filter(function (el) {
                    var process = true;
                    _this.hooks.forEach(function (hook) {
                        if (process) {
                            process = !hook.shouldAvoidDecoration($(el));
                        }
                    });
                    return process;
                });
            }
            allImages.forEach(function (element) {
                var image = $(element);
                image.attr(Editor.CommonConstants.designerImageSourceAttributeName, image.attr("src"));
                _this.decorateImageOverlay(image, image.attr("src"));
            });
            this.ckEditorProxy.setContent(contentDocument.outerHTML, null, function () {
                // Prevent updates right after setting the content
                _this.cancelPendingOperations();
                $(_this.innerIFrame).ready(function () {
                    $(_this.innerIFrame.contentDocument).off("keydown");
                    _this.keyboardCommandManager.registerCommandsInIframe(_this.innerIFrame);
                });
                _this.eventBroker.notify(Editor.EventConstants.fullPageEditorRendered, new Editor.FullPageEditorRenderedEventArgs(_this.elementId));
            });
        };
        FullPageContentEditor.prototype.broadcastContentChanged = function (tempSource) {
            var tempResolvedDocument;
            if (tempSource) {
                tempResolvedDocument = Editor.CommonUtils.getNewContentDocument(tempSource);
            }
            else {
                tempResolvedDocument = Editor.CommonUtils.getNewContentDocument(this.ckEditorProxy.getContent());
            }
            // Remove image placeholders from final content
            var images = $(tempResolvedDocument).find("img");
            var unconfiguredImages = images.filter(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.designerUnconfiguredContentOverlayCssClassName));
            unconfiguredImages.each(function (index, element) {
                var image = $(element);
                Editor.CommonUtils.removeImageOverlay(image);
            });
            images.removeAttr(Editor.CommonConstants.designerImageSourceAttributeName);
            this.mergeUpdatedNodes(tempResolvedDocument);
            this.removeFullPageSuffixFromIds(tempResolvedDocument);
            this.modifiedElementIds = [];
            var doctype = "";
            if (this.sourceHtml) {
                doctype = Editor.CommonUtils.getDocTypeFromString(this.sourceHtml);
            }
            this.sourceHtml = Utility.isNullOrUndefined(this.documentContentModel)
                ? Editor.CommonUtils.getDocumentContent(tempResolvedDocument)
                : this.documentContentModel.extractContentFromDocument(tempResolvedDocument);
            var newHtml = doctype.length === 0 || Editor.CommonUtils.isContentContainingDoctype(this.sourceHtml)
                ? this.runPostProcessors(this.sourceHtml)
                : doctype + "\n" + this.runPostProcessors(this.sourceHtml);
            this.eventBroker.notify(Editor.EventConstants.contentChanged, new Editor.ContentChangedEventArgs(newHtml, this.id, null, Editor.CommonConstants.fullPageEditorComponentName));
        };
        FullPageContentEditor.prototype.dispose = function () {
            var _this = this;
            this.executionContext.tryExecute(function () {
                if (!Utility.isNullOrUndefined(_this.eventBroker)) {
                    _this.eventBroker.unsubscribe(Editor.EventConstants.contentModelInitialized, _this.onContentModelInitialized);
                    _this.eventBroker.unsubscribe(Editor.EventConstants.standardCkEditorInitialized, _this.onCkEditorInitialized);
                    _this.eventBroker.unsubscribe(Editor.EventConstants.contentModelUpdated, _this.onContentModelUpdated);
                    _this.eventBroker.unsubscribe(Editor.EventConstants.maximizeExecuted, _this.onMaximizeExecuted);
                    _this.eventBroker.unsubscribe(Editor.EventConstants.imageAttributeChanged, _this.onImageSourceChanged);
                    if (_this.hooks != null) {
                        _this.hooks.forEach(function (hook) {
                            hook.dispose();
                        });
                    }
                    _this.onImageSourceChanged = null;
                }
                if (!Utility.isNullOrUndefined(_this.keyboardCommandManager)) {
                    _this.keyboardCommandManager.unregisterCommandsInIframe(_this.innerIFrame);
                    _this.keyboardCommandManager.unregisterCommandsInIframe(_this.iframe);
                }
                _this.cancelPendingOperations();
                _this.ckEditorProxy.dispose();
                _this.documentContentModel = null;
                _this.keyboardCommandManager = null;
                _this.modifiedElementIds = null;
                _this.eventBroker = null;
                _this.elementId = null;
                $(_this.innerIFrame).off();
                $(_this.innerIFrame).remove();
                $(_this.iframe).off();
                $(_this.iframe).remove();
                _this.fullPageEditorIsLoading = false;
                _this.getElement().empty();
                if (!Utility.isNullOrUndefined(_this.changeTimer)) {
                    _this.changeTimer.dispose();
                }
                if (!Utility.isNullOrUndefined(_this.resizeTimer)) {
                    _this.resizeTimer.stop(true);
                    _this.resizeTimer.dispose();
                }
            }, "Dispose the full page content editor");
        };
        FullPageContentEditor.prototype.cancelPendingOperations = function () {
            // Cancel all scheduled operations
            this.changeTimer.stop(true);
        };
        FullPageContentEditor.prototype.updateImageSource = function (eventArgs) {
            if (eventArgs.attributeName === Editor.CommonConstants.designerTextBlockImageSourceAttributeName) {
                eventArgs.imageElement.attr(Editor.CommonConstants.designerImageSourceAttributeName, eventArgs.attributeValue);
                this.decorateImageOverlay(eventArgs.imageElement, eventArgs.attributeValue);
            }
        };
        FullPageContentEditor.prototype.decorateImageOverlay = function (image, imageSrc) {
            if (this.imagePlaceholderHelper.isPlaceholderNeeded(imageSrc)) {
                Editor.CommonUtils.overlayImageElement(image, this.imagePlaceholderHelper.getImagePlaceholder(imageSrc));
            }
            else {
                Editor.CommonUtils.removeImageOverlay(image);
            }
        };
        FullPageContentEditor.prototype.mergeUpdatedNodes = function (tempResolvedDocument) {
            var updatedHtml = tempResolvedDocument.documentElement.outerHTML;
            var updatedHtmlDocument = $(Editor.CommonUtils.getNewContentDocument(updatedHtml).documentElement);
            new ArrayQuery(this.modifiedElementIds).each(function (nodeId) {
                var node = updatedHtmlDocument.find("#" + nodeId);
                var nodeInResolvedDocument = Editor.CommonUtils.getById(nodeId, $(tempResolvedDocument).contents());
                if (nodeInResolvedDocument.length) {
                    nodeInResolvedDocument.get(0).outerHTML = node.get(0) ? node.get(0).outerHTML : String.Empty;
                }
            });
        };
        FullPageContentEditor.prototype.getFullPageHtmlDocument = function () {
            var _this = this;
            var safeDocument = Editor.CommonUtils.getNewContentDocument(Editor.CommonUtils.getWithDoctype(this.sourceHtml));
            $(safeDocument)
                .find("html")
                .attr("lang", this.executionContext.getLocalizationProvider().getLanguageName());
            Editor.CommonUtils.walkTree($(safeDocument.documentElement), function (node) {
                var avoid = false;
                if (_this.hooks != null) {
                    _this.hooks.forEach(function (hook) {
                        if (avoid === false) {
                            avoid = hook.shouldAvoidDecoration(node);
                        }
                    });
                }
                if (!avoid) {
                    var suffix = MktSvc.Controls.Common.UniqueId.generate(_this.fullPageSuffix);
                    var nodeId = node.attr("id");
                    if (String.isNullUndefinedOrWhitespace(nodeId)) {
                        nodeId = String.Empty;
                    }
                    var id = nodeId + suffix;
                    node.attr("id", id);
                }
            });
            return safeDocument.documentElement;
        };
        FullPageContentEditor.prototype.removeFullPageSuffixFromIds = function (tempResolvedDocument) {
            var _this = this;
            Editor.CommonUtils.walkTree($(tempResolvedDocument.documentElement), function (node) {
                var nodeId = node.attr("id");
                if (!String.isNullUndefinedOrWhitespace(nodeId)) {
                    var fullPageIdPosition = nodeId.indexOf(_this.fullPageSuffix, 0);
                    if (fullPageIdPosition !== -1) {
                        var originalNodeId = nodeId.substring(0, fullPageIdPosition);
                        if (String.isNullOrEmpty(originalNodeId)) {
                            node.removeAttr("id");
                        }
                        else {
                            node.attr("id", originalNodeId);
                        }
                    }
                }
            });
        };
        FullPageContentEditor.prototype.resizeEditor = function () {
            this.ckEditorProxy.resizeEditor(this.isFullScreen ? -1 : this.initialHeight);
        };
        FullPageContentEditor.prototype.getCustomCkEditorStylesElement = function () {
            return $("<style>")
                .attr("id", Editor.DesignerContentEditorStyles.ckEditorStylesId)
                .text(Editor.DesignerContentEditorStyles.ckEditorStyles);
        };
        FullPageContentEditor.safeDocumentDoctype = "<!DOCTYPE html>";
        return FullPageContentEditor;
    }(Editor.Control));
    Editor.FullPageContentEditor = FullPageContentEditor;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ArrayQuery = MktSvc.Controls.Common.ArrayQuery;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var DesignerContentEditorFactory = /** @class */ (function () {
        function DesignerContentEditorFactory() {
        }
        DesignerContentEditorFactory.prototype.create = function (plugin, executionContext, fcbList, eventBroker, designerFocusManager, keyboardCommandManager, blockDefinition, accessibilityInstructions, customCkEditorConfiguration, abTestingContext, enableZeroState) {
            if (abTestingContext === void 0) { abTestingContext = new Editor.AbTestingContext(eventBroker); }
            var usableBlockDefinition = blockDefinition || new Editor.BlockDefinitionFactory().create(plugin);
            var loader = new Editor.FrontEndDependenciesLoader(executionContext);
            loader.loadScript("webresource-dependency-touchpunch", "/jquery.ui.touchpunch/jquery.ui.touchpunch.js");
            var fontsProvider = new Editor.AdditionalFontsProvider(executionContext);
            var ckEditorHelper = new Editor.CkEditorProxy(executionContext, new Editor.CkEditorLocaleProvider(executionContext.getLocalizationProvider().getLocaleId(), executionContext.getLocalizationProvider().isRtl()), fontsProvider, eventBroker, customCkEditorConfiguration);
            var selectionStateModel = new Editor.SelectionStateModel(eventBroker, executionContext.getLogger());
            var selectedAreaDecorator = new Editor.SelectedAreaDecorator(eventBroker, blockDefinition, executionContext.getLogger(), executionContext.getLocalizationProvider(), [
                new Editor.SwitchAbTestFlagButton(eventBroker, executionContext.getLocalizationProvider(), abTestingContext),
                new Editor.ParentFlagButton(eventBroker, executionContext.getLocalizationProvider()),
                new Editor.DeleteFlagButton(eventBroker, executionContext.getLocalizationProvider(), blockDefinition),
                new Editor.MoveFlagButton(eventBroker, executionContext.getLocalizationProvider())
            ], fcbList);
            var designerCkEditorProxy = new Editor.InlineCkEditorProxy(eventBroker, ckEditorHelper, plugin, executionContext, customCkEditorConfiguration);
            var blockControllers = new ArrayQuery([
                new Editor.SelectableController(eventBroker),
                new Editor.BlockIdController(eventBroker),
                new Editor.BlockEditableController(eventBroker),
                new Editor.BlockDroppableController(eventBroker),
                new Editor.BlockDraggableController(eventBroker),
                new Editor.BlockInlineToolbarController(eventBroker, usableBlockDefinition, designerCkEditorProxy, plugin.getCommands()),
                new Editor.BlockLoadedController(eventBroker, usableBlockDefinition),
                new Editor.BlockClickedController(eventBroker),
                new Editor.BlockTabbableController(eventBroker),
                new Editor.BlockAddModeController(eventBroker, selectionStateModel, selectedAreaDecorator, executionContext.getLogger()),
                new Editor.BlockAbTestingController(eventBroker, abTestingContext, selectionStateModel)
            ]);
            var isZeroStateEnabled = enableZeroState === undefined ? false : enableZeroState;
            var containerControllers = new ArrayQuery([
                new Editor.ContainerIdController(eventBroker),
                new Editor.DroppableController(eventBroker, selectionStateModel, selectedAreaDecorator, executionContext.getLogger(), isZeroStateEnabled, fcbList),
                new Editor.DragModeController(eventBroker),
                new Editor.SortableController(eventBroker),
                new Editor.ContainerAddModeController(eventBroker)
            ]);
            var layoutControllers = new ArrayQuery([
                new Editor.SortableController(eventBroker),
                new Editor.DragModeController(eventBroker),
                new Editor.DroppableController(eventBroker, selectionStateModel, selectedAreaDecorator, executionContext.getLogger(), isZeroStateEnabled, fcbList)
            ]);
            var sectionControllers = new ArrayQuery([
                new Editor.SelectableController(eventBroker),
                new Editor.SectionLoadedController(eventBroker, fcbList),
                new Editor.SectionAddModeController(eventBroker, executionContext.getLogger(), isZeroStateEnabled),
                new Editor.SectionIdController(eventBroker)
            ]);
            var accessibilityNotificator = new Editor.AccessibilityNotificator();
            return new Editor.DesignerContentEditor(UniqueId.generate("designerEditorId"), blockControllers, containerControllers, layoutControllers, sectionControllers, usableBlockDefinition, designerFocusManager, keyboardCommandManager, executionContext, abTestingContext, accessibilityNotificator, selectionStateModel, selectedAreaDecorator, accessibilityInstructions, fcbList);
        };
        return DesignerContentEditorFactory;
    }());
    Editor.DesignerContentEditorFactory = DesignerContentEditorFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ControlToTabItemConverter = /** @class */ (function () {
        function ControlToTabItemConverter(eventBroker) {
            this.eventBroker = eventBroker;
        }
        ControlToTabItemConverter.prototype.convert = function (control, tabLabel, tabContentCssClassName, tabContentDataId) {
            var _this = this;
            return new Editor.TabControlItem(tabLabel, control.id, function () { return control.init(_this.eventBroker); }, function () { return control.activate(); }, function () { return control.deactivate(); }, function () { return control.dispose(); }, tabContentCssClassName, tabContentDataId, function () { return control.setFocus(); });
        };
        return ControlToTabItemConverter;
    }());
    Editor.ControlToTabItemConverter = ControlToTabItemConverter;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var FullPageContentEditorFactory = /** @class */ (function () {
        function FullPageContentEditorFactory() {
        }
        FullPageContentEditorFactory.prototype.create = function (plugin, executionContext, eventBroker, keyboardCommandManager, toolbarConfig, imagePlaceholderHelper, accessibilityInstructions, customCkEditorConfiguration, preProcessors, postProcessors, hooks) {
            var fontsProvider = new Editor.AdditionalFontsProvider(executionContext);
            var ckEditorHelper = new Editor.CkEditorProxy(executionContext, new Editor.CkEditorLocaleProvider(executionContext.getLocalizationProvider().getLocaleId(), executionContext.getLocalizationProvider().isRtl()), fontsProvider, eventBroker, customCkEditorConfiguration);
            var foreignContentCkEditorProxy = new Editor.StandardCkEditorProxy(eventBroker, ckEditorHelper, plugin, executionContext, customCkEditorConfiguration);
            return new Editor.FullPageContentEditor(UniqueId.generate("fullPageEditorId"), foreignContentCkEditorProxy, keyboardCommandManager, executionContext, toolbarConfig, imagePlaceholderHelper, accessibilityInstructions, preProcessors, postProcessors, hooks);
        };
        return FullPageContentEditorFactory;
    }());
    Editor.FullPageContentEditorFactory = FullPageContentEditorFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var AdditionalMessagePreviewContentData = /** @class */ (function () {
        function AdditionalMessagePreviewContentData() {
        }
        return AdditionalMessagePreviewContentData;
    }());
    Editor.AdditionalMessagePreviewContentData = AdditionalMessagePreviewContentData;
})(Editor || (Editor = {}));
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Button renderer factory
     */
    var ButtonRendererFactory = /** @class */ (function () {
        function ButtonRendererFactory() {
        }
        ButtonRendererFactory.prototype.create = function () {
            return new Editor.ButtonRenderer();
        };
        return ButtonRendererFactory;
    }());
    Editor.ButtonRendererFactory = ButtonRendererFactory;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Plugin to change element border in CKEditor.
     */
    var DividerBorderStyleCombo = /** @class */ (function () {
        /**
         * Initializes a new instance of the BorderCombo class.
         */
        function DividerBorderStyleCombo(command) {
            this.command = command;
        }
        /**
         * Gets the name of the combo.
         */
        DividerBorderStyleCombo.prototype.getName = function () {
            return "dividerBorderStyleCombo";
        };
        /**
         * Gets the label used with the combo.
         */
        DividerBorderStyleCombo.prototype.getLabel = function () {
            return "[Border]";
        };
        /**
         * Gets the label used with the item group in the combo.
         */
        DividerBorderStyleCombo.prototype.getGroup = function () {
            return "[Set border]";
        };
        /**
         * Gets the command associated with the combo.
         */
        DividerBorderStyleCombo.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * Gets the combo items.
         */
        DividerBorderStyleCombo.prototype.getItems = function () {
            // tslint:disable-line
            return new Array({ value: "Solid", text: "[Solid]" }, { value: "Dotted", text: "[Dotted]" }, { value: "Dashed", text: "[Dashed]" }, { value: "Double", text: "[Double]" }, { value: "None", text: "[None]" }); // tslint:disable-line
        };
        return DividerBorderStyleCombo;
    }());
    Editor.DividerBorderStyleCombo = DividerBorderStyleCombo;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Plugin to change element height in CKEditor.
     */
    var DividerHeightCombo = /** @class */ (function () {
        /**
         * Initializes a new instance of the DividerHeightCombo class.
         */
        function DividerHeightCombo(command) {
            this.numberOfItems = 20;
            this.command = command;
        }
        /**
         * Gets the name of the combo.
         */
        DividerHeightCombo.prototype.getName = function () {
            return "dividerHeightCombo";
        };
        /**
         * Gets the label used with the combo.
         */
        DividerHeightCombo.prototype.getLabel = function () {
            return "[Height]";
        };
        /**
         * Gets the label used with the item group in the combo.
         */
        DividerHeightCombo.prototype.getGroup = function () {
            return "[Set height]";
        };
        /**
         * Gets the command associated with the combo.
         */
        DividerHeightCombo.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * Gets the combo items.
         */
        DividerHeightCombo.prototype.getItems = function () {
            // tslint:disable-line
            var items = new Array(); // tslint:disable-line
            for (var i = 1; i <= this.numberOfItems; i++) {
                items.push({ value: i.toString(), text: i.toString() });
            }
            return items;
        };
        return DividerHeightCombo;
    }());
    Editor.DividerHeightCombo = DividerHeightCombo;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Command to set border of the selected divider block.
     */
    var SetDividerBorderStyleCommand = /** @class */ (function () {
        function SetDividerBorderStyleCommand() {
        }
        /**
         * @see ICommand.isContextSensitive
         */
        SetDividerBorderStyleCommand.prototype.isContextSensitive = function () {
            return false;
        };
        /**
         * Gets the name of the command.
         */
        SetDividerBorderStyleCommand.prototype.getName = function () {
            return SetDividerBorderStyleCommand.getName();
        };
        /**
         * Enabled if editor is in read only mode.
         */
        SetDividerBorderStyleCommand.prototype.enabledOnReadOnly = function () {
            return true;
        };
        /**
         * Gets the name of the command.
         */
        SetDividerBorderStyleCommand.getName = function () {
            return "borderStyleCommand";
        };
        /**
         * Configure the command.
         * @param eventBroker An instance of event broker.
         */
        SetDividerBorderStyleCommand.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        /**
         * Executes the command and clones the currently selected block.
         * @param selectedBlock The currently selected block.
         * @param wrappedBlock The top-wrapping element.
         * @param cleanBlock The clean block, without any wrappers.
         * @param selectedHtml The selected html, if any.
         */
        SetDividerBorderStyleCommand.prototype.exec = function (selectedBlock, wrappedBlock, selectedHtml, selectedValue) {
            if (Utility.isNullOrUndefined(selectedBlock)) {
                return false;
            }
            if (Utility.isNullOrUndefined(this.eventBroker)) {
                return false;
            }
            selectedBlock.find("p").css("border-bottom-style", selectedValue);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged);
            return true;
        };
        /**
         * @see ICommand.shouldSetToolHighlight
         */
        SetDividerBorderStyleCommand.prototype.shouldSetToolHighlight = function (element) {
            return false;
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        SetDividerBorderStyleCommand.prototype.dispose = function () { };
        /*
         * Cleans up the html elements that where added to the page
         */
        SetDividerBorderStyleCommand.prototype.cleanup = function (blockElements) { };
        return SetDividerBorderStyleCommand;
    }());
    Editor.SetDividerBorderStyleCommand = SetDividerBorderStyleCommand;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Command to set height of the selected divider block.
     */
    var SetDividerHeightCommand = /** @class */ (function () {
        function SetDividerHeightCommand() {
        }
        /**
         * @see ICommand.isContextSensitive
         */
        SetDividerHeightCommand.prototype.isContextSensitive = function () {
            return false;
        };
        /**
         * Gets the name of the command.
         */
        SetDividerHeightCommand.prototype.getName = function () {
            return SetDividerHeightCommand.getName();
        };
        /**
         * Enabled if editor is in read only mode.
         */
        SetDividerHeightCommand.prototype.enabledOnReadOnly = function () {
            return true;
        };
        /**
         * Gets the name of the command.
         */
        SetDividerHeightCommand.getName = function () {
            return "heightCommand";
        };
        /**
         * Configure the command with the event broker.
         * @param eventBroker An instance of event broker.
         */
        SetDividerHeightCommand.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        /**
         * Executes the command and clones the currently selected block.
         * @param selectedBlock The currently selected block.
         * @param wrappedBlock The top-wrapping element.
         * @param cleanBlock The clean block, without any wrappers.
         * @param selectedHtml The selected html, if any.
         */
        SetDividerHeightCommand.prototype.exec = function (selectedBlock, wrappedBlock, selectedHtml, selectedValue) {
            if (Utility.isNullOrUndefined(selectedBlock)) {
                return false;
            }
            if (Utility.isNullOrUndefined(this.eventBroker)) {
                return false;
            }
            selectedBlock.find("p").css("border-bottom-width", selectedValue + "px");
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged);
            return true;
        };
        /**
         * @see ICommand.shouldSetToolHighlight
         */
        SetDividerHeightCommand.prototype.shouldSetToolHighlight = function (element) {
            return false;
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        SetDividerHeightCommand.prototype.dispose = function () { };
        /*
         * Cleans up the html elements that where added to the page
         */
        SetDividerHeightCommand.prototype.cleanup = function (blockElements) { };
        return SetDividerHeightCommand;
    }());
    Editor.SetDividerHeightCommand = SetDividerHeightCommand;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    /**
     * The toolbar class.
     */
    var InlineToolbar = /** @class */ (function () {
        /**
         * Initializes a new instance of the toolbar class.
         * @param blockId Id, that link the current block and the toolbar.
         */
        function InlineToolbar(blockId) {
            var editor = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            this.toolbar = editor.contents().find(String.Format("#cke_{0}", blockId));
        }
        /**
         * Gets the buttons from the current toolbar by selector.
         * @param selector buttons selector.
         */
        InlineToolbar.prototype.getButton = function (buttonName) {
            return new Editor.ToolbarButton(this.getButtonElement(buttonName));
        };
        /**
         * Gets the Jquery buttons from the current toolbar by selector.
         * @param selector buttons selector.
         */
        InlineToolbar.prototype.getButtonElement = function (buttonName) {
            return this.toolbar.find(String.Format(".cke_button__{0}", buttonName.toLocaleLowerCase()));
        };
        return InlineToolbar;
    }());
    Editor.InlineToolbar = InlineToolbar;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * The toolbar button class.
     */
    var ToolbarButton = /** @class */ (function () {
        /**
         * Initializes a new instance of the toolbar button class.
         * @param button The button element.
         */
        function ToolbarButton(button, buttonCssOnClass, buttonCssOffClass) {
            this.buttonCssOnClass = "cke_button_on";
            this.buttonCssOffClass = "cke_button_off";
            if (!Utility.isNullOrUndefined(buttonCssOnClass)) {
                this.buttonCssOnClass = buttonCssOnClass;
            }
            if (!Utility.isNullOrUndefined(buttonCssOffClass)) {
                this.buttonCssOffClass = buttonCssOffClass;
            }
            this.button = button;
        }
        /**
         * Gets the current status of the button.
         */
        ToolbarButton.prototype.isSelected = function () {
            return this.button.hasClass(this.buttonCssOnClass);
        };
        /**
         * Sets active status of the button.
         */
        ToolbarButton.prototype.turnOn = function () {
            if (!this.isSelected()) {
                this.button.removeClass(this.buttonCssOffClass);
                this.button.addClass(this.buttonCssOnClass);
            }
        };
        /**
         * Sets inactive status of the button.
         */
        ToolbarButton.prototype.turnOff = function () {
            if (this.isSelected()) {
                this.button.removeClass(this.buttonCssOnClass);
                this.button.addClass(this.buttonCssOffClass);
            }
        };
        /**
         * Gets the button element.
         */
        ToolbarButton.prototype.getButton = function () {
            return this.button;
        };
        return ToolbarButton;
    }());
    Editor.ToolbarButton = ToolbarButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var LayoutStyles = /** @class */ (function () {
        function LayoutStyles() {
        }
        LayoutStyles.getDefaultContainer = function (isResponsiveDesign) {
            return "\n            display: flex;\n            min-height: " + LayoutStyles.defaultContainerMinHeight + "px;\n            min-width: " + (LayoutStyles.minWidthForLayoutContainer + LayoutStyles.minWidthForLayoutContainer) + "px;\n            width: 100%;\n            " + (isResponsiveDesign ? "box-sizing: border-box;" : "") + "\n            flex-direction: column;\n            padding: " + LayoutStyles.padding + "px;\n            float: left;\n            word-wrap: break-word;\n            word-break: break-word;\n        ";
        };
        LayoutStyles.getOneHalfOfSectionContainer = function (isResponsiveDesign) {
            return "\n            display: flex;\n            min-height: " + LayoutStyles.defaultContainerMinHeight + "px;\n            min-width: " + (LayoutStyles.minWidthForLayoutContainer + LayoutStyles.minWidthForLayoutContainer / 2) + "px;\n            width: " + (isResponsiveDesign ? "50%" : "calc(50% - 22px)") + ";\n            " + (isResponsiveDesign ? "box-sizing: border-box;" : "") + "\n            flex-direction: column;\n            padding: " + LayoutStyles.padding + "px;\n            float: left;\n            word-wrap: break-word;\n            word-break: break-word;\n        ";
        };
        LayoutStyles.getOneThirdOfSectionContainer = function (isResponsiveDesign) {
            return "\n            display: flex;\n            min-height: " + LayoutStyles.defaultContainerMinHeight + "px;\n            min-width: " + (LayoutStyles.minWidthForLayoutContainer + LayoutStyles.minWidthForLayoutContainer / 3) + "px;\n            width: " + (isResponsiveDesign ? "33%" : "calc(33% - 22px)") + ";\n            " + (isResponsiveDesign ? "box-sizing: border-box;" : "") + "\n            flex-direction: column;\n            padding: " + LayoutStyles.padding + "px;\n            float: left;\n            word-wrap: break-word;\n            word-break: break-word;\n        ";
        };
        LayoutStyles.getColumnStyleBase = function (isResponsiveDesign) {
            return "\n            display: flex;\n            min-height: " + LayoutStyles.defaultContainerMinHeight + "px;\n            min-width: " + (LayoutStyles.minWidthForLayoutContainer + LayoutStyles.minWidthForLayoutContainer / 3) + "px;\n            width: " + (isResponsiveDesign ? "{{percentage}}%" : "calc({{percentage}}% - 22px)") + ";\n            " + (isResponsiveDesign ? "box-sizing: border-box;" : "") + "\n            flex-direction: column;\n            padding: " + LayoutStyles.padding + "px;\n            float: left;\n            word-wrap: break-word;\n            word-break: break-word;\n        ";
        };
        LayoutStyles.getSmallContainer = function (isResponsiveDesign) {
            return "\n            display: flex;\n            min-height: " + LayoutStyles.defaultContainerMinHeight + "px;\n            min-width: " + (LayoutStyles.minWidthForLayoutContainer + LayoutStyles.minWidthForLayoutContainer / 4) + "px;\n            width: " + (isResponsiveDesign ? "33%" : "calc(33% - 22px)") + ";\n            " + (isResponsiveDesign ? "box-sizing: border-box;" : "") + "\n            flex-direction: column;\n            padding: " + LayoutStyles.padding + "px;\n            float: left;\n            word-wrap: break-word;\n            word-break: break-word;\n        ";
        };
        LayoutStyles.getBigContainer = function (isResponsiveDesign) {
            return "\n            display: flex;\n            min-height: " + LayoutStyles.defaultContainerMinHeight + "px;\n            min-width: " + (LayoutStyles.minWidthForLayoutContainer + (LayoutStyles.minWidthForLayoutContainer * 3) / 4) + "px;\n            width: " + (isResponsiveDesign ? "67%" : "calc(67% - 22px)") + ";\n            " + (isResponsiveDesign ? "box-sizing: border-box;" : "") + "\n            flex-direction: column;\n            padding: " + LayoutStyles.padding + "px;\n            float: left;\n            word-wrap: break-word;\n            word-break: break-word;\n        ";
        };
        LayoutStyles.emptyContainerCssClass = "emptyContainer";
        LayoutStyles.padding = 10;
        LayoutStyles.defaultContainerMinHeight = 70;
        // If size is lower than 10px our blue placeholders for add mode will look ugly
        LayoutStyles.minWidthForLayoutContainer = 10;
        LayoutStyles.defaultSection = "\n            display: flex;\n            width: 100%;\n        ";
        LayoutStyles.defaultContainerPercentageWidth = "100";
        LayoutStyles.oneHalfOfSectionContainerPercentageWidth = "50";
        LayoutStyles.oneThirdOfSectionContainerPercentageWidth = "33.33";
        LayoutStyles.smallContainerPercentageWidth = "33";
        LayoutStyles.bigContainerPercentageWidth = "67";
        return LayoutStyles;
    }());
    Editor.LayoutStyles = LayoutStyles;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var OneColumnTool = /** @class */ (function () {
        function OneColumnTool(fcbList) {
            this.fcbList = fcbList;
        }
        OneColumnTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.oneColumnToolLabel);
        };
        OneColumnTool.prototype.getType = function () {
            return Editor.CommonConstants.oneColumnToolType;
        };
        OneColumnTool.prototype.getContentTransformation = function () {
            var isResponsiveDesign = this.fcbList && this.fcbList.isResponsiveDesign;
            return "<div style=\"" + Editor.LayoutStyles.defaultSection + "\" class=\"containerWrapper\">\n                        <div style=\"clear:both;\"></div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                            " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.defaultContainerPercentageWidth + "\n                            style=\"" + Editor.LayoutStyles.getDefaultContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div style=\"clear:both;\"></div>\n                    </div>";
        };
        OneColumnTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.oneColumnToolLabel);
        };
        OneColumnTool.prototype.getCssClass = function () {
            return Editor.CommonConstants.oneColumnToolCss;
        };
        OneColumnTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Layout;
        };
        return OneColumnTool;
    }());
    Editor.OneColumnTool = OneColumnTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TwoColumnTool = /** @class */ (function () {
        function TwoColumnTool(fcbList) {
            this.fcbList = fcbList;
        }
        TwoColumnTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.twoColumnToolLabel);
        };
        TwoColumnTool.prototype.getType = function () {
            return Editor.CommonConstants.twoColumnToolType;
        };
        TwoColumnTool.prototype.getContentTransformation = function () {
            var isResponsiveDesign = this.fcbList && this.fcbList.isResponsiveDesign;
            return "<div style=\"" + Editor.LayoutStyles.defaultSection + "\" class=\"containerWrapper\">\n                        <div style=\"clear:both;\"></div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.oneHalfOfSectionContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getOneHalfOfSectionContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.oneHalfOfSectionContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getOneHalfOfSectionContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div style=\"clear:both;\"></div>\n                    </div>";
        };
        TwoColumnTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.twoColumnToolLabel);
        };
        TwoColumnTool.prototype.getCssClass = function () {
            return Editor.CommonConstants.twoColumnToolCss;
        };
        TwoColumnTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Layout;
        };
        return TwoColumnTool;
    }());
    Editor.TwoColumnTool = TwoColumnTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ThreeColumnTool = /** @class */ (function () {
        function ThreeColumnTool(fcbList) {
            this.fcbList = fcbList;
        }
        ThreeColumnTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.threeColumnToolLabel);
        };
        ThreeColumnTool.prototype.getType = function () {
            return Editor.CommonConstants.threeColumnToolType;
        };
        ThreeColumnTool.prototype.getContentTransformation = function () {
            var isResponsiveDesign = this.fcbList && this.fcbList.isResponsiveDesign;
            return "<div style=\"" + Editor.LayoutStyles.defaultSection + "\" class=\"containerWrapper\">\n                        <div style=\"clear:both;\"></div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.oneThirdOfSectionContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getOneThirdOfSectionContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.oneThirdOfSectionContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getOneThirdOfSectionContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.oneThirdOfSectionContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getOneThirdOfSectionContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div style=\"clear:both;\"></div>\n                    </div>";
        };
        ThreeColumnTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.threeColumnToolLabel);
        };
        ThreeColumnTool.prototype.getCssClass = function () {
            return Editor.CommonConstants.threeColumnToolCss;
        };
        ThreeColumnTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Layout;
        };
        return ThreeColumnTool;
    }());
    Editor.ThreeColumnTool = ThreeColumnTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var OneTwoColumnTool = /** @class */ (function () {
        function OneTwoColumnTool(fcbList) {
            this.fcbList = fcbList;
        }
        OneTwoColumnTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.oneTwoColumnToolLabel);
        };
        OneTwoColumnTool.prototype.getType = function () {
            return Editor.CommonConstants.oneColumnToolType;
        };
        OneTwoColumnTool.prototype.getContentTransformation = function () {
            var isResponsiveDesign = this.fcbList && this.fcbList.isResponsiveDesign;
            return "<div style=\"" + Editor.LayoutStyles.defaultSection + "\" class=\"containerWrapper\">\n                        <div style=\"clear:both;\"></div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.smallContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getSmallContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.bigContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getBigContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div style=\"clear:both;\"></div>\n                    </div>";
        };
        OneTwoColumnTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.oneTwoColumnToolLabel);
        };
        OneTwoColumnTool.prototype.getCssClass = function () {
            return Editor.CommonConstants.oneTwoColumnToolCss;
        };
        OneTwoColumnTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Layout;
        };
        return OneTwoColumnTool;
    }());
    Editor.OneTwoColumnTool = OneTwoColumnTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TwoOneColumnTool = /** @class */ (function () {
        function TwoOneColumnTool(fcbList) {
            this.fcbList = fcbList;
        }
        TwoOneColumnTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.twoOneColumnToolLabel);
        };
        TwoOneColumnTool.prototype.getType = function () {
            return Editor.CommonConstants.twoOneColumnToolType;
        };
        TwoOneColumnTool.prototype.getContentTransformation = function () {
            var isResponsiveDesign = this.fcbList && this.fcbList.isResponsiveDesign;
            return "<div style=\"" + Editor.LayoutStyles.defaultSection + "\" class=\"containerWrapper\">\n                        <div style=\"clear:both;\"></div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.bigContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getBigContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div " + Editor.Contract.containerAttrName + "=\"true\" class=\"" + Editor.Contract.containerCssClass + "\"\n                             " + Editor.Contract.dataContainerWidth + "=" + Editor.LayoutStyles.smallContainerPercentageWidth + "\n                             style=\"" + Editor.LayoutStyles.getSmallContainer(isResponsiveDesign) + "\">\n                        </div>\n                        <div style=\"clear:both;\"></div>\n                    </div>";
        };
        TwoOneColumnTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.twoOneColumnToolLabel);
        };
        TwoOneColumnTool.prototype.getCssClass = function () {
            return Editor.CommonConstants.twoOneColumnToolCss;
        };
        TwoOneColumnTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Layout;
        };
        return TwoOneColumnTool;
    }());
    Editor.TwoOneColumnTool = TwoOneColumnTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var LayoutSection = /** @class */ (function () {
        function LayoutSection(fcbList) {
            this.fcbList = fcbList;
            this.editorFeatureServiceClient = Editor.EditorFeatureServiceClient.instance;
        }
        LayoutSection.prototype.getType = function () {
            return "LayoutSection";
        };
        LayoutSection.prototype.getLocalizedTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.contentBlockTitleLabel);
        };
        LayoutSection.prototype.usePlainText = function () {
            return true;
        };
        LayoutSection.prototype.isEditable = function () {
            return false;
        };
        LayoutSection.prototype.getInlineToolbar = function () {
            return null;
        };
        LayoutSection.prototype.setup = function (eventBroker) { };
        LayoutSection.prototype.dispose = function () { };
        LayoutSection.prototype.isConfigured = function (block) {
            return true;
        };
        LayoutSection.prototype.decorate = function (block) {
            var _this = this;
            var translatedLabel = Editor.CommonUtils.getLocalizedString("[" + block.attr(Editor.Contract.blockTypeAttrName) + " block]");
            Editor.CommonUtils.setAriaAttribute(block, "aria-label", translatedLabel);
            var layoutWidth;
            layoutWidth = this.getSectionMaxWidth(block);
            if (Utility.isNullOrUndefined(layoutWidth)) {
                layoutWidth = this.getLayoutWidth(block);
            }
            var innerDiv = block.children().first();
            Editor.CommonUtils.rewriteInlineStyleProperty(innerDiv, "display", "flex");
            var isResponsiveDesign = this.fcbList && this.fcbList.isResponsiveDesign;
            var containers = Editor.ContainerProvider.getContainers(block);
            if (containers.length !== 0) {
                if (isResponsiveDesign) {
                    containers.each(function (_, container) {
                        var originalWidthPercentage = container.getAttribute("data-container-width");
                        if (!originalWidthPercentage) {
                            return;
                        }
                        var marginLeft = Editor.CommonUtils.getOnlyPixelsValueFromString($(container).css("margin-left"));
                        var marginRight = Editor.CommonUtils.getOnlyPixelsValueFromString($(container).css("margin-right"));
                        var sum = marginLeft + marginRight;
                        container.style.width = "calc(" + originalWidthPercentage + "% - " + sum + "px)";
                    });
                }
                else {
                    containers.each(function (_, container) {
                        var width = _this.getWidthBasedOnPercentage(layoutWidth, $(container));
                        Editor.CommonUtils.rewriteInlineStyleProperty($(container), "width", width);
                        Editor.CommonUtils.rewriteInlineStyleProperty($(container), "flex", "0 0 " + width);
                        Editor.CommonUtils.rewriteInlineStyleProperty($(container), "display", "flex");
                        Editor.CommonUtils.rewriteInlineStyleProperty($(container), "flex-direction", "column");
                    });
                }
            }
            var containersWithoutBlock = Editor.ContainerProvider.getContainersWithoutBlocks(block);
            containersWithoutBlock.forEach(function (container) {
                container.addClass(Editor.LayoutStyles.emptyContainerCssClass);
            });
        };
        LayoutSection.prototype.setFinalContent = function (block) {
            var _a;
            var innerDiv = block.children().first();
            if (!((_a = this.fcbList) === null || _a === void 0 ? void 0 : _a.isResponsiveDesign)) {
                if (!innerDiv.hasClass("containerWrapper")) {
                    // For older templates, email need to work on mobile
                    Editor.CommonUtils.rewriteInlineStyleProperty(innerDiv, "display", "block");
                }
            }
            else {
                Editor.CommonUtils.rewriteInlineStyleProperty(innerDiv, "flex-wrap", "wrap");
            }
            var containers = Editor.ContainerProvider.getContainers(block);
            containers.each(function (_, container) {
                Editor.CommonUtils.rewriteInlineStyleProperty($(container), "display", "block");
                container.removeAttribute("flex-direction");
            });
            block.find(Editor.CommonUtils.getAttrSelector(Editor.Contract.containerAttrName)).each(function (_, el) {
                el.classList.remove(Editor.LayoutStyles.emptyContainerCssClass);
            });
            block.removeAttr("aria-label");
        };
        LayoutSection.prototype.onBlockAdded = function (block) { };
        LayoutSection.prototype.getLayoutWidth = function (block) {
            var layout = block.closest("[" + Editor.Contract.dataLayoutAttrName + "='true']");
            var layoutWidth = 0;
            var maxWidth = 0;
            var width = 0;
            if (layout) {
                if (layout.css("max-width")) {
                    maxWidth = parseInt(layout.css("max-width").replace(/[^-\d\.]/g, ""));
                }
                if (layout.css("width")) {
                    width = parseInt(layout.css("width").replace(/[^-\d\.]/g, ""));
                }
                layoutWidth = maxWidth > 0 ? maxWidth : width;
            }
            return layoutWidth;
        };
        LayoutSection.prototype.getWidthBasedOnPercentage = function (layoutWidth, container) {
            var hundredPercent = 100;
            var width = container.css("width");
            // Retrieval of shorthand CSS properties, ex. css('border-width) is not guaranteed for some browsers
            var borderWidth = Editor.CommonUtils.getOnlyPixelsValueFromString(container[0].style.borderWidth);
            var paddingLeft = Editor.CommonUtils.getOnlyPixelsValueFromString(container.css("padding-left"));
            var paddingRight = Editor.CommonUtils.getOnlyPixelsValueFromString(container.css("padding-right"));
            var marginLeft = Editor.CommonUtils.getOnlyPixelsValueFromString(container.css("margin-left"));
            var marginRight = Editor.CommonUtils.getOnlyPixelsValueFromString(container.css("margin-right"));
            var parentSection = container.closest("[" + Editor.Contract.dataSectionAttrName + "]");
            // Retrieval of shorthand CSS properties, ex. css('border-width) is not guaranteed for some browsers
            var sectionBorderWidth = Editor.CommonUtils.getOnlyPixelsValueFromString(parentSection[0].style.borderWidth);
            var sectionPaddingLeft = Editor.CommonUtils.getOnlyPixelsValueFromString(parentSection.css("padding-left"));
            var sectionPaddingRight = Editor.CommonUtils.getOnlyPixelsValueFromString(parentSection.css("padding-right"));
            var sectionMarginLeft = Editor.CommonUtils.getOnlyPixelsValueFromString(parentSection.css("margin-left"));
            var sectionMarginRight = Editor.CommonUtils.getOnlyPixelsValueFromString(parentSection.css("margin-right"));
            if (layoutWidth !== 0) {
                var percentage = container.attr(Editor.Contract.dataContainerWidth);
                if (percentage) {
                    var percentageWidth = parseFloat(percentage);
                    var sectionSizes = sectionMarginLeft +
                        sectionBorderWidth +
                        sectionPaddingLeft +
                        sectionPaddingRight +
                        sectionBorderWidth +
                        sectionMarginRight;
                    var containerSizes = marginLeft + borderWidth + paddingLeft + paddingRight + borderWidth + marginRight;
                    var containerWidth = ((layoutWidth - sectionSizes) * percentageWidth) / hundredPercent - containerSizes;
                    if (containerWidth < Editor.LayoutStyles.minWidthForLayoutContainer) {
                        containerWidth = Editor.LayoutStyles.minWidthForLayoutContainer;
                    }
                    width = containerWidth.toFixed(2) + "px";
                }
            }
            return width;
        };
        LayoutSection.prototype.getSectionMaxWidth = function (block) {
            var sectionMaxWidth = block.css(Editor.DetailsViewConstants.maxWidthAttribute);
            if (Utility.isNullOrUndefined(sectionMaxWidth) ||
                sectionMaxWidth === "" ||
                sectionMaxWidth === "px" ||
                sectionMaxWidth === "none") {
                return this.getLayoutWidth(block);
            }
            return Editor.CommonUtils.getOnlyPixelsValueFromString(sectionMaxWidth);
        };
        return LayoutSection;
    }());
    Editor.LayoutSection = LayoutSection;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    /**
     * Plugin to clone a block in CKEditor.
     */
    var CloneBlockButton = /** @class */ (function () {
        /**
         * Initializes a new instance of the CloneBlockButton class.
         */
        function CloneBlockButton(command) {
            this.command = command;
        }
        /**
         * Gets the name of the button.
         */
        CloneBlockButton.prototype.getName = function () {
            return "cloneBlockBtn";
        };
        /**
         * Gets the label used with the button.
         */
        CloneBlockButton.prototype.getLabel = function () {
            return Editor.CommonConstants.cloneBlockLabel;
        };
        /**
         * Get the command associated with the button
         */
        CloneBlockButton.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * Gets the source of the icon base64 encoded
         */
        CloneBlockButton.prototype.getIconSrc = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAALEQAACxEBf2RfkQAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC42/Ixj3wAAAG5JREFUOE+1jMEJwDAMAzNSl8pe3bAjuHag5YrikBD6OCOsQ8XMtmin1moDTudwLvwaswNBd0QGIhPKjoyEszIQPCOvvzrQHObhAKHDLGUGHWYpM+gwS5lBh1nKDDrMUmbQYf6UM/wzsEP3OY+VG3Syl/7fyVvFAAAAAElFTkSuQmCC";
        };
        /**
         * Gets the keyboard shortcut for the button.
         */
        CloneBlockButton.prototype.getKeyboardShortcut = function () {
            return new KeyboardCommand(KeyboardKeyCodes.cKey, [KeyboardModifierType.Alt, KeyboardModifierType.Shift]);
        };
        return CloneBlockButton;
    }());
    Editor.CloneBlockButton = CloneBlockButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Plugin to open the image gallery in CKEditor.
     */
    var ImageGalleryButton = /** @class */ (function () {
        /**
         * Initializes a new instance of the ImageGalleryButton class.
         */
        function ImageGalleryButton(command) {
            this.command = command;
        }
        /**
         * Gets the name of the button.
         */
        ImageGalleryButton.prototype.getName = function () {
            return "imgGalleryBtn";
        };
        /**
         * Gets the label used with the button.
         */
        ImageGalleryButton.prototype.getLabel = function () {
            return "[Image Gallery]";
        };
        /**
         * Get the command associated with the button
         */
        ImageGalleryButton.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * Gets the source of the icon base64 encoded
         */
        ImageGalleryButton.prototype.getIconSrc = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwwAADsMBx2+oZAAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC45bDN+TgAAAVVJREFUOE+lkj1Lw1AUhoNSEMU6q6OC4CJCf4GLCFJdMiVYCPkiEBQcHQKCk3/BRd0VxE1wFHEUO4ijIFWQDgpSFOJzmhMUbFLFAw839z3veZObxPB9P/0NnuctGb1Km+OswwXcgYR84Kvr2Fdpc0y3P4rerXqEjuu6i9rKShtlAatBEKwJXD+Dqa2s+gV8L3y7UNNtVmUB3HWSc+/DA7ThJAzDeW1nVRTgOM4oA03owDkc43tlfSR4Tm3FAWgb8M7Aummag6IxuML+Bf0gSZKB3FgUIOdt8SQTKhmWZVUJuISLRqMx1BWLAjBtoctnW1DJ4PwzaPf0TlkrXbEkYAq9LQOQsN9kvYGUUE9txQFSGJcZvFaP8ARvcAbZjDZ6BkjRq0RRNM0LnLVte4TAbTT5rY/iOK7mATU5Xz/wXTFYhx2QL3SYB/wFU59kj+uWkabpP0iNT82hN14/Ux1SAAAAAElFTkSuQmCC";
        };
        /**
         * Gets the keyboard shortcut for the button.
         */
        ImageGalleryButton.prototype.getKeyboardShortcut = function () {
            return null;
        };
        return ImageGalleryButton;
    }());
    Editor.ImageGalleryButton = ImageGalleryButton;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Command to clone the selected block.
     */
    var CloneBlockCommand = /** @class */ (function () {
        function CloneBlockCommand() {
        }
        /**
         * @see ICommand.isContextSensitive
         */
        CloneBlockCommand.prototype.isContextSensitive = function () {
            return false;
        };
        /**
         * Gets the name of the command.
         */
        CloneBlockCommand.prototype.getName = function () {
            return CloneBlockCommand.getName();
        };
        /**
         * Enabled if editor is in read only mode.
         */
        CloneBlockCommand.prototype.enabledOnReadOnly = function () {
            return true;
        };
        /**
         * Gets the name of the command.
         */
        CloneBlockCommand.getName = function () {
            return "cloneElementCommand";
        };
        /**
         * Configure the command.
         * @param eventBroker An instance of event broker.
         */
        CloneBlockCommand.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        /**
         * Executes the command and clones the currently selected block.
         * @param selectedBlock The currently selected block.
         * @param wrappedBlock The top-wrapping element.
         * @param cleanBlock The clean block, without any wrappers.
         * @param selectedHtml The selected html, if any.
         */
        CloneBlockCommand.prototype.exec = function (selectedBlock, wrappedBlock, selectedHtml) {
            var _this = this;
            if (Utility.isNullOrUndefined(selectedBlock)) {
                return false;
            }
            if (Utility.isNullOrUndefined(this.eventBroker)) {
                return false;
            }
            var eventArgs = new Editor.BlockCleanupRequestedEventArgs();
            eventArgs.block = selectedBlock.clone(false, false);
            eventArgs.onAfterBlockCleanup = function (cleanBlock) {
                cleanBlock.insertAfter(wrappedBlock);
                var blockModifiedEventArgs = new Editor.BlockModificationEventArgs(eventArgs.block, true);
                _this.eventBroker.notify(Editor.EventConstants.blockAdded, blockModifiedEventArgs);
            };
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.blockCleanupRequested, eventArgs);
            return true;
        };
        /**
         * @see ICommand.shouldSetToolHighlight
         */
        CloneBlockCommand.prototype.shouldSetToolHighlight = function (element) {
            return false;
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        CloneBlockCommand.prototype.dispose = function () { };
        /*
         * Cleans up the html elements that where added to the page
         */
        CloneBlockCommand.prototype.cleanup = function (blockElements) { };
        return CloneBlockCommand;
    }());
    Editor.CloneBlockCommand = CloneBlockCommand;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Command to open the image gallery.
     */
    var ImageGalleryCommand = /** @class */ (function () {
        function ImageGalleryCommand(imagePicker, popupRenderer) {
            this.imagePicker = imagePicker;
        }
        /**
         * @see ICommand.isContextSensitive
         */
        ImageGalleryCommand.prototype.isContextSensitive = function () {
            return false;
        };
        /**
         * Gets the name of the command.
         */
        ImageGalleryCommand.prototype.getName = function () {
            return ImageGalleryCommand.getName();
        };
        /**
         * Enabled if editor is in read only mode.
         */
        ImageGalleryCommand.prototype.enabledOnReadOnly = function () {
            return true;
        };
        /**
         * Gets the name of the command.
         */
        ImageGalleryCommand.getName = function () {
            return "imageGalleryCommand";
        };
        /**
         * Configure the command.
         * @param eventBroker An instance of event broker.
         */
        ImageGalleryCommand.prototype.setup = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.imagePicker.setup(this.eventBroker);
            this.galleryImageSelectedDelegate = this.eventBroker.subscribe(MktSvcCommon.EventConstants.GalleryImageSelected, function (eventArgs) {
                if (eventArgs.sourceId === _this.imagePicker.getId()) {
                    _this.changeImageSource(eventArgs);
                }
            });
        };
        /**
         * Executes the command and opens the image gallery.
         * @param selectedBlock The currently selected block.
         * @param wrappedBlock The top-wrapping element.
         * @param cleanBlock The clean block, without any wrappers.
         * @param selectedHtml The selected html, if any.
         */
        ImageGalleryCommand.prototype.exec = function (selectedBlock, wrappedBlock, selectedHtml) {
            if (Utility.isNullOrUndefined(selectedBlock)) {
                return false;
            }
            if (Utility.isNullOrUndefined(this.eventBroker)) {
                return false;
            }
            this.selectedItem = selectedBlock;
            this.eventBroker.notify(Editor.EventConstants.imageGalleryCommandExecuted);
            this.imagePicker.open();
            return true;
        };
        /**
         * @see ICommand.shouldSetToolHighlight
         */
        ImageGalleryCommand.prototype.shouldSetToolHighlight = function (element) {
            return false;
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        ImageGalleryCommand.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.eventBroker)) {
                this.eventBroker.unsubscribe(MktSvcCommon.EventConstants.GalleryImageSelected, this.galleryImageSelectedDelegate);
            }
        };
        /*
         * Cleans up the html elements that where added to the page
         */
        ImageGalleryCommand.prototype.cleanup = function (blockElements) { };
        /**
         * Changes the image source of the selected image block to the one selected from the picker
         * @param eventArgs Arguments containing the image URL selected from the picker
         */
        ImageGalleryCommand.prototype.changeImageSource = function (eventArgs) {
            // TODO TFS#6413720 - [Technical debt] How to make sure we are not vulnerable when setting/loading image sources
            var currentImg = this.selectedItem.find("img");
            var imageInput = this.selectedItem.find(Editor.CommonUtils.getClassSelector(Editor.DetailsViewConstants.inputImageCssClass));
            if (currentImg.length > 0) {
                currentImg.attr(Editor.CommonConstants.designerImageSourceAttributeName, eventArgs.imageUrl);
                this.eventBroker.notify(Editor.EventConstants.imageAttributeChanged, new Editor.ImageAttributeChangedEventArgs(currentImg, Editor.CommonConstants.designerImageSourceAttributeName, // tslint:disable-line
                eventArgs.imageUrl, // tslint:disable-line
                null)); // tslint:disable-line
                // Close the image picker popup
                this.imagePicker.dispose();
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged);
                return;
            }
            // Close the image picker popup. This has to be done before
            // issuing any updates to the document, because this triggers
            // an update from CCF to the custom control which can
            // overwrite changes to the document if it's done after.
            this.imagePicker.dispose();
            // If we opened image picker for image field in popup
            if (imageInput.length) {
                imageInput.val(eventArgs.imageUrl);
                // Trigger focus out event to call logic with callback for input field
                imageInput.focusout();
                this.eventBroker.notify(Editor.EventConstants.imageInputChanged);
            }
        };
        return ImageGalleryCommand;
    }());
    Editor.ImageGalleryCommand = ImageGalleryCommand;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Editor class containing all the css styles used by the content editor.
     */
    var DesignerContentEditorStyles = /** @class */ (function () {
        function DesignerContentEditorStyles() {
        }
        /**
         * The style used for the content editor.
         */
        DesignerContentEditorStyles.getDesignerStyles = function (isResponsiveDesign) {
            var baseStyles = "\n[data-editorBlockType]:hover ,\n[data-section]:hover ,\n[data-container]:hover {\n    outline: 1px solid #8CBFE5;\n    border-radius:4px;\n    cursor:default;\n}\n\n[data-locked=hard] [data-editorBlockType]:hover {\n    outline: none;\n}\n\n.editorAccessibilityButton {\n    width: 100%;\n    height: 100%;\n    position: relative;\n    top: 0;\n    left: 0;\n    z-index: -1;\n}\n\n/* Fixes issue with broken drag&drop for heightless empty containers */\n.containerDragMode {\n    min-height:15px;\n}\n\n.sort-highlight {\n    display: inline-block !important;\n    width: 100% !important;\n    background-color: #95DCEF !important;\n    color: #000000 !important;\n    text-align: center !important;\n    cursor: pointer !important;\n    caret-color: transparent;\n    position:relative;\n    z-index: 100;\n}\n\n.addBlockLine {\n    position: absolute;\n    height: 1px !important;\n    border-bottom: dashed;\n    border-color: #2266E3;\n    border-width: 1px;\n    top: -2px;\n    width: 100%;\n    opacity: 0.7;\n}\n\n.addBlockButton {\n    position: absolute;\n    height: 24px !important;\n    font-size: 14px;\n    top: -14px;\n    width: 27px;\n    border-radius: 50%;\n    background-color: #2266E3;\n    left: calc(50% - 14px);\n    color: white;\n    transition: all .2s ease-in-out;\n    opacity: 0.7;\n    padding: 3px 0 0 0;\n    transform: scale(0.7);\n}\n\n.dropLineBorder {\n    margin: 5px auto 5px auto;\n    cursor: pointer !important;\n    caret-color: transparent;\n    position:relative;\n    width: 100% !important;\n    z-index: 100;\n    height: 16px;\n    border: 1px dashed #2266E3;\n    background: #F0F5FF;\n    opacity: 0.9;\n    display: flex;\n    justify-content: center;\n}\n\n.dropLine::before {\n    content: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDQ4IDIwNDgiIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgZmlsbD0iIzIyNjZFMyI+CiAgPHBhdGggZD0iTTEwODggOTYwaDMyMHYxMjhoLTMyMHYzMjBIOTYwdi0zMjBINjQwVjk2MGgzMjBWNjQwaDEyOHYzMjB6bS02NC04MzJxMTI0IDAgMjM4IDMydDIxNCA5MCAxODEgMTQwIDE0MCAxODEgOTEgMjE0IDMyIDIzOXEwIDEyNC0zMiAyMzh0LTkwIDIxNC0xNDAgMTgxLTE4MSAxNDAtMjE0IDkxLTIzOSAzMnEtMTI0IDAtMjM4LTMydC0yMTQtOTAtMTgxLTE0MC0xNDAtMTgxLTkxLTIxNC0zMi0yMzlxMC0xMjQgMzItMjM4dDkwLTIxNCAxNDAtMTgxIDE4MS0xNDAgMjE0LTkxIDIzOS0zMnptMCAxNjY0cTEwNiAwIDIwNC0yN3QxODMtNzggMTU2LTEyMCAxMjAtMTU1IDc3LTE4NCAyOC0yMDRxMC0xMDYtMjctMjA0dC03OC0xODMtMTIwLTE1Ni0xNTUtMTIwLTE4NC03Ny0yMDQtMjhxLTEwNiAwLTIwNCAyN3QtMTgzIDc4LTE1NiAxMjAtMTIwIDE1NS03NyAxODQtMjggMjA0cTAgMTA2IDI3IDIwNHQ3OCAxODMgMTIwIDE1NiAxNTUgMTIwIDE4NCA3NyAyMDQgMjh6Ii8+Cjwvc3ZnPg=='); \n}\n\n.addBlockButton::after {\n    content: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAOUlEQVQ4T2NkIBL8////PyMjIyMxyolSBDJo1NDRMB12SQqUqInJJaSoGc1RxIXWaIEyWqAQV6AAAM8FVBIBWB6AAAAAAElFTkSuQmCC');\n    vertical-align: middle;\n}\n\n.addBlockButton:hover { transform: scale(1.0);\n    opacity: 1;\n}\n\n.addBlockButton:focus { transform: scale(1.0);\n    opacity: 1;\n}\n\n.addBlockMouseHover {\n    height: 20px;\n    position:absolute;\n    top: -10px;\n    width: 100%;\n}\n\n.addBlockMouseHover:hover + .addBlockButton {\n    transform: scale(1.0);\n    opacity: 1;\n}\n\n.addBlockMouseHover:hover + .addBlockLine {\n    opacity: 1;\n}\n\n.selected-sort-highlight {\n    opacity: 1 !important;\n}\n\n.buttonClass {\n    max-inline-size: -webkit-fill-available;\n}\n\n.draggableWrapper {\n    position:relative;\n    width:100%;\n    margin-bottom:1px;\n    user-select: none;\n}\n\n.cke_editable.cke_editable_inline.cke_contents_ltr ol,\n.cke_editable.cke_editable_inline.cke_contents_rtl ol,\n.cke_editable.cke_editable_inline.cke_contents_ltr ul,\n.cke_editable.cke_editable_inline.cke_contents_ltr ul\n{\n\t\tpadding-inline-end: 40px !important;\n}\n\n.draggableWrapper .dragButton {\n    cursor: move;\n}\n\n[data-sub-block=true] {\n    z-index: 6;\n}\n\n[data-container] [contenteditable]:focus {\n    outline: 0 transparent;\n}\n\n.designer-unconfiguredcontent-overlay {\n    width:100%;\n    background-color: #E7EFFF;\n    height: 100px;\n    align-items: center;\n    justify-content: center;\n    display: flex;\n}\n\n.unconfigured-overlay-icon {\n    width: 100%;\n    max-width: 125px;\n}\n\n.overlay-icon-image {\n    width: 35px;\n    height: 35px;\n}\n\n.designer-content-editor-hidden {\n    display:none !important;\n}\n\n.iosScroll {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n}\n\n.emptyContainer {\n     outline: 1px dashed black;\n}\n\n@media only screen and (max-width: 768px) {\n    ." + Editor.Contract.containerCssClass + " {\n        flex: 1 1 0%;\n    }\n\n    ." + Editor.Contract.containerCssClass + "[" + Editor.Contract.dataContainerWidth + "=\"" + Editor.LayoutStyles.smallContainerPercentageWidth + "\"] {\n        flex: none;\n        width: " + Editor.LayoutStyles.smallContainerPercentageWidth + "% !important;\n    }\n\n    ." + Editor.Contract.containerCssClass + "[" + Editor.Contract.dataContainerWidth + "=\"" + Editor.LayoutStyles.bigContainerPercentageWidth + "\"] {\n        flex: none;\n        width: " + Editor.LayoutStyles.bigContainerPercentageWidth + "% !important;\n    }\n}\n";
            if (isResponsiveDesign) {
                return baseStyles + "\n.decoratedAreaMarker :first-child.columnContainer {\n    width: 100% !important;\n}\n";
            }
            return baseStyles;
        };
        /**
         * The id used for the style of content editor.
         */
        DesignerContentEditorStyles.designerStylesId = "designerStyles";
        /**
         * The id used for the style element with custom CKEditor styles.
         */
        DesignerContentEditorStyles.ckEditorStylesId = "ckEditorStyles";
        /**
         * The id used for the style element with custom CKEditor skin styles.
         */
        DesignerContentEditorStyles.ckEditorSkinStylesId = "ckEditorSkinStyles";
        /**
         * The custom CKEditor styles
         */
        DesignerContentEditorStyles.ckEditorStyles = "\n/* CKEditor dialog (fix dialog tabbing scroll issue) */\n.cke_dialog.cke_ltr {\n    position: absolute !important;\n}\n\n/* CKEditor dialog title */\n.cke_dialog_body .cke_dialog_title {\n    background-color: rgb(255,255,255);\n    border-bottom: none;\n    font-family: \"Segoe UI Regular\",\"Segoe UI\";\n    font-feature-settings: \"kern\";\n    font-kerning: normal;\n    font-size: 30px;\n    font-style: normal;\n    font-weight: 400;\n    color: #267CD7;\n    padding-bottom: 0px;\n    padding-top: 6px;\n}\n\n/* CKEditor dialog body */\n.cke_dialog_body .cke_dialog_contents_body {\n    border-bottom: none;\n}\n\n/* CKEditor dialog footer */\n.cke_dialog_contents .cke_dialog_footer {\n    background-color: rgb(255,255,255);\n    border-top: none;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n\n/* CKEditor footer designer - should not be displayed */\n.cke_dialog_contents .cke_dialog_footer .cke_resizer {\n    display: none;\n}\n\n/* CKEditor footer buttons block */\ntable.cke_dialog_footer_buttons {\n    position: relative;\n    bottom: 3px;\n    margin-right: 0;\n}\n\n/* CKEditor footer buttons */\n.cke_dialog_footer_buttons a.cke_dialog_ui_button {\n    border-radius: 0px;\n    min-width: 90px;\n}\n\n/* CKEditor footer buttons text */\n.cke_dialog_footer_buttons a.cke_dialog_ui_button .cke_dialog_ui_button {\n    font-family:'Segoe UI Regular', 'Segoe UI';\n    font-size: 14px;\n    font-style: normal;\n    font-feature-settings: \"kern\";\n    font-kerning: normal;\n    font-weight: 400;\n}\n\n/* CKEditor footer OK button */\n.cke_dialog_ui_button.cke_dialog_ui_button_ok,\n.cke_dialog_ui_button.cke_dialog_ui_button_ok:hover,\n.cke_dialog_ui_button.cke_dialog_ui_button_ok:focus\n{\n    border-color: #216AB7;\n    background-color: #216AB7;\n}\n\n/* CKEditor footer Cancel button */\n.cke_dialog_ui_button.cke_dialog_ui_button_cancel,\n.cke_dialog_ui_button.cke_dialog_ui_button_cancel:hover,\n.cke_dialog_ui_button.cke_dialog_ui_button_cancel:focus\n{\n    background-color: #FFFFFF;\n}\n\n/* CKEditor footer OK button text */\n.cke_dialog_ui_button.cke_dialog_ui_button_ok .cke_dialog_ui_button {\n    color: #FFFFFF;\n}\n\n/* CKEditor footer Cancel button text */\n.cke_dialog_ui_button.cke_dialog_ui_button_cancel .cke_dialog_ui_button {\n    color: rgb(80, 80, 80)\n}\n\n/* CKEditor paste iframe (for paste dialogs) */\n.cke_dialog .cke_dialog_ui_html iframe.cke_pasteframe {\n    border-radius: 0px;\n    width: 100%;\n    box-sizing: border-box;\n}\n\n/* Fix opportunity to set focus(special characters dialog) */\nspan.cke_dialog_ui_html{\n    display:block\n}\n\n/* CKEditor dialog close button */\n.cke_dialog .cke_dialog_body .cke_dialog_close_button,\n.cke_dialog .cke_dialog_body .cke_dialog_close_button:hover {\n    opacity: 1;\n    top: 22px;\n    right: 22px;\n}\n\n/* CKEditor dialog contents text, legends and labels */\n.cke_dialog_body table.cke_dialog_contents .cke_dialog_ui_html,\n.cke_dialog_page_contents .cke_dialog_ui_labeled_label,\n.cke_dialog_contents .cke_dialog_ui_fieldset legend,\n.cke_dialog_contents .cke_dialog_ui_fieldset label {\n    font-family: \"Segoe UI Regular\",\"Segoe UI\";\n    font-feature-settings: \"kern\";\n    font-kerning: normal;\n    font-size: 13px;\n    font-style: normal;\n    font-weight: 400;\n    color: rgb(80, 80, 80);\n}\n\n/* CKEditor dialog contents */\n.cke_dialog_body .cke_dialog_contents_body {\n    padding-top: 0px;\n    padding-bottom: 0px;\n}\n\n/* CKEditor dialog tabs */\n.cke_dialog_tabs .cke_dialog_tab,\n.cke_dialog_tabs .cke_dialog_tab:hover {\n    font-family: \"Segoe UI Regular\",\"Segoe UI\";\n    font-feature-settings: \"kern\";\n    font-kerning: normal;\n    font-size: 13px;\n    font-style: normal;\n    font-weight: 400;\n    border-radius: 0px;\n    color: rgb(80, 80, 80);\n}\n\n/* CKEditor dialog body buttons */\n.cke_dialog_contents_body .cke_dialog_ui_button {\n    font-family: \"Segoe UI Regular\",\"Segoe UI\";\n    font-feature-settings: \"kern\";\n    font-kerning: normal;\n    font-size: 13px;\n    font-style: normal;\n    font-weight: 400;\n    border-radius: 0px;\n    color: rgb(80, 80, 80);\n    background-color: #FFFFFF;\n}\n\n/* CKEditor dialog body inputs */\n.cke_dialog_contents_body .cke_dialog_ui_input_text {\n    font-family: \"Segoe UI Regular\",\"Segoe UI\";\n    font-feature-settings: \"kern\";\n    font-kerning: normal;\n    font-style: normal;\n    font-weight: 400;\n    border-radius: 0px;\n}\n\n/* CKEditor dialog body focused inputs */\n.cke_dialog_contents_body .cke_dialog_ui_input_text:focus {\n    border-width: 1px;\n}\n\n.cke_dialog .cke_dialog_body {\n    box-shadow: 3px 3px 5px #888888;\n}\n\n.cke_dialog .cke_dialog_body .cke_dialog_title {\n    padding: 30px 20px 20px 20px;\n}\n\n.cke_dialog .cke_dialog_body .cke_dialog_close_button {\n    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AcTDR4qLT7wGQAAAVZJREFUOMuNU0Fqw0AMHGnX4HwlLwgklxYCxYdCoJBD6e96bCA5lEKhPfWSByTPyLULtqReLHvr2KU62asZaaTZpaqq4GFmV9/M/OufiJAH448YgseCp0BT57lKIpouMEUaNmFm7roR0RcAU9W7kV1UAKzFOLlXkFKCmS3NDMz8FkK49SIhhBtVfTUzmNkypdQr8A5lWYKZn7yriHzEGOcxxrmIfGZKHsuy7NRFVUVbGWb2HGP8bprmxczQNM0pHyPG+CAiO1emqr0CDxHZFUWxcqLni6JY5WTPj94DIrrk7hARiOjy33uwruv6PLyVdV2fAaxHbeyqMd8DeHdyCGERQlhke3hvMY7vR0gpQUQO2bY3InIUkSMzbzJ3Dm4jALCqdjYCOLXkraru29mhqntm3rack9uoqqCqqrptExFSSl7sKjznWCJCHD7T2Wx29QbynJM9/wO7NtviVH40xgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNi0wNy0xOVQxMzozMDo0MiswMjowMBiQd3gAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTYtMDctMTlUMTM6MzA6NDIrMDI6MDBpzc/EAAAAAElFTkSuQmCC');\n}\n\n.cke_dialog .cke_dialog_body .cke_dialog_contents .cke_dialog_contents_body {\n    padding: 0px 20px 30px 20px;\n}\n\n.cke_dialog .cke_dialog_body .cke_dialog_contents .cke_dialog_footer {\n    background-color: #dddddd;\n    padding: 10px 20px 10px 0px;\n}\n\n.cke_dialog .cke_dialog_body .cke_dialog_contents .cke_dialog_footer .cke_dialog_footer_buttons {\n    margin: 0px;\n    bottom: 0px;\n}\n\n.cke_float .cke_top {\n    border: 1px solid #d1d1d1;\n    box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.3);\n}\n";
        /**
         * The custom CKEditor skin styles
         */
        DesignerContentEditorStyles.ckEditorSkinStyles = "\n.cke_browser_ios .cke_contents\n{\n    overflow: auto !important;\n    -webkit-overflow-scrolling: touch !important;\n}\n\n.cke_button_icon.cke_button__about_icon {\n    background: url({0}/icons.png) no-repeat 0 -0px !important;\n}\n\n.cke_button_icon.cke_button__bold_icon {\n    background: url({0}/icons.png) no-repeat 0 -24px !important;\n}\n\n.cke_button_icon.cke_button__italic_icon {\n    background: url({0}/icons.png) no-repeat 0 -48px !important;\n}\n\n.cke_button_icon.cke_button__strike_icon {\n    background: url({0}/icons.png) no-repeat 0 -72px !important;\n}\n\n.cke_button_icon.cke_button__subscript_icon {\n    background: url({0}/icons.png) no-repeat 0 -96px !important;\n}\n\n.cke_button_icon.cke_button__superscript_icon {\n    background: url({0}/icons.png) no-repeat 0 -120px !important;\n}\n\n.cke_button_icon.cke_button__underline_icon {\n    background: url({0}/icons.png) no-repeat 0 -144px !important;\n}\n\n.cke_button_icon.cke_button__bidiltr_icon {\n    background: url({0}/icons.png) no-repeat 0 -168px !important;\n}\n\n.cke_button_icon.cke_button__bidirtl_icon {\n    background: url({0}/icons.png) no-repeat 0 -192px !important;\n}\n\n.cke_button_icon.cke_button__blockquote_icon {\n    background: url({0}/icons.png) no-repeat 0 -216px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__copy_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__copy_icon {\n    background: url({0}/icons.png) no-repeat 0 -240px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__copy_icon {\n    background: url({0}/icons.png) no-repeat 0 -264px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__cut_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__cut_icon {\n    background: url({0}/icons.png) no-repeat 0 -288px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__cut_icon {\n    background: url({0}/icons.png) no-repeat 0 -312px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__paste_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__paste_icon {\n    background: url({0}/icons.png) no-repeat 0 -336px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__paste_icon {\n    background: url({0}/icons.png) no-repeat 0 -360px !important;\n}\n\n.cke_button_icon.cke_button__bgcolor_icon {\n    background: url({0}/icons.png) no-repeat 0 -384px !important;\n}\n\n.cke_button_icon.cke_button__textcolor_icon {\n    background: url({0}/icons.png) no-repeat 0 -408px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__templates_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__templates_icon {\n    background: url({0}/icons.png) no-repeat 0 -432px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__templates_icon {\n    background: url({0}/icons.png) no-repeat 0 -456px !important;\n}\n\n.cke_button_icon.cke_button__copyformatting_icon {\n    background: url({0}/icons.png) no-repeat 0 -480px !important;\n}\n\n.cke_button_icon.cke_button__creatediv_icon {\n    background: url({0}/icons.png) no-repeat 0 -504px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__find_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__find_icon {\n    background: url({0}/icons.png) no-repeat 0 -528px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__find_icon {\n    background: url({0}/icons.png) no-repeat 0 -552px !important;\n}\n\n.cke_button_icon.cke_button__replace_icon {\n    background: url({0}/icons.png) no-repeat 0 -576px !important;\n}\n\n.cke_button_icon.cke_button__flash_icon {\n    background: url({0}/icons.png) no-repeat 0 -600px !important;\n}\n\n.cke_button_icon.cke_button__button_icon {\n    background: url({0}/icons.png) no-repeat 0 -624px !important;\n}\n\n.cke_button_icon.cke_button__checkbox_icon {\n    background: url({0}/icons.png) no-repeat 0 -648px !important;\n}\n\n.cke_button_icon.cke_button__form_icon {\n    background: url({0}/icons.png) no-repeat 0 -672px !important;\n}\n\n.cke_button_icon.cke_button__hiddenfield_icon {\n    background: url({0}/icons.png) no-repeat 0 -696px !important;\n}\n\n.cke_button_icon.cke_button__imagebutton_icon {\n    background: url({0}/icons.png) no-repeat 0 -720px !important;\n}\n\n.cke_button_icon.cke_button__radio_icon {\n    background: url({0}/icons.png) no-repeat 0 -744px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__select_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__select_icon {\n    background: url({0}/icons.png) no-repeat 0 -768px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__select_icon {\n    background: url({0}/icons.png) no-repeat 0 -792px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__textarea_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__textarea_icon {\n    background: url({0}/icons.png) no-repeat 0 -816px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__textarea_icon {\n    background: url({0}/icons.png) no-repeat 0 -840px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__textfield_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__textfield_icon {\n    background: url({0}/icons.png) no-repeat 0 -864px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__textfield_icon {\n    background: url({0}/icons.png) no-repeat 0 -888px !important;\n}\n\n.cke_button_icon.cke_button__horizontalrule_icon {\n    background: url({0}/icons.png) no-repeat 0 -912px !important;\n}\n\n.cke_button_icon.cke_button__iframe_icon {\n    background: url({0}/icons.png) no-repeat 0 -936px !important;\n}\n\n.cke_button_icon.cke_button__image_icon {\n    background: url({0}/icons.png) no-repeat 0 -960px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__indent_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__indent_icon {\n    background: url({0}/icons.png) no-repeat 0 -984px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__indent_icon {\n    background: url({0}/icons.png) no-repeat 0 -1008px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__outdent_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__outdent_icon {\n    background: url({0}/icons.png) no-repeat 0 -1032px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__outdent_icon {\n    background: url({0}/icons.png) no-repeat 0 -1056px !important;\n}\n\n.cke_button_icon.cke_button__smiley_icon {\n    background: url({0}/icons.png) no-repeat 0 -1080px !important;\n}\n\n.cke_button_icon.cke_button__justifyblock_icon {\n    background: url({0}/icons.png) no-repeat 0 -1104px !important;\n}\n\n.cke_button_icon.cke_button__justifycenter_icon {\n    background: url({0}/icons.png) no-repeat 0 -1128px !important;\n}\n\n.cke_button_icon.cke_button__justifyleft_icon {\n    background: url({0}/icons.png) no-repeat 0 -1152px !important;\n}\n\n.cke_button_icon.cke_button__justifyright_icon {\n    background: url({0}/icons.png) no-repeat 0 -1176px !important;\n}\n\n.cke_button_icon.cke_button__language_icon {\n    background: url({0}/icons.png) no-repeat 0 -1200px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__anchor_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__anchor_icon {\n    background: url({0}/icons.png) no-repeat 0 -1224px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__anchor_icon {\n    background: url({0}/icons.png) no-repeat 0 -1248px !important;\n}\n\n.cke_button_icon.cke_button__link_icon {\n    background: url({0}/icons.png) no-repeat 0 -1272px !important;\n}\n\n.cke_button_icon.cke_button__unlink_icon {\n    background: url({0}/icons.png) no-repeat 0 -1296px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__bulletedlist_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__bulletedlist_icon {\n    background: url({0}/icons.png) no-repeat 0 -1320px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__bulletedlist_icon {\n    background: url({0}/icons.png) no-repeat 0 -1344px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__numberedlist_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__numberedlist_icon {\n    background: url({0}/icons.png) no-repeat 0 -1368px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__numberedlist_icon {\n    background: url({0}/icons.png) no-repeat 0 -1392px !important;\n}\n\n.cke_button_icon.cke_button__maximize_icon {\n    background: url({0}/icons.png) no-repeat 0 -1416px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__newpage_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__newpage_icon {\n    background: url({0}/icons.png) no-repeat 0 -1440px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__newpage_icon {\n    background: url({0}/icons.png) no-repeat 0 -1464px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__pagebreak_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__pagebreak_icon {\n    background: url({0}/icons.png) no-repeat 0 -1488px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__pagebreak_icon {\n    background: url({0}/icons.png) no-repeat 0 -1512px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__pastetext_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__pastetext_icon {\n    background: url({0}/icons.png) no-repeat 0 -1536px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__pastetext_icon {\n    background: url({0}/icons.png) no-repeat 0 -1560px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__pastefromword_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__pastefromword_icon {\n    background: url({0}/icons.png) no-repeat 0 -1584px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__pastefromword_icon {\n    background: url({0}/icons.png) no-repeat 0 -1608px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__preview_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__preview_icon {\n    background: url({0}/icons.png) no-repeat 0 -1632px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__preview_icon {\n    background: url({0}/icons.png) no-repeat 0 -1656px !important;\n}\n\n.cke_button_icon.cke_button__print_icon {\n    background: url({0}/icons.png) no-repeat 0 -1680px !important;\n}\n\n.cke_button_icon.cke_button__removeformat_icon {\n    background: url({0}/icons.png) no-repeat 0 -1704px !important;\n}\n\n.cke_button_icon.cke_button__save_icon {\n    background: url({0}/icons.png) no-repeat 0 -1728px !important;\n}\n\n.cke_button_icon.cke_button__selectall_icon {\n    background: url({0}/icons.png) no-repeat 0 -1752px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__showblocks_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__showblocks_icon {\n    background: url({0}/icons.png) no-repeat 0 -1776px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__showblocks_icon {\n    background: url({0}/icons.png) no-repeat 0 -1800px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__source_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__source_icon {\n    background: url({0}/icons.png) no-repeat 0 -1824px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__source_icon {\n    background: url({0}/icons.png) no-repeat 0 -1848px !important;\n}\n\n.cke_button_icon.cke_button__specialchar_icon {\n    background: url({0}/icons.png) no-repeat 0 -1872px !important;\n}\n\n.cke_button_icon.cke_button__scayt_icon {\n    background: url({0}/icons.png) no-repeat 0 -1896px !important;\n}\n\n.cke_button_icon.cke_button__table_icon {\n    background: url({0}/icons.png) no-repeat 0 -1920px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__redo_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__redo_icon {\n    background: url({0}/icons.png) no-repeat 0 -1944px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__redo_icon {\n    background: url({0}/icons.png) no-repeat 0 -1968px !important;\n}\n\n.cke_rtl .cke_button_icon.cke_button__undo_icon,\n.cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__undo_icon {\n    background: url({0}/icons.png) no-repeat 0 -1992px !important;\n}\n\n.cke_ltr .cke_button_icon.cke_button__undo_icon {\n    background: url({0}/icons.png) no-repeat 0 -2016px !important;\n}\n\n.cke_button_icon.cke_button__spellchecker_icon {\n    background: url({0}/icons.png) no-repeat 0 -2040px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__about_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -0px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__bold_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -24px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__italic_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -48px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__strike_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -72px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__subscript_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -96px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__superscript_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -120px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__underline_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -144px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__bidiltr_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -168px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__bidirtl_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -192px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__blockquote_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -216px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__copy_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__copy_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -240px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__copy_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__copy_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -264px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__cut_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__cut_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -288px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__cut_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__cut_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -312px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__paste_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__paste_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -336px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__paste_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__paste_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -360px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__bgcolor_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -384px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__textcolor_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -408px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__templates_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__templates_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -432px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__templates_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__templates_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -456px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__copyformatting_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -480px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__creatediv_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -504px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__find_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__find_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -528px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__find_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__find_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -552px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__replace_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -576px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__flash_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -600px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__button_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -624px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__checkbox_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -648px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__form_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -672px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__hiddenfield_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -696px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__imagebutton_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -720px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__radio_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -744px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__select_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__select_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -768px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__select_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__select_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -792px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__textarea_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__textarea_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -816px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__textarea_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__textarea_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -840px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__textfield_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__textfield_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -864px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__textfield_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__textfield_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -888px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__horizontalrule_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -912px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__iframe_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -936px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__image_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -960px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__indent_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__indent_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -984px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__indent_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__indent_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1008px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__outdent_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__outdent_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1032px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__outdent_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__outdent_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1056px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__smiley_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1080px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__justifyblock_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1104px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__justifycenter_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1128px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__justifyleft_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1152px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__justifyright_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1176px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__language_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1200px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__anchor_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__anchor_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1224px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__anchor_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__anchor_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1248px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__link_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1272px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__unlink_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1296px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__bulletedlist_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__bulletedlist_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1320px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__bulletedlist_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__bulletedlist_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1344px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__numberedlist_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__numberedlist_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1368px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__numberedlist_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__numberedlist_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1392px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__maximize_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1416px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__newpage_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__newpage_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1440px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__newpage_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__newpage_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1464px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__pagebreak_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__pagebreak_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1488px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__pagebreak_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__pagebreak_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1512px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__pastetext_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__pastetext_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1536px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__pastetext_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__pastetext_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1560px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__pastefromword_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__pastefromword_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1584px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__pastefromword_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__pastefromword_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1608px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__preview_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__preview_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1632px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__preview_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__preview_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1656px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__print_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1680px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__removeformat_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1704px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__save_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1728px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__selectall_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1752px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__showblocks_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__showblocks_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1776px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__showblocks_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__showblocks_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1800px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__source_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__source_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1824px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__source_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__source_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1848px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__specialchar_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1872px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__scayt_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1896px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__table_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1920px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__redo_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__redo_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1944px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__redo_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__redo_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1968px !important;\n    background-size: 16px !important;\n}\n\n.cke_rtl.cke_hidpi .cke_button_icon.cke_button__undo_icon,\n.cke_hidpi .cke_mixed_dir_content .cke_rtl .cke_button_icon.cke_button__undo_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -1992px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_ltr .cke_button_icon.cke_button__undo_icon,\n.cke_ltr.cke_hidpi .cke_button_icon.cke_button__undo_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -2016px !important;\n    background-size: 16px !important;\n}\n\n.cke_hidpi .cke_button_icon.cke_button__spellchecker_icon {\n    background: url({0}/icons_hidpi.png) no-repeat 0 -2040px !important;\n    background-size: 16px !important;\n}\n\n.cke_button_icon {\n    transform: scale(0.75);\n}\n\n.cke_button_on:focus {\n    outline: 1px solid lightgrey;\n}\n\n.cke_dialog_close_button:focus {\n    outline: #3961C6 1px solid !important;\n}\n\n.cke_top {\n    padding: 4px 4px 2px !important;\n}\n\n.cke_toolgroup {\n    margin: 1px 2px !important;\n}\n\n.selectedElement {\n    display: flex;\n    flex-direction: column;\n    flex: 1 1 0%;\n    position: relative;\n}\n\n.selectedElement:focus {\n    outline: none;\n}\n\n.decoratedAreaIconMove,\n.decoratedAreaIconReturn,\n.decoratedAreaIconDelete\n {\n    width: 14px;\n    height: 14px;\n    cursor:pointer;\n    margin: auto !important;\n    border: none !important;\n}\n\n\n.decoratedAreaIconDelete:after {\n    content: url(\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMiwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8cGF0aCBzdHlsZT0iZmlsbDojZmZmZmZmOyIgZD0iTTE0LDNoLTF2MTEuNWMwLDAuMjA5LTAuMDM5LDAuNDA0LTAuMTE3LDAuNTg2Yy0wLjA3OCwwLjE4My0wLjE4NiwwLjM0Mi0wLjMyLDAuNDc3Yy0wLjEzNywwLjEzNi0wLjI5NSwwLjI0Mi0wLjQ3NywwLjMyCglDMTEuOTAyLDE1Ljk2MSwxMS43MDcsMTYsMTEuNSwxNmgtOGMtMC4yMDgsMC0wLjQwNC0wLjAzOS0wLjU4Ni0wLjExN2MtMC4xODMtMC4wNzgtMC4zNDEtMC4xODUtMC40NzctMC4zMgoJYy0wLjEzNi0wLjEzNS0wLjI0Mi0wLjI5NC0wLjMyLTAuNDc3QzIuMDM5LDE0LjkwNCwyLDE0LjcwOSwyLDE0LjVWM0gxVjJoNFYxYzAtMC4xNDEsMC4wMjYtMC4yNzEsMC4wNzgtMC4zOTEKCWMwLjA1MS0wLjEyLDAuMTI0LTAuMjI1LDAuMjE1LTAuMzE2QzUuMzgzLDAuMjAyLDUuNDg5LDAuMTMsNS42MSwwLjA3OEM1LjcyOSwwLjAyNiw1Ljg2LDAsNiwwaDNjMC4xNDEsMCwwLjI3LDAuMDI2LDAuMzkxLDAuMDc4CglDOS41MSwwLjEzLDkuNjE1LDAuMjAyLDkuNzA3LDAuMjkzYzAuMDksMC4wOTEsMC4xNjIsMC4xOTcsMC4yMTUsMC4zMTZDOS45NzMsMC43MjksMTAsMC44NTksMTAsMXYxaDRWM3ogTTEyLDNIM3YxMS41CgljMCwwLjEzNiwwLjA0OSwwLjI1MywwLjE0OCwwLjM1MkMzLjI0NywxNC45NTEsMy4zNjQsMTUsMy41LDE1aDhjMC4xMzUsMCwwLjI1Mi0wLjA0OSwwLjM1Mi0wLjE0OEMxMS45NDksMTQuNzUzLDEyLDE0LjYzNiwxMiwxNC41CglWM3ogTTYsMTNINVY1aDFWMTN6IE02LDJoM1YxSDZWMnogTTgsMTNIN1Y1aDFWMTN6IE0xMCwxM0g5VjVoMVYxM3oiLz4KPC9zdmc+Cg==\");\n}\n\n.decoratedAreaIconReturn:after {\n    content: url(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE0IDlIMy43MTA5M0w3LjM1MTU1IDEyLjY0ODRMNi42NDg0MyAxMy4zNTE2TDEuNzk2ODggOC41TDYuNjQ4NDMgMy42NDg0NEw3LjM1MTU1IDQuMzUxNTZMMy43MTA5MyA4SDEzVjNIMTRWOVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=\");\n}\n\n.decoratedAreaIconMove:after {\n  content: url(\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMiwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8cGF0aCBzdHlsZT0iZmlsbDojZmZmZmZmOyIgZD0iTTEuOTE0LDhsMS42MDksMS42MDJsLTAuNzExLDAuNzExTDAsNy41bDIuODEyLTIuODEybDAuNzExLDAuNzExTDEuOTE0LDdINXYxSDEuOTE0eiBNOS42MDIsMTEuNDc3bDAuNzExLDAuNzExTDcuNSwxNQoJbC0yLjgxMy0yLjgxMmwwLjcxMS0wLjcxMUw3LDEzLjA4NlYxMGgxdjMuMDg2TDkuNjAyLDExLjQ3N3ogTTUuNDMsMy40ODRMNC43MjcsMi43ODFMNy41LDBsMi44MTIsMi44MTJMOS42MDIsMy41MjNMOCwxLjkxNFY1SDcKCVYxLjkxNEw1LjQzLDMuNDg0eiBNMTUsNy41bC0yLjc4MSwyLjc3M0wxMS41MTYsOS41N0wxMy4wODYsOEgxMFY3aDMuMDg2bC0xLjYwOS0xLjYwMmwwLjcxMS0wLjcxMUwxNSw3LjV6Ii8+Cjwvc3ZnPgo=\");\n}\n\n.decoratedAreaHeader {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-end;\n    justify-content: space-between;\n    min-width: 100px;\n    position: absolute;\n    top: -" + Editor.CommonConstants.decoratedAreaHeaderHeight + ";\n    width: 100%;\n    pointer-events: none;\n    word-break: normal;\n}\n\n.decoratedAreaTitle {\n    display: flex;\n    background: #2266E3 !important;\n    font-family: Segoe UI;\n    font-size: 12px;\n    line-height: 12px;\n    color: #FFFFFF !important;\n    padding: 0 10px 2px;\n    border: 1px solid #2266E3;\n    border-top-left-radius: 2px;\n    border-top-right-radius: 2px;\n    height: " + Editor.CommonConstants.decoratedAreaHeaderHeight + ";\n    margin-left: -2px;\n    box-sizing: border-box;\n    align-items: center;\n    pointer-events: all;\n}\n\n.decoratedAreaButtonDiv {\n    display: flex;\n    border: 1px solid #2266E3;\n    border-top-left-radius: 2px;\n    border-top-right-radius: 2px;\n    background: #2266E3 !important;\n    height: " + Editor.CommonConstants.decoratedAreaHeaderHeight + ";\n    box-sizing: border-box;\n    margin-right: -2px;\n    pointer-events: all;\n}\n\n.decoratedAreaButton {\n    display: flex;\n    background-color: #2266E3 !important;\n    color: #2266E3;\n    border: none;\n    border-radius: 0px;\n    margin: 0px;\n    height: 100%;\n    width: 28px;\n    margin: 0;\n    align-items: center;\n    justify-content: center;\n}\n\n.decoratedAreaAbTestingButton {\n    justify-content: center;\n    align-items: center;\n    font-size: 12px;\n    color: #FFF;\n    width: 34px;\n    padding-bottom: 0px;\n    white-space: nowrap;\n}\n\n.decoratedAreaAbTestingButtonInverted {\n    color: #2266E3 !important;\n    font-weight: bold;\n}\n\n.decoratedAreaIcon {\n    width: 14px;\n    height: 14px;\n    margin: auto !important;\n    background-color: #2266E3!important;\n    border: none !important;\n}\n\n@media screen and (-ms-high-contrast: black-on-white) {\n    .decoratedAreaIconReturn {\n        content: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEPSURBVFhH7dU9TgJBGMbxRfGjF6ThBBg7am/BDegwNh7B0obCWFDhHfxIKGjpJHIG9Q7ayP/ZOMkbmt3ZWYaQzJP8Qmay4X1m2SxZSkpKxAzwiKt8FZjW/6dPpvjDbb4KSA+feEBTGyWj61VglK8qRsO/oS+a4QRlE1zADn/GMXwSVMAOf8ERfFO5gIZ/wQ33PblLpQJ2+CuqDle8C1zA3vaQ4YpXAXvyJ23UkHuUKtCHO/kvJhhDJwixQmGBBt6gC7el8E3YxTt08Q/uMMR1DW5wicKcwZWY4xDRoz8cV0K/XwfRs1niHNFjS3xgJyXsM6ESbUSPvRNL7PyZUIlTRI9KLKAXyoE2UlL2OFm2BhNycDoRQsQTAAAAAElFTkSuQmCC');\n    }\n\n    .decoratedAreaIconDelete {\n        content: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEoSURBVFhH7ZexagJBFEW38HfsbGyiH6F2QcsQE1KkTWclBIIxkTSJliF+hb+Q30hvG88deLDIkNnZnYUUc+EUd4b35q5vwdkiUiNYw4uHJxhCa9LhvxXoQSt6Ax3wBddwU0L+ANq/g1b0CDpAv4RPC9D+zLkamoBvtsY36AA9aZ194wK82oMatM0DeDUAzdNm6Zt1LOV3Q/201oU/ZbOeOtdc0f00JxXMnWuu6H7/NsAYNmBvccibkgXYgdbvnQt7U7IA5+shb8oBcoAcIAfIAXKAZAG2oHX7twt5U7IAujPqzm93upA3JQtQV9H9XkEFV8411wrUTzfiStK1SgXns6yrd1C/W+cq6BJU8AP6HnwGfRHHoroPOIL69aGSOvAJKkrFEjwqihNz0C6QiCH4aQAAAABJRU5ErkJggg==');\n    }\n\n    .decoratedAreaIconMove {\n        content: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAH9SURBVFhH1ZY/SxxRFEcnhigIsUydxk5BLNJpWokptFCIisbGfwlYaJdAIoIilirYRE0gKfQDCJLO+AGSSrCxslXQwoRAcn5v5q7DODs7sm9n8cBh353dmXvfzHt3NqiCh9gXDuvDF/yHH11UMFuo5GahRSSTF1rEJ1SyM/wRjQ/wOhrXrIhH+BWV5BLbcSGKB7E3GstVbECvqIBvqORdOgAbqIQzLgqCMVSsxakd4h3NqjUcOtZRCd+4KOQZPgiHtSetAK9Uuo3bqALmXFSepujzTuziIT5xUTrPcRa1IMuhR/YLtTBzs4OamezUgSroR7tWri36GfXjK9QMfTCKuYqwmZ9imw545AVeYGoRLWgzl0e4jGsxtee7MQ8DqN/Hz1/CY7Qci1hanHql2hdZvsc87GHa+Uk70KEG8wHti++orqYOpz1uZq32OLpT8fOmcRx/ouXQ9W9hRZyjnplPJvA36vpalGXRAsms8o7o7r5Du+YIViT+ONTbq6EH7VrDOpAXdS5ty2YXpaPXsN4HWbtD52/ilIs8Y31j3kV1oOZvwyRPUb3dSCvgFaqxeecxnqAS2jZSh1M86aKbxbuP3v8RNeIKKoF8iWqnGg+hmo199xZr9q/IZvkHrbdX7HC+ifeJuJkdzjfJIgqZeRKtgb/42kV1ovRKvacEwX9t0KQKXsPomgAAAABJRU5ErkJggg==');\n    }\n\n    .addBlockButton {\n        content: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACYSURBVFhH7ZexCYAwFEQzmWPYaitaOoaVaG8rTuEKLqR3n9iFgKb4zR284iAk7xNBDYWpwQIqaw7ZwA1Gaw7h9BTorTlEAhKQgAQk4C4wAQq01n6Gr9QVcJovzOACFDhjT63LwXPDAbiJF/YxMQDe4xc6wMm5yR57al0OnluU9xlorDmE90gBTuMSCUhAAhKQgLtA4d9xCA8N3HnveiYEXgAAAABJRU5ErkJggg==');\n    }\n}\n\n.decoratedAreaButtonInverted {\n    display: flex;\n    background-color: #FFFFFF !important;\n    color: #FFFFFF;\n    border: none;\n}\n\n.decoratedAreaMarker {\n    outline: 2px solid #2266E3 !important;\n    position: relative;\n    height: 100%;\n    z-index: 1000;\n}\n\n.variantA .decoratedAreaTitle {\n    background: #118DFF !important;\n    border: 1px solid #118DFF;\n}\n\n.variantA .decoratedAreaButtonDiv {\n    background: #118DFF !important;\n    border: 1px solid #118DFF;\n}\n\n.variantA .decoratedAreaMarker {\n    outline: 2px solid #118DFF !important;\n}\n\n.variantA .decoratedAreaButton {\n    background-color: #118DFF !important;\n    color: white !important;\n}\n\n.variantA .decoratedAreaIcon {\n    background-color: #118DFF !important;\n}\n\n.variantA .decoratedAreaButtonInverted {\n    background-color: white !important;\n    color: #118DFF !important;\n}\n\n.variantB .decoratedAreaTitle {\n    background: #C83D95 !important;\n    border: 1px solid #C83D95;\n}\n\n.variantB .decoratedAreaButtonDiv {\n    background: #C83D95 !important;\n    border: 1px solid #C83D95;\n}\n\n.variantB .decoratedAreaMarker {\n    outline: 2px solid #C83D95 !important;\n}\n\n.variantB .decoratedAreaButton {\n    background-color: #C83D95 !important;\n    color: white !important;\n}\n\n.variantB .decoratedAreaIcon {\n    background-color: #C83D95 !important;\n}\n\n.variantB .decoratedAreaButtonInverted {\n    background-color: white !important;\n    color: #C83D95 !important;\n}\n\nab-testing, ab-variant {\n    display: block;\n}\n\n.ui-resizable {\n    position: relative;\n    left: 0 !important;\n    top: 0 !important;\n}\n.ui-resizable-handle {\n    position: absolute;\n    font-size: 0.1px;\n    display: block;\n    -ms-touch-action: none;\n    touch-action: none;\n    background-color: #FFFFFF;\n    width: 12px !important;\n    height: 12px !important;\n    border-color: #808080;\n    border-radius: 50% !important;\n    border-style: solid !important;\n    border-width: 1px !important;\n}\n.ui-resizable-disabled .ui-resizable-handle,\n.ui-resizable-autohide .ui-resizable-handle {\n    display: none;\n}\n.ui-resizable-n {\n    cursor: n-resize;\n    top: -5px;\n    left: calc(50% - 6px);\n}\n.ui-resizable-s {\n    cursor: s-resize;\n    bottom: -5px;\n    left: calc(50% - 6px);\n}\n.ui-resizable-e {\n    cursor: e-resize;\n    right: -5px;\n    top: calc(50% - 6px);\n}\n.ui-resizable-w {\n    cursor: w-resize;\n    left: -5px;\n    top: calc(50% - 6px);\n}\n.ui-resizable-se {\n    cursor: se-resize;\n    right: -5px;\n    bottom: -5px;\n}\n.ui-resizable-sw {\n    cursor: sw-resize;\n    left: -5px;\n    bottom: -5px;\n}\n.ui-resizable-nw {\n    cursor: nw-resize;\n    left: -5px;\n    top: -5px;\n}\n.ui-resizable-ne {\n    cursor: ne-resize;\n    right: -5px;\n    top: -5px;\n}\n.ui-wrapper {\n    left: 0 !important;\n    top: 0 !important;\n}\n.zero-state-container {\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n}\n.zero-state-img-container {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    text-align: center;\n}\n.zero-state-img-container img {\n    height: 100px;\n}\n.zero-state-img-container p {\n    margin-top: 20px;\n    font-size: 18px;\n    font-weight: 400;\n}\n\n.cke_widget_wrapper_msdyncxp_personalization.cke_widget_selected {\n    background-color: #3390ff;\n}\n\n.cke_widget_wrapper_msdyncxp_personalization.cke_widget_selected .msdyncxp_personalization {\n    background-color: #3390ff;\n}\n\n.cke_widget_wrapper_msdyncxp_personalization {\n    background-color: #fdf6d7;\n    border: 1px solid #dab50f;\n    border-radius: 2px;\n}\n\n.msdyncxp_personalization {\n    background-color: #fdf6d7;\n    border: 1px solid #dab50f;\n    border-radius: 2px;\n}\n\n";
        return DesignerContentEditorStyles;
    }());
    Editor.DesignerContentEditorStyles = DesignerContentEditorStyles;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BlockClickedEventArgs = /** @class */ (function (_super) {
        __extends(BlockClickedEventArgs, _super);
        function BlockClickedEventArgs() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        return BlockClickedEventArgs;
    }(Editor.EventArgs));
    Editor.BlockClickedEventArgs = BlockClickedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BlockLoadedEventArgs = /** @class */ (function (_super) {
        __extends(BlockLoadedEventArgs, _super);
        function BlockLoadedEventArgs(block, sourceId) {
            var _this = _super.call(this, sourceId) || this;
            _this.block = block;
            return _this;
        }
        return BlockLoadedEventArgs;
    }(Editor.EventArgs));
    Editor.BlockLoadedEventArgs = BlockLoadedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SectionLoadedEventArgs = /** @class */ (function (_super) {
        __extends(SectionLoadedEventArgs, _super);
        function SectionLoadedEventArgs(section, sourceId) {
            var _this = _super.call(this, sourceId) || this;
            _this.section = section;
            return _this;
        }
        return SectionLoadedEventArgs;
    }(Editor.EventArgs));
    Editor.SectionLoadedEventArgs = SectionLoadedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var DesignerInternalContentChangedEventArgs = /** @class */ (function (_super) {
        __extends(DesignerInternalContentChangedEventArgs, _super);
        function DesignerInternalContentChangedEventArgs(sourceId) {
            return _super.call(this, sourceId) || this;
        }
        return DesignerInternalContentChangedEventArgs;
    }(Editor.EventArgs));
    Editor.DesignerInternalContentChangedEventArgs = DesignerInternalContentChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BlockDeletedEventArgs = /** @class */ (function (_super) {
        __extends(BlockDeletedEventArgs, _super);
        function BlockDeletedEventArgs() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        return BlockDeletedEventArgs;
    }(Editor.EventArgs));
    Editor.BlockDeletedEventArgs = BlockDeletedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ContentBlockAttributeChangedEventArgs = /** @class */ (function (_super) {
        __extends(ContentBlockAttributeChangedEventArgs, _super);
        function ContentBlockAttributeChangedEventArgs(contentBlockElement, finalizedHtml, entityId, entityName) {
            var _this = _super.call(this) || this;
            _this.contentBlockElement = contentBlockElement;
            _this.finalizedHtml = finalizedHtml;
            _this.entityId = entityId;
            _this.entityName = entityName;
            return _this;
        }
        return ContentBlockAttributeChangedEventArgs;
    }(Editor.EventArgs));
    Editor.ContentBlockAttributeChangedEventArgs = ContentBlockAttributeChangedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Column Details View
     */
    var ColumnDetailsView = /** @class */ (function () {
        function ColumnDetailsView(columnStylesDetailsView, detailsViewControl) {
            this.columnStylesDetailsView = columnStylesDetailsView;
            this.detailsViewControl = detailsViewControl;
        }
        /**
         * Initializes form control
         */
        ColumnDetailsView.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.detailsViewControl.init(this.containerId, this.eventBroker);
            this.columnStylesDetailsView.init(eventBroker, containerId);
        };
        /**
         * Disposes the form control
         */
        ColumnDetailsView.prototype.dispose = function () {
            this.detailsViewControl.dispose();
            this.currentSection = undefined;
            this.clearContainer();
            this.columnStylesDetailsView.dispose();
        };
        /**
         * Renders the form control
         */
        ColumnDetailsView.prototype.render = function (selectedBlock) {
            if (this.currentSection === selectedBlock[0]) {
                // nothing was change since the last render
                return;
            }
            this.currentSection = selectedBlock[0];
            this.clearContainer();
            this.addColumnHeader();
            this.columnStylesDetailsView.render(selectedBlock);
        };
        ColumnDetailsView.prototype.addColumnHeader = function () {
            var columnContainer = document.createElement("div");
            columnContainer.classList.add(Editor.DetailsViewConstants.sectionContainerClassName);
            columnContainer.classList.add(Editor.CommonUtils.getLangDirectionClass());
            var columnHeading = document.createElement("div");
            columnHeading.classList.add("columnHeader");
            var columnTitle = document.createElement("span");
            columnTitle.classList.add(Editor.DetailsViewConstants.headingClassName);
            columnTitle.setAttribute(Editor.AriaAttributeNames.role, Editor.AriaRoleConstants.presentation);
            var columnLabel = document.createElement("p");
            columnLabel.id = MktSvc.Controls.Common.UniqueId.generate();
            columnLabel.classList.add(Editor.DetailsViewConstants.headingLabelClassName);
            columnLabel.innerText = Editor.CommonUtils.getLocalizedString(Editor.CommonConstants.columnTitle);
            columnTitle.appendChild(columnLabel);
            columnHeading.appendChild(columnTitle);
            columnContainer.appendChild(columnTitle);
            Editor.CommonUtils.getById(this.containerId).append(columnContainer);
        };
        ColumnDetailsView.prototype.clearContainer = function () {
            Editor.CommonUtils.getById(this.containerId).empty();
        };
        return ColumnDetailsView;
    }());
    Editor.ColumnDetailsView = ColumnDetailsView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Section Details View
     */
    var SectionDetailsView = /** @class */ (function () {
        function SectionDetailsView(sectionStylesDetailsView, detailsViewControl, fcbList, showCustomColumnsOption) {
            this.sectionStylesDetailsView = sectionStylesDetailsView;
            this.detailsViewControl = detailsViewControl;
            this.fcbList = fcbList;
            this.showCustomColumnsOption = showCustomColumnsOption;
            this.minNumberOfColumns = 1;
            this.maxNumberOfColumns = 10;
        }
        /**
         * Initializes form control
         */
        SectionDetailsView.prototype.init = function (eventBroker, containerId) {
            this.eventBroker = eventBroker;
            this.containerId = containerId;
            this.detailsViewControl.init(this.containerId, this.eventBroker);
            this.sectionStylesDetailsView.init(eventBroker, containerId);
        };
        /**
         * Disposes the form control
         */
        SectionDetailsView.prototype.dispose = function () {
            this.detailsViewControl.dispose();
            this.currentSectionType = undefined;
            this.currentSection = undefined;
            this.clearContainer();
            this.sectionStylesDetailsView.dispose();
        };
        /**
         * Renders the form control
         */
        SectionDetailsView.prototype.render = function (selectedBlock) {
            if (this.currentSection === selectedBlock[0]) {
                // nothing was changed since the last render
                return;
            }
            this.currentSection = selectedBlock[0];
            this.clearContainer();
            this.addSectionHeader();
            var layoutSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.layoutSectionLabel));
            this.renderSectionDetailsProperties(selectedBlock, layoutSection);
            this.renderCustomColumnConfiguration(selectedBlock, layoutSection);
            this.sectionStylesDetailsView.render(selectedBlock);
        };
        SectionDetailsView.prototype.isCustomColumnLayout = function (selectedBlock) {
            return selectedBlock.attr(Editor.Contract.dataCustomSectionAttrName) === "true";
        };
        SectionDetailsView.prototype.renderCustomColumnConfiguration = function (selectedBlock, section) {
            var _this = this;
            this.columnCountInput = this.detailsViewControl.createInputField(section, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.columnCountInputLabel), Editor.DetailsViewConstants.inputTypeNumber, Editor.DetailsViewConstants.columnCountInputCssClass, this.currentSection.querySelectorAll("[data-container=\"true\"]").length + "", {
                id: "columnCountInput",
                min: this.minNumberOfColumns,
                max: this.maxNumberOfColumns,
                pattern: Editor.InputValidationsConstants.validatePositiveIntNumbers,
                role: "spinbutton"
            }, function () { }, Editor.InputValidationsConstants.positiveIntNotEmpty, function (val) { return _this.changeSectionLayout("CustomColumn", parseInt(val) - _this.currentSection.querySelectorAll("[data-container=\"true\"]").length); });
            if (this.isCustomColumnLayout(selectedBlock)) {
                this.columnCountInput.show();
            }
            else {
                this.columnCountInput.hide();
            }
        };
        SectionDetailsView.prototype.renderSectionDetailsProperties = function (selectedBlock, section) {
            var _this = this;
            var options = new MktSvc.Controls.Common.Dictionary();
            options.addOrUpdate(Editor.DetailsViewConstants.oneColumnOptionValue, new Editor.CustomRadioTileOption(Editor.DetailsViewConstants.oneColumnOptionCss, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.oneColumnOptionLabel)));
            options.addOrUpdate(Editor.DetailsViewConstants.twoColumnOptionValue, new Editor.CustomRadioTileOption(Editor.DetailsViewConstants.twoColumnOptionCss, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.twoColumnOptionLabel)));
            options.addOrUpdate(Editor.DetailsViewConstants.oneTwoColumnOptionValue, new Editor.CustomRadioTileOption(Editor.DetailsViewConstants.oneTwoColumnOptionCss, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.oneTwoColumnOptionLabel)));
            options.addOrUpdate(Editor.DetailsViewConstants.twoOneColumnOptionValue, new Editor.CustomRadioTileOption(Editor.DetailsViewConstants.twoOneColumnOptionCss, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.twoOneColumnOptionLabel)));
            options.addOrUpdate(Editor.DetailsViewConstants.threeColumnOptionValue, new Editor.CustomRadioTileOption(Editor.DetailsViewConstants.threeColumnOptionCss, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.threeColumnOptionLabel)));
            if (this.showCustomColumnsOption) {
                options.addOrUpdate(Editor.DetailsViewConstants.customColumnOptionValue, new Editor.CustomRadioTileOption(Editor.DetailsViewConstants.customColumnOptionCss, Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.customColumnOptionLabel)));
            }
            this.currentSectionType = this.getCurrentSection(this.currentSection);
            this.detailsViewControl.createCustomRadioTileButton(section, options, Editor.DetailsViewConstants.customRadioTileButtonV2, this.currentSectionType, function (value) {
                _this.changeSectionLayout(value, _this.getNumbersOfColumnsToAdd(_this.currentSectionType, value));
            });
        };
        SectionDetailsView.prototype.addSectionHeader = function () {
            var sectionContainer = document.createElement("div");
            sectionContainer.classList.add(Editor.DetailsViewConstants.sectionContainerClassName);
            sectionContainer.classList.add(Editor.CommonUtils.getLangDirectionClass());
            var sectionHeading = document.createElement("div");
            sectionHeading.classList.add("sectionHeader");
            var sectionTitle = document.createElement("span");
            sectionTitle.classList.add(Editor.DetailsViewConstants.headingClassName);
            sectionTitle.setAttribute(Editor.AriaAttributeNames.role, Editor.AriaRoleConstants.presentation);
            var sectionLabel = document.createElement("p");
            sectionLabel.id = MktSvc.Controls.Common.UniqueId.generate();
            sectionLabel.classList.add(Editor.DetailsViewConstants.headingLabelClassName);
            sectionLabel.innerText = Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.sectionTitle);
            sectionTitle.appendChild(sectionLabel);
            sectionHeading.appendChild(sectionTitle);
            sectionContainer.appendChild(sectionTitle);
            Editor.CommonUtils.getById(this.containerId).append(sectionContainer);
        };
        SectionDetailsView.prototype.changeSectionLayout = function (requestedLayoutType, numberOfColumnsToAdd) {
            if (this.currentSectionType !== "CustomColumn" && requestedLayoutType === "CustomColumn") {
                this.currentSection.setAttribute(Editor.Contract.dataCustomSectionAttrName, "true");
                this.currentSectionType = "CustomColumn";
                this.columnCountInput.show();
                return;
            }
            else if (this.currentSectionType === "CustomColumn" && requestedLayoutType !== "CustomColumn") {
                this.currentSection.removeAttribute(Editor.Contract.dataCustomSectionAttrName);
                this.columnCountInput.hide();
            }
            var dataContainers = this.currentSection.querySelectorAll("[data-container=\"true\"]");
            this.updateColumnCount(dataContainers.length, numberOfColumnsToAdd);
            var totalNumberOfColumns = dataContainers.length + numberOfColumnsToAdd;
            if (numberOfColumnsToAdd >= 0 && (totalNumberOfColumns <= 10 && totalNumberOfColumns > 0)) {
                this.addColumns(numberOfColumnsToAdd, this.currentSection);
            }
            else if (numberOfColumnsToAdd < 0 && (totalNumberOfColumns <= 10 && totalNumberOfColumns > 0)) {
                var index = 0;
                while (numberOfColumnsToAdd < 0) {
                    var oldParent = dataContainers.item(dataContainers.length - index - 1);
                    var newParent = dataContainers.item(dataContainers.length - index - 2);
                    while (oldParent.hasChildNodes()) {
                        newParent.appendChild(oldParent.firstChild);
                    }
                    index++;
                    // remove() is not supported by IE11.
                    oldParent.parentNode.removeChild(oldParent);
                    numberOfColumnsToAdd++;
                }
                dataContainers.item(0);
            }
            this.setColumnStyles(this.currentSection, requestedLayoutType);
            this.setColumnsWidths(this.currentSection, requestedLayoutType);
            this.eventBroker.notify(Editor.EventConstants.sectionAdded, new Editor.SectionModificationEventArgs($(this.currentSection), Editor.EventConstants.detailsViewOrigin));
            this.currentSectionType = requestedLayoutType;
        };
        SectionDetailsView.prototype.setStyleForContainer = function (containers, styles) {
            for (var i = 0; i < containers.length; i++) {
                var container = containers.item(i);
                if (!container.classList.contains(Editor.LayoutStyles.emptyContainerCssClass)) {
                    container.classList.add(Editor.LayoutStyles.emptyContainerCssClass);
                }
                var bgImg = $(container).css("background-image");
                var bgSize = $(container).css("background-size");
                var bgPosition = $(container).css("background-position");
                container.setAttribute("style", styles[i]);
                if (bgImg && bgImg !== "none") {
                    $(container).css("background-image", bgImg);
                    $(container).css("background-repeat", "no-repeat");
                    $(container).css("background-size", bgSize);
                    $(container).css("background-position", bgPosition);
                }
            }
        };
        SectionDetailsView.prototype.getCurrentSection = function (section) {
            if (this.currentSection.getAttribute(Editor.Contract.dataCustomSectionAttrName) === "true") {
                return Editor.DetailsViewConstants.customColumnOptionValue;
            }
            var dataContainers = section.querySelectorAll("[data-container=\"true\"]");
            switch (dataContainers.length) {
                case 1:
                    return Editor.DetailsViewConstants.oneColumnOptionValue;
                case 2:
                    var firstColumnWidth = dataContainers.item(0).getAttribute(Editor.Contract.dataContainerWidth);
                    var secondColumnWidth = dataContainers.item(1).getAttribute(Editor.Contract.dataContainerWidth);
                    if (firstColumnWidth === "50" && secondColumnWidth === "50") {
                        return Editor.DetailsViewConstants.twoColumnOptionValue;
                    }
                    else if (firstColumnWidth === "67" && secondColumnWidth === "33") {
                        return Editor.DetailsViewConstants.twoOneColumnOptionValue;
                    }
                    else if (firstColumnWidth === "33" && secondColumnWidth === "67") {
                        return Editor.DetailsViewConstants.oneTwoColumnOptionValue;
                    }
                    break;
                case 3:
                    return Editor.DetailsViewConstants.threeColumnOptionValue;
                default:
                    return Editor.DetailsViewConstants.oneColumnOptionValue;
            }
            return Editor.DetailsViewConstants.oneColumnOptionValue;
        };
        SectionDetailsView.prototype.addColumns = function (numberOfColumns, section) {
            for (var i = 0; i < numberOfColumns; i++) {
                var column = document.createElement("div");
                column.setAttribute(Editor.Contract.containerAttrName, "true");
                column.classList.add(Editor.Contract.containerCssClass);
                var lastChild = section.firstElementChild.lastElementChild;
                // we need to insert our column before the last div - last one is <div style="clear:both" />
                section.firstElementChild.removeChild(lastChild);
                section.firstElementChild.appendChild(column);
                section.firstElementChild.appendChild(lastChild);
            }
        };
        SectionDetailsView.prototype.setColumnStyles = function (section, requestedLayoutType) {
            var dataContainers = section.querySelectorAll("[data-container=\"true\"]");
            var isResponsiveDesign = this.fcbList && this.fcbList.isResponsiveDesign;
            switch (requestedLayoutType) {
                case Editor.DetailsViewConstants.oneColumnOptionValue:
                    this.setStyleForContainer(dataContainers, [Editor.LayoutStyles.getDefaultContainer(isResponsiveDesign)]);
                    break;
                case Editor.DetailsViewConstants.twoColumnOptionValue:
                    this.setStyleForContainer(dataContainers, [
                        Editor.LayoutStyles.getOneHalfOfSectionContainer(isResponsiveDesign),
                        Editor.LayoutStyles.getOneHalfOfSectionContainer(isResponsiveDesign)
                    ]);
                    break;
                case Editor.DetailsViewConstants.oneTwoColumnOptionValue:
                    this.setStyleForContainer(dataContainers, [Editor.LayoutStyles.getSmallContainer(isResponsiveDesign), Editor.LayoutStyles.getBigContainer(isResponsiveDesign)]);
                    break;
                case Editor.DetailsViewConstants.twoOneColumnOptionValue:
                    this.setStyleForContainer(dataContainers, [Editor.LayoutStyles.getBigContainer(isResponsiveDesign), Editor.LayoutStyles.getSmallContainer(isResponsiveDesign)]);
                    break;
                case Editor.DetailsViewConstants.threeColumnOptionValue:
                    this.setStyleForContainer(dataContainers, [
                        Editor.LayoutStyles.getOneThirdOfSectionContainer(isResponsiveDesign),
                        Editor.LayoutStyles.getOneThirdOfSectionContainer(isResponsiveDesign),
                        Editor.LayoutStyles.getOneThirdOfSectionContainer(isResponsiveDesign)
                    ]);
                    break;
                case Editor.DetailsViewConstants.customColumnOptionValue:
                    var style_1 = Editor.LayoutStyles.getColumnStyleBase(isResponsiveDesign).replace("{{percentage}}", (100 / dataContainers.length).toFixed(2));
                    this.setStyleForContainer(dataContainers, __spreadArrays(new Array(dataContainers.length)).map(function () { return style_1; }));
                    break;
                default:
                    break;
            }
        };
        SectionDetailsView.prototype.setColumnsWidths = function (section, layoutType) {
            var dataContainers = section.querySelectorAll("[data-container=\"true\"]");
            switch (layoutType) {
                case Editor.DetailsViewConstants.oneColumnOptionValue:
                    dataContainers.item(0).setAttribute(Editor.Contract.dataContainerWidth, "100");
                    break;
                case Editor.DetailsViewConstants.twoColumnOptionValue:
                    dataContainers.item(0).setAttribute(Editor.Contract.dataContainerWidth, "50");
                    dataContainers.item(1).setAttribute(Editor.Contract.dataContainerWidth, "50");
                    break;
                case Editor.DetailsViewConstants.oneTwoColumnOptionValue:
                    dataContainers.item(0).setAttribute(Editor.Contract.dataContainerWidth, "33");
                    dataContainers.item(1).setAttribute(Editor.Contract.dataContainerWidth, "67");
                    break;
                case Editor.DetailsViewConstants.twoOneColumnOptionValue:
                    dataContainers.item(0).setAttribute(Editor.Contract.dataContainerWidth, "67");
                    dataContainers.item(1).setAttribute(Editor.Contract.dataContainerWidth, "33");
                    break;
                case Editor.DetailsViewConstants.threeColumnOptionValue:
                    dataContainers.item(0).setAttribute(Editor.Contract.dataContainerWidth, "33");
                    dataContainers.item(1).setAttribute(Editor.Contract.dataContainerWidth, "34");
                    dataContainers.item(2).setAttribute(Editor.Contract.dataContainerWidth, "33");
                    break;
                case Editor.DetailsViewConstants.customColumnOptionValue:
                    var width = (100 / dataContainers.length).toFixed(2);
                    for (var i = 0; i < dataContainers.length; i++) {
                        dataContainers[i].setAttribute(Editor.Contract.dataContainerWidth, width);
                    }
                default:
                    break;
            }
        };
        SectionDetailsView.prototype.getNumbersOfColumnsToAdd = function (currentLayout, requestedLayout) {
            if (currentLayout === requestedLayout ||
                currentLayout !== "CustomColumn" && requestedLayout === "CustomColumn") {
                return 0;
            }
            var currentColumns = this.currentSection.querySelectorAll("[data-container=\"true\"]").length;
            switch (requestedLayout) {
                case Editor.DetailsViewConstants.oneColumnOptionValue:
                    return 1 - currentColumns;
                case Editor.DetailsViewConstants.twoColumnOptionValue:
                case Editor.DetailsViewConstants.twoOneColumnOptionValue:
                case Editor.DetailsViewConstants.oneTwoColumnOptionValue:
                    return 2 - currentColumns;
                case Editor.DetailsViewConstants.threeColumnOptionValue:
                    return 3 - currentColumns;
            }
        };
        SectionDetailsView.prototype.clearContainer = function () {
            Editor.CommonUtils.getById(this.containerId).empty();
        };
        SectionDetailsView.prototype.updateColumnCount = function (currentNumberOfColumns, change) {
            var expectedNumber = currentNumberOfColumns + change;
            var inputValue = parseInt(this.columnCountInput.val());
            if (inputValue !== expectedNumber) {
                this.columnCountInput.val(expectedNumber);
            }
        };
        return SectionDetailsView;
    }());
    Editor.SectionDetailsView = SectionDetailsView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var RangeRenderer = /** @class */ (function () {
        function RangeRenderer() {
        }
        RangeRenderer.prototype.render = function (label, className, min, max, value, attributes, onFieldUpdated, ariaLabelKey) {
            var rangeContainer = $("<div>", { class: Editor.DetailsViewConstants.rangeControlContainerClassName });
            if (label) {
                this.renderRangeLabel(rangeContainer, label);
            }
            this.renderRangeField(rangeContainer, className, min, max, value, attributes, label, ariaLabelKey, attributes["id"]);
            if (!Utility.isNullOrUndefined(onFieldUpdated)) {
                this.setHandlerOnRangeUpdate(rangeContainer, onFieldUpdated, attributes["id"]);
            }
            return rangeContainer;
        };
        RangeRenderer.prototype.changeRange = function (range, min, max) {
            var input = range.find("input");
            var currentVal = input.val();
            input.attr("min", min);
            input.attr("max", max);
            if (currentVal > max) {
                range.find("." + Editor.DetailsViewConstants.rangeItemValueField)[0].innerHTML = max.toString();
            }
            else {
                range.find("." + Editor.DetailsViewConstants.rangeItemValueField)[0].innerHTML = currentVal;
            }
        };
        RangeRenderer.prototype.renderRangeLabel = function (rangeContainer, label) {
            var $label = $("<label>", {
                class: Editor.DetailsViewConstants.rangeItemField +
                    " " +
                    Editor.DetailsViewConstants.propertyNameCssClass +
                    " " +
                    Editor.DetailsViewConstants.inputItemField
            }).text(label);
            rangeContainer.append($label);
        };
        RangeRenderer.prototype.renderRangeField = function (rangeContainer, className, min, max, value, attributes, label, ariaLabelKey, id) {
            var newVal = value || "0";
            var rangeInput = $("<input type=\"range\" min=\"" + min + "\" max=\"" + max + "\">");
            rangeInput.attr(attributes);
            rangeInput.addClass(Editor.DetailsViewConstants.attributeRangeClassName + " " + className);
            rangeInput.val(value);
            if (ariaLabelKey) {
                rangeInput.attr("aria-label", label + ". " + Editor.CommonUtils.getLocalizedString(ariaLabelKey));
            }
            else {
                rangeInput.attr("aria-label", "" + label);
            }
            var rangeElementContainer = $("<div>", { class: Editor.DetailsViewConstants.rangeItemField });
            rangeElementContainer.append(rangeInput);
            rangeInput.val("" + newVal);
            var valueDiv = $("<div id=\"" + id + "ValueField\" class=\"" + Editor.DetailsViewConstants.rangeItemValueField + "\">" + newVal + "</div>");
            rangeElementContainer.append(valueDiv);
            rangeContainer.append(rangeElementContainer);
        };
        RangeRenderer.prototype.setHandlerOnRangeUpdate = function (rangeInputField, onFieldUpdated, id) {
            var rangeElement = rangeInputField.find(Editor.DetailsViewConstants.inputTag).first();
            var initialRangeValue = rangeElement.val();
            var lastUIChange = Date.now();
            // First handler used for propagating new value further.
            // Second handler only for UI updates.
            // We use timestamp so in case of few clicks of the range input we will not be propagating all of them, but rather the latest one from 499ms window.
            var handlerRangeUpdate = function () {
                if (Date.now() - lastUIChange > 499) {
                    var rangeElem = rangeInputField.find(Editor.DetailsViewConstants.inputTag).first();
                    onFieldUpdated(rangeElem);
                }
            };
            rangeElement.on("focusout", function () {
                handlerRangeUpdate();
            });
            var valueUpdateHandler = function () {
                var rangeElem = rangeInputField.find(Editor.DetailsViewConstants.inputTag).first();
                var currentRangeElemVal = rangeElem.val();
                if (initialRangeValue !== currentRangeElemVal) {
                    $("#" + id + "ValueField").text(currentRangeElemVal);
                    initialRangeValue = currentRangeElemVal;
                    lastUIChange = Date.now();
                    setTimeout(function () {
                        handlerRangeUpdate();
                    }, 500);
                }
            };
            rangeElement.on("change", function () {
                valueUpdateHandler();
            });
        };
        return RangeRenderer;
    }());
    Editor.RangeRenderer = RangeRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var TextAreaRenderer = /** @class */ (function () {
        function TextAreaRenderer() {
        }
        TextAreaRenderer.prototype.render = function (label, className, rows, cols, value, attributes, onFieldUpdated, ariaLabelKey) {
            var textareaContainer = $("<div>", { class: Editor.DetailsViewConstants.textareaControlContainerClassName });
            if (label) {
                this.renderTextAreaLabel(textareaContainer, label, attributes["id"]);
            }
            this.renderTextAreaField(textareaContainer, className, rows, cols, value, attributes, label, ariaLabelKey);
            if (!Utility.isNullOrUndefined(onFieldUpdated)) {
                this.setHandlerOnTextAreaUpdate(textareaContainer, onFieldUpdated);
            }
            return textareaContainer;
        };
        TextAreaRenderer.prototype.renderTextAreaLabel = function (textareaContainer, label, textareaId) {
            var $label = $("<label>", {
                class: Editor.DetailsViewConstants.textareaItemField + " " + Editor.DetailsViewConstants.propertyNameCssClass
            }).text(label);
            textareaContainer.append($label);
        };
        TextAreaRenderer.prototype.renderTextAreaField = function (textareaContainer, className, rows, cols, value, attributes, label, ariaLabelKey) {
            var $textarea = $("<textarea rows=\"" + rows + "\" cols=\"" + cols + "\" />");
            $textarea.attr(attributes);
            $textarea.addClass(Editor.DetailsViewConstants.attributeTextAreaClassName + " " + className);
            $textarea.val(value);
            if (ariaLabelKey) {
                $textarea.attr("aria-label", label + ". " + Editor.CommonUtils.getLocalizedString(ariaLabelKey));
            }
            else {
                $textarea.attr("aria-label", "" + label);
            }
            var textareaElementContainer = $("<div>", { class: Editor.DetailsViewConstants.textareaItemField });
            textareaElementContainer.append($textarea);
            textareaContainer.append(textareaElementContainer);
        };
        TextAreaRenderer.prototype.setHandlerOnTextAreaUpdate = function (textareaField, onFieldUpdated) {
            var textareaElement = textareaField.find(Editor.DetailsViewConstants.textareaTag).first();
            var initialTextAreaValue = textareaElement.val();
            var handlerTextAreaUpdate = function () {
                var textareaElem = textareaField.find(Editor.DetailsViewConstants.textareaTag).first();
                var currentTextAreaElemVal = textareaElem.val();
                if (initialTextAreaValue !== currentTextAreaElemVal) {
                    initialTextAreaValue = currentTextAreaElemVal;
                    onFieldUpdated(textareaElem);
                }
            };
            textareaElement.on("focusout", function () {
                handlerTextAreaUpdate();
            });
            textareaElement.on("remove", function () {
                handlerTextAreaUpdate();
            });
        };
        return TextAreaRenderer;
    }());
    Editor.TextAreaRenderer = TextAreaRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SubsectionRenderer = /** @class */ (function () {
        function SubsectionRenderer() {
        }
        /**
         * @see ISubsectionRenderer.render
         */
        SubsectionRenderer.prototype.render = function (section, className, id, label) {
            var subsection = $("<div>", { id: id, class: className + " " + Editor.DetailsViewConstants.subsectionClassName });
            if (!!label) {
                var subsectionHeader = $("<span>", {
                    id: MktSvc.Controls.Common.UniqueId.generate(),
                    class: Editor.DetailsViewConstants.subsectionHeaderCssClass
                }).text(label);
                subsection.append(subsectionHeader);
            }
            section.find("." + Editor.DetailsViewConstants.sectionContentClassName + ":first").append(subsection);
            subsection.append($("<div>", { class: Editor.DetailsViewConstants.sectionContentClassName + " " + Editor.DetailsViewConstants.subsectionContentClassName }));
            return subsection;
        };
        return SubsectionRenderer;
    }());
    Editor.SubsectionRenderer = SubsectionRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var MonacoEditorCreatedEventArgs = /** @class */ (function (_super) {
        __extends(MonacoEditorCreatedEventArgs, _super);
        function MonacoEditorCreatedEventArgs(editor) {
            var _this = _super.call(this) || this;
            _this.editor = editor;
            return _this;
        }
        return MonacoEditorCreatedEventArgs;
    }(Editor.EventArgs));
    Editor.MonacoEditorCreatedEventArgs = MonacoEditorCreatedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var HtmlContentEditorInternalEventConstants = /** @class */ (function () {
        function HtmlContentEditorInternalEventConstants() {
        }
        HtmlContentEditorInternalEventConstants.monacoEditorCreated = "htmlContentEditor.monacoEditorCreated";
        HtmlContentEditorInternalEventConstants.monacoEditorValueSet = "monacoEditorValueUpdated";
        return HtmlContentEditorInternalEventConstants;
    }());
    Editor.HtmlContentEditorInternalEventConstants = HtmlContentEditorInternalEventConstants;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var BrowserPreviewConstants = /** @class */ (function () {
        function BrowserPreviewConstants() {
        }
        BrowserPreviewConstants.desktopTitle = "[Desktop]";
        BrowserPreviewConstants.tabletTitle = "[Tablet]";
        BrowserPreviewConstants.mobileTitle = "[Mobile]";
        BrowserPreviewConstants.desktopPreviewCssClass = "desktopPreview";
        BrowserPreviewConstants.tabletPortraitPreviewCssClass = "tabletPortraitPreview";
        BrowserPreviewConstants.tabletLandscapePreviewCssClass = "tabletLandscapePreview";
        BrowserPreviewConstants.mobilePortraitPreviewCssClass = "mobilePortraitPreview";
        BrowserPreviewConstants.mobileLandscapePreviewCssClass = "mobileLandscapePreview";
        BrowserPreviewConstants.desktopPreviewIconCssClass = "desktopPreviewIcon";
        BrowserPreviewConstants.desktopPreviewId = "desktopPreviewId";
        BrowserPreviewConstants.tabletPortraitPreviewIconCssClass = "tabletPortraitPreviewIcon";
        BrowserPreviewConstants.tabletPortraitPreviewId = "tabletPortraitPreviewId";
        BrowserPreviewConstants.tabletLandscapePreviewIconCssClass = "tabletLandscapePreviewIcon";
        BrowserPreviewConstants.tabletLandscapePreviewId = "tabletLandscapePreviewId";
        BrowserPreviewConstants.mobilePortraitPreviewIconCssClass = "mobilePortraitPreviewIcon";
        BrowserPreviewConstants.mobilePortraitPreviewId = "mobilePortraitPreviewId";
        BrowserPreviewConstants.mobileLandscapePreviewIconCssClass = "mobileLandscapePreviewIcon";
        BrowserPreviewConstants.mobileLandscapePreviewId = "mobileLandscapePreviewId";
        BrowserPreviewConstants.desktopPreviewIconAltText = "[Desktop Preview]";
        BrowserPreviewConstants.tabletPortraitPreviewIconAltText = "[Tablet Portrait Preview]";
        BrowserPreviewConstants.tabletLandscapePreviewIconAltText = "[Tablet Landscape Preview]";
        BrowserPreviewConstants.mobilePortraitPreviewIconAltText = "[Mobile Portrait Preview]";
        BrowserPreviewConstants.mobileLandscapePreviewIconAltText = "[Mobile Landscape Preview]";
        BrowserPreviewConstants.desktopPreviewIconTitle = "[Desktop Preview]";
        BrowserPreviewConstants.tabletPortraitPreviewIconTitle = "[Tablet Portrait Preview]";
        BrowserPreviewConstants.tabletLandscapePreviewIconTitle = "[Tablet Landscape Preview]";
        BrowserPreviewConstants.mobilePortraitPreviewIconTitle = "[Mobile Portrait Preview]";
        BrowserPreviewConstants.mobileLandscapePreviewIconTitle = "[Mobile Landscape Preview]";
        BrowserPreviewConstants.browserPreviewContentTitle = "[User or external content rendered below]";
        BrowserPreviewConstants.browserPreviewLinkWarning = "[External links below]";
        BrowserPreviewConstants.browserPreviewSubjectLabelText = "Subject";
        BrowserPreviewConstants.browserPreviewIframeTitle = "Browser Preview Iframe";
        BrowserPreviewConstants.browserPreviewContentTitleCssClass = "browserPreviewContentTitle";
        BrowserPreviewConstants.browserPreviewContentTitleWarningCssClass = "browserPreviewContentTitleWarning";
        BrowserPreviewConstants.browserPreviewContentInfoIconCssClass = "browserPreviewContentInfoIcon";
        BrowserPreviewConstants.browserPreviewHeaderContrainerCssClass = "browserPreviewHeaderContrainer";
        BrowserPreviewConstants.browserPreviewContentCssClass = "browserPreviewContent";
        BrowserPreviewConstants.browserPreviewContentSubjectContainerCssClass = "browserPreviewContentSubjectContainer";
        BrowserPreviewConstants.browserPreviewContentSubjectContentCssClass = "browserPreviewContentSubjectContent";
        BrowserPreviewConstants.browserPreviewContentSubjectLabelCssClass = "browserPreviewContentSubjectLabel";
        BrowserPreviewConstants.desktopTitleCssClass = "desktopTitle";
        BrowserPreviewConstants.tabletTitleCssClass = "tabletTitle";
        BrowserPreviewConstants.mobileTitleCssClass = "mobileTitle";
        BrowserPreviewConstants.activeCssClass = "active";
        BrowserPreviewConstants.browserPreviewFrameClassName = "browserPreviewFrame";
        BrowserPreviewConstants.browserPreviewFrameContainerCssClass = "browserPreviewFrameContainer";
        BrowserPreviewConstants.browserPreviewFrameBorderClassName = "browserPreviewFrameBorder";
        BrowserPreviewConstants.editorMode = "editorMode";
        BrowserPreviewConstants.lightweightMode = "lightweightMode";
        BrowserPreviewConstants.headerCssClass = "browserPreviewHeader";
        BrowserPreviewConstants.headerIconButtonsContainerCssClass = "browserPreviewHeaderIconButtonsGroup";
        BrowserPreviewConstants.headerIconCssClass = "browserPreviewIcon";
        BrowserPreviewConstants.headerTitleCssClass = "browserPreviewTitle";
        BrowserPreviewConstants.headerDividerCssClass = "browserPreviewDivider";
        BrowserPreviewConstants.previewButtonContainerCssClass = "previewButtonContainer";
        BrowserPreviewConstants.desktopIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADUAAAAkCAYAAAApbHJOAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNy8wOS8xNLgEYzwAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzbovLKMAAACI0lEQVRYhe3Zv2sUQRQH8M+ciQR/IGpvZyFopYWCYpqAdRCrFBamsLCSiJVdChvRwkZL7bRKY5FKK8kfkEIQBAsVBBWSkHgxYzG73N7dnh65S+4W9guP2dl5N/P97sy8g/dCjFEnQghwCcs4jCZCl+P+I2ISm7iGt2X8Gz1+fAS3JEEx8wtjYA3sYAq3cbSM/EQPUQ2cyJ4/YiWbaJS7FbGB8ziDkzhQ5thLFGxn7VKM8e5Q6Q2AEMKiJKop7VoXeh2/4tjUkHkNismsza9EF/4lKsc4BIgi/su5H1GVQy2qKqhFVQW1qKqgFlUV1KKqglpUVVCLqgpqUVVBLaoq6CUqamVqfu0Tl37xM2tLM0n0TpFtYT17vhhCmDceeb9NXMn661m/xDPGLsMpfM4milIOcGcMbLvA6QtOl/EPnbnoEMIU3mA6e/VOOqaTRo8m/uBq1n+PmRjjWtGpTNQLzElfYwEv86G9ZNsncrKzeCpxehVjvNHu1X7sFrXSuQ9xsGx7R21SLHgg7do2HreNFxznpAT8bzwbNfE+xT2Rgtom5tvuVAhhGktSaaSJVXyXSjm7OSINHMPzGOOjTocQwn3cxI9dzJ9jA8dxVrrva5iNMS7DDD5oRZU8ygwaqSK+4h7O4ULWLuBbYa1Bo2G+VsQnXIfX0tmMe2A7Wv95uW11EBn2eisTUkUu4nK26LCiXNSq/uVll+Lu5OPDWuuQVBy88xeWMBjDkBnq5QAAAABJRU5ErkJggg==";
        BrowserPreviewConstants.tabletPortraitIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAfCAYAAAASsGZ+AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNy8wOS8xNLgEYzwAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzbovLKMAAABDUlEQVRIie3WO0sDQRQF4G+SID4qSSfpbFL5jy3FH6CNraBolZSCtmJhZ6XkMRaZXceQwK5ZlCweuMzu2bn3zLkDy4U+7hAxaTAiRhjARUY2HVOMAp5xhDeMLRD8HIXACQ4L8jGR1xBj3KD+Ij/VuEp1Jz1fp+4WApsKJXTSGjoZGUL49t6UiCaLLqNsx9aLlNh6kf921UJ72vUrTso/+dY7ac/Ft0fk7+5kFmOcN1h7Wjz0MnIvhDC0sLnOYUAXM1k7ljBPcZAnPeE4ffhI3Kq5K2IX79m6bl/ETnagcu6qEucY4rRGzqSD/TW2V+E2xviAmxo5PbhUfRZ+xRleKu6fSqNvH/c17NeJMQafukOvoGFlOPUAAAAASUVORK5CYII=";
        BrowserPreviewConstants.tabletLandscapeIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB8AAAAZCAYAAADJ9/UkAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNy8wOS8xNLgEYzwAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzbovLKMAAABCklEQVRIie3WO04DMRSF4e8mFDxKamjYABIboGMJlBQshA2wBrITJBoQNKBsghIJiYfIJKYYCyaTQRRMXKBc6WjG9tX8tuW5PrCDeyRUmC5RVeaMsQsPjc5SqjCO3IAn3GGQlRpjfnhPiI7cZk6FLRxi2MoxyYlXkFLqXdjDS3sHBo1JRNYyYtj17TZ8WTH4DV48VvB/D0+tZzF4YAMXOMVjSfgQ7zhPKY1wCWuF4FOs4ywirnFUEp7whuMslD1wqwq3gs+d9q/KE9Hf7ZrNxMyi01n41SKDe9uRiJj5tmXzY43OZ7Wr7HQdf4ipurTu61jUDT6Uda8T3Aa2McIBXntedTsSNtV2/eQTkdzLYNJlu7AAAAAASUVORK5CYII=";
        BrowserPreviewConstants.mobilePortraitIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAZCAYAAADuWXTMAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNy8wOS8xNLgEYzwAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzbovLKMAAAA7ElEQVQ4je3UPUoEQRAF4K/Hdf030dBQT6AH8k7G3mAjT2CyiCsihouGpoKIoMz+tMH2QDPMjJMKW1DQVfXe66KhH5zgCRGzHhlxhyN4xjw1++YMNyEV8IFHhJT1WKLAOQ7xJlO7jTHqyhSThJ8WmfKg4bZ6FNhI55CTm1atxyDHFR3AXmusyWvyPyDP/wLHGEssqjr/hjshhLNMNKR55TILbGKrIuROskSZiW3jC/v4SbiAYRJ/od2nrnCK65b5tOvBxjHGV9y3zPfgQbN7vmNkZYz1WYlRwHFa7QLf2TsMcYBPK6ut+rsY4/IXtTt0+9qSD30AAAAASUVORK5CYII=";
        BrowserPreviewConstants.mobileLandscapeIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAPCAYAAAARZmTlAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABZ0RVh0Q3JlYXRpb24gVGltZQAwNy8wOS8xNLgEYzwAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzbovLKMAAAA90lEQVQ4jbXUPU4DMRAF4G9CUBRBCR0tUEAFN+AgtLSciAsgCk4ABUWQEKKkoaeMQKLJElOso7XCNuwuT5pixj/P73nswA6ucIIvhP5I2MIjzmGGRR4YOha4iZzAB16x0VHNNyY4xqiovytU3KWUZILNv0Zee6i2vFTzNi4YlxERqZ696KAEKo0zK0Qpa6Q/SqtXZGmIjUsEpupuvcBcbWdzJ4iUkq6BI3xiP+fXmI9/naUfKmzjMiIecJZJB1VyoKW7yjtZ74ouWLbUorSrfiQRfb6VtrVpjBXRKe5z3oWoUnfWZK0+hWfNIxo6KtzCHl7+ieQJuz95n93WFSrOpgAAAABJRU5ErkJggg==";
        BrowserPreviewConstants.ariaSelected = "Selected.";
        BrowserPreviewConstants.ariaNotSelected = "Not selected.";
        BrowserPreviewConstants.ariaOptionToActivate = "Press enter or space to activate.";
        return BrowserPreviewConstants;
    }());
    Editor.BrowserPreviewConstants = BrowserPreviewConstants;
})(Editor || (Editor = {}));
/// <reference path="../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Additional Fonts Styles View Property contract
     */
    var AdditionalFontsContract = /** @class */ (function () {
        function AdditionalFontsContract() {
        }
        AdditionalFontsContract.entryName = "additional-fonts";
        AdditionalFontsContract.entryDataType = Editor.Contract.styleMetadataFontDataType;
        return AdditionalFontsContract;
    }());
    Editor.AdditionalFontsContract = AdditionalFontsContract;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ArrayQuery = MktSvc.Controls.Common.ArrayQuery;
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    /**
     * Provides the array of the CKEditor-compatible strings which contain font specifications taken from the HTML content inside iframe
     */
    var AdditionalFontsProvider = /** @class */ (function () {
        function AdditionalFontsProvider(executionContext) {
            this.executionContext = executionContext;
        }
        AdditionalFontsProvider.prototype.getAdditionalFontsString = function (metaEntries) {
            var _this = this;
            var fonts = new ArrayQuery([]);
            this.executionContext.tryExecute(function () {
                fonts = new ArrayQuery(metaEntries)
                    .where(function (entry) {
                    return entry.name === Editor.AdditionalFontsContract.entryName &&
                        entry.dataType.toLowerCase() === Editor.AdditionalFontsContract.entryDataType.toLowerCase() &&
                        !Utility.isNullOrUndefined(entry.value);
                })
                    .select(function (entry) { return _this.sanitizeUserFontDataString(entry.value); })
                    .where(function (fontSpecString) { return !String.isNullOrWhitespace(fontSpecString); });
            }, "Get additional fonts");
            return fonts;
        };
        /**
         * Extracts and sanitizes editor font specifications from the string
         */
        AdditionalFontsProvider.prototype.sanitizeUserFontDataString = function (fontData) {
            var _this = this;
            return fontData
                .split(";") // splitting the font data string into the separate font declarations.
                .map(function (fontSpecAsString) {
                var separatedDisplayNameAndFontList = fontSpecAsString
                    .split("/")
                    .map(function (s) { return s.trim(); })
                    .filter(function (s) { return s !== ""; });
                var displayName;
                var fontsList;
                switch (separatedDisplayNameAndFontList.length) {
                    case 0:
                        // Font specification contains no meaningful symbols, skipping
                        return null;
                    case 1:
                        // display name is not specified
                        fontsList = _this.getFilteredFontNamesList(separatedDisplayNameAndFontList[0]);
                        displayName = null;
                        break;
                    case 2: // tslint:disable-line
                        // display name is specified
                        displayName = separatedDisplayNameAndFontList[0];
                        fontsList = _this.getFilteredFontNamesList(separatedDisplayNameAndFontList[1]);
                        break;
                    default:
                        // Multiple /-es between meaningful symbols are invalid, skipping
                        return null;
                }
                if (fontsList.length > 0) {
                    var fontsListString = fontsList.join(", ");
                    if (Utility.isNullOrUndefined(displayName)) {
                        // If display name was not specifies, then the whole font list should be used as display name (to be consistent with CKEditor)
                        displayName = fontsListString;
                    }
                    return displayName + "/" + fontsListString;
                }
                else {
                    // Fonts list is empty or contains only commas, skipping
                    return null;
                }
            })
                .filter(function (sanitizedFontSpecAsString) { return !Utility.isNullOrUndefined(sanitizedFontSpecAsString); })
                .join(";")
                .trim();
        };
        /**
         * Parses the string with comma-separated list of font names (primary font and fallback fonts) and returns them as array.
         */
        AdditionalFontsProvider.prototype.getFilteredFontNamesList = function (fontListAsString) {
            return fontListAsString
                .split(",")
                .map(function (fontName) { return fontName.trim(); })
                .filter(function (fontName) { return fontName !== ""; });
        };
        return AdditionalFontsProvider;
    }());
    Editor.AdditionalFontsProvider = AdditionalFontsProvider;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="CommonReferences.ts" />
var Editor;
(function (Editor) {
    var FrontEndDependenciesLoader = /** @class */ (function () {
        function FrontEndDependenciesLoader(executionContext) {
            this.executionContext = executionContext;
            this.loadedScripts = { "": null };
            this.loadedStyles = { "": null };
            this.fileExtensionPattern = /\.([0-9a-z]+)(?:[\?#]|$)/i;
        }
        FrontEndDependenciesLoader.prototype.loadScript = function (dependencyId, libPath, done) {
            if (this.loadedScripts[dependencyId] === null || this.loadedScripts[dependencyId] === undefined) {
                this.loadedScripts[dependencyId] = Editor.CommonUtils.createScriptElementFromUrl(dependencyId, "" + this.executionContext.getLibsPath() + libPath, document);
                this.loadedScripts[dependencyId].onload = function () {
                    if (done) {
                        done();
                    }
                };
                if (this.loadedScripts[dependencyId]) {
                    document.head.appendChild(this.loadedScripts[dependencyId]);
                }
            }
        };
        FrontEndDependenciesLoader.prototype.loadFile = function (dependencyId, fullPath) {
            var _this = this;
            return new Promise(function (resolve, reject) {
                if (_this.loadedStyles[dependencyId] === null || _this.loadedStyles[dependencyId] === undefined) {
                    var extension = dependencyId.match(_this.fileExtensionPattern);
                    if (extension && extension.length > 0) {
                        if (extension[0] === ".css") {
                            _this.loadedStyles[dependencyId] = Editor.CommonUtils.createLinkElementFromUrl(dependencyId, fullPath, document);
                        }
                        else if (extension[0] === ".js") {
                            _this.loadedStyles[dependencyId] = Editor.CommonUtils.createScriptElementFromUrl(dependencyId, fullPath, document);
                        }
                    }
                    _this.loadedStyles[dependencyId].onload = function () {
                        resolve();
                    };
                    if (_this.loadedStyles[dependencyId]) {
                        document.head.appendChild(_this.loadedStyles[dependencyId]);
                    }
                }
            });
        };
        return FrontEndDependenciesLoader;
    }());
    Editor.FrontEndDependenciesLoader = FrontEndDependenciesLoader;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ArrayQuery = MktSvc.Controls.Common.ArrayQuery;
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var MetadataParser = /** @class */ (function () {
        function MetadataParser(executionContext) {
            this.executionContext = executionContext;
        }
        MetadataParser.prototype.getValue = function (name, document) {
            var _this = this;
            var value = null;
            this.executionContext.tryExecute(function () {
                var metaEntries = new ArrayQuery(_this.getStyleMetaEntries(document));
                var metaEntry = metaEntries.firstOrDefault(function (item) {
                    return item.name === name;
                });
                if (!Utility.isNullOrUndefined(metaEntry) && !String.isNullOrEmpty(metaEntry.value)) {
                    value = metaEntry.value;
                }
            }, "Get metadata value");
            return value;
        };
        MetadataParser.prototype.getStyleMetaEntries = function (document) {
            var _this = this;
            var metaStyles = [];
            Editor.CommonUtils.getBySelector("meta[type=\"" + Editor.Contract.styleMetadataTypeAttr + "\"]", $(document).contents()).each(function (index, meta) {
                var variableName = $(meta).attr(Editor.Contract.metadataNameAttr);
                var variableValue = $(meta).attr(Editor.Contract.metadataValueAttr);
                var variableType = $(meta).attr(Editor.Contract.metadataDatatypeAttr);
                var variableLabel = $(meta).attr(Editor.Contract.metadataLabelAttr);
                var variableFormat = $(meta).attr(Editor.Contract.metadataFormatAttr);
                var variableGroup = $(meta).attr(Editor.Contract.metadataGroupAttr);
                metaStyles.push(new Editor.MetaStyle(variableValue, variableName, variableLabel, variableType, _this.isReferencedInDocument($(document), variableName, variableFormat), variableFormat, variableGroup));
            });
            return metaStyles;
        };
        MetadataParser.prototype.upsertMetaEntry = function (document, metaName, metaValue) {
            var existingMetaTags = Editor.CommonUtils.getBySelector("meta[name=\"" + metaName + "\"]", $(document).contents());
            if (existingMetaTags.length > 0) {
                return;
            }
            $("<meta type=\"xrm/designer/setting\" name=\"" + metaName + "\" value=\"" + metaValue + "\">").appendTo($(document).find("head"));
        };
        MetadataParser.prototype.deleteMetaEntry = function (document, metaName) {
            Editor.CommonUtils.getBySelector("meta[name=\"" + metaName + "\"]", $(document).contents()).each(function (index, el) { return $(el).remove(); });
        };
        MetadataParser.prototype.updateStyleMetaValue = function (contentDocument, metaStyle, newValue) {
            var _this = this;
            this.executionContext.tryExecute(function () {
                metaStyle.value = newValue;
                var $document = $(contentDocument);
                Editor.CommonUtils.getBySelector("meta[name=\"" + metaStyle.name + "\"]", $document.contents()).attr("value", newValue);
                // regex for: /* @VariableName */ variable value /* @VariableName */
                // for example: /* @outer-background-color */ red /* @outer-background-color */
                var formattedValue = Utility.isNullOrUndefined(metaStyle.format) || String.isNullOrWhitespace(metaStyle.format)
                    ? newValue
                    : String.Format(metaStyle.format, newValue);
                var newStyle = "/* @" + metaStyle.name + " */ " + formattedValue + " /* @" + metaStyle.name + " */";
                $document
                    .contents()
                    .find("style")
                    .contents()
                    .each(function (index, domElem) {
                    if (domElem && domElem.textContent) {
                        domElem.textContent = String.Replace(domElem.textContent, _this.getMatchExpression(metaStyle.name), newStyle);
                    }
                });
                _this.getReferencesInElements($document, metaStyle.name).each(function (mr) {
                    // Replace existing attribute value to support values like this /*@VariableName*/?someparameter=1
                    var value = mr.attributeValue.match(_this.getInlineMatchExpression(metaStyle.name))
                        ? String.Replace(mr.attributeValue, _this.getInlineMatchExpression(metaStyle.name), formattedValue)
                        : formattedValue;
                    mr.element.attr(mr.attributeName, value);
                });
            }, "Update style meta value");
        };
        /**
         * Style variable is referenced in case it occurs in the CSS or in the HTML reference attributes.
         * @param iframe The iframe.
         * @param metaStyle The style.
         */
        MetadataParser.prototype.isReferencedInDocument = function (iframe, styleName, styleFormat) {
            var _this = this;
            var metaInStyles = false;
            var styleContents = iframe
                .contents()
                .find("style")
                .contents();
            styleContents.each(function (index, domElem) {
                if (domElem && domElem.textContent && domElem.textContent.match(_this.getMatchExpression(styleName))) {
                    metaInStyles = true;
                    // Stop the loop
                    return false;
                }
                // Continue execution
                return true;
            });
            return metaInStyles || this.getReferencesInElements(iframe, styleName).count() > 0;
        };
        /**
         * Returns the expression to match a style/variable in the styles.
         * @param metaStyle The style/variable
         */
        MetadataParser.prototype.getMatchExpression = function (styleName) {
            return "/\\*([\\s])*@" + styleName + "([\\s])*\\*/[^;]*/\\*([\\s])*@" + styleName + "([\\s])*\\*/";
        };
        /**
         * Returns the expression to match a style/variable in the document.
         * @param metaStyle The style/variable
         */
        MetadataParser.prototype.getInlineMatchExpression = function (styleName) {
            return "/\\*([\\s])*@" + styleName + "([\\s])*\\*\\/";
        };
        /**
         * Returns all elements that reference a style/variable.
         * @param iframe The iframe.
         * @param metaStyle The style
         */
        MetadataParser.prototype.getReferencesInElements = function (iframe, styleName) {
            var _this = this;
            var references = new ArrayQuery([]);
            Editor.CommonUtils.getBySelector("*[property-reference*=" + styleName + "]", iframe.contents().children()).each(function (i, e) {
                var propertyReferences = $(e)
                    .attr("property-reference")
                    .split(";");
                propertyReferences.forEach(function (value) {
                    var attributeName = value.split(":")[0];
                    var attributeValue = value.split(":")[1];
                    if (!String.isNullOrWhitespace(attributeValue) &&
                        (attributeValue.trim() === "@" + styleName.trim() ||
                            attributeValue.trim().match(_this.getInlineMatchExpression(styleName)))) {
                        references.add(new Editor.MetaStyleReference(attributeName.trim(), attributeValue.trim(), $(e)));
                    }
                });
            });
            return references;
        };
        return MetadataParser;
    }());
    Editor.MetadataParser = MetadataParser;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var MetaStyleReference = /** @class */ (function () {
        function MetaStyleReference(attributeName, attributeValue, element) {
            this.attributeName = attributeName;
            this.attributeValue = attributeValue;
            this.element = element;
        }
        return MetaStyleReference;
    }());
    Editor.MetaStyleReference = MetaStyleReference;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var MetaStyle = /** @class */ (function () {
        function MetaStyle(value, name, label, dataType, isUsed, format, group) {
            this.isReferenced = false;
            this.format = String.Empty;
            this.group = String.Empty;
            this.value = value;
            this.name = name;
            this.label = label;
            this.dataType = dataType;
            this.isReferenced = isUsed;
            this.format = String.isNullOrWhitespace(format) ? this.format : format;
            this.group = String.isNullOrWhitespace(group) ? this.group : group;
        }
        return MetaStyle;
    }());
    Editor.MetaStyle = MetaStyle;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /** Represents the tab control on the right pane */
    var MessageControl = /** @class */ (function (_super) {
        __extends(MessageControl, _super);
        /** Initializes a new instance of type
         * @param element - parent element
         */
        function MessageControl(elementId, executionContext, message, metadataParser) {
            var _this = _super.call(this, elementId) || this;
            _this.elementId = elementId;
            _this.executionContext = executionContext;
            _this.message = message;
            _this.metadataParser = metadataParser;
            _this.isPostProcessingOff = false;
            return _this;
        }
        /** Renders the tab control */
        MessageControl.prototype.init = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.renderContainer();
            this.contentChangedHandler = function (eventArgs) { return eventArgs.sourceId !== _this.id && _this.handleHtmlContentChanged(eventArgs.html); };
            this.contentModelHandler = function (eventArgs) { return eventArgs.sourceId !== _this.id && _this.handleHtmlContentChanged(eventArgs.html); };
            this.eventBroker.subscribe(Editor.EventConstants.contentChanged, this.contentChangedHandler);
            this.eventBroker.subscribe(Editor.EventConstants.contentModelInitialized, this.contentModelHandler);
        };
        /**
         * Activates the view - the view becomes visible
         */
        MessageControl.prototype.activate = function () {
            _super.prototype.activate.call(this);
        };
        /**
         * Dectivates the view - the view becomes invisible
         */
        MessageControl.prototype.deactivate = function () {
            _super.prototype.deactivate.call(this);
        };
        /** Dispose */
        MessageControl.prototype.dispose = function () {
            var container = Editor.CommonUtils.getById(this.id);
            ReactDOM.unmountComponentAtNode(container[0]);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentChanged, this.contentChangedHandler);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentModelInitialized, this.contentModelHandler);
        };
        MessageControl.prototype.renderContainer = function () {
            var container = Editor.CommonUtils.getById(this.id);
            container.html(this.isPostProcessingOff ? "<div class=\"controlMessage\">" + this.message + "</div>" : "");
        };
        MessageControl.prototype.handleHtmlContentChanged = function (newHtml) {
            this.sourceDocument = Editor.CommonUtils.getNewContentDocument(newHtml);
            this.isPostProcessingOff = this.isPostProcessingOffInHtml(this.sourceDocument);
            this.renderContainer();
        };
        MessageControl.prototype.isPostProcessingOffInHtml = function (sourceDocument) {
            var postProcessingMetadataValue = this.metadataParser.getValue(Editor.Contract.metadataPostProcessorsDisabledName, sourceDocument);
            var postProcessingDisabledInHtml = postProcessingMetadataValue === Editor.Contract.metadataPostProcessorsDisabledValue;
            return postProcessingDisabledInHtml;
        };
        return MessageControl;
    }(Editor.Control));
    Editor.MessageControl = MessageControl;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /** Represents the tab control on the right pane */
    var PostProcessorToggleButtonControl = /** @class */ (function (_super) {
        __extends(PostProcessorToggleButtonControl, _super);
        /** Initializes a new instance of type
         * @param element - parent element
         */
        function PostProcessorToggleButtonControl(elementId, executionContext, label, toggleButtonContainerId, metadataParser, popupRenderer) {
            var _this = _super.call(this, elementId) || this;
            _this.elementId = elementId;
            _this.executionContext = executionContext;
            _this.label = label;
            _this.toggleButtonContainerId = toggleButtonContainerId;
            _this.metadataParser = metadataParser;
            _this.popupRenderer = popupRenderer;
            _this.isPostProcessingOff = false;
            _this.wasToolboxInitiallyEnabled = null;
            return _this;
        }
        /** Renders the tab control */
        PostProcessorToggleButtonControl.prototype.init = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.renderContainer();
            this.contentChangedHandler = function (eventArgs) { return eventArgs.sourceId !== _this.id && _this.handleHtmlContentChanged(eventArgs.html); };
            this.contentModelHandler = function (eventArgs) { return eventArgs.sourceId !== _this.id && _this.handleHtmlContentChanged(eventArgs.html); };
            this.eventBroker.subscribe(Editor.EventConstants.contentChanged, this.contentChangedHandler);
            this.eventBroker.subscribe(Editor.EventConstants.contentModelInitialized, this.contentModelHandler);
            this.popupRenderer.okButton = "[Post Processing Warning OK Button]";
        };
        /**
         * Activates the view - the view becomes visible
         */
        PostProcessorToggleButtonControl.prototype.activate = function () {
            _super.prototype.activate.call(this);
        };
        /**
         * Dectivates the view - the view becomes invisible
         */
        PostProcessorToggleButtonControl.prototype.deactivate = function () {
            _super.prototype.deactivate.call(this);
        };
        /** Dispose */
        PostProcessorToggleButtonControl.prototype.dispose = function () {
            var container = Editor.CommonUtils.getById(this.toggleButtonContainerId);
            ReactDOM.unmountComponentAtNode(container[0]);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentChanged, this.contentChangedHandler);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentModelInitialized, this.contentModelHandler);
        };
        PostProcessorToggleButtonControl.prototype.renderContainer = function () {
            var _this = this;
            var container = Editor.CommonUtils.getById(this.toggleButtonContainerId);
            var checkboxIdContainer = this.elementId;
            var checkboxIdToggle = this.elementId + "_toggle";
            ReactDOM.render(React.createElement(Editor.Toggle, {
                action: function (value) { return _this.onCheckboxToggled(); },
                checked: this.isPostProcessingOff,
                checkedValue: this.isPostProcessingOff,
                label: this.label,
                fabric: window.Fabric,
                containerId: checkboxIdContainer,
                toggleId: checkboxIdToggle
            }, null), container[0]);
        };
        PostProcessorToggleButtonControl.prototype.onCheckboxToggled = function () {
            var _this = this;
            var newPostProcessingValue = !this.isPostProcessingOff;
            var postProcessingUpdateAction = function () {
                _this.isPostProcessingOff = newPostProcessingValue;
                _this.updatePostProcessingMetaTag(_this.isPostProcessingOff, _this.sourceDocument);
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.resetItemSelection);
                var html = Editor.CommonUtils.getDocumentContent(_this.sourceDocument);
                var eventArgs = new Editor.ContentChangedEventArgs(html, _this.id, null, Editor.CommonConstants.htmlEditorComponentName);
                _this.eventBroker.notify(Editor.EventConstants.contentChanged, eventArgs);
                _this.renderContainer();
                return true;
            };
            if (newPostProcessingValue) {
                this.popupRenderer.setup(this.eventBroker);
                var popupId = this.popupRenderer.render(Editor.CommonUtils.localizationProvider.getLocalizedString("[Post Processing Warning title]"), postProcessingUpdateAction, function () { }, true);
                document.getElementById(popupId).appendChild(this.getDialogContent());
            }
            else {
                postProcessingUpdateAction();
            }
        };
        PostProcessorToggleButtonControl.prototype.handleHtmlContentChanged = function (newHtml) {
            this.sourceDocument = Editor.CommonUtils.getNewContentDocument(newHtml);
            this.isPostProcessingOff = this.isPostProcessingOffInHtml(this.sourceDocument);
            this.renderContainer();
        };
        PostProcessorToggleButtonControl.prototype.isPostProcessingOffInHtml = function (sourceDocument) {
            var postProcessingMetadataValue = this.metadataParser.getValue(Editor.Contract.metadataPostProcessorsDisabledName, sourceDocument);
            var postProcessingDisabledInHtml = postProcessingMetadataValue === Editor.Contract.metadataPostProcessorsDisabledValue;
            return postProcessingDisabledInHtml;
        };
        PostProcessorToggleButtonControl.prototype.updatePostProcessingMetaTag = function (newIsPostprocessingOff, sourceDocument) {
            if (this.wasToolboxInitiallyEnabled === null) {
                this.wasToolboxInitiallyEnabled = this.metadataParser.getValue(Editor.Contract.metadataDocumentTypeName, sourceDocument) === Editor.Contract.metadataDocumentTypeDesignerValue;
            }
            if (newIsPostprocessingOff) {
                this.removeLayoutAttributes(sourceDocument);
                this.metadataParser.deleteMetaEntry(sourceDocument, Editor.Contract.metadataDocumentTypeName);
                this.metadataParser.upsertMetaEntry(sourceDocument, Editor.Contract.metadataPostProcessorsDisabledName, Editor.Contract.metadataPostProcessorsDisabledValue);
            }
            else {
                if (this.wasToolboxInitiallyEnabled) {
                    this.metadataParser.upsertMetaEntry(sourceDocument, Editor.Contract.metadataDocumentTypeName, Editor.Contract.metadataDocumentTypeDesignerValue);
                }
                this.metadataParser.deleteMetaEntry(sourceDocument, Editor.Contract.metadataPostProcessorsDisabledName);
            }
        };
        PostProcessorToggleButtonControl.prototype.removeLayoutAttributes = function (document) {
            var dataLayoutElements = document.querySelectorAll("[" + Editor.Contract.dataLayoutAttrName + "]");
            for (var pos = 0; pos < dataLayoutElements.length; pos++) {
                dataLayoutElements[pos].removeAttribute(Editor.Contract.dataLayoutAttrName);
            }
            var dataSectionElements = document.querySelectorAll("[" + Editor.Contract.dataSectionAttrName + "]");
            for (var pos = 0; pos < dataSectionElements.length; pos++) {
                dataSectionElements[pos].removeAttribute(Editor.Contract.dataSectionAttrName);
            }
            var dataContainerElements = document.querySelectorAll("[" + Editor.Contract.dataContainerWidth + "]");
            for (var pos = 0; pos < dataContainerElements.length; pos++) {
                dataContainerElements[pos].removeAttribute(Editor.Contract.dataContainerWidth);
            }
            var dataContainerAttrElements = document.querySelectorAll("[" + Editor.Contract.containerAttrName + "]");
            for (var pos = 0; pos < dataContainerAttrElements.length; pos++) {
                dataContainerAttrElements[pos].removeAttribute(Editor.Contract.containerAttrName);
            }
        };
        PostProcessorToggleButtonControl.prototype.getDialogContent = function () {
            var content = document.createElement("div");
            content.classList.add("postProcessingDialogContent");
            var line = document.createElement("p");
            line.textContent = Editor.CommonUtils.localizationProvider.getLocalizedString("[Post Processing Warning line 1]");
            var line2 = document.createElement("p");
            line2.textContent = Editor.CommonUtils.localizationProvider.getLocalizedString("[Post Processing Warning line 2]");
            content.appendChild(line);
            content.appendChild(line2);
            return content;
        };
        return PostProcessorToggleButtonControl;
    }(Editor.Control));
    Editor.PostProcessorToggleButtonControl = PostProcessorToggleButtonControl;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /*
     * Factory for IMetadataFieldStrategy implementations
     */
    var MetadataFieldRendererFactory = /** @class */ (function () {
        function MetadataFieldRendererFactory(metadataStylesRendererMapping, detailsViewControl) {
            this.metadataStylesRendererMapping = metadataStylesRendererMapping;
            this.detailsViewControl = detailsViewControl;
            this.defaultMetaStyleRenderer = new Editor.MetadataTextFieldRenderer(this.detailsViewControl);
            this.setDefaultRendererMapping();
        }
        /*
         * Create an IMetadataFieldRenderer implementation
         */
        MetadataFieldRendererFactory.prototype.create = function (metadataStyleContract) {
            var metadataFieldRenderer = this.defaultMetaStyleRenderer;
            if (this.metadataStylesRendererMapping.hasKey(metadataStyleContract)) {
                metadataFieldRenderer = this.metadataStylesRendererMapping.get(metadataStyleContract);
            }
            return metadataFieldRenderer;
        };
        MetadataFieldRendererFactory.prototype.setDefaultRendererMapping = function () {
            if (!this.metadataStylesRendererMapping.hasKey(Editor.Contract.styleMetadataColorDataType)) {
                this.metadataStylesRendererMapping.addOrUpdate(Editor.Contract.styleMetadataColorDataType, new Editor.MetadataColorFieldRenderer(this.detailsViewControl));
            }
            if (!this.metadataStylesRendererMapping.hasKey(Editor.Contract.styleMetadataPictureDataType)) {
                this.metadataStylesRendererMapping.addOrUpdate(Editor.Contract.styleMetadataPictureDataType, new Editor.MetadataImageFieldRenderer(this.detailsViewControl));
            }
            if (!this.metadataStylesRendererMapping.hasKey(Editor.Contract.styleMetadataNumberDataType)) {
                this.metadataStylesRendererMapping.addOrUpdate(Editor.Contract.styleMetadataNumberDataType, this.defaultMetaStyleRenderer);
            }
        };
        return MetadataFieldRendererFactory;
    }());
    Editor.MetadataFieldRendererFactory = MetadataFieldRendererFactory;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    /*
     * Creates an input text field
     */
    var MetadataTextFieldRenderer = /** @class */ (function () {
        function MetadataTextFieldRenderer(detailsViewControl) {
            this.detailsViewControl = detailsViewControl;
        }
        /*
         * Creates an input text field
         */
        MetadataTextFieldRenderer.prototype.render = function (styleSection, metaEntry, eventBroker, containerId, onFieldUpdate) {
            var dataType = Editor.DetailsViewConstants.inputTypeText;
            var attributes = { id: metaEntry.name };
            if (metaEntry.dataType === Editor.Contract.styleMetadataNumberDataType) {
                dataType = Editor.DetailsViewConstants.inputTypeNumber;
                attributes["min"] = 0;
            }
            this.detailsViewControl.init(containerId, eventBroker);
            this.detailsViewControl.createInputField(styleSection, Editor.CommonUtils.getLocalizedString("[" + metaEntry.label + "]"), dataType, String.Empty, metaEntry.value, attributes, onFieldUpdate);
        };
        return MetadataTextFieldRenderer;
    }());
    Editor.MetadataTextFieldRenderer = MetadataTextFieldRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var MetadataImageFieldRenderer = /** @class */ (function () {
        function MetadataImageFieldRenderer(detailsViewControl) {
            this.detailsViewControl = detailsViewControl;
        }
        /*
         * Creates an input image field
         */
        MetadataImageFieldRenderer.prototype.render = function (styleSection, metaEntry, eventBroker, containerId, onFieldUpdate) {
            this.detailsViewControl.init(containerId, eventBroker);
            this.detailsViewControl.createImageField(styleSection, Editor.CommonUtils.getLocalizedString("[" + metaEntry.label + "]"), Editor.DetailsViewConstants.inputTypeText, Editor.DetailsViewConstants.srcInputCssClass, metaEntry.value, { id: metaEntry.name }, onFieldUpdate, { hasFocus: false });
        };
        return MetadataImageFieldRenderer;
    }());
    Editor.MetadataImageFieldRenderer = MetadataImageFieldRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    /*
     * Creates an input color field
     */
    var MetadataColorFieldRenderer = /** @class */ (function () {
        function MetadataColorFieldRenderer(detailsViewControl) {
            this.detailsViewControl = detailsViewControl;
        }
        /*
         * @see IMetadataFieldRenderer.render
         */
        MetadataColorFieldRenderer.prototype.render = function (styleSection, metaEntry, eventBroker, containerId, onFieldUpdate) {
            this.detailsViewControl.init(containerId, eventBroker);
            this.detailsViewControl.createInputColorField(styleSection, Editor.CommonUtils.getLocalizedString("[" + metaEntry.label + "]"), Editor.DetailsViewConstants.inputTypeText, String.Empty, metaEntry.value, {
                id: metaEntry.name,
                placeholder: "#000000"
            }, onFieldUpdate);
        };
        return MetadataColorFieldRenderer;
    }());
    Editor.MetadataColorFieldRenderer = MetadataColorFieldRenderer;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    var StylesView = /** @class */ (function (_super) {
        __extends(StylesView, _super);
        function StylesView(containerId, detailsViewControl, metadataFieldRendererFactory, keyboardCommandManager) {
            var _this = _super.call(this, containerId) || this;
            _this.contentChangedHandler = function (eventArgs) {
                if (eventArgs.sourceId !== _this.id) {
                    _this.setContent(eventArgs.html);
                }
                else {
                    // Restore scroll position
                    if (_this.previousScrollPosition) {
                        if (Editor.CommonUtils.isIOS()) {
                            $("." + Editor.CommonConstants.designerContentEditorFrameWrapperClassName).scrollTop(_this.previousScrollPosition);
                        }
                        else {
                            $("." + Editor.CommonConstants.designerContentEditorFrameClassName)
                                .contents()
                                .scrollTop(_this.previousScrollPosition);
                        }
                        _this.previousScrollPosition = 0;
                    }
                }
            };
            _this.onContentModelInitialized = function (eventArgs) {
                _this.documentContentModel = eventArgs.documentContentModel;
            };
            _this.id = containerId;
            _this.detailsViewControl = detailsViewControl;
            _this.keyboardCommandManager = keyboardCommandManager;
            _this.metadataFieldRendererFactory = metadataFieldRendererFactory;
            return _this;
        }
        StylesView.prototype.init = function (eventBroker) {
            this.eventBroker = eventBroker;
            this.detailsViewControl.init(this.id, eventBroker);
            this.eventBroker.subscribe(Editor.EventConstants.contentChanged, this.contentChangedHandler);
            this.eventBroker.subscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
            this.keyboardCommandManager.registerCommand(new KeyboardCommand(KeyboardKeyCodes.sixKey, [KeyboardModifierType.Alt], function () {
                $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.stylesTabContentClassName))
                    .parent()
                    .focus();
                $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.stylesTabContentClassName)).click();
            }));
        };
        StylesView.prototype.activate = function () {
            _super.prototype.activate.call(this);
            this.render();
        };
        StylesView.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.EventConstants.contentChanged, this.contentChangedHandler);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
            this.detailsViewControl.dispose();
            this.getElement().empty();
            this.previousScrollPosition = null;
            this.keyboardCommandManager = null;
            this.documentContentModel = null;
            this.detailsViewControl = null;
            this.eventBroker = null;
        };
        StylesView.prototype.setContent = function (html) {
            this.html = html;
            if (this.isActive) {
                this.render();
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.stylesViewContentUpdated, new Editor.ContentChangedEventArgs(this.html, this.id));
        };
        StylesView.prototype.render = function () {
            var _this = this;
            if (Utility.isNullOrUndefined(this.documentContentModel)) {
                return;
            }
            this.getElement().empty();
            var styleSection = this.detailsViewControl.createSection(Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.stylesSectionTitle));
            var metaEntries = this.documentContentModel.getStyleMetaEntries();
            var contentDocument = this.documentContentModel.getContentNode();
            var hasMetaEntries = false;
            metaEntries.forEach(function (metaEntry) {
                // Only show variables used/referenced in the HTML
                var onFieldUpdate = function (inputField) {
                    var newValue = inputField.val();
                    _this.documentContentModel.updateStyleMetaValue(metaEntry, newValue);
                    _this.html = Editor.CommonUtils.getDocumentContent(_this.documentContentModel.getContentNode(), _this.documentContentModel.getDoctype());
                    // Save scroll position before notifying that content was changed
                    if (Editor.CommonUtils.isIOS()) {
                        _this.previousScrollPosition = $("." + Editor.CommonConstants.designerContentEditorFrameWrapperClassName).scrollTop();
                    }
                    else {
                        _this.previousScrollPosition = $("." + Editor.CommonConstants.designerContentEditorFrameClassName)
                            .contents()
                            .scrollTop();
                    }
                    _this.eventBroker.notify(Editor.EventConstants.contentChanged, new Editor.ContentChangedEventArgs(_this.html, _this.id));
                };
                if (metaEntry.isReferenced &&
                    !Utility.isNullOrUndefined(metaEntry.dataType) &&
                    !Utility.isNullOrUndefined(metaEntry.value)) {
                    var metadataFieldRenderer = _this.metadataFieldRendererFactory.create(metaEntry.dataType);
                    metadataFieldRenderer.render(styleSection, metaEntry, _this.eventBroker, _this.id, onFieldUpdate);
                    hasMetaEntries = true;
                }
            });
            if (!hasMetaEntries) {
                var emptyViewMessage = Editor.CommonUtils.getLocalizedString("[Empty Styles View Message]");
                var emptyWatermark = $("<div>")
                    .addClass(Editor.DetailsViewConstants.emptyWatermarkClassName)
                    .text(emptyViewMessage);
                this.getElement().append(emptyWatermark);
            }
            this.getElement()
                .find("." + Editor.DetailsViewConstants.sectionContainerClassName)
                .toggle(hasMetaEntries);
            this.eventBroker.notify(Editor.EventConstants.controlRendered, new Editor.ControlRenderedEventArgs(this.id, Editor.CommonUtils.getDocumentContent(contentDocument, this.documentContentModel.getDoctype()))); // tslint:disable-line
        };
        return StylesView;
    }(Editor.Control));
    Editor.StylesView = StylesView;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /** Manages visibility of tab items */
    var TabControlVisibilityManager = /** @class */ (function () {
        /** Initializes a new instance of type
         * @param tabItemsVisibility - tab items visibility
         */
        function TabControlVisibilityManager(tabItemsVisibility, eventBroker) {
            var _this = this;
            this.contentResolvedHandler = function () {
                _this.tabItemsVisibility.each(function (tabItemVisibility) {
                    var tabItem = tabItemVisibility.getTabItem();
                    if (tabItemVisibility.isTabEnabled(_this.documentContentModel)) {
                        tabItem.enable();
                    }
                    else {
                        tabItem.disable();
                    }
                });
                _this.onVisibilityUpdated();
            };
            this.onContentModelInitialized = function (eventArgs) {
                _this.documentContentModel = eventArgs.documentContentModel;
            };
            this.tabItemsVisibility = tabItemsVisibility;
            this.eventBroker = eventBroker;
        }
        TabControlVisibilityManager.prototype.init = function (onVisibilityUpdated) {
            this.onVisibilityUpdated = onVisibilityUpdated;
            this.eventBroker.subscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
            this.eventBroker.subscribe(Editor.EventConstants.contentResolved, this.contentResolvedHandler);
        };
        TabControlVisibilityManager.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.EventConstants.contentModelInitialized, this.onContentModelInitialized);
            this.eventBroker.unsubscribe(Editor.EventConstants.contentResolved, this.contentResolvedHandler);
            this.documentContentModel = null;
            this.tabItemsVisibility = null;
        };
        return TabControlVisibilityManager;
    }());
    Editor.TabControlVisibilityManager = TabControlVisibilityManager;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TabControlEventConstants = /** @class */ (function () {
        function TabControlEventConstants() {
        }
        TabControlEventConstants.tabsStateUpdated = "tabcontrol.tabsStateUpdated";
        return TabControlEventConstants;
    }());
    Editor.TabControlEventConstants = TabControlEventConstants;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var SelectableController = /** @class */ (function () {
        function SelectableController(eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.parentEvents = "focus click";
            this.childEvents = "click";
            this.onSelectionChanged = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.selectionChanged, function (args) {
                var operableBlock = args.getOperableBlock();
                _this.currentSelected = operableBlock != null ? operableBlock[0] : null;
            });
        }
        SelectableController.prototype.getName = function () {
            return "SelectableController";
        };
        SelectableController.prototype.setupBlocks = function (blockElements) {
            Editor.CommonUtils.setTabIndex(blockElements, 0);
            this.setEventHandler(blockElements);
        };
        SelectableController.prototype.setupSections = function (sectionElements) {
            this.setEventHandler(sectionElements);
            // get all containers with-in this section and then set event handlers on that.
            var containers = Editor.BlockUtils.getAllContainers(sectionElements);
            this.setEventHandler(containers);
        };
        SelectableController.prototype.setEventHandler = function (elements) {
            var _this = this;
            elements.each(function (_, elem) {
                var block = $(elem);
                var events = Editor.BlockUtils.hasParentSelectable(block) ? _this.childEvents : _this.parentEvents;
                block.off(events);
                block.on(events, function (event) {
                    _this.handleEvent(event);
                });
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        SelectableController.prototype.handleEvent = function (event) {
            // Do not pass the click on to the parent element.
            event.stopPropagation();
            // Do nothing if the clicked element is already selected.
            if (event.delegateTarget === this.currentSelected || event.target === this.currentSelected) {
                return;
            }
            // Do additional checks if a different element is already selected.
            if (this.currentSelected && event.target && event.delegateTarget) {
                // Prevent accidentally switching to the parent of a text block when trying to select text.
                var textSelection = event.target.ownerDocument.defaultView.getSelection();
                if (textSelection && textSelection.toString() && event.target.contains(this.currentSelected)) {
                    return;
                }
                // Ignore clicks on decorated area icons or the AB testing buttons.
                if (event.target.className === Editor.CommonConstants.decoratedAreaIconDeleteCssClass ||
                    event.target.className === Editor.CommonConstants.decoratedAreaIconReturnCssClass ||
                    event.target.className === Editor.CommonConstants.decoratedAreaIconMoveCssClass ||
                    event.target["data-type"] === Editor.CommonConstants.AbTestingButtonData) {
                    return;
                }
                // If a click event was triggered on the currently selected element,
                // yet the event bubbled out of the element (stopPropogation was not called for some reason?),
                // do nothing.
                var selectedElementMarker = $(this.currentSelected).closest(".selectedElement");
                if (selectedElementMarker &&
                    selectedElementMarker[0] &&
                    selectedElementMarker[0].contains(event.target) &&
                    selectedElementMarker[0].contains(this.currentSelected) &&
                    !selectedElementMarker[0].contains(event.delegateTarget)) {
                    return;
                }
            }
            // Change the selected element.
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.itemFocused, new Editor.ItemFocusedEventArgs(event.delegateTarget));
        };
        SelectableController.prototype.cleanupBlocks = function (blockElements) {
            blockElements.removeAttr("tabIndex");
        };
        SelectableController.prototype.cleanupSections = function (sectionElements) {
            sectionElements.removeAttr("tabIndex");
        };
        SelectableController.prototype.disposeBlocks = function (_) { };
        SelectableController.prototype.disposeSections = function (_) { };
        SelectableController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.hard;
        };
        SelectableController.prototype.executeOnSubBlocks = function () {
            return true;
        };
        SelectableController.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.selectionChanged, this.onSelectionChanged);
        };
        return SelectableController;
    }());
    Editor.SelectableController = SelectableController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Class responsible for setting the sortable inside the layout/containers - sections/blocks can be sorted inside and between the layout/containers
     */
    var SortableController = /** @class */ (function () {
        function SortableController(eventBroker) {
            this.eventBroker = eventBroker;
            this.cursorAt = { top: 5, left: 112 };
            this.itemsSelector = "> div, > ab-testing, > ab-variant";
            this.helper = "clone";
            this.sortableDragHandlerSelector = "." + Editor.CommonConstants.dragButtonClassName;
        }
        SortableController.prototype.getName = function () {
            return "SortableController";
        };
        SortableController.prototype.setupContainers = function (containers) {
            var _this = this;
            var updateHandler = function () {
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragEnd);
            };
            var startHandler = function (ui) {
                // Set width and height of the sortable container
                ui.helper.width(Editor.CommonConstants.draggableHelperWidth);
                ui.helper.height(Editor.CommonConstants.draggableHelperHeight);
                _this.endAddMode();
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragStart, new Editor.DesignerDragStartEventArgs(ui.item));
            };
            var endHandler = function (ui) {
                var _a;
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragEnd);
                var draggedBlock = Editor.BlockProvider.getChildrenBlocks(ui.item).first();
                if ((_a = draggedBlock) === null || _a === void 0 ? void 0 : _a.length) {
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.itemFocused, new Editor.ItemFocusedEventArgs(draggedBlock[0], true));
                }
            };
            this.setupSortable(containers, updateHandler, startHandler, endHandler);
        };
        SortableController.prototype.setupLayout = function (layout) {
            var _this = this;
            var updateHandler = function () {
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragSectionEnd);
            };
            var startHandler = function (ui) {
                _this.endAddMode();
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragSectionStart, new Editor.DesignerDragStartEventArgs(ui.item));
            };
            var endHandler = function () {
                _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerDragSectionEnd);
            };
            this.setupSortable(layout, updateHandler, startHandler, endHandler);
        };
        SortableController.prototype.setupSortable = function (sortableContainer, updateHandler, startHandler, endHandler) {
            var _this = this;
            sortableContainer.sortable({
                cursor: Editor.CommonConstants.draggableCursor,
                cursorAt: this.cursorAt,
                connectWith: sortableContainer,
                placeholder: "noClass",
                items: this.itemsSelector,
                helper: this.helper,
                handle: this.sortableDragHandlerSelector,
                // using receive on .sortable instead of drop on .droppable
                // because the combo draggable / droppable / sortable triggers the drop event to fire twice (known jqueryui bug)
                update: function () {
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationEnd);
                    updateHandler();
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged);
                },
                start: function (event, ui) {
                    startHandler(ui);
                    var dropPlaceholder = $("<div></div>");
                    dropPlaceholder.addClass(Editor.CommonConstants.dropLineBorderClassName);
                    var addBlockLine = $("<div></div>");
                    addBlockLine.addClass(Editor.CommonConstants.dropLineClassName);
                    dropPlaceholder.append(addBlockLine);
                    var parent = $("<div></div>");
                    parent.append(dropPlaceholder);
                    ui.placeholder.html(parent.html());
                },
                stop: function (event, ui) {
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationEnd);
                    endHandler(ui);
                }
            });
            if (Editor.CommonUtils.isAndroid() || Editor.CommonUtils.isIOS()) {
                sortableContainer.disableSelection();
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        SortableController.prototype.endAddMode = function () {
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddEnd);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddSectionEnd);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationStart);
        };
        SortableController.prototype.cleanupContainers = function (containers) {
            this.cleanup(containers);
        };
        SortableController.prototype.cleanupLayout = function (layout) {
            this.cleanup(layout);
        };
        SortableController.prototype.cleanup = function (elements) {
            Editor.CommonUtils.removeClass(elements, "ui-sortable");
        };
        SortableController.prototype.disposeContainers = function (containers) {
            this.disposeAll(containers);
        };
        SortableController.prototype.disposeLayout = function (layout) {
            this.disposeAll(layout);
        };
        SortableController.prototype.disposeAll = function (elements) {
            elements.filter(":data(sortable)").sortable("destroy");
        };
        SortableController.prototype.dispose = function () {
            this.eventBroker = null;
        };
        return SortableController;
    }());
    Editor.SortableController = SortableController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../commonreferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Class responsible for setting up the draggable blocks - adds the grab handler on hover
     */
    var BlockAbTestingController = /** @class */ (function () {
        function BlockAbTestingController(eventBroker, abTestingContext, selectionStateModel) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.abTestingContext = abTestingContext;
            this.selectionStateModel = selectionStateModel;
            this.alreadyDeletedTests = [];
            this.itemFocusedCallback = function () { return _this.itemFocused(); };
            this.abTestingConfigurationChangedCallback = function () { return _this.abTestingConfigurationChanged(); };
            this.testsDeletedCallback = function (tests) { return _this.deleteTests(tests); };
            this.eventBroker.subscribe(Editor.EventConstants.abTestingConfigurationChanged, this.abTestingConfigurationChangedCallback);
            this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.itemFocused, this.itemFocusedCallback);
            this.eventBroker.subscribe(Editor.EventConstants.abTestingBodyTestDeleted, this.testsDeletedCallback);
        }
        BlockAbTestingController.prototype.getName = function () {
            return "BlockAbTestingController";
        };
        BlockAbTestingController.prototype.setupBlocks = function (blockElements) {
            if (blockElements && blockElements.length) {
                for (var _i = 0, _a = Editor.DomOperation.collectionToArray(blockElements[0].ownerDocument.body.getElementsByTagName(Editor.AbTestingUtils.constants.tagName.abTesting)); _i < _a.length; _i++) {
                    var root = _a[_i];
                    Editor.AbTestingUtils.refreshAbTestingVisibility(root, this.abTestingContext);
                }
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        BlockAbTestingController.prototype.disposeBlocks = function (blockElements) { };
        BlockAbTestingController.prototype.cleanupBlocks = function (blockElements) {
            if (blockElements && blockElements.length) {
                for (var _i = 0, _a = Editor.DomOperation.collectionToArray(blockElements[0].ownerDocument.body.getElementsByTagName(Editor.AbTestingUtils.constants.tagName.abVariant)); _i < _a.length; _i++) {
                    var variant = _a[_i];
                    variant.removeAttribute("style");
                }
            }
        };
        BlockAbTestingController.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.EventConstants.abTestingConfigurationChanged, this.abTestingConfigurationChangedCallback);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.itemFocused, this.itemFocusedCallback);
            this.eventBroker.unsubscribe(Editor.EventConstants.abTestingBodyTestDeleted, this.testsDeletedCallback);
        };
        BlockAbTestingController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.none;
        };
        BlockAbTestingController.prototype.executeOnSubBlocks = function () {
            return false;
        };
        BlockAbTestingController.prototype.abTestingConfigurationChanged = function () {
            var iframe = $("iframe#designer-content-editor");
            if (iframe.length > 0) {
                var currentSelection = this.selectionStateModel.getCurrentSelection();
                for (var _i = 0, _a = Editor.DomOperation.collectionToArray(iframe[0].contentDocument.getElementsByTagName(Editor.AbTestingUtils.constants.tagName.abTesting)); _i < _a.length; _i++) {
                    var root = _a[_i];
                    Editor.AbTestingUtils.refreshAbTestingVisibility(root, this.abTestingContext);
                }
                if (currentSelection && currentSelection.length > 0) {
                    if (Editor.AbTestingUtils.isVariant(currentSelection[0]) ||
                        Editor.AbTestingUtils.isInABTestedSection(currentSelection[0])) {
                        Editor.AbTestingUtils.restoreSelection(this.abTestingContext, currentSelection, iframe.contents());
                    }
                    else {
                        var args = void 0;
                        if (Editor.SectionProvider.isSection(currentSelection)) {
                            args = new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.section, null, null, null, currentSelection);
                        }
                        else if (Editor.BlockProvider.isBlock(currentSelection)) {
                            args = new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.container, null, null, currentSelection, null);
                        }
                        else if (Editor.BlockProvider.isBlock(currentSelection)) {
                            args = new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.block, null, currentSelection, null, null);
                        }
                        else {
                            args = new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.subBlock, currentSelection, null, null, null);
                        }
                        this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, args);
                    }
                }
            }
        };
        BlockAbTestingController.prototype.itemFocused = function () {
            var iframe = $("iframe#designer-content-editor").contents();
            var variantAClass = "variantA";
            var variantBClass = "variantB";
            iframe.find("." + variantAClass + ",." + variantBClass).removeClass(variantAClass + " " + variantBClass);
            var currentSelection = this.selectionStateModel.getCurrentSelection();
            if (currentSelection) {
                var currentBlock = this.selectionStateModel.getCurrentSelection()[0];
                if (currentBlock) {
                    var root = Editor.AbTestingUtils.getRoot(currentBlock);
                    if (root) {
                        if (this.abTestingContext.testId &&
                            (Editor.AbTestingUtils.hasVariantForCurrentTest(currentBlock, this.abTestingContext) ||
                                Editor.AbTestingUtils.isInABTestedSection(currentBlock))) {
                            if (this.abTestingContext.variantId === Editor.AbTestingUtils.constants.defaultValue.variantId) {
                                root.classList.add(variantAClass);
                            }
                            else {
                                root.classList.add(variantBClass);
                            }
                        }
                    }
                }
            }
        };
        BlockAbTestingController.prototype.deleteTests = function (args) {
            var _this = this;
            var deletedTests = args.deletedTests.filter(function (t) { return _this.alreadyDeletedTests.indexOf(t) === -1; });
            var iframe = $("iframe#designer-content-editor");
            if (deletedTests.length > 0 && iframe.length > 0) {
                var _loop_3 = function (root) {
                    deletedTests.forEach(function (test) {
                        return Editor.AbTestingUtils.removeAbBlock(root, _this.abTestingContext, test);
                    });
                };
                for (var _i = 0, _a = Editor.DomOperation.collectionToArray(iframe[0].contentDocument.getElementsByTagName(Editor.AbTestingUtils.constants.tagName.abTesting)); _i < _a.length; _i++) {
                    var root = _a[_i];
                    _loop_3(root);
                }
                this.alreadyDeletedTests = args.deletedTests;
            }
        };
        return BlockAbTestingController;
    }());
    Editor.BlockAbTestingController = BlockAbTestingController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    /**
     * Class responsible for adding tabindex=-1 for each a inside a block.
     */
    var BlockTabbableController = /** @class */ (function () {
        function BlockTabbableController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        BlockTabbableController.prototype.getName = function () {
            return "BlockTabbableController";
        };
        BlockTabbableController.prototype.setupBlocks = function (blockElements) {
            var _this = this;
            this.onBlockChangedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.contentBlockChanged, function (eventArgs) {
                _this.processBlock(eventArgs.block);
            });
            blockElements.each(function (index, block) {
                _this.processBlock($(block));
                $(block).on("keydown", function (e) {
                    var key = e.which || e.keyCode;
                    if (!e.shiftKey && key === KeyCodes.Tab) {
                        var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
                        var lastBlock = Editor.BlockProvider.getBlocks(designerFrame.contents()).last();
                        if ($(block).is(lastBlock)) {
                            e.preventDefault();
                            $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.toolboxTabContentClassName))
                                .parent()
                                .focus();
                            $(Editor.CommonUtils.getClassSelector(Editor.CommonConstants.tabButtonPreClassName + Editor.CommonConstants.toolboxTabContentClassName)).click();
                        }
                    }
                });
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        BlockTabbableController.prototype.cleanupBlocks = function (blockElements) {
            blockElements.each(function (index, block) {
                $(block)
                    .find("a")
                    .removeAttr("tabindex");
                $(block)
                    .find("img")
                    .removeAttr("tabindex");
            });
        };
        BlockTabbableController.prototype.disposeBlocks = function (blockElements) {
            if (!Utility.isNullOrUndefined(blockElements)) {
                blockElements.off("keydown");
            }
        };
        BlockTabbableController.prototype.dispose = function () {
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.contentBlockChanged, this.onBlockChangedHandler);
        };
        BlockTabbableController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.none;
        };
        BlockTabbableController.prototype.processBlock = function (block) {
            $(block)
                .find("a")
                .attr("tabindex", "-1");
            var blockType = $(block.closest("[" + Editor.Contract.blockTypeAttrName + "]")).attr(Editor.Contract.blockTypeAttrName);
            if (blockType === Editor.CommonConstants.textToolType) {
                $(block)
                    .find("img")
                    .attr("tabindex", "-1");
            }
        };
        BlockTabbableController.prototype.executeOnSubBlocks = function () {
            return false;
        };
        return BlockTabbableController;
    }());
    Editor.BlockTabbableController = BlockTabbableController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ArrayQuery = MktSvc.Controls.Common.ArrayQuery;
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    /**
     * Class responsible for setting up a custom inline toolbar for the block.
     */
    var BlockInlineToolbarController = /** @class */ (function () {
        function BlockInlineToolbarController(eventBroker, blockDefinition, ckEditorProxy, commands) {
            var _this = this;
            this.eventBroker = eventBroker;
            this.blockDefinition = blockDefinition;
            this.ckEditorProxy = ckEditorProxy;
            this.commands = commands;
            this.blockIdsWithInitializedToolbars = [];
            this.proxyInitialized = false;
            this.blockSetup = false;
            this.toolbarPrefix = "cke_";
            this.staticToolbarOffset = 15;
            this.observerConfig = { attributes: true, attributeOldValue: true, attributeFilter: ["style"] };
            this.activeBlocks = [];
            this.activeToolbars = [];
            this.onBlockReadyHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.ckEditorInstanceReadyEvent, function (eventArgs) {
                _this.setElementConfiguration(eventArgs);
            });
            this.onCkEditorFocusHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.ckEditorFocus, function (eventArgs) { return _this.onToolbarShown.apply(_this, [eventArgs]); });
            this.onDesignerInitializedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerFrameInitialized, function () { return _this.onDesignerInitialized.apply(_this); });
            this.onDesignerDisposedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerFrameDisposed, function () { return _this.onDesignerDisposed.apply(_this); });
            this.onSelectionChangedHandler = this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.selectionChanged, function (args) {
                _this.onSelectionChanged(args);
            });
            this.onBlockDeletedHandler = this.eventBroker.subscribe(Editor.EventConstants.blockDeleted, function (eventArgs) {
                _this.onBlockDeleted(eventArgs);
            });
            this.editorFeatureServiceClient = Editor.EditorFeatureServiceClient.instance;
        }
        BlockInlineToolbarController.prototype.getName = function () {
            return "BlockInlineToolbarController";
        };
        BlockInlineToolbarController.prototype.onSelectionChanged = function (args) {
            var _this = this;
            this.ckEditorProxy.getCkEditorInitializedPromise().done(function () {
                try {
                    _this.currentlySelectedBlock = null;
                    _this.blurAllActiveToolbars();
                    _this.disposeActiveBlocks();
                    try {
                        // This can fail if this.resizableBlock is not valid anymore (e.g.: after template change)
                        // and the exception blocks the call to the this.wrapCkeditorToolbar a few lines below.
                        // This is causing that the this.resizableBlock never gets correct anymore and this function 
                        // ends up failing from that point
                        Editor.BlockResize.removeResizeOnElement(_this.resizableBlock, _this.resizableElement);
                    }
                    catch (_a) { }
                    if (args.type === Editor.BlockConstants.SelectableType.section ||
                        args.type === Editor.BlockConstants.SelectableType.none) {
                        return;
                    }
                    var operableBlock = args.getOperableBlock();
                    if (operableBlock == null) {
                        return;
                    }
                    _this.activeBlocks.push(operableBlock);
                    var blockDefinition = _this.blockDefinition.getBlockDefinition(operableBlock);
                    var isEditable = !Editor.BlockUtils.isProtected(operableBlock);
                    if (isEditable && blockDefinition && blockDefinition.getInlineToolbar() != null) {
                        _this.currentlySelectedBlock = operableBlock.attr("id");
                        var editableElement = _this.wrapCkeditorToolbar(_this.currentlySelectedBlock, operableBlock, blockDefinition);
                        Editor.CommonUtils.setEditable(editableElement);
                        var activeToolbar = _this.ckEditorProxy.getCkEditorId(operableBlock);
                        if (_this.activeToolbars.indexOf(activeToolbar) === -1) {
                            _this.activeToolbars.push(activeToolbar);
                        }
                        _this.setToolbarEvents(activeToolbar, editableElement, operableBlock);
                        if (blockDefinition.isEditable() && blockDefinition.usePlainText() && _this.ckEditorProxy) {
                            var ckEditor = _this.ckEditorProxy.getCkEditorInstance(activeToolbar);
                            if (!Utility.isNullOrUndefined(ckEditor)) {
                                ckEditor.config.pasteFilter = null;
                                ckEditor.config.allowedContent = true;
                                if (ckEditor.editable()) {
                                    ckEditor.setReadOnly(false);
                                }
                            }
                        }
                        if (!blockDefinition.isEditable()) {
                            Editor.CommonUtils.setNonEditable(editableElement);
                        }
                    }
                }
                catch (_b) { }
            });
        };
        BlockInlineToolbarController.prototype.onBlockDeleted = function (blockDeletedEventArgs) {
            var deletedBlock = blockDeletedEventArgs.block;
            this.disposeInlineToolbarEditorsAssociatedWithBlock(deletedBlock);
        };
        BlockInlineToolbarController.prototype.setToolbarEvents = function (ckEditorId, editableElement, $block) {
            var _this = this;
            this.ckEditorProxy.setEditorFocus(ckEditorId, function () {
                var localEditableElement = editableElement || Editor.BlockProvider.getEditableElement($block);
                // Remove old events
                localEditableElement.off("focus click focusout");
                var editableElementFocus = function () {
                    if (_this.selectedBlockId !== $block.attr("id")) {
                        _this.selectedBlockId = $block.attr("id");
                        _this.fixContentPosition(ckEditorId);
                        _this.createObserver();
                        _this.observeToolbar(ckEditorId);
                        _this.appendAccessibilityButton(localEditableElement, "toolbarnav_" + $block.attr("id"), "[Navigate to toolbar]", function () {
                            // We need to cast this as any as TS typings for the std
                            // library does not support keyCode or which as part of
                            // the initialisation object.
                            _this.ckEditorProxy.setEditorFocus(ckEditorId, function () {
                                var keyDown = new Event("keydown", { bubbles: true });
                                keyDown.altKey = true;
                                keyDown.keyCode = KeyCodes.F10;
                                keyDown.which = KeyCodes.F10;
                                localEditableElement[0].dispatchEvent(keyDown);
                            });
                        });
                    }
                };
                localEditableElement.on("focus click", editableElementFocus);
                localEditableElement.on("focusout", function () {
                    if (_this.toolbarObserver) {
                        _this.toolbarObserver.takeRecords();
                        _this.toolbarObserver.disconnect();
                    }
                    // We wrap the removal of the accessibility button in a
                    // setTimeout(_, 0) to allow the screen reader to execute its
                    // click action before we remove the button.
                    setTimeout(function () {
                        _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationStart);
                        localEditableElement.children("#toolbarnav_" + $block.attr("id")).remove();
                    }, 0);
                    setTimeout(function () {
                        _this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationEnd);
                    }, 0);
                    _this.selectedBlockId = String.Empty;
                    localEditableElement.css("margin-top", "0");
                });
                editableElementFocus();
                _this.appendAccessibilityButton(_this.getToolbar(ckEditorId), "toolbarret_" + $block.attr("id"), "[Leave toolbar]", function () {
                    localEditableElement.focus();
                });
            });
        };
        BlockInlineToolbarController.prototype.wrapCkeditorToolbar = function (blockId, $block, blockDefinition) {
            if (!this.isToolbarInitialized(blockId)) {
                var editableElement = void 0;
                var inlineToolbar = blockDefinition.getInlineToolbar();
                var blockChildrenElements = $block.children();
                var editorId_1 = UniqueId.generate(BlockInlineToolbarController.editorIdPrefix);
                var wrapperFunction = function () {
                    var ckeditorWrapper = $("<div>");
                    Editor.CommonUtils.setEditable(ckeditorWrapper);
                    Editor.CommonUtils.setId(ckeditorWrapper, editorId_1);
                    ckeditorWrapper.attr(Editor.CommonConstants.ckEditorAttrName, "true");
                    return ckeditorWrapper;
                };
                if (blockChildrenElements.length !== 0) {
                    Editor.BrowserQuirks.fixCheckedNodes(blockChildrenElements);
                    editableElement = blockChildrenElements.wrapAll(wrapperFunction()).parent();
                }
                else {
                    editableElement = wrapperFunction().appendTo($block);
                }
                Editor.CommonUtils.setAriaAttribute(editableElement, "aria-label", $block.attr("aria-label"));
                this.initInlineToolbar(editableElement, inlineToolbar, blockId);
                return editableElement;
            }
            else {
                var editableElement = Editor.BlockProvider.getEditableElement($block);
                this.setResize(editableElement.closest("[" + Editor.Contract.blockTypeAttrName + "]"));
                return editableElement;
            }
        };
        /**
         * Init the proxy on designer iframe initialization.
         */
        BlockInlineToolbarController.prototype.onDesignerInitialized = function () {
            var _this = this;
            this.blockIdsWithInitializedToolbars = [];
            // CkEditor initialization
            this.ckEditorProxy.init(this.getDesignerFrame().get(0), function () {
                // Setup the commands
                _this.commands.forEach(function (command) {
                    _this.setupCommand(command);
                });
                _this.proxyInitialized = true;
                _this.notifyControllerReady();
            });
        };
        BlockInlineToolbarController.prototype.setupBlocks = function (blockElements) {
            var _this = this;
            this.ckEditorProxy.getCkEditorInitializedPromise().done(function () {
                blockElements.each(function (index, block) {
                    var $block = $(block);
                    var blockDefinition = _this.blockDefinition.getBlockDefinition($block);
                    if (!Utility.isNullOrUndefined(blockDefinition)) {
                        $block.attr(Editor.CommonConstants.toolbardataAttrName, "true");
                        // The editable has to be removed from the block, otherwise the ckeditor toolbar disappears
                        // (the editable is set only for the ckeditor contrainer)
                        Editor.CommonUtils.removeEditable($block);
                    }
                });
                _this.blockSetup = true;
                _this.notifyControllerReady();
            });
        };
        BlockInlineToolbarController.prototype.fixContentPosition = function (editorId) {
            var designerFrame = this.getDesignerFrame();
            var editableElement = designerFrame.contents().find("#" + editorId);
            var visibleToolbar = this.getToolbar(editorId, true);
            if (!editableElement.length || !visibleToolbar.length) {
                return;
            }
            var editableElementPosition = editableElement.get(0).getBoundingClientRect().top +
                designerFrame.get(0).contentWindow.pageYOffset;
            if (visibleToolbar.get(0).getBoundingClientRect().top === 0 &&
                editableElementPosition < visibleToolbar.height()) {
                var offset = visibleToolbar.height() + this.staticToolbarOffset - editableElementPosition;
                editableElement.css("margin-top", offset + "px");
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerToolbarPositionChanged);
            }
        };
        BlockInlineToolbarController.prototype.createObserver = function () {
            var _this = this;
            if (!this.toolbarObserver) {
                this.toolbarObserver = new MutationObserver(function (records) {
                    if (records.length &&
                        records[0].target &&
                        records[0].oldValue !== records[0].target.getAttribute("style")) {
                        var editorId = $(records[0].target)
                            .attr("id")
                            .replace(_this.toolbarPrefix, String.Empty);
                        _this.fixContentPosition(editorId);
                    }
                });
            }
        };
        BlockInlineToolbarController.prototype.observeToolbar = function (ckEditorId) {
            var toolbar = this.getToolbar(ckEditorId);
            if (toolbar.length) {
                this.toolbarObserver.observe(toolbar.get(0), this.observerConfig);
            }
        };
        BlockInlineToolbarController.prototype.getToolbar = function (ckEditorId, onlyVisible) {
            if (onlyVisible === void 0) { onlyVisible = false; }
            return this.getDesignerFrame()
                .contents()
                .find("#" + this.toolbarPrefix + ckEditorId + (onlyVisible ? ":visible" : String.Empty));
        };
        BlockInlineToolbarController.prototype.getDesignerFrame = function () {
            return Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
        };
        BlockInlineToolbarController.prototype.cleanupBlocks = function (blockElements) {
            var _this = this;
            new ArrayQuery(blockElements.toArray())
                .select($)
                .where(function (b) { return b.attr(Editor.CommonConstants.toolbardataAttrName) === "true"; })
                .each(function (block) {
                var editors = Editor.BlockProvider.getEditableElements(block);
                editors.each(function (index, editorElement) {
                    var editor = $(editorElement);
                    var editorId = Editor.CommonUtils.getId(editor);
                    if (!Utility.isNullOrUndefined(editorId) && editorId.trim().length > 0 && editor.length) {
                        var ckEditor = _this.ckEditorProxy.getCkEditorInstance(editorId);
                        if (!Utility.isNullOrUndefined(ckEditor)) {
                            editor.get(0).outerHTML = _this.ckEditorProxy.getContent(editorId);
                        }
                    }
                });
                block.removeAttr(Editor.CommonConstants.toolbardataAttrName);
                block.removeAttr("tabIndex");
                block.removeAttr("aria-label");
            });
            blockElements.children("." + Editor.CommonConstants.accessibilityButtonClassName).remove();
            // Cleanup the commands
            this.commands.forEach(function (command) {
                command.cleanup(blockElements);
            });
            // Cleanup additional ckeditor proxy resources
            this.ckEditorProxy.cleanup(blockElements.first().parentsUntil("body html"));
        };
        BlockInlineToolbarController.prototype.disposeBlocks = function (blockElements) {
            var _this = this;
            new ArrayQuery(blockElements.toArray())
                .select($)
                .where(function (b) { return b.attr(Editor.CommonConstants.toolbardataAttrName) === "true"; })
                .each(function (block) {
                _this.disposeInlineToolbarEditorsAssociatedWithBlock(block);
            });
            blockElements.each(function (index, element) {
                Editor.BlockProvider.getEditableElements($(element)).off("focus click");
            });
            if (this.toolbarObserver) {
                this.toolbarObserver.disconnect();
                this.toolbarObserver = null;
            }
            this.ckEditorProxy.cleanup(blockElements.first().parents("html"));
            this.proxyInitialized = false;
            this.blockSetup = false;
        };
        BlockInlineToolbarController.prototype.disposeInlineToolbarEditorsAssociatedWithBlock = function (block) {
            var _this = this;
            var blockId = Editor.CommonUtils.getId(block);
            if (this.isToolbarInitialized(blockId)) {
                var editors = Editor.BlockProvider.getEditableElements(block);
                editors.each(function (_, editorElement) {
                    var editor = $(editorElement);
                    var editorId = Editor.CommonUtils.getId(editor);
                    _this.destroyToolbar(editorId);
                });
            }
            block
                .find(BlockInlineToolbarController.editorWrapperSelector)
                .children()
                .unwrap();
        };
        /**
         * Dispose logic when the designer iframe is disposed.
         */
        BlockInlineToolbarController.prototype.onDesignerDisposed = function () {
            if (this.proxyInitialized) {
                this.commands.forEach(function (command) {
                    command.dispose();
                });
            }
            this.ckEditorProxy.dispose();
            this.proxyInitialized = false;
            this.blockSetup = false;
        };
        BlockInlineToolbarController.prototype.blurAllActiveToolbars = function () {
            for (var _i = 0, _a = this.activeToolbars; _i < _a.length; _i++) {
                var toolbar_1 = _a[_i];
                this.ckEditorProxy.setEditorBlur(toolbar_1);
            }
        };
        BlockInlineToolbarController.prototype.disposeActiveBlocks = function () {
            for (var _i = 0, _a = this.activeBlocks; _i < _a.length; _i++) {
                var activeBlock = _a[_i];
                if (!Editor.CommonUtils.isElementInDesignerFrame(activeBlock)) {
                    continue;
                }
                var editableElement = Editor.BlockProvider.getEditableElement(activeBlock);
                editableElement.off("focus click focusout");
                editableElement.attr(Editor.CommonConstants.contentEditableAttrName, "false");
            }
            this.activeBlocks = [];
        };
        BlockInlineToolbarController.prototype.dispose = function () {
            this.blurAllActiveToolbars();
            this.activeToolbars = [];
            this.disposeActiveBlocks();
            // Release listeners
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.ckEditorInstanceReadyEvent, this.onBlockReadyHandler);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.ckEditorFocus, this.onCkEditorFocusHandler);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerFrameInitialized, this.onDesignerInitializedHandler);
            this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerFrameDisposed, this.onDesignerDisposedHandler);
            this.eventBroker.unsubscribe(Editor.EventConstants.blockDeleted, this.onBlockDeletedHandler);
            this.onCkEditorFocusHandler = this.onDesignerInitializedHandler = this.onDesignerDisposedHandler = this.onBlockReadyHandler = this.onBlockDeletedHandler = null;
            // CkEditor disposal
            this.ckEditorProxy.dispose();
            this.ckEditorProxy = null;
        };
        BlockInlineToolbarController.prototype.executionLockLevel = function () {
            return Editor.BlockConstants.LockLevel.none;
        };
        BlockInlineToolbarController.prototype.initInlineToolbar = function (element, inlineToolbar, blockId) {
            var _this = this;
            var editor = this.ckEditorProxy.createEditor(element, inlineToolbar);
            if (!Utility.isNullOrUndefined(editor)) {
                editor.on("focus", function () { return blockId === _this.currentlySelectedBlock; });
                editor.on(Editor.CkEditorConstants.ckEditorInstanceReadyInternalEventName, function () {
                    _this.setResize(element.closest("[" + Editor.Contract.blockTypeAttrName + "]"));
                });
                this.blockIdsWithInitializedToolbars.push(blockId);
            }
        };
        BlockInlineToolbarController.prototype.setResize = function (resizableBlock) {
            var _this = this;
            if (resizableBlock.length > 0) {
                this.resizableBlock = resizableBlock;
                this.resizableElement = Editor.BlockResize.setResizeOnElement(this.resizableBlock, function () {
                    _this.eventBroker.notify(Editor.DesignerInternalEventConstants.contentChanged);
                });
            }
        };
        BlockInlineToolbarController.prototype.destroyToolbar = function (id) {
            this.ckEditorProxy.destroyEditor(id);
        };
        BlockInlineToolbarController.prototype.isToolbarInitialized = function (blockId) {
            return blockId && $.inArray(blockId, this.blockIdsWithInitializedToolbars) >= 0;
        };
        /**
         * Appends an invisible accessibility button to a block, allowing
         * for extended functionality for users with screen readers.
         * @param parent - the parent block to which the accessibility button
         *        should be appended to.
         * @param id - the id of the button to append. This id will be checked
         *        to prevent the button from being added twice to a parent.
         * @param ariaLabelToken - a localization token to retrieve the aria
         *        label from. This will be read out by the screen reader when
         *        it the button has been selected.
         * @param action - the action to be executed when the button is clicked.
         */
        BlockInlineToolbarController.prototype.appendAccessibilityButton = function (parent, id, ariaLabelToken, action) {
            if (!parent.children("#" + id).length) {
                var toolbarReturnButton = $("<div>");
                toolbarReturnButton.attr("tabindex", "-1");
                toolbarReturnButton.attr("id", id);
                toolbarReturnButton.attr("aria-label", Editor.CommonUtils.getLocalizedString(ariaLabelToken));
                toolbarReturnButton.attr("role", "button");
                toolbarReturnButton.addClass(Editor.CommonConstants.accessibilityButtonClassName);
                toolbarReturnButton.on("focus click", action);
                parent.append(toolbarReturnButton);
                parent.attr("aria-owns", id);
            }
        };
        BlockInlineToolbarController.prototype.setElementConfiguration = function (eventArgs) {
            var instanceName = eventArgs.ckEditorInstanceName;
            var instanceId = eventArgs.sourceId;
            if (this.ckEditorProxy.instanceId() !== instanceId) {
                return;
            }
            this.ckEditorProxy.setRequiredAttributes(instanceName);
            var $ckEditor = this.ckEditorProxy.getCkEditorElement(instanceName);
            // Remove the role='textbox' set by ckeditor. This role confuses screen readers.
            $ckEditor.removeAttribute("role");
            var $block = Editor.BlockUtils.getClosestBlockOrSubBlock($($ckEditor));
            var blockDefinition = this.blockDefinition.getBlockDefinition($block);
            if (!Utility.isNullOrUndefined(blockDefinition) && !blockDefinition.isEditable()) {
                this.ckEditorProxy.setReadOnly(instanceName);
            }
        };
        BlockInlineToolbarController.prototype.onToolbarShown = function (eventArgs) {
            var instanceId = eventArgs.sourceId;
            if (this.ckEditorProxy.instanceId() !== instanceId) {
                return;
            }
            var $block = Editor.BlockProvider.getClosestBlock(Editor.CommonUtils.getById(eventArgs.ckEditorInstanceName));
            this.eventBroker.notify(Editor.EventConstants.toolbarShown, new Editor.ToolbarShownEventArgs(Editor.CommonUtils.getId($block)));
        };
        BlockInlineToolbarController.prototype.setupCommand = function (command) {
            command.setup(this.eventBroker);
            if (command instanceof Editor.CkEditorCommand) {
                var ckEditorCommand = command;
                ckEditorCommand.setupCkEditor(this.ckEditorProxy);
            }
        };
        BlockInlineToolbarController.prototype.notifyControllerReady = function () {
            if (this.proxyInitialized && this.blockSetup) {
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
            }
        };
        BlockInlineToolbarController.prototype.executeOnSubBlocks = function () {
            return true;
        };
        BlockInlineToolbarController.editorIdPrefix = "editorIdPrefix";
        BlockInlineToolbarController.editorWrapperSelector = String.Format('[id^="{0}"]', BlockInlineToolbarController.editorIdPrefix);
        return BlockInlineToolbarController;
    }());
    Editor.BlockInlineToolbarController = BlockInlineToolbarController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * Class responsible for setting the sortable inside the containers - blocks can be sosorted inside and between the containers
     */
    var ContainerIdController = /** @class */ (function () {
        function ContainerIdController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        ContainerIdController.prototype.getName = function () {
            return "ContainerIdController";
        };
        ContainerIdController.prototype.setupContainers = function (containers) {
            containers.each(function (index, container) {
                if (String.isNullOrWhitespace(Editor.CommonUtils.getId($(container)))) {
                    var id = UniqueId.generate("container");
                    Editor.CommonUtils.setId($(container), id);
                }
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        ContainerIdController.prototype.cleanupContainers = function (containers) {
            // Equal heights pre processor will remove the id
        };
        ContainerIdController.prototype.disposeContainers = function (containers) { };
        ContainerIdController.prototype.dispose = function () {
            this.eventBroker = null;
        };
        return ContainerIdController;
    }());
    Editor.ContainerIdController = ContainerIdController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var LayoutProvider;
    (function (LayoutProvider) {
        function getLayout(selectedEditor) {
            var filtered = selectedEditor.filter("[" + Editor.Contract.dataLayoutAttrName + "]");
            if (filtered.length > 0) {
                return filtered;
            }
            return Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrSelector(Editor.Contract.dataLayoutAttrName), selectedEditor);
        }
        LayoutProvider.getLayout = getLayout;
        function isLayout(element) {
            return element.attr(Editor.Contract.dataLayoutAttrName) === "true";
        }
        LayoutProvider.isLayout = isLayout;
    })(LayoutProvider = Editor.LayoutProvider || (Editor.LayoutProvider = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var KeyCodes = MktSvc.Controls.Common.KeyCodes;
    /**
     * Class responsible for the adding placeholders after each section when editor is in add mode.
     */
    var SectionAddModeController = /** @class */ (function () {
        function SectionAddModeController(eventBroker, logger, isZeroStateEnabled) {
            this.logger = logger;
            this.isZeroStateEnabled = isZeroStateEnabled;
            this.sectionSortablePlaceholderClassName = "section-add-placeholder";
            this.ariaLabelText = "Placeholder. Press enter to insert section here";
            this.eventBroker = eventBroker;
            this.editorFeatureServiceClient = Editor.EditorFeatureServiceClient.instance;
        }
        SectionAddModeController.prototype.getName = function () {
            return "SectionAddModeController";
        };
        SectionAddModeController.prototype.setupSections = function (sectionElements) {
            var _this = this;
            if (Utility.isNullOrUndefined(this.onDesignerAddSectionStart)) {
                this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerAddSectionStart, (this.onDesignerAddSectionStart = function (eventArgs) {
                    return _this.designerAddSectionStart(eventArgs.section, eventArgs.movingExistingSection);
                }));
            }
            if (Utility.isNullOrUndefined(this.onDesignerAddSectionEnd)) {
                this.eventBroker.subscribe(Editor.DesignerInternalEventConstants.designerAddSectionEnd, (this.onDesignerAddSectionEnd = function () { return _this.cleanup(); }));
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        SectionAddModeController.prototype.cleanupSections = function (sectionElements) {
            this.cleanup(sectionElements);
        };
        SectionAddModeController.prototype.disposeSections = function (sectionElements) {
            this.cleanup(sectionElements);
        };
        SectionAddModeController.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.onDesignerAddSectionStart)) {
                this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddSectionStart, this.onDesignerAddSectionStart);
            }
            if (!Utility.isNullOrUndefined(this.onDesignerAddSectionEnd)) {
                this.eventBroker.unsubscribe(Editor.DesignerInternalEventConstants.designerAddSectionEnd, this.onDesignerAddSectionEnd);
            }
            this.onDesignerAddSectionStart = this.onDesignerAddSectionEnd = null;
            this.cleanup();
        };
        SectionAddModeController.prototype.designerAddSectionStart = function (section, movingExistingSection) {
            var _this = this;
            var designerFrame = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName);
            if (this.isZeroStateEnabled) {
                var iframeBody = designerFrame.contents();
                var zeroStateContainer = iframeBody.find(Editor.CommonConstants.zeroStateContainerClass);
                zeroStateContainer.css("display", "none");
            }
            var sectionElements = Editor.SectionProvider.getSections(designerFrame.contents());
            var startTarget;
            // Remove old focuses and set editor into non event propagation mode
            sectionElements.focusout();
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationStart);
            // Remove old placeholders if they exist
            Editor.CommonUtils.getByClass(this.sectionSortablePlaceholderClassName, designerFrame.contents()).remove();
            // Set tabindexes for the sections
            Editor.CommonUtils.setTabIndex(sectionElements.filter(Editor.CommonUtils.getAttrSelector("tabindex")), -1);
            Editor.CommonUtils.setTabIndex(sectionElements.find(Editor.CommonUtils.getAttrSelector(Editor.CommonConstants.ckEditorAttrName)), -1);
            var addDivider = $("<div></div>");
            addDivider
                .addClass(Editor.CommonConstants.sortablePlaceholderClassName)
                .addClass(this.sectionSortablePlaceholderClassName)
                .attr(Editor.Contract.dataIdAttrName, Editor.TestabilityConstants.sortablePlaceholderId);
            var line = $("<div></div>");
            line.addClass(Editor.CommonConstants.addBlockLineClassName);
            var mouseHover = $("<div></div>");
            mouseHover.addClass(Editor.CommonConstants.addBlockMouseHoverClassName);
            var marker = $("<div></div>");
            marker
                .addClass(Editor.CommonConstants.addBlockButtonClassName)
                .attr("tabindex", "0")
                .attr("role", "button")
                .attr("aria-label", Editor.CommonUtils.getLocalizedString(this.ariaLabelText));
            addDivider.append(line);
            addDivider.append(mouseHover);
            addDivider.append(marker);
            var mouseDownAction = function (event) {
                startTarget = $(event.target.parentElement);
            };
            mouseHover.on("touchstart mousedown", mouseDownAction);
            marker.on("touchstart mousedown", mouseDownAction);
            var mouseUpAction = function (event) {
                var target = $(event.target.parentElement);
                if (startTarget && target.get(0) === startTarget.get(0)) {
                    _this.replacePlaceholder(target, section, movingExistingSection);
                }
            };
            mouseHover.on("touchend mouseup", mouseUpAction);
            marker.on("touchend mouseup", mouseUpAction);
            // Cleanup start target if user scroll the placeholders
            var touchMoveAction = function () {
                startTarget = null;
            };
            marker.on("touchmove", touchMoveAction);
            mouseHover.on("touchmove", touchMoveAction);
            var keyDownAction = function (event) {
                var keyPressed = event.which || event.keyCode;
                var placeholder = $(event.target.parentElement);
                if (keyPressed === KeyCodes.Enter) {
                    event.preventDefault();
                    _this.replacePlaceholder(placeholder, section, movingExistingSection);
                }
            };
            marker.on("keydown", keyDownAction);
            mouseHover.on("keydown", keyDownAction);
            var focusAction = function (event) {
                // Add selection on the selected placeholder
                Editor.CommonUtils.getByClass(Editor.CommonConstants.sortablePlaceholderClassName, designerFrame.contents()).removeClass(Editor.CommonConstants.selectedSortablePlaceholderClassName);
                $(event.target.parentElement).addClass(Editor.CommonConstants.selectedSortablePlaceholderClassName);
            };
            marker.on("focus focusin", focusAction);
            mouseHover.on("focus focusin", focusAction);
            var sections = designerFrame
                .contents()
                .find(Editor.CommonUtils.getAttrEqualsSelector(Editor.Contract.dataLayoutAttrName, "true"))
                .find(Editor.CommonUtils.getAttrEqualsSelector(Editor.Contract.dataSectionAttrName, "true"));
            sections = jQuery.map(sections, function (el) {
                if ($(el)
                    .parent()
                    .hasClass(Editor.CommonConstants.decoratedAreaMarkerCssClass) === true) {
                    return $(el).closest("." + Editor.CommonConstants.selectedElementCssClass);
                }
                return el;
            });
            if (Editor.CommonUtils.isElementDefined(sections)) {
                sections.forEach(function (el, _) {
                    $(el).before(addDivider.clone(true));
                });
                $(sections[sections.length - 1]).after(addDivider.clone(true));
            }
            else {
                var rootNode = designerFrame
                    .contents()
                    .find(Editor.CommonUtils.getAttrEqualsSelector(Editor.Contract.dataLayoutAttrName, "true"));
                rootNode.append(addDivider.clone(true));
            }
            // Set focus on the first selected placeholder
            Editor.CommonUtils.getByClass(Editor.CommonConstants.addBlockButtonClassName, designerFrame.contents())
                .first()
                .focus()
                .focusin();
        };
        SectionAddModeController.prototype.replacePlaceholder = function (placeholder, section, movingExistingSection) {
            Editor.CkEditorTelemetryUtils.sendControllerUsageTelemetry(this.logger, "+", this.getName());
            section.css("padding", Editor.LayoutStyles.padding + "px");
            placeholder.replaceWith(section);
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.cleanPlaceholderForAddMode);
            this.eventBroker.notify(movingExistingSection ? Editor.EventConstants.sectionMoved : Editor.EventConstants.sectionAdded, new Editor.SectionModificationEventArgs(section));
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerAddSectionEnd);
            // adding the flight to make sure selection changed is not invoked for containers
            var containers = Editor.BlockUtils.getAllContainers(section);
            if (containers && containers[0]) {
                this.eventBroker.notify(Editor.DesignerInternalEventConstants.selectionChanged, new Editor.SelectionChangedEventArgs(Editor.BlockConstants.SelectableType.container, null, null, $(containers[0]), null));
            }
        };
        SectionAddModeController.prototype.cleanup = function (sectionElements) {
            var elements = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName).contents();
            var dataLayout = $(elements).find("body .ui-sortable");
            var dataLayoutContents = dataLayout.contents();
            if (sectionElements != null) {
                var removePlaceholdersList = Editor.SectionProvider.filterSectionsWithBlocksInside(sectionElements);
                removePlaceholdersList.each(function (index, el) {
                    var closestContainer = $(el).closest("[" + Editor.Contract.containerAttrName + "]");
                    closestContainer.removeClass(Editor.LayoutStyles.emptyContainerCssClass);
                });
            }
            if (this.isZeroStateEnabled) {
                if (sectionElements === null ||
                    (!dataLayoutContents.length || (dataLayoutContents.length && !dataLayout.children().length))) {
                    var iframeBody = Editor.CommonUtils.getByClass(Editor.CommonConstants.designerContentEditorFrameClassName).contents();
                    var zeroStateContainer = iframeBody.find(Editor.CommonConstants.zeroStateContainerClass);
                    zeroStateContainer.css("display", "initial");
                }
            }
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.designerNonEventPropagationEnd);
        };
        return SectionAddModeController;
    }());
    Editor.SectionAddModeController = SectionAddModeController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    var UniqueId = MktSvc.Controls.Common.UniqueId;
    /**
     * Class responsible for adding a unique id for the section element
     */
    var SectionIdController = /** @class */ (function () {
        function SectionIdController(eventBroker) {
            this.eventBroker = eventBroker;
        }
        SectionIdController.prototype.getName = function () {
            return "SectionIdController";
        };
        SectionIdController.prototype.setupSections = function (sectionElements) {
            sectionElements.each(function (index, section) {
                if (String.isNullOrWhitespace(Editor.CommonUtils.getId($(section)))) {
                    var id = UniqueId.generate("section");
                    Editor.CommonUtils.setId($(section), id);
                }
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        SectionIdController.prototype.cleanupSections = function (sectionElements) {
            sectionElements.removeAttr("id");
        };
        SectionIdController.prototype.disposeSections = function (sectionElements) { };
        SectionIdController.prototype.dispose = function () { };
        return SectionIdController;
    }());
    Editor.SectionIdController = SectionIdController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Class for the notification, when section is loaded.
     */
    var SectionLoadedController = /** @class */ (function () {
        function SectionLoadedController(eventBroker, fcbList) {
            this.eventBroker = eventBroker;
            this.fcbList = fcbList;
            this.layoutSection = new Editor.LayoutSection(fcbList);
        }
        SectionLoadedController.prototype.getName = function () {
            return "SectionLoadedController";
        };
        SectionLoadedController.prototype.setupSections = function (sectionElements) {
            var _this = this;
            sectionElements.each(function (i, section) {
                _this.layoutSection.decorate($(section));
            });
            this.eventBroker.notify(Editor.DesignerInternalEventConstants.controllerReady, new Editor.ControllerReadyEventArgs(this.getName()));
        };
        SectionLoadedController.prototype.cleanupSections = function (sectionElements) {
            var _this = this;
            sectionElements.each(function (i, section) {
                _this.layoutSection.setFinalContent($(section));
            });
        };
        SectionLoadedController.prototype.disposeSections = function (sectionElements) { };
        SectionLoadedController.prototype.dispose = function () { };
        return SectionLoadedController;
    }());
    Editor.SectionLoadedController = SectionLoadedController;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var SectionProvider;
    (function (SectionProvider) {
        function getSections(selectedEditor) {
            var filtered = selectedEditor.filter("[" + Editor.Contract.dataSectionAttrName + "]");
            if (filtered.length > 0) {
                return filtered;
            }
            return Editor.CommonUtils.getBySelector(Editor.CommonUtils.getAttrSelector(Editor.Contract.dataSectionAttrName), selectedEditor);
        }
        SectionProvider.getSections = getSections;
        function getSectionsWithBlocksInside(selectedEditor) {
            return SectionProvider.getSections(selectedEditor).find("[" + Editor.Contract.blockTypeAttrName + "]");
        }
        SectionProvider.getSectionsWithBlocksInside = getSectionsWithBlocksInside;
        function filterSectionsWithBlocksInside(sections) {
            return sections.find("[" + Editor.Contract.blockTypeAttrName + "]");
        }
        SectionProvider.filterSectionsWithBlocksInside = filterSectionsWithBlocksInside;
        function isSection(element) {
            return element.attr(Editor.Contract.dataSectionAttrName) === "true";
        }
        SectionProvider.isSection = isSection;
    })(SectionProvider = Editor.SectionProvider || (Editor.SectionProvider = {}));
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var KeyboardCommand = MktSvc.Controls.Common.KeyboardCommand;
    var KeyboardKeyCodes = MktSvc.Controls.Common.KeyboardKeyCodes;
    var KeyboardModifierType = MktSvc.Controls.Common.KeyboardModifierType;
    /**
     * Plugin to delete the currently selected block.
     */
    var DeleteBlockButton = /** @class */ (function () {
        /**
         * Initializes a new instance of the DeleteBlockButton class.
         */
        function DeleteBlockButton(command) {
            this.command = command;
        }
        /**
         * Gets the name of the button.
         */
        DeleteBlockButton.prototype.getName = function () {
            return "deleteBlockBtn";
        };
        /**
         * Gets the label used with the button.
         */
        DeleteBlockButton.prototype.getLabel = function () {
            return Editor.CommonConstants.deleteBlockLabel;
        };
        /**
         * Get the command associated with the button
         */
        DeleteBlockButton.prototype.getCommand = function () {
            return this.command;
        };
        /**
         * Gets the source of the icon base64 encoded
         */
        DeleteBlockButton.prototype.getIconSrc = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAALEQAACxEBf2RfkQAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC42/Ixj3wAAAHlJREFUOE+1k9ENgCAMRBnBkVym+49QPeLV0jRWMJK80DO+80NoqtpEZMM+Ax3/QGeg96mgLxasMoTsSxne+a1gv0izd9KCtxnYACohZmADqISYwfArKyFmYAOohJiBDaASYgY2AL5Q0UWu1QJCsV/Nc+eBeeQu0HYAkd+Ad00/Q7UAAAAASUVORK5CYII=";
        };
        /**
         * Gets the keyboard shortcut for the button.
         */
        DeleteBlockButton.prototype.getKeyboardShortcut = function () {
            return new KeyboardCommand(KeyboardKeyCodes.dKey, [KeyboardModifierType.Alt, KeyboardModifierType.Shift]);
        };
        return DeleteBlockButton;
    }());
    Editor.DeleteBlockButton = DeleteBlockButton;
})(Editor || (Editor = {}));
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    /**
     * Command to delete a selected block.
     */
    var DeleteBlockCommand = /** @class */ (function (_super) {
        __extends(DeleteBlockCommand, _super);
        function DeleteBlockCommand() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        /**
         * @see ICommand.isContextSensitive
         */
        DeleteBlockCommand.prototype.isContextSensitive = function () {
            return false;
        };
        /**
         * Gets the name of the command.
         */
        DeleteBlockCommand.prototype.getName = function () {
            return DeleteBlockCommand.getName();
        };
        /**
         * Enabled if editor is in read only mode.
         */
        DeleteBlockCommand.prototype.enabledOnReadOnly = function () {
            return true;
        };
        /**
         * Gets the name of the command.
         */
        DeleteBlockCommand.getName = function () {
            return "deleteBlockCommand";
        };
        /**
         * Configure the command.
         * @param eventBroker An instance of event broker.
         */
        DeleteBlockCommand.prototype.setup = function (eventBroker) {
            this.eventBroker = eventBroker;
        };
        /**
         * Executes the command and deletes the currently selected block.
         * @param selectedBlock The currently selected block.
         * @param wrappedBlock The top-wrapping element.
         * @param cleanBlock The clean block, without any wrappers.
         * @param selectedHtml The selected html, if any.
         */
        DeleteBlockCommand.prototype.exec = function (selectedBlock, wrappedBlock, selectedHtml) {
            if (Utility.isNullOrUndefined(selectedBlock)) {
                return false;
            }
            if (Utility.isNullOrUndefined(this.eventBroker)) {
                return false;
            }
            var editorId = this.ckEditorProxy.getCkEditorId(selectedBlock);
            this.ckEditorProxy.destroyEditor(editorId);
            wrappedBlock.remove();
            var eventArgs = new Editor.BlockDeletedEventArgs();
            eventArgs.block = selectedBlock;
            eventArgs.partOfUpdate = false;
            this.eventBroker.notify(Editor.EventConstants.blockDeleted, eventArgs);
            return true;
        };
        /**
         * @see ICommand.shouldSetToolHighlight
         */
        DeleteBlockCommand.prototype.shouldSetToolHighlight = function (element) {
            return false;
        };
        /**
         * Disposes the object - removes the html from the page, empty the  objects and detach the events
         */
        DeleteBlockCommand.prototype.dispose = function () { };
        /*
         * Cleans up the html elements that where added to the page
         */
        DeleteBlockCommand.prototype.cleanup = function (blockElements) { };
        return DeleteBlockCommand;
    }(Editor.CkEditorCommand));
    Editor.DeleteBlockCommand = DeleteBlockCommand;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CodeBlockUpdatedEventArgs = /** @class */ (function (_super) {
        __extends(CodeBlockUpdatedEventArgs, _super);
        function CodeBlockUpdatedEventArgs(id, code) {
            var _this = _super.call(this) || this;
            _this.id = id;
            _this.code = code;
            return _this;
        }
        return CodeBlockUpdatedEventArgs;
    }(Editor.EventArgs));
    Editor.CodeBlockUpdatedEventArgs = CodeBlockUpdatedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var CodeBlockCodeUpdatedEventArgs = /** @class */ (function (_super) {
        __extends(CodeBlockCodeUpdatedEventArgs, _super);
        function CodeBlockCodeUpdatedEventArgs(code, selectedBlock) {
            var _this = _super.call(this) || this;
            _this.code = code;
            _this.selectedBlock = selectedBlock;
            return _this;
        }
        return CodeBlockCodeUpdatedEventArgs;
    }(Editor.EventArgs));
    Editor.CodeBlockCodeUpdatedEventArgs = CodeBlockCodeUpdatedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ArrayQuery = MktSvc.Controls.Common.ArrayQuery;
    var RenderToolsEventArgs = /** @class */ (function (_super) {
        __extends(RenderToolsEventArgs, _super);
        function RenderToolsEventArgs(tools) {
            var _this = _super.call(this) || this;
            _this.tools = new ArrayQuery(tools);
            return _this;
        }
        return RenderToolsEventArgs;
    }(Editor.EventArgs));
    Editor.RenderToolsEventArgs = RenderToolsEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var ItemFocusedEventArgs = /** @class */ (function () {
        function ItemFocusedEventArgs(item, forceSelection) {
            if (forceSelection === void 0) { forceSelection = false; }
            this.item = item;
            this.forceSelection = forceSelection;
        }
        return ItemFocusedEventArgs;
    }());
    Editor.ItemFocusedEventArgs = ItemFocusedEventArgs;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var TraceLevel = MktSvc.Controls.Common.TraceLevel;
    var Dictionary = MktSvc.Controls.Common.Dictionary;
    var EditorFeatureServiceClient = /** @class */ (function () {
        function EditorFeatureServiceClient(clientUrl, featureServiceClient, logger) {
            this.featureServiceClient = featureServiceClient;
            this.logger = logger;
            this.accessibilityCheckerFeatureId = "831c07c6-1367-49d8-9d25-00bbae1b85c9";
            this.newSpamScoreCheckerFeatureId = "9BC83100-66BD-4E01-AD13-95673F7FF558";
        }
        Object.defineProperty(EditorFeatureServiceClient, "instance", {
            get: function () {
                if (!this.editorFeatureServiceClientInstance) {
                    var windowXrm = window.Xrm;
                    var clientUrlFromWindow = void 0;
                    if (windowXrm) {
                        clientUrlFromWindow =
                            (windowXrm.Page && windowXrm.Page.context && windowXrm.Page.context.getClientUrl()) ||
                                (windowXrm.Utility &&
                                    windowXrm.Utility.getGlobalContext() &&
                                    windowXrm.Utility.getGlobalContext().getClientUrl());
                    }
                    var featureServiceClient = new MktSvcCommon.FeatureConfiguration.FeatureServiceClient(clientUrlFromWindow);
                    this.editorFeatureServiceClientInstance = new EditorFeatureServiceClient(clientUrlFromWindow, featureServiceClient, new MktSvcCommon.Logger.TelemetryLogger("EmailEditorControl"));
                }
                return this.editorFeatureServiceClientInstance;
            },
            enumerable: true,
            configurable: true
        });
        EditorFeatureServiceClient.prototype.isAccessibilityCheckerEnabled = function () {
            var _this = this;
            if (this.isAccessibilityCheckerEnabledPromise) {
                return this.isAccessibilityCheckerEnabledPromise;
            }
            var deferred = $.Deferred();
            try {
                this.featureServiceClient
                    .isFeatureEnabled(this.accessibilityCheckerFeatureId)
                    .then(function (isEnabled) {
                    deferred.resolve(isEnabled);
                    if (isEnabled) {
                        $("body").addClass("flight");
                    }
                    if (_this.logger) {
                        _this.logger.log(TraceLevel.Verbose, "Editor.EditorFeatureServiceClient.isAccessibilityCheckerEnabled", new Dictionary({
                            Message: "Retrieved AccessibilityChecker FeatureControl value: '" + isEnabled + "'."
                        }));
                    }
                }, function (rejectResult) {
                    deferred.resolve(false);
                    if (_this.logger) {
                        _this.logger.log(TraceLevel.Error, "Editor.EditorFeatureServiceClient.isAccessibilityCheckerEnabled", new Dictionary({
                            ConsoleErrorKey: "Exception while retrieving AccessibilityChecker FeatureControl. Falling back to default 'false' value.",
                            Error: rejectResult
                        }));
                    }
                });
            }
            catch (e) {
                deferred.resolve(false);
                if (this.logger) {
                    this.logger.log(TraceLevel.Error, "Editor.EditorFeatureServiceClient.isAccessibilityCheckerEnabled", new Dictionary({
                        ConsoleErrorKey: "Exception while retrieving AccessibilityChecker FeatureControl. Falling back to default 'false' value."
                    }));
                }
            }
            this.isAccessibilityCheckerEnabledPromise = deferred.promise();
            return this.isAccessibilityCheckerEnabledPromise;
        };
        EditorFeatureServiceClient.prototype.isNewSpamScoreCheckerEnabled = function (logger) {
            var _this = this;
            if (this.isNewSpamScoreCheckerEnabledPromise) {
                return this.isNewSpamScoreCheckerEnabledPromise;
            }
            var deferred = $.Deferred();
            this.logger = logger;
            try {
                this.featureServiceClient
                    .isFeatureEnabled(this.newSpamScoreCheckerFeatureId)
                    .then(function (isEnabled) {
                    if (isEnabled) {
                        $("body").addClass("flight");
                    }
                    deferred.resolve(isEnabled);
                    _this.logger.log(TraceLevel.Verbose, "Editor.EditorFeatureServiceClient.isNewSpamScoreCheckerEnabled", new Dictionary({ Message: "Retrieved LayoutEditing FeatureControl value: '" + isEnabled + "'." }));
                })
                    .catch(function () {
                    deferred.resolve(false);
                    _this.logger.log(TraceLevel.Error, "Editor.EditorFeatureServiceClient.isNewSpamScoreCheckerEnabled", new Dictionary({
                        ConsoleErrorKey: "Exception while retrieving LayoutEditing FeatureControl. Falling back to default 'false' value."
                    }));
                });
            }
            catch (e) {
                deferred.resolve(false);
                this.logger.log(TraceLevel.Error, "Editor.EditorFeatureServiceClient.isNewSpamScoreCheckerEnabled", new Dictionary({
                    ConsoleErrorKey: "Exception while retrieving LayoutEditing FeatureControl. Falling back to default 'false' value."
                }));
            }
            this.isNewSpamScoreCheckerEnabledPromise = deferred.promise();
            return this.isNewSpamScoreCheckerEnabledPromise;
        };
        return EditorFeatureServiceClient;
    }());
    Editor.EditorFeatureServiceClient = EditorFeatureServiceClient;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    var ContentBlock = /** @class */ (function () {
        function ContentBlock(executionContext, toolBlockMapping) {
            this.executionContext = executionContext;
            this.toolBlockMapping = toolBlockMapping;
            this.contentBlockPlaceholder = Editor.CommonUtils.getContentBlockPlaceholder();
            this.cleanedUpContentBlock = "about:blank";
            this.keepContentBlockAttributes = ["data-editorblocktype", "tabindex", "id", "data-toolbar"];
            this.originalAttributes = [];
        }
        ContentBlock.prototype.getType = function () {
            return ContentBlock.type;
        };
        ContentBlock.prototype.getLocalizedTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.contentBlockTool);
        };
        ContentBlock.prototype.usePlainText = function () {
            return false;
        };
        ContentBlock.prototype.isEditable = function () {
            return false;
        };
        ContentBlock.prototype.getInlineToolbar = function () {
            return null;
        };
        ContentBlock.prototype.setup = function (eventBroker) {
            var _this = this;
            this.eventBroker = eventBroker;
            if (Utility.isNullOrUndefined(this.onContentBlockSourceChanged)) {
                this.eventBroker.subscribe(Editor.EventConstants.contentBlockAttributeChanged, (this.onContentBlockSourceChanged = function (eventArgs) {
                    return _this.updateContentBlockSource(eventArgs);
                }));
            }
        };
        ContentBlock.prototype.dispose = function () {
            if (!Utility.isNullOrUndefined(this.eventBroker)) {
                this.eventBroker.unsubscribe(Editor.EventConstants.contentBlockAttributeChanged, this.onContentBlockSourceChanged);
                this.onContentBlockSourceChanged = null;
            }
        };
        ContentBlock.prototype.isConfigured = function (block) {
            return this.isContentBlockConfigured(this.getSource(block));
        };
        ContentBlock.prototype.decorate = function (block) {
            if (block.attr(Editor.Contract.blockTypeAttrName) === this.getType()) {
                var blockWithUpdatedFormat = this.updateContentBlockToNewerFormat(block);
                var contentBlock = this.getContentBlock(blockWithUpdatedFormat);
                this.decorateBlockOverlay(contentBlock);
                this.setAriaLabel(blockWithUpdatedFormat);
            }
        };
        ContentBlock.prototype.setFinalContent = function (block) {
            if (this.isPlaceholderNeeded(this.getSource(block))) {
                Editor.CommonUtils.removeBlockOverlay(block);
            }
            block.removeAttr("aria-label");
        };
        ContentBlock.prototype.onBlockAdded = function (block) {
            if (!this.originalAttributesStored) {
                var element = block.get(0);
                for (var i = 0; i < element.attributes.length; i++) {
                    this.originalAttributes.push(element.attributes.item(i).cloneNode());
                }
                this.originalAttributesStored = true;
            }
        };
        ContentBlock.prototype.updateContentBlockSource = function (eventArgs) {
            var _this = this;
            if (eventArgs.contentBlockElement) {
                var blockInCanvas_1 = eventArgs.contentBlockElement
                    .find("." + Editor.DetailsViewConstants.contentBlockWrapper)
                    .first();
                blockInCanvas_1.empty();
                var blockDeletedArgs = new Editor.BlockDeletedEventArgs();
                blockDeletedArgs.partOfUpdate = true;
                blockDeletedArgs.sourceId = eventArgs.sourceId;
                blockDeletedArgs.block = blockInCanvas_1.children();
                this.eventBroker.notify(Editor.EventConstants.blockDeleted, blockDeletedArgs);
                if (eventArgs.finalizedHtml) {
                    this.sanitizeContentBlock(eventArgs.finalizedHtml).done(function (sanitizedContent) {
                        var blockWithUpdatedFormat = _this.updateContentBlockToNewerFormat(sanitizedContent);
                        var attr;
                        var attributes = Array.prototype.slice.call(blockWithUpdatedFormat[0].attributes);
                        while ((attr = attributes.pop())) {
                            eventArgs.contentBlockElement[0].setAttribute(attr.nodeName, attr.nodeValue);
                        }
                        blockInCanvas_1.append(blockWithUpdatedFormat.children());
                        var contentBlockElem = blockInCanvas_1.closest("[" + Editor.Contract.blockTypeAttrName + "='" + Editor.CommonConstants.contentBlockToolType + "']");
                        _this.setAriaLabel(contentBlockElem);
                        contentBlockElem.attr(Editor.DetailsViewConstants.lookupIdAttribute, eventArgs.entityId);
                        contentBlockElem.attr(Editor.DetailsViewConstants.lookupNameAttribute, eventArgs.entityName);
                        var modifiedNotification = new Editor.BlockModificationEventArgs(blockInCanvas_1.children());
                        modifiedNotification.sourceId = eventArgs.sourceId;
                        _this.eventBroker.notify(Editor.EventConstants.blockAdded, modifiedNotification);
                    });
                }
                else if (String.isNullOrEmpty(eventArgs.entityName)) {
                    // remove all attributes that might have been added previously
                    this.resetBlockElementAttributes(eventArgs);
                    blockInCanvas_1.append("<img src=\"\" />");
                    this.decorate(eventArgs.contentBlockElement);
                    var modifiedNotification = new Editor.BlockModificationEventArgs(blockInCanvas_1.children());
                    modifiedNotification.sourceId = eventArgs.sourceId;
                    this.eventBroker.notify(Editor.EventConstants.blockAdded, modifiedNotification);
                }
            }
        };
        ContentBlock.prototype.resetBlockElementAttributes = function (eventArgs) {
            if (this.originalAttributesStored) {
                while (eventArgs.contentBlockElement[0].attributes.length > 0) {
                    eventArgs.contentBlockElement[0].removeAttribute(eventArgs.contentBlockElement[0].attributes[0].name);
                }
                for (var i = 0; i < this.originalAttributes.length; i++) {
                    var attribute = this.originalAttributes[i];
                    eventArgs.contentBlockElement[0].setAttribute(attribute.name, attribute.value);
                }
            }
            else {
                var elementAttributeNamesToRemove = [];
                for (var i = 0; i < eventArgs.contentBlockElement[0].attributes.length; i++) {
                    var attrName = eventArgs.contentBlockElement[0].attributes[i].name;
                    if (this.keepContentBlockAttributes.indexOf(attrName) > -1) {
                        continue;
                    }
                    elementAttributeNamesToRemove.push(attrName);
                }
                elementAttributeNamesToRemove.forEach(function (attrName) {
                    return eventArgs.contentBlockElement[0].removeAttribute(attrName);
                });
            }
        };
        ContentBlock.prototype.updateContentBlockToNewerFormat = function (block) {
            var subBlockType = block.attr(Editor.Contract.blockDatatypeAttrName);
            if (subBlockType) {
                var subBlock = block.find("[" + Editor.Contract.subBlockAttrName + "='true']");
                subBlock.attr(Editor.Contract.blockDatatypeAttrName, subBlockType);
                block.removeAttr(Editor.Contract.blockDatatypeAttrName);
            }
            return block;
        };
        ContentBlock.prototype.sanitizeContentBlock = function (html) {
            var sanitizationPromise = $.Deferred();
            this.executionContext.getContentSanitizer().getSanitizedContent(html, function (output) {
                sanitizationPromise.resolve(output.children().first());
            });
            return sanitizationPromise;
        };
        ContentBlock.prototype.setAriaLabel = function (block) {
            var txt = "[" + (!this.isConfigured(block) ? "Unconfigured " : String.Empty) + block.attr(Editor.Contract.blockTypeAttrName) + " block tool]";
            var translatedText = Editor.CommonUtils.getLocalizedString(txt);
            var element = Editor.BlockProvider.getEditableElement(block);
            Editor.CommonUtils.setAriaAttribute(block, "aria-label", translatedText);
            Editor.CommonUtils.setAriaAttribute(element, "aria-label", translatedText);
            Editor.CommonUtils.setAriaAttribute(element, "title", translatedText);
        };
        ContentBlock.prototype.getContentBlock = function (block) {
            return block.find("img").not("." + Editor.CommonConstants.unconfiguredOverlayIconCssClassName);
        };
        ContentBlock.prototype.getBlock = function (contentBlock) {
            return Editor.BlockProvider.getClosestBlock(contentBlock);
        };
        ContentBlock.prototype.getSource = function (block) {
            return this.getContentBlock(block).attr("src");
        };
        ContentBlock.prototype.decorateBlockOverlay = function (contentBlock) {
            var block = this.getBlock(contentBlock);
            var element = contentBlock.parent();
            Editor.CommonUtils.removeBlockOverlay(block);
            if (this.isPlaceholderNeeded(this.getSource(block))) {
                Editor.CommonUtils.overlayBlockElement(element, contentBlock, this.getContentBlockPlaceholder(this.getSource(block)), Editor.BlockType.ContentBlock);
            }
        };
        ContentBlock.prototype.isContentBlockConfigured = function (src) {
            return (!String.isNullUndefinedOrWhitespace(src) &&
                src !== this.contentBlockPlaceholder &&
                src !== this.cleanedUpContentBlock);
        };
        ContentBlock.prototype.isPlaceholderNeeded = function (src) {
            return !this.isContentBlockConfigured(src);
        };
        ContentBlock.prototype.getContentBlockPlaceholder = function (src) {
            return this.contentBlockPlaceholder;
        };
        ContentBlock.type = Editor.CommonConstants.contentBlockToolType;
        return ContentBlock;
    }());
    Editor.ContentBlock = ContentBlock;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var EditorCustomization = /** @class */ (function () {
        function EditorCustomization() {
            this.HTMLEditor = true;
        }
        return EditorCustomization;
    }());
    Editor.EditorCustomization = EditorCustomization;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var String = MktSvc.Controls.Common.String;
    /**
     * Caretaker for the editor mememntos - a linear list of the editor content.
     */
    var UndoRedoManager = /** @class */ (function (_super) {
        __extends(UndoRedoManager, _super);
        function UndoRedoManager() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        UndoRedoManager.prototype.init = function (control) {
            var _this = this;
            _super.prototype.init.call(this, control);
            this.onContentChanged = function (eventArgs) {
                if (eventArgs.sourceId === _this.Id ||
                    eventArgs.originalSourceId === Editor.AbTestingUtils.constants.eventSourceId) {
                    return;
                }
                if (_this.previousHtml !== eventArgs.html) {
                    _this.previousHtml = eventArgs.html;
                    _this.saveState(eventArgs.html);
                }
            };
            this.control.getEventBroker().subscribe(Editor.EventConstants.contentChanged, this.onContentChanged);
            this.savedStates = new Array();
            this.currentStateIndex = -1;
            this.saveState(this.control.getContent());
        };
        UndoRedoManager.prototype.isStateValidForSave = function (state) {
            return !(String.isNullOrWhitespace(state) ||
                (this.savedStates.length > 0 && this.savedStates[this.currentStateIndex] === state));
        };
        UndoRedoManager.prototype.restoreState = function (state) {
            if (!String.isNullOrWhitespace(state)) {
                this.control.setContent(state, this.Id);
            }
        };
        UndoRedoManager.prototype.dispose = function () {
            _super.prototype.dispose.call(this);
            this.control.getEventBroker().unsubscribe(Editor.EventConstants.contentChanged, this.onContentChanged);
        };
        return UndoRedoManager;
    }(MktSvcCommon.UndoRedo.UndoRedoManagerBase));
    Editor.UndoRedoManager = UndoRedoManager;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    /**
     * Browser feature support constants
     */
    var BrowserFeatureSupport = /** @class */ (function () {
        function BrowserFeatureSupport() {
        }
        BrowserFeatureSupport.html5ColorPickerSupported = (function () {
            // Testing whether browser supports HTML5 color picker
            var testInput = document.createElement("input");
            testInput.setAttribute("type", "color");
            return testInput.type.toLowerCase() === "color";
        })();
        return BrowserFeatureSupport;
    }());
    Editor.BrowserFeatureSupport = BrowserFeatureSupport;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var String = MktSvc.Controls.Common.String;
    /**
     * Common utility methods
     */
    var ColorUtils = /** @class */ (function () {
        function ColorUtils() {
        }
        /**
         * Converts rgb(a) value to the hex value.
         * @param rgbColor rgb(a) color value.
         */
        ColorUtils.rgbToHex = function (rgbColor, allowTransparent) {
            if (Utility.isNullOrUndefined(rgbColor)) {
                return String.Empty;
            }
            if (allowTransparent) {
                var rgba = rgbColor.replace(/\s/g, String.Empty).match(/^rgba\((\d+,)(\d+,)(\d+,)(\d+)\)/i);
                if (rgba && rgba.length === 5 && rgba[4] === "0") {
                    return this.transparent;
                }
            }
            var rgb = rgbColor.replace(/\s/g, String.Empty).match(/^rgba?\((\d+,)(\d+,)(\d+)/i);
            if (rgb && rgb.length === 4) {
                var result = "#";
                for (var i = 1; i < rgb.length; i++) {
                    result += ("0" + parseInt(rgb[i]).toString(16)).slice(-2); // tslint:disable-line
                }
                return result;
            }
            return rgbColor;
        };
        /**
         * Converts color from any representation supported by browser to hex without alpha
         * @param color color string specification (hex, rgb, hsl, name)
         */
        ColorUtils.toHex = function (color) {
            // When fillStyle property of the canvas context is set to color string, it immediately converts the color value to hex representation.
            ColorUtils.converterCanvasContext.fillStyle = color;
            return ColorUtils.converterCanvasContext.fillStyle;
        };
        ColorUtils.black = "#000000";
        ColorUtils.white = "#ffffff";
        ColorUtils.transparent = "#ffffff00";
        ColorUtils.converterCanvasContext = document
            .createElement("canvas")
            .getContext("2d");
        return ColorUtils;
    }());
    Editor.ColorUtils = ColorUtils;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var CkEditorUtils = /** @class */ (function () {
        function CkEditorUtils() {
        }
        CkEditorUtils.setCkEditorElementStyle = function (element, style, value) {
            if (!Utility.isNullOrUndefined(style) && !Utility.isNullOrUndefined(value)) {
                element.setStyle(style, value);
            }
        };
        CkEditorUtils.setCkEditorElementAttribute = function (element, attribute, value) {
            if (!Utility.isNullOrUndefined(attribute) && !Utility.isNullOrUndefined(value)) {
                element.setAttribute(attribute, value);
            }
        };
        return CkEditorUtils;
    }());
    Editor.CkEditorUtils = CkEditorUtils;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../commonreferences.ts" />
var Editor;
(function (Editor) {
    var Utility = MktSvc.Controls.Common.Utility;
    var ImageNativeDimensionsProvider = /** @class */ (function () {
        function ImageNativeDimensionsProvider() {
            this.imagesNativeWidthCache = {};
            this.imagePromises = new Map();
        }
        ImageNativeDimensionsProvider.prototype.getDimensions = function (pathsToImages) {
            var _this = this;
            var imageLoadPromises = [];
            for (var i = 0; i < pathsToImages.length; i++) {
                var srcAttribute = pathsToImages[i];
                if (!Utility.isNullOrUndefined(srcAttribute) &&
                    srcAttribute !== "" &&
                    !this.imagesNativeWidthCache.hasOwnProperty(srcAttribute)) {
                    imageLoadPromises.push(this.getImageDimensions(srcAttribute));
                }
            }
            return $.when.apply($, imageLoadPromises).then(function () {
                var results = [];
                for (var i = 0; i < pathsToImages.length; i++) {
                    var src = pathsToImages[i];
                    var imageDimensions = _this.getCachedDimensions(src);
                    if (imageDimensions) {
                        results.push(imageDimensions);
                    }
                }
                return results;
            });
        };
        ImageNativeDimensionsProvider.prototype.getCachedDimensions = function (pathToImage) {
            if (this.imagesNativeWidthCache.hasOwnProperty(pathToImage)) {
                return this.imagesNativeWidthCache[pathToImage];
            }
            return null;
        };
        ImageNativeDimensionsProvider.prototype.getImageDimensions = function (srcAttribute) {
            var _this = this;
            if (this.imagePromises.has(srcAttribute)) {
                // Image already being loaded.
                return this.imagePromises.get(srcAttribute);
            }
            var imagePromise = $.Deferred();
            var img = new Image();
            img.onload = function () {
                _this.imagesNativeWidthCache[srcAttribute] = new ImageDimensions(srcAttribute, img.naturalWidth, img.naturalHeight, false);
                img.onload = null;
                img.onabort = null;
                img.onerror = null;
                img = null;
                imagePromise.resolve();
                _this.imagePromises.delete(srcAttribute);
            };
            img.onerror = function () {
                if (!_this.imagesNativeWidthCache.hasOwnProperty(srcAttribute)) {
                    _this.imagesNativeWidthCache[srcAttribute] = new ImageDimensions(srcAttribute, 0, 0, true);
                }
                img.onload = null;
                img.onabort = null;
                img.onerror = null;
                img = null;
                imagePromise.resolve();
                _this.imagePromises.delete(srcAttribute);
            };
            img.onabort = function () {
                if (!_this.imagesNativeWidthCache.hasOwnProperty(srcAttribute)) {
                    _this.imagesNativeWidthCache[srcAttribute] = new ImageDimensions(srcAttribute, 0, 0, true);
                }
                img.onload = null;
                img.onabort = null;
                img.onerror = null;
                img = null;
                imagePromise.resolve();
                _this.imagePromises.delete(srcAttribute);
            };
            img.src = srcAttribute;
            this.imagePromises.set(srcAttribute, imagePromise);
            return imagePromise;
        };
        return ImageNativeDimensionsProvider;
    }());
    Editor.ImageNativeDimensionsProvider = ImageNativeDimensionsProvider;
    var ImageDimensions = /** @class */ (function () {
        function ImageDimensions(src, width, height, invalid) {
            this.src = src;
            this.width = width;
            this.height = height;
            this.invalid = invalid;
        }
        return ImageDimensions;
    }());
    Editor.ImageDimensions = ImageDimensions;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var VideoBlockProvider = /** @class */ (function () {
        function VideoBlockProvider(lookupField, executionContext) {
            this.lookupField = lookupField;
            this.executionContext = executionContext;
        }
        VideoBlockProvider.prototype.getLookupField = function () {
            return this.lookupField;
        };
        VideoBlockProvider.prototype.getLogger = function () {
            return this.getExecutionContext().getLogger();
        };
        VideoBlockProvider.prototype.getExecutionContext = function () {
            return this.executionContext;
        };
        VideoBlockProvider.EntityName = "msdyncrm_video";
        return VideoBlockProvider;
    }());
    Editor.VideoBlockProvider = VideoBlockProvider;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
/// <reference path="../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var RandomImagePicker = /** @class */ (function () {
        /**
         * Initializes a new instance of ImagePickerCustomControl
         */
        function RandomImagePicker() {
            this.imagePickerId = MktSvc.Controls.Common.UniqueId.generate();
        }
        /**
         * Configure the ImagePickerCustomControl with the event broker.
         * @param emailEventBroker The email Event Broker
         */
        RandomImagePicker.prototype.setup = function (emailEventBroker) {
            this.emailEventBroker = emailEventBroker;
        };
        /**
         * Selects a new image.
         */
        RandomImagePicker.prototype.open = function (containerId) {
            this.galleryControlCallback(this.getNewImageSource());
        };
        RandomImagePicker.prototype.getId = function () {
            return this.imagePickerId;
        };
        RandomImagePicker.prototype.dispose = function () { };
        /**
         * The callback that notifies Email Editor the image from the gallery was selected
         * @param imageUrl The image URL returned by the image picker
         */
        RandomImagePicker.prototype.galleryControlCallback = function (imageUrl) {
            var eventArgs = new MktSvcCommon.EventArgs.GalleryImageSelectedEventArgs(this.imagePickerId);
            eventArgs.imageUrl = imageUrl;
            this.emailEventBroker.notify(MktSvcCommon.EventConstants.GalleryImageSelected, eventArgs);
        };
        RandomImagePicker.prototype.getNewImageSource = function () {
            var imgSources = [
                "https://c.s-microsoft.com/da-dk/CMSImages/MMD_Lumia950Hol_1127_540x304_EN_US.jpg?version=1cf993b2-dcfb-fde5-9910-40d857d2bab5",
                "https://c.s-microsoft.com/en-gb/CMSImages/WinPCs_3rdParty_1201_540x304_EN_US.jpg?version=cbda645e-081d-2a1e-4259-13b337738575",
                "https://c.s-microsoft.com/da-dk/CMSImages/OFC_OutlookRefreshBG_1201_540x304_EN_US.jpg?version=6b0ffa34-7f6a-678e-8e3f-797cfbbd7254",
                "https://c.s-microsoft.com/da-dk/CMSImages/Apps_Edge_0729_540x304_EN_US.jpg?version=d8aba226-9774-3d28-4191-0730f4b8df9f"
            ];
            this.lastSelectedImageIndex = this.getRandomIndexWithoutTheSpecified(imgSources.length - 1, this.lastSelectedImageIndex);
            return imgSources[this.lastSelectedImageIndex];
        };
        RandomImagePicker.prototype.getRandomIndexWithoutTheSpecified = function (maxLength, indexToBeExcluded) {
            var randomIndex = Math.floor(Math.random() * maxLength);
            if (randomIndex === indexToBeExcluded) {
                return this.getRandomIndexWithoutTheSpecified(maxLength, indexToBeExcluded);
            }
            return randomIndex;
        };
        return RandomImagePicker;
    }());
    Editor.RandomImagePicker = RandomImagePicker;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var ContentBlockProvider = /** @class */ (function () {
        function ContentBlockProvider(lookupField, executionContext) {
            this.lookupField = lookupField;
            this.executionContext = executionContext;
        }
        ContentBlockProvider.prototype.getLookupField = function () {
            return this.lookupField;
        };
        ContentBlockProvider.prototype.getLogger = function () {
            return this.getExecutionContext().getLogger();
        };
        ContentBlockProvider.prototype.getExecutionContext = function () {
            return this.executionContext;
        };
        ContentBlockProvider.EntityName = "msdyncrm_contentblock";
        return ContentBlockProvider;
    }());
    Editor.ContentBlockProvider = ContentBlockProvider;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var Editor;
(function (Editor) {
    var BlockUtils;
    (function (BlockUtils) {
        var Utility = MktSvc.Controls.Common.Utility;
        var selectableSelector = "\n            [" + Editor.Contract.blockTypeAttrName + "],\n            [" + Editor.Contract.blockDatatypeAttrName + "],\n            [" + Editor.Contract.subBlockAttrName + "],\n            [" + Editor.Contract.containerAttrName + "],\n            [" + Editor.Contract.dataSectionAttrName + "]\n        ";
        var parentSelector = "\n        [" + Editor.Contract.blockTypeAttrName + "],\n        [" + Editor.Contract.blockDatatypeAttrName + "],\n        [" + Editor.Contract.subBlockAttrName + "],\n        [" + Editor.Contract.dataSectionAttrName + "]\n        ";
        function isSubBlock(blockElement) {
            return blockElement.attr(Editor.Contract.subBlockAttrName) === "true";
        }
        BlockUtils.isSubBlock = isSubBlock;
        function getBlockType(blockElement) {
            if (blockElement == null) {
                return null;
            }
            else if (isSubBlock(blockElement)) {
                return blockElement.attr(Editor.Contract.blockDatatypeAttrName);
            }
            else {
                return blockElement.attr(Editor.Contract.blockTypeAttrName);
            }
        }
        BlockUtils.getBlockType = getBlockType;
        function determineSelectableType(block) {
            var subBlock = block.attr(Editor.Contract.subBlockAttrName);
            var section = block.attr(Editor.Contract.dataSectionAttrName);
            var container = block.attr(Editor.Contract.containerAttrName);
            if (block.attr(Editor.Contract.blockTypeAttrName) != null && block.attr(Editor.Contract.blockTypeAttrName) !== "") {
                return Editor.BlockConstants.SelectableType.block;
            }
            else if (subBlock && subBlock.toLowerCase() === "true") {
                return Editor.BlockConstants.SelectableType.subBlock;
            }
            else if (container && container.toLowerCase() === "true") {
                return Editor.BlockConstants.SelectableType.container;
            }
            else if (section && section.toLowerCase() === "true") {
                return Editor.BlockConstants.SelectableType.section;
            }
            else {
                return Editor.BlockConstants.SelectableType.none;
            }
        }
        BlockUtils.determineSelectableType = determineSelectableType;
        function getClosestSubBlock(block) {
            return block.closest("[" + Editor.Contract.subBlockAttrName + "]");
        }
        BlockUtils.getClosestSubBlock = getClosestSubBlock;
        function getClosestBlock(block) {
            return block.closest("[" + Editor.Contract.blockTypeAttrName + "]");
        }
        BlockUtils.getClosestBlock = getClosestBlock;
        function getClosestContainer(block) {
            return block.closest("[" + Editor.Contract.containerAttrName + "]", block.closest("[" + Editor.Contract.dataSectionAttrName + "]")[0]);
        }
        BlockUtils.getClosestContainer = getClosestContainer;
        function getClosestSection(block) {
            return block.closest("[" + Editor.Contract.dataSectionAttrName + "]");
        }
        BlockUtils.getClosestSection = getClosestSection;
        function getParentElement(block, attributeName) {
            return block.parents("[" + attributeName + "]");
        }
        BlockUtils.getParentElement = getParentElement;
        function getParentSection(block) {
            if (Utility.isNullOrUndefined(block)) {
                return null;
            }
            var parent = block;
            while (parent && parent.getAttribute(Editor.Contract.dataSectionAttrName) !== "true") {
                parent = parent.parentElement;
            }
            return parent || block;
        }
        BlockUtils.getParentSection = getParentSection;
        function getClosestBlockOrSubBlock(block) {
            return block.closest("[" + Editor.Contract.blockTypeAttrName + "],[" + Editor.Contract.blockDatatypeAttrName + "]");
        }
        BlockUtils.getClosestBlockOrSubBlock = getClosestBlockOrSubBlock;
        function getClosestSelectableItem(block) {
            return block.closest(selectableSelector);
        }
        BlockUtils.getClosestSelectableItem = getClosestSelectableItem;
        function getFurthestSelectableItem(block) {
            var furthestParent = block.parents(parentSelector).last();
            if (furthestParent.length > 0) {
                return furthestParent.last();
            }
            return block;
        }
        BlockUtils.getFurthestSelectableItem = getFurthestSelectableItem;
        function hasParentSelectable(block) {
            return !getFurthestSelectableItem(block).is(block);
        }
        BlockUtils.hasParentSelectable = hasParentSelectable;
        function getAllSubBlocks(block) {
            return block.find("[" + Editor.Contract.subBlockAttrName + "=\"true\"]");
        }
        BlockUtils.getAllSubBlocks = getAllSubBlocks;
        function getAllContainers(block) {
            return block.find("[" + Editor.Contract.containerAttrName + "=\"true\"]");
        }
        BlockUtils.getAllContainers = getAllContainers;
        function getAllSections(block) {
            return block.find("[" + Editor.Contract.dataSectionAttrName + "=\"true\"]");
        }
        BlockUtils.getAllSections = getAllSections;
        function isProtected(block) {
            var dataEditorBlockType = block.closest("[" + Editor.Contract.blockTypeAttrName + "]");
            var dataProtectedAttributeValue = dataEditorBlockType.attr(Editor.Contract.dataProtectedAttribute);
            return (dataEditorBlockType.length > 0 &&
                dataProtectedAttributeValue &&
                dataProtectedAttributeValue.toLowerCase() === "true");
        }
        BlockUtils.isProtected = isProtected;
    })(BlockUtils = Editor.BlockUtils || (Editor.BlockUtils = {}));
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/// <reference path="../../CommonReferences.ts" />
var Editor;
(function (Editor) {
    var ContentBlockTool = /** @class */ (function () {
        function ContentBlockTool() {
        }
        ContentBlockTool.prototype.getLabel = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.contentBlockTool);
        };
        ContentBlockTool.prototype.getType = function () {
            return Editor.CommonConstants.contentBlockToolType;
        };
        ContentBlockTool.prototype.getContentTransformation = function () {
            return "<div class=\"" + Editor.DetailsViewConstants.contentBlockWrapper + "\"><img src=\"\" /></div>";
        };
        ContentBlockTool.prototype.getTitle = function () {
            return Editor.CommonUtils.getLocalizedString(Editor.DetailsViewConstants.contentBlockTool);
        };
        ContentBlockTool.prototype.getCssClass = function () {
            return Editor.DetailsViewConstants.contentBlockToolCss;
        };
        ContentBlockTool.prototype.getCategory = function () {
            return Editor.ToolCategory.Content;
        };
        return ContentBlockTool;
    }());
    Editor.ContentBlockTool = ContentBlockTool;
})(Editor || (Editor = {}));
/**
 * @license Copyright (c) Microsoft Corporation.  All rights reserved.
 */
//# sourceMappingURL=Editor.js.map