var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){Dashboard.BORDER_WIDTH=1,Dashboard.BORDER_TOP_WIDTH=3,Dashboard.BASE_STYLE=void 0,Dashboard.NO_STYLE=null;var DashboardStyling=function(){function DashboardStyling(parent){this._baseStyle=null,this.parent=parent}return Object.defineProperty(DashboardStyling.prototype,"baseStyle",{get:function(){return this._baseStyle||(this._baseStyle={dashboard:{flex:"1 1 auto",marginBottom:function(){return this.isMobile?this.parent.context.theming.measures.measure025:this.parent.context.theming.measures.measure075},marginTop:function(){return this.isMobile?this.parent.context.theming.measures.measure100:this.parent.context.theming.measures.measure150},marginLeft:function(){return this.isMobile?"0px":this.parent.context.theming.measures.measure150},maxWidth:function(){return this.parent.context.parameters.value.Width-DashboardStyling.convertFromRemToPixelValue(this.isMobile?"0px":this.parent.context.theming.measures.measure150)+"px"}},tabs:{container:{flexDirection:"column",width:"100%",flex:function(){return this.parameters.height?Dashboard.BASE_STYLE:"0 0 auto"}},columns:{column:{flexDirection:"column",flex:function(){return this.parameters.columnHeight?Dashboard.BASE_STYLE:"0 0 auto"},width:function(){return this.parameters.column.Width},minHeight:function(){return this.parameters.columnHeight+"px"}},container:{flexDirection:"row",width:"100%",flex:function(){return this.parameters.tabHeight?Dashboard.BASE_STYLE:"0 0 auto"},minHeight:function(){return this.parameters.height+DashboardStyling.convertFromRemToPixelValue(this.isMobile?this.parent.context.theming.measures.measure025:this.parent.context.theming.measures.measure075)+"px"}}},tab:{flexDirection:"column",width:"100%",flex:function(){return this.parameters.tabHeight?Dashboard.BASE_STYLE:"0 0 auto"},display:function(){return this.parameters.hidden?"none":Dashboard.BASE_STYLE},minHeight:function(){return this.parameters.tabHeight+DashboardStyling.convertFromRemToPixelValue(this.isMobile?this.parent.context.theming.measures.measure025:"0")+"px"}}},sections:{section:{flexDirection:"column",width:"100%",flex:function(){return this.parameters.isAutoHeight?Dashboard.BASE_STYLE:this.parameters.controlCount+" "+this.parameters.controlCount+" "+this.parameters.controlCount*this.rowHeight+"px"},minHeight:function(){return this.parameters.height+"px"},display:function(){return this.parameters.hidden?"none":Dashboard.BASE_STYLE}}},row:{flexDirection:"row",flex:function(){return this.parameters.isAutoHeight?"1 1 auto":"1 1 "+this.rowHeight+"px"},width:"100%",pointerEvents:"none",minHeight:function(){return this.parameters.isAutoHeight?Dashboard.BASE_STYLE:this.rowHeight+"px"},maxHeight:function(){return this.parameters.isAutoHeight?Dashboard.BASE_STYLE:this.rowHeight+"px"}},cell:{outer:{flex:function(){return this.parameters.control.colSpan+" "+this.parameters.control.colSpan+" "+this.parameters.control.colSpan+"px"},maxWidth:function(){return this.parameters.cellSize?this.parameters.cellSize.maxWidth:Math.min(100,this.parameters.control.colSpan/this.parameters.columns*100)+"%"},pointerEvents:"auto",display:function(){return this.parent.layout.isCellComponentHidden(this.parameters.componentKey,this.parameters.borderContainers)?"none":Dashboard.BASE_STYLE},width:function(){return this.parameters.cellSize&&this.parameters.cellSize.width?Dashboard.BASE_STYLE:Math.min(100,this.parameters.control.colSpan/this.parameters.columns*100)+"%"},minHeight:function(){return this.parameters.isRowAutoHeight?Dashboard.BASE_STYLE:this.parameters.control.rowSpan*this.rowHeight+"px"}},inner:{backgroundColor:this.parent.context.theming.colors.base.white,marginBottom:function(){return this.hideControlBorder?"0px":this.isMobile?this.parent.context.theming.measures.measure100:this.parent.context.theming.measures.measure150},marginRight:function(){return this.isMobile?"0px":this.parent.context.theming.measures.measure150},borderStyle:function(){return this.hideControlBorder?this.parent.context.theming.noneborderstyle:"solid"},borderLeftColor:this.parent.context.theming.colors.grays.gray03,borderRightColor:this.parent.context.theming.colors.grays.gray03,borderBottomColor:this.parent.context.theming.colors.grays.gray03,borderTopColor:this.parent.context.theming.colors.maintheme.maincolor1.fill,borderLeftWidth:function(){return this.isMobile?"0px":Dashboard.BORDER_WIDTH},borderRightWidth:function(){return this.isMobile?"0px":Dashboard.BORDER_WIDTH},borderBottomWidth:Dashboard.BORDER_WIDTH,borderTopWidth:function(){return Dashboard.BORDER_TOP_WIDTH+"px"},overflow:"hidden",flex:"1 1 auto",width:"100%",display:"flex",paddingRight:function(){return this.hideControlBorder?"0px":this.parent.context.theming.measures.measure100},paddingLeft:function(){return this.hideControlBorder?"0px":this.parent.context.theming.measures.measure100}}}}),this._baseStyle},enumerable:!0,configurable:!0}),Object.defineProperty(DashboardStyling.prototype,"overrideBaseStyles",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(DashboardStyling.prototype,"isMobile",{get:function(){return this.parent.context.parameters.value.Width<=+this.parent.context.theming.breakpoints.dimensions},enumerable:!0,configurable:!0}),Object.defineProperty(DashboardStyling.prototype,"isMailApp",{get:function(){var contexts=this.parent.context.externalContext&&this.parent.context.externalContext.getAvailableExternalContexts();return!(!contexts||!contexts.get("MAIL_CONTEXT"))},enumerable:!0,configurable:!0}),Object.defineProperty(DashboardStyling.prototype,"hideControlBorder",{get:function(){return this.parent.context.parameters.value.FormDescriptor.Controls[this.parameters.control.id]&&"false"===this.parent.context.parameters.value.FormDescriptor.Controls[this.parameters.control.id].Parameters.Border&&this.isMailApp},enumerable:!0,configurable:!0}),Object.defineProperty(DashboardStyling.prototype,"rowHeight",{get:function(){return this.parent.layout.getRowHeight(this.parameters.section)},enumerable:!0,configurable:!0}),DashboardStyling.convertFromRemToPixelValue=function(remValue){var remToPixelRatio=parseFloat(window.getComputedStyle(document.documentElement).fontSize);return remToPixelRatio*parseFloat(remValue)},DashboardStyling.prototype.applyStyling=function(baseStyle,overrideBaseStyle){var computedBaseStyle=this.computeStyling(baseStyle),computedOverrideBaseStyle=this.computeStyling(overrideBaseStyle);return overrideBaseStyle?Object.assign({},computedBaseStyle,computedOverrideBaseStyle):computedBaseStyle},DashboardStyling.prototype.computeStyling=function(style){if(style){var properties=Object.getOwnPropertyNames(style).filter(function(prop){return"function"==typeof style[prop]});if(properties.length>0){for(var computedStyle=Object.assign({},style),_i=0,properties_1=properties;_i<properties_1.length;_i++){var key=properties_1[_i],value=style[key].bind(this)();value!==Dashboard.BASE_STYLE?computedStyle[key]=value:delete computedStyle[key]}return computedStyle}}return style},DashboardStyling.prototype.getDashboardContainerStyle=function(){return this.applyStyling(this.baseStyle.dashboard,this.overrideBaseStyles&&this.overrideBaseStyles.dashboard)},DashboardStyling.prototype.getTabContainerStyle=function(height){return this.parameters={height:height},this.applyStyling(this.baseStyle.tabs.container,this.overrideBaseStyles&&this.overrideBaseStyles.tabs&&this.overrideBaseStyles.tabs.container)},DashboardStyling.prototype.getTabColumnStyle=function(columnHeight,column,layoutType){return this.parameters={columnHeight:columnHeight,column:column,layoutType:layoutType},this.applyStyling(this.baseStyle.tabs.columns.column,this.overrideBaseStyles&&this.overrideBaseStyles.tabs&&this.overrideBaseStyles.tabs.columns&&this.overrideBaseStyles.tabs.columns.column)},DashboardStyling.prototype.getTabColumnContainerStyle=function(tabHeight,tab,layoutType){return this.parameters={tabHeight:tabHeight,tab:tab,layoutType:layoutType},this.applyStyling(this.baseStyle.tabs.columns.container,this.overrideBaseStyles&&this.overrideBaseStyles.tabs&&this.overrideBaseStyles.tabs.columns&&this.overrideBaseStyles.tabs.columns.container)},DashboardStyling.prototype.getTabStyle=function(tabHeight,tab,layoutType){return this.parameters={tabHeight:tabHeight,tab:tab,layoutType:layoutType},this.applyStyling(this.baseStyle.tabs.tab,this.overrideBaseStyles&&this.overrideBaseStyles.tabs&&this.overrideBaseStyles.tabs.tab)},DashboardStyling.prototype.getSectionStyle=function(section,hidden,isAutoHeight,controlCount,height,layoutType){return this.parameters={section:section,hidden:hidden,isAutoHeight:isAutoHeight,controlCount:controlCount,height:height,layoutType:layoutType},this.applyStyling(this.baseStyle.sections.section,this.overrideBaseStyles&&this.overrideBaseStyles.sections&&this.overrideBaseStyles.sections.section)},DashboardStyling.prototype.getRowStyle=function(section,isAutoHeight){return this.parameters={section:section,isAutoHeight:isAutoHeight},this.applyStyling(this.baseStyle.row,this.overrideBaseStyles&&this.overrideBaseStyles.row)},DashboardStyling.prototype.getCellOuterStyle=function(section,control,columns,componentKey,borderContainers,isRowAutoHeight,layoutType){var cellSize=this.parent.layout.getCellComponentSize(componentKey,section,control);return this.parameters={section:section,control:control,columns:columns,componentKey:componentKey,borderContainers:borderContainers,isRowAutoHeight:isRowAutoHeight,layoutType:layoutType,cellSize:cellSize},this.applyStyling(this.applyStyling(this.parameters.cellSize,this.baseStyle.cell.outer),this.overrideBaseStyles&&this.overrideBaseStyles.cell&&this.overrideBaseStyles.cell.outer)},DashboardStyling.prototype.getCellInnerStyle=function(section,control,component,componentKey){return this.parameters={section:section,control:control,component:component,componentKey:componentKey},this.applyStyling(this.baseStyle.cell.inner,this.overrideBaseStyles&&this.overrideBaseStyles.cell&&this.overrideBaseStyles.cell.inner)},DashboardStyling}();Dashboard.DashboardStyling=DashboardStyling}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){var POWER_BI_STYLE={tabs:{container:{flex:"1 1 auto"},columns:{column:{flex:"1 1 auto"},container:{flex:"1 1 auto"}},tab:{flex:"1 1 auto"}},sections:{section:{flex:"1 1 auto"}},row:{flex:"1 1 auto",minHeight:void 0,maxHeight:void 0},cell:{outer:{flex:"1 1 auto",minHeight:void 0}}},PowerBIDashboardStyling=function(_super){function PowerBIDashboardStyling(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(PowerBIDashboardStyling,_super),Object.defineProperty(PowerBIDashboardStyling.prototype,"overrideBaseStyles",{get:function(){return POWER_BI_STYLE},enumerable:!0,configurable:!0}),PowerBIDashboardStyling}(Dashboard.DashboardStyling);Dashboard.PowerBIDashboardStyling=PowerBIDashboardStyling}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){"use strict";var TraceLevel;!function(TraceLevel){TraceLevel[TraceLevel.Off=0]="Off",TraceLevel[TraceLevel.Error=1]="Error",TraceLevel[TraceLevel.Warning=2]="Warning",TraceLevel[TraceLevel.Perf=3]="Perf",TraceLevel[TraceLevel.Info=4]="Info",TraceLevel[TraceLevel.Verbose=5]="Verbose"}(TraceLevel||(TraceLevel={}));var TELEMETRY_COMPONENT="MscrmControls.Containers.DashboardControl",TelemetryReporter=function(){function TelemetryReporter(dashboard,eventName){void 0===eventName&&(eventName="uci_dashboard_load"),this.timeOnDashboardStart=0,this._createdControls={},this.hasReportedLoadEvent=!1,this._dashboard=dashboard,this._eventName=eventName}return TelemetryReporter.prototype.dashboardLoaded=function(dashboardId){if(!this.hasReportedLoadEvent){var loadEvent={eventName:this._eventName,eventParameters:[{name:"DashboardId",value:dashboardId&&dashboardId.guid}]};for(var controlType in this._createdControls){var count=this._createdControls[controlType];loadEvent.eventParameters.push({name:controlType+"s",value:count})}this._dashboard.context.reporting.reportEvent(loadEvent),this.hasReportedLoadEvent=!0}},TelemetryReporter.prototype.startTimeOnDashboard=function(){this.timeOnDashboardStart=(new Date).getTime()},TelemetryReporter.prototype.endTimeOnDashboard=function(dashboardId){var timeOnDashboard=(new Date).getTime()-this.timeOnDashboardStart,timeOnDashboardEvent={eventName:"uci_dashboard_time",eventParameters:[{name:"DashboardId",value:dashboardId&&dashboardId.guid},{name:"Time",value:timeOnDashboard}]};this._dashboard.context.reporting.reportEvent(timeOnDashboardEvent)},TelemetryReporter.prototype.startReflow=function(){this.reflow||(this.reflow=this._dashboard.context.utils.createPerformanceStopwatch("dashboard.reflow")),this.reflow.start()},TelemetryReporter.prototype.endReflow=function(){this.reflow.stop()},TelemetryReporter.prototype.unknownControlType=function(type){this.createdControl("UnknownControl"),this._dashboard.context.utils.log("dashboard","Unknown Control: "+type,TraceLevel.Warning)},TelemetryReporter.prototype.unknownChartGridMode=function(chartGridMode){this.createdControl("UnknownControl"),this._dashboard.context.utils.log("dashboard","Unknown ChartGridMode: "+chartGridMode,TraceLevel.Warning)},TelemetryReporter.prototype.createdControl=function(type){var currentCount=this._createdControls[type];this._createdControls[type]=currentCount?currentCount+1:1},TelemetryReporter.prototype.reportSuccess=function(){this._dashboard.context.reporting.reportSuccess(TELEMETRY_COMPONENT,this._slaParameters)},TelemetryReporter.prototype.reportFailure=function(error){this._dashboard.context.reporting.reportFailure(TELEMETRY_COMPONENT,error,void 0,this._slaParameters)},TelemetryReporter.prototype.startSLAReport=function(){this._slaParameters=[]},TelemetryReporter.prototype.addSLAParameter=function(name,value){this._slaParameters.push({name:name,value:value})},TelemetryReporter}();Dashboard.TelemetryReporter=TelemetryReporter}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmCommon;!function(MscrmCommon){"use strict"}(MscrmCommon||(MscrmCommon={}));var MscrmCommon;!function(MscrmCommon){"use strict";var EDITABLE_GRID_CONTROL_ID="MscrmControls.Grid.GridControl",DISABLE_EDITABLE_GRID_CONTROL_ON_PHONE_FCB="DisableEditableGridControlOnPhone",ENABLE_EDITING_PARAM_KEY="EnableEditing",ENABLE_EDITING_VALUE_YES="yes",GridHelper=function(){function GridHelper(){}return GridHelper.shouldRenderAsReadOnlyGridOnPhone=function(context,customControlConfiguration,deviceFormFactor){return!!(context.utils.isFeatureEnabled(DISABLE_EDITABLE_GRID_CONTROL_ON_PHONE_FCB)&&3===deviceFormFactor&&customControlConfiguration.Name===EDITABLE_GRID_CONTROL_ID&&customControlConfiguration.Parameters&&customControlConfiguration.Parameters[ENABLE_EDITING_PARAM_KEY]&&customControlConfiguration.Parameters[ENABLE_EDITING_PARAM_KEY].Value&&customControlConfiguration.Parameters[ENABLE_EDITING_PARAM_KEY].Value.toLowerCase()===ENABLE_EDITING_VALUE_YES)},GridHelper}();MscrmCommon.GridHelper=GridHelper}(MscrmCommon||(MscrmCommon={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){"use strict";var UNSUPPORTED_WEB_RESOURCES=["msdyn_/personalwall.htm"],TIMELINE_CONTROL_CLASS_ID="06375649-C143-495E-A496-C962E5B4488E",SOCIAL_INSIGHTS_CLASS_ID="86B9E25E-695E-4FEF-AC69-F05CFA96739C",SOCIAL_INSIGHTS_CONTROL_ID="MscrmControls.SocialInsightsControl.SocialInsightsControl",SOCIAL_INSIGHTS_MANIFEST_TYPE="SocialInsightsControl",SOCIAL_INSIGHTS_FCB="SocialInsightsMapping",READ_ONLY_GRID_CONTROL_ID="MscrmControls.Grid.ReadOnlyGrid",DATA_SET_CONTROLS=[READ_ONLY_GRID_CONTROL_ID,"MscrmControls.Grid.GridControl"],DashboardControlFactory=function(){function DashboardControlFactory(parent,section){this.parent=parent,this.section=section,this.context=parent.context,this.telemetry=parent.telemetry,this.mailAppControlFactory=new Dashboard.MailAppControlFactory(this)}return DashboardControlFactory.prototype.create=function(cell){var control=this.context.parameters.value.FormDescriptor.Controls[cell.ControlName];if(control){var factory=this.getChildControlFactory(control),components=factory.call(this,control);return components}},DashboardControlFactory.prototype.getControlCount=function(){var controls=this.context.parameters.value.FormDescriptor.Controls,count=Object.keys(controls).length;for(var key in controls){var control=controls[key];(!control.Parameters||this.isWebResourceControl(control)&&!this._isSupportedWebResource(control)||this.isControlEntityUnsupported(control))&&count--}return count},DashboardControlFactory.prototype.isControlEntityUnsupported=function(control){return!!(control&&control.Id&&this.parent.forbiddenUCIControlList&&-1!==this.parent.forbiddenUCIControlList.indexOf(control.Id))},DashboardControlFactory.prototype.getCustomControlConfiguration=function(control){if(control.UniqueId&&this.context.parameters.value.FormDescriptor.ControlConfigurations&&this.context.parameters.value.FormDescriptor.ControlConfigurations[control.UniqueId]&&this.context.parameters.value.FormDescriptor.ControlConfigurations[control.UniqueId].CustomControls){var clientApiFormFactor=this.context.client.getFormFactor(),configuration=this.context.parameters.value.FormDescriptor.ControlConfigurations[control.UniqueId].CustomControls[clientApiFormFactor];if(configuration&&!MscrmCommon.GridHelper.shouldRenderAsReadOnlyGridOnPhone(this.context,configuration,clientApiFormFactor))return configuration}return null},DashboardControlFactory.prototype.getChildControlFactory=function(control){if(this.getCustomControlConfiguration(control)){var createMailAppControl=this.mailAppControlFactory.getMailAppControlFactory(control);return createMailAppControl?createMailAppControl.bind(this.mailAppControlFactory):this.createCustomControl}return control.Parameters.ChartGridMode?"Chart"===control.Parameters.ChartGridMode?this.createChartControl:"Grid"===control.Parameters.ChartGridMode||"All"===control.Parameters.ChartGridMode?this.createGridControl:this.createDummyControl:this.isWebResourceControl(control)?this.createIFrameOrWebResourceControl:control.Parameters.PowerBIDashboardId?this.createPowerBIControl:control.ClassId.guid.toUpperCase()===TIMELINE_CONTROL_CLASS_ID?this.createTimelineWallControl:control.ClassId.guid.toUpperCase()===SOCIAL_INSIGHTS_CLASS_ID&&this.context.utils.isFeatureEnabled(SOCIAL_INSIGHTS_FCB)?this.createSocialInsightsControl:this.createDummyControl},DashboardControlFactory.prototype.isWebResourceControl=function(control){return!!control.Parameters.Url},DashboardControlFactory.prototype.getEventListeners=function(control){var eventListeners=[this.parent.getOnParametersUpdated(control.Name)];return eventListeners},DashboardControlFactory.prototype.getControlParameters=function(control,extraParameters,isDataSetHost,controlName,hasNestedParameters){void 0===isDataSetHost&&(isDataSetHost=!1),void 0===hasNestedParameters&&(hasNestedParameters=!1);var parameters=Object.assign({},control.Parameters);controlName=controlName||control.Name;var updatedParameters=this.context.parameters.value.UpdatedControlParameters&&this.context.parameters.value.UpdatedControlParameters[controlName];if(isDataSetHost){var dataSetHostProps=parameters,dataSetParameters_1=parameters;"boolean"!=typeof isDataSetHost&&(isDataSetHost.dataSetName&&(parameters.hasOwnProperty(isDataSetHost.dataSetName)||(parameters[isDataSetHost.dataSetName]={}),dataSetHostProps=parameters[isDataSetHost.dataSetName]),dataSetParameters_1=isDataSetHost.dataSetParameters);var getDataSetHostParameter=function(parameter){return updatedParameters&&updatedParameters.hasOwnProperty(parameter)?updatedParameters[parameter]:dataSetParameters_1[parameter]},getDataSetUIOption=function(option){return!dataSetParameters_1.hasOwnProperty(option)||dataSetParameters_1[option]},visualizationId=getDataSetHostParameter("VisualizationId"),chartGridMode=getDataSetHostParameter("ChartGridMode"),isUserChart=getDataSetHostParameter("IsUserChart"),enableChartPicker=getDataSetHostParameter("EnableChartPicker"),displayChart=getDataSetUIOption("displayChart"),displayCommandBar=getDataSetUIOption("displayCommandBar"),displayIndex=getDataSetUIOption("displayIndex"),displayQuickFind=getDataSetUIOption("displayQuickFind"),displayViewSelector=getDataSetUIOption("displayViewSelector"),displayPaging=getDataSetUIOption("displayPaging");Object.assign(dataSetHostProps,{ChartGridMode:chartGridMode,VisualizationId:visualizationId,IsUserChart:isUserChart,EnableChartPicker:enableChartPicker,CommandBarContext:"grid",DataSetUIOptions:{displayChart:displayChart,displayCommandBar:displayCommandBar,displayIndex:displayIndex,displayQuickFind:displayQuickFind,displayViewSelector:displayViewSelector,displayPaging:displayPaging}})}if(extraParameters)if(hasNestedParameters)for(var _i=0,_a=Object.keys(extraParameters);_i<_a.length;_i++){var extraParameterName=_a[_i];parameters.hasOwnProperty(extraParameterName)||(parameters[extraParameterName]={}),parameters[extraParameterName]=Object.assign(parameters[extraParameterName],extraParameters[extraParameterName])}else parameters=Object.assign(parameters,extraParameters);if(updatedParameters&&(parameters=Object.assign(parameters,updatedParameters)),this.context.parameters.value.RefreshCounters&&this.context.parameters.value.RefreshCounters.hasOwnProperty(controlName))if(hasNestedParameters)for(var key in parameters){var params=parameters[key];if("Grid"===params.Type){parameters[key].RefreshInput={Static:!0,Value:this.context.parameters.value.RefreshCounters[controlName]};break}}else parameters.RefreshInput={Static:!0,Value:this.context.parameters.value.RefreshCounters[controlName]};return parameters},DashboardControlFactory.prototype.createControl=function(componentName,control,properties,setWidth,setHeight,manifestName){var _this=this;return void 0===setWidth&&(setWidth=!1),void 0===setHeight&&(setHeight=!1),Object.assign(function(width,height){properties.childeventlisteners=_this.getEventListeners(control),properties.key=_this.section.Id.guid+"_"+control.Id,properties.id=_this.section.Id.guid+"_"+control.Id,properties.descriptor=control,(setWidth||setHeight)&&(properties.controlstates=Object.assign(properties.controlstates||{},{width:setWidth?-1===width?width:width-2*Dashboard.DashboardStyling.convertFromRemToPixelValue(_this.context.theming.measures.measure100):void 0,height:setHeight?height:void 0}));var component=_this.context.factory.createComponent(componentName,control.Id,properties);return component},{manifestName:manifestName||componentName})},DashboardControlFactory.prototype.createTimelineWallControl=function(control){this.telemetry.createdControl("TimelineWall");var properties={parameters:{value:{LableId:control.LabelId}},descriptor:control},componentName="MscrmControls.TimelineWallControl.TimelineWall";return properties.parameters.value.Type="TimelineWall",properties.parameters.value.ContextType="Personal",this.createControl(componentName,control,properties,!0,!0)},DashboardControlFactory.prototype.createChartControl=function(control){if(!this.isControlEntityUnsupported(control)){var _a=this.getChartControlProperties(control),properties=_a.properties,setWidth=_a.setWidth,setHeight=_a.setHeight,componentName="MscrmControls.Chart.ChartControl";return this.telemetry.createdControl("Chart"),this.createControl(componentName,control,properties,setWidth,setHeight)}},DashboardControlFactory.prototype.getChartControlProperties=function(control){var chartSelectorModeValue="",viewSelectorModeValue="";this.context.utils.isFeatureEnabled("Client.Chart.ChartOnForm")?(chartSelectorModeValue=control.Parameters&&control.Parameters.EnableChartPicker&&"true"===control.Parameters.EnableChartPicker?"ChartSelector":"ChartTitle",viewSelectorModeValue=control.Parameters&&control.Parameters.EnableViewPicker&&"true"===control.Parameters.EnableViewPicker?"ViewSelector":"ViewTitle"):(chartSelectorModeValue="ChartSelector",viewSelectorModeValue="No");var properties={parameters:{ChartDataSet:this.getControlParameters(control,{FirstDataRequestType:2,Type:"Grid"}),Parent:{Type:"SingleLine.Text",Primary:!1,Static:!0,Usage:1,Value:"UnboundDashboard"},ChartSelectorMode:{Type:"Enum",Primary:!1,Static:!0,Usage:1,Value:chartSelectorModeValue},ViewSelectorMode:{Type:"Enum",Primary:!1,Static:!0,Usage:1,Value:viewSelectorModeValue},CommandMode:{Type:"Enum",Primary:!1,Static:!0,Usage:1,Value:"FormChartCommand"},EnableExpandButton:{Type:"Enum",Primary:!1,Static:!0,Usage:1,Value:"Yes"}}};return{properties:properties,setWidth:!0,setHeight:!0}},DashboardControlFactory.prototype.getDataSetColumns=function(controlName){var dashboardId=this.parent.getDashboardId(),extendedControlName=controlName+":"+dashboardId.guid,dataSetColumns=this.context.parameters.value.DataSetColumns;return dataSetColumns&&dataSetColumns[extendedControlName]},DashboardControlFactory.prototype.createGridControl=function(control){if(!this.isControlEntityUnsupported(control)){var properties={parameters:{Grid:this.getControlParameters(control,{FirstDataRequestType:1,Columns:this.getDataSetColumns(control.Name),Type:"Grid"},!0),EnableEditing:{Usage:1,Static:!0,Type:"Enum",Value:"No",Primary:!1},EnableGroupBy:{Usage:1,Static:!0,Type:"Enum",Value:"No",Primary:!1},EnableFiltering:{Usage:1,Static:!0,Type:"Enum",Value:"No",Primary:!1}},descriptor:control,controlstates:this._getGridControlStates(),contextString:"subgrid"},componentName=READ_ONLY_GRID_CONTROL_ID;return this.telemetry.createdControl("Grid"),this._updatePropertiesForGridMultipleScroll(properties),this.createControl(componentName,control,properties,!0,!0)}},DashboardControlFactory.prototype.createIFrameOrWebResourceControl=function(control){var componentName=null,url=control.Parameters.Url;url=url.toLowerCase();for(var controlParameters={border:"",security:""},_i=0,_a=Object.keys(control.Parameters);_i<_a.length;_i++){var key=_a[_i];controlParameters[(key[0]||"").toLowerCase()+key.substr(1)]=control.Parameters[key]}var properties={parameters:{value:this.getControlParameters(control,{ControlId:this.section.Id.guid+"_"+control.Id,Title:componentName,ShowLabel:!!control.ShowLabel,Label:control.ShowLabel?control.Label:null,Visible:control.Visible,ControlParameters:controlParameters,Type:"WebResource.HTML"})},descriptor:control},protocolSeparator=url.indexOf(":"),protocol=-1!=protocolSeparator?url.substr(0,protocolSeparator):null;return this._isIFrameWebResource(protocol)?(componentName="MscrmControls.WebResource.WebResourceHtmlControl",this.telemetry.createdControl("IFrame")):this._isSupportedWebResource(control)&&(componentName="MscrmControls.WebResource.WebResourceHtmlControl",this.telemetry.createdControl("WebResource")),componentName?this.createControl(componentName,control,properties,!0,!0):void 0},DashboardControlFactory.prototype._isSupportedWebResource=function(control){var url=control.Parameters.Url.toLowerCase(),protocolSeparator=url.indexOf(":"),protocol=-1!==protocolSeparator?url.substr(0,protocolSeparator):null;if(!this._isIFrameWebResource(protocol))for(var key in UNSUPPORTED_WEB_RESOURCES){var unsupportedWebResource=UNSUPPORTED_WEB_RESOURCES[key];if(url.length>=unsupportedWebResource.length&&url.length-unsupportedWebResource.length===url.lastIndexOf(unsupportedWebResource))return!1}return!0},DashboardControlFactory.prototype._isIFrameWebResource=function(protocol){switch(protocol){case"http":case"https":case"ftp":case"ftps":case"onenote":case"tel":return!0}return!1},DashboardControlFactory.prototype.createPowerBIControl=function(control){var properties={parameters:{value:this.getControlParameters(control,{ControlId:this.section.Id.guid+"_"+control.Id,EnableInMobile:!!control.Parameters.EnableInMobile&&"true"===control.Parameters.EnableInMobile.toLowerCase(),PowerBIType:control.Parameters.Type?parseInt(control.Parameters.Type):0})},descriptor:control},componentName="MscrmControls.PowerBI.PowerBIControl";return properties.parameters.value.Type="PowerBI",this.telemetry.createdControl("PowerBI"),this.createControl(componentName,control,properties)},DashboardControlFactory.prototype.createSocialInsightsControl=function(control){var properties={parameters:{value:{Type:SOCIAL_INSIGHTS_MANIFEST_TYPE,Primary:!0}},descriptor:control};return this.telemetry.createdControl("SocialInsight"),this.createControl(SOCIAL_INSIGHTS_CONTROL_ID,control,properties)},DashboardControlFactory.prototype.createDummyControl=function(control){control&&control.Parameters&&control.Parameters.ChartGridMode?this.telemetry.unknownChartGridMode(control.Parameters.ChartGridMode):this.telemetry.unknownControlType(control.ClassId);var properties={parameters:{value:{type:control.ClassId}}};return this.createControl("MscrmControls.FieldControls.DummyControl",control,properties)},DashboardControlFactory.prototype.createCustomControl=function(control){if(!this.isControlEntityUnsupported(control)){var configuration=this.getCustomControlConfiguration(control),isReadOnlyGrid=configuration.Name===READ_ONLY_GRID_CONTROL_ID,isDataSetHost=-1!==DATA_SET_CONTROLS.indexOf(configuration.Name),properties={configuration:Object.assign({},configuration,{Parameters:this.getControlParameters(configuration,isReadOnlyGrid?{Grid:{FirstDataRequestType:1,Columns:this.getDataSetColumns(control.Name)}}:null,!!isDataSetHost&&{dataSetName:"Grid",dataSetParameters:control.Parameters},control.Name,!0)}),controlstates:isReadOnlyGrid&&this._getGridControlStates(),descriptor:control};return isDataSetHost&&(properties.contextString="subgrid"),isReadOnlyGrid&&this._updatePropertiesForGridMultipleScroll(properties),this.telemetry.createdControl("CustomControl"),this.createControl(control.UniqueId,control,properties,!1,!1,configuration.Name)}},DashboardControlFactory.prototype._updatePropertiesForGridMultipleScroll=function(properties){this.parent.isTouchDevice()&&(properties.decorators={ClassName:"dashboard-gridScroll",ShowSeeMore:!0})},DashboardControlFactory.prototype._getGridControlStates=function(){return this.context.client&&this.context.client.userAgent&&this.context.client.userAgent.isBrowserIE&&{containerStyleOverrides:{rootContainer:{flex:"1 1 100%"}}}},DashboardControlFactory.prototype.createCustomControlWithProps=function(control,schemaName,baseProps){var configuration=this.getCustomControlConfiguration(control),properties=baseProps;return configuration&&(properties.parameters=Object.assign(configuration.Parameters,properties.parameters)),this.createControl(schemaName,control,properties,!1,!1,configuration.Name)},DashboardControlFactory}();Dashboard.DashboardControlFactory=DashboardControlFactory}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){"use strict";var MAIL_APP_HIDDEN_DATA_CONTROL_UNIQUE_ID="6e87dc1d-5d11-35b4-0a2e-285ed3954d9b",MAIL_APP_RECIPIENTS_TAB_CONTROL_UNIQUE_ID="bbb596e7-c948-465e-88ba-bc044e0afcb6",MAIL_APP_UNKNOWN_RECIPIENT_SUMMARY_CONTROL_UNIQUE_ID="d2c44e0a-dac2-43e4-bc04-3d36d823071b",MAIL_APP_REGARDING_OBJECT_QUICK_FORM_CARD_CONTROL_UNIQUE_ID="01d11971-4733-47f0-8c9d-b9c31f826f82",MAIL_APP_RESOLVED_RECIPIENT_QUICK_FORM_CONTROL_UNIQUE_ID="07495ce9-c23a-47ff-82ea-aca13810ca60",MAIL_APP_RESOLVED_RECIPIENT_QUICK_FORM_CARD_CONTROL_UNIQUE_ID="f5091377-9413-4ade-b6cd-f96e810d8ddf",MAIL_APP_EMAIL_ENGAGEMENT_CONTROL_UNIQUE_ID="4c92d8ff-090a-420c-9238-c558d920f834",MAIL_APP_TRACKBAR_CONTROL_UNIQUE_ID="351e4f22-0823-4558-9e79-f70f7566d81f",MailAppControlFactory=function(){
function MailAppControlFactory(dashboardControlFactory){this._dashboardControlFactory=dashboardControlFactory}return MailAppControlFactory.prototype.getMailAppControlFactory=function(control){switch(control.UniqueId.toLowerCase()){case MAIL_APP_HIDDEN_DATA_CONTROL_UNIQUE_ID:return this.createMailAppHiddenDataControl;case MAIL_APP_RECIPIENTS_TAB_CONTROL_UNIQUE_ID:return this.createMailAppRecipientsTabControl;case MAIL_APP_UNKNOWN_RECIPIENT_SUMMARY_CONTROL_UNIQUE_ID:return this.createMailAppUnknownRecipientSummaryControl;case MAIL_APP_REGARDING_OBJECT_QUICK_FORM_CARD_CONTROL_UNIQUE_ID:return this.createMailAppRegardingObjectQuickCardControl;case MAIL_APP_RESOLVED_RECIPIENT_QUICK_FORM_CONTROL_UNIQUE_ID:return this.createMailAppSelectedRecipientQuickFormControl;case MAIL_APP_RESOLVED_RECIPIENT_QUICK_FORM_CARD_CONTROL_UNIQUE_ID:return this.createMailAppSelectedRecipientQuickFormCardControl;case MAIL_APP_EMAIL_ENGAGEMENT_CONTROL_UNIQUE_ID:return this.createMailAppEmailEngagementControl;case MAIL_APP_TRACKBAR_CONTROL_UNIQUE_ID:return this.createMailAppTrackBarControl;default:return null}},MailAppControlFactory.prototype.getOutputParameter=function(){return{Type:"SingleLine.Text",Primary:!0,Static:!1,Usage:2}},MailAppControlFactory.prototype.getLinkedInputParameter=function(value){return{Type:"SingleLine.Text",Primary:!0,Static:!1,ControlLinked:!0,Usage:1,Value:value,AbsoluteLinkAddress:!0}},MailAppControlFactory.prototype.createMailAppHiddenDataControl=function(control){var properties={parameters:{followedEmailCrmId:this.getOutputParameter()}};return this._dashboardControlFactory.createCustomControlWithProps(control,"MscrmControls.MailApp.MailAppHiddenDataCustomControl",properties)},MailAppControlFactory.prototype.createMailAppRecipientsTabControl=function(control){var properties={parameters:{selectedUnresolvedRecord:this.getOutputParameter(),selectedCrmRecord:this.getOutputParameter()}};return this._dashboardControlFactory.createCustomControlWithProps(control,"MscrmControls.MailApp.MailAppRecipientsTabControl",properties)},MailAppControlFactory.prototype.createMailAppUnknownRecipientSummaryControl=function(control){var properties={parameters:{data:this.getLinkedInputParameter("RecipientsTab.selectedUnresolvedRecord")}};return this._dashboardControlFactory.createCustomControlWithProps(control,"MscrmControls.MailApp.UnknownRecipientSummaryControl",properties)},MailAppControlFactory.prototype.createMailAppQuickFormWrapper=function(control,dataValue){var properties={parameters:{data:this.getLinkedInputParameter(dataValue)}};return this._dashboardControlFactory.createCustomControlWithProps(control,"MscrmControls.Containers.QuickFormWrapper",properties)},MailAppControlFactory.prototype.createMailAppRegardingObjectQuickCardControl=function(control){return this.createMailAppQuickFormWrapper(control,"TrackBar.regardingObject")},MailAppControlFactory.prototype.createMailAppSelectedRecipientQuickFormControl=function(control){return this.createMailAppQuickFormWrapper(control,"RecipientsTab.selectedCrmRecord")},MailAppControlFactory.prototype.createMailAppSelectedRecipientQuickFormCardControl=function(control){return this.createMailAppQuickFormWrapper(control,"RecipientsTab.selectedCrmRecord")},MailAppControlFactory.prototype.createMailAppEmailEngagementControl=function(control){var properties={parameters:{entityId:this.getLinkedInputParameter("HiddenData.followedEmailCrmId")}};return this._dashboardControlFactory.createCustomControlWithProps(control,"MscrmControls.EmailEngagement.EmailView",properties)},MailAppControlFactory.prototype.createMailAppTrackBarControl=function(control){var properties={parameters:{regardingObject:this.getOutputParameter()}};return this._dashboardControlFactory.createCustomControlWithProps(control,"MscrmControls.MailApp.MailAppTrackBarControl",properties)},MailAppControlFactory}();Dashboard.MailAppControlFactory=MailAppControlFactory}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){function chartSkipKeyShortcut(){var skipKeyCode=90,ctrlDown=!1,altDown=!1;document.onkeydown=function(e){if(e.ctrlKey&&(ctrlDown=!0),e.altKey&&(altDown=!0),e.keyCode==skipKeyCode&&ctrlDown&&altDown){var chartContainers=document.getElementsByClassName("Chart.ChartControl");if(chartContainers.length>0)for(var index=0,_loop_1=function(){if($(chartContainers[index]).has(document.activeElement).length>0){var nextContainerIndex_1=index+1==chartContainers.length?0:index+1;return $(chartContainers[nextContainerIndex_1]).attr("tabindex",-1).focus(),$.map(chartContainers,function(container,i){i!=nextContainerIndex_1&&$(container).removeAttr("tabindex").blur()}),"break"}index++};index<chartContainers.length;){var state_1=_loop_1();if("break"===state_1)break}}},document.onkeyup=function(e){e.ctrlKey&&(ctrlDown=!1),e.altKey&&(altDown=!1)}}Dashboard.chartSkipKeyShortcut=chartSkipKeyShortcut}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){var RenderPass,GOLDEN_RATIO=2/(1+Math.sqrt(5));!function(RenderPass){RenderPass[RenderPass.Layout=0]="Layout",RenderPass[RenderPass.All=1]="All"}(RenderPass=Dashboard.RenderPass||(Dashboard.RenderPass={}));var DashboardLayout=function(){function DashboardLayout(parent,getControlFactory){this.columns=-1,this.desiredColumns={},this.headerHeight={},this.renderPass=RenderPass.Layout,this.parent=parent,this.context=parent.context,this.telemetry=parent.telemetry,this._getControlFactory=getControlFactory}return DashboardLayout.prototype.getTabs=function(){return this.context.parameters.value.FormDescriptor.Tabs},DashboardLayout.prototype.getSectionHeader=function(section){return null},DashboardLayout.prototype.isSectionHidden=function(section){return!1},DashboardLayout.prototype.canMemoizeSection=function(section){return!1},DashboardLayout.prototype.getCellComponentKeys=function(){return[""]},DashboardLayout.prototype.isCellComponentHidden=function(componentKey,control){return!1},DashboardLayout.prototype.isCellComponentOnTheDOM=function(control,componentKey){return!0},DashboardLayout.prototype.getHeaderHeight=function(){var singleColumn=1===this.context.parameters.value.Columns?"1":"0";if(!this.headerHeight.hasOwnProperty(singleColumn)){var commandBarHeightInPixel=1===this.context.parameters.value.Columns?0:Dashboard.DashboardStyling.convertFromRemToPixelValue(this.context.theming.measures.measure300),dashboardSelectorHeightInPixel=2*Dashboard.DashboardStyling.convertFromRemToPixelValue(this.context.theming.measures.measure125)+Dashboard.DashboardStyling.convertFromRemToPixelValue(this.context.theming.measures.measure300),dashboardMarginTop=Dashboard.DashboardStyling.convertFromRemToPixelValue(this.context.theming.measures.measure100);this.headerHeight[singleColumn]=commandBarHeightInPixel+dashboardSelectorHeightInPixel+dashboardMarginTop}return this.headerHeight[singleColumn]},DashboardLayout.prototype.shouldControlRender=function(section,control,offset,previousValue,componentKey){if(void 0===previousValue&&(previousValue=void 0),void 0!==previousValue)return previousValue;if("auto"===control.rowHeight)return!0;if(this.parent.memoizedValue.isControlRendered(control.id)||void 0===this.context.parameters.value.ScrollTop)return!0;if(this.renderPass===RenderPass.Layout)return!1;var top=control.row*this.getRowHeight(section)+offset,bottom=top+control.rowSpan*this.getRowHeight(section),viewPortHeight=this.context.parameters.value.DeviceHeight-this.getHeaderHeight(),inViewPort=top>=this.context.parameters.value.ScrollTop&&top<this.context.parameters.value.ScrollTop+viewPortHeight||bottom>=this.context.parameters.value.ScrollTop&&bottom<this.context.parameters.value.ScrollTop+viewPortHeight;return!!(inViewPort||!control.visible&&control.forceRenderIfInvisible)&&this.checkIfMetadataAvailable(control.id)},DashboardLayout.prototype.checkIfMetadataAvailable=function(controlName){var dashboardId=this.parent.getDashboardId(),extendedControlName=controlName+":"+dashboardId.guid;return!this.context.parameters.value.DataSetColumns||!this.context.parameters.value.DataSetColumns.hasOwnProperty(extendedControlName)||null!==this.context.parameters.value.DataSetColumns[extendedControlName]},DashboardLayout.prototype.resetRenderPass=function(){this.renderPass=RenderPass.Layout,this.renderPassMutationObserver&&this.renderPassMutationObserver.disconnect(),this.renderPassMutationObserver=null},DashboardLayout.prototype.nextRenderPass=function(){var _this=this;if(this.renderPass===RenderPass.Layout&&!this.renderPassMutationObserver){var container=document.getElementById("DashboardView");if(!container)return void(this.renderPass=RenderPass.All);this.renderPassMutationObserver=new MutationObserver(function(mutations){_this.renderPass=RenderPass.All,_this.renderPassMutationObserver.disconnect(),_this.renderPassMutationObserver=null,window.setTimeout(function(){return _this.context.utils.requestRender()})}),this.renderPassMutationObserver.observe(container,{childList:!0,subtree:!0})}},DashboardLayout.prototype.controlRendered=function(control,componentKey,outerCell){!outerCell&&this.controlRenderedInternal(control.id,control.component.manifestName)&&this.parent.memoizedValue.areAllControlsRendered()&&this.context.utils.fireEvent("allControlsRendered",{allControlsRendered:!0})},DashboardLayout.prototype.controlRenderedInternal=function(controlId,manifestName){return!this.parent.memoizedValue.isControlRendered(controlId)&&(this.parent.memoizedValue.addRenderedControl(controlId,manifestName),!0)},DashboardLayout.prototype.getCellComponentSize=function(componentKey,section,control){return null},DashboardLayout.prototype.getControlWidth=function(columns,control,section,controlStyle){void 0===controlStyle&&(controlStyle=null),controlStyle||(controlStyle=this.parent.styling.getCellInnerStyle(section,control,null,""));var dashboardStyle=this.parent.styling.getDashboardContainerStyle();return control.colSpan/columns*(this.context.parameters.value.Width-Dashboard.DashboardStyling.convertFromRemToPixelValue(dashboardStyle.marginLeft))-Dashboard.DashboardStyling.convertFromRemToPixelValue(controlStyle.marginRight)},DashboardLayout.prototype.getControlHeight=function(control,section,controlStyle){return void 0===controlStyle&&(controlStyle=null),controlStyle||(controlStyle=this.parent.styling.getCellInnerStyle(section,control,null,"")),control.rowSpan*this.getRowHeight(section)-Dashboard.DashboardStyling.convertFromRemToPixelValue(controlStyle.marginBottom)},DashboardLayout.prototype.getRowHeight=function(section){return DashboardLayout.DEFAULT_ROW_HEIGHT},DashboardLayout.prototype.getSectionHeight=function(section,controlCount,rowCount,layoutType,isAutoHeight){return 0!==layoutType||isAutoHeight?0:rowCount*this.getRowHeight(section)},DashboardLayout.prototype.getLayoutType=function(componentKey,control){return 0},DashboardLayout.prototype.checkIfLayoutChanged=function(){var columns=-1;this.context.parameters&&this.context.parameters.value&&(columns=this.context.parameters.value.Columns);var layoutChanged=columns!==this.columns;return this.columns=columns,layoutChanged&&(this.desiredColumns={}),layoutChanged},DashboardLayout.prototype.getSectionColumnCount=function(section,controls){return Math.min(this.columns,this.getDesiredColumnCount(section))},DashboardLayout.prototype.createControlsInLayout=function(section){var layout=this.createControlsInDesiredLayout(section);return this.isReflow(layout,section)&&(this.telemetry.startReflow(),layout=this.reflowLayout(layout.controls,section),this.telemetry.endReflow()),layout},DashboardLayout.prototype.getDesiredColumnCount=function(section){var sectionId=section.Id.guid;if(!this.desiredColumns[sectionId]){var longestRow=0,rows=section.Rows;if(rows)for(var i=0;i<rows.length;i++){for(var row=rows[i],currentRow=0,j=0;j<row.Cells.length;j++){var cell=row.Cells[j];currentRow+=cell.ColSpan}currentRow>longestRow&&(longestRow=currentRow)}this.desiredColumns[sectionId]=Math.max(1,longestRow)}return this.desiredColumns[sectionId]},DashboardLayout.prototype.isReflow=function(layout,section){return layout&&layout.requiresReflow||this.columns<this.getDesiredColumnCount(section)},DashboardLayout.prototype.reflowLayout=function(controls,section){for(var reflow=[],row=0,column=0,rowCount=0,columns=Math.min(this.columns,this.getDesiredColumnCount(section)),columnWidth=this.context.parameters.value.Width/columns,i=0;i<controls.length;i++){var control=controls[i],isLastControl=i===controls.length-1;if(control.row=row,control.column=column,control.colSpan>1){var fitsInRow=!0;if(control.colSpan>columns&&(control.colSpan=columns),control.colSpan+control.column>columns&&(fitsInRow=!1),fitsInRow)for(var j=control.colSpan;j>0;j--)if(this.cellIsOccupied(reflow,control.row,control.column+j)){fitsInRow=!1;break}if(!fitsInRow)for(;!fitsInRow;){row++,control.row=row;for(var i_1=0;i_1<=columns-control.colSpan;i_1++){control.column=i_1,fitsInRow=!0;for(var j=control.colSpan;j>=0;j--)if(this.cellIsOccupied(reflow,control.row,control.column+j)){fitsInRow=!1;break}if(fitsInRow)break}}}if(reflow.push(control),this.useGoldenRatio(control)){var height=this.getGoldenRatioHeight(section,control,columnWidth);control.rowSpan=Math.round(height/this.getRowHeight(section))}else control.rowSpan=this.getRowSpan(columns,control,section);if(rowCount=Math.max(rowCount,control.row+control.rowSpan),!isLastControl&&(column+=control.colSpan,column>=columns||this.cellIsOccupied(reflow,row,column))){for(;columns>column&&this.cellIsOccupied(reflow,row,column);)column++;if(column>=columns||this.cellIsOccupied(reflow,row,column))for(column=0,row++;this.cellIsOccupied(reflow,row,column);)column++,column>=columns&&(column=0,row++)}}for(var i=0;i<controls.length;i++)for(var control=controls[i];control.colSpan+control.column<columns&&!this.cellIsOccupied(reflow,control.row,control.column+control.colSpan);)control.colSpan++;return{controls:reflow,rowCount:this.getSectionRowCount(rowCount,section)}},DashboardLayout.prototype.useGoldenRatio=function(control){var controlDescriptor=this.context.parameters.value.FormDescriptor.Controls[control.id];return controlDescriptor&&controlDescriptor.Parameters&&"Chart"===controlDescriptor.Parameters.ChartGridMode},DashboardLayout.prototype.getRowSpan=function(columns,control,section){var moreRows=0;return control.rowSpan+moreRows},DashboardLayout.prototype.getGoldenRatioHeight=function(section,control,columnWidth){var controlWidth=control.colSpan*columnWidth,controlHeight=control.rowSpan*this.getRowHeight(section);return controlWidth>controlHeight?controlWidth/(controlWidth+controlHeight)>controlHeight/controlWidth?GOLDEN_RATIO*controlWidth:controlHeight/controlWidth*controlWidth:controlWidth/controlHeight>=controlHeight/(controlWidth+controlHeight)?1/(controlWidth/controlHeight)*controlWidth:1/GOLDEN_RATIO*controlWidth},DashboardLayout.prototype.cellIsOccupied=function(layout,row,column){for(var key in layout){var control=layout[key];if(row>=control.row&&row<control.row+control.rowSpan&&column>=control.column&&column<control.column+control.colSpan)return!0}return!1},DashboardLayout.prototype.createControlsInDesiredLayout=function(section){for(var rows=section.Rows,controls=[],requiresReflow=!1,rowCount=rows.length,factory=this._getControlFactory(section),i=0;i<rows.length;i++){var row=rows[i];if(row.Visible)for(var column=0,j=0;j<row.Cells.length;j++){var cell=row.Cells[j];"auto"===row.Height&&(cell.RowSpan=1);var control=cell.ControlName&&this.context.parameters.value.FormDescriptor.Controls[cell.ControlName];if(control){if(!cell.Visible&&5===this.context.parameters.value.FormDescriptor.FormType){var controlConfigurations=control.UniqueId&&this.context.parameters.value.FormDescriptor.ControlConfigurations&&this.context.parameters.value.FormDescriptor.ControlConfigurations[control.UniqueId];if(controlConfigurations){var formFactor=this.context.client.getFormFactor(),configuration=controlConfigurations.CustomControls[formFactor];if(!configuration||!configuration.ShouldOverrideControlVisible)continue;cell.Visible=!0,control.Visible=!0}}var components=factory.create(cell);if(components){Array.isArray(components)||(components=[components]);var colSpan=Math.max(1,Math.floor(cell.ColSpan/components.length));for(var key in components){var component=components[key];if(!requiresReflow)for(var k=0;colSpan>k&&!(requiresReflow=this.cellIsOccupied(controls,i,column+k));k++);controls.push({id:""+cell.ControlName+(1===components.length?"":key),name:cell.ControlName,componentIndex:+key,component:component,row:i,rowHeight:row.Height,column:column,rowSpan:cell.RowSpan,colSpan:colSpan,canMemoize:!0,visible:cell.Visible!==!1,forceRenderIfInvisible:factory.isWebResourceControl(control)}),column+=colSpan}rowCount=Math.max(rowCount,i+cell.RowSpan)}else requiresReflow=!0}}}return{controls:controls,rowCount:this.getSectionRowCount(rowCount,section),requiresReflow:requiresReflow}},DashboardLayout.prototype.getSectionRowCount=function(rowCount,section){return rowCount},DashboardLayout.DEFAULT_ROW_HEIGHT=30,DashboardLayout}();Dashboard.DashboardLayout=DashboardLayout}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){"use strict";var MemoizedDashboardValue=function(){function MemoizedDashboardValue(dashboard){var _this=this;this.memoizedSections={},this.memoizedCells={},this._renderedControlIds=[],this.renderedControlCounts={},this.renderChecks=[{reason:"InitialRender",check:function(){return!_this.container}},{reason:"Layout",check:function(){return _this.layoutChanged}},{reason:"ControlsRefreshed",check:function(){return _this.areControlsRefreshed}},{reason:"FormInitialized",check:function(){return _this.isFormDescriptorInitialized!==_this.dashboard.isFormDescriptorInitialized()}},{reason:"DashboardId",check:function(){return _this.dashboardId!==(_this.dashboard.getDashboardId()&&_this.dashboard.getDashboardId().guid)}},{reason:"NextRenderPass",check:function(){return _this.renderPass!==_this.dashboard.layout.renderPass}},{reason:"Width",check:function(){return _this.width!==_this.dashboard.context.parameters.value.Width}},{reason:"Height",check:function(){return _this.height!==_this.dashboard.context.parameters.value.Height}},{reason:"DeviceHeight",check:function(){return!_this.areAllControlsRendered()&&_this.deviceHeight!==_this.dashboard.context.parameters.value.DeviceHeight}},{reason:"DataSetColumns",check:function(){return _this.dataSetColumns!==_this.dashboard.context.parameters.value.DataSetColumns}},{reason:"Scroll",check:function(){return!_this.areAllControlsRendered()&&_this.scrollTop!==_this.dashboard.context.parameters.value.ScrollTop}}],this.dashboard=dashboard}return Object.defineProperty(MemoizedDashboardValue.prototype,"layoutChanged",{get:function(){return void 0===this._layoutChanged&&(this._layoutChanged=this.dashboard.layout.checkIfLayoutChanged()),this._layoutChanged},enumerable:!0,configurable:!0}),Object.defineProperty(MemoizedDashboardValue.prototype,"areControlsRefreshed",{get:function(){return void 0===this._areControlsRefreshed&&(this._areControlsRefreshed=this.areRefreshCountersChanged()),this._areControlsRefreshed},enumerable:!0,configurable:!0}),Object.defineProperty(MemoizedDashboardValue.prototype,"controlCount",{get:function(){if(void 0===this._controlCount){var controlFactory=new Dashboard.DashboardControlFactory(this.dashboard,null);this._controlCount=controlFactory.getControlCount()}return this._controlCount},enumerable:!0,configurable:!0}),MemoizedDashboardValue.prototype.needsUpdate=function(){var reason="";this._layoutChanged=void 0,this._areControlsRefreshed=void 0;for(var _i=0,_a=this.renderChecks;_i<_a.length;_i++){var renderCheck=_a[_i];if(renderCheck.check.call(this)){reason=renderCheck.reason;break}}return""!==reason&&this.updateMemoizedValues(),reason},MemoizedDashboardValue.prototype.resetMemoizedValues=function(){this.dashboard.simpleRenderer.reset(),this.dashboard.layout.resetRenderPass(),this.resetRenderedControls(),this._controlCount=void 0},MemoizedDashboardValue.prototype.updateMemoizedValues=function(){(this.layoutChanged||this.areControlsRefreshed||this.width!==this.dashboard.context.parameters.value.Width)&&(this.memoizedCells={},this.memoizedSections={}),this.height!==this.dashboard.context.parameters.value.Height&&(this.memoizedCells={}),this.dashboardId&&this.dashboardId!==(this.dashboard.getDashboardId()&&this.dashboard.getDashboardId().guid)&&this.resetMemoizedValues(),this.isFormDescriptorInitialized=this.dashboard.isFormDescriptorInitialized(),this.dashboardId=this.dashboard.getDashboardId()&&this.dashboard.getDashboardId().guid,this.renderPass=this.dashboard.layout.renderPass,this.width=this.dashboard.context.parameters.value.Width,this.height=this.dashboard.context.parameters.value.Height,this.deviceHeight=this.dashboard.context.parameters.value.DeviceHeight,this.dataSetColumns=this.dashboard.context.parameters.value.DataSetColumns,this.scrollTop=this.dashboard.context.parameters.value.ScrollTop,this.refreshCounters=Object.assign({},this.dashboard.context.parameters.value.RefreshCounters||{})},MemoizedDashboardValue.prototype.resetRenderedControls=function(){this._renderedControlIds=[],this.renderedControlCounts={},this.dashboard.context.utils.fireEvent("allControlsRendered",{allControlsRendered:!1})},MemoizedDashboardValue.prototype.isControlRendered=function(controlId){return-1!==this._renderedControlIds.indexOf(controlId)},MemoizedDashboardValue.prototype.areAllControlsRendered=function(){return this._renderedControlIds.length>=this.controlCount},MemoizedDashboardValue.prototype.addRenderedControl=function(controlId,manifestName){this.isControlRendered(controlId)||(this._renderedControlIds.push(controlId),this.renderedControlCounts[manifestName]?this.renderedControlCounts[manifestName]++:this.renderedControlCounts[manifestName]=1)},MemoizedDashboardValue.prototype.areRefreshCountersChanged=function(){var dashboardRefreshCounters=this.dashboard.context.parameters.value.RefreshCounters;if(this.refreshCounters===dashboardRefreshCounters)return!1;if(this.refreshCounters&&!dashboardRefreshCounters||!this.refreshCounters&&dashboardRefreshCounters)return!0;if(Object.keys(this.refreshCounters).length!==Object.keys(dashboardRefreshCounters).length)return!0;for(var key in dashboardRefreshCounters){if(!this.refreshCounters.hasOwnProperty(key))return!0;if(this.refreshCounters[key]!==dashboardRefreshCounters[key])return!0}return!1},MemoizedDashboardValue}();Dashboard.MemoizedDashboardValue=MemoizedDashboardValue}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){"use strict";var SimpleDashboardRenderer=function(){function SimpleDashboardRenderer(dashboard){this.dashboard=dashboard}return SimpleDashboardRenderer.prototype.reset=function(){this._canUseSimpleRenderer=void 0},SimpleDashboardRenderer.prototype.canUseSimpleRenderer=function(section){if(void 0===section&&(section=null),section)return"UnsupportedSection";if(void 0===this._canUseSimpleRenderer&&this.dashboard.isFormDescriptorInitialized()){if(this.dashboard.isPowerBIDashboard)return this._canUseSimpleRenderer="IsPowerBIDashboard";var form=this.dashboard.context.parameters.value.FormDescriptor;for(var tabName in form.Tabs){var tab=form.Tabs[tabName];if(tab.Columns.length>1)return this._canUseSimpleRenderer="MultipleColumns"}for(var sectionId in form.Sections)for(var section_1=form.Sections[sectionId],_i=0,_a=section_1.Rows;_i<_a.length;_i++){var row=_a[_i];if(row.Height)return this._canUseSimpleRenderer="RowHeightSpecified"}return this._canUseSimpleRenderer=""}return""===this._canUseSimpleRenderer?this._canUseSimpleRenderer:this._canUseSimpleRenderer||"DashboardNotInitialized"},SimpleDashboardRenderer.prototype._getSectionIds=function(form){var sections=[];for(var key in form.Tabs){var tab=form.Tabs[key];if(tab.Visible)for(var _i=0,_a=tab.Columns;_i<_a.length;_i++){var column=_a[_i];sections.push.apply(sections,column.SectionNames)}}return sections},SimpleDashboardRenderer.prototype.render=function(){for(var sections=[],form=this.dashboard.context.parameters.value.FormDescriptor,sectionsIds=this._getSectionIds(form),componentKey=this.dashboard.layout.getCellComponentKeys()[0],totalHeight=0,currentLayoutType=0,_i=0,sectionsIds_1=sectionsIds;_i<sectionsIds_1.length;_i++){var sectionId=sectionsIds_1[_i],section=form.Sections[sectionId],_a=this.renderSectionControls(section,totalHeight,currentLayoutType,componentKey),sectionControls=_a.sectionControls,sectionHeight=_a.sectionHeight,layoutType=_a.layoutType;if(sectionControls.length){var sectionContainer=this.dashboard.context.factory.createElement("CONTAINER",{id:section.Id.guid,key:section.Id.guid,style:this.dashboard.styling.getSectionStyle(section,!section.Visible,!1,sectionControls.length,sectionHeight,layoutType)},sectionControls);sections.push(sectionContainer),totalHeight+=sectionHeight,currentLayoutType=layoutType}}return sections},SimpleDashboardRenderer.prototype.renderSectionControls=function(section,offsetHeight,layoutType,componentKey){var sectionControls=[],sectionHeight=0;if(section.Visible){var controls=this.dashboard.layout.createControlsInLayout(section).controls,totalColumns=this.dashboard.layout.getSectionColumnCount(section,controls),rowHeight=this.dashboard.layout.getRowHeight(section),isIE=this.dashboard.context.client&&this.dashboard.context.client.userAgent&&this.dashboard.context.client.userAgent.isBrowserIE;for(var key in controls){var control=controls[key];control.visible&&(sectionHeight=Math.max(sectionHeight,(control.row+control.rowSpan)*rowHeight));var component=control.component;layoutType=this.dashboard.layout.getLayoutType(componentKey,component);var styleBorderContainer=this.dashboard.styling.getCellInnerStyle(section,control,component,componentKey);if(this.dashboard.layout.shouldControlRender(section,control,offsetHeight)){if("function"==typeof component){var controlWidth=this.dashboard.layout.getControlWidth(totalColumns,control,section,styleBorderContainer),controlHeight=this.dashboard.layout.getControlHeight(control,section,styleBorderContainer);component=component(controlWidth,controlHeight)}this.dashboard.layout.controlRendered(control,componentKey,!1)}else component=null;var cellInner=this.dashboard.context.factory.createElement("CONTAINER",{id:""+control.id+componentKey,key:""+control.id+componentKey+(isIE?this.dashboard.layout.columns:""),style:styleBorderContainer},component),cellOuter=this.dashboard.context.factory.createElement("CONTAINER",{id:section.Id.guid+"_"+control.row+"_"+control.column+"_"+key+componentKey,key:section.Id.guid+"_"+control.row+"_"+control.column+"_"+key+componentKey,style:this.dashboard.styling.getCellOuterStyle(section,control,totalColumns,componentKey,component,!1,layoutType)},cellInner);sectionControls.push(cellOuter)}}return{sectionControls:sectionControls,sectionHeight:sectionHeight,layoutType:layoutType}},SimpleDashboardRenderer}();Dashboard.SimpleDashboardRenderer=SimpleDashboardRenderer}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){var Dashboard;!function(Dashboard){var SimpleDashboardStyling=function(_super){function SimpleDashboardStyling(parent){return _super.call(this,parent)||this}return __extends(SimpleDashboardStyling,_super),Object.defineProperty(SimpleDashboardStyling.prototype,"overrideBaseStyles",{get:function(){return this._overridenStyle||(this._overridenStyle={dashboard:{flex:Dashboard.NO_STYLE,display:"block",width:"100%"},sections:{section:{flexDirection:Dashboard.NO_STYLE,flex:Dashboard.NO_STYLE,position:"relative",display:"block"}},cell:{outer:{flex:Dashboard.NO_STYLE,display:function(){return this.parameters.control.visible?"block":"none"},position:"absolute",top:function(){return this.parameters.control.row*this.rowHeight+"px"},width:function(){return Math.min(100,this.parameters.control.colSpan/this.parameters.columns*100)+"%"},height:function(){return this.parameters.control.rowSpan*this.rowHeight+"px"},left:function(){return this.parent.context.client.isRTL?void 0:Math.max(0,this.parameters.control.column/this.parameters.columns*100)+"%"},right:function(){return this.parent.context.client.isRTL?Math.max(0,this.parameters.control.column/this.parameters.columns*100)+"%":Dashboard.BASE_STYLE}},inner:{flex:Dashboard.NO_STYLE,width:Dashboard.NO_STYLE,position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px"}}}),this._overridenStyle},enumerable:!0,configurable:!0}),SimpleDashboardStyling}(Dashboard.DashboardStyling);Dashboard.SimpleDashboardStyling=SimpleDashboardStyling}(Dashboard=Containers.Dashboard||(Containers.Dashboard={}))}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var Containers;!function(Containers){"use strict";var DashboardControl=function(){function DashboardControl(){this.isPowerBIDashboard=!1,this.forbiddenUCIControlList=[],Containers.Dashboard.chartSkipKeyShortcut()}return Object.defineProperty(DashboardControl.prototype,"layout",{get:function(){var _this=this;return this._layout||(this._layout=new Containers.Dashboard.DashboardLayout(this,function(section){return new Containers.Dashboard.DashboardControlFactory(_this,section)})),this._layout},enumerable:!0,configurable:!0}),Object.defineProperty(DashboardControl.prototype,"styling",{get:function(){return this._styling},enumerable:!0,configurable:!0}),Object.defineProperty(DashboardControl.prototype,"telemetry",{get:function(){return this._telemetry||(this._telemetry=new Containers.Dashboard.TelemetryReporter(this)),this._telemetry},enumerable:!0,configurable:!0}),Object.defineProperty(DashboardControl.prototype,"memoizedValue",{get:function(){return this._memoizedValue||(this._memoizedValue=new Containers.Dashboard.MemoizedDashboardValue(this)),this._memoizedValue},enumerable:!0,configurable:!0}),Object.defineProperty(DashboardControl.prototype,"simpleRenderer",{get:function(){return this._simpleRenderer||(this._simpleRenderer=new Containers.Dashboard.SimpleDashboardRenderer(this)),this._simpleRenderer},enumerable:!0,configurable:!0}),DashboardControl.prototype.injectStyles=function(){if(this.isTouchDevice()){var injectedStyles=document.getElementById("DashboardCustomCSS");if(!injectedStyles){var head=document.head||document.getElementsByTagName("head")&&document.getElementsByTagName("head")[0];head&&(injectedStyles=document.createElement("style"),Object.assign(injectedStyles,{id:"DashboardCustomCSS",type:"text/css",textContent:".dashboard-gridScroll { overflow-y: hidden !important; }\n.seeMore .dashboard-gridScroll { overflow-y: auto !important; }"}),head.appendChild(injectedStyles))}}},DashboardControl.prototype.init=function(context,notifyOutputChanged,state){this.context=context,Containers.Dashboard.DashboardLayout.DEFAULT_ROW_HEIGHT=Containers.Dashboard.DashboardStyling.convertFromRemToPixelValue(""+(this.context.theming.cellHeightInRem||3.5)),this.telemetry.startTimeOnDashboard(),this.context.accessibility.registerShortcut([17,18,65],this._topCommandBarFirstElementShortCut.bind(this),!0,"TopCommandBarFirstElement","TOPCOMMANDBARFIRSTELEMENTSHORTCUT");
},DashboardControl.prototype._topCommandBarFirstElementShortCut=function(){var elementsFinder=document.getElementById("RefreshDashboard"),container=elementsFinder.parentElement;if(container){var element=container.querySelectorAll("li")[0];element&&element.focus()}},DashboardControl.prototype.determineIfCurrentDashboardIsPBIDashboard=function(){var controls=this.context.parameters&&this.context.parameters.value&&this.context.parameters.value.FormDescriptor&&this.context.parameters.value.FormDescriptor.Controls;if(!controls)return!1;var controlKeys=Object.keys(controls);if(0===controlKeys.length||controlKeys.length>1)return!1;var control=controls[controlKeys[0]];return control.ClassId.guid.toLowerCase()===DashboardControl.PowerBIControlClassId&&(control.Parameters&&control.Parameters.Type&&"1"===control.Parameters.Type)},DashboardControl.prototype.updateView=function(context){this.context=context;try{this.telemetry.startSLAReport(),this.telemetry.addSLAParameter("DashboardId",this.getDashboardId()),this.initDashboardTypeContext(),context.parameters&&context.parameters.ForbiddenControlIdList&&context.parameters.ForbiddenControlIdList.raw&&(this.forbiddenUCIControlList=JSON.parse(context.parameters.ForbiddenControlIdList.raw));var renderReason=this.memoizedValue.needsUpdate();if(this.telemetry.addSLAParameter("IsMemoized",""===renderReason),""!==renderReason){if(this.layout.columns<0)return this.telemetry.addSLAParameter("RenderReason","UnknownSize"),this.telemetry.reportSuccess(),null;this.telemetry.addSLAParameter("RenderReason",renderReason),this.telemetry.addSLAParameter("RenderPass",Containers.Dashboard.RenderPass[this.layout.renderPass]);var notSimpleRenderReason=this.simpleRenderer.canUseSimpleRenderer(),canUseSimpleRenderer=""===notSimpleRenderReason,childControls=canUseSimpleRenderer?this.simpleRenderer.render():this.createContainerWithControls();this.memoizedValue.container=Array.isArray(childControls)?childControls:[childControls],this.telemetry.addSLAParameter("RenderedControls",this.memoizedValue.renderedControlCounts),this.layout.nextRenderPass()}var hiddenContent=this.renderHiddenContent(),dashboard=this.context.factory.createElement("CONTAINER",{id:"DashboardContainer",key:"DashboardContainer",style:this.styling.getDashboardContainerStyle(),role:"presentation"},hiddenContent.concat(this.memoizedValue.container));return this.injectStyles(),this.isFormDescriptorInitialized()&&this.telemetry.dashboardLoaded(this.getDashboardId()),this.telemetry.reportSuccess(),dashboard}catch(error){this.telemetry.reportFailure(error)}},DashboardControl.prototype.renderHiddenContent=function(){return[]},DashboardControl.prototype.initDashboardTypeContext=function(){this.telemetry.addSLAParameter("BoundDashboardType",0),this.isPowerBIDashboard=this.determineIfCurrentDashboardIsPBIDashboard(),this.telemetry.addSLAParameter("IsPowerBIDashboard",this.isPowerBIDashboard);var notSimpleRenderReason=this.simpleRenderer.canUseSimpleRenderer(),canUseSimpleRenderer=""===notSimpleRenderReason;this.telemetry.addSLAParameter("IsSimpleRender",canUseSimpleRenderer),canUseSimpleRenderer||this.telemetry.addSLAParameter("NotSimpleRenderReason",notSimpleRenderReason),this.styling&&(!this.isPowerBIDashboard||this.styling instanceof Containers.Dashboard.PowerBIDashboardStyling)&&(!canUseSimpleRenderer||this.styling instanceof Containers.Dashboard.SimpleDashboardStyling)&&this.styling instanceof Containers.Dashboard.DashboardStyling||(this._styling=this.isPowerBIDashboard?new Containers.Dashboard.PowerBIDashboardStyling(this):canUseSimpleRenderer?new Containers.Dashboard.SimpleDashboardStyling(this):new Containers.Dashboard.DashboardStyling(this))},DashboardControl.prototype.getOnParametersUpdated=function(controlName){var _this=this;return{eventname:"parametersUpdated",eventhandler:function(params){var updatedParameters=_this.context.parameters.value.UpdatedControlParameters?Object.assign({},_this.context.parameters.value.UpdatedControlParameters):{};updatedParameters[controlName]=params,_this.context.utils.fireEvent("parametersUpdated",updatedParameters)}}},DashboardControl.prototype.getDashboardId=function(){return this.context.parameters&&this.context.parameters.value&&this.context.parameters.value.FormDescriptor?this.context.parameters.value.FormDescriptor.Id:void 0},DashboardControl.prototype.isFormDescriptorInitialized=function(){return this.context.parameters&&this.context.parameters.value&&this.context.parameters.value.FormDescriptor&&2==this.context.parameters.value.FormDescriptor.initialized},DashboardControl.prototype.isTouchDevice=function(){return 3===this.context.client.getFormFactor()||2===this.context.client.getFormFactor()},DashboardControl.prototype.createContainerWithControls=function(){var childComponents=[],height=0;if(this.isFormDescriptorInitialized()){var tabs=this.layout.getTabs();if(tabs)for(var key in tabs){var tabComponent=tabs[key].Visible?this.createTabControl(tabs[key],height):null;tabComponent&&(childComponents.push(tabComponent.component),height+=tabComponent.height)}}return this.context.factory.createElement("CONTAINER",{id:"DashboardTabContainer",key:"DashboardTabContainer",style:this.styling.getTabContainerStyle(height),role:"presentation"},childComponents)},DashboardControl.prototype.createTabControl=function(tab,offsetTop){var tabEx=tab;if(tabEx&&tabEx.component)return tabEx;for(var childComponents=[],columns=[],tabHeight=0,hidden=!0,layoutType=null,i=0;i<tab.Columns.length;i++){for(var column=tab.Columns[i],columnComponents=[],columnHeight=0,j=0;j<column.SectionNames.length;j++){var sectionName=column.SectionNames[j],section=this.context.parameters.value.FormDescriptor.Sections[sectionName],sectionComponent=section.Visible?this.createSectionControl(section,offsetTop+columnHeight):null;sectionComponent&&(columnComponents.push(sectionComponent.component),columnHeight+=sectionComponent.height,hidden=hidden&&sectionComponent.hidden,layoutType=sectionComponent.layoutType)}if(0<columnComponents.length){var columnComponent=this.context.factory.createElement("CONTAINER",{id:tab.Id+"_"+i,key:tab.Id+"_"+i,style:this.styling.getTabColumnStyle(columnHeight,column,layoutType),role:"presentation"},columnComponents);columns.push(columnComponent),tabHeight=Math.max(tabHeight,columnHeight)}}if(0===columns.length)return null;var columnsComponents=this.context.factory.createElement("CONTAINER",{id:tab.Id+"_Columns",key:tab.Id+"_Columns",style:this.styling.getTabColumnContainerStyle(tabHeight,tab,layoutType),role:"presentation"},columns);return childComponents.push(columnsComponents),{component:this.context.factory.createElement("CONTAINER",{id:tab.Id,key:tab.Id,style:this.styling.getTabStyle(tabHeight,tab,layoutType),role:"presentation"},childComponents),height:tabHeight}},DashboardControl.prototype.createSectionControl=function(section,offsetTop){var hidden=this.layout.isSectionHidden(section),rows=section.Rows,sectionControls=[],controlCount=0,isAutoHeight="auto"===section.Height,height=0,layoutType=0,memoizedSection=this.memoizedValue.memoizedSections[section.Name];if(memoizedSection)sectionControls=memoizedSection.components,height=memoizedSection.height;else if(!hidden){if(""===this.simpleRenderer.canUseSimpleRenderer(section)){var renderedSection=this.simpleRenderer.renderSectionControls(section,offsetTop,layoutType,"");sectionControls=renderedSection.sectionControls,height=renderedSection.sectionHeight,layoutType=renderedSection.layoutType}else{var sectionHeader=this.layout.getSectionHeader(section);if(sectionHeader&&sectionControls.push(sectionHeader),rows)for(var layout=this.layout.createControlsInLayout(section),controls=layout.controls,rowCount=this.isPowerBIDashboard?1:layout.rowCount,columns=this.layout.getSectionColumnCount(section,controls),i=0;rowCount>i;i++){var row=this.createRowControl(i,columns,controls,section,layoutType,offsetTop);row&&(sectionControls.push.apply(sectionControls,row.components),controlCount+=row.controlCount,layoutType=0!==layoutType?layoutType:row.layoutType)}height+=this.layout.getSectionHeight(section,controlCount,sectionControls.length,layoutType,isAutoHeight)}this.layout.canMemoizeSection(section)&&(this.memoizedValue.memoizedSections[section.Name]={components:sectionControls,height:height})}var sectionContainer=this.context.factory.createElement("CONTAINER",{style:this.styling.getSectionStyle(section,hidden,isAutoHeight,controlCount,height,layoutType),id:section.Id.guid,key:section.Id.guid},sectionControls);return{component:sectionContainer,height:hidden?0:height,hidden:hidden,layoutType:layoutType}},DashboardControl.prototype.createRowControl=function(rowIndex,columns,controls,section,layoutType,offsetTop){var rowControls=[],controlCount=0,hasControlsInRow=!1,isAutoHeight=!1;for(var key in controls){var control=controls[key];if(control.row===rowIndex){hasControlsInRow=!0,isAutoHeight=1===columns&&"auto"===control.rowHeight;break}}if(hasControlsInRow){for(var skipCells=0,j=0;columns>j;j++)if(skipCells>0)skipCells--;else{var cell=this.createCellControl(rowIndex,j,columns,controls,section,offsetTop);rowControls.push.apply(rowControls,cell.components),skipCells=cell.skipCells,layoutType=0!==layoutType?layoutType:cell.layoutType,controlCount+=cell.controlCount}if(0!==layoutType)return{components:rowControls,layoutType:layoutType,controlCount:controlCount}}else if(0!==layoutType)return null;var row=this.context.factory.createElement("CONTAINER",{style:this.styling.getRowStyle(section,isAutoHeight),id:section.Id.guid+"_"+rowIndex,key:section.Id.guid+"_"+rowIndex},rowControls);return{components:[row],layoutType:0,controlCount:controlCount}},DashboardControl.prototype.createCellControl=function(rowIndex,columnIndex,columns,controls,section,offsetTop){var _this=this,overallLayoutType=0,skipCells=0,cell=[],_loop_2=function(key){var control=controls[key];if(control.row===rowIndex&&control.column===columnIndex){for(var isRowAutoHeight="auto"===control.rowHeight,componentKeys=this_1.layout.getCellComponentKeys(),borderContainers=this_1.memoizedValue.memoizedCells[control.id],_loop_3=function(i){if(0===i&&!borderContainers){var shouldControlRender_1=this_1.layout.shouldControlRender(section,control,offsetTop);borderContainers=this_1.createCellControlInternal(control,componentKeys,columns,shouldControlRender_1,section),control.canMemoize&&componentKeys.every(function(key){return _this.layout.shouldControlRender(section,control,offsetTop,shouldControlRender_1,key)})&&(this_1.memoizedValue.memoizedCells[control.id]=borderContainers)}var singleComponent=!1,componentKey=componentKeys[i],borderContainer=borderContainers[componentKey];if(!borderContainer){if(i!==componentKeys.length-1)return"continue";singleComponent=!0,borderContainer=borderContainers,componentKey=""}var layoutType=this_1.layout.getLayoutType(componentKey,borderContainers);return 0!==layoutType&&(overallLayoutType=layoutType),this_1.layout.isCellComponentHidden(componentKey,borderContainers)&&!this_1.layout.isCellComponentOnTheDOM(control,componentKey)||(this_1.layout.controlRendered(control,componentKey,!0),cell.push(this_1.context.factory.createElement("CONTAINER",{style:this_1.styling.getCellOuterStyle(section,control,columns,componentKey,borderContainers,isRowAutoHeight,layoutType),id:section.Id.guid+"_"+rowIndex+"_"+columnIndex+"_"+key+componentKey,key:section.Id.guid+"_"+rowIndex+"_"+columnIndex+"_"+key+componentKey},borderContainer))),singleComponent?"break":void 0},i=0;i<componentKeys.length;i++){var state_2=_loop_3(i);if("break"===state_2)break}return skipCells=control.colSpan-1,"break"}},this_1=this;for(var key in controls){var state_3=_loop_2(key);if("break"===state_3)break}var controlCount=0===cell.length?0:1;return 0===cell.length&&cell.push(this.context.factory.createElement("CONTAINER",{style:{flex:"1 1 1px",maxWidth:1/columns*100+"%"},id:section.Id.guid+"_"+rowIndex+"_"+columnIndex,key:section.Id.guid+"_"+rowIndex+"_"+columnIndex})),{components:cell,skipCells:skipCells,layoutType:overallLayoutType,controlCount:controlCount}},DashboardControl.prototype.createCellControlInternal=function(control,componentKeys,dashboardColumns,shouldControlRender,section){for(var controlComponents=control.component,singleComponent=1===componentKeys.length&&""===componentKeys[0],components={},i=0;i<componentKeys.length;i++){var componentKey=componentKeys[i];if(!controlComponents[componentKey]){if(i!==componentKeys.length-1)continue;singleComponent=!0,componentKey=""}var component=null,returnedComponent=singleComponent?control.component:controlComponents[componentKey],styleBorderContainer=this.styling.getCellInnerStyle(section,control,returnedComponent,componentKey);if(shouldControlRender=this.layout.shouldControlRender(section,control,void 0,shouldControlRender,componentKey)){if("function"==typeof returnedComponent){var controlWidth=this.layout.getControlWidth(dashboardColumns,control,section,styleBorderContainer),controlHeight=this.layout.getControlHeight(control,section,styleBorderContainer);component=returnedComponent(controlWidth,controlHeight)}else component=returnedComponent;this.layout.controlRendered(control,componentKey,!1)}var borderContainer=this.context.factory.createElement("CONTAINER",{style:styleBorderContainer,id:""+control.id+componentKey,key:""+control.id+componentKey},component);if(singleComponent)return borderContainer;components[componentKey]=borderContainer}return components},DashboardControl.prototype.getOutputs=function(){return null},DashboardControl.prototype.destroy=function(){this.telemetry.endTimeOnDashboard(this.getDashboardId())},DashboardControl.PowerBIControlClassId="8c54228c-1b25-4909-a12a-f2b968bb0d62",DashboardControl.POWERBI_DASHBOARD=103,DashboardControl}();Containers.DashboardControl=DashboardControl}(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))}(MscrmControls||(MscrmControls={}));
//# sourceMappingURL=d:\a\1\s\target\Release\amd64\package\Controls\\DashboardControl\DashboardControl.js.map