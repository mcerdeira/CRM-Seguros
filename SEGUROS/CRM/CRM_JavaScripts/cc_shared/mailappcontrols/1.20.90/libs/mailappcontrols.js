var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},MscrmControls;!function(t){var e;!function(t){"use strict";var e=function(){function t(){}return t.prototype.init=function(t,e,n){this._context=t},t.prototype.updateView=function(t){if(this._context=t,!t.parameters.value||!t.parameters.value.raw)return t.factory.createElement("CONTAINER",{id:"AccountControlEmptyContainer",key:"AccountControlEmptyContainer"});this._accountRecord=this._context.parameters.value.raw;var e=t.factory.createElement("LABEL",{key:"AccountControlHeaderLabel",style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular,paddingBottom:this._context.theming.measures.measure100}},this._context.resources.getString("AccountControl_Header"));return t.factory.createElement("CONTAINER",{id:"AccountControlContainer",key:"AccountControlContainer",style:{display:"block",width:"100%",color:this._context.theming.colors.grays.gray05,backgroundColor:this._context.theming.colors.whitebackground,paddingTop:this._context.theming.measures.measure100,paddingLeft:this._context.theming.measures.measure100,paddingRight:this._context.theming.measures.measure050,paddingBottom:this._context.theming.measures.measure100,boxSizing:"border-box"}},[e,this._renderAccountForm()])},t.prototype._renderAccountForm=function(){return this._context.factory.createElement("CONTAINER",{id:"AccountForm",key:"AccountForm",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},[this._renderAccountIcon(),this._renderAccountLink(),this._renderCommandBar()])},t.prototype._renderAccountLink=function(){var t=this._getAccountName();return this._context.factory.createElement("LABEL",{key:"AccountLink",id:"AccountLink",style:{cursor:"pointer",textDecoration:"none",display:"block",flex:"1 1 auto",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this._context.theming.colors.basecolor.blue.blue3,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.semibold},tabIndex:0,title:t,role:"link",onClick:this._onAccountNameClick.bind(this),onKeyDown:this._onAccountNameKeyDown.bind(this)},[t])},t.prototype._onAccountNameClick=function(){var t={entityName:this._getEntityName(),entityId:this._getAccountId()};this._context.navigation.openForm(t)},t.prototype._onAccountNameKeyDown=function(t){13===t.keyCode&&this._onAccountNameClick()},t.prototype._renderAccountIcon=function(){var t=this._getAccountImageUrl(),e=this._context.factory.createElement("ENTITYIMAGE",{key:"AccountIcon",hasPrimaryImageField:!0,style:{borderRadius:"50%",display:"block",height:"100%",color:this._context.theming.colors.basecolor.white},alt:this._getAccountName(),imageSrc:t,entityPrimaryField:this._getAccountName()});return this._context.factory.createElement("CONTAINER",{key:"AccountIconContainer",id:"AccountIconContainer",style:{display:"block",flex:"0 0 "+this._context.theming.measures.measure250,borderRadius:"50%",width:this._context.theming.measures.measure250,height:this._context.theming.measures.measure250,lineHeight:this._context.theming.measures.measure250,backgroundColor:this._context.theming.colors.grays.gray01,color:this._context.theming.colors.grays.gray07,fontSize:"16px",textAlign:"center",marginRight:this._context.theming.measures.measure100}},e)},t.prototype._getAccountImageUrl=function(){return null},t.prototype._getAccountName=function(){return this._accountRecord.Name},t.prototype._getAccountId=function(){return this._accountRecord.Id.toString()},t.prototype._getEntityName=function(){return this._accountRecord.LogicalName},t.prototype._renderCommandBar=function(){var t={Id:this._getAccountId(),LogicalName:this._getEntityName(),Name:this._getAccountName()};return this._context.factory.createElement("COMMANDBAR",{key:"AccountControlTrackCommandBar",iconPosition:1,mainMenuLength:1,width:50,commandbarDisplayMode:0,ribbonId:"QuickForm:"+this._getEntityName(),selectedRecords:[t],customCommandManagerStyle:{margin:"0px",border:"0px none"},commandBarStyle:{container:{margin:"0px",border:"0px none"},list:{margin:"0px"},listItem:{width:"50px"},listItemBody:{text:{display:"none"},icon:{lineHeight:"16px"},iconWrapperStyles:{margin:"0px",fontSize:"16px",height:this._context.theming.measures.measure200,lineHeight:this._context.theming.measures.measure200,padding:"0px",border:"0px none",background:"transparent",display:"flex",overflow:"hidden",width:"100%",justifyContent:"center",alignItems:"center"},button:{padding:"0px",backgroundColor:"transparent",lineHeight:this._context.theming.measures.measure200,height:this._context.theming.measures.measure200,borderWidth:0,cursor:"pointer",":hover":{backgroundColor:this._context.theming.colors.basecolor.white},alignItems:"center"},flyoutButtonChevronIconWrapper:{padding:"0px"}}}})},t.prototype.getOutputs=function(){return null},t.prototype.destroy=function(){},t}();t.AccountControl=e}(e=t.Account||(t.Account={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e=function(){function t(){}return t.prototype.init=function(t,e,n){this._context=t},t.prototype.updateView=function(t){this._context=t;var e=this._context.parameters.Records&&this._context.parameters.Records.raw&&Array.isArray(this._context.parameters.Records.raw);return e?this._context.factory.createElement("CONTAINER",{id:"FollowRestrictedRecipientsContainer",key:"FollowRestrictedRecipientsContainer",style:{display:"block"}},[this._renderErrorLabel(),this._renderListHeader(),this._renderRecordsList()]):null},t.prototype._renderRecordsList=function(){var t=this;return this._context.factory.createElement("CONTAINER",{id:"FollowRestrictedRecipientsListContainer",key:"FollowRestrictedRecipientsListContainer",style:{display:"block"}},this._context.parameters.Records.raw.reduce(function(e,n){return e.concat(t._renderRecord(n))},[]))},t.prototype._renderErrorLabel=function(){var t=this._context.resources.getString("RECIPIENTS_DONT_ALLOW_TO_FOLLOW");return this._context.factory.createElement("LABEL",{key:"ErrorText",id:"ErrorText",style:{display:"block",color:this._context.theming.colors.basecolor.red.red4,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular,marginBottom:this._context.theming.measures.measure050},title:t},[t])},t.prototype._renderListHeader=function(){var t=this._context.resources.getString("RECIPIENTS_WHO_CANT_BE_FOLLOWED");return this._context.factory.createElement("LABEL",{key:"ListHeader",id:"ListHeader",style:{display:"block",color:this._context.theming.colors.basecolor.grey.grey7,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular},title:t},[t])},t.prototype._renderRecord=function(t){var e=this;return this._context.factory.createElement("LABEL",{key:"Record_"+t.Id.guid,id:"Record_"+t.Id.guid,style:{cursor:"pointer",textDecoration:"none",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this._context.theming.colors.basecolor.blue.blue3,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.semibold,marginBottom:this._context.theming.measures.measure100},tabIndex:0,title:t.Name,role:"link",onClick:this._onRecordClick.bind(this,this._context,t),onKeyDown:function(n){e._onRecordKeyDown.bind(n,e._context,t)}},[t.Name])},t.prototype._onRecordClick=function(t,e){var n={entityName:e.LogicalName,entityId:e.Id.guid.toString()};t.navigation.openForm(n)},t.prototype._onRecordKeyDown=function(t,e,n){13===t.keyCode&&this._onRecordClick(e,n)},t.prototype.getOutputs=function(){return null},t.prototype.destroy=function(){},t}();t.FollowRestrictedRecipientsControl=e}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var Models;!function(t){!function(t){t[t.NotLinked=0]="NotLinked",t[t.WillBeLinked=1]="WillBeLinked",t[t.IsLinked=2]="IsLinked",t[t.WillBeUnlinked=3]="WillBeUnlinked",t[t.WillBeUnlinkedAndDeleted=4]="WillBeUnlinkedAndDeleted",t[t.LinkFailed=5]="LinkFailed",t[t.InProgress=6]="InProgress"}(t.TrackingState||(t.TrackingState={}));t.TrackingState}(Models||(Models={}));var Models;!function(t){!function(t){t[t.IsNotFollowed=0]="IsNotFollowed",t[t.IsFollowed=1]="IsFollowed"}(t.FollowState||(t.FollowState={}));t.FollowState}(Models||(Models={}));var Constants;!function(t){t.contextId="MAIL_CONTEXT",t.PropertyIds={Subject:"SUBJECT",PlainBody:"PLAIN_BODY",HtmlBody:"HTML_BODY",ReceivedOn:"RECEIVED_ON",TrackStatus:"TRACK_STATUS",TrackAllowedStatus:"TRACK_ALLOWED_STATUS",MailboxItem:"MAILBOX_ITEM",ItemType:"ITEM_TYPE",AttachmentIds:"ATTACHMENT_IDS",EwsUrl:"EWS_URL",EwsToken:"EWS_TOKEN",IsComposeMode:"IS_COMPOSE_MODE",MessageRecipients:"MESSAGE_RECIPIENTS",MeetingAttendees:"MEETING_ATTENDEES",IsDesktopOutlook:"IS_DESKTOP_OUTLOOK",IsSent:"IS_SENT",IsDelegatedMailbox:"IS_DELEGATED_MAILBOX",ResolvedRecipients:"RESOLVED_RECIPIENTS",SelectedRecipient:"SELECTED_RECIPIENT",IsOrganizerResolvedAsUser:"IS_ORGANIZER_RESOLVED_AS_USER",MailboxItemFromServer:"MAILBOX_ITEM_FROM_SERVER",IsLimitedMode:"IS_LIMITED_MODE",LimitedModeNotificationState:"LIMITED_MODE_NOTIFICATION_STATE",IsCreateContactWithoutTracking:"IS_CREATE_CONTACT_WITHOUT_TRACKING"},t.ActionIds={Track:"TRACK",Untrack:"UNTRACK",Follow:"FOLLOW",Unfollow:"UNFOLLOW",InsertBody:"INSERT_BODY",AddAttachments:"ADD_ATTACHMENTS",SetSubject:"SET_SUBJECT",GetEmailLinks:"GET_EMAIL_LINKS",SetTrackingInfo:"SET_TRACKING_INFO",RemoveTrackingInfo:"REMOVE_TRACKING_INFO",ResolveRecipientFromScratch:"RESOLVE_RECIPIENT_FROM_SCRATCH",SetSelectedRecipient:"SET_SELECTED_RECIPIENT",RetryTrack:"RETRY_TRACK",SetLimitedModeNotificationStateAction:"SET_LIMITED_MODE_NOTIFICATION_STATE"},t.DialogNames={Follow:"new_FollowEmail",Unfollow:"new_UnfollowEmail",EmailTemplate:"InsertEmailTemplate_MultiPage_MDD",SalesLiterature:"MailAppSalesLiterature",KnowledgeArticle:"MailAppKnowledgeArticle",AppointmentConflict:"MailAppAppointmentConflict"},t.MailboxItemTypes={Message:"message",Appointment:"appointment"},t.CalendarItemTypes={Single:"Single",Occurence:"Occurence",Exception:"Exception",RecurringMaster:"RecurringMaster"},t.CrmTypeNames={User:"systemuser",Contact:"contact",Lead:"lead",Email:"email",Appointment:"appointment",RecurringAppointmentMaster:"recurringappointmentmaster",ExchangeSyncIdMapping:"exchangesyncidmapping",Account:"account",ActivityPointer:"activitypointer"},t.PropertyNames={Email:"emailaddress",StatusCode:"statecode",IsDisabled:"isdisabled",OwnerId:"ownerid",FollowEmail:"followemail",RecipientRole:"role"},t.CrmTypeCodes={User:8,Contact:2,Lead:4,Appointment:4201,RecurringAppointmentMaster:4251},t.MailboxItemTypeToCrmTypeMap=(e={},e[t.MailboxItemTypes.Message]=t.CrmTypeNames.Email,e[t.MailboxItemTypes.Appointment]=t.CrmTypeNames.Appointment,e),t.FeatureNames={SSSReliablePromote:"SSSReliablePromote",MailAppAttachmentsReliablePromote:"MailAppAttachmentsReliablePromote",MailAppAppointmentsReliablePromote:"MailAppAppointmentsReliablePromote",MailAppResolveRecipientsToAccounts:"MailAppResolveRecipientsToAccounts",MailAppPrepopulateFormsCase:"MailAppPrepopulateFormsCase"},t.GlobalCommandManagerId="crm_header_global",t.RecipientCRMTypeNames=[t.CrmTypeNames.User,t.CrmTypeNames.Contact,t.CrmTypeNames.Lead,t.CrmTypeNames.Account];var e}(Constants||(Constants={}));var MscrmControls;!function(t){var e;!function(t){var e=function(){function t(){var t=this;this._followedEmailCrmId=null,this._onTrackStatusChange=function(e){t._trackStatus=e&&e.value,t._updateFollowedEmailCrmId()}}return t.prototype.init=function(t,e,n){var r=this,o=t&&t.externalContext&&t.externalContext.getAvailableExternalContexts();if(o&&o.getByName(Constants.contextId))this._context=t,this._notifyOutputChanged=e,this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackStatus,{updateListener:this._onTrackStatusChange}).then(function(t){r._trackStatus=t,r._updateFollowedEmailCrmId()},function(t){return t});else{var i=t.resources.getString("RELEVANT_MESSAGE_IN_INCORRECT_ENVIRONMENT");t.navigation.openErrorDialog({message:i})}},t.prototype._getFollowedEmailCrmId=function(){var t=this._trackStatus&&this._trackStatus.crmTrackingState===Models.TrackingState.IsLinked&&this._trackStatus.crmIsFollowed===Models.FollowState.IsFollowed;return t?this._trackStatus.crmId:null},t.prototype._updateFollowedEmailCrmId=function(){var t=this._getFollowedEmailCrmId();t!==this._followedEmailCrmId&&(this._followedEmailCrmId=t,this._notifyOutputChanged())},t.prototype.updateView=function(t){return this._context=t,this._context.factory.createElement("CONTAINER",{id:"mailAppHeader",style:{display:"block",width:"100%"}},null)},t.prototype.getOutputs=function(){var t={followedEmailCrmId:this._followedEmailCrmId};return t},t.prototype.destroy=function(){this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.TrackStatus,this._onTrackStatusChange)},t}();t.MailAppHiddenDataCustomControl=e}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var Models;!function(t){var e=function(){function t(t){this._entityReference=t}return t.prototype.getRecordId=function(){return this.getNamedReference().Id?this.getNamedReference().Id.toString():null},t.prototype.getErrorMessage=function(){throw new Error("Not implemented")},t.prototype.isDirty=function(){throw new Error("Not implemented")},t.prototype.isRecordValid=function(){throw new Error("Not implemented")},t.prototype.getNotification=function(t){throw new Error("Not implemented")},t.prototype.getValue=function(t){throw new Error("Not implemented")},t.prototype.setValue=function(t,e){throw new Error("Not implemented")},t.prototype.getFormattedValue=function(t){throw new Error("Not implemented")},t.prototype.isEditable=function(t){throw new Error("Not implemented")},t.prototype.isSecured=function(t){throw new Error("Not implemented")},t.prototype.isReadable=function(t){throw new Error("Not implemented")},t.prototype.isValid=function(t){throw new Error("Not implemented")},t.prototype.getFieldRequiredLevel=function(t){throw new Error("Not implemented")},t.prototype.getAttributes=function(t){throw new Error("Not implemented")},t.prototype.getValidator=function(t){throw new Error("Not implemented")},t.prototype.getNamedReference=function(){return this._entityReference},t.prototype.getActivityPartyRecord=function(){throw new Error("Not implemented")},t.prototype.validateAllColumns=function(){throw new Error("Not implemented")},t.prototype.save=function(){throw new Error("Not implemented")},t}();t.BaseDataSetRecord=e}(Models||(Models={}));var Common;!function(t){var e=function(){function t(e){if(this.toString=function(){return this.guid},this._guid=t._formatGuidString(e),!this.guid)throw new Error(e+" is not a valid Guid value.");Object.freeze(this)}return Object.defineProperty(t.prototype,"guid",{get:function(){return this._guid},enumerable:!0,configurable:!0}),t._formatGuidString=function(e){if(!e)return null;e=e.toLowerCase();var n=t.braceAndHyphenGuidVerifierPattern.exec(e);if(n)return n[1].length!==n[8].length?null:n[2];var r=t.contiguousGuidVerifierPattern.exec(e);return r?r.filter(function(t,e){return e>0}).join("-"):null},t.newGuid=function(){for(var e="0123456789abcdef",n=36,r="",o=0;n>o;o++)if(14===o)r+="4";else if(8===o||13===o||18===o||23===o)r+="-";else if(19===o){var i=Math.floor(16*Math.random());r+=e.substr(3&i|8,1)}else r+=e.substr(Math.floor(16*Math.random()),1);return new t(r)},t.braceAndHyphenGuidVerifierPattern=/^({?)((\d|[a-f]){8}-(\d|[a-f]){4}-(\d|[a-f]){4}-(\d|[a-f]){4}-(\d|[a-f]){12})(}?)$/,t.contiguousGuidVerifierPattern=/^([a-f\d]{8})([a-f\d]{4})([a-f\d]{4})([a-f\d]{4})([a-f\d]{12})$/,t.EMPTY=new t("00000000-0000-0000-0000-000000000000"),t.toString=function(t){return t?t.guid:null},t.equals=function(e,n){return t.toString(e)===t.toString(n)},t.tryParse=function(e){return t.tryParseOrNull(e)||t.EMPTY},t.tryParseOrNull=function(e){var n=t._formatGuidString(e);return n?new t(n):null},t}();t.Guid=e}(Common||(Common={}));var MscrmControls;!function(t){var e;!function(t){"use strict";!function(t){t[t.Expanded=0]="Expanded",t[t.UpArrowHead=1]="UpArrowHead",t[t.LeftArrowHead=2]="LeftArrowHead",t[t.Collapsed=3]="Collapsed",t[t.Edit=4]="Edit",t[t.Save=5]="Save",t[t.Delete=6]="Delete",t[t.Remove=7]="Remove",t[t.Add=8]="Add",t[t.Cancel=9]="Cancel",t[t.HandClick=10]="HandClick",t[t.Accept=11]="Accept",t[t.More=12]="More",t[t.Forward=13]="Forward",t[t.Favorite=14]="Favorite",t[t.Placeholder=15]="Placeholder",t[t.RatingFull=16]="RatingFull",t[t.RatingEmpty=17]="RatingEmpty",t[t.Options=18]="Options",t[t.Manage=19]="Manage",t[t.Settings=20]="Settings",t[t.Find=21]="Find",t[t.Help=22]="Help",t[t.ViewNotifications=23]="ViewNotifications",t[t.StageAdvance=24]="StageAdvance",t[t.CheckMark=25]="CheckMark",t[t.Locked=26]="Locked",t[t.Lock=27]="Lock",t[t.MoreOptions=28]="MoreOptions",t[t.ContactInfo=29]="ContactInfo",t[t.Pin=30]="Pin",t[t.Unpin=31]="Unpin",t[t.Refresh=32]="Refresh",t[t.Details=33]="Details",t[t.VisualFilter=34]="VisualFilter",t[t.GlobalFilter=35]="GlobalFilter",t[t.Diamond=36]="Diamond",t[t.ApplyFilter=37]="ApplyFilter",t[t.CancelFilter=38]="CancelFilter",t[t.StreamView=39]="StreamView",t[t.TileView=40]="TileView",t[t.Import=41]="Import",t[t.Tools=42]="Tools",t[t.Attach=43]="Attach",t[t.Filter=44]="Filter",t[t.Copy=45]="Copy",t[t.HighPriority=46]="HighPriority",t[t.ReduceTile=47]="ReduceTile",t[t.ExpandTile=48]="ExpandTile",t[t.GlobalFilterExpand=49]="GlobalFilterExpand",t[t.GlobalFilterCollapse=50]="GlobalFilterCollapse",t[t.Clear=51]="Clear",t[t.Post=52]="Post",t[t.OneNote=53]="OneNote",t[t.Home=54]="Home",t[t.SetAsHome=55]="SetAsHome",t[t.BackButton=56]="BackButton",t[t.BackButtonWithoutBorder=57]="BackButtonWithoutBorder",t[t.UpArrow=58]="UpArrow",t[t.DownArrow=59]="DownArrow",t[t.SetActiveButton=60]="SetActiveButton",t[t.SearchButton=61]="SearchButton",t[t.ForwardButton=62]="ForwardButton",t[t.Mail=63]="Mail",t[t.CheckedMail=64]="CheckedMail",t[t.FailedMail=65]="FailedMail",t[t.Phone=66]="Phone",t[t.Chat=67]="Chat",t[t.OpenPane=68]="OpenPane",t[t.ClosePane=69]="ClosePane",t[t.AddFriend=70]="AddFriend",t[t.Arrow=71]="Arrow",t[t.DropdownArrow=72]="DropdownArrow",t[t.FlsLocked=73]="FlsLocked",t[t.LinkArticle=74]="LinkArticle",t[t.UnlinkArticle=75]="UnlinkArticle",t[t.CopyLink=76]="CopyLink",t[t.EmailLink=77]="EmailLink",t[t.Share=78]="Share",t[t.Assign=79]="Assign",t[t.Connect=80]="Connect",t[t.Opportunity=81]="Opportunity",t[t.Appointment=82]="Appointment",t[t.Task=83]="Task",t[t.Case=84]="Case",t[t.PhoneCallIncoming=85]="PhoneCallIncoming",t[t.PhoneCallOutgoing=86]="PhoneCallOutgoing",t[t.EmailIncoming=87]="EmailIncoming",t[t.EmailOutgoing=88]="EmailOutgoing",t[t.SendEmail=89]="SendEmail",t[t.ApplyTemplate=90]="ApplyTemplate",t[t.InsertKbArticle=91]="InsertKbArticle",t[t.SendSelected=92]="SendSelected",t[t.SaveAndClose=93]="SaveAndClose",t[t.ReplyEmail=94]="ReplyEmail",t[t.ReplyAllEmail=95]="ReplyAllEmail",t[t.ForwardEmail=96]="ForwardEmail",t[t.Close=97]="Close",t[t.Activate=98]="Activate",t[t.DeActivate=99]="DeActivate",t[t.DeleteBulk=100]="DeleteBulk",t[t.SocialActivityIncoming=101]="SocialActivityIncoming",t[t.SocialActivityOutgoing=102]="SocialActivityOutgoing",t[t.CustomActivity=103]="CustomActivity",t[t.SystemPost=104]="SystemPost",t[t.Convert=105]="Convert",t[t.MarkAsWon=106]="MarkAsWon",t[t.MarkAsLost=107]="MarkAsLost",t[t.SetRegarding=108]="SetRegarding",t[t.SaveAsComplete=109]="SaveAsComplete",t[t.SwitchProcess=110]="SwitchProcess",t[t.Recalculate=111]="Recalculate",t[t.SendDirectEmail=112]="SendDirectEmail",t[t.OpenMailbox=113]="OpenMailbox",t[t.ReOpenOpportunity=114]="ReOpenOpportunity",t[t.ReactivateLead=115]="ReactivateLead",t[t.Disqualify=116]="Disqualify",t[t.Qualify=117]="Qualify",t[t.SelectView=118]="SelectView",t[t.SelectChart=119]="SelectChart",t[t.OpenInBrowser=120]="OpenInBrowser",t[t.NewAppointment=121]="NewAppointment",t[t.NewRecurringAppointment=122]="NewRecurringAppointment",t[t.NewPhoneCall=123]="NewPhoneCall",t[t.NewTask=124]="NewTask",t[t.NewEmail=125]="NewEmail",t[t.AddExisting=126]="AddExisting",t[t.SaveAndEdit=127]="SaveAndEdit",t[t.Default=128]="Default",t[t.ScrollRight=129]="ScrollRight",t[t.ScrollLeft=130]="ScrollLeft",t[t.SaveAndRunRoutingRule=131]="SaveAndRunRoutingRule",t[t.RunRoutingRule=132]="RunRoutingRule",t[t.ResolveCase=133]="ResolveCase",t[t.CancelCase=134]="CancelCase",t[t.ReactivateCase=135]="ReactivateCase",t[t.AddToQueue=136]="AddToQueue",t[t.CreateChildCase=137]="CreateChildCase",t[t.QueueItemRoute=138]="QueueItemRoute",t[t.QueueItemRelease=139]="QueueItemRelease",t[t.QueueItemRemove=140]="QueueItemRemove",t[t.QueueItemPick=141]="QueueItemPick",t[t.Drilldown=142]="Drilldown",t[t.PopOverButton=143]="PopOverButton",t[t.ExitButton=144]="ExitButton",t[t.ExportToExcel=145]="ExportToExcel",t[t.WordTemplates=146]="WordTemplates",t[t.DocumentTemplates=147]="DocumentTemplates",t[t.OpenInPowerBI=148]="OpenInPowerBI",t[t.OpenPowerBIReport=149]="OpenPowerBIReport",t[t.OpenDelve=150]="OpenDelve",t[t.ArticleLink=151]="ArticleLink",t[t.ArchiveArticle=152]="ArchiveArticle",t[t.ApproveArticle=153]="ApproveArticle",t[t.DiscardArticle=154]="DiscardArticle",t[t.Minor=155]="Minor",t[t.Major=156]="Major",t[t.PublishKnowledgeArticle=157]="PublishKnowledgeArticle",t[t.RelateArticle=158]="RelateArticle",t[t.RelateProduct=159]="RelateProduct",t[t.RestoreArticle=160]="RestoreArticle",t[t.RevertToDraftArticle=161]="RevertToDraftArticle",t[t.Translate=162]="Translate",t[t.UpdateArticle=163]="UpdateArticle",t[t.RemoveFilter=164]="RemoveFilter",t[t.Article=165]="Article",t[t.Graph=166]="Graph",t[t.CSR=167]="CSR",t[t.MembersIcon=168]="MembersIcon",t[t.QueueIcon=169]="QueueIcon",t[t.SiteMap=170]="SiteMap",t[t.NormalPriority=171]="NormalPriority",t[t.LowPriority=172]="LowPriority",t[t.ViewIcon=173]="ViewIcon",t[t.RecentCases=174]="RecentCases",t[t.KBRecords=175]="KBRecords",t[t.NumberOfViews=176]="NumberOfViews",t[t.ResizeHandle=177]="ResizeHandle",t[t.TaskBasedFlow=178]="TaskBasedFlow",t[t.InformationIcon=179]="InformationIcon",t[t.PencilIcon=180]="PencilIcon",t[t.ErrorIcon=181]="ErrorIcon",t[t.SuccessIcon=182]="SuccessIcon",t[t.OptionsetIcon=183]="OptionsetIcon",t[t.NotificationIcon=184]="NotificationIcon",t[t.PanelHeaderImportDataIcon=185]="PanelHeaderImportDataIcon",t[t.SidePanelUpload=186]="SidePanelUpload",t[t.New=187]="New",t[t.DetailsPageClose=188]="DetailsPageClose",t[t.SettingsListIcon=189]="SettingsListIcon",t[t.ListIcon=190]="ListIcon",t[t.ForwardDisable=191]="ForwardDisable",t[t.PdfIconFile=192]="PdfIconFile",t[t.PresentationFile=193]="PresentationFile",t[t.OneNoteFile=194]="OneNoteFile",t[t.AccessFile=195]="AccessFile",t[t.VisioFile=196]="VisioFile",t[t.ProjectFile=197]="ProjectFile",t[t.Plus=198]="Plus",t[t.ChevronUp=199]="ChevronUp",t[t.ChevronDown=200]="ChevronDown",t[t.HappySmiley=201]="HappySmiley",t[t.SadSmiley=202]="SadSmiley",t[t.CaseResolution=203]="CaseResolution",t[t.CampaignResolution=204]="CampaignResolution",t[t.ServiceActivity=205]="ServiceActivity",t[t.Notes=206]="Notes",t[t.Audio=207]="Audio",t[t.Camera=208]="Camera",t[t.Video=209]="Video",t[t.Image=210]="Image",t[t.Html=211]="Html",t[t.SharePointEditDocument=212]="SharePointEditDocument",t[t.SharePointDeleteDocument=213]="SharePointDeleteDocument",t[t.SharePointCheckoutDocument=214]="SharePointCheckoutDocument",t[t.SharePointCheckinDocument=215]="SharePointCheckinDocument",t[t.SharePointEditDocumentProperties=216]="SharePointEditDocumentProperties",t[t.SharePointDiscardCheckoutDocument=217]="SharePointDiscardCheckoutDocument",t[t.SharePointNewDocument=218]="SharePointNewDocument",t[t.SharePointNewWordDocument=219]="SharePointNewWordDocument",t[t.SharePointNewExcelDocument=220]="SharePointNewExcelDocument",t[t.SharePointNewPowerPointDocument=221]="SharePointNewPowerPointDocument",t[t.SharePointNewOneNoteDocument=222]="SharePointNewOneNoteDocument",t[t.SharePointUploadDocument=223]="SharePointUploadDocument",t[t.SharePointChangeLocation=224]="SharePointChangeLocation",t[t.SharePointAddDocumentLocation=225]="SharePointAddDocumentLocation",t[t.SharePointEditLocation=226]="SharePointEditLocation",t[t.SharePointOpenLocation=227]="SharePointOpenLocation",t[t.SharePointOpenDocument=228]="SharePointOpenDocument",t[t.SendByEmail=229]="SendByEmail",t[t.CreateQuote=230]="CreateQuote",t[t.Reply=231]="Reply",t[t.Warning=232]="Warning",t[t.Play=233]="Play",t[t.ExpandButton=234]="ExpandButton",t[t.AssociatedArticle=235]="AssociatedArticle",t[t.DisassociatedArticle=236]="DisassociatedArticle",t[t.FormDesign=237]="FormDesign",t[t.GlobalFilterClearAll=238]="GlobalFilterClearAll",t[t.GlobalFilterExpandedRow=239]="GlobalFilterExpandedRow",t[t.GlobalFilterCollapsedRow=240]="GlobalFilterCollapsedRow",t[t.RelationshipAssistant=241]="RelationshipAssistant",t[t.AutomaticSuggestions=242]="AutomaticSuggestions",t[t.SemanticZoom=243]="SemanticZoom",t[t.SemanticZoomMirrored=244]="SemanticZoomMirrored",t[t.BackwardButton=245]="BackwardButton",t[t.MultiSelect=246]="MultiSelect",t[t.MultiSelectMirrored=247]="MultiSelectMirrored",t[t.Spinning=248]="Spinning",t[t.RetireProduct=249]="RetireProduct",t[t.AddProduct=250]="AddProduct",t[t.OfflineStatus=251]="OfflineStatus",t[t.Abandon=252]="Abandon",t[t.Reactivate=253]="Reactivate",t[t.FinishStage=254]="FinishStage",t[t.SortButton=255]="SortButton",t[t.SelectButton=256]="SelectButton",t[t.SelectButtonRTL=257]="SelectButtonRTL",t[t.Flows=258]="Flows",t[t.OpenEntityRecord=259]="OpenEntityRecord",t[t.View=260]="View",t[t.CreateView=261]="CreateView",t[t.EditView=262]="EditView",t[t.GuestUser=263]="GuestUser",t[t.History=264]="History",t[t.ReassignRecords=265]="ReassignRecords",t[t.ManageRoles=266]="ManageRoles",t[t.JoinTeams=267]="JoinTeams",t[t.ChangeManager=268]="ChangeManager",t[t.AddMembers=269]="AddMembers",t[t.RemoveMembers=270]="RemoveMembers",t[t.Download=271]="Download",t[t.SetAsDefaultView=272]="SetAsDefaultView",t[t.Pinned=273]="Pinned",t[t.DistributionList=274]="DistributionList",t[t.MergeRecords=275]="MergeRecords",t[t.AssociateChildCase=276]="AssociateChildCase",t[t.SetAsDefault=277]="SetAsDefault",t[t.ConvertKnowledgeArticle=278]="ConvertKnowledgeArticle",t[t.Messenger=279]="Messenger",t[t.AssociateCategory=280]="AssociateCategory",t[t.OfficeWaffle=281]="OfficeWaffle",t[t.TripleColumn=282]="TripleColumn",t[t.Tiles=283]="Tiles",t[t.HideVisualFilter=284]="HideVisualFilter",t[t.InteractiveDashboard=285]="InteractiveDashboard",t[t.Dynamics365=286]="Dynamics365",t[t.SalesLiterature=287]="SalesLiterature",t[t.Checkbox=288]="Checkbox",t[t.CheckboxComposite=289]="CheckboxComposite"}(t.MicrosoftIconSymbol||(t.MicrosoftIconSymbol={}));t.MicrosoftIconSymbol}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e="GridListContainer",n="GridList";t.entityImgUrlAlias="entityimage_url",t.tapHoldThreshold=800;var r=function(){function r(e){var n=this;this._onClickCapture=function(t){n._clearTimer()},this._onPointerMove=function(t){n._clearTimer()},this._onPointerDown=function(e,r){n._timer=setTimeout(function(){return n._tapHold(e,r)},t.tapHoldThreshold)},this._clearTimer=function(){n._timer&&(clearTimeout(n._timer),n._timer=null)},this._tapHold=function(t,e){n._clearTimer(),t.preventDefault()},this._setContext(e),this._cardStates={}}return Object.defineProperty(r.prototype,"dataSet",{get:function(){return this._dataSet},enumerable:!0,configurable:!0}),r.prototype.render=function(t){return t.parameters.Grid.working||!t.parameters.Grid.sortedRecordIds.length?null:(this._setContext(t),this._createList(this))},r.prototype._createList=function(t){var n=this._context.parameters.Grid.hasError?this._getErrorPlaceholder():this._getListItemsContent(),r=[this._getTitle(),n];return this._context.factory.createElement("CONTAINER",{key:e,id:e,role:"presentation",style:{display:"flex",flexDirection:"column",backgroundColor:this._context.theming.colors.whitebackground,overflow:"hidden",position:"relative",width:"100%"}},r)},r.prototype._getErrorPlaceholder=function(){var e={fontSize:"2em",fontWeight:"normal",color:"red"};return this._context.factory.createElement("PLACEHOLDER",{text:this._context.parameters.Grid.errorMessage,icon:t.MicrosoftIconSymbol.DetailsPageClose,iconStyle:e})},r.prototype._getTitle=function(){var t=this._context.mode._customControlProperties.descriptor.Label;return t?this._context.factory.createElement("CONTAINER",{key:"ListHeader",id:"ListHeader",style:{display:"flex",flexDirection:"column",flex:"0 0 auto",borderBottom:"1px "+this._context.theming.solidborderstyle+" "+this._context.theming.colors.grays.gray03,paddingLeft:this._context.theming.measures.measure100,paddingRight:this._context.theming.measures.measure100,paddingTop:this._context.theming.measures.measure050,paddingBottom:this._context.theming.measures.measure050,fontFamily:this._context.theming.fontfamilies.semibold,fontSize:this._context.theming.fontsizes.font100,color:this._context.theming.colors.basecolor.grey.grey7,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},t):null},r.prototype._setContext=function(t){var e=t.parameters.Grid;this._recordsDataInit&&!e.working&&this._recordsDataInit(e),this._context=t,this._recordIds=e.sortedRecordIds},r.prototype._getListItemsContent=function(){return this._context.factory.createElement("CONTAINER",{key:n,id:n,role:"presentation",style:{flex:"1 1 auto",display:"block",overflowX:"hidden",overflowY:"auto"}},this._getListItems())},r.prototype._getListItems=function(){var e=this,n=[],r=this._context.parameters.Grid,o=this._recordIds.map(function(t){return r.records[t]});return o.forEach(function(r,o){var i=r.getRecordId(),a=e._cardStates[i]||(e._cardStates[i]=new t.MailAppListItemComponent(e._context,r,e)),s={backgroundColor:e._context.theming.colors.grays.gray03},c=o?"1px "+e._context.theming.solidborderstyle+" "+e._context.theming.colors.grays.gray03:void 0,l={display:"block",listStyleType:"none",cursor:"pointer",paddingLeft:e._context.theming.measures.measure100,paddingRight:e._context.theming.measures.measure100,borderTop:c,":hover":s},u=e._context.factory.createElement("LISTITEM",{id:"ListItem_"+i,key:"ListItem_"+i,tabIndex:-1,role:"menuitem",style:l,onClickCapture:e._onClickCapture,onPointerMove:e._onPointerMove,onPointerDown:function(t){return e._onPointerDown(t,i)}},a.render(r));n.push(u)}),n},r}();t.MailAppListComponent=r}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e=function(){function e(t,e,n){this._context=t;var r=e.getNamedReference();this._props={entityName:r&&r.LogicalName,entityPrimaryField:this._getEntityPrimaryField(t)}}return e.prototype.render=function(t){return this._cardComponent||(this._cardComponent=this._createDefaultTemplate()),this._cardComponent.state={dataSetRecord:t},this._cardComponent.render()},e.prototype._createDefaultTemplate=function(){return new t.MailAppListDefaultTemplate(this._context,this._props)},e.prototype._getEntityPrimaryField=function(t){var e=t.parameters.Grid.columns.find(function(t){return t.isPrimary});return e?e.name:t.parameters.Grid.columns[0].name},e}();t.MailAppListItemComponent=e}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e="Whole.Duration",n=function(){function n(t,e){this._state={dataSetRecord:null},this._context=t,this._props=e}return Object.defineProperty(n.prototype,"state",{set:function(t){Object.assign(this._state,t)},enumerable:!0,configurable:!0}),n.prototype.render=function(){var t=this._state.dataSetRecord.getRecordId(),e=[this.renderEntityImage(),this._renderListItemContent()];
return e.push(this.renderCommandBar()),this._context.factory.createElement("CONTAINER",{key:"ListItem_"+t,id:"ListItem_"+t,style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between","font-size":this._context.theming.fontsizes.font100,"line-height":this._context.theming.measures.measure150,"font-family":this._context.theming.fontfamilies.regular,"padding-top":this._context.theming.measures.measure100,"padding-bottom":this._context.theming.measures.measure100,height:this._context.theming.measures.measure450},onClick:this._onListItemClickHandler.bind(this)},e)},n.prototype.renderField=function(t,n){var r=this._state.dataSetRecord,o=this.getFieldType(t)===e,i=o?r.reformatValue(t):r.getFormattedValue(t);return i?this._renderLabel(i,n):null},n.prototype._onListItemClickHandler=function(t){var e={Id:new Common.Guid(this._state.dataSetRecord.getRecordId()),Name:null,LogicalName:this._props.entityName};this._context.parameters.Grid.openDatasetItem(e),t.preventDefault(),t.stopPropagation()},n.prototype.renderEntityImage=function(){var t=this._context.factory.createElement("ENTITYIMAGE",{key:"ListCardEntityImage",hasPrimaryImageField:!0,style:{borderRadius:"50%",display:"block",width:"100%",height:"100%"},entityPrimaryField:this._state.dataSetRecord.getFormattedValue(this._props.entityPrimaryField)});return this._context.factory.createElement("CONTAINER",{key:"ListCardImage",id:"ListCardImage",style:{display:"flex","justify-content":"center","align-items":"center",flex:"0 0 "+this._context.theming.measures.measure250,"border-radius":"50%",width:this._context.theming.measures.measure250,height:this._context.theming.measures.measure250,"line-height":this._context.theming.measures.measure250,"background-color":this._context.theming.colors.grays.gray01,color:this._context.theming.colors.basecolor.white,"font-size":"16px","text-align":"center","margin-right":this._context.theming.measures.measure100,overflow:"hidden"}},t)},n.prototype.renderCommandBar=function(){var e=this,n=this._context.parameters.ListItemCommands&&this._context.parameters.ListItemCommands.raw;if(n){var r=this._state.dataSetRecord.getRecordId(),o=this._context.parameters.ListItemCommands.raw.split("|").filter(function(t){return!!t});if(this._context.parameters.Grid.retrieveRecordCommand([r],o,void 0,!0,!0).then(function(t){void 0===t&&(t=[]);var n=t.filter(function(t){return t.shouldBeVisible}),r=n[0],o=r?r.commandId:"",i=e._command?e._command.commandId:"";o!==i&&(e._command=r,e._context.utils.requestRender())},function(t){console.log(t)}),this._command){var i="CardCommandButton_"+r,a=this._command.icon?t.MicrosoftIconSymbol[this._command.icon]:t.MicrosoftIconSymbol.LinkArticle,s=this._context.factory.createElement("MICROSOFTICON",{id:"CardCommandIcon",key:"CardCommandIcon",type:a}),c=this._context.factory.createElement("BUTTON",{id:i,key:i,title:this._command.label,accessibilityLabel:this._command.label,role:"button",tabIndex:0,onClick:function(t){e._command.canExecute&&(e._command.execute(),t.preventDefault(),t.stopPropagation())},style:{backgroundColor:"transparent",borderStyle:this._context.theming.noneborderstyle,"line-height":"32px",width:"32px",padding:"0px","font-size":"16px",cursor:"pointer",color:this._context.theming.colors.grays.gray07,display:"block","text-align":"center"}},[s]);return this._context.factory.createElement("CONTAINER",{key:"CardCommandContainer_"+r,id:"CardCommandContainer_"+r,style:{display:"block",flex:"0 0 auto",alignSelf:"flex-start"}},[c])}return null}return null},n.prototype._renderListItemContent=function(){var e=[],n=this._props.entityPrimaryField,r=this._renderListItemField(n,!0);r&&e.push(r);for(var o=3,i=0;i<this._context.parameters.Grid.columns.length&&e.length<o;i++){var a=this._context.parameters.Grid.columns[i];if(a.name!==n&&a.alias!==t.entityImgUrlAlias){var s=this._renderListItemField(a.name,!1);s&&e.push(s)}}return this._context.factory.createElement("CONTAINER",{key:"ListItemContent",id:"ListItemContent",style:{display:"block",width:"100%",overflow:"hidden","white-space":"nowrap","margin-right":this._context.theming.measures.measure025}},e)},n.prototype._renderListItemField=function(t,e){var n=this.renderField(t,e);return n?this._context.factory.createElement("CONTAINER",{key:"FieldValue_"+t,id:"FieldValue_"+t,style:{display:"block",overflow:"hidden","text-overflow":"ellipsis"}},n):null},n.prototype.getFieldType=function(t){var e=this._context.parameters.Grid.columns;if(e){var n=e.find(function(e){return e.name===t});return n&&n.dataType}},n.prototype._renderLabel=function(t,e){return void 0===e&&(e=!1),this._context.factory.createElement("LABEL",{key:"ListItemLabel",title:t,style:{display:"block","text-decoration":"none",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer",color:e?this._context.theming.colors.grays.gray07:this._context.theming.colors.grays.gray05}},t)},n}();t.MailAppListDefaultTemplate=n}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e=function(){function e(){var t=this;this._onTrackStatusChange=function(){return t._context.utils.requestRender()}}return e.prototype.init=function(e,n,r){var o=e&&e.externalContext&&e.externalContext.getAvailableExternalContexts();o&&o.getByName(Constants.contextId)&&(this._context=e,this._listComponent=new t.MailAppListComponent(this._context),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackStatus,{updateListener:this._onTrackStatusChange}))},e.prototype.updateView=function(t){return this._context=t,this._context.parameters.Grid.working?void 0:this._listComponent.render(this._context)},e.prototype.getOutputs=function(){return null},e.prototype.destroy=function(){this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.TrackStatus,this._onTrackStatusChange)},e}();t.MailAppListControl=e}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var Models;!function(t){!function(t){t[t.Sender=1]="Sender",t[t.To=2]="To",t[t.Cc=3]="Cc",t[t.Bcc=4]="Bcc",t[t.Organizer=5]="Organizer",t[t.RequiredAttendee=6]="RequiredAttendee",t[t.OptionalAttendee=7]="OptionalAttendee"}(t.RecipientRole||(t.RecipientRole={}));t.RecipientRole}(Models||(Models={}));var Models;!function(t){var e=function(e){function n(t,n,r){e.call(this,{Id:t||"",LogicalName:n,Name:r.name}),this._dataValues=r}return __extends(n,e),n.ExternalContextRecipientToRecipientRecord=function(e){return new t.RecipientRecord(e.entityReference.Id&&e.entityReference.Id.guid,e.entityReference.LogicalName,e.dataValues)},n.prototype.getFormattedValue=function(t){return this._dataValues[t]},n.prototype.setValue=function(t,e){return this._isDirty=!0,this._dataValues[t]=e,null},n.prototype.isDirty=function(){return this._isDirty},n}(t.BaseDataSetRecord);t.RecipientRecord=e}(Models||(Models={}));var Enums;!function(t){!function(t){t[t.Allowed=1]="Allowed",t[t.ForbiddenOccurence=2]="ForbiddenOccurence",t[t.ForbiddenMeetingInviteRequest=3]="ForbiddenMeetingInviteRequest",t[t.ForbiddenMeetingInviteResponse=4]="ForbiddenMeetingInviteResponse",t[t.ForbiddenForOrganizerResolvedAsUser=5]="ForbiddenForOrganizerResolvedAsUser",t[t.ForbiddenInLimitedMode=6]="ForbiddenInLimitedMode"}(t.TrackAllowedStatus||(t.TrackAllowedStatus={}));t.TrackAllowedStatus}(Enums||(Enums={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e="name",n="emailaddress",r="entityImage",o="entityHealthScore",i="RecipientsTabsScrollContainer",a="RecipientTab_",s="distributionList",c="externalUser",l="other",u="membersicon",d=function(){function t(){var t=this;this._startTabIndex=0,this._onSelectedRecipientChange=function(e){e&&1===e.status&&t._selectedRecipientExternalPropertyValue!==e.value&&(t._selectedRecipientExternalPropertyValue=e.value,t._selectedRecord=null,t._context.utils.requestRender())},this._onResolveRecipients=function(e){1===e.status&&t._processRecipientsChange(e.value,!0)}}return Object.defineProperty(t.prototype,"RecipientsRecords",{get:function(){return this._recipientsRecords||[]},set:function(t){this._recipientsRecords=t},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e,n){this._notifyOutputChanged=e,this._context=t,this._getRecipients()},t.prototype.updateView=function(t){return this._context=t,-1!==this._getCurrentRecipientsCount()&&this._itemType?0===this._getCurrentRecipientsCount()&&this._itemType?this._createNoRecipientControl():(this._updateSelection(),t.factory.createElement("CONTAINER",{id:"RecipientsTabContainer",key:"RecipientsTabContainer",style:{display:"block",width:"100%","font-family":this._context.theming.fontfamilies.regular,color:this._context.theming.colors.grays.gray05,"background-color":this._context.theming.colors.whitebackground}},[this._createHeaderLabel(),this._createRecipientsTabs(this.RecipientsRecords)])):null},t.prototype._createHeaderLabel=function(){var t="";return this._itemType&&(t=this._context.resources.getString("MailAppRecipientsTabControl_"+(this._itemType===Constants.MailboxItemTypes.Message?"Recipients":"Attendees")+"_Header")),this._context.factory.createElement("TEXT",{id:"RecipientsTabContainerHeader",key:"RecipientsTabContainerHeader",semanticTag:"h2",style:{display:"block","font-size":this._context.theming.measures.measure100,"line-height":this._context.theming.measures.measure100,padding:this._context.theming.measures.measure100,"font-weight":"normal"}},t)},t.prototype._createNoRecipientControl=function(){var t=this._context.resources.getString(this._itemType===Constants.MailboxItemTypes.Message?"MailAppRecipientsTabControl_No_Recipients":"MailAppRecipientsTabControl_No_Attendees");return this._context.factory.createElement("LABEL",{id:"No_Recipients_Label",key:"No_Recipients_Label",style:{display:"block",padding:this._context.theming.measures.measure100}},t)},t.prototype._createRecipientsTabs=function(t){var e=this,n=t.map(function(n,r){return e._createRecipientTab(n,r,t.length)});return this._context.factory.createElement("HORIZONTALSCROLL",{id:i,key:"RecipientsTabsScrollContainer",startChildIndex:this._startTabIndex,scrollViewStyle:{overflowX:"hidden"},arrowButtonStyle:{height:"52px",border:"0px "+this._context.theming.noneborderstyle,color:this._context.theming.colors.grays.gray05,"font-size":"16px","background-color":this._context.theming.colors.whitebackground,padding:"0px",cursor:"pointer",":disabled":{opacity:"0"}},arrowWidth:16,prevArrowIconType:2,nextArrowIconType:71},n)},t.prototype._onKeyUp=function(t,e,n){switch(t.keyCode){case 37:this._context.userSettings.isRTL?this._focusNextRecipient(e,n):this._focusPreviousRecipient(e,n);break;case 39:this._context.userSettings.isRTL?this._focusPreviousRecipient(e,n):this._focusNextRecipient(e,n);break;case 36:this._context.accessibility.focusElementById(this._getRecipientTabId(0));break;case 35:this._context.accessibility.focusElementById(this._getRecipientTabId(n-1));break;case 13:this._changeSelectTab(this.RecipientsRecords[e])}},t.prototype._focusPreviousRecipient=function(t,e){var n=t-1;-1===n&&(n=e-1),this._context.accessibility.focusElementById(this._getRecipientTabId(n))},t.prototype._focusNextRecipient=function(t,e){var n=t+1;n===e&&(n=0),this._context.accessibility.focusElementById(this._getRecipientTabId(n))},t.prototype._getUnquotedName=function(t){return t&&"'"===t.charAt(0)&&"'"===t.charAt(t.length-1)&&(t=t.substring(1,t.length-1)),t},t.prototype._createRecipientTab=function(t,i,s){var c=this,d=this._getUnquotedName(t.getFormattedValue(e)),p=t.getFormattedValue(n),m=this._getRecordEntityLogicalName(t),h=this._context.theming.measures.measure350,g=t.getFormattedValue(o),_={entityName:m&&m!==l?m:u},y={width:h,height:h,"font-size":this._isDistributionList(t)?this._context.theming.fontsizes.font150:this._context.theming.fontsizes.font115,"font-family":this._context.theming.fontfamilies.regular,display:"block","line-height":g?this._context.theming.measures.measure250:h,"border-radius":"50%","box-sizing":"border-box",color:this._context.theming.colors.base.white,border:(g?this._context.theming.measures.measure050:"0px")+" "+this._context.theming.solidborderstyle+" "+this._context.theming.colors.whitebackground},f=t.getFormattedValue(r),C=this._context.factory.createElement("ENTITYIMAGE",{id:"Img_"+i,hasPrimaryImageField:d!==p,entityReference:_,style:y,entityPrimaryField:d,imageSrc:f?"data:image;base64,"+f:null,entityHealthScore:g,alt:this._getEntityImageAltText(t)}),x={flex:"0 0 "+h,display:"block","text-align":"center",marginLeft:!this._context.client.isRTL&&i?this._context.theming.measures.measure100:"0px",marginRight:this._context.client.isRTL&&i?this._context.theming.measures.measure100:"0px",cursor:"pointer"},R=this._selectedRecord&&this._selectedRecord.getFormattedValue(n)===t.getFormattedValue(n),S=this._getRecipientTabId(i),v=a+p;return this._context.factory.createElement("CONTAINER",{id:S,key:v,style:x,tabIndex:0,title:d||p,onClick:this._changeSelectTab.bind(this,t),onKeyUp:function(t){c._onKeyUp(t,i,s)}},[C,this._renderRecipientName(d,p,i,R)])},t.prototype._updateSelection=function(){var t=this._selectedRecord&&this._selectedRecord.getFormattedValue(n);this._applySelection(t||this._selectedRecipientExternalPropertyValue)},t.prototype._isSelectedRecordChanged=function(t){var e=!this._isSelectedRecordEmailAddressSame(t&&t.getFormattedValue(n)),r=this._isCRMRecord(this._selectedRecord)!==this._isCRMRecord(t);return e||r},t.prototype._getRecordByEmailAddress=function(t){for(var e=0;e<this.RecipientsRecords.length;e++){var r=this.RecipientsRecords[e],o=r.getFormattedValue(n);if(o&&t&&o.toLowerCase()===t.toLowerCase())return r}return null},t.prototype._isSelectedRecordEmailAddressSame=function(t){return t&&this._selectedRecord&&this._selectedRecord.getFormattedValue(n)&&this._selectedRecord.getFormattedValue(n).toLowerCase()===t.toLowerCase()},t.prototype._getRecipients=function(){var t=this,e=this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.SelectedRecipient,{updateListener:this._onSelectedRecipientChange});Promise.all([this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.ItemType),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.ResolvedRecipients,{updateListener:this._onResolveRecipients})]).then(function(n){var r=n[0],o=n[1];t._itemType=r,e.then(function(e){t._selectedRecipientExternalPropertyValue=e,t._processRecipientsChange(o)},function(){t._processRecipientsChange(o)})})["catch"](function(t){})},t.prototype._processRecipientsChange=function(t,e){if(void 0===e&&(e=!1),t&&t.recipients){var n=t.recipients,r=n.map(Models.RecipientRecord.ExternalContextRecipientToRecipientRecord),o=!this._recipientsRecords,i=t&&t.isNewMailboxItem;if(!i&&r.length||(this._selectedRecord=null),!o&&!i){var a=this._getEmailsAddressDetailsChangesFlags(r);(a.isRecipientsWereAdded||a.isRecipientsWereRemoved)&&this._showRecipientsChangedNotification(a)}var s=r.find(function(t){var e=t.getFormattedValue("role");return e===Models.RecipientRole.Sender||e===Models.RecipientRole.Organizer});(this._isSenderChanged(s)||i)&&(this._currentSender=s),this.RecipientsRecords=r,this._notifyOutputChanged(),this._context.utils.requestRender()}},t.prototype._showRecipientsChangedNotification=function(t){var e=this,n=this._itemType===Constants.MailboxItemTypes.Message?"Recipients_":"Attendees_",r="Were_Added";t.isRecipientsWereAdded&&t.isRecipientsWereRemoved?r="Were_Added_And_Removed":t.isRecipientsWereRemoved&&(r="Were_Removed");var o=this._context.resources.getString("MailAppRecipientsTabControl_"+n+r);this._lastRecepientChangedNotificationId&&this._context.utils.clearGlobalNotification(this._lastRecepientChangedNotificationId),this._context.utils.addGlobalNotification(1,1,o,"",null,null).then(function(t){e._lastRecepientChangedNotificationId=t})},t.prototype._getCurrentRecipientsCount=function(){return this._recipientsRecords?this._recipientsRecords.length:-1},t.prototype._getEmailsAddressDetailsChangesFlags=function(t){var e=this;if(this._recipientsRecords){var n=!1,r={};return(t||[]).forEach(function(t){r[e._getRecipientEmail(t)]=!0}),this.RecipientsRecords.forEach(function(t){var o=e._getRecipientEmail(t);r[o]?delete r[o]:n=!0}),{isRecipientsWereAdded:Object.keys(r).length>0,isRecipientsWereRemoved:n}}},t.prototype._getRecipientEmail=function(t){var e=t.getFormattedValue(Constants.PropertyNames.Email);return e&&e.toLowerCase()},t.prototype._isSenderChanged=function(t){return t&&this._currentSender?this._currentSender.getFormattedValue(Constants.PropertyNames.Email)!==t.getFormattedValue(Constants.PropertyNames.Email):Boolean(t||this._currentSender)},t.prototype._applySelection=function(t){if(this.RecipientsRecords&&this.RecipientsRecords.length){for(var e,r=0;r<this.RecipientsRecords.length;r++){var o=this.RecipientsRecords[r],i=o.getFormattedValue(n);if(i&&t&&i.toLowerCase()===t.toLowerCase()){e=o;break}e||!o.getNamedReference()||o.getNamedReference().LogicalName!==Constants.CrmTypeNames.Contact&&o.getNamedReference().LogicalName!==Constants.CrmTypeNames.Lead&&o.getNamedReference().LogicalName!==Constants.CrmTypeNames.Account&&o.getNamedReference().LogicalName!==c||(e=o)}e||(e=this.RecipientsRecords[0]),this._isSelectedRecordChanged(e)&&(this._setSelectedRecord(e),this._context.utils.requestRender())}},t.prototype._isDistributionList=function(t){return this._getRecordEntityLogicalName(t)===s},t.prototype._getEntityImageAltText=function(t){if(this._isCRMRecord(t)){var r=t.getFormattedValue(e),i=t.getFormattedValue(o);if(i){var a=this._context.resources.getString("MailAppRecipientsTabControl_RecipientFullName_WithScore");return this._format(a,r,i)}var a=this._context.resources.getString("MailAppRecipientsTabControl_RecipientFullName");return this._format(a,r)}var a=this._context.resources.getString("MailAppRecipientsTabControl_UnknownRecipientWithEmail");return this._format(a,t.getFormattedValue(n))},t.prototype._getRecipientTabId=function(t){return a+t},t.prototype._renderRecipientName=function(t,e,n,r){return this._context.factory.createElement("CONTAINER",{id:"Name_"+n,key:"Name_"+e,style:{display:"block",width:this._context.theming.measures.measure350,whiteSpace:"normal","text-overflow":"ellipsis",overflow:"hidden","font-size":this._context.theming.fontsizes.font075,height:this._context.theming.fontsizes.font175,"line-height":this._context.theming.fontsizes.font175,"margin-bottom":this._context.theming.measures.measure075,"border-bottom":"3px "+this._context.theming.solidborderstyle+" "+(r?this._context.theming.colors.basecolor.blue.blue3:this._context.theming.colors.whitebackground)}},[this._getRecipientFirstName(t,e)])},t.prototype._getRecipientFirstName=function(t,e){var n=-1!==(t||e).indexOf("@");if(t&&!n){var r=t.split(",");if(r.length>1)return r[r.length-1];var o=t.split(" ");return o.slice(0,-1).join(" ")||t}return e.substring(0,e.indexOf("@"))},t.prototype._changeSelectTab=function(t){this._setSelectedRecord(t),this._context.utils.requestRender(),t&&t.getFormattedValue(n)&&this._context.externalContext.invokeExternalContextAction(Constants.contextId,Constants.ActionIds.SetSelectedRecipient,{args:{selectedRecipient:t.getFormattedValue(n)}})},t.prototype._setSelectedRecord=function(t){this._selectedRecord=t,this._notifyOutputChanged()},t.prototype._isCRMRecord=function(t){var e=this._getRecordEntityLogicalName(t);return e&&-1!==Constants.RecipientCRMTypeNames.indexOf(e)},t.prototype._getRecordEntityLogicalName=function(t){return t&&t.getNamedReference()&&t.getNamedReference().LogicalName},t.prototype._format=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})},t.prototype.getOutputs=function(){var t={selectedCrmRecord:this._isCRMRecord(this._selectedRecord)?this._selectedRecord:null,selectedUnresolvedRecord:this._isCRMRecord(this._selectedRecord)?null:this._selectedRecord};return t},t.prototype.destroy=function(){this._lastRecepientChangedNotificationId&&this._context.utils.clearGlobalNotification(this._lastRecepientChangedNotificationId),this._lastAvoidDuplicatesNotificationId&&this._context.utils.clearGlobalNotification(this._lastAvoidDuplicatesNotificationId),this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.SelectedRecipient,this._onSelectedRecipientChange),this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.ResolvedRecipients,this._onResolveRecipients)},t}();t.MailAppRecipientsTabControl=d}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var Models;!function(t){var e=function(){function t(t,e,n){if(this.MetadataType=null,this.MetadataSubtype=null,this.EntityLogicalName=null,this.MetadataId=null,this.MetadataName=null,this.GetDefault=!0,this.DependencyDepth=2,this.ChangedAfter=null,this.Exclude=[],this.AppId=null,!t||!e)throw new Error("Can't construct metadata query");this.MetadataType=t,this.MetadataSubtype=e,this.EntityLogicalName=n}return t.prototype.getMetadata=function(){return{boundParameter:null,parameterTypes:{MetadataType:{typeName:"Edm.String",structuralProperty:1},MetadataSubtype:{typeName:"Edm.String",structuralProperty:1},EntityLogicalName:{typeName:"Edm.String",structuralProperty:1},MetadataId:{typeName:"Edm.Guid",structuralProperty:1},MetadataName:{typeName:"Edm.String",structuralProperty:1},GetDefault:{typeName:"Edm.Boolean",structuralProperty:1},DependencyDepth:{typeName:"Microsoft.Dynamics.CRM.DependencyDepth",structuralProperty:3,enumProperties:[{name:"Unknown",value:0},{name:"OnDemandWithContext",value:1},{name:"OnDemandWithoutContext",value:2},{name:"OnDemandContextOnly",value:3},{name:"Offline",value:4},{name:"Mobile",value:5}]},ChangedAfter:{typeName:"Edm.String",structuralProperty:1},Exclude:{typeName:"Edm.Guid",structuralProperty:4},AppId:{typeName:"Edm.Guid",structuralProperty:1}},operationName:null,operationType:null}},t}();t.MetadataQuery=e;var n=function(){function t(t,n,r){this.ClientMetadataQuery=new e(t,n,r)}return t.prototype.getMetadata=function(){return{boundParameter:null,parameterTypes:{ClientMetadataQuery:{typeName:"Microsoft.Dynamics.CRM.MetadataQuery",structuralProperty:2}},operationName:"GetClientMetadata",operationType:1}},t}();t.GetClientMetadataRequest=n}(Models||(Models={}));var Models;!function(t){var e=function(){function t(t){this.columns=["LogicalName"],this.filter="$filter="+t}return t.prototype.getMetadata=function(){return{boundParameter:void 0,parameterTypes:void 0,operationType:2,operationName:"EntityDefinitions"}},t}();t.GetEntityDefinition=e}(Models||(Models={}));var Models;!function(t){var e=function(t){function e(e,n){t.call(this,"LogicalName eq '"+e+"'&$expand=Attributes($filter="+n+")")}return __extends(e,t),e}(t.GetEntityDefinition);t.GetEntityAttributeRequest=e}(Models||(Models={}));var Models;!function(t){var e=function(t){function e(e){t.call(this,"ObjectTypeCode eq "+e)}return __extends(e,t),e}(t.GetEntityDefinition);t.GetEntityNameRequest=e}(Models||(Models={}));var Retrievers;!function(t){var e=function(){function t(t,e){this._utils=e,this._executeFunction=t}return t.prototype._execute=function(t,e,n){this._executeFunction(t).then(function(t){t.json().then(function(t){if(t&&t.Metadata)try{var r=JSON.parse(t.Metadata);e(r)}catch(o){n(o)}else n(new Error("odataResponse.Metadata is empty"))},n)},n)},t.prototype.requestEntitiesMetadata=function(t,e,n){var r={};t.forEach(function(t){r[t]=[]}),this._execute(new Models.GetClientMetadataRequest("entity",JSON.stringify(r).replace(/\"/g,'\\"'),null),e,n)},t.prototype.requestDefaultFormMetadata=function(t,e,n,r){this._execute(new Models.GetClientMetadataRequest("form",e,t),n,r)},t.prototype.requestEntityNameFromTypeCode=function(t){return this._executeFunction(new Models.GetEntityNameRequest(t)).then(function(t){return t.json().then(function(t){if(t&&t.value&&t.value[0]&&t.value[0].LogicalName)return t.value[0].LogicalName;throw new Error("Unable to determine entity name from type code")})})},t.prototype.requestRegardingTargets=function(){var t="regardingobjectid",e="activitypointer",n=this._utils.isFeatureEnabled("MailAppAttributeTargets");return n?this._getEntityAttributeTargets(e,t):this._requestTargets(e,t)},t.prototype._getEntityAttributeTargets=function(t,e){return this._utils.getEntityMetadata(t,[e]).then(function(t){return t.Attributes.getByName(e).Targets})["catch"](function(){throw new Error("Unable to get activitypointer regarding object targets")})},t.prototype._requestTargets=function(t,e){var n="LogicalName eq '"+e+"'",r=new Models.GetEntityAttributeRequest(t,n);return this._executeFunction(r).then(function(t){return t.json()}).then(function(t){if(t&&t.value&&t.value[0]&&t.value[0].Attributes&&t.value[0].Attributes[0]&&t.value[0].Attributes[0].Targets)return t.value[0].Attributes[0].Targets;throw new Error("Unable to get activitypointer regarding object targets")})},t}();t.MetadataRequestor=e}(Retrievers||(Retrievers={}));var Retrievers;!function(t){var e=function(){function t(t){this._mapping={1:"account",2:"contact",3:"opportunity",4:"lead",8:"systemuser",112:"incident"},this._metadataRequestor=t,this._listeners=[],this._errorListeners=[]}return t.prototype.onChanged=function(t){this._listeners.push(t)},t.prototype.onFailed=function(t){this._errorListeners.push(t)},t.prototype.getMapping=function(){return this._mapping},t.prototype.getEntityName=function(t){var e=this;return this._mapping[t]?this._mapping[t]:(this._metadataRequestor.requestEntityNameFromTypeCode(t).then(function(n){e._mapping[t]=n,e._notify()},function(t){e._notifyError(t)}),null)},t.prototype._notify=function(){var t=this;this._listeners.forEach(function(e){e(t._mapping)})},t.prototype._notifyError=function(t){this._errorListeners.forEach(function(e){e(t)})},t}();t.ObjectTypeCodeToLogicalNameMappingRetriever=e}(Retrievers||(Retrievers={}));var Retrievers;!function(t){!function(t){t[t.Success=0]="Success",t[t.SaveAsyncError=1]="SaveAsyncError",t[t.SaveAsyncUnavailable=2]="SaveAsyncUnavailable",t[t.ExchangeCallError=3]="ExchangeCallError",t[t.EwsErrorResponseCode=4]="EwsErrorResponseCode",t[t.RestErrorDelegateAccess=5]="RestErrorDelegateAccess",t[t.ErrorDelegateAccessMissingWritePermission=6]="ErrorDelegateAccessMissingWritePermission",t[t.ErrorDelegateAccessSaveAsync=7]="ErrorDelegateAccessSaveAsync"}(t.RetrieveState||(t.RetrieveState={}));var e=(t.RetrieveState,function(){function e(e){var n=this;this._trackStatus=null,this._trackAllowedStatus=null,this._typeNamesWithRegarding=[],this.onChanged=function(t){n._listeners.push(t)},this.onFailed=function(t){n._errorListeners.push(t)},this._notify=function(){n._listeners.forEach(function(t){t(n._trackStatus,n._trackAllowedStatus)})},this._notifyError=function(t){var e=[{name:"Error",value:JSON.stringify(t)}];n._context.reporting.reportFailure("MailApp.Control.TrackBar.TrackStatusRetriever",new Error(t.message),null,e),n._errorListeners.forEach(function(e){e(t)})},this._onTrackStatusChange=function(t){var e=t&&t.value?t.value:null,r=n._setTrackStatus(e);r&&n._notify()},this._onTrackAllowedStatusChange=function(t){var e=t?t.value:null,r=n._setTrackAllowedStatus(e);r&&n._notify()},this._context=e,this._metadataRequestor=new t.MetadataRequestor(e.webAPI.execute.bind(e.webAPI),this._context.utils),this._listeners=[],this._errorListeners=[],this._mappingRetriever=new t.ObjectTypeCodeToLogicalNameMappingRetriever(this._metadataRequestor),this._mappingRetriever.onChanged(this._notify),this._mappingRetriever.onFailed(this._notifyError)}return Object.defineProperty(e.prototype,"hasRegardingObject",{get:function(){return this._trackStatus&&this._trackStatus.crmRegardingObjectId&&-1===this._trackStatus.crmRegardingObjectId.indexOf(Common.Guid.EMPTY.toString())&&this._trackStatus.crmRegardingObjectType&&(this._trackStatus.crmTrackingState===Models.TrackingState.IsLinked||this._trackStatus.crmTrackingState===Models.TrackingState.WillBeLinked||this._trackStatus.crmTrackingState===Models.TrackingState.LinkFailed)},enumerable:!0,configurable:!0}),e.prototype.init=function(){this._retrieveTrackStatus()},e.prototype.getTypeNamesWithRegarding=function(){return this._typeNamesWithRegarding||[]},e.prototype.getTrackStatus=function(){return this._trackStatus},e.prototype.isTrackAllowed=function(){return this._trackAllowedStatus===Enums.TrackAllowedStatus.Allowed},e.prototype.trackAllowedStatus=function(){return this._trackAllowedStatus},e.prototype.isTrackPending=function(){return this._trackStatus&&this._trackStatus.crmTrackingState===Models.TrackingState.WillBeLinked},e.prototype.isUntrackPending=function(){return this._trackStatus&&this._trackStatus.crmTrackingState===Models.TrackingState.WillBeUnlinked},e.prototype.getRegardingObject=function(){return this.hasRegardingObject&&this._mappingRetriever.getEntityName(this._trackStatus.crmRegardingObjectType)?new Models.BaseDataSetRecord({Id:this._trackStatus.crmRegardingObjectId||"",LogicalName:this._mappingRetriever.getEntityName(this._trackStatus.crmRegardingObjectType),Name:this._trackStatus.crmRegardingObjectName}):null},e.prototype.destroy=function(){this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.TrackStatus,this._onTrackStatusChange),this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.TrackAllowedStatus,this._onTrackAllowedStatusChange),this._listeners=[]},e.prototype._retrieveTrackStatus=function(){var t=this;Promise.all([this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackStatus,{updateListener:this._onTrackStatusChange}),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackAllowedStatus,{updateListener:this._onTrackAllowedStatusChange}),this._metadataRequestor.requestRegardingTargets()]).then(function(e){var n=e[0],r=e[1],o=e[2],i=t._setTrackStatus(n),a=t._setTrackAllowedStatus(r),s=t._setTypeNamesWithRegarding(o);if(s){var c={eventName:"uci_trace",eventParameters:[{name:"Data",value:JSON.stringify({RegardingTypes:o})},{name:"Message",value:"Types for Regarding lookup changed"},{name:"ComponentName",value:"MailApp.Control.SetRegardingNames"},{name:"ApplicationEventLevel",value:"1"}]};t._context.reporting.reportEvent(c)}(i||a||s)&&t._notify()},this._notifyError)},e.prototype._setTrackStatus=function(t){void 0===t&&(t=null);var e=t&&this._trackStatus?t.crmTrackingState===this._trackStatus.crmTrackingState&&t.crmRegardingObjectId===this._trackStatus.crmRegardingObjectId&&t.crmRegardingObjectType===this._trackStatus.crmRegardingObjectType:t===this._trackStatus;return this._trackStatus=t,!e},e.prototype._setTrackAllowedStatus=function(t){void 0===t&&(t=null);var e=this._trackAllowedStatus!==t;return this._trackAllowedStatus=t,e},e.prototype._setTypeNamesWithRegarding=function(t){return!this._compareArrays(this._typeNamesWithRegarding,t)&&(this._typeNamesWithRegarding=t,!0)},e.prototype._compareArrays=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;var n=t.reduce(function(t,e){var n=t.indexOf(e);return-1!==n&&t.splice(n,1),t},e.concat());return 0===n.length},e}());t.TrackStatusRetriever=e}(Retrievers||(Retrievers={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e="LimitedModeNotification",n={NotificationMessage:"LimitedMode_NotificationMessage"},r={Text:"#1F2126",Background:"#FFF4CE",Border:"#efefef"},o=function(){function t(t,e){this._context=t,this._props=e}return t.prototype.render=function(t){var o=this._context.resources.getString(n.NotificationMessage),i={paddingTop:"4px"},a=this._getIconComponent(179,i,null),s={cursor:"pointer",
padding:"4px",fontWeight:"bold",fontSize:this._context.theming.fontsizes.font100},c=this._getIconComponent(97,s,this._props.onClose),l=this._getLinkComponent(o);return this._context.factory.createElement("CONTAINER",{key:e,id:e,style:{backgroundColor:r.Background,display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:"space-between",padding:"3px 5px",boxSizing:"border-box",borderBottom:"1px solid "+r.Border}},[a,l,c])},t.prototype._getIconComponent=function(t,n,r){return this._context.factory.createElement("MICROSOFTICON",{id:e+"_Icon"+t,key:e+"_Icon"+t,type:t,style:Object.assign({fontSize:this._context.theming.fontsizes.font125},n),onClick:r})},t.prototype._getLinkComponent=function(t){var n=this._context.client.isRTL;return this._context.factory.createElement("HYPERLINK",{id:e+"_Link",key:e+"_Link",href:this._props.helpLink,target:"_blank",accessibilityLabel:t,tabIndex:-1,style:(o={color:r.Text},o["padding"+(n?"Right":"Left")]="4px",o.fontFamily=this._context.theming.fontfamilies.regular,o.fontSize=this._context.theming.measures.measure075,o.lineHeight="18px",o.textDecoration="none",o[":hover"]={textDecoration:"underline"},o)},t);var o},t}();t.LimitedModeNotification=o}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e="MailApp.TrackRegarding.Button",n=["MailApp.TrackEmailWithoutRegarding.Button","MailApp.TrackAppointmentWithoutRegarding.Button","MailApp.UntrackEmail.Button","MailApp.UntrackAppointment.Button","MailApp.ViewEmailActivity.Button","MailApp.ViewAppointmentActivity.Button","MailApp.OpenRecordOnWeb.Button"],r=function(){function r(){var t=this;this._trackBarCommands=[],this._showTrackNotAllowedToastNotification=function(){t._lastTrackForbiddenNotificationId&&t._context.utils.clearGlobalNotification(t._lastTrackForbiddenNotificationId);var e=t._getTrackForbiddenMessage();t._context.utils.addGlobalNotification(1,3,e,"",null,null).then(function(e){t._lastTrackForbiddenNotificationId=e})},this._onTrackStatusRetrieverError=function(e){switch(e.code){case Retrievers.RetrieveState.RestErrorDelegateAccess:t._openErrorDialog({message:t._context.resources.getString("MailAppTrackBarControl_DelegateAccess_RestFailure")});break;case Retrievers.RetrieveState.ErrorDelegateAccessMissingWritePermission:t._openErrorDialog({message:t._context.resources.getString("MailAppTrackBarControl_DelegateAccess_MissingWritePermission")});break;case Retrievers.RetrieveState.ErrorDelegateAccessSaveAsync:t._openErrorDialog({message:t._context.resources.getString("MailAppTrackBarControl_DelegateAccess_SaveAsyncFailure")});break;case Retrievers.RetrieveState.EwsErrorResponseCode:case Retrievers.RetrieveState.SaveAsyncUnavailable:case Retrievers.RetrieveState.SaveAsyncError:var n=t._itemType===Constants.MailboxItemTypes.Appointment?"MailAppTrackBarControl_Track_Appointment_Failure_Short":"MailAppTrackBarControl_Track_Email_EWS_Failure_Short",r=t._context.resources.getString(n);t._context.utils.addGlobalNotification(1,2,r,"",null,null);break;case Retrievers.RetrieveState.ExchangeCallError:default:null===e.code||void 0===e.code?t._openErrorDialog(e):t._context.utils.addGlobalNotification(1,2,t._context.resources.getString("MailAppTrackBarControl_Retrieve_EWS_Failure_Short"),"",null,null)}},this._onItemChanged=function(){t._context.utils.clearGlobalNotifications&&t._context.utils.clearGlobalNotifications()}}return Object.defineProperty(r.prototype,"_isExternalContextAvailable",{get:function(){var t=this._context?this._context.externalContext&&this._context.externalContext.getAvailableExternalContexts():null;return t&&t.getByName(Constants.contextId)},enumerable:!0,configurable:!0}),r.prototype.init=function(e,n,r){var o=this;this._context=e,this._isExternalContextAvailable&&(this._notifyOutputChanged=n,this._context=e,this._trackStatusRetriever=new Retrievers.TrackStatusRetriever(this._context),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.ItemType).then(function(t){o._itemType=t,o._subscribeToTrackStatusChange()},function(t){o._openErrorDialog(t)}),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.MailboxItem,{updateListener:this._onItemChanged}),Promise.all([this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.IsLimitedMode),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.LimitedModeNotificationState)]).then(function(n){var r=n[0],i=n[1],a=i.helpLink,s=i.hasBeenClosed;o._isLimitedMode=r,r&&!s&&(o._notificationComponent=new t.LimitedModeNotification(e,{onClose:function(t){o._context.externalContext.invokeExternalContextAction(Constants.contextId,Constants.ActionIds.SetLimitedModeNotificationStateAction),o._notificationComponent=null,o._context.utils.requestRender()},helpLink:a})),o._context.utils.requestRender()}))},r.prototype._subscribeToTrackStatusChange=function(){var t,e=this;this._trackStatusRetriever.onChanged(function(n,r){var o=null!==n&&null!==r;o&&r!==Enums.TrackAllowedStatus.ForbiddenInLimitedMode&&!e._trackStatusRetriever.isTrackAllowed()&&e._showTrackNotAllowedToastNotification();var i=e._trackStatusRetriever.getRegardingObject(),a=i&&i.getRecordId();t!==a&&(t=a,e._notifyOutputChanged()),e._context.utils.requestRender()}),this._trackStatusRetriever.onFailed(this._onTrackStatusRetrieverError),this._trackStatusRetriever.init()},r.prototype._getTrackForbiddenMessage=function(){var t;switch(this._trackStatusRetriever.trackAllowedStatus()){case Enums.TrackAllowedStatus.ForbiddenOccurence:t=this._context.resources.getString("MailAppTrackBarControl_Track_Forbidden_Occurence");break;case Enums.TrackAllowedStatus.ForbiddenMeetingInviteRequest:t=this._context.resources.getString("MailAppTrackBarControl_Track_Forbidden_Meeting_Request");break;case Enums.TrackAllowedStatus.ForbiddenMeetingInviteResponse:t=this._context.resources.getString("MailAppTrackBarControl_Track_Forbidden_Meeting_Response");break;case Enums.TrackAllowedStatus.ForbiddenForOrganizerResolvedAsUser:t=this._context.resources.getString("MailAppTrackBarControl_Track_Forbidden_Organizer_As_User")}return t},r.prototype.updateView=function(t){if(this._context=t,this._isExternalContextAvailable){var e=this._trackStatusRetriever.getTrackStatus(),n=this._trackStatusRetriever.trackAllowedStatus(),r=this._trackStatusRetriever.getTypeNamesWithRegarding(),o=[];return e&&void 0!==n&&r&&this._itemType&&o.push(this._renderTrackStatus(n,e),this._renderSetRegardingForm()),this._notificationComponent&&o.unshift(this._notificationComponent.render(t)),this._render(o)}},r.prototype._render=function(t){return void 0===t&&(t=[]),this._context.factory.createElement("CONTAINER",{id:"MailAppTrackBarContainer",key:"MailAppTrackBarContainer",style:{display:"block",width:"100%"}},t)},r.prototype._getStatusRenderDetails=function(t){switch(t){case Models.TrackingState.IsLinked:return this._trackStatusRetriever.hasRegardingObject?this._getRenderDetailsTrackedRegarding():this._getRenderDetailsTracked();case Models.TrackingState.WillBeLinked:return this._getRenderDetailsTrackPending();case Models.TrackingState.LinkFailed:return this._getRenderDetailsTrackFailed();case Models.TrackingState.InProgress:return this._getRenderDetailsTrackInProgress();default:return this._getRenderDetailsUntracked()}},r.prototype._getRenderDetailsUntracked=function(){var t=this._context.resources.getString("MailAppTrackBarControl_UntrackedStatus");return{text:t,tooltip:t,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#cde6f7",commandingHoverColor:"#9dc3e6"}},r.prototype._getRenderDetailsTracked=function(){var t=this._context.resources.getString("MailAppTrackBarControl_TrackedStatus");return{text:t,tooltip:t,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#e4f9d4",commandingHoverColor:"#c5e0b4"}},r.prototype._getRenderDetailsTrackedRegarding=function(){var t=this._context.resources.getString("MailAppTrackBarControl_TrackedRegardingStatus");return{text:t,tooltip:t,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#e4f9d4",commandingHoverColor:"#c5e0b4"}},r.prototype._getRenderDetailsTrackPending=function(){var t=this._context.resources.getString("MailAppTrackBarControl_TrackedPendingStatus_Tooltip"),e=this._format(t,this._getItemTypeLocalizedName());return{text:this._context.resources.getString("MailAppTrackBarControl_TrackedPendingStatus"),tooltip:e,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#cde6f7",commandingHoverColor:"#9dc3e6"}},r.prototype._getRenderDetailsTrackFailed=function(){var t=this._context.resources.getString("MailAppTrackBarControl_TrackFailedStatus_Tooltip"),e=this._format(t,this._getItemTypeLocalizedName());return{text:this._context.resources.getString("MailAppTrackBarControl_TrackFailedStatus"),tooltip:e,textColor:this._context.theming.colors.basecolor.red.red4,backgroundColor:"#efefef",commandingHoverColor:"#d8d8d8"}},r.prototype._getRenderDetailsTrackInProgress=function(){var t=this._context.resources.getString("MailAppTrackBarControl_InProgressStatus");return{text:t,tooltip:t,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#fff4a8",commandingHoverColor:"#a2993e"}},r.prototype._getItemTypeLocalizedName=function(){return this._context.resources.getString(this._itemType===Constants.MailboxItemTypes.Message?"MailAppTrackBarControl_ItemType_Message":"MailAppTrackBarControl_ItemType_Appointment")},r.prototype._renderTrackStatus=function(t,e){var n=e.crmTrackingState;return t===Enums.TrackAllowedStatus.ForbiddenInLimitedMode&&n!==Models.TrackingState.IsLinked?null:(this._statusRenderDetails=this._getStatusRenderDetails(n),this._context.factory.createElement("CONTAINER",{id:"StatusLabelContainer",key:"StatusLabelContainer",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",backgroundColor:this._statusRenderDetails.backgroundColor}},[this._renderStatusLabel(),this._renderCommandBar()]))},r.prototype._renderStatusLabel=function(){return this._context.factory.createElement("LABEL",{key:"StatusLabel",id:"StatusLabel",style:{display:"block",flex:"1 1 auto",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",height:"48px",lineHeight:"48px",paddingLeft:this._context.client.isRTL?0:this._context.theming.measures.measure100,paddingRight:this._context.client.isRTL?this._context.theming.measures.measure100:0,color:this._statusRenderDetails.textColor,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular},title:this._statusRenderDetails.tooltip},[this._statusRenderDetails.text])},r.prototype._renderCommandBar=function(){return this._trackStatusRetriever.getTrackStatus().crmTrackingState===Models.TrackingState.InProgress?null:this._context.factory.createElement("COMMANDBAR",{key:"TrackBarControlCommandBar",iconPosition:1,mainMenuLength:1,ribbonId:null,selectedRecords:[],addedCommandList:this._getAddedTrackBarCommands(),customCommandManagerStyle:{margin:"0px",border:"0px none"},commandBarStyle:{container:{margin:"0px",border:"0px none"},list:{margin:"0px"},listItem:{marginLeft:this._context.client.isRTL?0:this._context.theming.measures.measure050,marginRight:this._context.client.isRTL?this._context.theming.measures.measure050:0},listItemBody:{text:{display:"block",overflow:"hidden"},iconWrapperStyles:{margin:"0px"}},overflowFlyoutMoreButton:{fontSize:"16px",height:"48px",lineHeight:"48px",padding:"0px",textAlign:"center",border:"0px none",background:"transparent",display:"block",overflow:"hidden",cursor:"pointer",":hover":{backgroundColor:this._statusRenderDetails.commandingHoverColor}}}})},r.prototype._getAddedTrackBarCommands=function(){var t=this;this._context.utils.retrieveRecordCommand({},Constants.GlobalCommandManagerId,[],n).then(function(e){void 0===e&&(e=[]);var n=e.filter(function(t){return t.canExecute}).map(function(t){return{Icon:t.icon,DisplayText:t.label,Tooltip:{title:t.tooltip},Id:t.commandId,execute:t.execute}});t._isTrackCommandsChanged(n)&&(t._trackBarCommands=n,t._context.utils.requestRender())});var e=this._trackBarCommands.slice();return!this._isUntracked()&&this._trackStatusRetriever.isTrackAllowed()&&e.unshift(this._getSetRegardingCommand()),this._trackStatusRetriever.getTrackStatus().crmTrackingState===Models.TrackingState.LinkFailed&&void 0!==this._isLimitedMode&&(this._isLimitedMode?e.unshift(this._getRetryTrackCommand(function(){var e=t._trackStatusRetriever.getRegardingObject(),n=e?e.getNamedReference():null,r=n?{id:e.getRecordId(),name:n.Name,entityType:n.LogicalName}:null;t._trackRegarding(r)})):e.unshift(this._getRetryTrackCommand())),e},r.prototype._isTrackCommandsChanged=function(t){void 0===t&&(t=[]);var e=t.map(function(t){return t.Id}).sort(),n=this._trackBarCommands.map(function(t){return t.Id}).sort();return e.some(function(t,e){return t!==n[e]})},r.prototype._getSetRegardingCommand=function(){var t=this._trackStatusRetriever.hasRegardingObject?"MailAppTrackBarControl_ChangeRegardingButtonLabel":"MailAppTrackBarControl_SetRegardingButtonLabel",e=this._context.resources.getString(t);return{Icon:"LinkArticle",DisplayText:e,Tooltip:{title:e},Id:"MailApp.Track",execute:this._showTrackRegardingForm.bind(this)}},r.prototype._getRetryTrackCommand=function(t){var e=this;void 0===t&&(t=function(){var t={trackingState:Models.TrackingState.WillBeLinked};e._context.externalContext.invokeExternalContextAction(Constants.contextId,Constants.ActionIds.RetryTrack,{args:t})});var n=this._context.resources.getString("Retry_Track");return{Icon:"Refresh",DisplayText:n,Tooltip:{title:n},Id:"MailApp.RetryTrack",execute:t}},r.prototype._renderSetRegardingForm=function(){if(!this._isTrackRegardingFormVisible())return null;var t=this._context.resources.getString("MailAppTrackBarControl_SetRegardingLabel"),e=this._context.factory.createElement("LABEL",{key:"SetRegardingLabel",id:"SetRegardingLabel",style:{display:"block",whiteSpace:"nowrap",color:this._context.theming.colors.basecolor.grey.grey7,fontSize:this._context.theming.fontsizes.font100,overflow:"hidden",textOverflow:"elipsis",fontFamily:this._context.theming.fontfamilies.regular,marginBottom:this._context.theming.measures.measure025},title:t},[t]);return this._context.factory.createElement("CONTAINER",{id:"SetRegardingForm",key:"SetRegardingForm",style:{display:"flex",flexDirection:"column",marginTop:this._context.theming.measures.measure100,marginLeft:this._context.theming.measures.measure100,marginRight:this._isCloseSetRegardingFormButtonVisible()?"0px":this._context.theming.measures.measure100}},[e,this._renderSetRegardingLookup()])},r.prototype._renderSetRegardingLookup=function(){var t=this._trackStatusRetriever.getTypeNamesWithRegarding();if(0===t.length)return null;var e={descriptor:{Id:"MscrmControls.FieldControls.SimpleLookupControl",Label:this._context.resources.getString("MailAppTrackBarControl_SetRegardingLabel"),Name:"",ShowLabel:!0,Visible:!0,Disabled:!1},parameters:{value:{Type:"Lookup.Regarding",Usage:3,Static:!1,Callback:this._lookupValueChanged.bind(this),Value:[],Attributes:{LogicalName:"regardingobjectid",Targets:t,Format:"regarding",Type:"lookup"}},viewportSizeMode:{Usage:1,Static:!0,Type:"Whole.None",Value:1,Primary:!1},deviceSizeMode:{Usage:1,Static:!0,Type:"Whole.None",Value:1,Primary:!1}},key:"SetRegardingLookup"},n=this._context.factory.createComponent("MscrmControls.FieldControls.SimpleLookupControl","SetRegardingLookup",e);return this._context.factory.createElement("CONTAINER",{id:"SetRegardingForm",key:"SetRegardingForm",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},[n,this._renderCloseSetRegardingFormButton()])},r.prototype._isCloseSetRegardingFormButtonVisible=function(){return!this._isUntracked()},r.prototype._renderCloseSetRegardingFormButton=function(){var t=this;if(!this._isCloseSetRegardingFormButtonVisible())return null;var e=this._context.factory.createElement("MICROSOFTICON",{id:"CloseSetRegardingFormButtonIcon",key:"CloseSetRegardingFormButtonIcon",type:9}),n=this._context.resources.getString("MailAppTrackBarControl_CloseSetRegardingFormLabel");return this._context.factory.createElement("BUTTON",{id:"CloseSetRegardingFormButton",key:"CloseSetRegardingFormButton",title:n,accessibilityLabel:n,role:"button",tabIndex:0,onClick:function(){t._hideTrackRegardingForm()},style:{flex:"0 0 auto",backgroundColor:"transparent",borderStyle:"none",color:this._context.theming.colors.grays.gray07,paddingTop:this._context.theming.measures.measure075,paddingBottom:this._context.theming.measures.measure100,paddingLeft:this._context.theming.measures.measure050,paddingRight:this._context.theming.measures.measure100,fontSize:"16px",cursor:"pointer"}},[e])},r.prototype._showTrackRegardingForm=function(){this._isTrackRegardingFormActive=!0,this._context.utils.requestRender()},r.prototype._hideTrackRegardingForm=function(){this._isTrackRegardingFormActive=!1,this._context.utils.requestRender()},r.prototype._isTrackRegardingFormVisible=function(){return(this._isUntracked()||this._isTrackRegardingFormActive)&&this._trackStatusRetriever.isTrackAllowed()},r.prototype._isUntracked=function(){var t=this._trackStatusRetriever.getTrackStatus();return t.crmTrackingState===Models.TrackingState.NotLinked||t.crmTrackingState===Models.TrackingState.WillBeUnlinked||t.crmTrackingState===Models.TrackingState.WillBeUnlinkedAndDeleted},r.prototype._lookupValueChanged=function(t){var e=Array.isArray(t)?t[0]:t;e&&(this._trackRegarding(e),this._hideTrackRegardingForm())},r.prototype._trackRegarding=function(t){var n={};n[t.id]=this._getDataSetRecord(t),this._context.utils.retrieveRecordCommand(n,Constants.GlobalCommandManagerId,[t.id],[e]).then(function(t){var e=t&&t[0];e&&e.canExecute&&e.execute()})},r.prototype._getDataSetRecord=function(t){var e={};return e.getNamedReference=function(){return t},e},r.prototype._openErrorDialog=function(t){var e=t&&t.message?t.message:this._context.resources.getString("MailAppTrackBarControl_Retrieve_EWS_Failure_Short");this._context.navigation.openErrorDialog({message:e,details:t&&t.stack?t.stack:"No stack available."})},r.prototype._format=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return t.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})},r.prototype.getOutputs=function(){return{regardingObject:this._trackStatusRetriever.getRegardingObject()}},r.prototype.destroy=function(){this._lastTrackForbiddenNotificationId&&this._context.utils.clearGlobalNotification(this._lastTrackForbiddenNotificationId),this._trackStatusRetriever&&this._trackStatusRetriever.destroy(),this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.MailboxItem,this._onItemChanged)},r}();t.MailAppTrackBarControl=r}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){}(e=t.Containers||(t.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e="quick",n="UNKNOW_FORM",r="DO_NOT_SHOW",o=function(){function t(){this._uniqueId=Common.Guid.newGuid()}return t.prototype.init=function(t,e,n){this._context=t},t.prototype._requestDefaultForm=function(t){var e=this,r=this._context.utils.getFormId;if(!r)return this._formId=n,void this._context.utils.requestRender();var o=r(this._currentEntityReference.LogicalName,"Quick");o.then(function(t){null!=t?e._formId=t:e._formId=n,e._context.utils.requestRender()},function(t){throw new Error("Corrupted _requestDefaultForm")})},t.prototype._isTypeChanged=function(t){return!this._currentEntityReference||null!==t&&this._currentEntityReference.LogicalName!==t.LogicalName},t.prototype._updateTypeLabel=function(){var t=this;this._typeRequestStamp=Date.now();var e=this._typeRequestStamp;this._entityMetadataRequest=this._context.utils.getEntityMetadata(this._context.parameters.data.raw.getNamedReference().LogicalName),this._entityMetadataRequest.then(function(n){e>=t._typeRequestStamp&&t._typeLabel!==n.DisplayName&&(t._typeLabel=n.DisplayName,t._formId&&t._context.utils.requestRender())})},t.prototype.updateView=function(t){var o=this;this._context=t;var i=this._context.parameters.data.raw&&this._context.parameters.data.raw.getNamedReference();if(i){var a=this._isTypeChanged(i);if(this._currentEntityReference=i,a&&(this._formId="",this._typeLabel="",this._entityMetadataRequest=null),this._typeLabel||this._entityMetadataRequest||this._updateTypeLabel(),!this._formId){if(this._context.parameters.predefinedForms&&this._context.parameters.predefinedForms.raw){var s=this._context.parameters.predefinedForms.raw.split(","),c={};s.forEach(function(t){t&&(c[t.split("#")[0]]=t.split("#")[1])}),c.hasOwnProperty(this._currentEntityReference.LogicalName)&&(this._formId=c[this._currentEntityReference.LogicalName])}this._formId||this._requestDefaultForm(e)}}else this._currentEntityReference=null;if(!this._formId||!this._currentEntityReference||this._formId===r)return this._context.factory.createElement("LABEL",{key:"label",style:{display:"none"}},"");if(this._formId===n){var l={eventName:"uci_trace",eventParameters:[{name:"Data",value:JSON.stringify(i)},{name:"ApplicationEventLevel",value:"3"},{name:"Message",value:"Form Id is unknown"},{name:"ComponentName",value:"MailApp.Control.QuickFormWrapper"}]};return this._context.reporting.reportEvent(l),this._context.factory.createElement("LABEL",{key:"label"},this._context.resources.getString("QuickFormWrapper_Have_No_Deafult_Form"))}var u={Usage:0,Type:"Form.QuickForm",Value:this._formId+":Quick|"+this._currentEntityReference.LogicalName+"|"+this._currentEntityReference.Id,Static:!1,Primary:!0},d=this._context.parameters.formType&&this._context.parameters.formType.raw?this._context.parameters.formType.raw:"QuickFormCardControl",p=this._typeLabel?this._typeLabel:"";if(this._context.parameters.label&&this._context.parameters.label.raw){p=this._context.parameters.label.raw;var m=p.match(/\$.+?\$/g);m&&m.length>0&&(m.forEach(function(t){p=p.replace(""+t,o._context.resources.getString(t.substring(1,t.length-1)))}),p=p.replace("{TypeName}",this._typeLabel))}var h={descriptor:{Id:"MscrmControls.Containers."+d,Label:"",Name:"",ShowLabel:!1,Visible:!0,Disabled:!1,Parameters:{QuickForms:{Usage:0,Type:"Form.QuickForm",Value:'&lt;QuickFormIds&gt;&lt;QuickFormId entityname="'+this._currentEntityReference.LogicalName+'"&gt;'+this._formId+"&lt;/QuickFormId&gt;&lt;/QuickFormIds&gt;",Static:!1,Primary:!0}}},controlstates:{hasFocus:this._context.mode.hasFocus,isControlDisabled:this._context.mode.isControlDisabled,label:p},parameters:{value:u,hideImage:{Usage:1,Type:"Whole.None",Value:this._context.parameters.hideImage&&this._context.parameters.hideImage.raw,Static:!0,Primary:!0}}};return this._context.factory.createComponent("MscrmControls.Containers."+d,d+"#"+this._currentEntityReference.LogicalName+"#"+this._currentEntityReference.Id+"#"+this._uniqueId,h)},t.prototype.getOutputs=function(){return null},t.prototype.destroy=function(){},t}();t.QuickFormWrapper=o}(e=t.Containers||(t.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e=function(){function t(){}return t.prototype.init=function(t,e,n){this._context=t,this._icons={InProgress:{iconId:248,iconColor:this._context.theming.colors.grays.gray07},Success:{iconId:182,iconColor:this._context.theming.colors.basecolor.green.green4},Failure:{iconId:181,iconColor:this._context.theming.colors.basecolor.red.red4}}},t.prototype.updateView=function(t){return this._context=t,this._context.factory.createElement("CONTAINER",{id:"StatusLabelContainer",key:"StatusLabelContainer",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%"}},[this._renderText(),this._renderIcon()])},t.prototype._renderText=function(){var t=this._context.mode._customControlProperties.descriptor.Label;return this._context.factory.createElement("LABEL",{key:"StatusText",id:"StatusText",style:{textDecoration:"none",display:"block",flex:"1 1 auto",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this._context.theming.colors.basecolor.grey.grey5,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular},tabIndex:0,title:t},[t])},t.prototype._renderIcon=function(){var t=this._context.parameters.StatusIcon&&this._context.parameters.StatusIcon.raw;return t&&this._icons[t]?this._context.factory.createElement("MICROSOFTICON",{id:"StatusIcon",key:"StatusIcon",type:this._icons[t].iconId,style:{display:"block",color:this._icons[t].iconColor,paddingLeft:this._context.theming.measures.measure200,fontSize:"16px"}}):null},t.prototype.getOutputs=function(){return null},t.prototype.destroy=function(){},t}();t.StatusLabelControl=e}(e=t.StatusLabel||(t.StatusLabel={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e=function(){function t(){}return t.prototype.init=function(t,e,n){this._context=t},t.prototype.updateView=function(t){return this._context=t,this._createUnboundLink()},t.prototype._createUnboundLink=function(){var t=this._context.mode._customControlProperties.descriptor.Label,e=this._context.parameters.LinkUrl.raw;return this._context.factory.createElement("HYPERLINK",{id:"unboundLink",key:"unboundLink",href:e,target:"_blank",accessibilityLabel:t,tabIndex:-1,style:{color:this._context.theming.colors.basecolor.blue.blue3,fontSize:this._context.theming.fontsizes.font100,textDecoration:"none"}},t)},t.prototype.getOutputs=function(){return null},t.prototype.destroy=function(){},t}();t.UnboundHyperlinkControl=e}(e=t.UnboundHyperlinkControl||(t.UnboundHyperlinkControl={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e=function(){function t(){}return t.prototype.init=function(t){this._context=t},t.prototype.getLabelStyle=function(){return{display:"block",overflow:"hidden",textOverflow:"ellipsis",fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.semibold}},t.prototype.getHeaderStyle=function(){return Object.assign(this.getLabelStyle(),{fontFamily:this._context.theming.fontfamilies.regular})},t.prototype.getLinkStyle=function(){return Object.assign(this.getLabelStyle(),{color:this._context.theming.colors.basecolor.blue.blue3,textDecoration:"none",whiteSpace:"nowrap"})},t.prototype.getLinkButtonStyle=function(){return{backgroundColor:"transparent",borderStyle:"none",color:this._context.theming.colors.grays.gray07,paddingTop:this._context.theming.measures.measure075,paddingBottom:this._context.theming.measures.measure100,paddingLeft:this._context.client.isRTL?this._context.theming.measures.measure100:this._context.theming.measures.measure050,paddingRight:this._context.client.isRTL?this._context.theming.measures.measure050:this._context.theming.measures.measure100,marginLeft:this._context.client.isRTL?0:this._context.theming.measures.measure200,marginRight:this._context.client.isRTL?this._context.theming.measures.measure200:0,fontSize:"16px",cursor:"pointer"}},t.prototype.getFlyoutStyle=function(){return{border:"1px "+this._context.theming.solidborderstyle+" "+this._context.theming.colors.controlborder}},t.prototype.getFlyoutItemStyle=function(){return{display:"block",lineHeight:this._context.theming.measures.measure250,paddingLeft:this._context.theming.measures.measure100,paddingRight:this._context.theming.measures.measure100,whiteSpace:"nowrap",color:this._context.theming.colors.grays.gray07,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular,cursor:"pointer",backgroundColor:this._context.theming.colors.whitebackground,":hover":{backgroundColor:this._context.theming.colors.grays.gray03}}},t.prototype.getFlyoutItemHoverStyle=function(){return{backgroundColor:"#E6F2FA"}},t}();t.MailAppStyleManager=e}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));var Telemetry;!function(t){!function(t){t[t.Log=0]="Log",t[t.Info=1]="Info",t[t.Verbose=2]="Verbose",t[t.Warning=3]="Warning",t[t.Error=4]="Error"}(t.EventLevel||(t.EventLevel={}));t.EventLevel}(Telemetry||(Telemetry={}));var MscrmControls;!function(t){var e;!function(t){"use strict";var e="name",n="emailaddress",r="role",o="distributionList",i="RecipientsCreateFormAdd_",a="MailApp.Control.UnknownRecipientSummary",s=function(){function s(){var t=this;this._onOpenFormSuccess=function(e){var r=e&&e.savedEntityReference&&e.savedEntityReference[0];if(r){t._getFieldValue(n)&&t._context.externalContext.invokeExternalContextAction(Constants.contextId,Constants.ActionIds.ResolveRecipientFromScratch,{args:{emailAddress:t._getFieldValue(n)}}),t._isSender()&&Promise.all([t._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackStatus),t._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.IsCreateContactWithoutTracking)]).then(function(e){var n=e[0],o=e[1];n&&n.crmTrackingState===Models.TrackingState.NotLinked&&!o&&t._trackWithRegarding(r)});var o={eventName:"uci_trace",eventParameters:[{name:"ApplicationEventLevel",value:Telemetry.EventLevel.Info},{name:"Message",value:"Unknown recipient was added as a "+r.entityType},{name:"ComponentName",value:a}]};t._context.reporting.reportEvent(o)}}}return s.prototype.init=function(e,n,r){var o=this;this._context=e;var i=this._context.accessibility.getUniqueId("button");this._addRecipientButtonId="RecipientsCreateForm_"+i,this._mailAppStyleManager=new t.MailAppStyleManager,this._mailAppStyleManager.init(this._context),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackAllowedStatus).then(function(t){o._isTrackAllowed=t===Enums.TrackAllowedStatus.Allowed,o._context.utils.requestRender()})},s.prototype.updateView=function(t){var e=this;if(this._context=t,!t.parameters.data||!t.parameters.data.raw)return t.factory.createElement("CONTAINER",{id:"RecipientsCreateFormEmptyContainer",key:"RecipientsCreateFormEmptyContainer"});var n=t.factory.createElement("LABEL",{id:"RecipientCreateFormHeaderLabel",key:"RecipientCreateFormHeaderLabel",style:this._mailAppStyleManager.getHeaderStyle()},this._getRecipientCreateFormHeaderText()),r=this._renderUnresolvedRecipientCard(),o=this._getEntityTypesFromParameters().some(function(t){return e._context.utils.hasEntityPrivilege(t,1,-1)}),i=this._isTrackAllowed&&this._isSender(),a=i?this._renderContactDuplicateWarning():null,s=o?this._renderControls():null,c=t.factory.createElement("CONTAINER",{id:"RecipientsCreateFormContainer",key:"RecipientsCreateFormContainer",style:{display:"flex",flexDirection:"row",alignItems:"flex-end",justifyContent:"space-between"}},[r,s]);return t.factory.createElement("CONTAINER",{id:"RecipientsCreateFormContainer",key:"RecipientsCreateFormContainer",style:{display:"block",width:"100%",color:this._context.theming.colors.grays.gray05,"background-color":this._context.theming.colors.whitebackground,"padding-top":this._context.theming.measures.measure100,"padding-left":this._context.client.isRTL?0:this._context.theming.measures.measure100,"padding-right":this._context.client.isRTL?this._context.theming.measures.measure100:0,"box-sizing":"border-box"}},[n,a,c])},s.prototype.openAddRecipientFlyout=function(){this._isAddRecipientFlyoutOpened=!0,this._context.utils.requestRender()},s.prototype.closeAddRecipientFlyout=function(){this._isAddRecipientFlyoutOpened=!1,this._context.utils.requestRender()},s.prototype._renderUnresolvedRecipientCard=function(){var t=[],r=this._getFieldValue(e);r&&r!==this._getFieldValue(n)&&t.push(this._context.factory.createElement("LABEL",{
id:"RecipientCreateFormName",key:"RecipientCreateFormName",style:this._mailAppStyleManager.getLabelStyle()},[r]));var o=this._getFieldValue(n);return o&&t.push(this._context.factory.createElement("HYPERLINK",{id:"RecipientCreateFormEmail",key:"RecipientCreateFormEmail",target:"_blank",href:"mailto:"+o,style:this._mailAppStyleManager.getLinkStyle(),title:o},[o])),this._context.factory.createElement("CONTAINER",{id:"RecipientsCreateFormCard",key:"RecipientsCreateFormCard",style:{display:"block","padding-bottom":this._context.theming.measures.measure100,"padding-top":this._context.theming.measures.measure075,overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},t)},s.prototype._renderControls=function(){var t=[];return t.push(this._renderAddRecipientButton()),this._isAddRecipientFlyoutOpened&&t.push(this._renderAddRecipientFlyout()),this._context.factory.createElement("CONTAINER",{id:"RecipientsCreateFormControls",key:"RecipientsCreateFormControls",style:{display:"block"}},t)},s.prototype._renderAddRecipientButton=function(){var t=this,e=this._context.factory.createElement("MICROSOFTICON",{id:"RecipientsCreateFormAddButtonIcon",key:"RecipientsCreateFormAddButtonIcon",type:8}),n=this._context.resources.getString("UnknownRecipientSummaryControl_Add_To_Dynamics_365");return this._context.factory.createElement("BUTTON",{id:this._addRecipientButtonId,key:this._addRecipientButtonId,title:n,accessibilityLabel:n,accessibilityHasPopup:!0,role:"button",tabIndex:0,onClick:function(){t.openAddRecipientFlyout()},style:this._mailAppStyleManager.getLinkButtonStyle()},[e])},s.prototype._renderContactDuplicateWarning=function(){var t=this._context.factory.createElement("MICROSOFTICON",{id:"ContactDuplicateWarningIcon",key:"ContactDuplicateWarningIcon",type:179,style:{position:"relative",fontSize:"20px",top:"5px",marginRight:"5px"}}),e=this._context.resources.getString("UnknownRecipientSummaryControl_Create_Contact_To_Avoid_Duplicates"),n=this._context.factory.createElement("LABEL",{id:"ContactDuplicateWarningLabel",key:"ContactDuplicateWarningLabel"},e);return this._context.factory.createElement("CONTAINER",{id:"ContactDuplicateWarningContainer",key:"ContactDuplicateWarningContainer",style:{display:"block",color:"#3b3a39",paddingTop:this._context.theming.measures.measure050,paddingBottom:this._context.theming.measures.measure025}},[t,n])},s.prototype._onAddRecipientClick=function(t){var e={entityName:t,useQuickCreateForm:!0},n=this._getPrefillOptions(t);this.closeAddRecipientFlyout(),this._context.navigation.openForm(e,n).then(this._onOpenFormSuccess)},s.prototype._getPrefillOptions=function(t){var e,r=this._getRecipientFirstAndLastName(),o=this._getFieldValue(n);if(t===Constants.CrmTypeNames.Account){var i=o.match(/@([^.]+)/);i&&(e={name:i[1],emailaddress1:o})}else e={emailaddress1:o,firstname:r.firstName,lastname:r.lastName};return e},s.prototype._getRecipientFirstAndLastName=function(){var t=this._getFieldValue(e),r=this._getFieldValue(n),o=-1!==(t||r).indexOf("@");if(t&&!o){var i=t.split(",");if(i.length>1)return 2===i.length?{firstName:i[1],lastName:i[0]}:{lastName:t};var a=t.split(" ");return{firstName:a.length>1?a.slice(0,-1).join(" "):null,lastName:a[a.length-1]}}var s=r.substring(0,r.indexOf("@")).split(".");return 2===s.length?{firstName:this._capitalizeFirstLetter(s[0]),lastName:this._capitalizeFirstLetter(s[1])}:{}},s.prototype._capitalizeFirstLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},s.prototype._trackWithRegarding=function(t){var e=this,n={id:t.id,name:t.name,Name:t.name,logicalName:t.entityType,LogicalName:t.entityType,entityName:t.entityType,entityType:t.entityType},r={getNamedReference:function(){return n}},o="MailApp.TrackRegarding.Button";this._context.utils.retrieveRecordCommand((i={},i[n.id]=r,i),Constants.GlobalCommandManagerId,[n.id],[o]).then(function(t){var e=t&&t[0];e&&e.canExecute&&e.execute()},function(t){var r=[{name:"Data",value:JSON.stringify(n)},{name:"Error",value:JSON.stringify(t)}];e._context.reporting.reportFailure(a,new Error("Failed to retrieve record from CRM"),null,r)});var i},s.prototype._isSender=function(){return parseInt(this._getFieldValue(r),10)===Models.RecipientRole.Sender},s.prototype._renderAddRecipientFlyout=function(){var t=this,e=this._getEntityTypesFromParameters().filter(function(e){return t._isFCBRequiredAndEnabled(e)&&t._context.utils.hasEntityPrivilege(e,1,-1)}),n=e.map(function(n,r){var o=e.length-1,i=e[0===r?o:r-1],a=e[r===o?0:r+1];return t._renderAddRecipientFlyoutItem(n,t._getResourceKeyForEntityType(n),i,a)}),r=this._context.factory.createElement("LIST",{id:"RecipientsCreateFormAddRecipientDropdown",key:"RecipientsCreateFormAddRecipientDropdown",role:"menu",accessibilityLabel:"Commands"},n);return this._context.factory.createElement("FLYOUT",{id:"RecipientsCreateFormAddRecipientFlyout",key:"RecipientsCreateFormAddRecipientFlyout",flyoutDirection:7,flyoutStyle:this._mailAppStyleManager.getFlyoutStyle(),positionType:"relative",relativeToElementId:this._addRecipientButtonId,onOutsideClick:function(){t.closeAddRecipientFlyout()}},[r])},s.prototype._isFCBRequiredAndEnabled=function(t){return t!==Constants.CrmTypeNames.Account||this._context.utils.isFeatureEnabled(Constants.FeatureNames.MailAppResolveRecipientsToAccounts)},s.prototype._getResourceKeyForEntityType=function(t){t=t.toLowerCase();var e=t.charAt(0).toUpperCase()+t.slice(1);return this._context.resources.getString("UnknownRecipientSummaryControl_Add_As_"+e)},s.prototype._getEntityTypesFromParameters=function(){var t=this._context.parameters.entityTypesToAdd&&this._context.parameters.entityTypesToAdd.raw;return t?t.split(",").map(function(t){return t.trim().toLowerCase()}):[]},s.prototype._renderAddRecipientFlyoutItem=function(t,e,n,r){return this._context.factory.createElement("LISTITEM",{id:i+t,key:i+t,role:"menuitem",tabIndex:0,accessibilityLabel:e,style:this._mailAppStyleManager.getFlyoutItemStyle(),onClick:this._onAddRecipientClick.bind(this,t),onKeyDown:this._onListItemKeyDownHandler.bind(this,t,r,n)},[e])},s.prototype._onListItemKeyDownHandler=function(t,e,n,r){40===r.keyCode&&this._focusOnKeyDown(i+e,r),38===r.keyCode&&this._focusOnKeyDown(i+n,r),27===r.keyCode&&(this.closeAddRecipientFlyout(),this._context.accessibility.focusElementById(this._addRecipientButtonId)),13===r.keyCode&&this._onAddRecipientClick(t)},s.prototype._focusOnKeyDown=function(t,e){this._context.accessibility.focusElementById(t),e.preventDefault(),e.stopPropagation()},s.prototype._getFieldValue=function(t){return this._context.parameters.data.raw&&this._context.parameters.data.raw.getFormattedValue(t)},s.prototype._getRecordEntityLogicalName=function(){var t=this._context.parameters.data.raw&&this._context.parameters.data.raw.getNamedReference();return t&&t.LogicalName},s.prototype._getRecipientCreateFormHeaderText=function(){return this._getRecordEntityLogicalName()===o?this._context.resources.getString("UnknownRecipientSummaryControl_Distribution_List"):this._context.resources.getString("UnknownRecipientSummaryControl_Unknown_Recipient")},s.prototype.getOutputs=function(){return null},s.prototype.destroy=function(){},s}();t.UnknownRecipientSummaryControl=s}(e=t.MailApp||(t.MailApp={}))}(MscrmControls||(MscrmControls={}));
//# sourceMappingURL=d:\a\1\s\target\bin\Release\ts\..\uglify\MailAppControls.js.map