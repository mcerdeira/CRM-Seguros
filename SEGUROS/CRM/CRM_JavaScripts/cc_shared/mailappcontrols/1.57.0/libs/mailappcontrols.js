"use strict";
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),MscrmControls;!function(e){var t;!function(e){var t="AccountControl",n=function(){function e(){var e=this;this._onReferenceNameClick=function(){var t={entityName:e._referenceRecord.LogicalName,entityId:e._referenceRecord.Id};e._context.navigation.openForm(t)},this._onReferenceNameKeyDown=function(t){13===t.keyCode&&e._onReferenceNameClick()}}return Object.defineProperty(e.prototype,"_referenceRecord",{get:function(){if(!this._context.parameters.value||!this._context.parameters.value.raw)return null;var e=this._context.parameters.value.raw,t=e.Name,n=e.LogicalName,r=e.Id;return{Name:t,LogicalName:n,Id:r.toString()}},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,n){this._context=e,this._referenceRecord&&this._loadEntityDisplayName(this._referenceRecord.LogicalName)},e.prototype.updateView=function(e){if(!this._referenceRecord||!this._entityDisplayName)return!this._entityDisplayName&&this._referenceRecord&&this._loadEntityDisplayName(this._referenceRecord.LogicalName),e.factory.createElement("CONTAINER",{id:t+"EmptyContainer",key:t+"EmptyContainer"});var n=this._entityDisplayName,r=e.factory.createElement("LABEL",{key:t+"HeaderLabel",style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular,paddingBottom:this._context.theming.measures.measure100}},n);return e.factory.createElement("CONTAINER",{id:t+"Container",key:t+"Container",style:{display:"block",width:"100%",color:this._context.theming.colors.grays.gray05,backgroundColor:this._context.theming.colors.whitebackground,paddingTop:this._context.theming.measures.measure100,paddingLeft:this._context.theming.measures.measure100,paddingRight:this._context.theming.measures.measure050,paddingBottom:this._context.theming.measures.measure100,boxSizing:"border-box"}},[r,this._renderReferenceForm()])},e.prototype._loadEntityDisplayName=function(e){var t=this;this._context.utils.getEntityMetadata(e,["DisplayName"]).then(function(e){t._entityDisplayName=e.DisplayName,t._context.utils.requestRender()})},e.prototype._renderReferenceForm=function(){return this._context.factory.createElement("CONTAINER",{id:"ReferenceForm",key:"ReferenceForm",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},[this._renderReferenceIcon(),this._renderReferenceLink(),this._renderCommandBar()])},e.prototype._renderReferenceLink=function(){return this._context.factory.createElement("LABEL",{key:"ReferenceLink",id:"ReferenceLink",style:{cursor:"pointer",textDecoration:"none",display:"block",flex:"1 1 auto",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this._context.theming.colors.basecolor.blue.blue3,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.semibold},tabIndex:0,title:this._referenceRecord.Name,role:"link",onClick:this._onReferenceNameClick,onKeyDown:this._onReferenceNameKeyDown},[this._referenceRecord.Name])},e.prototype._renderReferenceIcon=function(){var e=this._getReferenceImageUrl(),t=this._context.factory.createElement("ENTITYIMAGE",{key:"ReferenceIcon",hasPrimaryImageField:!0,style:{borderRadius:"50%",display:"block",height:"100%",color:this._context.theming.colors.basecolor.white},alt:this._referenceRecord.Name,imageSrc:e,entityPrimaryField:this._referenceRecord.Name});return this._context.factory.createElement("CONTAINER",{key:"ReferenceIconContainer",id:"ReferenceIconContainer",style:{display:"block",flex:"0 0 "+this._context.theming.measures.measure250,borderRadius:"50%",width:this._context.theming.measures.measure250,height:this._context.theming.measures.measure250,lineHeight:this._context.theming.measures.measure250,backgroundColor:this._context.theming.colors.grays.gray01,color:this._context.theming.colors.grays.gray07,fontSize:"16px",textAlign:"center",marginRight:this._context.theming.measures.measure100}},t)},e.prototype._getReferenceImageUrl=function(){return null},e.prototype._renderCommandBar=function(){var e="QuickForm:"+this._referenceRecord.LogicalName;return this._context.factory.createElement("COMMANDBAR",{id:t+"TrackCommandBar",key:t+"TrackCommandBar",iconPosition:1,mainMenuLength:1,width:50,commandbarDisplayMode:0,ribbonId:e,selectedRecords:[this._referenceRecord],customCommandManagerStyle:{margin:"0px",border:"0px none"},commandBarStyle:this._getCommandBarStyle()})},e.prototype._getCommandBarStyle=function(){return{container:{margin:"0px",border:"0px none"},list:{margin:"0px"},listItem:{width:"50px"},listItemBody:{text:{display:"none"},icon:{lineHeight:"16px"},iconWrapperStyles:{margin:"0px",fontSize:"16px",height:this._context.theming.measures.measure200,lineHeight:this._context.theming.measures.measure200,padding:"0px",border:"0px none",background:"transparent",display:"flex",overflow:"hidden",width:"100%",justifyContent:"center",alignItems:"center"},button:{padding:"0px",backgroundColor:"transparent",lineHeight:this._context.theming.measures.measure200,height:this._context.theming.measures.measure200,borderWidth:0,cursor:"pointer",":hover":{backgroundColor:this._context.theming.colors.basecolor.white},alignItems:"center"},flyoutButtonChevronIconWrapper:{padding:"0px"}}}},e.prototype.getOutputs=function(){return null},e.prototype.destroy=function(){},e}();e.AccountControl=n}(t=e.Account||(e.Account={}))}(MscrmControls||(MscrmControls={}));var Constants;!function(e){var t;e.contextId="MAIL_CONTEXT",e.PropertyIds={Subject:"SUBJECT",PlainBody:"PLAIN_BODY",HtmlBody:"HTML_BODY",ReceivedOn:"RECEIVED_ON",TrackStatus:"TRACK_STATUS",TrackAllowedStatus:"TRACK_ALLOWED_STATUS",MailboxItem:"MAILBOX_ITEM",ItemType:"ITEM_TYPE",AttachmentIds:"ATTACHMENT_IDS",EwsUrl:"EWS_URL",EwsToken:"EWS_TOKEN",IsComposeMode:"IS_COMPOSE_MODE",MessageRecipients:"MESSAGE_RECIPIENTS",MeetingAttendees:"MEETING_ATTENDEES",RoomMailboxes:"ROOM_MAILBOXES",IsDesktopOutlook:"IS_DESKTOP_OUTLOOK",IsSent:"IS_SENT",IsDelegatedMailbox:"IS_DELEGATED_MAILBOX",ResolvedRecipients:"RESOLVED_RECIPIENTS",SelectedRecipient:"SELECTED_RECIPIENT",IsOrganizerResolvedAsUser:"IS_ORGANIZER_RESOLVED_AS_USER",MailboxItemFromServer:"MAILBOX_ITEM_FROM_SERVER",IsLimitedMode:"IS_LIMITED_MODE",LimitedModeNotificationState:"LIMITED_MODE_NOTIFICATION_STATE",IsCheckerCommandVisible:"IS_CHECKER_COMMAND_VISIBLE",KnownOrgSettings:"KNOWN_ORG_SETTINGS",Importance:"IMPORTANCE"},e.ActionIds={Track:"TRACK",Untrack:"UNTRACK",Follow:"FOLLOW",Unfollow:"UNFOLLOW",InsertBody:"INSERT_BODY",AddAttachments:"ADD_ATTACHMENTS",SetSubject:"SET_SUBJECT",GetEmailLinks:"GET_EMAIL_LINKS",SetTrackingInfo:"SET_TRACKING_INFO",RemoveTrackingInfo:"REMOVE_TRACKING_INFO",ResolveRecipientFromScratch:"RESOLVE_RECIPIENT_FROM_SCRATCH",SetSelectedRecipient:"SET_SELECTED_RECIPIENT",RetryTrack:"RETRY_TRACK",OpenAppChecker:"OPEN_APPCHECKER",SetLimitedModeNotificationStateAction:"SET_LIMITED_MODE_NOTIFICATION_STATE"},e.DialogNames={Follow:"new_FollowEmail",Unfollow:"new_UnfollowEmail",EmailTemplate:"InsertEmailTemplate_MultiPage_MDD",SalesLiterature:"MailAppSalesLiterature",KnowledgeArticle:"MailAppKnowledgeArticle",AppointmentConflict:"MailAppAppointmentConflict"},e.MailboxItemTypes={Message:"message",Appointment:"appointment"},e.CalendarItemTypes={Single:"Single",Occurence:"Occurence",Exception:"Exception",RecurringMaster:"RecurringMaster"},e.CrmTypeNames={User:"systemuser",Contact:"contact",Lead:"lead",Email:"email",Appointment:"appointment",RecurringAppointmentMaster:"recurringappointmentmaster",ExchangeSyncIdMapping:"exchangesyncidmapping",Account:"account",ActivityPointer:"activitypointer"},e.PropertyNames={Email:"emailaddress",StatusCode:"statecode",IsDisabled:"isdisabled",OwnerId:"ownerid",FollowEmail:"followemail",RecipientRole:"role"},e.CrmTypeCodes={User:8,Contact:2,Lead:4,Appointment:4201,RecurringAppointmentMaster:4251},e.MailboxItemTypeToCrmTypeMap=(t={},t[e.MailboxItemTypes.Message]=e.CrmTypeNames.Email,t[e.MailboxItemTypes.Appointment]=e.CrmTypeNames.Appointment,t),e.FeatureNames={SSSReliablePromote:"SSSReliablePromote",MailAppAttachmentsReliablePromote:"MailAppAttachmentsReliablePromote",MailAppAppointmentsReliablePromote:"MailAppAppointmentsReliablePromote",MailAppResolveRecipientsToAccounts:"MailAppResolveRecipientsToAccounts",MailAppDisplayAppCheckerNavigationLink:"MailAppDisplayAppCheckerNavigationLink",MailAppPrepopulateFormsCase:"MailAppPrepopulateFormsCase",MailAppDisableMailAppChecker:"DisableMailAppChecker"},e.GlobalCommandManagerId="crm_header_global",e.RecipientCRMTypeNames=[e.CrmTypeNames.User,e.CrmTypeNames.Contact,e.CrmTypeNames.Lead,e.CrmTypeNames.Account],e.AppointmentItemLegacyFreeBusyStatus={Free:"Free",Tentative:"Tentative",Busy:"Busy",OOF:"OOF",WorkingElsewhere:"WorkingElsewhere",NoData:"NoData"},e.MailboxItemImportance={Low:"Low",Normal:"Normal",High:"High"},e.HttpCodes={NoContent:204}}(Constants||(Constants={}));var MscrmControls;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.init=function(e,t,n){this._context=e},e.prototype.updateView=function(e){this._context=e;var t=this._context.parameters.Records?this._context.parameters.Records.raw:[],n=Array.isArray(t)?[].concat(t):[];if(!n.length)return null;var r=n.filter(function(e){return e.LogicalName===Constants.CrmTypeNames.User}),i=n.filter(function(e){return e.LogicalName!==Constants.CrmTypeNames.User}),o=[];return r.length&&(o=o.concat([this._renderErrorLabel("RECIPIENTS_ARE_SYSTEM_USERS"),this._renderListHeader(),this._renderRecordsList(r)])),i.length&&(o=o.concat([this._renderErrorLabel("RECIPIENTS_DONT_ALLOW_TO_FOLLOW"),this._renderListHeader(),this._renderRecordsList(i)])),this._context.factory.createElement("CONTAINER",{id:"FollowRestrictedRecipientsContainer",key:"FollowRestrictedRecipientsContainer",style:{display:"block"}},o)},e.prototype._renderRecordsList=function(e){var t=this;return this._context.factory.createElement("CONTAINER",{id:"FollowRestrictedRecipientsListContainer",key:"FollowRestrictedRecipientsListContainer",style:{display:"block"}},e.map(function(e){return t._renderRecord(e)}))},e.prototype._renderErrorLabel=function(e){var t=this._context.resources.getString(e);return this._context.factory.createElement("LABEL",{key:"ErrorText",id:"ErrorText",style:{display:"block",color:this._context.theming.colors.basecolor.red.red4,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular,marginBottom:this._context.theming.measures.measure050},title:t},[t])},e.prototype._renderListHeader=function(){var e=this._context.resources.getString("RECIPIENTS_WHO_CANT_BE_FOLLOWED");return this._context.factory.createElement("LABEL",{key:"ListHeader",id:"ListHeader",style:{display:"block",color:this._context.theming.colors.basecolor.grey.grey7,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular},title:e},[e])},e.prototype._renderRecord=function(e){var t=this;return this._context.factory.createElement("LABEL",{key:"Record_"+e.Id.guid,id:"Record_"+e.Id.guid,style:{cursor:"pointer",textDecoration:"none",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this._context.theming.colors.basecolor.blue.blue3,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.semibold,marginBottom:this._context.theming.measures.measure100},tabIndex:0,title:e.Name,role:"link",onClick:this._onRecordClick.bind(this,this._context,e),onKeyDown:function(n){t._onRecordKeyDown.bind(n,t._context,e)}},[e.Name])},e.prototype._onRecordClick=function(e,t){var n={entityName:t.LogicalName,entityId:t.Id.guid.toString()};e.navigation.openForm(n)},e.prototype._onRecordKeyDown=function(e,t,n){13===e.keyCode&&this._onRecordClick(t,n)},e.prototype.getOutputs=function(){return null},e.prototype.destroy=function(){},e}();e.FollowRestrictedRecipientsControl=t}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var Models;!function(e){var t;!function(e){e[e.NotLinked=0]="NotLinked",e[e.WillBeLinked=1]="WillBeLinked",e[e.IsLinked=2]="IsLinked",e[e.WillBeUnlinked=3]="WillBeUnlinked",e[e.WillBeUnlinkedAndDeleted=4]="WillBeUnlinkedAndDeleted",e[e.LinkFailed=5]="LinkFailed",e[e.InProgress=6]="InProgress"}(t=e.TrackingState||(e.TrackingState={}))}(Models||(Models={}));var Models;!function(e){var t;!function(e){e[e.IsNotFollowed=0]="IsNotFollowed",e[e.IsFollowed=1]="IsFollowed"}(t=e.FollowState||(e.FollowState={}))}(Models||(Models={}));var MscrmControls;!function(e){var t;!function(e){var t=function(){function e(){var e=this;this._followedEmailCrmId=null,this._onTrackStatusChange=function(t){e._trackStatus=t&&t.value,e._updateFollowedEmailCrmId()}}return e.prototype.init=function(e,t,n){var r=this,i=e&&e.externalContext&&e.externalContext.getAvailableExternalContexts();if(i&&i.getByName(Constants.contextId))this._context=e,this._notifyOutputChanged=t,this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackStatus,{updateListener:this._onTrackStatusChange}).then(function(e){r._trackStatus=e,r._updateFollowedEmailCrmId()},function(e){return e});else{var o=e.resources.getString("RELEVANT_MESSAGE_IN_INCORRECT_ENVIRONMENT");e.navigation.openErrorDialog({message:o})}},e.prototype._getFollowedEmailCrmId=function(){var e=this._trackStatus&&this._trackStatus.crmTrackingState===Models.TrackingState.IsLinked&&this._trackStatus.crmIsFollowed===Models.FollowState.IsFollowed;return e?this._trackStatus.crmId:null},e.prototype._updateFollowedEmailCrmId=function(){var e=this._getFollowedEmailCrmId();e!==this._followedEmailCrmId&&(this._followedEmailCrmId=e,this._notifyOutputChanged())},e.prototype.updateView=function(e){return this._context=e,this._context.factory.createElement("CONTAINER",{id:"mailAppHeader",style:{display:"block",width:"100%"}},null)},e.prototype.getOutputs=function(){var e={followedEmailCrmId:this._followedEmailCrmId};return e},e.prototype.destroy=function(){this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.TrackStatus,this._onTrackStatusChange)},e}();e.MailAppHiddenDataCustomControl=t}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var Models;!function(e){var t=function(){function e(e){this._entityReference=e}return e.prototype.getRecordId=function(){return this.getNamedReference().Id?this.getNamedReference().Id.toString():null},e.prototype.getErrorMessage=function(){throw new Error("Not implemented")},e.prototype.isDirty=function(){throw new Error("Not implemented")},e.prototype.isRecordValid=function(){throw new Error("Not implemented")},e.prototype.getNotification=function(e){throw new Error("Not implemented")},e.prototype.getValue=function(e){throw new Error("Not implemented")},e.prototype.setValue=function(e,t){throw new Error("Not implemented")},e.prototype.getFormattedValue=function(e){throw new Error("Not implemented")},e.prototype.isEditable=function(e){throw new Error("Not implemented")},e.prototype.isSecured=function(e){throw new Error("Not implemented")},e.prototype.isReadable=function(e){throw new Error("Not implemented")},e.prototype.isValid=function(e){throw new Error("Not implemented")},e.prototype.getFieldRequiredLevel=function(e){throw new Error("Not implemented")},e.prototype.getAttributes=function(e){throw new Error("Not implemented")},e.prototype.getValidator=function(e){throw new Error("Not implemented")},e.prototype.getNamedReference=function(){return this._entityReference},e.prototype.getActivityPartyRecord=function(){throw new Error("Not implemented")},e.prototype.validateAllColumns=function(){throw new Error("Not implemented")},e.prototype.save=function(){throw new Error("Not implemented")},e}();e.BaseDataSetRecord=t}(Models||(Models={}));var Common;!function(e){var t=function(){function e(t){if(this._guid=e._formatGuidString(t),!this.guid)throw new Error(t+" is not a valid Guid value.");Object.freeze(this)}return Object.defineProperty(e.prototype,"guid",{get:function(){return this._guid},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.guid},e._formatGuidString=function(t){if(!t)return null;t=t.toLowerCase();var n=e.braceAndHyphenGuidVerifierPattern.exec(t);if(n)return n[1].length!==n[8].length?null:n[2];var r=e.contiguousGuidVerifierPattern.exec(t);return r?r.filter(function(e,t){return t>0}).join("-"):null},e.newGuid=function(){for(var t="0123456789abcdef",n=36,r="",i=0;i<n;i++)if(14===i)r+="4";else if(8===i||13===i||18===i||23===i)r+="-";else if(19===i){var o=Math.floor(16*Math.random());r+=t.substr(3&o|8,1)}else r+=t.substr(Math.floor(16*Math.random()),1);return new e(r)},e.braceAndHyphenGuidVerifierPattern=/^({?)((\d|[a-f]){8}-(\d|[a-f]){4}-(\d|[a-f]){4}-(\d|[a-f]){4}-(\d|[a-f]){12})(}?)$/,e.contiguousGuidVerifierPattern=/^([a-f\d]{8})([a-f\d]{4})([a-f\d]{4})([a-f\d]{4})([a-f\d]{12})$/,e.EMPTY=new e("00000000-0000-0000-0000-000000000000"),e.toString=function(e){return e?e.guid:null},e.equals=function(t,n){return e.toString(t)===e.toString(n)},e.tryParse=function(t){return e.tryParseOrNull(t)||e.EMPTY},e.tryParseOrNull=function(t){var n=e._formatGuidString(t);return n?new e(n):null},e}();e.Guid=t}(Common||(Common={}));var MscrmControls;!function(e){var t;!function(e){var t;!function(e){e[e.Expanded=0]="Expanded",e[e.UpArrowHead=1]="UpArrowHead",e[e.LeftArrowHead=2]="LeftArrowHead",e[e.Collapsed=3]="Collapsed",e[e.Edit=4]="Edit",e[e.Save=5]="Save",e[e.Delete=6]="Delete",e[e.Remove=7]="Remove",e[e.Add=8]="Add",e[e.Cancel=9]="Cancel",e[e.HandClick=10]="HandClick",e[e.Accept=11]="Accept",e[e.More=12]="More",e[e.Forward=13]="Forward",e[e.Favorite=14]="Favorite",e[e.Placeholder=15]="Placeholder",e[e.RatingFull=16]="RatingFull",e[e.RatingEmpty=17]="RatingEmpty",e[e.Options=18]="Options",e[e.Manage=19]="Manage",e[e.Settings=20]="Settings",e[e.Find=21]="Find",e[e.Help=22]="Help",e[e.ViewNotifications=23]="ViewNotifications",e[e.StageAdvance=24]="StageAdvance",e[e.CheckMark=25]="CheckMark",e[e.Locked=26]="Locked",e[e.Lock=27]="Lock",e[e.MoreOptions=28]="MoreOptions",e[e.ContactInfo=29]="ContactInfo",e[e.Pin=30]="Pin",e[e.Unpin=31]="Unpin",e[e.Refresh=32]="Refresh",e[e.Details=33]="Details",e[e.VisualFilter=34]="VisualFilter",e[e.GlobalFilter=35]="GlobalFilter",e[e.Diamond=36]="Diamond",e[e.ApplyFilter=37]="ApplyFilter",e[e.CancelFilter=38]="CancelFilter",e[e.StreamView=39]="StreamView",e[e.TileView=40]="TileView",e[e.Import=41]="Import",e[e.Tools=42]="Tools",e[e.Attach=43]="Attach",e[e.Filter=44]="Filter",e[e.Copy=45]="Copy",e[e.HighPriority=46]="HighPriority",e[e.ReduceTile=47]="ReduceTile",e[e.ExpandTile=48]="ExpandTile",e[e.GlobalFilterExpand=49]="GlobalFilterExpand",e[e.GlobalFilterCollapse=50]="GlobalFilterCollapse",e[e.Clear=51]="Clear",e[e.Post=52]="Post",e[e.OneNote=53]="OneNote",e[e.Home=54]="Home",e[e.SetAsHome=55]="SetAsHome",e[e.BackButton=56]="BackButton",e[e.BackButtonWithoutBorder=57]="BackButtonWithoutBorder",e[e.UpArrow=58]="UpArrow",e[e.DownArrow=59]="DownArrow",e[e.SetActiveButton=60]="SetActiveButton",e[e.SearchButton=61]="SearchButton",e[e.ForwardButton=62]="ForwardButton",e[e.Mail=63]="Mail",e[e.CheckedMail=64]="CheckedMail",e[e.FailedMail=65]="FailedMail",e[e.Phone=66]="Phone",e[e.Chat=67]="Chat",e[e.OpenPane=68]="OpenPane",e[e.ClosePane=69]="ClosePane",e[e.AddFriend=70]="AddFriend",e[e.Arrow=71]="Arrow",e[e.DropdownArrow=72]="DropdownArrow",e[e.FlsLocked=73]="FlsLocked",e[e.LinkArticle=74]="LinkArticle",e[e.UnlinkArticle=75]="UnlinkArticle",e[e.CopyLink=76]="CopyLink",e[e.EmailLink=77]="EmailLink",e[e.Share=78]="Share",e[e.Assign=79]="Assign",e[e.Connect=80]="Connect",e[e.Opportunity=81]="Opportunity",e[e.Appointment=82]="Appointment",e[e.Task=83]="Task",e[e.Case=84]="Case",e[e.PhoneCallIncoming=85]="PhoneCallIncoming",e[e.PhoneCallOutgoing=86]="PhoneCallOutgoing",e[e.EmailIncoming=87]="EmailIncoming",e[e.EmailOutgoing=88]="EmailOutgoing",e[e.SendEmail=89]="SendEmail",e[e.ApplyTemplate=90]="ApplyTemplate",e[e.InsertKbArticle=91]="InsertKbArticle",e[e.SendSelected=92]="SendSelected",e[e.SaveAndClose=93]="SaveAndClose",e[e.ReplyEmail=94]="ReplyEmail",e[e.ReplyAllEmail=95]="ReplyAllEmail",e[e.ForwardEmail=96]="ForwardEmail",e[e.Close=97]="Close",e[e.Activate=98]="Activate",e[e.DeActivate=99]="DeActivate",e[e.DeleteBulk=100]="DeleteBulk",e[e.SocialActivityIncoming=101]="SocialActivityIncoming",e[e.SocialActivityOutgoing=102]="SocialActivityOutgoing",e[e.CustomActivity=103]="CustomActivity",e[e.SystemPost=104]="SystemPost",e[e.Convert=105]="Convert",e[e.MarkAsWon=106]="MarkAsWon",e[e.MarkAsLost=107]="MarkAsLost",e[e.SetRegarding=108]="SetRegarding",e[e.SaveAsComplete=109]="SaveAsComplete",e[e.SwitchProcess=110]="SwitchProcess",e[e.Recalculate=111]="Recalculate",e[e.SendDirectEmail=112]="SendDirectEmail",e[e.OpenMailbox=113]="OpenMailbox",e[e.ReOpenOpportunity=114]="ReOpenOpportunity",e[e.ReactivateLead=115]="ReactivateLead",e[e.Disqualify=116]="Disqualify",e[e.Qualify=117]="Qualify",e[e.SelectView=118]="SelectView",e[e.SelectChart=119]="SelectChart",e[e.OpenInBrowser=120]="OpenInBrowser",e[e.NewAppointment=121]="NewAppointment",e[e.NewRecurringAppointment=122]="NewRecurringAppointment",e[e.NewPhoneCall=123]="NewPhoneCall",e[e.NewTask=124]="NewTask",e[e.NewEmail=125]="NewEmail",e[e.AddExisting=126]="AddExisting",e[e.SaveAndEdit=127]="SaveAndEdit",e[e.Default=128]="Default",e[e.ScrollRight=129]="ScrollRight",e[e.ScrollLeft=130]="ScrollLeft",e[e.SaveAndRunRoutingRule=131]="SaveAndRunRoutingRule",e[e.RunRoutingRule=132]="RunRoutingRule",e[e.ResolveCase=133]="ResolveCase",e[e.CancelCase=134]="CancelCase",e[e.ReactivateCase=135]="ReactivateCase",e[e.AddToQueue=136]="AddToQueue",e[e.CreateChildCase=137]="CreateChildCase",e[e.QueueItemRoute=138]="QueueItemRoute",e[e.QueueItemRelease=139]="QueueItemRelease",e[e.QueueItemRemove=140]="QueueItemRemove",e[e.QueueItemPick=141]="QueueItemPick",e[e.Drilldown=142]="Drilldown",e[e.PopOverButton=143]="PopOverButton",e[e.ExitButton=144]="ExitButton",e[e.ExportToExcel=145]="ExportToExcel",e[e.WordTemplates=146]="WordTemplates",e[e.DocumentTemplates=147]="DocumentTemplates",e[e.OpenInPowerBI=148]="OpenInPowerBI",e[e.OpenPowerBIReport=149]="OpenPowerBIReport",e[e.OpenDelve=150]="OpenDelve",e[e.ArticleLink=151]="ArticleLink",e[e.ArchiveArticle=152]="ArchiveArticle",e[e.ApproveArticle=153]="ApproveArticle",e[e.DiscardArticle=154]="DiscardArticle",e[e.Minor=155]="Minor",e[e.Major=156]="Major",e[e.PublishKnowledgeArticle=157]="PublishKnowledgeArticle",e[e.RelateArticle=158]="RelateArticle",e[e.RelateProduct=159]="RelateProduct",e[e.RestoreArticle=160]="RestoreArticle",e[e.RevertToDraftArticle=161]="RevertToDraftArticle",e[e.Translate=162]="Translate",e[e.UpdateArticle=163]="UpdateArticle",e[e.RemoveFilter=164]="RemoveFilter",e[e.Article=165]="Article",e[e.Graph=166]="Graph",e[e.CSR=167]="CSR",e[e.MembersIcon=168]="MembersIcon",e[e.QueueIcon=169]="QueueIcon",e[e.SiteMap=170]="SiteMap",e[e.NormalPriority=171]="NormalPriority",e[e.LowPriority=172]="LowPriority",e[e.ViewIcon=173]="ViewIcon",e[e.RecentCases=174]="RecentCases",e[e.KBRecords=175]="KBRecords",e[e.NumberOfViews=176]="NumberOfViews",e[e.ResizeHandle=177]="ResizeHandle",e[e.TaskBasedFlow=178]="TaskBasedFlow",e[e.InformationIcon=179]="InformationIcon",e[e.PencilIcon=180]="PencilIcon",e[e.ErrorIcon=181]="ErrorIcon",e[e.SuccessIcon=182]="SuccessIcon",e[e.OptionsetIcon=183]="OptionsetIcon",e[e.NotificationIcon=184]="NotificationIcon",e[e.PanelHeaderImportDataIcon=185]="PanelHeaderImportDataIcon",e[e.SidePanelUpload=186]="SidePanelUpload",e[e.New=187]="New",e[e.DetailsPageClose=188]="DetailsPageClose",e[e.SettingsListIcon=189]="SettingsListIcon",e[e.ListIcon=190]="ListIcon",e[e.ForwardDisable=191]="ForwardDisable",e[e.PdfIconFile=192]="PdfIconFile",e[e.PresentationFile=193]="PresentationFile",e[e.OneNoteFile=194]="OneNoteFile",e[e.AccessFile=195]="AccessFile",e[e.VisioFile=196]="VisioFile",e[e.ProjectFile=197]="ProjectFile",e[e.Plus=198]="Plus",e[e.ChevronUp=199]="ChevronUp",e[e.ChevronDown=200]="ChevronDown",e[e.HappySmiley=201]="HappySmiley",e[e.SadSmiley=202]="SadSmiley",e[e.CaseResolution=203]="CaseResolution",e[e.CampaignResolution=204]="CampaignResolution",e[e.ServiceActivity=205]="ServiceActivity",e[e.Notes=206]="Notes",e[e.Audio=207]="Audio",e[e.Camera=208]="Camera",e[e.Video=209]="Video",e[e.Image=210]="Image",e[e.Html=211]="Html",e[e.SharePointEditDocument=212]="SharePointEditDocument",e[e.SharePointDeleteDocument=213]="SharePointDeleteDocument",e[e.SharePointCheckoutDocument=214]="SharePointCheckoutDocument",e[e.SharePointCheckinDocument=215]="SharePointCheckinDocument",e[e.SharePointEditDocumentProperties=216]="SharePointEditDocumentProperties",e[e.SharePointDiscardCheckoutDocument=217]="SharePointDiscardCheckoutDocument",e[e.SharePointNewDocument=218]="SharePointNewDocument",e[e.SharePointNewWordDocument=219]="SharePointNewWordDocument",e[e.SharePointNewExcelDocument=220]="SharePointNewExcelDocument",e[e.SharePointNewPowerPointDocument=221]="SharePointNewPowerPointDocument",e[e.SharePointNewOneNoteDocument=222]="SharePointNewOneNoteDocument",e[e.SharePointUploadDocument=223]="SharePointUploadDocument",e[e.SharePointChangeLocation=224]="SharePointChangeLocation",e[e.SharePointAddDocumentLocation=225]="SharePointAddDocumentLocation",e[e.SharePointEditLocation=226]="SharePointEditLocation",e[e.SharePointOpenLocation=227]="SharePointOpenLocation",e[e.SharePointOpenDocument=228]="SharePointOpenDocument",e[e.SendByEmail=229]="SendByEmail",e[e.CreateQuote=230]="CreateQuote",e[e.Reply=231]="Reply",e[e.Warning=232]="Warning",e[e.Play=233]="Play",e[e.ExpandButton=234]="ExpandButton",e[e.AssociatedArticle=235]="AssociatedArticle",e[e.DisassociatedArticle=236]="DisassociatedArticle",e[e.FormDesign=237]="FormDesign",e[e.GlobalFilterClearAll=238]="GlobalFilterClearAll",e[e.GlobalFilterExpandedRow=239]="GlobalFilterExpandedRow",e[e.GlobalFilterCollapsedRow=240]="GlobalFilterCollapsedRow",e[e.RelationshipAssistant=241]="RelationshipAssistant",e[e.AutomaticSuggestions=242]="AutomaticSuggestions",e[e.SemanticZoom=243]="SemanticZoom",e[e.SemanticZoomMirrored=244]="SemanticZoomMirrored",e[e.BackwardButton=245]="BackwardButton",e[e.MultiSelect=246]="MultiSelect",e[e.MultiSelectMirrored=247]="MultiSelectMirrored",e[e.Spinning=248]="Spinning",e[e.RetireProduct=249]="RetireProduct",e[e.AddProduct=250]="AddProduct",e[e.OfflineStatus=251]="OfflineStatus",e[e.Abandon=252]="Abandon",e[e.Reactivate=253]="Reactivate",e[e.FinishStage=254]="FinishStage",e[e.SortButton=255]="SortButton",e[e.SelectButton=256]="SelectButton",e[e.SelectButtonRTL=257]="SelectButtonRTL",e[e.Flows=258]="Flows",e[e.OpenEntityRecord=259]="OpenEntityRecord",e[e.View=260]="View",e[e.CreateView=261]="CreateView",e[e.EditView=262]="EditView",e[e.GuestUser=263]="GuestUser",e[e.History=264]="History",e[e.ReassignRecords=265]="ReassignRecords",e[e.ManageRoles=266]="ManageRoles",e[e.JoinTeams=267]="JoinTeams",e[e.ChangeManager=268]="ChangeManager",e[e.AddMembers=269]="AddMembers",e[e.RemoveMembers=270]="RemoveMembers",e[e.Download=271]="Download",e[e.SetAsDefaultView=272]="SetAsDefaultView",e[e.Pinned=273]="Pinned",e[e.DistributionList=274]="DistributionList",e[e.MergeRecords=275]="MergeRecords",e[e.AssociateChildCase=276]="AssociateChildCase",e[e.SetAsDefault=277]="SetAsDefault",e[e.ConvertKnowledgeArticle=278]="ConvertKnowledgeArticle",e[e.Messenger=279]="Messenger",e[e.AssociateCategory=280]="AssociateCategory",e[e.OfficeWaffle=281]="OfficeWaffle",e[e.TripleColumn=282]="TripleColumn",e[e.Tiles=283]="Tiles",e[e.HideVisualFilter=284]="HideVisualFilter",e[e.InteractiveDashboard=285]="InteractiveDashboard",e[e.Dynamics365=286]="Dynamics365",e[e.SalesLiterature=287]="SalesLiterature",e[e.Checkbox=288]="Checkbox",e[e.CheckboxComposite=289]="CheckboxComposite"}(t=e.MicrosoftIconSymbol||(e.MicrosoftIconSymbol={}))}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(e){var t;!function(e){var t="GridListContainer",n="GridList";e.entityImgUrlAlias="entityimage_url",e.tapHoldThreshold=800;var r=function(){function r(t){var n=this;this._onClickCapture=function(e){n._clearTimer()},this._onPointerMove=function(e){n._clearTimer()},this._onPointerDown=function(t,r){n._timer=setTimeout(function(){return n._tapHold(t,r)},e.tapHoldThreshold)},this._clearTimer=function(){n._timer&&(clearTimeout(n._timer),n._timer=null)},this._tapHold=function(e,t){n._clearTimer(),e.preventDefault()},this._setContext(t),this._cardStates={}}return Object.defineProperty(r.prototype,"dataSet",{get:function(){return this._dataSet},enumerable:!0,configurable:!0}),r.prototype.render=function(e){return e.parameters.Grid.working||!e.parameters.Grid.sortedRecordIds.length?null:(this._setContext(e),this._createList(this))},r.prototype._createList=function(e){var n=this._context.parameters.Grid.hasError?this._getErrorPlaceholder():this._getListItemsContent(),r=[this._getTitle(),n];return this._context.factory.createElement("CONTAINER",{key:t,id:t,role:"presentation",style:{display:"flex",flexDirection:"column",backgroundColor:this._context.theming.colors.whitebackground,overflow:"hidden",position:"relative",width:"100%"}},r)},r.prototype._getErrorPlaceholder=function(){var t={fontSize:"2em",fontWeight:"normal",color:"red"};return this._context.factory.createElement("PLACEHOLDER",{text:this._context.parameters.Grid.errorMessage,icon:e.MicrosoftIconSymbol.DetailsPageClose,iconStyle:t})},r.prototype._getTitle=function(){var e=this._context.mode._customControlProperties.descriptor.Label;return e?this._context.factory.createElement("CONTAINER",{key:"ListHeader",id:"ListHeader",style:{display:"flex",flexDirection:"column",flex:"0 0 auto",borderBottom:"1px "+this._context.theming.solidborderstyle+" "+this._context.theming.colors.grays.gray03,paddingLeft:this._context.theming.measures.measure100,paddingRight:this._context.theming.measures.measure100,paddingTop:this._context.theming.measures.measure050,paddingBottom:this._context.theming.measures.measure050,fontFamily:this._context.theming.fontfamilies.semibold,fontSize:this._context.theming.fontsizes.font100,color:this._context.theming.colors.basecolor.grey.grey7,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},e):null},r.prototype._setContext=function(e){var t=e.parameters.Grid;this._recordsDataInit&&!t.working&&this._recordsDataInit(t),this._context=e,this._recordIds=t.sortedRecordIds},r.prototype._getListItemsContent=function(){return this._context.factory.createElement("LIST",{key:n,id:n,role:"list",style:{flex:"1 1 auto",display:"block",overflowX:"hidden",overflowY:"auto"}},this._getListItems())},r.prototype._getListItems=function(){var t=this,n=[],r=this._context.parameters.Grid,i=this._recordIds.map(function(e){return r.records[e]});return i.forEach(function(r,i){var o=r.getRecordId(),a=t._cardStates[o]||(t._cardStates[o]=new e.MailAppListItemComponent(t._context,r,t)),s={backgroundColor:t._context.theming.colors.grays.gray03},c=i?"1px "+t._context.theming.solidborderstyle+" "+t._context.theming.colors.grays.gray03:void 0,l={display:"block",listStyleType:"none",cursor:"pointer",paddingLeft:t._context.theming.measures.measure100,paddingRight:t._context.theming.measures.measure100,borderTop:c,":hover":s},d=t._context.factory.createElement("LISTITEM",{id:"ListItem_"+o,key:"ListItem_"+o,tabIndex:0,role:"listitem",style:l,onClickCapture:t._onClickCapture,onPointerMove:t._onPointerMove,onPointerDown:function(e){return t._onPointerDown(e,o)}},a.render(r));n.push(d)}),n},r}();e.MailAppListComponent=r}(t=e.MailApp||(e.MailApp={}));
}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(e){var t;!function(e){var t=function(){function t(e,t,n){this._context=e;var r=t.getNamedReference();this._props={entityName:r&&r.LogicalName,entityPrimaryField:this._getEntityPrimaryField(e)}}return t.prototype.render=function(e){return this._cardComponent||(this._cardComponent=this._createDefaultTemplate()),this._cardComponent.state={dataSetRecord:e},this._cardComponent.render()},t.prototype._createDefaultTemplate=function(){return new e.MailAppListDefaultTemplate(this._context,this._props)},t.prototype._getEntityPrimaryField=function(e){var t=e.parameters.Grid.columns.find(function(e){return e.isPrimary});return t?t.name:e.parameters.Grid.columns[0].name},t}();e.MailAppListItemComponent=t}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var Utility;!function(e){function t(e){return e?e.slice(0===e.indexOf("{")?1:0,e.indexOf("}")===e.length-1?e.length-1:e.length):e}function n(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\d+)}/g,function(e,n){return"undefined"!==typeof t[n]?t[n]:e})}function r(e){for(var t="",n=0;n<e.length;++n){var r=e.charCodeAt(n).toString(16);t+=2===r.length?r:"0"+r}return t.toUpperCase()}function i(e){var t={};return"object"!==typeof e||Array.isArray(e)?e:(e?Object.getOwnPropertyNames(e).forEach(function(n){t[n]=e[n]}):t.error="undefined",t)}e.TrimGuid=t,e.formatString=n,e.binToHex=r,e.errorToObject=i}(Utility||(Utility={}));var MscrmControls;!function(e){var t;!function(e){var t="Whole.Duration",n="MailApp.Control.MailAppList.MailAppListDefaultTemplate",r=function(){function r(e,t){this._state={dataSetRecord:null},this._context=e,this._props=t}return Object.defineProperty(r.prototype,"state",{set:function(e){Object.assign(this._state,e)},enumerable:!0,configurable:!0}),r.prototype.render=function(){var e=this._state.dataSetRecord.getRecordId(),t=[this.renderEntityImage(),this._renderListItemContent(),this.renderCommandBar()];return this._context.factory.createElement("CONTAINER",{key:"ListItem_"+e,id:"ListItem_"+e,style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between","font-size":this._context.theming.fontsizes.font100,"line-height":this._context.theming.measures.measure150,"font-family":this._context.theming.fontfamilies.regular,"padding-top":this._context.theming.measures.measure100,"padding-bottom":this._context.theming.measures.measure100,height:this._context.theming.measures.measure450},onClick:this._onListItemClickHandler.bind(this)},t)},r.prototype.renderField=function(e,n){var r=this._state.dataSetRecord,i=this.getFieldType(e)===t,o=i?r.reformatValue(e):r.getFormattedValue(e);return o?this._renderLabel(o,n):null},r.prototype._onListItemClickHandler=function(e){var t={Id:new Common.Guid(this._state.dataSetRecord.getRecordId()),Name:null,LogicalName:this._props.entityName};this._context.parameters.Grid.openDatasetItem(t),e.preventDefault(),e.stopPropagation()},r.prototype.renderEntityImage=function(){var e=this._context.factory.createElement("ENTITYIMAGE",{key:"ListCardEntityImage",hasPrimaryImageField:!0,style:{borderRadius:"50%",display:"block",width:"100%",height:"100%"},entityPrimaryField:this._state.dataSetRecord.getFormattedValue(this._props.entityPrimaryField)});return this._context.factory.createElement("CONTAINER",{key:"ListCardImage",id:"ListCardImage",style:{display:"flex","justify-content":"center","align-items":"center",flex:"0 0 "+this._context.theming.measures.measure250,"border-radius":"50%",width:this._context.theming.measures.measure250,height:this._context.theming.measures.measure250,"line-height":this._context.theming.measures.measure250,"background-color":this._context.theming.colors.grays.gray01,color:this._context.theming.colors.basecolor.white,"font-size":"16px","text-align":"center","margin-right":this._context.theming.measures.measure100,overflow:"hidden"}},e)},r.prototype.renderCommandBar=function(){var e=this,t=this._context.parameters.ListItemCommands&&this._context.parameters.ListItemCommands.raw;if(!t)return null;var n=this._state.dataSetRecord.getRecordId(),r=t.split("|").filter(Boolean);return setTimeout(function(){e._retrieveCommandBarCommands(n,r)},0),this._renderInnerCommandBar(n)},r.prototype._retrieveCommandBarCommands=function(e,t){var r=this;this._context.parameters.Grid.retrieveRecordCommand([e],t,void 0,!0,!0).then(function(e){void 0===e&&(e=[]);var t=e.filter(function(e){return e.shouldBeVisible}),n=t[0],i=n?n.commandId:"",o=r._command?r._command.commandId:"";i!==o&&(r._command=n,r._context.utils.requestRender())},function(e){var t=Utility.errorToObject(e),i=[{name:"Error",value:JSON.stringify(t)}];r._context.reporting.reportFailure(n,e,null,i)})},r.prototype._renderInnerCommandBar=function(t){var n=this;if(!this._command)return null;var r="CardCommandButton_"+t,i=this._command.icon?e.MicrosoftIconSymbol[this._command.icon]:e.MicrosoftIconSymbol.LinkArticle,o=this._context.factory.createElement("MICROSOFTICON",{id:"CardCommandIcon",key:"CardCommandIcon",type:i}),a={backgroundColor:"transparent",borderStyle:this._context.theming.noneborderstyle,"line-height":"32px",width:"32px",padding:"0px","font-size":"16px",cursor:"pointer",color:this._context.theming.colors.grays.gray07,display:"block","text-align":"center"},s=this._context.factory.createElement("BUTTON",{id:r,key:r,title:this._command.label,accessibilityLabel:this._command.label,role:"button",tabIndex:0,onClick:function(e){n._command.canExecute&&(n._command.execute(),e.preventDefault(),e.stopPropagation())},style:a},[o]);return this._context.factory.createElement("CONTAINER",{key:"CardCommandContainer_"+t,id:"CardCommandContainer_"+t,style:{display:"block",flex:"0 0 auto",alignSelf:"flex-start"}},[s])},r.prototype._renderListItemContent=function(){var t=[],n=this._props.entityPrimaryField,r=this._renderListItemField(n,!0);r&&t.push(r);for(var i=3,o=0;o<this._context.parameters.Grid.columns.length&&t.length<i;o++){var a=this._context.parameters.Grid.columns[o];if(a.name!==n&&a.alias!==e.entityImgUrlAlias){var s=this._renderListItemField(a.name,!1);s&&t.push(s)}}return this._context.factory.createElement("CONTAINER",{key:"ListItemContent",id:"ListItemContent",style:{display:"block",width:"100%",overflow:"hidden","white-space":"nowrap","margin-right":this._context.theming.measures.measure025}},t)},r.prototype._renderListItemField=function(e,t){var n=this.renderField(e,t);return n?this._context.factory.createElement("CONTAINER",{key:"FieldValue_"+e,id:"FieldValue_"+e,style:{display:"block",overflow:"hidden","text-overflow":"ellipsis"}},n):null},r.prototype.getFieldType=function(e){var t=this._context.parameters.Grid.columns;if(t){var n=t.find(function(t){return t.name===e});return n&&n.dataType}},r.prototype._renderLabel=function(e,t){return void 0===t&&(t=!1),this._context.factory.createElement("LABEL",{key:"ListItemLabel",title:e,style:{display:"block","text-decoration":"none",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer",color:t?this._context.theming.colors.grays.gray07:this._context.theming.colors.grays.gray05}},e)},r}();e.MailAppListDefaultTemplate=r}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(e){var t;!function(e){var t=function(){function t(){var e=this;this._onTrackStatusChange=function(){return e._context.utils.requestRender()}}return t.prototype.init=function(t,n,r){var i=t&&t.externalContext&&t.externalContext.getAvailableExternalContexts();i&&i.getByName(Constants.contextId)&&(this._context=t,this._listComponent=new e.MailAppListComponent(this._context),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackStatus,{updateListener:this._onTrackStatusChange}))},t.prototype.updateView=function(e){return this._context=e,this._context.parameters.Grid.working?void 0:this._listComponent.render(this._context)},t.prototype.getOutputs=function(){return null},t.prototype.destroy=function(){this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.TrackStatus,this._onTrackStatusChange)},t}();e.MailAppListControl=t}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var Models;!function(e){var t;!function(e){e[e.Sender=1]="Sender",e[e.To=2]="To",e[e.Cc=3]="Cc",e[e.Bcc=4]="Bcc",e[e.Organizer=5]="Organizer",e[e.RequiredAttendee=6]="RequiredAttendee",e[e.OptionalAttendee=7]="OptionalAttendee"}(t=e.RecipientRole||(e.RecipientRole={}))}(Models||(Models={}));var Models;!function(e){var t=function(t){function n(e,n,r){var i=t.call(this,{Id:e||"",LogicalName:n,Name:r.name})||this;return i._dataValues=r,i}return __extends(n,t),n.ExternalContextRecipientToRecipientRecord=function(t){return new e.RecipientRecord(t.entityReference.Id&&t.entityReference.Id.guid,t.entityReference.LogicalName,t.dataValues)},n.prototype.getFormattedValue=function(e){return this._dataValues[e]},n.prototype.setValue=function(e,t){return this._isDirty=!0,this._dataValues[e]=t,null},n.prototype.isDirty=function(){return this._isDirty},n}(e.BaseDataSetRecord);e.RecipientRecord=t}(Models||(Models={}));var MscrmControls;!function(e){var t;!function(e){var t="name",n="emailaddress",r="entityImage",i="entityHealthScore",o="RecipientsTabsScrollContainer",a="RecipientTab_",s="distributionList",c="externalUser",l="other",d="membersicon",u=function(){function e(){var e=this;this._startTabIndex=0,this._onSelectedRecipientChange=function(t){t&&1===t.status&&e._selectedRecipientExternalPropertyValue!==t.value&&(e._selectedRecipientExternalPropertyValue=t.value,e._selectedRecord=null,e._context.utils.requestRender())},this._onResolveRecipients=function(t){1===t.status&&e._processRecipientsChange(t.value,!0)}}return Object.defineProperty(e.prototype,"RecipientsRecords",{get:function(){return this._recipientsRecords||[]},set:function(e){this._recipientsRecords=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_isExternalContextAvailable",{get:function(){var e=this._context?this._context.externalContext&&this._context.externalContext.getAvailableExternalContexts():null;return e&&e.getByName(Constants.contextId)},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,n){this._context=e,this._isExternalContextAvailable&&(this._notifyOutputChanged=t,this._getRecipients())},e.prototype.updateView=function(e){return this._context=e,this._isExternalContextAvailable?-1!==this._getCurrentRecipientsCount()&&this._itemType?0===this._getCurrentRecipientsCount()&&this._itemType?this._createNoRecipientControl():(this._updateSelection(),e.factory.createElement("CONTAINER",{id:"RecipientsTabContainer",key:"RecipientsTabContainer",style:{display:"block",width:"100%","font-family":this._context.theming.fontfamilies.regular,color:this._context.theming.colors.grays.gray05,"background-color":this._context.theming.colors.whitebackground}},[this._createHeaderLabel(),this._createRecipientsTabs(this.RecipientsRecords)])):null:void 0},e.prototype._createHeaderLabel=function(){var e="";return this._itemType&&(e=this._context.resources.getString("MailAppRecipientsTabControl_"+(this._itemType===Constants.MailboxItemTypes.Message?"Recipients":"Attendees")+"_Header")),this._context.factory.createElement("TEXT",{id:"RecipientsTabContainerHeader",key:"RecipientsTabContainerHeader",semanticTag:"h2",style:{display:"block","font-size":this._context.theming.measures.measure100,"line-height":this._context.theming.measures.measure100,padding:this._context.theming.measures.measure100,"font-weight":"normal"}},e)},e.prototype._createNoRecipientControl=function(){var e=this._context.resources.getString(this._itemType===Constants.MailboxItemTypes.Message?"MailAppRecipientsTabControl_No_Recipients":"MailAppRecipientsTabControl_No_Attendees");return this._context.factory.createElement("LABEL",{id:"No_Recipients_Label",key:"No_Recipients_Label",style:{display:"block",padding:this._context.theming.measures.measure100}},e)},e.prototype._createRecipientsTabs=function(e){var t=this,n=e.map(function(n,r){return t._createRecipientTab(n,r,e.length)}),r=this._context.resources.getString("MailAppRecipientsTabControl_Scroll_Right_The_Content"),i=this._context.resources.getString("MailAppRecipientsTabControl_Scroll_Left_The_Content");return this._context.factory.createElement("HORIZONTALSCROLL",{id:o,key:"RecipientsTabsScrollContainer",scrollRightAccessibilityLabel:r,scrollLeftAccessibilityLabel:i,startChildIndex:this._startTabIndex,scrollViewStyle:{overflowX:"hidden"},arrowButtonStyle:{height:"52px",border:"0px "+this._context.theming.noneborderstyle,color:this._context.theming.colors.grays.gray05,"font-size":"16px","background-color":this._context.theming.colors.whitebackground,padding:"0px",cursor:"pointer",":disabled":{opacity:"0"}},arrowWidth:16,prevArrowIconType:2,nextArrowIconType:71},n)},e.prototype._onKeyUp=function(e,t,n){switch(e.keyCode){case 37:this._context.userSettings.isRTL?this._focusNextRecipient(t,n):this._focusPreviousRecipient(t,n);break;case 39:this._context.userSettings.isRTL?this._focusPreviousRecipient(t,n):this._focusNextRecipient(t,n);break;case 36:this._context.accessibility.focusElementById(this._getRecipientTabId(0));break;case 35:this._context.accessibility.focusElementById(this._getRecipientTabId(n-1));break;case 13:this._changeSelectTab(this.RecipientsRecords[t])}},e.prototype._focusPreviousRecipient=function(e,t){var n=e-1;-1===n&&(n=t-1),this._context.accessibility.focusElementById(this._getRecipientTabId(n))},e.prototype._focusNextRecipient=function(e,t){var n=e+1;n===t&&(n=0),this._context.accessibility.focusElementById(this._getRecipientTabId(n))},e.prototype._getUnquotedName=function(e){return e&&"'"===e.charAt(0)&&"'"===e.charAt(e.length-1)&&(e=e.substring(1,e.length-1)),e},e.prototype._createRecipientTab=function(e,o,s){var c=this,u=this._getUnquotedName(e.getFormattedValue(t)),p=e.getFormattedValue(n),m=this._getRecordEntityLogicalName(e),h=this._context.theming.measures.measure350,g=e.getFormattedValue(i),_={entityName:m&&m!==l?m:d},y={width:h,height:h,"font-size":this._isDistributionList(e)?this._context.theming.fontsizes.font150:this._context.theming.fontsizes.font115,"font-family":this._context.theming.fontfamilies.regular,display:"block","line-height":g?this._context.theming.measures.measure250:h,"border-radius":"50%","box-sizing":"border-box",color:this._context.theming.colors.base.white,border:(g?this._context.theming.measures.measure050:"0px")+" "+this._context.theming.solidborderstyle+" "+this._context.theming.colors.whitebackground},f=e.getFormattedValue(r),C=this._context.factory.createElement("ENTITYIMAGE",{id:"Img_"+o,hasPrimaryImageField:u!==p,entityReference:_,style:y,entityPrimaryField:u,imageSrc:f?"data:image;base64,"+f:null,entityHealthScore:g,alt:this._getEntityImageAltText(e)}),x={flex:"0 0 "+h,display:"block","text-align":"center",marginLeft:!this._context.client.isRTL&&o?this._context.theming.measures.measure100:"0px",marginRight:this._context.client.isRTL&&o?this._context.theming.measures.measure100:"0px",cursor:"pointer"},R=this._selectedRecord&&this._selectedRecord.getFormattedValue(n)===e.getFormattedValue(n),S=this._getRecipientTabId(o),v=a+p,E="MailAppRecipientsTabControl_Recipient_Selected",k=u||p,T=R?this._format(this._context.resources.getString(E),k):k;return this._context.factory.createElement("CONTAINER",{id:S,key:v,style:x,tabIndex:0,title:k,accessibilityLabel:T,onClick:this._changeSelectTab.bind(this,e),onKeyUp:function(e){c._onKeyUp(e,o,s)}},[C,this._renderRecipientName(u,p,o,R)])},e.prototype._updateSelection=function(){var e=this._selectedRecord&&this._selectedRecord.getFormattedValue(n);this._applySelection(e||this._selectedRecipientExternalPropertyValue)},e.prototype._isSelectedRecordChanged=function(e){var t=!this._isSelectedRecordEmailAddressSame(e&&e.getFormattedValue(n)),r=this._isCRMRecord(this._selectedRecord)!==this._isCRMRecord(e);return t||r},e.prototype._getRecordByEmailAddress=function(e){for(var t=0;t<this.RecipientsRecords.length;t++){var r=this.RecipientsRecords[t],i=r.getFormattedValue(n);if(i&&e&&i.toLowerCase()===e.toLowerCase())return r}return null},e.prototype._isSelectedRecordEmailAddressSame=function(e){return e&&this._selectedRecord&&this._selectedRecord.getFormattedValue(n)&&this._selectedRecord.getFormattedValue(n).toLowerCase()===e.toLowerCase()},e.prototype._getRecipients=function(){var e=this,t=this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.SelectedRecipient,{updateListener:this._onSelectedRecipientChange});Promise.all([this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.ItemType),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.IsComposeMode),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.ResolvedRecipients,{updateListener:this._onResolveRecipients})]).then(function(n){var r=n[0],i=n[1],o=n[2];e._itemType=r,e._isComposeMode=i,t.then(function(t){e._selectedRecipientExternalPropertyValue=t,e._processRecipientsChange(o)},function(){e._processRecipientsChange(o)})})["catch"](function(e){})},e.prototype._processRecipientsChange=function(e,t){if(void 0===t&&(t=!1),e&&e.recipients){var n=e.recipients,r=n.map(Models.RecipientRecord.ExternalContextRecipientToRecipientRecord),i=!this._recipientsRecords,o=e&&e.isNewMailboxItem;if(!o&&r.length||(this._selectedRecord=null),!i&&this._isComposeMode){var a=this._getEmailsAddressDetailsChangesFlags(r);(a.isRecipientsWereAdded||a.isRecipientsWereRemoved)&&this._showRecipientsChangedNotification(a)}var s=r.find(function(e){var t=e.getFormattedValue("role");return t===Models.RecipientRole.Sender||t===Models.RecipientRole.Organizer});(this._isSenderChanged(s)||o)&&(this._currentSender=s),this.RecipientsRecords=r,this._notifyOutputChanged(),this._context.utils.requestRender()}},e.prototype._showRecipientsChangedNotification=function(e){var t=this,n=this._itemType===Constants.MailboxItemTypes.Message?"Recipients_":"Attendees_",r="Were_Added";e.isRecipientsWereAdded&&e.isRecipientsWereRemoved?r="Were_Added_And_Removed":e.isRecipientsWereRemoved&&(r="Were_Removed");var i=this._context.resources.getString("MailAppRecipientsTabControl_"+n+r);this._lastRecepientChangedNotificationId&&this._context.utils.clearGlobalNotification(this._lastRecepientChangedNotificationId),this._context.utils.addGlobalNotification(1,1,i,"",null,null).then(function(e){t._lastRecepientChangedNotificationId=e})},e.prototype._getCurrentRecipientsCount=function(){return this._recipientsRecords?this._recipientsRecords.length:-1},e.prototype._getEmailsAddressDetailsChangesFlags=function(e){var t=this;if(this._recipientsRecords){var n=!1,r={};return(e||[]).forEach(function(e){r[t._getRecipientEmail(e)]=!0}),this.RecipientsRecords.forEach(function(e){var i=t._getRecipientEmail(e);r[i]?delete r[i]:n=!0}),{isRecipientsWereAdded:Object.keys(r).length>0,isRecipientsWereRemoved:n}}},e.prototype._getRecipientEmail=function(e){var t=e.getFormattedValue(Constants.PropertyNames.Email);return t&&t.toLowerCase()},e.prototype._isSenderChanged=function(e){return e&&this._currentSender?this._currentSender.getFormattedValue(Constants.PropertyNames.Email)!==e.getFormattedValue(Constants.PropertyNames.Email):Boolean(e||this._currentSender)},e.prototype._applySelection=function(e){if(this.RecipientsRecords&&this.RecipientsRecords.length){for(var t,r=0;r<this.RecipientsRecords.length;r++){var i=this.RecipientsRecords[r],o=i.getFormattedValue(n);if(o&&e&&o.toLowerCase()===e.toLowerCase()){t=i;break}t||!i.getNamedReference()||i.getNamedReference().LogicalName!==Constants.CrmTypeNames.Contact&&i.getNamedReference().LogicalName!==Constants.CrmTypeNames.Lead&&i.getNamedReference().LogicalName!==Constants.CrmTypeNames.Account&&i.getNamedReference().LogicalName!==c||(t=i)}t||(t=this.RecipientsRecords[0]),this._isSelectedRecordChanged(t)&&(this._setSelectedRecord(t),this._context.utils.requestRender())}},e.prototype._isDistributionList=function(e){return this._getRecordEntityLogicalName(e)===s},e.prototype._getEntityImageAltText=function(e){if(this._isCRMRecord(e)){var r=e.getFormattedValue(t),o=e.getFormattedValue(i);if(o){var a=this._context.resources.getString("MailAppRecipientsTabControl_RecipientFullName_WithScore");return this._format(a,r,o)}var a=this._context.resources.getString("MailAppRecipientsTabControl_RecipientFullName");return this._format(a,r)}var a=this._context.resources.getString("MailAppRecipientsTabControl_UnknownRecipientWithEmail");return this._format(a,e.getFormattedValue(n))},e.prototype._getRecipientTabId=function(e){return a+e},e.prototype._renderRecipientName=function(e,t,n,r){return this._context.factory.createElement("CONTAINER",{id:"Name_"+n,key:"Name_"+t,style:{display:"block",width:this._context.theming.measures.measure350,whiteSpace:"normal","text-overflow":"ellipsis",overflow:"hidden","font-size":this._context.theming.fontsizes.font075,height:this._context.theming.fontsizes.font175,"line-height":this._context.theming.fontsizes.font175,"margin-bottom":this._context.theming.measures.measure075,"border-bottom":"3px "+this._context.theming.solidborderstyle+" "+(r?this._context.theming.colors.basecolor.blue.blue3:this._context.theming.colors.whitebackground)}},[this._getRecipientFirstName(e,t)])},e.prototype._getRecipientFirstName=function(e,t){var n=-1!==(e||t).indexOf("@");if(e&&!n){var r=e.split(",");if(r.length>1)return r[r.length-1];var i=e.split(" ");return i.slice(0,-1).join(" ")||e}return t.substring(0,t.indexOf("@"))},e.prototype._changeSelectTab=function(e){this._setSelectedRecord(e),this._context.utils.requestRender(),e&&e.getFormattedValue(n)&&this._context.externalContext.invokeExternalContextAction(Constants.contextId,Constants.ActionIds.SetSelectedRecipient,{args:{selectedRecipient:e.getFormattedValue(n)}})},e.prototype._setSelectedRecord=function(e){this._selectedRecord=e,this._notifyOutputChanged()},e.prototype._isCRMRecord=function(e){var t=this._getRecordEntityLogicalName(e);return t&&-1!==Constants.RecipientCRMTypeNames.indexOf(t)},e.prototype._getRecordEntityLogicalName=function(e){return e&&e.getNamedReference()&&e.getNamedReference().LogicalName},e.prototype._format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\d+)}/g,function(e,n){return"undefined"!==typeof t[n]?t[n]:e})},e.prototype.getOutputs=function(){var e={selectedCrmRecord:this._isCRMRecord(this._selectedRecord)?this._selectedRecord:null,selectedUnresolvedRecord:this._isCRMRecord(this._selectedRecord)?null:this._selectedRecord};return e},e.prototype.destroy=function(){this._lastRecepientChangedNotificationId&&this._context.utils.clearGlobalNotification(this._lastRecepientChangedNotificationId),this._lastAvoidDuplicatesNotificationId&&this._context.utils.clearGlobalNotification(this._lastAvoidDuplicatesNotificationId),this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.SelectedRecipient,this._onSelectedRecipientChange),this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.ResolvedRecipients,this._onResolveRecipients)},e}();e.MailAppRecipientsTabControl=u}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var Common;!function(e){var t=function(){function e(){}return e.OFFICE_SAVE_ASYNC_ERROR=2148007937,e.OFFICE_SAVE_ASYNC_UNAVAILABLE=2148007938,e.OFFICE_EXCHANGE_CALL_ERROR=2148007939,e.OFFICE_ITEM_NOT_FOUND=2148007940,e.OFFICE_DELEGATE_REST_ERROR=2148007941,e.OFFICE_DELEGATE_ACCESS=2148007942,e.OFFICE_DELEGATE_SAVE_ASYNC=2148007943,e}();e.ExternalContextErrorCode=t}(Common||(Common={}));var Enums;!function(e){var t;!function(e){e[e.Allowed=1]="Allowed",e[e.ForbiddenOccurence=2]="ForbiddenOccurence",e[e.ForbiddenMeetingInviteRequest=3]="ForbiddenMeetingInviteRequest",e[e.ForbiddenMeetingInviteResponse=4]="ForbiddenMeetingInviteResponse",e[e.ForbiddenForOrganizerResolvedAsUser=5]="ForbiddenForOrganizerResolvedAsUser",e[e.ForbiddenInLimitedMode=6]="ForbiddenInLimitedMode",e[e.ForbiddenException=7]="ForbiddenException"}(t=e.TrackAllowedStatus||(e.TrackAllowedStatus={}))}(Enums||(Enums={}));var Models;!function(e){var t=function(){function e(e,t,n){if(this.MetadataType=null,this.MetadataSubtype=null,this.EntityLogicalName=null,this.MetadataId=null,this.MetadataName=null,this.GetDefault=!0,this.DependencyDepth=2,this.ChangedAfter=null,this.Exclude=[],this.AppId=null,!e||!t)throw new Error("Can't construct metadata query");this.MetadataType=e,this.MetadataSubtype=t,this.EntityLogicalName=n}return e.prototype.getMetadata=function(){return{boundParameter:null,parameterTypes:{MetadataType:{typeName:"Edm.String",structuralProperty:1},MetadataSubtype:{typeName:"Edm.String",structuralProperty:1},EntityLogicalName:{typeName:"Edm.String",structuralProperty:1},MetadataId:{typeName:"Edm.Guid",structuralProperty:1},MetadataName:{typeName:"Edm.String",structuralProperty:1},GetDefault:{typeName:"Edm.Boolean",structuralProperty:1},DependencyDepth:{typeName:"Microsoft.Dynamics.CRM.DependencyDepth",structuralProperty:3,enumProperties:[{name:"Unknown",value:0},{name:"OnDemandWithContext",value:1},{name:"OnDemandWithoutContext",value:2},{name:"OnDemandContextOnly",value:3},{name:"Offline",value:4},{name:"Mobile",value:5}]},ChangedAfter:{typeName:"Edm.String",structuralProperty:1},Exclude:{typeName:"Edm.Guid",structuralProperty:4},AppId:{typeName:"Edm.Guid",structuralProperty:1}},operationName:null,operationType:null}},e}();e.MetadataQuery=t;var n=function(){function e(e,n,r){this.ClientMetadataQuery=new t(e,n,r)}return e.prototype.getMetadata=function(){return{boundParameter:null,parameterTypes:{ClientMetadataQuery:{typeName:"Microsoft.Dynamics.CRM.MetadataQuery",structuralProperty:2}},operationName:"GetClientMetadata",operationType:1}},e}();e.GetClientMetadataRequest=n}(Models||(Models={}));var Models;!function(e){var t=function(){function e(e){this.columns=["LogicalName"],this.filter="$filter="+e}return e.prototype.getMetadata=function(){return{boundParameter:void 0,parameterTypes:void 0,operationType:2,operationName:"EntityDefinitions"}},e}();e.GetEntityDefinition=t}(Models||(Models={}));var Models;!function(e){var t=function(e){function t(t,n){return e.call(this,"LogicalName eq '"+t+"'&$expand=Attributes($filter="+n+")")||this}return __extends(t,e),t}(e.GetEntityDefinition);e.GetEntityAttributeRequest=t}(Models||(Models={}));var Models;!function(e){var t=function(e){function t(t){return e.call(this,"ObjectTypeCode eq "+t)||this}return __extends(t,e),t}(e.GetEntityDefinition);e.GetEntityNameRequest=t}(Models||(Models={}));var Retrievers;!function(e){var t=function(){function e(e,t){this._utils=t,this._executeFunction=e}return e.prototype._execute=function(e,t,n){this._executeFunction(e).then(function(e){e.json().then(function(e){if(e&&e.Metadata)try{var r=JSON.parse(e.Metadata);t(r)}catch(i){n(i)}else n(new Error("odataResponse.Metadata is empty"))},n)},n)},e.prototype.requestEntitiesMetadata=function(e,t,n){var r={};e.forEach(function(e){r[e]=[]}),this._execute(new Models.GetClientMetadataRequest("entity",JSON.stringify(r).replace(/\"/g,'\\"'),null),t,n)},e.prototype.requestDefaultFormMetadata=function(e,t,n,r){this._execute(new Models.GetClientMetadataRequest("form",t,e),n,r)},e.prototype.requestEntityNameFromTypeCode=function(e){return this._executeFunction(new Models.GetEntityNameRequest(e)).then(function(e){return e.json().then(function(e){if(e&&e.value&&e.value[0]&&e.value[0].LogicalName)return e.value[0].LogicalName;throw new Error("Unable to determine entity name from type code")})})},e.prototype.requestRegardingTargets=function(){var e="regardingobjectid",t="activitypointer",n=this._utils.isFeatureEnabled("MailAppAttributeTargets");return n?this._getEntityAttributeTargets(t,e):this._requestTargets(t,e)},e.prototype._getEntityAttributeTargets=function(e,t){return this._utils.getEntityMetadata(e,[t]).then(function(e){return e.Attributes.getByName(t).Targets})["catch"](function(){throw new Error("Unable to get activitypointer regarding object targets")})},e.prototype._requestTargets=function(e,t){var n="LogicalName eq '"+t+"'",r=new Models.GetEntityAttributeRequest(e,n);return this._executeFunction(r).then(function(e){return e.json()}).then(function(e){if(e&&e.value&&e.value[0]&&e.value[0].Attributes&&e.value[0].Attributes[0]&&e.value[0].Attributes[0].Targets)return e.value[0].Attributes[0].Targets;throw new Error("Unable to get activitypointer regarding object targets")})},e}();e.MetadataRequestor=t}(Retrievers||(Retrievers={}));var Retrievers;!function(e){var t=function(){function e(e){this._mapping={1:"account",2:"contact",3:"opportunity",4:"lead",8:"systemuser",112:"incident"},this._metadataRequestor=e,this._listeners=[],this._errorListeners=[]}return e.prototype.onChanged=function(e){this._listeners.push(e)},e.prototype.onFailed=function(e){this._errorListeners.push(e)},e.prototype.getMapping=function(){return this._mapping},e.prototype.getEntityName=function(e){var t=this;return this._mapping[e]?this._mapping[e]:(this._metadataRequestor.requestEntityNameFromTypeCode(e).then(function(n){t._mapping[e]=n,t._notify()},function(e){t._notifyError(e)}),null)},e.prototype._notify=function(){var e=this;this._listeners.forEach(function(t){t(e._mapping)})},e.prototype._notifyError=function(e){this._errorListeners.forEach(function(t){t(e)})},e}();e.ObjectTypeCodeToLogicalNameMappingRetriever=t}(Retrievers||(Retrievers={}));var Telemetry;!function(e){var t;!function(e){e[e.Log=0]="Log",e[e.Info=1]="Info",e[e.Verbose=2]="Verbose",e[e.Warning=3]="Warning",e[e.Error=4]="Error"}(t=e.EventLevel||(e.EventLevel={}))}(Telemetry||(Telemetry={}));var Retrievers;!function(e){var t,n="MailApp.Control.TrackBar.TrackStatusRetriever";!function(e){e[e.Success=0]="Success",e[e.SaveAsyncError=1]="SaveAsyncError",e[e.SaveAsyncUnavailable=2]="SaveAsyncUnavailable",e[e.ExchangeCallError=3]="ExchangeCallError",e[e.EwsErrorResponseCode=4]="EwsErrorResponseCode",e[e.RestErrorDelegateAccess=5]="RestErrorDelegateAccess",e[e.ErrorDelegateAccessMissingWritePermission=6]="ErrorDelegateAccessMissingWritePermission",e[e.ErrorDelegateAccessSaveAsync=7]="ErrorDelegateAccessSaveAsync"}(t=e.RetrieveState||(e.RetrieveState={}));var r=function(){function t(t){var r=this;this._trackStatus=null,this._trackAllowedStatus=null,this._typeNamesWithRegarding=[],this.onChanged=function(e){r._listeners.push(e)},this.onFailed=function(e){r._errorListeners.push(e)},this._notify=function(){r._listeners.forEach(function(e){e(r._trackStatus,r._trackAllowedStatus)})},this._notifyError=function(e){var t=[{name:"Error",value:JSON.stringify(e)}];r._context.reporting.reportFailure(n,new Error(e.message),null,t),r._errorListeners.forEach(function(t){t(e)})},this._onTrackStatusChange=function(e){var t=e&&e.value?e.value:null,n=r._setTrackStatus(t);n&&r._notify()},this._onTrackAllowedStatusChange=function(e){var t=e?e.value:null,n=r._setTrackAllowedStatus(t);n&&r._notify()},this._context=t,this._metadataRequestor=new e.MetadataRequestor(t.webAPI.execute.bind(t.webAPI),this._context.utils),this._listeners=[],this._errorListeners=[],this._mappingRetriever=new e.ObjectTypeCodeToLogicalNameMappingRetriever(this._metadataRequestor),this._mappingRetriever.onChanged(this._notify),this._mappingRetriever.onFailed(this._notifyError)}return Object.defineProperty(t.prototype,"hasRegardingObject",{get:function(){return this._trackStatus&&this._trackStatus.crmRegardingObjectId&&-1===this._trackStatus.crmRegardingObjectId.indexOf(Common.Guid.EMPTY.toString())&&this._trackStatus.crmRegardingObjectType&&(this._trackStatus.crmTrackingState===Models.TrackingState.IsLinked||this._trackStatus.crmTrackingState===Models.TrackingState.WillBeLinked||this._trackStatus.crmTrackingState===Models.TrackingState.LinkFailed);
},enumerable:!0,configurable:!0}),t.prototype.init=function(){this._retrieveTrackStatus()},t.prototype.getTypeNamesWithRegarding=function(){return this._typeNamesWithRegarding||[]},t.prototype.getTrackStatus=function(){return this._trackStatus},t.prototype.isTrackAllowed=function(){return this._trackAllowedStatus===Enums.TrackAllowedStatus.Allowed},t.prototype.trackAllowedStatus=function(){return this._trackAllowedStatus},t.prototype.isTrackPending=function(){return this._trackStatus&&this._trackStatus.crmTrackingState===Models.TrackingState.WillBeLinked},t.prototype.isUntrackPending=function(){return this._trackStatus&&this._trackStatus.crmTrackingState===Models.TrackingState.WillBeUnlinked},t.prototype.getRegardingObject=function(){return this.hasRegardingObject&&this._mappingRetriever.getEntityName(this._trackStatus.crmRegardingObjectType)?new Models.BaseDataSetRecord({Id:this._trackStatus.crmRegardingObjectId||"",LogicalName:this._mappingRetriever.getEntityName(this._trackStatus.crmRegardingObjectType),Name:this._trackStatus.crmRegardingObjectName}):null},t.prototype.destroy=function(){this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.TrackStatus,this._onTrackStatusChange),this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.TrackAllowedStatus,this._onTrackAllowedStatusChange),this._listeners=[]},t.prototype._retrieveTrackStatus=function(){var e=this;Promise.all([this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackStatus,{updateListener:this._onTrackStatusChange}),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackAllowedStatus,{updateListener:this._onTrackAllowedStatusChange}),this._metadataRequestor.requestRegardingTargets()]).then(function(t){var r=t[0],i=t[1],o=t[2],a=e._setTrackStatus(r),s=e._setTrackAllowedStatus(i),c=e._setTypeNamesWithRegarding(o),l={isTrackStatusEmpty:!r,trackAllowed:i,typeNamesWithRegarding:o},d={eventName:"uci_trace",eventParameters:[{name:"Data",value:JSON.stringify(l)},{name:"Message",value:"Retrieved track status"},{name:"ComponentName",value:n},{name:"ApplicationEventLevel",value:Telemetry.EventLevel.Info}]};e._context.reporting.reportEvent(d),(a||s||c)&&e._notify()},this._notifyError)},t.prototype._setTrackStatus=function(e){void 0===e&&(e=null);var t=e&&this._trackStatus?e.crmTrackingState===this._trackStatus.crmTrackingState&&e.crmRegardingObjectId===this._trackStatus.crmRegardingObjectId&&e.crmRegardingObjectType===this._trackStatus.crmRegardingObjectType:e===this._trackStatus;return this._trackStatus=e,!t},t.prototype._setTrackAllowedStatus=function(e){void 0===e&&(e=null);var t=this._trackAllowedStatus!==e;return this._trackAllowedStatus=e,t},t.prototype._setTypeNamesWithRegarding=function(e){return!this._compareArrays(this._typeNamesWithRegarding,e)&&(this._typeNamesWithRegarding=e,!0)},t.prototype._compareArrays=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;var n=e.reduce(function(e,t){var n=e.indexOf(t);return-1!==n&&e.splice(n,1),e},t.concat());return 0===n.length},t}();e.TrackStatusRetriever=r}(Retrievers||(Retrievers={}));var MscrmControls;!function(e){var t;!function(e){var t="LimitedModeNotification",n={NotificationMessage:"LimitedMode_NotificationMessage"},r={Text:"#1F2126",Background:"#FFF4CE",Border:"#efefef"},i=function(){function e(e,t){this._context=e,this._props=t}return e.prototype.render=function(e){var i=this._context.resources.getString(n.NotificationMessage),o={paddingTop:"4px"},a=this._getIconComponent(179,o,null),s={cursor:"pointer",padding:"4px",fontWeight:"bold",fontSize:this._context.theming.fontsizes.font100},c=this._getIconComponent(97,s,this._props.onClose),l=this._getLinkComponent(i);return this._context.factory.createElement("CONTAINER",{key:t,id:t,style:{backgroundColor:r.Background,display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:"space-between",padding:"3px 5px",boxSizing:"border-box",borderBottom:"1px solid "+r.Border}},[a,l,c])},e.prototype._getIconComponent=function(e,n,r){return this._context.factory.createElement("MICROSOFTICON",{id:t+"_Icon"+e,key:t+"_Icon"+e,type:e,style:Object.assign({fontSize:this._context.theming.fontsizes.font125},n),onClick:r})},e.prototype._getLinkComponent=function(e){var n,i=this._context.client.isRTL;return this._context.factory.createElement("HYPERLINK",{id:t+"_Link",key:t+"_Link",href:this._props.helpLink,target:"_blank",accessibilityLabel:e,tabIndex:-1,style:(n={color:r.Text},n["padding"+(i?"Right":"Left")]="4px",n.fontFamily=this._context.theming.fontfamilies.regular,n.fontSize=this._context.theming.measures.measure075,n.lineHeight="18px",n.textDecoration="none",n[":hover"]={textDecoration:"underline"},n)},e)},e}();e.LimitedModeNotification=i}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(e){var t;!function(e){var t="MailApp.Control.TrackBar",n="MailApp.TrackRegarding.Button",r=["MailApp.TrackEmailWithoutRegarding.Button","MailApp.TrackAppointmentWithoutRegarding.Button","MailApp.UntrackEmail.Button","MailApp.UntrackAppointment.Button","MailApp.ViewEmailActivity.Button","MailApp.ViewAppointmentActivity.Button","MailApp.OpenRecordOnWeb.Button"],i=function(){function i(){var e=this;this._trackBarCommands=[],this._showTrackNotAllowedToastNotification=function(){e._lastTrackForbiddenNotificationId&&e._context.utils.clearGlobalNotification(e._lastTrackForbiddenNotificationId);var t=e._getTrackForbiddenMessage();e._context.utils.addGlobalNotification(1,3,t,"",null,null).then(function(t){e._lastTrackForbiddenNotificationId=t})},this._onTrackStatusRetrieverError=function(t){var n=t.errorCode||t.code;switch(n){case Retrievers.RetrieveState.RestErrorDelegateAccess:case Common.ExternalContextErrorCode.OFFICE_DELEGATE_REST_ERROR:e._openErrorDialog({message:e._context.resources.getString("MailAppTrackBarControl_DelegateAccess_RestFailure"),errorCode:n});break;case Retrievers.RetrieveState.ErrorDelegateAccessMissingWritePermission:case Common.ExternalContextErrorCode.OFFICE_DELEGATE_ACCESS:e._openErrorDialog({message:e._context.resources.getString("MailAppTrackBarControl_DelegateAccess_MissingWritePermission"),errorCode:n});break;case Retrievers.RetrieveState.ErrorDelegateAccessSaveAsync:case Common.ExternalContextErrorCode.OFFICE_DELEGATE_SAVE_ASYNC:e._openErrorDialog({message:e._context.resources.getString("MailAppTrackBarControl_DelegateAccess_SaveAsyncFailure"),errorCode:n});break;case Retrievers.RetrieveState.EwsErrorResponseCode:case Retrievers.RetrieveState.SaveAsyncUnavailable:case Retrievers.RetrieveState.SaveAsyncError:case Common.ExternalContextErrorCode.OFFICE_ITEM_NOT_FOUND:case Common.ExternalContextErrorCode.OFFICE_SAVE_ASYNC_ERROR:case Common.ExternalContextErrorCode.OFFICE_SAVE_ASYNC_UNAVAILABLE:var r=e._itemType===Constants.MailboxItemTypes.Appointment?"MailAppTrackBarControl_Track_Appointment_Failure_Short":"MailAppTrackBarControl_Track_Email_EWS_Failure_Short",i=e._context.resources.getString(r);e._context.utils.addGlobalNotification(1,2,i,"",null,null);break;case Retrievers.RetrieveState.ExchangeCallError:case Common.ExternalContextErrorCode.OFFICE_EXCHANGE_CALL_ERROR:default:null===n||void 0===n?e._openErrorDialog(t):e._context.utils.addGlobalNotification(1,2,e._context.resources.getString("MailAppTrackBarControl_Retrieve_EWS_Failure_Short"),"",null,null)}},this._onItemChanged=function(){e._context.utils.clearGlobalNotifications&&e._context.utils.clearGlobalNotifications()}}return Object.defineProperty(i.prototype,"_isExternalContextAvailable",{get:function(){var e=this._context?this._context.externalContext&&this._context.externalContext.getAvailableExternalContexts():null;return e&&e.getByName(Constants.contextId)},enumerable:!0,configurable:!0}),i.prototype.init=function(t,n,r){var i=this;this._context=t,this._isExternalContextAvailable&&(this._notifyOutputChanged=n,this._context=t,this._trackStatusRetriever=new Retrievers.TrackStatusRetriever(this._context),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.ItemType).then(function(e){i._itemType=e,i._subscribeToTrackStatusChange()},function(e){i._openErrorDialog(e)}),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.MailboxItem,{updateListener:this._onItemChanged}),Promise.all([this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.IsLimitedMode),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.LimitedModeNotificationState)]).then(function(n){var r=n[0],o=n[1],a=o.helpLink,s=o.hasBeenClosed;i._isLimitedMode=r,r&&!s&&(i._notificationComponent=new e.LimitedModeNotification(t,{onClose:function(e){i._context.externalContext.invokeExternalContextAction(Constants.contextId,Constants.ActionIds.SetLimitedModeNotificationStateAction),i._notificationComponent=null,i._context.utils.requestRender()},helpLink:a})),i._context.utils.requestRender()}))},i.prototype._subscribeToTrackStatusChange=function(){var e,t=this;this._trackStatusRetriever.onChanged(function(n,r){var i=null!==n&&null!==r;i&&r!==Enums.TrackAllowedStatus.ForbiddenInLimitedMode&&!t._trackStatusRetriever.isTrackAllowed()&&t._showTrackNotAllowedToastNotification();var o=t._trackStatusRetriever.getRegardingObject(),a=o&&o.getRecordId();e!==a&&(e=a,t._notifyOutputChanged()),t._context.utils.requestRender()}),this._trackStatusRetriever.onFailed(this._onTrackStatusRetrieverError),this._trackStatusRetriever.init()},i.prototype._getTrackForbiddenMessage=function(){var e;switch(this._trackStatusRetriever.trackAllowedStatus()){case Enums.TrackAllowedStatus.ForbiddenOccurence:e=this._context.resources.getString("MailAppTrackBarControl_Track_Forbidden_Occurence");break;case Enums.TrackAllowedStatus.ForbiddenException:e=this._context.resources.getString("MailAppTrackBarControl_Track_Forbidden_Exception");break;case Enums.TrackAllowedStatus.ForbiddenMeetingInviteRequest:e=this._context.resources.getString("MailAppTrackBarControl_Track_Forbidden_Meeting_Request");break;case Enums.TrackAllowedStatus.ForbiddenMeetingInviteResponse:e=this._context.resources.getString("MailAppTrackBarControl_Track_Forbidden_Meeting_Response");break;case Enums.TrackAllowedStatus.ForbiddenForOrganizerResolvedAsUser:e=this._context.resources.getString("MailAppTrackBarControl_Track_Forbidden_Organizer_As_User")}return e},i.prototype.updateView=function(e){if(this._context=e,!this._isExternalContextAvailable)return void this._reportEvent("Track Status and Set Regarding forms are hidden",{isExternalContextAvailable:!1});var t=this._trackStatusRetriever.getTrackStatus(),n=this._trackStatusRetriever.trackAllowedStatus(),r=this._trackStatusRetriever.getTypeNamesWithRegarding(),i=[];return t&&void 0!==n&&r&&this._itemType?i.push(this._renderTrackStatus(n,t),this._renderSetRegardingForm()):this._reportEvent("Track Status and Set Regarding forms are hidden",{isTrackStatusEmpty:!t,trackAllowedStatus:n,typeNamesWithRegarding:r,itemType:this._itemType}),this._notificationComponent&&i.unshift(this._notificationComponent.render(e)),this._render(i)},i.prototype._render=function(e){return void 0===e&&(e=[]),this._context.factory.createElement("CONTAINER",{id:"MailAppTrackBarContainer",key:"MailAppTrackBarContainer",style:{display:"block",width:"100%"}},e)},i.prototype._getStatusRenderDetails=function(e){switch(e){case Models.TrackingState.IsLinked:return this._trackStatusRetriever.hasRegardingObject?this._getRenderDetailsTrackedRegarding():this._getRenderDetailsTracked();case Models.TrackingState.WillBeLinked:return this._getRenderDetailsTrackPending();case Models.TrackingState.LinkFailed:return this._getRenderDetailsTrackFailed();case Models.TrackingState.InProgress:return this._getRenderDetailsTrackInProgress();default:return this._getRenderDetailsUntracked()}},i.prototype._getRenderDetailsUntracked=function(){var e=this._context.resources.getString("MailAppTrackBarControl_UntrackedStatus");return{text:e,tooltip:e,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#cde6f7",commandingHoverColor:"#9dc3e6"}},i.prototype._getRenderDetailsTracked=function(){var e=this._context.resources.getString("MailAppTrackBarControl_TrackedStatus");return{text:e,tooltip:e,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#e4f9d4",commandingHoverColor:"#c5e0b4"}},i.prototype._getRenderDetailsTrackedRegarding=function(){var e=this._context.resources.getString("MailAppTrackBarControl_TrackedRegardingStatus");return{text:e,tooltip:e,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#e4f9d4",commandingHoverColor:"#c5e0b4"}},i.prototype._getRenderDetailsTrackPending=function(){var e=this._context.resources.getString("MailAppTrackBarControl_TrackedPendingStatus_Tooltip"),t=this._format(e,this._getItemTypeLocalizedName());return{text:this._context.resources.getString("MailAppTrackBarControl_TrackedPendingStatus"),tooltip:t,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#cde6f7",commandingHoverColor:"#9dc3e6",live:!0}},i.prototype._getRenderDetailsTrackFailed=function(){var e=this._context.resources.getString("MailAppTrackBarControl_TrackFailedStatus_Tooltip"),t=this._format(e,this._getItemTypeLocalizedName());return{text:this._context.resources.getString("MailAppTrackBarControl_TrackFailedStatus"),tooltip:t,textColor:this._context.theming.colors.basecolor.red.red4,backgroundColor:"#efefef",commandingHoverColor:"#d8d8d8"}},i.prototype._getSeeWhyDetails=function(){var e=this._context.resources.getString("MailAppTrackBarControl_SeeWhy_Tooltip"),t=this._format(e,this._getItemTypeLocalizedName());return{text:this._context.resources.getString("MailAppTrackBarControl_SeeWhy"),tooltip:t}},i.prototype._getRenderDetailsTrackInProgress=function(){var e=this._context.resources.getString("MailAppTrackBarControl_InProgressStatus");return{text:e,tooltip:e,textColor:this._context.theming.colors.basecolor.black,backgroundColor:"#fff4a8",commandingHoverColor:"#a2993e",live:!0}},i.prototype._getItemTypeLocalizedName=function(){return this._context.resources.getString(this._itemType===Constants.MailboxItemTypes.Message?"MailAppTrackBarControl_ItemType_Message":"MailAppTrackBarControl_ItemType_Appointment")},i.prototype._renderTrackStatus=function(e,t){var n=t.crmTrackingState;return e===Enums.TrackAllowedStatus.ForbiddenInLimitedMode&&n!==Models.TrackingState.IsLinked?(this._reportEvent("Track Status is hidden",{trackAllowedStatus:e,crmTrackingState:n}),null):(this._statusRenderDetails=this._getStatusRenderDetails(n),this._context.factory.createElement("CONTAINER",{id:"StatusLabelContainer",key:"StatusLabelContainer",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",backgroundColor:this._statusRenderDetails.backgroundColor}},[this._renderStatusLabel(),this._renderSeeWhyLink(),this._renderCommandBar()]))},i.prototype._renderSeeWhyLink=function(){var e=this,t=this._context.utils.isFeatureEnabled(Constants.FeatureNames.MailAppDisplayAppCheckerNavigationLink),n=this._context.utils.isFeatureEnabled(Constants.FeatureNames.MailAppDisableMailAppChecker);if(!t||n)return null;var r=this._trackStatusRetriever.getTrackStatus().crmTrackingState===Models.TrackingState.LinkFailed;if(r){var i=this._getSeeWhyDetails();return this._context.factory.createElement("Hyperlink",{key:"SeeWhyLink",id:"SeeWhyLink",style:{display:"block",flex:"1 1 auto",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",height:"48px",lineHeight:"48px",textAlign:this._context.client.isRTL?"left":"right",fontFamily:this._context.theming.fontfamilies.regular,color:this._context.theming.colors.basecolor.blue.blue3,fontSize:this._context.theming.fontsizes.font100,textDecoration:"none"},title:i.tooltip,onClick:function(){e._context.externalContext.invokeExternalContextAction(Constants.contextId,Constants.ActionIds.OpenAppChecker,{args:{openDiagnosticsPage:!0}})}},[i.text])}return null},i.prototype._renderStatusLabel=function(){return this._context.factory.createElement("LABEL",{key:"StatusLabel",id:"StatusLabel",role:this._statusRenderDetails.live?"status":void 0,accessibilityLive:this._statusRenderDetails.live?"polite":"off",style:{display:"block",flex:"1 1 auto",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",height:"48px",lineHeight:"48px",paddingLeft:this._context.client.isRTL?0:this._context.theming.measures.measure100,paddingRight:this._context.client.isRTL?this._context.theming.measures.measure100:0,color:this._statusRenderDetails.textColor,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular},title:this._statusRenderDetails.tooltip},[this._statusRenderDetails.text])},i.prototype._renderCommandBar=function(){return this._trackStatusRetriever.getTrackStatus().crmTrackingState===Models.TrackingState.InProgress?null:this._context.factory.createElement("COMMANDBAR",{key:"TrackBarControlCommandBar",iconPosition:1,mainMenuLength:1,ribbonId:null,selectedRecords:[],addedCommandList:this._getAddedTrackBarCommands(),customCommandManagerStyle:{margin:"0px",border:"0px none"},commandBarStyle:{container:{margin:"0px",border:"0px none"},list:{margin:"0px"},listItem:{marginLeft:this._context.client.isRTL?0:this._context.theming.measures.measure050,marginRight:this._context.client.isRTL?this._context.theming.measures.measure050:0},listItemBody:{text:{display:"block",overflow:"hidden"},iconWrapperStyles:{margin:"0px"}},overflowFlyoutMoreButton:{fontSize:"16px",height:"48px",lineHeight:"48px",padding:"0px",textAlign:"center",border:"0px none",background:"transparent",display:"block",overflow:"hidden",cursor:"pointer",":hover":{backgroundColor:this._statusRenderDetails.commandingHoverColor}}}})},i.prototype._getAddedTrackBarCommands=function(){var e=this;this._context.utils.retrieveRecordCommand({},Constants.GlobalCommandManagerId,[],r).then(function(t){void 0===t&&(t=[]);var n=t.filter(function(e){return e.canExecute}).map(function(e){return{Icon:e.icon,DisplayText:e.label,Tooltip:{title:e.tooltip},Id:e.commandId,execute:e.execute}});e._isTrackCommandsChanged(n)&&(e._trackBarCommands=n,e._context.utils.requestRender())});var t=this._trackBarCommands.slice();return!this._isUntracked()&&this._trackStatusRetriever.isTrackAllowed()&&t.unshift(this._getSetRegardingCommand()),this._trackStatusRetriever.getTrackStatus().crmTrackingState===Models.TrackingState.LinkFailed&&void 0!==this._isLimitedMode&&(this._isLimitedMode?t.unshift(this._getRetryTrackCommand(function(){var t=e._trackStatusRetriever.getRegardingObject(),n=t?t.getNamedReference():null,r=n?{id:t.getRecordId(),name:n.Name,entityType:n.LogicalName}:null;e._trackRegarding(r)})):t.unshift(this._getRetryTrackCommand())),t},i.prototype._isTrackCommandsChanged=function(e){void 0===e&&(e=[]);var t=e.map(function(e){return e.Id}).sort(),n=this._trackBarCommands.map(function(e){return e.Id}).sort();return t.length!==n.length||t.some(function(e,t){return e!==n[t]})},i.prototype._getSetRegardingCommand=function(){var e=this._trackStatusRetriever.hasRegardingObject?"MailAppTrackBarControl_ChangeRegardingButtonLabel":"MailAppTrackBarControl_SetRegardingButtonLabel",t=this._context.resources.getString(e);return{Icon:"LinkArticle",DisplayText:t,Tooltip:{title:t},Id:"MailApp.Track",execute:this._showTrackRegardingForm.bind(this)}},i.prototype._getRetryTrackCommand=function(e){var t=this;void 0===e&&(e=function(){var e={trackingState:Models.TrackingState.WillBeLinked};t._context.externalContext.invokeExternalContextAction(Constants.contextId,Constants.ActionIds.RetryTrack,{args:e})});var n=this._context.resources.getString("Retry_Track");return{Icon:"Refresh",DisplayText:n,Tooltip:{title:n},Id:"MailApp.RetryTrack",execute:e}},i.prototype._renderSetRegardingForm=function(){if(!this._isTrackRegardingFormVisible())return null;var e=this._context.resources.getString("MailAppTrackBarControl_SetRegardingLabel"),t=this._context.factory.createElement("LABEL",{key:"SetRegardingLabel",id:"SetRegardingLabel",style:{display:"block",whiteSpace:"nowrap",color:this._context.theming.colors.basecolor.grey.grey7,fontSize:this._context.theming.fontsizes.font100,overflow:"hidden",textOverflow:"elipsis",fontFamily:this._context.theming.fontfamilies.regular,marginBottom:this._context.theming.measures.measure025},title:e},[e]);return this._context.factory.createElement("CONTAINER",{id:"SetRegardingForm",key:"SetRegardingForm",style:{display:"flex",flexDirection:"column",marginTop:this._context.theming.measures.measure100,marginLeft:this._context.theming.measures.measure100,marginRight:this._isCloseSetRegardingFormButtonVisible()?"0px":this._context.theming.measures.measure100}},[t,this._renderSetRegardingLookup()])},i.prototype._renderSetRegardingLookup=function(){var e=this._trackStatusRetriever.getTypeNamesWithRegarding();if(0===e.length)return this._reportEvent("Set Regarding form is hidden",{typeNamesWithRegarding:e}),null;var t={descriptor:{Id:"MscrmControls.FieldControls.SimpleLookupControl",Label:this._context.resources.getString("MailAppTrackBarControl_SetRegardingLabel"),Name:"",ShowLabel:!0,Visible:!0,Disabled:!1},parameters:{value:{Type:"Lookup.Regarding",Usage:3,Static:!1,Callback:this._lookupValueChanged.bind(this),Value:[],Attributes:{LogicalName:"regardingobjectid",Targets:e,Format:"regarding",Type:"lookup"}},viewportSizeMode:{Usage:1,Static:!0,Type:"Whole.None",Value:1,Primary:!1},deviceSizeMode:{Usage:1,Static:!0,Type:"Whole.None",Value:1,Primary:!1}},key:"SetRegardingLookup"},n=this._context.factory.createComponent("MscrmControls.FieldControls.SimpleLookupControl","SetRegardingLookup",t);return this._context.factory.createElement("CONTAINER",{id:"SetRegardingForm",key:"SetRegardingForm",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginLeft:this._context.client.isRTL?0:this._context.theming.measures.measure050,marginRight:this._context.client.isRTL?this._context.theming.measures.measure050:0}},[n,this._renderCloseSetRegardingFormButton()])},i.prototype._isCloseSetRegardingFormButtonVisible=function(){return!this._isUntracked()},i.prototype._renderCloseSetRegardingFormButton=function(){var e=this;if(!this._isCloseSetRegardingFormButtonVisible())return null;var t=this._context.factory.createElement("MICROSOFTICON",{id:"CloseSetRegardingFormButtonIcon",key:"CloseSetRegardingFormButtonIcon",type:9}),n=this._context.resources.getString("MailAppTrackBarControl_CloseSetRegardingFormLabel");return this._context.factory.createElement("BUTTON",{id:"CloseSetRegardingFormButton",key:"CloseSetRegardingFormButton",title:n,accessibilityLabel:n,role:"button",tabIndex:0,onClick:function(){e._hideTrackRegardingForm()},style:{flex:"0 0 auto",backgroundColor:"transparent",borderStyle:"none",color:this._context.theming.colors.grays.gray07,paddingTop:this._context.theming.measures.measure075,paddingBottom:this._context.theming.measures.measure100,paddingLeft:this._context.theming.measures.measure050,paddingRight:this._context.theming.measures.measure100,fontSize:"16px",cursor:"pointer"}},[t])},i.prototype._showTrackRegardingForm=function(){this._isTrackRegardingFormActive=!0,this._context.utils.requestRender()},i.prototype._hideTrackRegardingForm=function(){this._isTrackRegardingFormActive=!1,this._context.utils.requestRender()},i.prototype._isTrackRegardingFormVisible=function(){var e=this._isUntracked(),t=this._trackStatusRetriever.isTrackAllowed(),n=(e||this._isTrackRegardingFormActive)&&t;return n||this._reportEvent("Set Regarding form is hidden",{isUntracked:e,isTrackAllowed:t,isTrackRegardingFormActive:this._isTrackRegardingFormActive}),n},i.prototype._isUntracked=function(){var e=this._trackStatusRetriever.getTrackStatus();return e.crmTrackingState===Models.TrackingState.NotLinked||e.crmTrackingState===Models.TrackingState.WillBeUnlinked||e.crmTrackingState===Models.TrackingState.WillBeUnlinkedAndDeleted},i.prototype._lookupValueChanged=function(e){var t=Array.isArray(e)?e[0]:e;t&&(this._trackRegarding(t),this._hideTrackRegardingForm())},i.prototype._trackRegarding=function(e){var t={};t[e.id]=this._getDataSetRecord(e),this._context.utils.retrieveRecordCommand(t,Constants.GlobalCommandManagerId,[e.id],[n]).then(function(e){var t=e&&e[0];t&&t.canExecute&&t.execute()})},i.prototype._getDataSetRecord=function(e){var t={};return t.getNamedReference=function(){return e},t},i.prototype._openErrorDialog=function(e){var t=e&&e.message?e.message:this._context.resources.getString("MailAppTrackBarControl_Retrieve_EWS_Failure_Short"),n=e.errorCode||e.code;this._context.navigation.openErrorDialog({message:t,errorCode:n,details:e&&e.stack?e.stack:"No stack available."})},i.prototype._reportEvent=function(e,n){var r={eventName:"uci_trace",eventParameters:[{name:"ApplicationEventLevel",value:Telemetry.EventLevel.Info},{name:"Message",value:e},{name:"ComponentName",value:t}]};n&&r.eventParameters.push({name:"Data",value:JSON.stringify(n)}),this._context.reporting.reportEvent(r)},i.prototype._format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\d+)}/g,function(e,n){return"undefined"!==typeof t[n]?t[n]:e})},i.prototype.getOutputs=function(){return{regardingObject:this._trackStatusRetriever.getRegardingObject()}},i.prototype.destroy=function(){this._lastTrackForbiddenNotificationId&&this._context.utils.clearGlobalNotification(this._lastTrackForbiddenNotificationId),this._trackStatusRetriever&&this._trackStatusRetriever.destroy(),this._context.externalContext.removeExternalContextPropertyListener(Constants.contextId,Constants.PropertyIds.MailboxItem,this._onItemChanged)},i}();e.MailAppTrackBarControl=i}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(e){var t;!function(e){}(t=e.Containers||(e.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(e){var t;!function(e){var t="quick",n="UNKNOW_FORM",r="DO_NOT_SHOW",i=function(){function e(){this._uniqueId=Common.Guid.newGuid()}return e.prototype.init=function(e,t,n){this._context=e},e.prototype._requestDefaultForm=function(e){var t=this,r=this._context.utils.getFormId;if(!r)return this._formId=n,void this._context.utils.requestRender();var i=r(this._currentEntityReference.LogicalName,"Quick");i.then(function(e){null!=e?t._formId=e:t._formId=n,t._context.utils.requestRender()},function(e){throw new Error("Corrupted _requestDefaultForm")})},e.prototype._isTypeChanged=function(e){return!this._currentEntityReference||null!==e&&this._currentEntityReference.LogicalName!==e.LogicalName},e.prototype._updateTypeLabel=function(){var e=this;this._typeRequestStamp=Date.now();var t=this._typeRequestStamp;this._entityMetadataRequest=this._context.utils.getEntityMetadata(this._context.parameters.data.raw.getNamedReference().LogicalName),this._entityMetadataRequest.then(function(n){t>=e._typeRequestStamp&&e._typeLabel!==n.DisplayName&&(e._typeLabel=n.DisplayName,e._formId&&e._context.utils.requestRender())})},e.prototype.updateView=function(e){var i=this;this._context=e;var o=this._context.parameters.data.raw&&this._context.parameters.data.raw.getNamedReference();if(o){var a=this._isTypeChanged(o);if(this._currentEntityReference=o,a&&(this._formId="",this._typeLabel="",this._entityMetadataRequest=null),this._typeLabel||this._entityMetadataRequest||this._updateTypeLabel(),!this._formId){if(this._context.parameters.predefinedForms&&this._context.parameters.predefinedForms.raw){var s=this._context.parameters.predefinedForms.raw.split(","),c={};s.forEach(function(e){e&&(c[e.split("#")[0]]=e.split("#")[1])}),c.hasOwnProperty(this._currentEntityReference.LogicalName)&&(this._formId=c[this._currentEntityReference.LogicalName])}this._formId||this._requestDefaultForm(t)}}else this._currentEntityReference=null;if(!this._formId||!this._currentEntityReference||this._formId===r)return this._context.factory.createElement("LABEL",{key:"label",style:{display:"none"}},"");if(this._formId===n){var l={eventName:"uci_trace",eventParameters:[{name:"Data",value:JSON.stringify(o)},{name:"ApplicationEventLevel",value:Telemetry.EventLevel.Warning},{name:"Message",value:"Form Id is unknown"},{name:"ComponentName",value:"MailApp.Control.QuickFormWrapper"}]};return this._context.reporting.reportEvent(l),this._context.factory.createElement("LABEL",{key:"label"},this._context.resources.getString("QuickFormWrapper_Have_No_Deafult_Form"))}var d={Usage:0,Type:"Form.QuickForm",Value:this._formId+":Quick|"+this._currentEntityReference.LogicalName+"|"+this._currentEntityReference.Id,Static:!1,Primary:!0},u=this._context.parameters.formType&&this._context.parameters.formType.raw?this._context.parameters.formType.raw:"QuickFormCardControl",p=this._typeLabel?this._typeLabel:"";if(this._context.parameters.label&&this._context.parameters.label.raw){p=this._context.parameters.label.raw;var m=p.match(/\$.+?\$/g);m&&m.length>0&&(m.forEach(function(e){p=p.replace(""+e,i._context.resources.getString(e.substring(1,e.length-1)))}),p=p.replace("{TypeName}",this._typeLabel))}var h={descriptor:{Id:"MscrmControls.Containers."+u,Label:"",Name:"",ShowLabel:!1,Visible:!0,Disabled:!1,Parameters:{QuickForms:{Usage:0,Type:"Form.QuickForm",Value:'&lt;QuickFormIds&gt;&lt;QuickFormId entityname="'+this._currentEntityReference.LogicalName+'"&gt;'+this._formId+"&lt;/QuickFormId&gt;&lt;/QuickFormIds&gt;",Static:!1,Primary:!0}}},controlstates:{hasFocus:this._context.mode.hasFocus,isControlDisabled:this._context.mode.isControlDisabled,label:p},parameters:{value:d,hideImage:{Usage:1,Type:"Whole.None",Value:this._context.parameters.hideImage&&this._context.parameters.hideImage.raw,Static:!0,Primary:!0}}};return this._context.factory.createComponent("MscrmControls.Containers."+u,u+"#"+this._currentEntityReference.LogicalName+"#"+this._currentEntityReference.Id+"#"+this._uniqueId,h)},e.prototype.getOutputs=function(){return null},e.prototype.destroy=function(){},e}();e.QuickFormWrapper=i}(t=e.Containers||(e.Containers={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.init=function(e,t,n){this._context=e,this._icons={InProgress:{iconId:248,iconColor:this._context.theming.colors.grays.gray07},Success:{iconId:182,iconColor:this._context.theming.colors.basecolor.green.green4},Failure:{iconId:181,iconColor:this._context.theming.colors.basecolor.red.red4}}},e.prototype.updateView=function(e){return this._context=e,this._context.factory.createElement("CONTAINER",{id:"StatusLabelContainer",key:"StatusLabelContainer",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",width:"100%"}},[this._renderText(),this._renderIcon()])},e.prototype._renderText=function(){var e=this._context.mode._customControlProperties.descriptor.Label;return this._context.factory.createElement("LABEL",{key:"StatusText",id:"StatusText",style:{textDecoration:"none",display:"block",flex:"1 1 auto",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this._context.theming.colors.basecolor.grey.grey5,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular},tabIndex:0,title:e},[e])},e.prototype._renderIcon=function(){var e=this._context.parameters.StatusIcon&&this._context.parameters.StatusIcon.raw;return e&&this._icons[e]?this._context.factory.createElement("MICROSOFTICON",{id:"StatusIcon",key:"StatusIcon",type:this._icons[e].iconId,style:{display:"block",color:this._icons[e].iconColor,paddingLeft:this._context.theming.measures.measure200,fontSize:"16px"}}):null},e.prototype.getOutputs=function(){return null},e.prototype.destroy=function(){},
e}();e.StatusLabelControl=t}(t=e.StatusLabel||(e.StatusLabel={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.init=function(e,t,n){this._context=e},e.prototype.updateView=function(e){return this._context=e,this._createUnboundLink()},e.prototype._createUnboundLink=function(){var e=this._context.mode._customControlProperties.descriptor.Label,t=this._context.parameters.LinkUrl.raw;return this._context.factory.createElement("HYPERLINK",{id:"unboundLink",key:"unboundLink",href:t,target:"_blank",accessibilityLabel:e,tabIndex:-1,style:{color:this._context.theming.colors.basecolor.blue.blue3,fontSize:this._context.theming.fontsizes.font100,textDecoration:"none"}},e)},e.prototype.getOutputs=function(){return null},e.prototype.destroy=function(){},e}();e.UnboundHyperlinkControl=t}(t=e.UnboundHyperlinkControl||(e.UnboundHyperlinkControl={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.init=function(e){this._context=e},e.prototype.getLabelStyle=function(){return{display:"block",overflow:"hidden",textOverflow:"ellipsis",fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.semibold}},e.prototype.getHeaderStyle=function(){return Object.assign(this.getLabelStyle(),{fontFamily:this._context.theming.fontfamilies.regular})},e.prototype.getLinkStyle=function(){return Object.assign(this.getLabelStyle(),{color:this._context.theming.colors.basecolor.blue.blue3,textDecoration:"none",whiteSpace:"nowrap"})},e.prototype.getLinkButtonStyle=function(){return{backgroundColor:"transparent",borderStyle:"none",color:this._context.theming.colors.grays.gray07,paddingTop:this._context.theming.measures.measure075,paddingBottom:this._context.theming.measures.measure100,paddingLeft:this._context.client.isRTL?this._context.theming.measures.measure100:this._context.theming.measures.measure050,paddingRight:this._context.client.isRTL?this._context.theming.measures.measure050:this._context.theming.measures.measure100,marginLeft:this._context.client.isRTL?0:this._context.theming.measures.measure200,marginRight:this._context.client.isRTL?this._context.theming.measures.measure200:0,fontSize:"16px",cursor:"pointer"}},e.prototype.getFlyoutStyle=function(){return{border:"1px "+this._context.theming.solidborderstyle+" "+this._context.theming.colors.controlborder}},e.prototype.getFlyoutItemStyle=function(){return{display:"block",lineHeight:this._context.theming.measures.measure250,paddingLeft:this._context.theming.measures.measure100,paddingRight:this._context.theming.measures.measure100,whiteSpace:"nowrap",color:this._context.theming.colors.grays.gray07,fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.regular,cursor:"pointer",backgroundColor:this._context.theming.colors.whitebackground,":hover":{backgroundColor:this._context.theming.colors.grays.gray03}}},e.prototype.getFlyoutItemHoverStyle=function(){return{backgroundColor:"#E6F2FA"}},e}();e.MailAppStyleManager=t}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));var Models;!function(e){}(Models||(Models={}));var Components;!function(e){var t=function(){function e(){}return e.keyboardNavigation=function(t,n,r){if(-1!==e.supportedKeys.indexOf(t.keyCode)){var i=t.target,o=t.currentTarget,a=o===i.parentElement,s=a?i:e._findListItem(i,o);switch(t.keyCode){case 38:var c=s.previousElementSibling;c&&c.focus(),t.preventDefault();break;case 40:var l=s.nextElementSibling;l&&l.focus(),t.preventDefault();break;case 36:if(a){var d=s.parentElement.firstElementChild;d&&d.focus()}break;case 35:if(a){var u=s.parentElement.lastElementChild;u&&u.focus()}break;case 13:(n||s).click();break;case 27:r&&r();break;case 9:r&&t.preventDefault()}}},e._findListItem=function(e,t){for(;e.parentElement!==t&&(e=e.parentElement););return e},e.supportedKeys=[38,40,13,36,35,27,9],e}();e.ListAccessibility=t}(Components||(Components={}));var MscrmControls;!function(e){var t;!function(e){var t="name",n="emailaddress",r="role",i="distributionList",o="RecipientsCreateFormAdd",a="MailApp.Control.UnknownRecipientSummary",s=function(){function s(){var e=this;this._entitiesDescriptors=[],this._onAddRecipientClick=function(t){var n=t.id.split("_")[1],r={entityName:n,useQuickCreateForm:!0},i=e._getPrefillOptions(n);e.closeAddRecipientFlyout(),e._context.navigation.openForm(r,i).then(e._onOpenFormSuccess)["catch"](e._onOpenFormFailure)},this._onOpenFormSuccess=function(t){var r=t&&t.savedEntityReference&&t.savedEntityReference[0];if(r){e._getFieldValue(n)&&e._context.externalContext.invokeExternalContextAction(Constants.contextId,Constants.ActionIds.ResolveRecipientFromScratch,{args:{emailAddress:e._getFieldValue(n)}}),e._isSender()&&Promise.all([e._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackStatus),e._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.KnownOrgSettings)]).then(function(t){var n=t[0],i=t[1];i&&!i.CreateContactWithoutTracking&&n&&n.crmTrackingState===Models.TrackingState.NotLinked&&e._trackWithRegarding(r)});var i=JSON.stringify({savedEntityReference:t.savedEntityReference.map(function(e){var t=e.entityType,n=e.id;return{entityType:t,id:n}})}),o={eventName:"uci_trace",eventParameters:[{name:"ApplicationEventLevel",value:Telemetry.EventLevel.Info},{name:"Message",value:"Unknown recipient was added as a "+r.entityType},{name:"ComponentName",value:a},{name:"Data",value:i}]};e._context.reporting.reportEvent(o)}},this._onOpenFormFailure=function(t){e._context.reporting.reportFailure(a,t)},this._renderAddRecipientFlyoutItem=function(t){var n=e._getResourceKeyForEntityType(t);return e._context.factory.createElement("LISTITEM",{id:o+"_"+t,key:o+"_"+t,role:"menuitem",tabIndex:0,accessibilityLabel:n,style:e._mailAppStyleManager.getFlyoutItemStyle(),onClick:function(t){return e._onAddRecipientClick(t.currentTarget)}},[n])},this._hasCreateEntityPrivilege=function(t){return e._context.utils.hasEntityPrivilege(t,1,-1)}}return Object.defineProperty(s.prototype,"_isExternalContextAvailable",{get:function(){var e=this._context?this._context.externalContext&&this._context.externalContext.getAvailableExternalContexts():null;return e&&e.getByName(Constants.contextId)},enumerable:!0,configurable:!0}),s.prototype.init=function(t,n,r){var i=this;if(this._context=t,this._isExternalContextAvailable){var o=this._context.accessibility.getUniqueId("button");this._addRecipientButtonId="RecipientsCreateForm_"+o,this._mailAppStyleManager=new e.MailAppStyleManager,this._mailAppStyleManager.init(this._context),this._loadEntitiesDisplayNames(),this._context.externalContext.getExternalContextProperty(Constants.contextId,Constants.PropertyIds.TrackAllowedStatus).then(function(e){i._isTrackAllowed=e===Enums.TrackAllowedStatus.Allowed,i._context.utils.requestRender()})}},s.prototype.updateView=function(e){var t;if(this._context=e,this._isExternalContextAvailable){if(!e.parameters.data||!e.parameters.data.raw)return e.factory.createElement("CONTAINER",{id:"RecipientsCreateFormEmptyContainer",key:"RecipientsCreateFormEmptyContainer"});var n=e.factory.createElement("LABEL",{id:"RecipientCreateFormHeaderLabel",key:"RecipientCreateFormHeaderLabel",style:this._mailAppStyleManager.getHeaderStyle()},this._getRecipientCreateFormHeaderText()),r=e.factory.createElement("CONTAINER",{id:"RecipientsCreateFormContainer",key:"RecipientsCreateFormContainer",style:{display:"flex",flexDirection:"row",alignItems:"flex-end",justifyContent:"space-between"}},[this._renderUnresolvedRecipientCard(),this._renderControls()]);return e.factory.createElement("CONTAINER",{id:"RecipientsCreateFormContainer",key:"RecipientsCreateFormContainer",style:(t={display:"block",width:"100%",color:this._context.theming.colors.grays.gray05,"background-color":this._context.theming.colors.whitebackground,"padding-top":this._context.theming.measures.measure100},t["padding-"+(this._context.client.isRTL?"right":"left")]=this._context.theming.measures.measure100,t["box-sizing"]="border-box",t)},[n,this._renderContactDuplicateWarning(),r])}},s.prototype.openAddRecipientFlyout=function(){this._isAddRecipientFlyoutOpened=!0,this._context.utils.requestRender()},s.prototype.closeAddRecipientFlyout=function(){this._isAddRecipientFlyoutOpened=!1,this._context.utils.requestRender()},Object.defineProperty(s.prototype,"_entityTypesToAdd",{get:function(){var e=this;return this._getEntityTypesFromParameters().filter(function(t){return t===Constants.CrmTypeNames.Account?e._context.utils.isFeatureEnabled(Constants.FeatureNames.MailAppResolveRecipientsToAccounts)&&e._hasCreateEntityPrivilege(t):e._hasCreateEntityPrivilege(t)})},enumerable:!0,configurable:!0}),s.prototype._loadEntitiesDisplayNames=function(){var e=this;if(this._entityTypesToAdd.length){var t=this._entityTypesToAdd.reduce(function(e,t){return e[t]=["DisplayName","LogicalName"],e},{});this._context.utils.getEntitiesMetadata(t).then(function(t){e._entitiesDescriptors=t,e._context.utils.requestRender()})}},s.prototype._renderUnresolvedRecipientCard=function(){var e=[],r=this._getFieldValue(t);r&&r!==this._getFieldValue(n)&&e.push(this._context.factory.createElement("LABEL",{id:"RecipientCreateFormName",key:"RecipientCreateFormName",style:this._mailAppStyleManager.getLabelStyle()},[r]));var i=this._getFieldValue(n);return i&&e.push(this._context.factory.createElement("HYPERLINK",{id:"RecipientCreateFormEmail",key:"RecipientCreateFormEmail",target:"_blank",href:"mailto:"+i,style:this._mailAppStyleManager.getLinkStyle(),title:i},[i])),this._context.factory.createElement("CONTAINER",{id:"RecipientsCreateFormCard",key:"RecipientsCreateFormCard",style:{display:"block","padding-bottom":this._context.theming.measures.measure100,"padding-top":this._context.theming.measures.measure075,overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},e)},s.prototype._renderControls=function(){var e=this,t=this._getEntityTypesFromParameters().some(function(t){return e._hasCreateEntityPrivilege(t)});return t?this._context.factory.createElement("CONTAINER",{id:"RecipientsCreateFormControls",key:"RecipientsCreateFormControls",style:{display:"block"}},[this._renderAddRecipientButton(),this._renderAddRecipientFlyout()]):null},s.prototype._renderAddRecipientButton=function(){var e=this,t=this._context.factory.createElement("MICROSOFTICON",{id:"RecipientsCreateFormAddButtonIcon",key:"RecipientsCreateFormAddButtonIcon",type:8}),n=this._context.resources.getString("UnknownRecipientSummaryControl_Add_To_Dynamics_365");return this._context.factory.createElement("BUTTON",{id:this._addRecipientButtonId,key:this._addRecipientButtonId,title:n,accessibilityLabel:n,accessibilityHasPopup:!0,role:"button",tabIndex:0,onClick:function(){return e.openAddRecipientFlyout()},style:this._mailAppStyleManager.getLinkButtonStyle()},[t])},s.prototype._renderContactDuplicateWarning=function(){var e=this._isTrackAllowed&&this._isSender();if(!e)return null;var t=this._context.factory.createElement("MICROSOFTICON",{id:"ContactDuplicateWarningIcon",key:"ContactDuplicateWarningIcon",type:179,style:{position:"relative",fontSize:"20px",top:"5px",marginRight:"5px"}}),n=this._context.resources.getString("UnknownRecipientSummaryControl_Create_Contact_To_Avoid_Duplicates"),r=this._context.factory.createElement("LABEL",{id:"ContactDuplicateWarningLabel",key:"ContactDuplicateWarningLabel"},n);return this._context.factory.createElement("CONTAINER",{id:"ContactDuplicateWarningContainer",key:"ContactDuplicateWarningContainer",style:{display:"block",color:"#3b3a39",paddingTop:this._context.theming.measures.measure050,paddingBottom:this._context.theming.measures.measure025}},[t,r])},s.prototype._getPrefillOptions=function(e){var t=this._getFieldValue(n),r={emailaddress1:t};if(e===Constants.CrmTypeNames.Account){var i=t.match(/@([^.]+)/);if(i)return Object.assign(r,{name:i[1]})}var o=this._getRecipientFirstAndLastName();return Object.assign(r,{firstname:o.firstName,lastname:o.lastName})},s.prototype._getRecipientFirstAndLastName=function(){var e=this._getFieldValue(t),r=this._getFieldValue(n),i=-1!==(e||r).indexOf("@");if(!e||i){var o=r.substring(0,r.indexOf("@")).split(".");return 2===o.length?{firstName:this._capitalizeFirstLetter(o[0]),lastName:this._capitalizeFirstLetter(o[1])}:{}}var a=e.split(",");if(a.length<2){var s=e.split(" ");return{firstName:s.length>1?s.slice(0,-1).join(" "):null,lastName:s[s.length-1]}}return 2===a.length?{firstName:a[1],lastName:a[0]}:{lastName:e}},s.prototype._trackWithRegarding=function(e){var t,n=this,r={id:e.id,name:e.name,Name:e.name,logicalName:e.entityType,LogicalName:e.entityType,entityName:e.entityType,entityType:e.entityType},i={getNamedReference:function(){return r}},o="MailApp.TrackRegarding.Button";this._context.utils.retrieveRecordCommand((t={},t[r.id]=i,t),Constants.GlobalCommandManagerId,[r.id],[o]).then(function(e){var t=e&&e[0];t&&t.canExecute&&t.execute()},function(e){var t=[{name:"Data",value:JSON.stringify(r)},{name:"Error",value:JSON.stringify(e)}];n._context.reporting.reportFailure(a,new Error("Failed to retrieve record from CRM"),null,t)})},s.prototype._isSender=function(){return parseInt(this._getFieldValue(r),10)===Models.RecipientRole.Sender},s.prototype._renderAddRecipientFlyout=function(){var e=this;if(!this._isAddRecipientFlyoutOpened)return null;var t=this._entityTypesToAdd.map(this._renderAddRecipientFlyoutItem),n=this._context.factory.createElement("LIST",{id:"RecipientsCreateFormAddRecipientDropdown",key:"RecipientsCreateFormAddRecipientDropdown",role:"menu",accessibilityLabel:"Commands",onKeyDown:function(t){return Components.ListAccessibility.keyboardNavigation(t,null,function(){e.closeAddRecipientFlyout(),e._context.accessibility.focusElementById(e._addRecipientButtonId)})}},t);return this._context.factory.createElement("FLYOUT",{id:"RecipientsCreateFormAddRecipientFlyout",key:"RecipientsCreateFormAddRecipientFlyout",focusElementId:o+"_"+this._entityTypesToAdd[0],flyoutDirection:7,flyoutStyle:this._mailAppStyleManager.getFlyoutStyle(),positionType:"relative",relativeToElementId:this._addRecipientButtonId,onOutsideClick:function(){return e.closeAddRecipientFlyout()}},[n])},s.prototype._getResourceKeyForEntityType=function(e){var t=this._entitiesDescriptors.find(function(t){return t.LogicalName===e});if(!t)return this._context.resources.getString("UnknownRecipientSummaryControl_Add_As_"+this._capitalizeFirstLetter(e));var n=this._context.resources.getString("UnknownRecipientSummaryControl_Add_Recipient_As");return Utility.formatString(n,t.DisplayName)},s.prototype._getEntityTypesFromParameters=function(){var e=this._context.parameters.entityTypesToAdd&&this._context.parameters.entityTypesToAdd.raw;return e?e.split(",").map(function(e){return e.trim().toLowerCase()}):[]},s.prototype._getFieldValue=function(e){return this._context.parameters.data.raw&&this._context.parameters.data.raw.getFormattedValue(e)},s.prototype._getRecordEntityLogicalName=function(){var e=this._context.parameters.data.raw&&this._context.parameters.data.raw.getNamedReference();return e&&e.LogicalName},s.prototype._getRecipientCreateFormHeaderText=function(){return this._getRecordEntityLogicalName()===i?this._context.resources.getString("UnknownRecipientSummaryControl_Distribution_List"):this._context.resources.getString("UnknownRecipientSummaryControl_Unknown_Recipient")},s.prototype._capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},s.prototype.getOutputs=function(){return null},s.prototype.destroy=function(){},s}();e.UnknownRecipientSummaryControl=s}(t=e.MailApp||(e.MailApp={}))}(MscrmControls||(MscrmControls={}));
//# sourceMappingURL=D:\a\1\s\target\bin\release\ts\..\uglify\MailAppControls.js.map
