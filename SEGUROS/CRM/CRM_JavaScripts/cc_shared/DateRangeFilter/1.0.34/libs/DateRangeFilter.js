var MscrmControls;!function(MscrmControls){var DateRangeControl;!function(DateRangeControl){"use strict";var SUNDAY=0,DateRangeInput=function(){function DateRangeInput(){}return DateRangeInput.initialize=function(_localizedStrings){DateRangeInput.Today=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_TODAY,DateRangeInput.Yesterday=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_YESTERDAY,DateRangeInput.ThisWeek=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_THISWEEK,DateRangeInput.LastWeek=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_LASTWEEK,DateRangeInput.ThisMonth=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_THISMONTH,DateRangeInput.LastMonth=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_LASTMONTH,DateRangeInput.MonthToDate=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_MONTHTODATE,DateRangeInput.ThisQuarter=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_THISQUARTER,DateRangeInput.LastQuarter=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_LASTQUARTER,DateRangeInput.CustomTimeFrame=_localizedStrings.DATERANGEFILTER_DATERANGEINPUT_CUSTOMTIMEFRAME,DateRangeInput.FormattedDateRange=_localizedStrings.DATERANGEFILTER_BUTTON_FORMATTEDDATERANGETEXT,DateRangeInput.DateRangeInputByTimeFrame=[DateRangeInput.Today,DateRangeInput.Yesterday,DateRangeInput.ThisWeek,DateRangeInput.LastWeek,DateRangeInput.ThisMonth,DateRangeInput.LastMonth,DateRangeInput.MonthToDate,DateRangeInput.ThisQuarter,DateRangeInput.LastQuarter,DateRangeInput.CustomTimeFrame]},DateRangeInput.ConvertStringToDate=function(dateStr){var newDateStr=dateStr.replace(/-/g,"/");return new Date(newDateStr)},DateRangeInput.GenerateStartEndDateForTimeFrame=function(timeFrame){var startDate=new Date,endDate=new Date;switch(timeFrame){case 0:case DateRangeInput.Today:endDate=startDate;break;case 1:case DateRangeInput.Yesterday:startDate.setDate(startDate.getDate()-1),endDate=startDate;break;case 2:case DateRangeInput.ThisWeek:startDate.setDate(startDate.getDay()===SUNDAY?startDate.getDate()-6:startDate.getDate()-startDate.getDay()+1),endDate.getDay()!==SUNDAY&&endDate.setDate(endDate.getDate()+7-endDate.getDay());break;case 3:case DateRangeInput.LastWeek:startDate.setDate(startDate.getDay()===SUNDAY?startDate.getDate()-13:startDate.getDate()-startDate.getDay()-6),endDate.setDate(endDate.getDay()===SUNDAY?endDate.getDate()-7:endDate.getDate()-endDate.getDay());break;case 4:case DateRangeInput.ThisMonth:startDate.setDate(1),endDate.setDate(0),endDate.setMonth(endDate.getMonth()+1);break;case 5:case DateRangeInput.LastMonth:startDate.setDate(1),startDate.setMonth(startDate.getMonth()-1),endDate.setDate(0);break;case 6:case DateRangeInput.MonthToDate:startDate.setDate(1);break;case 7:case DateRangeInput.ThisQuarter:startDate.setDate(1),startDate.setMonth(3*Math.floor(startDate.getMonth()/3)),endDate.setDate(1),endDate.setMonth(startDate.getMonth()+3),endDate.setDate(0);break;case 8:case DateRangeInput.LastQuarter:startDate.setDate(1),startDate.setMonth(3*Math.floor(startDate.getMonth()/3)-3),endDate.setDate(1),endDate.setMonth(startDate.getMonth()+3),endDate.setDate(0),endDate.setFullYear(startDate.getFullYear())}return{StartDate:startDate,EndDate:endDate}},DateRangeInput.GetUTCDateString=function(inputDate){return inputDate.getFullYear()+"-"+(inputDate.getMonth()+1)+"-"+inputDate.getDate()},DateRangeInput.GetDateConditionExpression=function(startDate,endDate,attributeName){var conditionExpressionArr=[];return conditionExpressionArr.push({attributeName:attributeName,conditionOperator:27,value:"string"==typeof startDate?startDate:DateRangeInput.GetUTCDateString(startDate)}),conditionExpressionArr.push({attributeName:attributeName,conditionOperator:26,value:"string"==typeof endDate?endDate:DateRangeInput.GetUTCDateString(endDate)}),conditionExpressionArr},DateRangeInput.GetDefaultDateConditionExpression=function(attributeName,timeFrame,startDate,endDate){var conditionExp=[],startEndDate=9===timeFrame&&startDate&&endDate?(_a={},_a[DateRangeInput.StartDate]=startDate,_a[DateRangeInput.EndDate]=endDate,_a):DateRangeInput.GenerateStartEndDateForTimeFrame(timeFrame);return conditionExp=DateRangeInput.GetDateConditionExpression(startEndDate[DateRangeInput.StartDate],startEndDate[DateRangeInput.EndDate],attributeName);var _a},DateRangeInput.GetFormattedDateRangeFromUTCDateStrings=function(start,end,context){var startDate=DateRangeInput.ConvertStringToDate(start),endDate=DateRangeInput.ConvertStringToDate(end);return DateRangeInput.GetFormattedDateRange(startDate,endDate,context)},DateRangeInput.GetFormattedDateRange=function(startDate,endDate,context){var output=DateRangeInput.FormattedDateRange;return context&&context.formatting&&context.formatting.formatDateShort?output.replace(/\{0\}/g,context.formatting.formatDateShort(startDate)).replace(/\{1\}/g,context.formatting.formatDateShort(endDate)):output.replace(/\{0\}/g,startDate.toLocaleDateString()).replace(/\{1\}/g,endDate.toLocaleDateString())},DateRangeInput.StartDate="StartDate",DateRangeInput.EndDate="EndDate",DateRangeInput}();DateRangeControl.DateRangeInput=DateRangeInput}(DateRangeControl=MscrmControls.DateRangeControl||(MscrmControls.DateRangeControl={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var DateRangeControl;!function(DateRangeControl){"use strict";var MILLISECONDS_IN_MINUTE=6e4,DateRangeFilterControl=function(){function DateRangeFilterControl(){this._dateConditionExpArr=[],this._isOpen=!1,this._isCustomDatePaneOpen=!1,this._buttonText="Time Range",this.context=null,this._changeHandler=this._onChange.bind(this)}return DateRangeFilterControl.prototype._onChange=function(type,change){change&&(type===DateRangeControl.DateRangeInput.StartDate?this._valueFromStartDateControlInput=this._correctDate(change,this._valueFromStartDateControlInput):this._valueFromEndDateControlInput=this._correctDate(change,this._valueFromEndDateControlInput),this._isCustomDatePaneOpen?this.context.utils.requestRender():this._isCustomTimeFrameApplyClicked&&!this._isCustomDatePaneOpen&&(this._applyButtonClickHandler(this),this._isCustomTimeFrameApplyClicked=!1))},DateRangeFilterControl.prototype._correctDate=function(change,controlValue){return isNaN(Date.parse(change))?controlValue:new Date(change)},DateRangeFilterControl.prototype.optionsClickHandler=function(){this.optionsClickHandlerSetFocus(),event.stopPropagation(),event.preventDefault()},DateRangeFilterControl.prototype.optionsClickHandlerSetFocus=function(){var _this=this;window.setTimeout(function(){if(document.getElementById(_this.context.accessibility.getUniqueId("DateRangeFilter"))){var element=document.getElementById(_this.context.accessibility.getUniqueId("DateRangeFilter"));element.focus()}else _this.optionsClickHandlerSetFocus()},100)},DateRangeFilterControl.prototype._updateButtonText=function(label){this._valueFromStartDateControl=this._valueFromStartDateControlInput,this._valueFromEndDateControl=this._valueFromEndDateControlInput,this._valueFromEndDateControlInput&&this._valueFromStartDateControlInput?this._buttonText=label+" "+DateRangeControl.DateRangeInput.GetFormattedDateRange(this._valueFromStartDateControlInput,this._valueFromEndDateControlInput,this.context):label?this._buttonText=label:this._buttonText=" "},DateRangeFilterControl.prototype.handleDateRangeButtonClick=function(event){var dateRangeButtonAriaExpandedValue=this._isOpen?"true":"false",dateRangeButton=document.getElementById(this.context.accessibility.getUniqueId("DateRangeFilter"));dateRangeButton.setAttribute("aria-expanded",dateRangeButtonAriaExpandedValue),this._isOpen&&(this.dateRangeFilterFlyout=this.context.accessibility.getUniqueId("DateRangeFilterFlyout"),dateRangeButton.setAttribute("aria-controls",this.dateRangeFilterFlyout))},DateRangeFilterControl.prototype.init=function(context,notifyOutputChanged,state){this.context=context,this._localizedStrings=DateRangeControl.DateRangeFilterControlUtils.getLocalizedStrings(this.context),DateRangeControl.DateRangeInput.initialize(this._localizedStrings),this.context.parameters&&this.context.parameters.DateRangeAttribute&&this.context.parameters.DateRangeAttribute.raw&&(this._attributeName=this.context.parameters.DateRangeAttribute.raw),this.context.parameters&&this.context.parameters.DateRangeTimeframe&&this.context.parameters.DateRangeTimeframe.raw&&(this._defaultTimeFrame=+this.context.parameters.DateRangeTimeframe.raw),this._notifyOutputChangedInternal=notifyOutputChanged,this.context.accessibility.registerShortcut([17,18,68],this.dateRangeFilterControlShortCut.bind(this),!0,"DateRange_Filter_Button","DATERANGEFILTERBUTTONSHORTCUT")},DateRangeFilterControl.prototype.dateRangeFilterControlShortCut=function(){var element=document.getElementById(this.context.accessibility.getUniqueId("DateRangeFilter"));element&&element.click()},DateRangeFilterControl.prototype.updateView=function(context){if(this.context=context,DateRangeControl.DateRangeInput.initialize(this._localizedStrings),!this.context.parameters||!this._defaultTimeFrame&&0!==this._defaultTimeFrame||this.context.parameters.DateRangeTimeframe&&this.context.parameters.DateRangeTimeframe.raw||(this._defaultTimeFrame=null,this._buttonText=""),this.context.parameters&&this.context.parameters.DateRangeTimeframe&&this.context.parameters.DateRangeTimeframe.raw){var canNotifyFilterChanged=!!this._dateRangeTimeframe,timeFrameString=DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame[+this.context.parameters.DateRangeTimeframe.raw],startEndDate=void 0,isValueChanged=!1;if(9===+this.context.parameters.DateRangeTimeframe.raw&&this.context.parameters.CustomTimeFrameStartDate&&this.context.parameters.CustomTimeFrameStartDate.raw&&this.context.parameters.CustomTimeFrameEndDate&&this.context.parameters.CustomTimeFrameEndDate.raw&&(this._customTimeFrameEndDate!=this.context.parameters.CustomTimeFrameEndDate.raw||this._customTimeFrameStartDate!=this.context.parameters.CustomTimeFrameStartDate.raw)&&this.context.parameters.CustomTimeFrameEndDate.raw>=this.context.parameters.CustomTimeFrameStartDate.raw?(startEndDate={},this._dateRangeTimeframe=this.context.parameters.DateRangeTimeframe.raw,startEndDate[DateRangeControl.DateRangeInput.StartDate]=DateRangeControl.DateRangeInput.ConvertStringToDate(this.context.parameters.CustomTimeFrameStartDate.raw),startEndDate[DateRangeControl.DateRangeInput.EndDate]=DateRangeControl.DateRangeInput.ConvertStringToDate(this.context.parameters.CustomTimeFrameEndDate.raw),this._customTimeFrameStartDate=this.context.parameters.CustomTimeFrameStartDate.raw,this._customTimeFrameEndDate=this.context.parameters.CustomTimeFrameEndDate.raw,isValueChanged=!0):this._dateRangeTimeframe!=this.context.parameters.DateRangeTimeframe.raw&&(startEndDate=DateRangeControl.DateRangeInput.GenerateStartEndDateForTimeFrame(timeFrameString),this._dateRangeTimeframe=this.context.parameters.DateRangeTimeframe.raw,isValueChanged=!0),this._valueFromStartDateControlInput>this._valueFromEndDateControlInput){var tempEndDate=new Date(this._valueFromStartDateControlInput.getTime());tempEndDate.setDate(tempEndDate.getDate()+1),this._valueFromEndDateControlInput=tempEndDate,this._isCustomTimeFrameApplyClicked&&(this._customTimeFrameStartDate=this._valueFromStartDateControlInput.toString(),this._customTimeFrameEndDate=this._valueFromEndDateControlInput.toString(),timeFrameString=DateRangeControl.DateRangeInput.CustomTimeFrame,_a={},_a[DateRangeControl.DateRangeInput.StartDate]=this._valueFromStartDateControlInput,_a[DateRangeControl.DateRangeInput.EndDate]=this._valueFromEndDateControlInput,startEndDate=_a,isValueChanged=!0),this.context.utils.requestRender()}isValueChanged&&(this._valueFromStartDateControlInput=startEndDate[DateRangeControl.DateRangeInput.StartDate],this._valueFromEndDateControlInput=startEndDate[DateRangeControl.DateRangeInput.EndDate],this._updateButtonText(timeFrameString),this._updateDateConditionExpression(),this._notifyOutputChanged(timeFrameString,canNotifyFilterChanged))}var filterIcon=this.context.factory.createElement("MICROSOFTICON",{id:"DateRangeFilterIcon",key:"DateRangeFilterIcon",type:82,style:{fontSize:"16px",color:this.context.theming.colors.grays.gray07}}),components=[],text=this.context.factory.createElement("LABEL",{id:"DateRangeFilterText",key:"DateRangeFilterText",style:{cursor:"pointer",textOverflow:this.context.parameters.DashboardColumns?void 0:"ellipsis",whiteSpace:this.context.parameters.DashboardColumns?void 0:"nowrap",overflow:this.context.parameters.DashboardColumns?void 0:"hidden"}},this._buttonText),icon=this.context.factory.createElement("MICROSOFTICON",{id:"DateRangeFilterDownIcon",key:"DateRangeFilterDownIcon",type:72,style:{fontSize:"16px",color:this.context.theming.colors.base.black,paddingTop:"6px",paddingBottom:"6px",paddingRight:this.context.parameters.DashboardColumns?this.context.theming.measures.measure100:0,paddingLeft:this.context.parameters.DashboardColumns?this.context.theming.measures.measure100:this.context.theming.measures.measure050,":hover":{backgroundColor:this.context.theming.colors.grays.gray02}}});if(this.context.parameters.DashboardWidth&&this.context.parameters.DashboardWidth.raw<+this.context.theming.breakpoints.dimensionm?components.push(filterIcon):(components.push(text),components.push(icon)),this._isOpen){var flyout=this._createFlyout();components.push(flyout)}else if(this._isCustomDatePaneOpen){var flyout=this._createCustomDateTimeFlyout();components.push(flyout)}var _this=this,filterBy=this.context.parameters&&this.context.parameters.DisplayName&&this.context.parameters.DisplayName.raw?this.context.parameters.DisplayName.raw:"",button=this.context.factory.createElement("BUTTON",{id:"DateRangeFilter",key:"DateRangeFilter",accessibilityHasPopup:!0,accessibilityLabel:filterBy+" : "+_this._buttonText,accessibilityExpanded:this._isOpen,controlsElementId:this._isOpen?this.dateRangeFilterFlyout:null,style:{flexDirection:"row",justifyContent:"space-around",whiteSpace:"nowrap",width:this.context.parameters.DashboardColumns&&1===this.context.parameters.DashboardColumns.raw?"calc(16px + "+this.context.theming.measures.measure200+")":"100%",height:"30px",overflow:"hidden",fontSize:this.context.theming.fontsizes.font100,fontFamilies:this.context.theming.fontfamilies.semibold,color:this.context.theming.colors.grays.gray05,backgroundColor:this.context.theming.colors.whitebackground,border:"none",alignItems:"center",cursor:"pointer",paddingRight:this.context.parameters.DashboardWidth&&this.context.parameters.DashboardWidth.raw<+this.context.theming.breakpoints.dimensionm?this.context.theming.measures.measure100:0,paddingLeft:this.context.parameters.DashboardColumns?this.context.theming.measures.measure100:0,flexShrink:1},onKeyDown:function(event){40===event.keyCode&&event.currentTarget.click()},onClick:function(){_this._toggleFlyout(_this),_this.handleDateRangeButtonClick(_this),_this._setFocusOnSelectedElement(_this.context.accessibility.getUniqueId("DateRangeFilter_FlyoutText"+DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame[0]),_this.context.theming.colors.grays.gray03)}},components);return button;var _a},DateRangeFilterControl.prototype.addCircularTabbing=function(event,elementId){var element=event.target,container=document.getElementById(elementId);if(container){for(var containerElements=container.querySelectorAll("li "),tabbableElements=[],i=0;i<containerElements.length;i++)tabbableElements.push(containerElements[i]);if(tabbableElements&&0!==tabbableElements.length){for(var targetIndex,index=0;index<tabbableElements.length;index++)tabbableElements[index]===event.target&&(targetIndex=index);var nextFocusElement=null;38===event.keyCode?nextFocusElement=element.id===tabbableElements[0].id?tabbableElements[tabbableElements.length-1]:tabbableElements[targetIndex-1]:event.shiftKey&&9===event.keyCode?element.id===tabbableElements[0].id?(this._isOpen=!this._isOpen,this.context.utils.requestRender(),this.optionsClickHandler()):nextFocusElement=tabbableElements[targetIndex-1]:40===event.keyCode?nextFocusElement=element.id===tabbableElements[tabbableElements.length-1].id?tabbableElements[0]:tabbableElements[targetIndex+1]:9!==event.keyCode||event.shiftKey||(element.id===tabbableElements[tabbableElements.length-1].id?(this._isOpen=!this._isOpen,this.context.utils.requestRender(),this.optionsClickHandler()):nextFocusElement=tabbableElements[targetIndex+1]),nextFocusElement&&(element.removeAttribute("style"),nextFocusElement.focus(),nextFocusElement.style.backgroundColor=this.context.theming.colors.grays.gray03,event.preventDefault())}}},DateRangeFilterControl.prototype._keyDownHelper=function(event){event&&this.addCircularTabbing(event,this.context.accessibility.getUniqueId("DateRangeFilterFlyout"))},DateRangeFilterControl.prototype._setFocusOnSelectedElement=function(listItemKey,style,outline){var _this=this;window.setTimeout(function(){document.getElementById(_this.context.accessibility.getUniqueId("DateRangeFilterFlyout"))?_this._getSelectedElement(listItemKey,style,outline):_this._setFocusOnSelectedElement(listItemKey,style,outline)},100)},DateRangeFilterControl.prototype._getSelectedElement=function(listItemKey,style,outline){for(var selectedElementText,focussedElement,container=document.getElementById(this.context.accessibility.getUniqueId("DateRangeFilterFlyout")),listElements=container.querySelectorAll("li"),textLabel=this._buttonText,index=0;index<DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame.length;index++)textLabel.indexOf(DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame[index])>=0&&(selectedElementText=DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame[index]);for(var i=0;i<listElements.length;i++)listElements[i].title===selectedElementText?focussedElement=listElements[i]:selectedElementText||(focussedElement=listElements[listElements.length-1].parentElement);focussedElement&&(focussedElement.tabIndex=0,focussedElement.focus(),focussedElement.style.backgroundColor=style,outline&&(focussedElement.style.outline=outline))},DateRangeFilterControl.prototype._setFocusOnElement=function(listItemKey,style,outline){var elementId=listItemKey,element=document.getElementById(elementId);element&&(element.tabIndex=0,element.focus(),element.style.backgroundColor=style,outline&&(element.style.outline=outline))},DateRangeFilterControl.prototype._setFocus=function(listItemKey,style,outline){var _this=this;window.setTimeout(function(){document.getElementById(_this.context.accessibility.getUniqueId("DateRangeFilterFlyout"))||document.getElementById(_this.context.accessibility.getUniqueId("DateRangeFilter_ParentCustomDateContainer"))?_this._setFocusOnElement(listItemKey,style,outline):_this._setFocus(listItemKey,style,outline)},100)},DateRangeFilterControl.prototype.getOutputs=function(){var result={DateRangeOutput:JSON.stringify(this._dateConditionExpArr),TimeFrameOutput:this._currentTimeFrame};return result},DateRangeFilterControl.prototype._notifyOutputChanged=function(timeFrameLabel,canNotifyFilterChanged){void 0===canNotifyFilterChanged&&(canNotifyFilterChanged=!0);var notifyOutputOnInitialRender=!this.context.parameters.NotifyOutputOnInitialRender||"no"!==this.context.parameters.NotifyOutputOnInitialRender.raw;(notifyOutputOnInitialRender||canNotifyFilterChanged)&&this._notifyOutputChangedInternal();var timeFrame=DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame.indexOf(timeFrameLabel);if(canNotifyFilterChanged){this._currentTimeFrame=timeFrame.toString();var filterChange={filter:this._dateConditionExpArr,timeFrame:this._currentTimeFrame};this.context.utils.fireEvent("onFilterChanged",filterChange)}this._reportDateRangeTelemetry(timeFrame)},DateRangeFilterControl.prototype._reportDateRangeTelemetry=function(timeFrame){var startTime=DateRangeControl.DateRangeInput.ConvertStringToDate(DateRangeControl.DateRangeInput.GetUTCDateString(this._valueFromStartDateControlInput)),endTime=DateRangeControl.DateRangeInput.ConvertStringToDate(DateRangeControl.DateRangeInput.GetUTCDateString(this._valueFromEndDateControlInput)),dateRangeEvent={eventName:"uci_daterangefilter",eventParameters:[{name:"TimeFrame",value:timeFrame},{name:"StartTime",value:startTime},{name:"EndTime",value:endTime},{name:"Attribute",value:this._attributeName}]};this.context.reporting.reportEvent(dateRangeEvent)},DateRangeFilterControl.prototype.destroy=function(){},DateRangeFilterControl.prototype._createCustomDateTimeFlyout=function(){var components=[];components.push(this._createDateTimeControlHeader(this)),components.push(this.createDateTimeControlRow(this)),components.push(this._createDateTimeControlFooter(this));var parentCustomDateContainer=this.context.factory.createElement("CONTAINER",{id:"DateRangeFilter_ParentCustomDateContainer",key:"DateRangeFilter_ParentCustomDateContainer",style:{flexDirection:"column",justifyContent:"space-between",height:"100%",backgroundColor:this.context.theming.colors.whitebackground,border:this.context.theming.borders.border02,boxShadow:"4px 4px 4px 1px rgba(0, 0, 0, 0.5);"}},components),_this=this,flyout=this.context.factory.createElement("FLYOUT",{id:"DateRangeFilter_CustomDateFlyout",key:"DateRangeFilter_CustomDateFlyout",positionType:"relative",flyoutDirection:3,relativeToElementId:!this.context.parameters.DashboardColumns||1!==this.context.parameters.DashboardColumns.raw&&2!==this.context.parameters.DashboardColumns.raw?"DateRangeFilterDownIcon":"DateRangeFilter",onOutsideClick:function(){return _this._toggleCustomDateSelector(_this)},groupId:"DateRangeFilterCustomDateFlyoutGroup"},[parentCustomDateContainer]);return flyout},DateRangeFilterControl.prototype._createFlyout=function(){var _this=this,listItems=[],listOptionHeader=this.context.factory.createElement("LABEL",{id:"DateRangeFilter_FlyoutTextModified",key:"DateRangeFilter_FlyoutTextModified",style:{paddingTop:this.context.theming.measures.measure075,paddingBottom:this.context.theming.measures.measure050,paddingLeft:this.context.theming.measures.measure150,paddingRight:this.context.theming.measures.measure150,fontSize:this.context.theming.fontsizes.font100,fontFamilies:this.context.theming.fontfamilies.semibold,border:this.context.theming.borders.border02,color:this.context.theming.colors.base.black,listStyleType:"none"}},this.context.parameters&&this.context.parameters.DisplayName&&this.context.parameters.DisplayName.raw?this.context.parameters.DisplayName.raw:"");listItems.push(listOptionHeader);var nextIcon=this.context.factory.createElement("MICROSOFTICON",{id:"DateRangeFilter_CustomTimeFrameLeftIcon",key:"DateRangeFilter_CustomTimeFrameLeftIcon",title:DateRangeControl.DateRangeInput.CustomTimeFrame,style:{fontSize:"16px",backgroundColor:"transparent",paddingLeft:this.context.theming.measures.measure100,cursor:"pointer"},type:71}),_loop_1=function(index){var listItem=DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame[index],isCustomTimeFrame=!1;listItem===DateRangeControl.DateRangeInput.CustomTimeFrame&&(isCustomTimeFrame=!0,this_1._customTimeFrameID="DateRangeFilter_FlyoutText"+DateRangeControl.DateRangeInput.CustomTimeFrame),function(listItem){var customFrameOption=null;isCustomTimeFrame&&(customFrameOption=_this.context.factory.createElement("CONTAINER",{id:"DateRangeFilterOptionContainer",key:"DateRangeFilterOptionContainer",role:"presentation",style:{listStyleType:"none",alignItems:"center",":hover":{backgroundColor:_this.context.theming.colors.grays.gray01}}},[listItem,nextIcon]));var listItemOption=_this.context.factory.createElement("LISTITEM",{id:"DateRangeFilter_FlyoutText"+listItem,key:"DateRangeFilter_FlyoutText"+listItem,accessibilityLabel:listItem,accessibilityHasPopup:!!isCustomTimeFrame||null,role:"option",title:listItem,tabIndex:0,onKeyDown:function(event){listItem!==DateRangeControl.DateRangeInput.CustomTimeFrame?13===event.keyCode||32===event.keyCode||27===event.keyCode?27===event.keyCode?(_this._toggleFlyout(_this),_this.optionsClickHandler(),event.preventDefault()):(event.currentTarget.click(),event.preventDefault()):(38===event.keyCode||40===event.keyCode||9===event.keyCode&&!event.shiftKey||9===event.keyCode&&event.shiftKey)&&_this._keyDownHelper(event):13===event.keyCode||32===event.keyCode?(event.target.click(),_this._setFocus(_this.context.accessibility.getUniqueId("DateRangeFilter_CustomTimeFrameLeftIcon"),"")):38===event.keyCode||40===event.keyCode||9===event.keyCode&&!event.shiftKey||9===event.keyCode&&event.shiftKey?_this._keyDownHelper(event):27===event.keyCode&&(_this._toggleFlyout(_this),_this.optionsClickHandler(),event.preventDefault())},style:{paddingTop:_this.context.theming.measures.measure075,paddingBottom:_this.context.theming.measures.measure050,paddingLeft:_this.context.theming.measures.measure150,paddingRight:isCustomTimeFrame?_this.context.theming.measures.measure050:_this.context.theming.measures.measure150,fontSize:_this.context.theming.fontsizes.font100,fontFamilies:_this.context.theming.fontfamilies.regular,color:_this.context.theming.colors.grays.gray07,listStyleType:"none",cursor:"pointer",":hover":{backgroundColor:_this.context.theming.colors.grays.gray01}},onClick:function(){listItem!==DateRangeControl.DateRangeInput.CustomTimeFrame?(_this._parseInput(_this,listItem),_this.optionsClickHandler()):(_this._parseInput(_this,listItem),_this._setFocus(_this.context.accessibility.getUniqueId("DateRangeFilter_CustomTimeFrameLeftIcon"),""))}},isCustomTimeFrame?customFrameOption:listItem);listItems.push(listItemOption)}(listItem)},this_1=this;for(var index in DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame)_loop_1(index);var optionContainer=this.context.factory.createElement("LIST",{id:"DateRangeFilterListOptionContainer",key:"DateRangeFilterListOptionContainer",role:"listbox",cursor:"pointer",onKeyDown:function(event){36===event.keyCode?(event.target.style.backgroundColor=_this.context.theming.colors.whitebackground,_this._setFocus(_this.context.accessibility.getUniqueId("DateRangeFilter_FlyoutText"+DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame[0]),_this.context.theming.colors.grays.gray03)):35===event.keyCode&&(event.target.style.backgroundColor=_this.context.theming.colors.whitebackground,_this._setFocus(_this.context.accessibility.getUniqueId("DateRangeFilter_FlyoutText"+DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame[DateRangeControl.DateRangeInput.DateRangeInputByTimeFrame.length-1]),_this.context.theming.colors.grays.gray03))},style:{flexDirection:"column",backgroundColor:this.context.theming.colors.whitebackground,height:"100%",border:this.context.theming.borders.border02,boxShadow:"4px 4px 4px 1px rgba(0, 0, 0, 0.1);",marginBottom:this.context.theming.measures.measure025,paddingBottom:this.context.theming.measures.measure100}},listItems),flyoutStyle={zIndex:9999},flyout=this.context.factory.createElement("FLYOUT",{id:"DateRangeFilterFlyout",key:"DateRangeFilterFlyout",positionType:"relative",flyoutDirection:3,relativeToElementId:"DateRangeFilter",onOutsideClick:function(){return _this._toggleFlyout(_this)},groupId:"DateRangeFilterFlyoutGroup",flyoutStyle:flyoutStyle},[optionContainer]);return flyout},DateRangeFilterControl.prototype._toggleFlyout=function(_this){_this._isOpen=!_this._isOpen,_this.context.utils.requestRender()},DateRangeFilterControl.prototype._toggleCustomDateSelector=function(_this){_this._isCustomDatePaneOpen=!_this._isCustomDatePaneOpen,_this._isCustomDatePaneOpen&&(_this._isCustomTimeFrameApplyClicked=!1),_this._valueFromStartDateControlInput=_this._valueFromStartDateControl,_this._valueFromEndDateControlInput=_this._valueFromEndDateControl,_this.context.utils.requestRender()},DateRangeFilterControl.prototype.createDateTimeControlRow=function(_this){var components=[];return components.push(_this._createDateTimeControl(DateRangeControl.DateRangeInput.StartDate,this._valueFromStartDateControlInput)),components.push(_this._createDateTimeControl(DateRangeControl.DateRangeInput.EndDate,this._valueFromEndDateControlInput)),this.context.factory.createElement("CONTAINER",{id:"DateRangeFilter_BodyContainer",key:"DateRangeFilter_BodyContainer",style:{flexDirection:"column",justifyContent:"space-between",paddingTop:this.context.theming.measures.measure100,paddingBottom:this.context.theming.measures.measure050,paddingLeft:this.context.theming.measures.measure150,paddingRight:this.context.theming.measures.measure150}},components)},DateRangeFilterControl.prototype.addAttributesToDateTimeControls=function(typeString){var _this=this;window.setTimeout(function(){if(document.getElementById(_this.context.accessibility.getUniqueId("DateRangeFilter_CustomDateFlyout"))){var containerDivId=document.getElementById(_this.context.accessibility.getUniqueId("DateRangeFilter_"+typeString+"Container")),childDivId=containerDivId&&containerDivId.lastElementChild&&containerDivId.lastElementChild.firstElementChild&&containerDivId.lastElementChild.firstElementChild.id;if(childDivId){if(document.getElementById(childDivId))if(containerDivId.lastElementChild.firstElementChild.hasChildNodes()){var childInputId=containerDivId.lastElementChild.firstElementChild.lastElementChild.id;document.getElementById(childInputId)&&document.getElementById(childInputId).setAttribute("aria-label",typeString===DateRangeControl.DateRangeInput.StartDate?_this._localizedStrings.DATERANGEFILTER_CUSTOMINPUT_STARTDATE+" "+document.getElementById(childInputId).getAttribute("value"):_this._localizedStrings.DATERANGEFILTER_CUSTOMINPUT_ENDDATE+" "+document.getElementById(childInputId).getAttribute("value"))}else _this.addAttributesToDateTimeControls(typeString);document.getElementById(childDivId).style.cursor="pointer",document.getElementById(childDivId).style.border="2px solid"+_this.context.theming.colors.grays.gray03}else _this.addAttributesToDateTimeControls(typeString)}else _this.addAttributesToDateTimeControls(typeString)},100)},DateRangeFilterControl.prototype._createDateTimeControl=function(typeString,inputDate){var _this=this,components=[],labeltext=this.context.factory.createElement("LABEL",{id:"DateRangeFilter_CustomTimeFrame"+typeString+"Text",key:"DateRangeFilter_CustomTimeFrame"+typeString+"Text",style:{fontFamilies:this.context.theming.fontfamilies.regular,fonstSize:this.context.theming.fontsizes.font100,color:this.context.theming.colors.grays.gray05,paddingTop:this.context.theming.measures.measure050,paddingBottom:this.context.theming.measures.measure025}},typeString===DateRangeControl.DateRangeInput.StartDate?this._localizedStrings.DATERANGEFILTER_CUSTOMINPUT_STARTDATE:this._localizedStrings.DATERANGEFILTER_CUSTOMINPUT_ENDDATE);components.push(labeltext);var deviceSizeMode=this.context.parameters.DashboardColumns&&1===this.context.parameters.DashboardColumns.raw?1:this.context.parameters.DashboardColumns&&2===this.context.parameters.DashboardColumns.raw?2:0,properties={descriptor:{Id:"Dashboard_DateRangeFilter",Name:"Dashboard_DateRangeFilter",Label:"DateRangeControl_"+typeString,DomId:"DateRangeControl_"+typeString,Visible:!0,Disabled:!1,UniqueId:"DateRangeControl_"+typeString},parameters:{value:{Usage:3,Static:!0,Value:this._reverseCompensateTimeZoneForInputBehavior(inputDate),Callback:function(change){return _this._changeHandler(typeString,change)},Type:"DateAndTime.DateOnly",Attributes:{Format:"dateonly",Type:"datetime",Behavior:2}},deviceSizeMode:{Usage:1,Static:!0,Value:deviceSizeMode,Type:"Enum",Primary:!1},useFabricControl:{Usage:1,Static:!0,Value:this.context.utils.isFeatureEnabled("UseFabricDateTime"),Type:"TwoOptions",Primary:!1}},style:{padding:this.context.theming.measures.measure050,fontFamilies:this.context.theming.fontfamilies.regular,fonstSize:this.context.theming.fontsizes.font100,color:this.context.theming.colors.grays.gray07},controlstates:{width:"-1"}},dateComponent=this.context.factory.createComponent("MscrmControls.FieldControls.DateTimeControl","DateRangeControl_"+typeString,properties);return components.push(dateComponent),this.addAttributesToDateTimeControls(typeString),this.context.factory.createElement("CONTAINER",{
id:"DateRangeFilter_"+typeString+"Container",key:"DateRangeFilter_"+typeString+"Container",style:{flexDirection:"column",justifyContent:"space-between",marginBottom:typeString===DateRangeControl.DateRangeInput.StartDate?this.context.theming.measures.measure050:void 0}},components)},DateRangeFilterControl.prototype._reverseCompensateTimeZoneForInputBehavior=function(date){if(!date)return date;var currentTimeZoneOffsetMillisec=date.getTimezoneOffset()*MILLISECONDS_IN_MINUTE;return new Date(date.getTime()-currentTimeZoneOffsetMillisec)},DateRangeFilterControl.prototype._applyButtonClickHandler=function(_this){this._updateButtonText(DateRangeControl.DateRangeInput.CustomTimeFrame),this._updateDateConditionExpression(),this._notifyOutputChanged(DateRangeControl.DateRangeInput.CustomTimeFrame),_this._isCustomDatePaneOpen=!1,_this.context.utils.requestRender()},DateRangeFilterControl.prototype._closeButtonClickHandler=function(_this){_this._isCustomDatePaneOpen=!_this._isCustomDatePaneOpen,_this._valueFromStartDateControlInput=_this._valueFromStartDateControl,_this._valueFromEndDateControlInput=_this._valueFromEndDateControl,_this.context.utils.requestRender()},DateRangeFilterControl.prototype._backButtonClickHandler=function(_this){_this._isCustomDatePaneOpen=!_this._isCustomDatePaneOpen,_this._isOpen=!_this._isOpen,_this.context.utils.requestRender()},DateRangeFilterControl.prototype._updateDateConditionExpression=function(){this._dateConditionExpArr=DateRangeControl.DateRangeInput.GetDateConditionExpression(this._valueFromStartDateControlInput,this._valueFromEndDateControlInput,this._attributeName)},DateRangeFilterControl.prototype._createDateTimeControlHeader=function(_this){var labeltext=this.context.factory.createElement("LABEL",{id:"DateRangeFilter_CustomTimeFrameText",key:"DateRangeFilter_CustomTimeFrameText",style:{paddingRight:this.context.theming.measures.measure400}},this._localizedStrings.DATERANGEFILTER_CUSTOMTIMEFRAME_TEXT),headerIcon=this.context.factory.createElement("MICROSOFTICON",{id:"DateRangeFilter_CustomTimeFrameLeftIcon",key:"DateRangeFilter_CustomTimeFrameLeftIcon",title:this._localizedStrings.DATERANGE_FILTER_ACCESSIBILITY_CUSTOMTIMEFRAMEBACKICON,accessibilityLabel:this._localizedStrings.DATERANGE_FILTER_ACCESSIBILITY_CUSTOMTIMEFRAMEBACKICON,role:"button",tabIndex:0,style:{fontSize:"16px",color:this.context.theming.colors.grays.gray07,cursor:"pointer",":hover":{backgroundColor:this.context.theming.colors.grays.gray01}},type:2,onClick:function(){_this._backButtonClickHandler(_this),_this._setFocus(_this.context.accessibility.getUniqueId(_this._customTimeFrameID),_this.context.theming.colors.grays.gray03)},onKeyDown:function(event){13===event.keyCode||32===event.keyCode?(_this._backButtonClickHandler(_this),_this._setFocus(_this.context.accessibility.getUniqueId(_this._customTimeFrameID),_this.context.theming.colors.grays.gray03)):9===event.keyCode&&event.shiftKey&&(_this._setFocus(_this.context.accessibility.getUniqueId("DateRangeFilter_CustomTimeFrameCloseButton"),_this.context.theming.colors.grays.gray03),event.preventDefault())}});return _this.context.factory.createElement("CONTAINER",{id:"DateRangeFilter_CustomTimeFrameHeaderContainer",key:"DateRangeFilter_CustomTimeFrameHeaderContainer",accessibilityLabel:this._localizedStrings.DATERANGEFILTER_CUSTOMTIMEFRAME_TEXT,style:{flexDirection:"row",border:this.context.theming.borders.border02,padding:this.context.theming.measures.measure025,fontSize:this.context.theming.fontsizes.font100,fontFamilies:this.context.theming.fontfamilies.semibold,color:this.context.theming.colors.base.black,justifyContent:"space-between"}},[headerIcon,labeltext])},DateRangeFilterControl.prototype._createDateTimeControlFooter=function(_this){var components=[],applyTextStyle=this.context.theming.buttons.buttonprimarytext;applyTextStyle.cursor="pointer";var applyText=this.context.factory.createElement("LABEL",{id:"DateRangeFilter_CustomTimeFrameApplyText",key:"DateRangeFilter_CustomTimeFrameApplyText",style:applyTextStyle},this._localizedStrings.DATERANGEFILTER_CUSTOMTIMEFRAMEAPPLYBUTTON_TEXT),applyButtonStyle=this.context.theming.buttons.button01primary;applyButtonStyle.cursor="pointer";var applyButton=this.context.factory.createElement("BUTTON",{id:"DateRangeFilter_CustomTimeFrameApplyButton",key:"DateRangeFilter_CustomTimeFrameApplyButton",style:applyButtonStyle,onClick:function(){_this._isCustomTimeFrameApplyClicked=!0,_this._applyButtonClickHandler(_this),_this.optionsClickHandler()},title:this._localizedStrings.DATERANGEFILTER_ACCESSIBILITY_CUSTOMTIMEFRAMEAPPLYBUTTON,accessibilityLabel:this._localizedStrings.DATERANGEFILTER_ACCESSIBILITY_CUSTOMTIMEFRAMEAPPLYBUTTON,role:"button",tabIndex:0,onKeyDown:function(event){13!==event.keyCode&&32!==event.keyCode||(event.currentTarget.click(),event.preventDefault())},onFocus:function(event){_this._focusHandler(event)}},applyText),applyContainer=_this.context.factory.createElement("CONTAINER",{id:"ApplyContainer",key:"ApplyContainer",style:{paddingRight:this.context.theming.measures.measure050}},applyButton);components.push(applyContainer);var closeTextStyle=this.context.theming.buttons.buttonsecondarytext;closeTextStyle.cursor="pointer";var closeText=this.context.factory.createElement("LABEL",{id:"DateRangeFilter_CustomTimeFrameCloseText",key:"DateRangeFilter_CustomTimeFrameCloseText",style:closeTextStyle},this._localizedStrings.DATERANGEFILTER_CUSTOMTIMEFRAMECLOSEBUTTON_TEXT),closeButtonStyle=this.context.theming.buttons.button01secondary;closeButtonStyle.cursor="pointer";var closeButton=this.context.factory.createElement("BUTTON",{id:"DateRangeFilter_CustomTimeFrameCloseButton",key:"DateRangeFilter_CustomTimeFrameCloseButton",style:closeButtonStyle,onClick:function(){_this._isCustomTimeFrameApplyClicked&&(_this._isCustomTimeFrameApplyClicked=!1),_this._closeButtonClickHandler(_this),_this.optionsClickHandler()},title:this._localizedStrings.DATERANGEFILTER_ACCESSIBILITY_CUSTOMTIMEFRAMECLOSEBUTTON,accessibilityLabel:this._localizedStrings.DATERANGEFILTER_ACCESSIBILITY_CUSTOMTIMEFRAMECLOSEBUTTON,role:"button",tabIndex:0,onKeyDown:function(event){13===event.keyCode||32===event.keyCode?(event.currentTarget.click(),event.preventDefault()):9!==event.keyCode||event.shiftKey||(event.target.style.removeProperty("outline"),_this._setFocus(_this.context.accessibility.getUniqueId("DateRangeFilter_CustomTimeFrameLeftIcon"),""),event.preventDefault())},onFocus:function(event){_this._focusHandler(event)}},closeText),closeContainer=_this.context.factory.createElement("CONTAINER",{id:"CloseContainer",key:"CloseContainer"},closeButton);return components.push(closeContainer),_this.context.factory.createElement("CONTAINER",{id:"DateRangeFilter_CustomTimeFrameFooterContainer",key:"DateRangeFilter_CustomTimeFrameFooterContainer",style:{flexDirection:"row",minHeight:DateRangeFilterControl.ROW_HEIGHT+"px",paddingTop:this.context.theming.measures.measure100,paddingLeft:this.context.theming.measures.measure150,paddingRight:this.context.theming.measures.measure150,paddingBottom:this.context.theming.measures.measure150,justifyContent:"flex-end"}},components)},DateRangeFilterControl.prototype._parseInput=function(_this,label){if(label===DateRangeControl.DateRangeInput.CustomTimeFrame)_this._isOpen=!1,_this._toggleCustomDateSelector(_this);else{var startEndDateStruct=DateRangeControl.DateRangeInput.GenerateStartEndDateForTimeFrame(label);this._valueFromStartDateControlInput=startEndDateStruct[DateRangeControl.DateRangeInput.StartDate],this._valueFromEndDateControlInput=startEndDateStruct[DateRangeControl.DateRangeInput.EndDate],this._updateButtonText(label),this._updateDateConditionExpression(),this._toggleFlyout(this),this._notifyOutputChanged(label)}},DateRangeFilterControl.prototype._focusHandler=function(event){if(event&&event.target){var receive_focus_element=event.target;receive_focus_element.style.outline="2px dotted"}if(event&&event.relatedTarget){var lose_focus_element=event.relatedTarget;lose_focus_element.style.removeProperty("outline")}},DateRangeFilterControl.ROW_HEIGHT=30,DateRangeFilterControl.MARGIN=5,DateRangeFilterControl}();DateRangeControl.DateRangeFilterControl=DateRangeFilterControl}(DateRangeControl=MscrmControls.DateRangeControl||(MscrmControls.DateRangeControl={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var DateRangeControl;!function(DateRangeControl){var DateRangeFilterControlUtils=function(){function DateRangeFilterControlUtils(){}return DateRangeFilterControlUtils.getLocalizedStrings=function(context){return{DATERANGE_FILTER_ACCESSIBILITY_BUTTON:context.resources.getString("DateRange_Filter_Accessibility_Button"),DATERANGEFILTER_CUSTOMTIMEFRAME_TEXT:context.resources.getString("DateRangeFilter_CustomTimeFrame_Text"),DATERANGEFILTER_ACCESSIBILITY_CUSTOMTIMEFRAMEAPPLYBUTTON:context.resources.getString("DateRangeFilter_Accessibility_CustomTimeFrameApplyButton"),DATERANGEFILTER_CUSTOMTIMEFRAMEAPPLYBUTTON_TEXT:context.resources.getString("DateRangeFilter_CustomTimeFrameApplyButton_Text"),DATERANGEFILTER_CUSTOMTIMEFRAMECLOSEBUTTON_TEXT:context.resources.getString("DateRangeFilter_CustomTimeFrameCloseButton_Text"),DATERANGEFILTER_ACCESSIBILITY_CUSTOMTIMEFRAMECLOSEBUTTON:context.resources.getString("DateRangeFilter_Accessibility_CustomTimeFrameCloseButton"),DATERANGEFILTER_DATERANGEINPUT_TODAY:context.resources.getString("DateRangeFilter_DateRangeInput_Today"),DATERANGEFILTER_DATERANGEINPUT_YESTERDAY:context.resources.getString("DateRangeFilter_DateRangeInput_Yesterday"),DATERANGEFILTER_DATERANGEINPUT_THISWEEK:context.resources.getString("DateRangeFilter_DateRangeInput_ThisWeek"),DATERANGEFILTER_DATERANGEINPUT_LASTWEEK:context.resources.getString("DateRangeFilter_DateRangeInput_LastWeek"),DATERANGEFILTER_DATERANGEINPUT_THISMONTH:context.resources.getString("DateRangeFilter_DateRangeInput_ThisMonth"),DATERANGEFILTER_DATERANGEINPUT_LASTMONTH:context.resources.getString("DateRangeFilter_DateRangeInput_LastMonth"),DATERANGEFILTER_DATERANGEINPUT_MONTHTODATE:context.resources.getString("DateRangeFilter_DateRangeInput_MonthToDate"),DATERANGEFILTER_DATERANGEINPUT_THISQUARTER:context.resources.getString("DateRangeFilter_DateRangeInput_ThisQuarter"),DATERANGEFILTER_DATERANGEINPUT_LASTQUARTER:context.resources.getString("DateRangeFilter_DateRangeInput_LastQuarter"),DATERANGEFILTER_DATERANGEINPUT_CUSTOMTIMEFRAME:context.resources.getString("DateRangeFilter_DateRangeInput_CustomTimeFrame"),DATERANGEFILTER_CUSTOMINPUT_STARTDATE:context.resources.getString("DateRangeFilter_CustomInput_StartDate"),DATERANGEFILTER_CUSTOMINPUT_ENDDATE:context.resources.getString("DateRangeFilter_CustomInput_EndDate"),DATERANGE_FILTER_ACCESSIBILITY_CUSTOMTIMEFRAMEBACKICON:context.resources.getString("DateRange_Filter_Accessibility_CustomTimeFrame_BackIcon"),DATERANGEFILTER_BUTTON_FORMATTEDDATERANGETEXT:context.resources.getString("DateRangeFilter_Button_FormattedDateRangeText")}},DateRangeFilterControlUtils}();DateRangeControl.DateRangeFilterControlUtils=DateRangeFilterControlUtils}(DateRangeControl=MscrmControls.DateRangeControl||(MscrmControls.DateRangeControl={}))}(MscrmControls||(MscrmControls={}));
//# sourceMappingURL=d:\a\1\s\target\Release\amd64\package\Controls\\DateRangeFilterControl\DateRangeFilterControl.js.map