var MscrmControls;!function(MscrmControls){var KbContentControl;!function(KbContentControl){"use strict";var Constants=function(){function Constants(){}return Constants.ContentPaneArticleContentContainerPrefix="ContentPaneArticleContentContainer",Constants.ContentPaneTextResourceName="SearchWidget.AccessibilityText.ContentPaneText",Constants}();KbContentControl.Constants=Constants}(KbContentControl=MscrmControls.KbContentControl||(MscrmControls.KbContentControl={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var KbContentControl;!function(KbContentControl_1){"use strict";var KbContentControl=function(){function KbContentControl(){this.contentKey=""}return KbContentControl.prototype.init=function(context,notifyOutputChanged,state,container){this._context=context},KbContentControl.prototype.updateView=function(context){return this._context=context,this.render(!1)},KbContentControl.prototype.updateIframe=function(){var articleContentContainerKey=KbContentControl_1.Constants.ContentPaneArticleContentContainerPrefix+(this.isHostedInQuickform?this.contentKey:this._context.parameters.record.knowledgeArticleId),iFrameContainer=document.getElementById(this._context.accessibility.getUniqueId(articleContentContainerKey));if(iFrameContainer&&this._context.parameters.record){var iFrameNode=iFrameContainer.firstChild;iFrameNode.style.display="block";var frameDoc=iFrameNode.contentWindow.document,preparedArticleContent=this.isHostedInQuickform?this._context.parameters.quickview.raw:this._context.parameters.record.content||"";frameDoc.write(preparedArticleContent),frameDoc.body&&(frameDoc.body.className=" articleText",frameDoc.body.style.margin="0px",frameDoc.body.style.wordBreak="break-word");var iFrameElement=document.getElementById("articleContent");iFrameElement&&(iFrameElement.style.height="",iFrameElement.style.height="auto"),this.setAnchorTagBindings(!0,iFrameNode),MscrmCommon.KMPerformanceTelemetry.Instance.AddEndMarker(MscrmCommon.KMTelemetryConstants.WATERMARK_ACTION_OPEN_ARTICLE_TO_READ,this._context)}},KbContentControl.prototype.setAnchorTagBindings=function(setHandlers,iFrame){var _this=this,MESSAGE_HTML_ANCHOR_TAG_PROTOCOLS=["http:","https:"];if(iFrame)try{$(iFrame.contentWindow.document.body).find("A").each(function(index,element){var anchorElement=element,anchorBaseURIWithHash=anchorElement.baseURI+anchorElement.hash;if(anchorBaseURIWithHash!=anchorElement.href)for(var i=0;i<MESSAGE_HTML_ANCHOR_TAG_PROTOCOLS.length;i++)try{anchorElement.protocol==MESSAGE_HTML_ANCHOR_TAG_PROTOCOLS[i]&&(setHandlers?anchorElement.addEventListener("click",_this.anchorClicked.bind(_this)):anchorElement.removeEventListener("click",_this.anchorClicked.bind(_this)))}catch(e){}})}catch(e2){}},KbContentControl.prototype.anchorClicked=function(evt){for(var targetNode=evt.target;"A"!=targetNode.nodeName;){if(!targetNode.parentNode||"BODY"==targetNode.parentNode.nodeName)return;targetNode=targetNode.parentNode}var url=targetNode.href;url&&(this._context.utils.openInBrowser(url),evt.stopPropagation(),evt.preventDefault())},KbContentControl.prototype.renderArticleContent=function(){if(this.isHostedInQuickform=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this._context.parameters.quickview),this.isHostedInQuickform){var knowledgeIdField=this._context.parameters.record;this.contentKey=knowledgeIdField.raw.toString()}var selectedArticle=this.contentKey;this.isHostedInQuickform||(selectedArticle=this._context.parameters.record.knowledgeArticleId);var controlBlock=[];if(this.isHostedInQuickform&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this._context.parameters.quickview.raw)||!this.isHostedInQuickform&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(this._context.parameters.record.content)){var articleContentPrefix="articleContent",articleContentKey=articleContentPrefix+selectedArticle,articleContent=this._context.factory.createElement("IFRAME",{id:articleContentKey,key:articleContentKey,tabIndex:0,accessibilityLabel:this._context.resources.getString(KbContentControl_1.Constants.ContentPaneTextResourceName),style:{width:"100%",height:"auto",minHeight:"calc(100% - "+this._context.theming.measures.measure250+")",display:"none",marginTop:this._context.theming.measures.measure150,marginBottom:this._context.theming.measures.measure100},src:this._context.client.userAgent.isBrowserIE?"about:blank":"/nga/blank.htm",onLoad:this.updateIframe.bind(this)});controlBlock.push(articleContent)}var contentPaneArticleContentContainerKey=KbContentControl_1.Constants.ContentPaneArticleContentContainerPrefix+selectedArticle,contentDiv=this._context.factory.createElement("Container",{id:contentPaneArticleContentContainerKey,key:contentPaneArticleContentContainerKey,ref:"ContentPaneArticleContentContainerDiv",style:{flexGrow:1,overflowY:"auto","-webkit-overflow-scrolling":"touch !important",width:"100%"}},controlBlock);return contentDiv},KbContentControl.prototype.render=function(isPopupControl){return this.renderArticleContent()},KbContentControl.prototype.getOutputs=function(){return null},KbContentControl.prototype.destroy=function(){},KbContentControl}();KbContentControl_1.KbContentControl=KbContentControl}(KbContentControl=MscrmControls.KbContentControl||(MscrmControls.KbContentControl={}))}(MscrmControls||(MscrmControls={}));
//# sourceMappingURL=d:\a\1\s\target\Release\amd64\package\Controls\\KbContentControl\KbContentControl.js.map