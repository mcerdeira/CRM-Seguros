/** @license Copyright (c) Microsoft Corporation. All rights reserved. */
this.MscrmControls=this.MscrmControls||{},function(u,h,r){"use strict";var t;(t=u.ControlState||(u.ControlState={}))[t.SUCCESS=0]="SUCCESS",t[t.LOADING=1]="LOADING",t[t.ERROR=2]="ERROR",t[t.NO_DATA=3]="NO_DATA";var n,i,e,o=(s.Dismissed="Dismissed",s.RecordPicked="RecordPicked",s.AdvanceCommand="AdvanceCommand",s.ComponentMounted="ComponentMounted",s);function s(){}(i=n={})[i.SUCCESS=0]="SUCCESS",i[i.LOADING=1]="LOADING",i[i.ERROR=2]="ERROR",i[i.NO_DATA=3]="NO_DATA",(e=u.ThumbnailOption||(u.ThumbnailOption={}))[e.IMAGE=0]="IMAGE",e[e.INITIALS=1]="INITIALS",e[e.ICON_SYMBOL=2]="ICON_SYMBOL";var a=(c.ControlState=n,c.ThumbnailOption=u.ThumbnailOption,c);function c(){}var l,d,f="<span class='Highlight'>$1</span>",m="rp_advanced_button",v="rp_list",w="item0",p="RecordListRecordCell",y="RecordListFirstElement",C="RecordPickerLivePersonaCardHoverTarget",N=((T=window&&window.__extends||(l=function(t,n){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}l(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}))(g,d=h.Component),g.prototype.render=function(){return h.createElement("div",{className:"headContainer",role:"banner"},h.createElement("div",{className:"headLabelContainer"},this.props.headerLabelText?h.createElement("div",{className:"headText",role:"alert"},this.props.headerLabelText):this.props.controlState==u.ControlState.LOADING?h.createElement(r.Shimmer,{width:57,height:12}):null),h.createElement("div",{className:"headCommandContainer"},h.createElement(r.FontIcon,{iconName:"SearchData",className:"headCommandIcon"}),h.createElement("button",{className:"headCommand",onClick:this._onClick.bind(this),autoFocus:!1,id:m,onKeyDown:this.onAdvanceButtonKeyDownFn.bind(this)},this.props.headerCommandText)))},g.prototype._onClick=function(t){var n={Data:null,Type:o.AdvanceCommand};this.props.onUserAction(n),t.preventDefault()},g.prototype.onAdvanceButtonKeyDownFn=function(t){var n,i;9!=t.keyCode||!t.shiftKey&&document.getElementById(v)?9!=t.keyCode||!document.getElementById(v)||(n=document.getElementById(w))&&(n.focus(),t.preventDefault()):(i=document.querySelector(this.props.targetQuerySelector))&&(i.focus(),t.preventDefault())},g);function g(t){var n=d.call(this,t)||this;return n.state={},n._onClick=n._onClick.bind(n),n}var b,R,E=((T=window&&window.__extends||(b=function(t,n){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}b(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}))(_,R=h.Component),_.prototype.render=function(){return h.createElement("div",{role:"alert",className:"errorMessage"},h.createElement("div",{className:"errorMessageText"},this.props.errorMessage))},_);function _(){return null!==R&&R.apply(this,arguments)||this}var O,A,T=window&&window.__extends||(O=function(t,n){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}O(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),S={childrenGap:28},I=(T(D,A=h.Component),D.prototype.render=function(){return h.createElement("div",{className:"Shimmer"},h.createElement(r.Stack,{tokens:S},h.createElement(r.Shimmer,{customElementsGroup:this._getCustomElements(),width:330}),h.createElement(r.Shimmer,{customElementsGroup:this._getCustomElements(),width:330}),h.createElement(r.Shimmer,{customElementsGroup:this._getCustomElements(),width:330}),h.createElement(r.Shimmer,{customElementsGroup:this._getCustomElements(),width:330}),h.createElement(r.Shimmer,{customElementsGroup:this._getCustomElements(),width:330})))},D);function D(t){var n=A.call(this,t)||this;return n._getCustomElements=function(){return h.createElement("div",{style:{display:"flex"}},h.createElement(r.ShimmerElementsGroup,{shimmerElements:[{type:r.ShimmerElementType.circle,height:n.height},{type:r.ShimmerElementType.gap,height:n.height,width:14.24}]}),h.createElement(r.ShimmerElementsGroup,{flexWrap:!0,shimmerElements:[{type:r.ShimmerElementType.line,width:110,height:10},{type:r.ShimmerElementType.gap,width:180,height:14},{type:r.ShimmerElementType.line,width:290,height:10}]}))},n.height=28,n}var k,x,P=((T=window&&window.__extends||(k=function(t,n){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}k(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}))(L,x=h.Component),L.prototype.render=function(){return h.createElement("div",{role:"alert",className:"noData"},h.createElement("span",{className:"messageText"},this.props.message))},L);function L(){return null!==x&&x.apply(this,arguments)||this}var j=(M.GetInitials=function(t){var n="";if(t){for(var i=t.split(" "),e=0;e<i.length&&n.length<2;e++)if(0<i[e].length){var r=i[e].charCodeAt(0);if(!(97<=r&&r<=122||65<=r&&r<=90)){n+=i[e].charAt(0);break}n+=i[e].charAt(0)}if(n.length<=1){n="";for(var o=0;o<t.length&&n.length<2;o++){var s=t.charCodeAt(o);if(!(97<=s&&s<=122||65<=s&&s<=90)){n+=t.charAt(o);break}n+=t.charAt(o)}}}return n},M.GetBackGroundColor=function(t){var n=["#005C62","#358717","#725A0D","#A42B1A","#652F4E","#6A1E7A","#315FA2"],i=n[0];if(t){for(var e=0,r=t.length-1;0<=r;r--){var o=t.charCodeAt(r),s=r%8;e^=(o<<s)+(o>>8-s)}i=n[e%n.length]}return i},M);function M(){}var U,G,F=((T=window&&window.__extends||(U=function(t,n){return(U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}U(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}))(H,G=h.Component),H.prototype.render=function(){return this._getInnerComponent()},H.prototype._getInnerComponent=function(){switch(this.props.record.thumbnailOption){case u.ThumbnailOption.IMAGE:return h.createElement("div",{className:"UserImageThumbnail","aria-hidden":!0},h.createElement(r.Image,{className:"RecordThumbnailImage",src:this.props.record.imgSrc,width:28,height:28,imageFit:r.ImageFit.cover,alt:j.GetInitials(this.props.record.reference.name.toUpperCase())}));case u.ThumbnailOption.INITIALS:return h.createElement("div",{className:"RecordInitialThumbnail","aria-hidden":!0},h.createElement("div",{className:"RecordInitialThumbnailCircle",style:{background:j.GetBackGroundColor(this.props.record.reference.name)}},j.GetInitials(this.props.record.reference.name).toUpperCase()));case u.ThumbnailOption.ICON_SYMBOL:return h.createElement("div",{className:"CRMEntityThumbnail","aria-hidden":!0},h.createElement("span",{className:this.props.record.iconSymbol}));default:return null}},H);function H(t){var n=G.call(this,t)||this;return n._getInnerComponent=n._getInnerComponent.bind(n),n}var K=(Q.ReportFailure=function(t,n,i){var e=new Array;e.push({name:"FunctionName",value:t}),i&&e.concat(i),Q.context.reporting.reportFailure(this.controlName,n,"",e)},Q.getErrorTelemetryParmas=function(t){var n=new Array;return t&&n.push({name:"Message",value:JSON.stringify(t)}),n},Q.controlName="RecordPickerControl",Q);function Q(){}var B,J,V=((T=window&&window.__extends||(B=function(t,n){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}B(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}))(z,J=h.Component),z.prototype.render=function(){return h.createElement(r.FocusZone,{direction:r.FocusZoneDirection.vertical},h.createElement(r.List,{items:this.props.records,onRenderCell:this._onRenderCell,onKeyDown:this.onRecordPickerKeyDownFn.bind(this),role:"tree",id:v}))},z.prototype._onRenderCell=function(o,s){var a=this,t=new RegExp("^("+this.props.currentSearchString+")[]*","igm"),n={firstName:"",lastName:"",email:"",description:""};"systemuser"==o.reference.entityType?(n.firstName=o.reference.firstName,n.lastName=o.reference.lastName,n.email=o.reference.email):n.description=o.reference.name+(o.description?"\n"+o.description:"");var c=this._context.factory;return h.createElement("div",{className:0==s?y:p,"data-is-focusable":!0,tabIndex:s,id:"item"+s,role:"treeitem",onClick:function(){a._itemClicked(o)},onKeyDown:this.onRecordPickerKeyDownFn.bind(this)},h.createElement(function(){if(!a.isLPCEnabled()||o.thumbnailOption==u.ThumbnailOption.ICON_SYMBOL)return h.createElement("span",null);var t=h.createRef(),n={Id:o.reference.id,LogicalName:"systemuser",Name:o.reference.name,EntityName:"systemuser"},i={id:"recordpicker-lpc"+s,role:"dialog",tabIndex:-1,displayName:o.reference.name,entityReference:n,personaType:"User",recordId:o.reference.id,onKeyDownContainerId:C+s,registerOpenCardCallback:function(t){this._onKeyDownOpenLivePersonaCardByIndex[s]=t}.bind(a),style:{height:"60px",display:"inline-block",width:"55px",position:"absolute",overflow:"hidden"}},e=a._context.factory.createElement("CONTAINER",{id:C+s}),r=a._context.factory.createElement("LIVEPERSONACARDHOVERTARGET",i,e);return h.useEffect(function(){c.bindDOMComponent(r,t.current),document.getElementById("item"+s).addEventListener("click",function(){a._itemClicked(o)})},[a._context,t.current]),h.createElement("div",{ref:t,tabIndex:-1,style:{position:"relative"}})},null),h.createElement("div",{className:o.thumbnailOption==u.ThumbnailOption.ICON_SYMBOL?"CRMEntityContainer":"SystemUserContainer"},h.createElement(F,{record:o}),h.createElement("div",{className:o.thumbnailOption==u.ThumbnailOption.ICON_SYMBOL?"CRMEntity":"SystemUser"},h.createElement("div",{className:"Truncate",dangerouslySetInnerHTML:this._setCellHTML(n,t)}))))},z.prototype._setCellHTML=function(t,n){var i="";return t.firstName?(i+=t.firstName.replace(n,f),i+=" "+t.lastName.replace(n,f),i+="\n"+t.email.replace(n,f)):i=this.props.currentSearchString&&0<this.props.currentSearchString.trim().length?t.description.replace(n,f):t.description,{__html:i}},z.prototype._itemClicked=function(t){var n={Data:t.reference,Type:o.RecordPicked};this.props.onUserAction(n)},z.prototype.onRecordPickerKeyDownFn=function(t){t.preventDefault();var n,i,e,r,o,s,a,c=Number(t.target.id.replace("item",""));t.shiftKey&&9==t.keyCode?(n=document.getElementById(m))&&(n.focus(),this.highlightFirstElementOfList(),t.preventDefault()):9==t.keyCode||38==t.keyCode&&t.target.id==w?(i=document.querySelector(this.props.targetQuerySelector))&&(i.focus(),this.highlightFirstElementOfList(),t.preventDefault()):40==t.keyCode&&-1<t.target.id.indexOf("item")?(0==c&&((e=document.getElementById("item"+c)).classList.remove(p),e.className=p),r=c+1,(o=document.getElementById("item"+r)).focus(),o.className=p):38==t.keyCode&&-1<t.target.id.indexOf("item")?(s=c-1,(a=document.getElementById("item"+s)).focus(),a.className=p):32==t.keyCode?this._onKeyDownOpenLivePersonaCardByIndex[c]&&this._onKeyDownOpenLivePersonaCardByIndex[c]():13==t.keyCode&&this._itemClicked(this.props.records[c])},z.prototype.componentDidMount=function(){var t,n;this.props&&this.props.records&&0<this.props.records.length?(t={Data:this.props.records[0].reference,Type:o.ComponentMounted},this.props.onUserAction(t)):(n={Data:null,Type:o.Dismissed},this.props.onUserAction(n),K.ReportFailure("componentDidMount",Error("RecordList props or props.records is null")))},z.prototype.highlightFirstElementOfList=function(){var t=document.getElementById(w);t&&(t.className=y)},z.prototype.isLPCEnabled=function(){return this._context.utils.isFeatureEnabled("TimelineWallRichTextPosts")&&this._context.utils.isFeatureEnabled("LivePersonaCardUCI")&&this._context.utils.isFeatureEnabled("April2021Update")&&this._context.utils.isFeatureEnabled("RecordPickerLPCEnabled")},z);function z(t){var n=J.call(this,t)||this;return n._context=t.context,n._onRenderCell=n._onRenderCell.bind(n),n._itemClicked=n._itemClicked.bind(n),n._onKeyDownOpenLivePersonaCardByIndex={},n}var W,Y,$=((T=window&&window.__extends||(W=function(t,n){return(W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)},function(t,n){function i(){this.constructor=t}W(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}))(q,Y=h.Component),q.prototype.componentDidMount=function(){var t={Data:null,Type:o.ComponentMounted};this.props.onUserAction(t)},q.prototype.componentDidCatch=function(t){K.ReportFailure("componentDidCatch",Error(t.message?t.message:"RecordPickerCallout error occurred"),K.getErrorTelemetryParmas(t)),this.setState({hasError:!0})},q.prototype.render=function(){var n=this;if(this.state.hasError)return h.createElement("p",{style:{color:"#666666",width:this.width,fontSize:"12px"}},"Error loading control");this.width=4<=window.devicePixelRatio?254:350;var i=document.querySelector(".RecordPickerCallout"),e=document.getElementById("LivePersonaCardRootElement");return document.body.addEventListener("click",function(t){(i.contains(t.target)||e)&&(i.contains(t.target)||e.contains(t.target))||n._onCalloutDismiss()}),h.createElement(r.Callout,{gapSpace:5,target:this.props.targetQuerySelector,onDismiss:this._onCalloutDismiss,isBeakVisible:!1,setInitialFocus:!1,coverTarget:!1,alignTargetEdge:!0,hideOverflow:!0,preventDismissOnResize:!0,preventDismissOnLostFocus:!0,directionalHint:r.DirectionalHint.bottomLeftEdge},h.createElement("div",{className:"RecordPickerCallout",style:{width:this.width}},h.createElement(N,{controlState:this.props.controlState,headerLabelText:this.props.headerLabelText,headerCommandText:this.props.headerCommandText,onUserAction:this.props.onUserAction,targetQuerySelector:this.props.targetQuerySelector}),h.createElement("div",{className:"RecordPicker",tabIndex:-1},this._getInnerComponent())))},q.prototype._getInnerComponent=function(){switch(this.props.controlState){case u.ControlState.LOADING:return h.createElement(I,null);case u.ControlState.NO_DATA:return h.createElement(P,{message:this.props.message});case u.ControlState.ERROR:return h.createElement(E,{errorMessage:this.props.message});case u.ControlState.SUCCESS:return h.createElement(V,{context:this.props.context,records:this.props.records,onUserAction:this.props.onUserAction,currentSearchString:this.props.currentSearchString,targetQuerySelector:this.props.targetQuerySelector});default:return null}},q.prototype._onCalloutDismiss=function(){var t={Data:null,Type:o.Dismissed};this.props.onUserAction(t)},q);function q(t){var n=Y.call(this,t)||this;return n.state={hasError:!1},n._onCalloutDismiss=n._onCalloutDismiss.bind(n),n._getInnerComponent=n._getInnerComponent.bind(n),n}var X=(Z.prototype.init=function(t,n,i){K.context=t,this._output=null,this._input=null,this._notifyOutputChanged=n,this._parseInputParam(t)},Z.prototype.updateView=function(t){return K.context=t,this._parseInputParam(t),this.renderRecordPickerControl(t)},Z.prototype.renderRecordPickerControl=function(t){var n=this,i={context:t,controlState:this._input.Config.controlState,headerLabelText:this._input.Config.headerLabelText,headerCommandText:this._input.Config.headerCommandText,message:this._input.Config.message,targetQuerySelector:this._input.Config.targetQuerySelector,records:this._input.Records,currentSearchString:this._input.Config.currentSearchString,onUserAction:function(t){n._output={Output:t},n._notifyOutputChanged()}},e=h.createElement($,i,{});return t.factory.createElement("CONTAINER",{recordPickerProps:{id:"RecordPickerControlContainer"}},e)},Z.prototype.getOutputs=function(){return this._output},Z.prototype.destroy=function(){},Z.prototype._parseInputParam=function(t){if(!t.parameters.Config||!t.parameters.Config.raw)throw new Error("Invalid parameters.Config");var n=JSON.parse(t.parameters.Config.raw);if(!n.targetQuerySelector)throw new Error("Invalid configParams.targetQuerySelector");if(null==n.controlState)throw new Error("Invalid configParams.controlState");n.message||(n.message="");var i=JSON.parse(t.parameters.Records.raw)||[];this._input={Records:i,Config:n}},Z);function Z(){}u.Models=a,u.RecordPickerControl=X,u.UserAction=o}(this.MscrmControls.RecordPicker=this.MscrmControls.RecordPicker||{},React,Fabric);
