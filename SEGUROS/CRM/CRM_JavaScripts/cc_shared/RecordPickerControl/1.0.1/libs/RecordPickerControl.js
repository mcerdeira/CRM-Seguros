var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var Models;!function(Models){var ThumbnailOption;!function(ThumbnailOption){ThumbnailOption[ThumbnailOption.IMAGE=0]="IMAGE",ThumbnailOption[ThumbnailOption.INITIALS=1]="INITIALS",ThumbnailOption[ThumbnailOption.ICON_SYMBOL=2]="ICON_SYMBOL"}(ThumbnailOption=Models.ThumbnailOption||(Models.ThumbnailOption={}))}(Models=RecordPicker.Models||(RecordPicker.Models={}))}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var Models;!function(Models){var UserAction=function(){function UserAction(){}return UserAction.Dismissed="Dismissed",UserAction.RecordPicked="RecordPicked",UserAction.AdvanceCommand="AdvanceCommand",UserAction.ComponentMounted="ComponentMounted",UserAction}();Models.UserAction=UserAction}(Models=RecordPicker.Models||(RecordPicker.Models={}))}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPickerConstants;!function(RecordPickerConstants){RecordPickerConstants.HighlightStyle="<span class='Highlight'>$1</span>",RecordPickerConstants.RecordPickerAdvanceButtonID="rp_advanced_button",RecordPickerConstants.TabKeyCode=9,RecordPickerConstants.RecordPickerCalloutWidth=350}(RecordPickerConstants=MscrmControls.RecordPickerConstants||(MscrmControls.RecordPickerConstants={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var RecordPickerCallout=function(_super){function RecordPickerCallout(props){var _this=_super.call(this,props)||this;return _this.state={},_this._onCalloutDismiss=_this._onCalloutDismiss.bind(_this),_this._getInnerComponent=_this._getInnerComponent.bind(_this),_this.width=_this._getWidth(),_this}return __extends(RecordPickerCallout,_super),RecordPickerCallout.prototype.componentDidMount=function(){var event={Data:null,Type:RecordPicker.Models.UserAction.ComponentMounted};this.props.onUserAction(event)},RecordPickerCallout.prototype.render=function(){return React.createElement(Fabric.Callout,{role:"alertdialog",gapSpace:0,target:this.props.targetQuerySelector,onDismiss:this._onCalloutDismiss,isBeakVisible:!1,setInitialFocus:!0,coverTarget:!1,alignTargetEdge:!0,directionalHint:Fabric.DirectionalHint.bottomLeftEdge},React.createElement("div",{className:"RecordPickerCallout",style:{width:this.width}},React.createElement(RecordPicker.CallOutHeader,{controlState:this.props.controlState,headerLabelText:this.props.headerLabelText,headerCommandText:this.props.headerCommandText,onUserAction:this.props.onUserAction,targetQuerySelector:this.props.targetQuerySelector}),React.createElement("div",{className:"RecordPicker"}," ",this._getInnerComponent()," ")))},RecordPickerCallout.prototype._getInnerComponent=function(){switch(this.props.controlState){case RecordPicker.Models.ControlState.LOADING:return React.createElement(RecordPicker.LoadingShimmerFabric,null);case RecordPicker.Models.ControlState.NO_DATA:return React.createElement(RecordPicker.NoDataMessageFabric,{message:this.props.message,onKeyDownFn:this.onMessageDivKeyDownFn.bind(this)});case RecordPicker.Models.ControlState.ERROR:return React.createElement(RecordPicker.ErrorMessageFabric,{errorMessage:this.props.message,onKeyDownFn:this.onMessageDivKeyDownFn.bind(this)});case RecordPicker.Models.ControlState.SUCCESS:return React.createElement(RecordPicker.RecordList,{records:this.props.records,onUserAction:this.props.onUserAction,currentSearchString:this.props.currentSearchString,targetQuerySelector:this.props.targetQuerySelector,headerLabelText:this.props.headerLabelText});default:return null}},RecordPickerCallout.prototype._onCalloutDismiss=function(){var event={Data:null,Type:RecordPicker.Models.UserAction.Dismissed};this.props.onUserAction(event)},RecordPickerCallout.prototype._getWidth=function(){return MscrmControls.RecordPickerConstants.RecordPickerCalloutWidth},RecordPickerCallout.prototype.onMessageDivKeyDownFn=function(event){if(!event.shiftKey&&event.keyCode==MscrmControls.RecordPickerConstants.TabKeyCode){var targetQuerySelector=document.querySelector(this.props.targetQuerySelector);return void(targetQuerySelector&&(targetQuerySelector.focus(),event.preventDefault()))}},RecordPickerCallout}(React.Component);RecordPicker.RecordPickerCallout=RecordPickerCallout}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var RecordList=function(_super){function RecordList(props){var _this=_super.call(this,props)||this;return _this._onRenderCell=_this._onRenderCell.bind(_this),_this._itemClicked=_this._itemClicked.bind(_this),_this}return __extends(RecordList,_super),RecordList.prototype.render=function(){return React.createElement(Fabric.FocusZone,{direction:Fabric.FocusZoneDirection.vertical},React.createElement(Fabric.List,{items:this.props.records,onRenderCell:this._onRenderCell,onKeyDown:this.onRecordPickerKeyDownFn.bind(this),"aria-label":this.props.headerLabelText}))},RecordList.prototype._onRenderCell=function(item,index,isScrolling){var _this=this,highlightRegex=new RegExp("^("+this.props.currentSearchString+")[]*","igm"),cellContenet=item.reference.name+(item.description?"\n"+item.description:"");return React.createElement("div",{className:"RecordListRecordCell","data-is-focusable":!0,title:cellContenet,onClick:function(){_this._itemClicked(item)}},React.createElement(RecordPicker.RecordThumbnail,{record:item}),React.createElement("div",{className:item.thumbnailOption==RecordPicker.Models.ThumbnailOption.ICON_SYMBOL?"CRMEntity":"SystemUser"},React.createElement("div",{className:"Truncate",dangerouslySetInnerHTML:{__html:this.props.currentSearchString&&this.props.currentSearchString.trim().length>0?cellContenet.replace(highlightRegex,MscrmControls.RecordPickerConstants.HighlightStyle):cellContenet}})))},RecordList.prototype._itemClicked=function(item){var event={Data:item.reference,Type:RecordPicker.Models.UserAction.RecordPicked};this.props.onUserAction(event)},RecordList.prototype.onRecordPickerKeyDownFn=function(event){if(event.shiftKey&&event.keyCode==MscrmControls.RecordPickerConstants.TabKeyCode){var btnAdvance=document.getElementById(MscrmControls.RecordPickerConstants.RecordPickerAdvanceButtonID);btnAdvance&&(btnAdvance.focus(),event.preventDefault())}else if(event.keyCode==MscrmControls.RecordPickerConstants.TabKeyCode){var targetQuerySelector=document.querySelector(this.props.targetQuerySelector);targetQuerySelector&&(targetQuerySelector.focus(),event.preventDefault())}},RecordList}(React.Component);RecordPicker.RecordList=RecordList}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var RecordThumbnail=function(_super){function RecordThumbnail(props){var _this=_super.call(this,props)||this;return _this._getInnerComponent=_this._getInnerComponent.bind(_this),_this}return __extends(RecordThumbnail,_super),RecordThumbnail.prototype.render=function(){return this._getInnerComponent()},RecordThumbnail.prototype._getInnerComponent=function(){switch(this.props.record.thumbnailOption){case RecordPicker.Models.ThumbnailOption.IMAGE:return React.createElement("div",{className:"UserImageThumbnail","aria-hidden":!0},React.createElement(Fabric.Image,{className:"RecordThumbnailImage",src:this.props.record.imgSrc,width:28,height:28,imageFit:Fabric.ImageFit.cover,alt:RecordPicker.Utils.RecordInitialsUtils.GetInitials(this.props.record.reference.name.toUpperCase())}));case RecordPicker.Models.ThumbnailOption.INITIALS:return React.createElement("div",{className:"RecordInitialThumbnail","aria-hidden":!0},React.createElement("div",{className:"RecordInitialThumbnailCircle",style:{background:RecordPicker.Utils.RecordInitialsUtils.GetBackGroundColor(this.props.record.reference.name)}},RecordPicker.Utils.RecordInitialsUtils.GetInitials(this.props.record.reference.name).toUpperCase()));case RecordPicker.Models.ThumbnailOption.ICON_SYMBOL:return React.createElement("div",{className:"CRMEntityThumbnail","aria-hidden":!0},React.createElement("span",{className:this.props.record.iconSymbol}));default:return null}},RecordThumbnail}(React.Component);RecordPicker.RecordThumbnail=RecordThumbnail}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){"use strict";var RecordPickerControl=function(){function RecordPickerControl(){}return RecordPickerControl.prototype.init=function(context,notifyOutputChanged,state){this._output=null,this._input=null,this._notifyOutputChanged=notifyOutputChanged,this._parseInputParam(context)},RecordPickerControl.prototype.updateView=function(context){return this._parseInputParam(context),this.renderRecordPickerControl(context)},RecordPickerControl.prototype.renderRecordPickerControl=function(context){var _this=this,recordPickerCalloutProp={controlState:this._input.Config.controlState,headerLabelText:this._input.Config.headerLabelText,headerCommandText:this._input.Config.headerCommandText,message:this._input.Config.message,targetQuerySelector:this._input.Config.targetQuerySelector,records:this._input.Records,currentSearchString:this._input.Config.currentSearchString,onUserAction:function(event){_this._output={Output:event},_this._notifyOutputChanged()}},recordPickerFabricElement=React.createElement(RecordPicker.RecordPickerCallout,recordPickerCalloutProp,{}),recordPickerProps={id:"RecordPickerControlContainer"};return context.factory.createElement("CONTAINER",{recordPickerProps:recordPickerProps},recordPickerFabricElement)},RecordPickerControl.prototype.getOutputs=function(){return this._output},RecordPickerControl.prototype.destroy=function(){},RecordPickerControl.prototype._parseInputParam=function(context){if(!context.parameters.Config||!context.parameters.Config.raw||!context.parameters.Config.raw)throw new Error("Invalid parameters.Config");var configParams=JSON.parse(context.parameters.Config.raw);if(!configParams.targetQuerySelector)throw new Error("Invalid configParams.targetQuerySelector");if(null==configParams.controlState)throw new Error("Invalid configParams.controlState");configParams.message||(configParams.message="");var records=JSON.parse(context.parameters.Records.raw);records||(records=[]),this._input={Records:records,Config:configParams}},RecordPickerControl}();RecordPicker.RecordPickerControl=RecordPickerControl}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var Utils;!function(Utils){var RecordInitialsUtils=function(){function RecordInitialsUtils(){}return RecordInitialsUtils.GetInitials=function(fullName){var initials="";if(fullName){for(var nameParts=fullName.split(" "),i=0;i<nameParts.length&&initials.length<2;i++)if(nameParts[i].length>0){var chr=nameParts[i].charCodeAt(0);if(!(chr>=97&&122>=chr||chr>=65&&90>=chr)){initials+=nameParts[i].charAt(0);break}initials+=nameParts[i].charAt(0)}if(initials.length<=1){initials="";for(var j=0;j<fullName.length&&initials.length<2;j++){var char=fullName.charCodeAt(j);if(!(char>=97&&122>=char||char>=65&&90>=char)){initials+=fullName.charAt(j);break}initials+=fullName.charAt(j)}}}return initials},RecordInitialsUtils.GetBackGroundColor=function(fullName){var allBackgroundColors=["#005C62","#358717","#725A0D","#A42B1A","#652F4E","#6A1E7A","#315FA2"],backgroundColor=allBackgroundColors[0];if(fullName){for(var s=0,k=fullName.length-1;k>=0;k--){var o=fullName.charCodeAt(k),e=k%8;s^=(o<<e)+(o>>8-e)}backgroundColor=allBackgroundColors[s%allBackgroundColors.length]}return backgroundColor},RecordInitialsUtils}();Utils.RecordInitialsUtils=RecordInitialsUtils}(Utils=RecordPicker.Utils||(RecordPicker.Utils={}))}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var CallOutHeader=function(_super){function CallOutHeader(props){var _this=_super.call(this,props)||this;return _this.state={},_this._onClick=_this._onClick.bind(_this),_this}return __extends(CallOutHeader,_super),CallOutHeader.prototype.render=function(){return React.createElement("div",{className:"headContainer"},React.createElement("div",{className:"headLabelContainer"},this.props.headerLabelText?React.createElement("span",{className:"headText"},this.props.headerLabelText):this.props.controlState==RecordPicker.Models.ControlState.LOADING?React.createElement(Fabric.Shimmer,{width:57,height:12}):null),React.createElement("div",{className:"headCommandContainer"},React.createElement(Fabric.Link,{className:"headCommand",onClick:this._onClick,autoFocus:!1,id:MscrmControls.RecordPickerConstants.RecordPickerAdvanceButtonID,onKeyDown:this.onAdvanceButtonKeyDownFn.bind(this)},this.props.headerCommandText)))},CallOutHeader.prototype._onClick=function(){var event={Data:null,Type:RecordPicker.Models.UserAction.AdvanceCommand};this.props.onUserAction(event)},CallOutHeader.prototype.onAdvanceButtonKeyDownFn=function(event){if(event.shiftKey&&event.keyCode==MscrmControls.RecordPickerConstants.TabKeyCode){var targetQuerySelector=document.querySelector(this.props.targetQuerySelector);targetQuerySelector&&(targetQuerySelector.focus(),event.preventDefault())}},CallOutHeader}(React.Component);RecordPicker.CallOutHeader=CallOutHeader}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var ErrorMessageFabric=function(_super){function ErrorMessageFabric(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ErrorMessageFabric,_super),ErrorMessageFabric.prototype.render=function(){return React.createElement("div",{title:this.props.errorMessage,className:"errorMessage",tabIndex:0,"aria-label":this.props.errorMessage,onKeyDown:this.props.onKeyDownFn.bind(this)},React.createElement(Fabric.FontIcon,{iconName:"ErrorBadge",className:"errorIcon"}),React.createElement("div",{className:"errorMessageText"},this.props.errorMessage))},ErrorMessageFabric}(React.Component);RecordPicker.ErrorMessageFabric=ErrorMessageFabric}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var LoadingShimmerFabric=function(_super){function LoadingShimmerFabric(props){var _this=_super.call(this,props)||this;return _this._getCustomElements=function(){return React.createElement("div",{style:{display:"flex"}},React.createElement(Fabric.ShimmerElementsGroup,{shimmerElements:[{type:Fabric.ShimmerElementType.circle,height:_this.height},{type:Fabric.ShimmerElementType.gap,width:10,height:_this.height}]}),React.createElement(Fabric.ShimmerElementsGroup,{flexWrap:!0,shimmerElements:[{type:Fabric.ShimmerElementType.line,width:300,height:10},{type:Fabric.ShimmerElementType.line,width:200,height:10},{type:Fabric.ShimmerElementType.gap,width:100,height:20}]}))},_this.height=40,_this}return __extends(LoadingShimmerFabric,_super),LoadingShimmerFabric.prototype.render=function(){return React.createElement("div",{className:"Shimmer"},React.createElement(Fabric.Shimmer,{customElementsGroup:this._getCustomElements(),width:350}),React.createElement(Fabric.Shimmer,{customElementsGroup:this._getCustomElements(),width:350}))},LoadingShimmerFabric}(React.Component);RecordPicker.LoadingShimmerFabric=LoadingShimmerFabric}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var NoDataMessageFabric=function(_super){function NoDataMessageFabric(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(NoDataMessageFabric,_super),NoDataMessageFabric.prototype.render=function(){return React.createElement("div",{title:this.props.message,className:"noData",tabIndex:0,"aria-label":this.props.message,onKeyDown:this.props.onKeyDownFn.bind(this)},React.createElement("span",{className:"messageText"},this.props.message))},NoDataMessageFabric}(React.Component);RecordPicker.NoDataMessageFabric=NoDataMessageFabric}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));var MscrmControls;!function(MscrmControls){var RecordPicker;!function(RecordPicker){var Models;!function(Models){var ControlState;!function(ControlState){ControlState[ControlState.SUCCESS=0]="SUCCESS",ControlState[ControlState.LOADING=1]="LOADING",ControlState[ControlState.ERROR=2]="ERROR",ControlState[ControlState.NO_DATA=3]="NO_DATA"}(ControlState=Models.ControlState||(Models.ControlState={}))}(Models=RecordPicker.Models||(RecordPicker.Models={}))}(RecordPicker=MscrmControls.RecordPicker||(MscrmControls.RecordPicker={}))}(MscrmControls||(MscrmControls={}));
//# sourceMappingURL=d:\a\1\s\target\Release\amd64\package\Controls\\RecordPickerControl\RecordPickerControl.js.map