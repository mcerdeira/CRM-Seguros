var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}(),MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var Constants=function(){function Constants(){}Constants.SEARCH_RESULT_ITEM_HEIGHT=255;Constants.LOAD_MORE_HEIGHT=36;Constants.OBJECT_TYPE_CODE_KNOWLEDGE_ARTICLE=9953;Constants.OBJECT_TYPE_CODE_ANNOTATION=5;Constants.ON_RESULT_OPENED="onresultopened";Constants.ON_SELECTION="onselection";Constants.ON_POST_SEARCH="onpostsearch";Constants.SELECTEDRESULT="SelectedResult";Constants.SearchEntityNameFacet="@search.entityname";Constants.MDFSearchEventName="MDFSearchEvent";Constants.MandatoryFieldKbLink="https://docs.microsoft.com/en-us/dynamics365/customer-engagement/customer-service/search-knowledge-articles-csh#before-you-begin-using-relevance-search";Constants.NumberOfResultsFoundResourceName="SearchWidget.SearchKMArticles.NumberOfResultsFoundText";Constants.TextAnalyticsResourceName="SearchWidget.Filters.TextAnalyticsText";Constants.FilterOpenTitleResourceName="SearchWidget.Filters.FilterOpenTitleText";Constants.FilterCloseTitleResourceName="SearchWidget.Filters.FilterCloseTitleText";Constants.FilterOpenAltTextResourceName="SearchWidget.Filters.FilterOpenAltText";Constants.FilterCloseAltTextResourceName="SearchWidget.Filters.FilterCloseAltText";Constants.userDefaultLanguageLocaleId="00000000-0000-0000-0000-000000000000";Constants.AutoSuggestionSourceFormField="0";Constants.AutoSuggestionSourceAnalyticsService="1";Constants.SortFilterTitleResourceName="SearchWidget.Filters.SortFilterTitleText";Constants.AutoSuggestionTitleResourceName="SearchWidget.SearchBox.AutoSuggestionTitleText";Constants.AutoSuggestionAltTextResourceName="SearchWidget.SearchBox.AutoSuggestionAltText";Constants.SearchBoxPlaceholderResourceName="SearchWidget.SearchBox.Placeholder";Constants.SearchIconAltTextResourceName="SearchWidget.SearchBox.SearchIconAltText";Constants.RemoveIconAltTextResourceName="SearchWidget.SearchBox.RemoveIconAltText";Constants.SearchBoxAriaLabelResourceName="SearchWidget.SearchBox.AriaLabel";Constants.FilterResultsByLabelResourceName="SearchWidget.Filters.Label.FilterResultBy";Constants.SortByLabelResourceName="SearchWidget.Filters.Label.SortBy";Constants.AllDraftArticlesResourceName="SearchWidget.Filters.AllDraftArticles";Constants.AllPublishedArticlesResourceName="SearchWidget.Filters.AllPublishedArticles";Constants.AllApprovedArticlesResourceName="SearchWidget.Filters.AllApprovedArticles";Constants.InternalArticlesResourceName="SearchWidget.Filters.InternalArticles";Constants.ExternalArticlesResourceName="SearchWidget.Filters.ExternalArticles";Constants.ArticleStatusFilterResourceName="SearchWidget.Filters.StatusFilter";Constants.ArticleVisibilityFilterResourceName="SearchWidget.Filters.VisibilityFilter";Constants.ArticleLanguageFilterResourceName="SearchWidget.Filters.LanguageFilter";Constants.ArticleDateFilterResourceName="SearchWidget.Filters.DateFilter";Constants.Last7DaysFilterResourceName="SearchWidget.Filters.Last7Days";Constants.Last30DaysFilterResourceName="SearchWidget.Filters.Last30Days";Constants.Last6MonthsFilterResourceName="SearchWidget.Filters.Last6Months";Constants.LastYearFilterResourceName="SearchWidget.Filters.LastYear";Constants.FilterOptionAllResourceName="SearchWidget.Filters.All";Constants.RelevanceResourceName="SearchWidget.Filters.Relevance";Constants.RatingResourceName="SearchWidget.Filters.Rating";Constants.NumberOfViewsResourceName="SearchWidget.Filters.NumberOfViews";Constants.LastModifiedDateNewestFirstResourceName="SearchWidget.Filters.LastModifiedDate.NewestFirst";Constants.LastModifiedDateOldestFirstResourceName="SearchWidget.Filters.LastModifiedDate.OldestFirst";Constants.LoadMoreButton="SearchWidget.SearchKMArticles.ShowMoreArticlesText";Constants.LoadingText="SearchWidget.SearchKMArticles.LoadingText";Constants.NoArticlesErrorMessageResourceName="SearchWidget.SearchKMArticles.NoArticlesErrorMessage";Constants.RecordDoesNotExistErrorMessageResourceName="SearchWidget.SearchKMArticles.RecordDoesNotExistErrorMessageResourceName";Constants.NoSearchErrorMessageResourceName="SearchWidget.SearchKMArticles.NoSearchErrorMessage";Constants.SearchAndSelectArticleMessageResourceName="SearchWidget.SearchKMArticles.SearchAndSelectArticleMessage";Constants.NoPermissionErrorMessageResourceName="SearchWidget.SearchKMArticles.NoPermissionErrorMessage";Constants.TextAnalyticsErrorMessageResourceName="SearchWidget.SearchKMArticles.TextAnalyticsErrorMessage";Constants.KnowledgeManagementNotEnabledErrorMessageResourceName="SearchWidget.SearchKMArticles.KnowledgeManagementNotEnabledErrorMessage";Constants.NumberOfRatingToolTip="SearchWidget.SearchKMArticles.NumberOfRatingToolTip";Constants.MandatoryFieldMissingErrorMessage="SearchWidget.SearchKMArticles.MandatoryFieldMissingErrorMessage";Constants.MandatoryFieldMissingLinkFormat="SearchWidget.SearchKMArticles.MandatoryFieldMissingLinkFormat";Constants.MandatoryFieldMissingLinkText="SearchWidget.SearchKMArticles.MandatoryFieldMissingLinkText";Constants.SavedQueryApiFailedErrorMessage="SearchWidget.SearchKMArticles.ServerFailure";Constants.KnowledgeSearch="SearchWidget.SearchKMArticles.KnowledgeSearch";Constants.SortedByText="SearchWidget.SearchKMArticles.SortedByText";Constants.StandalonePageTitle="SearchWidget.Standalone.PageTitle";Constants.SearchProviderDropdownLoadingResults="SearchWidget.SearchProviderDropdown.LoadingResults";Constants.SearchProviderDropdownResultsFound="SearchWidget.SearchProviderDropdown.ResultsFound";Constants.FlyoutMenuCloseButton="SearchWidget.FlyoutListMenu.CloseButtonTemplate";Constants.ClickEventType="click";Constants.KeyDownEventType="keydown";Constants.EnterKeyValue="Enter";Constants.TabKeyCode=9;Constants.EnterKeyCode=13;Constants.EscapeKeyCode=27;Constants.SpaceKeyCode=32;Constants.UpArrowKeyCode=38;Constants.DownArrowKeyCode=40;Constants.Letter_E_KeyCode=69;Constants.ConfirmDialogTitle="SearchWidget.SearchKMArticles.ConfirmDialogTitle";Constants.ConfirmDialogTextResourceName="SearchWidget.SearchKMArticles.ConfirmDialogText";Constants.ContentPaneBackButtonLabelResourceName="SearchWidget.BackToSearchResult";Constants.ContentPaneBackButtonToolTip="SearchWidget.BackToSearchResult.Tooltip";Constants.ContentPaneBackButtonAltText="SearchWidget.BackToSearchResult.AltText";Constants.ModifiedOnLabelResourceName="SearchWidget.SearchKMArticles.LastModifiedDateLabel";Constants.ModifiedOnLabelToolTip="SearchWidget.SearchKMArticles.LastModifiedDateLabelToolTip";Constants.NumberOfViewsIconToolTip="SearchWidget.SearchKMArticles.NumberOfViewsToolTip";Constants.RatingIconToolTip="SearchWidget.SearchKMArticles.RatingIconToolTip";Constants.ArticleIconToolTipUnAssociated="SearchWidget.ArticleIconToolTip.UnAssociated";Constants.ArticleIconToolTipAssociated="SearchWidget.ArticleIconToolTip.Associated";Constants.ArticleTagLabelAssociated="SearchWidget.ArticleTagLabel.Associated";Constants.ResultStatusDraftResourceName="SearchWidget.Articles.Drafts";Constants.ResultStatusApprovedResourceName="SearchWidget.Articles.Approved";Constants.ResultStatusScheduledResourceName="SearchWidget.Articles.Scheduled";Constants.EnterKey=13;Constants.TabKey=9;Constants.SearchWidgetRelevanceSearchAdditionalMatches="SearchWidget.RelevanceSearch.AdditionalMatches";Constants.SearchWidgetRelevanceSearchAnnotationMatchCount="SearchWidget.RelevanceSearch.AnnotationMatchCount";Constants.SearchWidgetRelevanceSearchWarningTitle="SearchWidget.RelevanceSearch.WarningTitle";Constants.SearchWidgetRelevanceSearchNotesMatchCount="SearchWidget.RelevanceSearch.AnnotationNotesMatchCount";Constants.SearchWidgetRelevanceSearchNotesAttachmentMatchCount="SearchWidget.RelevanceSearch.AnnotationNotesAttachmentMatchCount";Constants.QuickFindDocumentationHelpLink="SearchWidget.SearchKMArticles.DocumentationHelpLink";Constants.AttachmentFileName="filename";Constants.AttachmentBody="documentbody";Constants.NoteSubject="subject";Constants.NoteText="notetext";Constants.MDFLabelText="SearchWidget.SearchKMArticles.MDFText";Constants.MDFTooltipText="SearchWidget.SearchKMArticles.MDFTooltip";Constants.MoreActionsTextResourceName="SearchWidget.AccessibilityText.MoreActionsText";Constants.ContentPaneTextResourceName="SearchWidget.AccessibilityText.ContentPaneText";Constants.AllDraftArticlesDescriptor="2";Constants.AllPublishedArticlesDescriptor="3";Constants.AllApprovedArticlesDescriptor="6";Constants.CrmHitStartTag="{crmhit}";Constants.CrmHitEndTag="{/crmhit}";Constants.NormalStyle={color:"inherit",fontStyle:"normal",cursor:"inherit"};Constants.CrmHitStyle={background:"yellow",cursor:"inherit"};Constants.SearchTextBoxId="SearchTextBox";Constants.SearchAndDataBlockContainerId="SearchAndDataBlockContainer";Constants.ContentPaneArticleContentContainerPrefix="ContentPaneArticleContentContainer";Constants.knowledgearticleEntityType="knowledgearticle";Constants.MaxCharacterAllowedInKbToolTip=1e3;Constants.ArticleFooterTextColorWhenSelected="#333333";Constants.KMSimpleRelevanceSearch="KMSimpleRelevanceSearch";Constants.UCKMControlRelevanceSearch="UCKMControlRelevanceSearch";Constants.MetadataDrivenFilterForKbSearch="MetadataDrivenFilterForKbSearch";Constants.RelevanceSortId="KMSortRelevance";Constants.NumberOfViewsLocaleSortId="KMSortNumberOfViewsLocale";Constants.LastModifiedDateNewestFirstLocaleSortId="KMSortLastModifiedDateNewestFirstLocale";Constants.LastModifiedDateOldestFirstLocaleSortId="KMSortLastModifiedDateOldestFirstLocale";Constants.SortIconId="KM_sortIcon";Constants.FilterIconId="KM_filterIcon";Constants.ShowSelectedIconId="KM_showSelectedIcon";Constants.SearchProviderDropdownIconId="KM_searchProviderIcon";Constants.IconIdButtonPostfix="_Button";Constants.IconIdContainerPostfix="_Container";Constants.PublishedState="Published";Constants.NumberofResults=10;Constants.knowledgearticleid="knowledgearticleid";Constants.articlepublicnumber="articlepublicnumber";Constants.title="title";Constants.description="description";Constants.content="content";Constants.knowledgearticleviews="knowledgearticleviews";Constants.createdon="createdon";Constants.modifiedon="modifiedon";Constants.statecode="statecode";Constants.statuscode="statuscode";Constants.expirationdate="expirationdate";Constants.languagelocaleid="languagelocaleid";Constants.majorversionnumber="majorversionnumber";Constants.minorversionnumber="minorversionnumber";Constants.islatestversion="islatestversion";Constants.rating="rating";Constants.isinternal="isinternal";Constants.keywords="keywords";Constants.objecttypecode="objecttypecode";Constants.IsInternal="1";Constants.IsExternal="0";Constants.ArticleStatusFilter="ArticleStatusFilter";Constants.ArticleVisibilityFilter="ArticleVisibilityFilter";Constants.ArticleLanguageFilter="ArticleLanguageFilter";Constants.ArticleDateFilter="ArticleDateFilter";Constants.ExtraQueryString="extraqs";Constants.KBSearchFilter="kbsearchfilter";Constants.ShowFilterString="showFilter";Constants.KBSearchFilterOff="off";Constants.ShowFilterOff="0";Constants.Colon=":";Constants.KnowledgeArticle_MandatoryFields=[Constants.articlepublicnumber,Constants.title,Constants.content,Constants.createdon,Constants.keywords,Constants.knowledgearticleviews,Constants.languagelocaleid,Constants.majorversionnumber,Constants.minorversionnumber,Constants.rating,Constants.statecode,Constants.modifiedon];Constants.Annotation_MandatoryFields=[Constants.objecttypecode];Constants.ArticleState={Draft:"0",Approved:"1",Published:"3"};Constants.SearchWidgetEventMapping={0:"SearchPerformed",1:"LanguageFilterUsed",2:"ArticleStateFilterUsed",3:"SortChanged",4:"FirstPageFirstResultSelected",5:"FirstPageOtherResultSelected",6:"OtherPageOtherResultSelected",7:"BackButtonClickedWithoutAction",8:"ShowMoreClicked",9:"LinkButtonClicked",10:"LinkAndEmailButtonClicked",11:"LinkAndEmailContentButtonClicked",12:"CopyLinkButtonClicked",13:"SendToCTIClicked",14:"FullTextSearchCompleted"};Constants.GLOBAL_NOTIFICATION_TYPE_TOAST=1;Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS=1;Constants.GLOBAL_NOTIFICATION_LEVEL_WARNING=3;Constants.WebresourceNameKbSearchControl="KbSearchControl";Constants.WebresourceNameKbSearchInitializor="KbSearchInitializor";Constants.WebresourceNameKbSearchActions="KbSearchActions";Constants.WebresourceNameFullTextSearchActions="KbFullTextSearchActions";Constants.WebresourceNameRelevanceSearchActions="KbRelevanceSearchActions";Constants.WebresourceNameGetKbArticlesSearchActions="KbGetKbArticlesSearchActions";Constants.WebresourceNameMicrosoftSearchActions="KbMicrosoftSearchActions";Constants.WebresourceNameKbSearchResultLegends="KbSearchResultLegends";Constants.WebresourceNameKbSearchResults="KbSearchResults";Constants.WebresourceNameSearchBoxContainer="SearchBoxContainer";Constants.WebresourceNameSearchResultActionsDropdown="SearchResultActionsDropdown";Constants.WebresourceNameSearchResultActionsUIEnhancement="SearchResultActionsUIEnhancement";Constants.WebresourceNameExecuteKbSearchHelper="ExecuteKbSearchHelper";Constants.WebresourceNameExecuteKAAssociation="ExecuteKAAssociationAction";Constants.ODATA_PATH="/api/data/v9.0";Constants.URL_KA_TITLE_CONTENT="/knowledgearticles?$select=content&$filter=knowledgearticleid eq {0}";Constants.SORT_BY_NUMBER_OF_VIEWS="knowledgearticleviews";Constants.Incident="incident";Constants.KnowledgeArticleIncident="knowledgearticleincident";Constants.KnowledgeArticleIncidents="knowledgearticleincidents";Constants.KnowledgeArticleId="knowledgearticleid";Constants.EntityName="knowledgearticle";Constants.KnowledgeArticles="knowledgearticles";Constants.LanguageLocale="languagelocale";Constants.LanguageLocaleId="languagelocaleid";Constants.IncidentRelationshipName="knowledgearticlescategories";Constants.ServerSearchFailure="SearchWidget.SearchKMArticles.ServerFailure";Constants.ServerSearchNoPermissions="SearchWidget.SearchKMArticles.NoPermissionErrorMessage";Constants.ConditionOperatorMapping={0:"Equal",1:"NotEqual",2:"GreaterThan",3:"LessThan",4:"GreaterEqual",5:"LessEqual",6:"Like",7:"NotLike",8:"In",17:"Last7Days",22:"LastMonth",28:"LastYear",33:"LastXDays",39:"LastXYears",37:"LastXMonths",82:"OlderThanXYears"};Constants.LogicalOperatorMapping={0:"And",1:"Or"};Constants.ActiveLanguagesFetchXml="<fetch mapping='logical' distinct='true' version='1.0'> <entity name='knowledgearticle'> <attribute name='languagelocaleid' alias='languagelocaleid' /> <filter> <condition attribute='statecode' operator='in'> <value>0</value> <value>1</value> <value>2</value> <value>3</value> </condition> </filter> <link-entity name='languagelocale' from='languagelocaleid' to='languagelocaleid' link-type='inner'> <attribute name='name' alias='name' /> </link-entity> </entity> </fetch>";Constants.KnowledgeArticleViewCountWebLocation={Dynamics:1,Portal:2};Constants.MicrosoftSearchEndPoint="https://graph.microsoft.com";Constants.MicrosoftSearchConnectionIdPrefix="/external/connections/";Constants.MicrosoftSearchOdataPath="/beta/search/query";Constants.MicrosoftSearchConnectorStoredFieldTitle="title";Constants.MicrosoftSearchConnectorStoredFieldUrl="url";Constants.MicrosoftSearchConnectorStoredFieldDescription="description";return Constants}();KbSearchControl.Constants=Constants})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var SearchWidgetEvent;(function(SearchWidgetEvent){SearchWidgetEvent[SearchWidgetEvent["SearchPerformed"]=0]="SearchPerformed";SearchWidgetEvent[SearchWidgetEvent["LanguageFilterUsed"]=1]="LanguageFilterUsed";SearchWidgetEvent[SearchWidgetEvent["ArticleStateFilterUsed"]=2]="ArticleStateFilterUsed";SearchWidgetEvent[SearchWidgetEvent["SortChanged"]=3]="SortChanged";SearchWidgetEvent[SearchWidgetEvent["FirstPageFirstResultSelected"]=4]="FirstPageFirstResultSelected";SearchWidgetEvent[SearchWidgetEvent["FirstPageOtherResultSelected"]=5]="FirstPageOtherResultSelected";SearchWidgetEvent[SearchWidgetEvent["OtherPageOtherResultSelected"]=6]="OtherPageOtherResultSelected";SearchWidgetEvent[SearchWidgetEvent["BackButtonClickedWithoutAction"]=7]="BackButtonClickedWithoutAction";SearchWidgetEvent[SearchWidgetEvent["ShowMoreClicked"]=8]="ShowMoreClicked";SearchWidgetEvent[SearchWidgetEvent["LinkButtonClicked"]=9]="LinkButtonClicked";SearchWidgetEvent[SearchWidgetEvent["LinkAndEmailButtonClicked"]=10]="LinkAndEmailButtonClicked";SearchWidgetEvent[SearchWidgetEvent["LinkAndEmailContentButtonClicked"]=11]="LinkAndEmailContentButtonClicked";SearchWidgetEvent[SearchWidgetEvent["CopyLinkButtonClicked"]=12]="CopyLinkButtonClicked";SearchWidgetEvent[SearchWidgetEvent["SendToCTIButtonClicked"]=13]="SendToCTIButtonClicked";SearchWidgetEvent[SearchWidgetEvent["FullTextSearchCompleted"]=14]="FullTextSearchCompleted";SearchWidgetEvent[SearchWidgetEvent["RelevanceSearchCompleted"]=15]="RelevanceSearchCompleted";SearchWidgetEvent[SearchWidgetEvent["MicrosoftSearchCompleted"]=16]="MicrosoftSearchCompleted"})(SearchWidgetEvent=KbSearchControl.SearchWidgetEvent||(KbSearchControl.SearchWidgetEvent={}));var SearchWidgetCommand;(function(SearchWidgetCommand){SearchWidgetCommand[SearchWidgetCommand["ArticlesFilter"]=0]="ArticlesFilter";SearchWidgetCommand[SearchWidgetCommand["LanguageFilter"]=1]="LanguageFilter";SearchWidgetCommand[SearchWidgetCommand["SortFilter"]=2]="SortFilter"})(SearchWidgetCommand=KbSearchControl.SearchWidgetCommand||(KbSearchControl.SearchWidgetCommand={}));var ArticleStatusFilterOption;(function(ArticleStatusFilterOption){ArticleStatusFilterOption[ArticleStatusFilterOption["Draft"]=0]="Draft";ArticleStatusFilterOption[ArticleStatusFilterOption["Approved"]=1]="Approved";ArticleStatusFilterOption[ArticleStatusFilterOption["Published"]=3]="Published"})(ArticleStatusFilterOption=KbSearchControl.ArticleStatusFilterOption||(KbSearchControl.ArticleStatusFilterOption={}));var SearchResultSortOption;(function(SearchResultSortOption){SearchResultSortOption[SearchResultSortOption["Relevance"]=1]="Relevance";SearchResultSortOption[SearchResultSortOption["Rating"]=2]="Rating";SearchResultSortOption[SearchResultSortOption["NumberOfViews"]=3]="NumberOfViews";SearchResultSortOption[SearchResultSortOption["LastModifiedDateOldestFirst"]=4]="LastModifiedDateOldestFirst";SearchResultSortOption[SearchResultSortOption["LastModifiedDateNewestFirst"]=5]="LastModifiedDateNewestFirst"})(SearchResultSortOption=KbSearchControl.SearchResultSortOption||(KbSearchControl.SearchResultSortOption={}));var SearchType;(function(SearchType){SearchType[SearchType["None"]=0]="None";SearchType[SearchType["FullTextSearch"]=1]="FullTextSearch";SearchType[SearchType["RelevanceSearch"]=2]="RelevanceSearch";SearchType[SearchType["MicrosoftSearch"]=3]="MicrosoftSearch"})(SearchType=KbSearchControl.SearchType||(KbSearchControl.SearchType={}));var SearchActionType;(function(SearchActionType){SearchActionType[SearchActionType["ExecuteFullTextSearch"]=0]="ExecuteFullTextSearch";SearchActionType[SearchActionType["ExecuteRelevanceSearch"]=1]="ExecuteRelevanceSearch";SearchActionType[SearchActionType["ExecuteMicrosoftSearch"]=2]="ExecuteMicrosoftSearch";SearchActionType[SearchActionType["GetAssociatedArticles"]=3]="GetAssociatedArticles";SearchActionType[SearchActionType["GetAssociatedFederatedArticles"]=4]="GetAssociatedFederatedArticles";SearchActionType[SearchActionType["GetArticlesFromIds"]=5]="GetArticlesFromIds"})(SearchActionType=KbSearchControl.SearchActionType||(KbSearchControl.SearchActionType={}));var Browsers;(function(Browsers){Browsers[Browsers["Others"]=0]="Others";Browsers[Browsers["Chrome"]=1]="Chrome";Browsers[Browsers["Firefox"]=2]="Firefox";Browsers[Browsers["IE"]=3]="IE";Browsers[Browsers["Safari"]=4]="Safari";Browsers[Browsers["Edge"]=5]="Edge"})(Browsers=KbSearchControl.Browsers||(KbSearchControl.Browsers={}));var ConditionOperator;(function(ConditionOperator){ConditionOperator[ConditionOperator["Equal"]=0]="Equal";ConditionOperator[ConditionOperator["NotEqual"]=1]="NotEqual";ConditionOperator[ConditionOperator["GreaterThan"]=2]="GreaterThan";ConditionOperator[ConditionOperator["LessThan"]=3]="LessThan";ConditionOperator[ConditionOperator["GreaterEqual"]=4]="GreaterEqual";ConditionOperator[ConditionOperator["LessEqual"]=5]="LessEqual";ConditionOperator[ConditionOperator["Like"]=6]="Like";ConditionOperator[ConditionOperator["NotLike"]=7]="NotLike";ConditionOperator[ConditionOperator["In"]=8]="In";ConditionOperator[ConditionOperator["NotIn"]=9]="NotIn";ConditionOperator[ConditionOperator["Between"]=10]="Between";ConditionOperator[ConditionOperator["NotBetween"]=11]="NotBetween";ConditionOperator[ConditionOperator["Null"]=12]="Null";ConditionOperator[ConditionOperator["NotNull"]=13]="NotNull";ConditionOperator[ConditionOperator["Yesterday"]=14]="Yesterday";ConditionOperator[ConditionOperator["Today"]=15]="Today";ConditionOperator[ConditionOperator["Tomorrow"]=16]="Tomorrow";ConditionOperator[ConditionOperator["Last7Days"]=17]="Last7Days";ConditionOperator[ConditionOperator["Next7Days"]=18]="Next7Days";ConditionOperator[ConditionOperator["LastWeek"]=19]="LastWeek";ConditionOperator[ConditionOperator["ThisWeek"]=20]="ThisWeek";ConditionOperator[ConditionOperator["NextWeek"]=21]="NextWeek";ConditionOperator[ConditionOperator["LastMonth"]=22]="LastMonth";ConditionOperator[ConditionOperator["ThisMonth"]=23]="ThisMonth";ConditionOperator[ConditionOperator["NextMonth"]=24]="NextMonth";ConditionOperator[ConditionOperator["On"]=25]="On";ConditionOperator[ConditionOperator["OnOrBefore"]=26]="OnOrBefore";ConditionOperator[ConditionOperator["OnOrAfter"]=27]="OnOrAfter";ConditionOperator[ConditionOperator["LastYear"]=28]="LastYear";ConditionOperator[ConditionOperator["ThisYear"]=29]="ThisYear";ConditionOperator[ConditionOperator["NextYear"]=30]="NextYear";ConditionOperator[ConditionOperator["LastXHours"]=31]="LastXHours";ConditionOperator[ConditionOperator["NextXHours"]=32]="NextXHours";ConditionOperator[ConditionOperator["LastXDays"]=33]="LastXDays";ConditionOperator[ConditionOperator["NextXDays"]=34]="NextXDays";ConditionOperator[ConditionOperator["LastXWeeks"]=35]="LastXWeeks";ConditionOperator[ConditionOperator["NextXWeeks"]=36]="NextXWeeks";ConditionOperator[ConditionOperator["LastXMonths"]=37]="LastXMonths";ConditionOperator[ConditionOperator["NextXMonths"]=38]="NextXMonths";ConditionOperator[ConditionOperator["LastXYears"]=39]="LastXYears";ConditionOperator[ConditionOperator["NextXYears"]=40]="NextXYears";ConditionOperator[ConditionOperator["EqualUserId"]=41]="EqualUserId";ConditionOperator[ConditionOperator["NotEqualUserId"]=42]="NotEqualUserId";ConditionOperator[ConditionOperator["EqualBusinessId"]=43]="EqualBusinessId";ConditionOperator[ConditionOperator["NotEqualBusinessId"]=44]="NotEqualBusinessId";ConditionOperator[ConditionOperator["ChildOf"]=45]="ChildOf";ConditionOperator[ConditionOperator["Mask"]=46]="Mask";ConditionOperator[ConditionOperator["NotMask"]=47]="NotMask";ConditionOperator[ConditionOperator["MasksSelect"]=48]="MasksSelect";ConditionOperator[ConditionOperator["Contains"]=49]="Contains";ConditionOperator[ConditionOperator["DoesNotContain"]=50]="DoesNotContain";ConditionOperator[ConditionOperator["EqualUserLanguage"]=51]="EqualUserLanguage";ConditionOperator[ConditionOperator["NotOn"]=52]="NotOn";ConditionOperator[ConditionOperator["OlderThanXMonths"]=53]="OlderThanXMonths";ConditionOperator[ConditionOperator["BeginsWith"]=54]="BeginsWith";ConditionOperator[ConditionOperator["DoesNotBeginWith"]=55]="DoesNotBeginWith";ConditionOperator[ConditionOperator["EndsWith"]=56]="EndsWith";ConditionOperator[ConditionOperator["DoesNotEndWith"]=57]="DoesNotEndWith";ConditionOperator[ConditionOperator["ThisFiscalYear"]=58]="ThisFiscalYear";ConditionOperator[ConditionOperator["ThisFiscalPeriod"]=59]="ThisFiscalPeriod";ConditionOperator[ConditionOperator["NextFiscalYear"]=60]="NextFiscalYear";ConditionOperator[ConditionOperator["NextFiscalPeriod"]=61]="NextFiscalPeriod";ConditionOperator[ConditionOperator["LastFiscalYear"]=62]="LastFiscalYear";ConditionOperator[ConditionOperator["LastFiscalPeriod"]=63]="LastFiscalPeriod";ConditionOperator[ConditionOperator["LastXFiscalYears"]=64]="LastXFiscalYears";ConditionOperator[ConditionOperator["LastXFiscalPeriods"]=65]="LastXFiscalPeriods";ConditionOperator[ConditionOperator["NextXFiscalYears"]=66]="NextXFiscalYears";ConditionOperator[ConditionOperator["NextXFiscalPeriods"]=67]="NextXFiscalPeriods";ConditionOperator[ConditionOperator["InFiscalYear"]=68]="InFiscalYear";ConditionOperator[ConditionOperator["InFiscalPeriod"]=69]="InFiscalPeriod";ConditionOperator[ConditionOperator["InFiscalPeriodAndYear"]=70]="InFiscalPeriodAndYear";ConditionOperator[ConditionOperator["InOrBeforeFiscalPeriodAndYear"]=71]="InOrBeforeFiscalPeriodAndYear";ConditionOperator[ConditionOperator["InOrAfterFiscalPeriodAndYear"]=72]="InOrAfterFiscalPeriodAndYear";ConditionOperator[ConditionOperator["EqualUserTeams"]=73]="EqualUserTeams";ConditionOperator[ConditionOperator["EqualUserOrUserTeams"]=74]="EqualUserOrUserTeams";ConditionOperator[ConditionOperator["Under"]=75]="Under";ConditionOperator[ConditionOperator["NotUnder"]=76]="NotUnder";ConditionOperator[ConditionOperator["UnderOrEqual"]=77]="UnderOrEqual";ConditionOperator[ConditionOperator["Above"]=78]="Above";ConditionOperator[ConditionOperator["AboveOrEqual"]=79]="AboveOrEqual";ConditionOperator[ConditionOperator["EqualUserOrUserHierarchy"]=80]="EqualUserOrUserHierarchy";ConditionOperator[ConditionOperator["EqualUserOrUserHierarchyAndTeams"]=81]="EqualUserOrUserHierarchyAndTeams";ConditionOperator[ConditionOperator["OlderThanXYears"]=82]="OlderThanXYears";ConditionOperator[ConditionOperator["OlderThanXWeeks"]=83]="OlderThanXWeeks";ConditionOperator[ConditionOperator["OlderThanXDays"]=84]="OlderThanXDays";ConditionOperator[ConditionOperator["OlderThanXHours"]=85]="OlderThanXHours";ConditionOperator[ConditionOperator["OlderThanXMinutes"]=86]="OlderThanXMinutes"})(ConditionOperator=KbSearchControl.ConditionOperator||(KbSearchControl.ConditionOperator={}));var LogicalOperator;(function(LogicalOperator){LogicalOperator[LogicalOperator["And"]=0]="And";LogicalOperator[LogicalOperator["Or"]=1]="Or"})(LogicalOperator=KbSearchControl.LogicalOperator||(KbSearchControl.LogicalOperator={}));var DateFilterOptions;(function(DateFilterOptions){DateFilterOptions[DateFilterOptions["Last7Days"]=17]="Last7Days";DateFilterOptions[DateFilterOptions["LastXDays"]=33]="LastXDays";DateFilterOptions[DateFilterOptions["LastXYears"]=39]="LastXYears";DateFilterOptions[DateFilterOptions["LastXMonths"]=37]="LastXMonths"})(DateFilterOptions=KbSearchControl.DateFilterOptions||(KbSearchControl.DateFilterOptions={}))})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var EventName="ucikbsearchcontrol",KbSearchEventTelemetry=function(){function KbSearchEventTelemetry(controlAction){this.eventName=EventName;this.eventParameters=[{name:"Action",value:controlAction},{name:"EventTime",value:new Date}]}KbSearchEventTelemetry.reportEvent=function(context,event){if(context===null)return;context.reporting.reportEvent(event)};return KbSearchEventTelemetry}();KbSearchControl.KbSearchEventTelemetry=KbSearchEventTelemetry})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchResult=function(){function KbSearchResult(kbSearchRecord){this.kbSearchRecord=kbSearchRecord;this.articleActions=[];this.isMenuVisible=false}return KbSearchResult}();KbSearchControl.KbSearchResult=KbSearchResult})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var StateManager=function(){function StateManager(){this.IsActionPerformedOnFirstResult=false;this.popupEnabled=false;this.isSearchMode=true;this.shouldShowSelected=false;this.showResultCount=false;this.requestAdditionalRendering=false;this.filtersVisible=false;this.relations=null;this.loading=true;this.langFetchXmlResult=null;this.isMakeAdditionalCallToGetArticleDetails=true;this.isKnowledgeSearchInsightsEnabled=false;this.selectedStateCode=null;this.isArticleStatusFilterExpanded=false;this.selectedVisibility=null;this.searchResultsScrollPos=0;this.filterPaneScrollPos=0;this.isArticleVisibilityFilterExpanded=false;this.selectedDateRange=null;this.isArticleDateFilterExpanded=false;this.selectedLanguage=null;this.isArticleLanguageFilterExpanded=false;this.shouldFiltersGainDefaultFocus=false;this.applicationName=null;this.articleSelectedInPreviousRender=null;this.selectedArticle=null;this.kbSearchResultCollection=[];this.isSavedQueryApiFailed=false}StateManager.Instance=function(controlId,initializingControl){if(initializingControl===void 0)initializingControl=false;if(!StateManager._stateManager[controlId]||initializingControl)StateManager._stateManager[controlId]=new StateManager;return StateManager._stateManager[controlId]};StateManager.Destroy=function(controlId){if(StateManager._stateManager[controlId])delete StateManager._stateManager[controlId]};Object.defineProperty(StateManager.prototype,"IsExpandedMode",{"get":function(){return this._context.client.allocatedWidth>=parseInt(this._context.theming.breakpoints.dimensionm,10)},enumerable:true,configurable:true});Object.defineProperty(StateManager.prototype,"IsPopupRenderedInExpandedMode",{"get":function(){var popupSearchControlContainer=document.getElementById(this._context.accessibility.getUniqueId("popupsearchControlContainer"));if(!popupSearchControlContainer)return false;return popupSearchControlContainer.clientWidth>=parseInt(this._context.theming.breakpoints.dimensionm,10)},enumerable:true,configurable:true});StateManager.prototype.GetkbSearchResultArticleInfoObject=function(){if(!this.kbSearchResultArticleInfoObject)this.kbSearchResultArticleInfoObject=new MscrmControls.KbArticleControl.KbArticleControl;return this.kbSearchResultArticleInfoObject};StateManager.prototype.LoadSelectedArticles=function(){if(!(MscrmControls.KbCommonUtils.CommonUtils.IsLoadedInDialog(this._context)&&this._context.parameters.WrapperContext.DialogContext.isMultiSelect)){this.shouldShowSelected=false;return}var dictionary=this._context.parameters.WrapperContext.DialogContext.SelectedRecords,totalCount=Object.keys(dictionary).length,kbSearchRecords=Array();for(var key in dictionary){var value=dictionary[key];kbSearchRecords.push(value.record)}this.records=kbSearchRecords;this.recordIds=kbSearchRecords.map(function(record){return record.knowledgeArticleId});this.loading=false;this.totalCount=totalCount;this.ExecuteKbSearchHelper.SearchHasBeenPerformed=true;this._context.parameters.value.isControlDisabled=false};StateManager.prototype.GetkbSearchResultContentPaneObject=function(){if(!this.kbSearchResultContentPaneObject)this.kbSearchResultContentPaneObject=new MscrmControls.KbContentControl.KbContentControl;return this.kbSearchResultContentPaneObject};StateManager.prototype.GetIsSearchMode=function(){return !this._context.parameters.value.hideSearchOnRecordLoad&&this.isSearchMode};StateManager.prototype.SetIsSearchMode=function(isSearchMode,context){this.isSearchMode=isSearchMode;!isSearchMode&&this.CallResultOpenedNotifyHandler(context)};StateManager.prototype.getShowResults=function(context){return !this.loading&&this.ExecuteKbSearchHelper.SearchHasBeenPerformed};StateManager.prototype.setShowResults=function(showResults){this.showResultCount=showResults};StateManager.prototype.GetSelectedArticle=function(){if(this._context.parameters.value.hideSearchOnRecordLoad){this.records=this._context.parameters.value.records;return this.records[0]}return this.selectedArticle};StateManager.prototype.GetArticleSelectedInPreviousRender=function(){return this.articleSelectedInPreviousRender};StateManager.prototype.SetArticleSelectedInPreviousRender=function(){this.articleSelectedInPreviousRender=this.GetSelectedArticle()};StateManager.prototype.SetSelectedArticle=function(selectedKbSearchRecord,context){this.selectedArticle=selectedKbSearchRecord;context.parameters.value.executeNotifyHandlersThatEventOccurred({eventName:KbSearchControl.Constants.ON_SELECTION,fieldName:context.parameters.value.controlId,pageId:context.parameters.value.pageId,contextToken:context.parameters.value.contextToken,record:this.selectedArticle});MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(MscrmControls.KbCommonUtils.ArticleAction.SelectedResult,{controlContext:context,record:this.selectedArticle,stateManager:this})};StateManager.prototype.UpdateSelectedArticleDetails=function(context){if(this._context.parameters.value.hideSearchOnRecordLoad)return;if(!this.GetSelectedArticle())return;var selectedknowledgeArticleId=this.GetSelectedArticle().knowledgeArticleId,records=this.records;if(records&&records.length>0)for(var i=0;i<records.length;i++)if(records[i]["knowledgeArticleId"]==selectedknowledgeArticleId){this.selectedArticle.knowledgeArticleViews=records[i].knowledgeArticleViews;records[i].isAssociated=this.selectedArticle.isAssociated;break}};StateManager.prototype.GetKbSearchResultCollection=function(){return this.kbSearchResultCollection};StateManager.prototype.SetKbSearchResultCollection=function(kbSearchResultCollection){this.kbSearchResultCollection=kbSearchResultCollection};StateManager.prototype.GetKbSearchResult=function(kbSearchRecord){var matchingKbSearchResultCollection=this.kbSearchResultCollection.filter(function(kbSearchResult){return kbSearchResult.kbSearchRecord.knowledgeArticleId===kbSearchRecord.knowledgeArticleId});if(matchingKbSearchResultCollection.length>0)return matchingKbSearchResultCollection[0];return null};StateManager.prototype.AddKbSearchResult=function(value){var matchingKbSearchResultCollection=this.kbSearchResultCollection.filter(function(kbSearchResult){return kbSearchResult.kbSearchRecord.knowledgeArticleId===value.knowledgeArticleId});matchingKbSearchResultCollection.length===0&&this.kbSearchResultCollection.push(new KbSearchControl.KbSearchResult(value))};StateManager.prototype.AreActionsDisabled=function(){return this._context.parameters.value.urlQueryParams&&this._context.parameters.value.urlQueryParams.enableContextualActions===false};StateManager.prototype.IsActionEnabled=function(articleAction){return this._context.parameters.value.descriptors.showContextualActions==="ShowAll"||this._context.parameters.value.descriptors.actionList&&this._context.parameters.value.descriptors.actionList.indexOf(articleAction)>=0};StateManager.prototype.IsActionValid=function(articleAction,record){var validationPayload={controlContext:this._context,record:record,stateManager:this};return MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Validate(articleAction,validationPayload)};StateManager.prototype.GetArticleActionsForRecord=function(record){var _this=this;if(this.AreActionsDisabled())return [];var articleActions=Object.keys(MscrmControls.KbCommonUtils.ArticleAction).filter(function(val){return parseInt(val,10)>-1}).map(function(strVal){return parseInt(strVal,10)});articleActions=articleActions.filter(function(articleAction){return _this.IsActionEnabled(articleAction)&&_this.IsActionValid(articleAction,record)});return articleActions};StateManager.prototype.SetArticleActionsForRecord=function(record){var articleActions=this.GetArticleActionsForRecord(record),kbSearchResult=this.GetKbSearchResult(record);if(kbSearchResult)kbSearchResult.articleActions=articleActions};StateManager.prototype.SetAvailableArticleActions=function(){var _this=this;if(!this.isExternalSearchIndexEnabled&&this.records)this.records.forEach(function(record){_this.SetArticleActionsForRecord(record)});else this.isExternalSearchIndexEnabled&&this.kbRelevanceSearchRecordCollection&&this.kbRelevanceSearchRecordCollection.forEach(function(record){_this.SetArticleActionsForRecord(record)})};StateManager.prototype.ReportEventToTelemetry=function(actionName){var kbSearchControlEvent=new KbSearchControl.KbSearchEventTelemetry(actionName);KbSearchControl.KbSearchEventTelemetry.reportEvent(this._context,kbSearchControlEvent)};StateManager.prototype.InitializeModels=function(context,fetchApiWrapper){this._context=context;this.ExecuteKbSearchHelper=new KbSearchControl.ExecuteKbSearchHelper(context,fetchApiWrapper)};StateManager.prototype.InitializeFilterModels=function(){this.ArticleStatusFilter=new KbSearchControl.ArticleStatusFilter(this._context);this.ArticleLanguageFilter=new KbSearchControl.ArticleLanguageFilter(this._context);this.SortFilter=new KbSearchControl.SortFilter(this._context)};StateManager.prototype.CallResultOpenedNotifyHandler=function(context){context.parameters.value.executeNotifyHandlersThatEventOccurred({eventName:KbSearchControl.Constants.ON_RESULT_OPENED,fieldName:context.parameters.value.controlId,pageId:context.parameters.value.pageId,contextToken:context.parameters.value.contextToken,record:this.selectedArticle})};StateManager.prototype.SetSelectedSearchProviderSettings=function(){this.kmPrivileges=this.ExecuteKbSearchHelper.getSelectedSearchProvider().Settings.kmPrivileges;this.useExternalKMPortal=this.ExecuteKbSearchHelper.getSelectedSearchProvider().Settings.UseExternalKMPortal;this.externalKMPortalURL=this.ExecuteKbSearchHelper.getSelectedSearchProvider().Settings.ExternalKMPortalURL;this.knowledgeArticleAttributeList=this.ExecuteKbSearchHelper.getSelectedSearchProvider().Settings.KnowledgeArticleAttributeList;this.isExternalSearchIndexEnabled=this.ExecuteKbSearchHelper.getSelectedSearchProvider().Settings.IsRelevanceSearchEnabled};StateManager.prototype.ResetSelectedArticle=function(){this.selectedArticle=null};StateManager.prototype.getRelevanceSearchRecordsToDisplay=function(){if(this.ExecuteKbSearchHelper.mode===2)return this.kbRelevanceSearchRecordCollection;var currentPageNumber=this.ExecuteKbSearchHelper.getSelectedSearchProvider().SearchParameters.CurrentPageNumber,numOfResults=this.ExecuteKbSearchHelper.numberOfResults,kbDisplayRelevanceSearchRecordCollection=[];if(!currentPageNumber||!numOfResults)return kbDisplayRelevanceSearchRecordCollection;var maxResultsToDisplay=Math.min(currentPageNumber*numOfResults,this.kbRelevanceSearchRecordCollection.length);kbDisplayRelevanceSearchRecordCollection=this.kbRelevanceSearchRecordCollection.slice(0,maxResultsToDisplay);return kbDisplayRelevanceSearchRecordCollection};StateManager.prototype.saveState=function(state){state.sortOption=this.SortFilter.SelectedSortFilterBySortOption();state.statusFilterOption=this.selectedStateCode;state.visibilityFilterOption=this.selectedVisibility;state.dateFilterOption=this.selectedDateRange;state.selectedLanguage=this.selectedLanguage;state.areFiltersVisible=this.filtersVisible;state.isStatusFilterOpen=this.isArticleStatusFilterExpanded;state.isVisibilityFilterOpen=this.isArticleVisibilityFilterExpanded;state.isDateFilterOpen=this.isArticleDateFilterExpanded;state.searchResultsScrollPos=MscrmControls.KbCommonUtils.CommonUtils.getScrollPos(KbSearchControl.Constants.SearchAndDataBlockContainerId,this._context);state.filterPaneScrollPos=MscrmControls.KbCommonUtils.CommonUtils.getScrollPos("VirtualFilterControlContainer",this._context);state.isLanguageFilterOpen=this.isArticleLanguageFilterExpanded;state.langFetchXmlResult=this.langFetchXmlResult;state.loading=this.loading;state.selectedArticle=this.selectedArticle;state.isSearchMode=this.isSearchMode;state.relations=this.relations;state.associatedArticles=this.associatedArticles;state.isKnowledgeManagementEnabled=this._context.parameters.value.isKnowledgeManagementEnabled;state.entityDisplayName=this._context.parameters.value.entityDisplayName;state.error=this.error;state.errorMessage=this.errorMessage;state.errorDetails=this.errorDetails;state.isSavedQueryApiFailed=this.isSavedQueryApiFailed;if(this.ArticleLanguageFilter)state.articleSelectLanguageOption=this.ArticleLanguageFilter.SelectLanguageOption;state.clickKbArticleId=this.clickKbArticleId;if(this.ExecuteKbSearchHelper)state.searchHelperState=this.ExecuteKbSearchHelper.saveSearchHelperState();else state.searchHelperState=null};StateManager.prototype.restoreState=function(state){this.SortFilter.SetSelectedSortFilterBySortOption(state.sortOption);this.selectedStateCode=state.statusFilterOption;this.selectedVisibility=state.visibilityFilterOption;this.selectedDateRange=state.dateFilterOption;this.selectedLanguage=state.selectedLanguage;this.filtersVisible=state.areFiltersVisible;this.isArticleStatusFilterExpanded=state.isStatusFilterOpen;this.isArticleVisibilityFilterExpanded=state.isVisibilityFilterOpen;this.isArticleDateFilterExpanded=state.isDateFilterOpen;this.isArticleLanguageFilterExpanded=state.isLanguageFilterOpen;this.searchResultsScrollPos=state.searchResultsScrollPos;this.filterPaneScrollPos=state.filterPaneScrollPos;this.langFetchXmlResult=state.langFetchXmlResult;this.selectedArticle=state.selectedArticle;this.isSearchMode=state.isSearchMode;this.relations=state.relations;this.associatedArticles=state.associatedArticles;this._context.parameters.value.isKnowledgeManagementEnabled=state.isKnowledgeManagementEnabled;this._context.parameters.value.entityDisplayName=state.entityDisplayName;this.error=state.error;this.errorMessage=state.errorMessage;this.errorDetails=state.errorDetails;this.isSavedQueryApiFailed=state.isSavedQueryApiFailed;if(this.ArticleLanguageFilter)this.ArticleLanguageFilter.SelectLanguageOption=state.articleSelectLanguageOption;this.error=state.error;this.errorMessage=state.errorMessage;this.errorDetails=state.errorDetails;this.isSavedQueryApiFailed=state.isSavedQueryApiFailed;if(this.ArticleLanguageFilter)this.ArticleLanguageFilter.SelectLanguageOption=state.articleSelectLanguageOption;this.clickKbArticleId=state.clickKbArticleId;var searchHelperState=state.searchHelperState;searchHelperState&&this.ExecuteKbSearchHelper&&this.ExecuteKbSearchHelper.restoreSearchHelperState(searchHelperState)};StateManager._stateManager={};return StateManager}();KbSearchControl.StateManager=StateManager})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl_1){"use strict";var KbSearchControl=function(){function KbSearchControl(){this.hiddenSpanWidthValue=53;this.hiddenSpanReflowWidthValue=52;this.kbRelevanceSearchRecordCollection=[];this.activeLanguages=[];this.executeLanguageFetchXml=true;this.promiseResolved=false;this.kbSearchResultAccessibilityText="";this.kbSearchErrorAccessibilityText="";this.isInitialFocusSetOnStandAloneMode=false;this.isTitleSetForStandAloneMode=false;this.isFirstResultRender=true}Object.defineProperty(KbSearchControl.prototype,"Context",{"get":function(){return this._context},"set":function(value){var _this_1=this;this._context=value;if(this._context.parameters.value.hideSearchOnRecordLoad)this._stateManager.records=this._context.parameters.value.records;var kbSearchRecordCollection=this._stateManager.records;kbSearchRecordCollection&&kbSearchRecordCollection.forEach(function(kbSearchRecord){_this_1._stateManager.AddKbSearchResult(kbSearchRecord)})},enumerable:true,configurable:true});Object.defineProperty(KbSearchControl.prototype,"IsEdgeOrIE",{"get":function(){return this.Context.client.userAgent.isBrowserIE||navigator.userAgent.indexOf("Edge")>-1},enumerable:true,configurable:true});KbSearchControl.prototype.init=function(context,notifyOutputChanged,state,container){var _this_1=this,watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"init");this._isRelevanceSearchSyncStatusValid=true;this.isInitialized=false;this._stateManager=KbSearchControl_1.StateManager.Instance(context.parameters.value.controlId,true);context.parameters.value.currentSearchText=null;this.Context=context;this._state=state;MscrmControls.KbCommonUtils.FCBUtil.SetCustomerEnabledWaves(context);this._stateManager.numberOfResults=this._context.parameters.value.descriptors.numberOfResults;this.fetchApiWrapper=(new MscrmControls.KbCommonUtils.FetchWrapperFactory).GetWrapper();this._stateManager.InitializeModels(this.Context,this.fetchApiWrapper);this.initializeViewObjects();(new KbSearchControl_1.KbSearchInitializor).initializeKbSearch(this._context,this.fetchApiWrapper,this._state).then(function(){_this_1.isInitialized=true;_this_1.activeLanguages=_this_1._stateManager.ExecuteKbSearchHelper.getCurrentOrgSearchProvider().Settings.ActiveLanguages;watermarkTelemetryEvent.End();_this_1.logInitTelemetry();if(_this_1._context.parameters.value.searchWidgetActionResult&&_this_1._context.parameters.value.searchWidgetActionResult.action&&_this_1._context.parameters.value.searchWidgetActionResult.action.ActionExecutionId)_this_1._stateManager.PreviousActionExecutionId=_this_1._context.parameters.value.searchWidgetActionResult.action.ActionExecutionId;if(_this_1._context.parameters.value.urlQueryParams){_this_1._context.parameters.value.urlQueryParams.sort&&_this_1._stateManager.SortFilter.SetSelectedSortFilterBySortOption(_this_1._context.parameters.value.urlQueryParams.sort);if(_this_1._context.parameters.value.urlQueryParams.queryString){var searchText=_this_1._context.parameters.value.urlQueryParams.queryString;_this_1._stateManager.ExecuteKbSearchHelper.searchText=searchText;_this_1.Context.parameters.value.executeUpdateCurrentSearchText(_this_1.Context.parameters.value.contextToken,searchText)}}_this_1._context.utils.requestRender()});this.Context.client.trackContainerResize(true)};KbSearchControl.prototype.initializeViewObjects=function(){this.SearchBoxContainerObject=new KbSearchControl_1.SearchBoxContainer;this.SearchBoxContainerObject.init(this.Context);this.SearchResultActionObject=new KbSearchControl_1.SearchResultAction;this.SearchResultActionObject.init(this.Context,this.fetchApiWrapper);this.SearchResultObject=new KbSearchControl_1.SearchResult;this.SearchResultObject.init(this.Context,this.fetchApiWrapper);this.SearchActionsObject=new KbSearchControl_1.SearchActions;this.SearchActionsObject.init(this.Context)};KbSearchControl.prototype.initView=function(){if(!this._stateManager.IsExpandedMode||window.IsUSD||this.Context.parameters.value.hideSearchOnRecordLoad)this.view=new KbSearchControl_1.StandardSearchControlView;else this.view=new KbSearchControl_1.StandaloneSearchControlView;this.view.init(this.getViewInitParams())};KbSearchControl.prototype.logInitTelemetry=function(){var eventParams=[];eventParams.push({name:"ApplicationName",value:this._stateManager.ExecuteKbSearchHelper.getCurrentOrgSearchProvider().Settings.ApplicationName});eventParams.push({name:"IsRelevanceSearchEnabled",value:this._stateManager.ExecuteKbSearchHelper.getCurrentOrgSearchProvider().Settings.IsRelevanceSearchEnabled});eventParams.push({name:"UseExternalKMPortal",value:this._stateManager.ExecuteKbSearchHelper.getCurrentOrgSearchProvider().Settings.UseExternalKMPortal});eventParams.push({name:"IsKnowledgeSearchInsightsEnabled",value:this._stateManager.ExecuteKbSearchHelper.getCurrentOrgSearchProvider().Settings.IsKnowledgeSearchInsightsEnabled});MscrmControls.KbCommonUtils.TelemetryReporter.LogInfo(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.KbSearch_Control_Initialized,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,eventParams:eventParams})};KbSearchControl.prototype.getArticleTitle=function(){var articleTitleID=this._context.accessibility.getUniqueId("articleTitle");return articleTitleID};KbSearchControl.prototype.onKeyDownSkipContent=function(keyEvent){if(this._stateManager.records&&keyEvent.keyCode==KbSearchControl_1.Constants.Letter_E_KeyCode&&keyEvent.altKey){var articleIndex=$('[id="'+this.getArticleTitle()+'"]');if(articleIndex.length>0){var articleIndexCount=articleIndex.length-1;if(articleIndexCount!=0){articleIndex[articleIndexCount].focus();this._stateManager.SetSelectedArticle(this._stateManager.records[articleIndexCount],this._context)}}}};KbSearchControl.prototype.isShowSelectedDialogOptionVisible=function(){return MscrmControls.KbCommonUtils.CommonUtils.IsLoadedInDialog(this._context)&&this._context.parameters.WrapperContext.DialogContext.isMultiSelect&&this._context.parameters.WrapperContext.DialogContext.SelectedRecords&&Object.keys(this._context.parameters.WrapperContext.DialogContext.SelectedRecords).length>0};KbSearchControl.prototype.setRuntimeFilters=function(value){this._stateManager.ExecuteKbSearchHelper.enableMetadataFiltering=value;this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()};KbSearchControl.prototype.handleSearchWidgetActionResult=function(){var _this_1=this;if(this.Context.parameters.value.searchWidgetActionResult)if(this._stateManager.PreviousActionExecutionId!=this.Context.parameters.value.searchWidgetActionResult.action.ActionExecutionId){this._stateManager.PreviousActionExecutionId=this.Context.parameters.value.searchWidgetActionResult.action.ActionExecutionId;switch(this.Context.parameters.value.searchWidgetActionResult.action.Id){case MscrmControls.KbCommonUtils.ArticleAction.OpenResult:var filteredRecords=void 0;if(this._context.utils.isFeatureEnabled(KbSearchControl_1.Constants.UCKMControlRelevanceSearch)&&this._stateManager.isExternalSearchIndexEnabled)filteredRecords=this.kbRelevanceSearchRecordCollection.filter(function(item){return item.knowledgeArticleId===_this_1.Context.parameters.value.searchWidgetActionResult.payload.articleId});else filteredRecords=this._stateManager.records.filter(function(item){return item.knowledgeArticleId===_this_1.Context.parameters.value.searchWidgetActionResult.payload.articleId});var operationPayload={controlContext:this.Context,record:filteredRecords[0],fetchApiWrapper:this.fetchApiWrapper,stateManager:this._stateManager};MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(MscrmControls.KbCommonUtils.ArticleAction.OpenResult,operationPayload);break;default:break}}};KbSearchControl.prototype.handleSortFilterChange=function(selectedSortOrder){if(this._stateManager.SortFilter.SelectedSortFilter&&selectedSortOrder&&this._stateManager.SortFilter.SelectedSortFilter.Value!=selectedSortOrder.Value){MscrmControls.KbCommonUtils.TelemetryReporter.LogInfo(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Sort_Order_Changed,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,eventParams:[{name:"SelectedSortOrder",value:selectedSortOrder.Label}]});this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.SortFilter.SelectedSortFilter=selectedSortOrder;this._stateManager.ReportEventToTelemetry(KbSearchControl_1.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.SortChanged]);this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype.buildFilterConfig=function(){var filterDetails=[],filterConfig={filterDetails:filterDetails,isCloseable:true,shouldGainDefaultFocus:this._stateManager.shouldFiltersGainDefaultFocus};this._stateManager.shouldFiltersGainDefaultFocus=false;var statusFilterOptions=[],visibilityFilterOptions=[],dateFilterOptions=[];if(!this._stateManager.selectedStateCode)this._stateManager.selectedStateCode=this._stateManager.ArticleStatusFilter.SelectedItemStateCode();if(!this._stateManager.selectedLanguage)this._stateManager.selectedLanguage=this._stateManager.ArticleLanguageFilter.DefaultLanguageLocaleId.text;statusFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.AllDraftArticlesLocale,value:KbSearchControl_1.ArticleStatusFilterOption.Draft.toString(),isSelected:KbSearchControl_1.ArticleStatusFilterOption.Draft.toString()==this._stateManager.selectedStateCode});statusFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.AllApprovedArticlesLocale,value:KbSearchControl_1.ArticleStatusFilterOption.Approved.toString(),isSelected:KbSearchControl_1.ArticleStatusFilterOption.Approved.toString()==this._stateManager.selectedStateCode});statusFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.AllPublishedArticlesLocale,value:KbSearchControl_1.ArticleStatusFilterOption.Published.toString(),isSelected:KbSearchControl_1.ArticleStatusFilterOption.Published.toString()==this._stateManager.selectedStateCode});this.Context.parameters.value.descriptors.showArticleStatusFilter&&this.Context.parameters.value.descriptors.articleStatusFilter&&this._stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider().SearchType!=KbSearchControl_1.SearchType.MicrosoftSearch&&filterDetails.push({filterOptions:statusFilterOptions,name:KbSearchControl_1.KbSearchControlLocale.ArticleStatusFilterText,value:KbSearchControl_1.Constants.ArticleStatusFilter,isMultiSelect:false,isExpanded:this._stateManager.isArticleStatusFilterExpanded});visibilityFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.InternalArticlesText,value:KbSearchControl_1.Constants.IsInternal,isSelected:this._stateManager.selectedVisibility==true.toString()});visibilityFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.ExternalArticlesText,value:KbSearchControl_1.Constants.IsExternal,isSelected:this._stateManager.selectedVisibility==false.toString()});visibilityFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.FilterOptionAllText,value:null,isSelected:this._stateManager.selectedVisibility==null});this._stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider().SearchType!=KbSearchControl_1.SearchType.MicrosoftSearch&&filterDetails.push({filterOptions:visibilityFilterOptions,name:KbSearchControl_1.KbSearchControlLocale.ArticleVisibilityFilterText,value:KbSearchControl_1.Constants.ArticleVisibilityFilter,isMultiSelect:false,isExpanded:this._stateManager.isArticleVisibilityFilterExpanded});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.Last7DaysText,value:KbSearchControl_1.DateFilterOptions.Last7Days.toString(),isSelected:KbSearchControl_1.DateFilterOptions.Last7Days==this._stateManager.selectedDateRange});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.Last30DaysText,value:KbSearchControl_1.DateFilterOptions.LastXDays.toString(),isSelected:KbSearchControl_1.DateFilterOptions.LastXDays==this._stateManager.selectedDateRange});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.Last6MonthsText,value:KbSearchControl_1.DateFilterOptions.LastXMonths.toString(),isSelected:KbSearchControl_1.DateFilterOptions.LastXMonths==this._stateManager.selectedDateRange});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.LastYearText,value:KbSearchControl_1.DateFilterOptions.LastXYears.toString(),isSelected:KbSearchControl_1.DateFilterOptions.LastXYears==this._stateManager.selectedDateRange});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.FilterOptionAllText,value:null,isSelected:this._stateManager.selectedDateRange==null});filterDetails.push({filterOptions:dateFilterOptions,name:KbSearchControl_1.KbSearchControlLocale.ArticleDateFilterText,value:KbSearchControl_1.Constants.ArticleDateFilter,isMultiSelect:false,isExpanded:this._stateManager.isArticleDateFilterExpanded});var defaultLangLocaleId=this._stateManager.ArticleLanguageFilter.DefaultLanguageLocaleId.text;if(this.Context.parameters.value.descriptors.showLanguageFilter&&this._stateManager.ArticleLanguageFilter.languageFilterOptions.length>0&&this._stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider().SearchType!=KbSearchControl_1.SearchType.MicrosoftSearch){var activeLanguagesFilterOptions=[];if(!this._stateManager.langFetchXmlResult||this._stateManager.langFetchXmlResult.length==0)activeLanguagesFilterOptions.push({label:this._stateManager.ArticleLanguageFilter.GetLanguageOptionByLanguageLocaleId(defaultLangLocaleId).Label,value:defaultLangLocaleId,isSelected:this._stateManager.selectedLanguage==defaultLangLocaleId});else for(var _i=0,_a=this._stateManager.langFetchXmlResult;_i<_a.length;_i++){var entity=_a[_i],languageLocaleId=entity._languagelocaleid_value,languageOption=this._stateManager.ArticleLanguageFilter.GetLanguageOptionByLanguageLocaleId(languageLocaleId);activeLanguagesFilterOptions.push({label:languageOption.Label,value:languageLocaleId,isSelected:languageLocaleId==this._stateManager.selectedLanguage})}filterDetails.push({filterOptions:activeLanguagesFilterOptions,name:KbSearchControl_1.KbSearchControlLocale.ArticleLanguageFilterText,value:KbSearchControl_1.Constants.ArticleLanguageFilter,isMultiSelect:false,isExpanded:this._stateManager.isArticleLanguageFilterExpanded})}return filterConfig};KbSearchControl.prototype.filterChangedCallback=function(filterOutput){var _this_1=this,filterState=filterOutput.state,filterDetails=filterOutput.value;if(filterDetails!=null&&filterState==MscrmControls.VirtualFilterControl.RequestedCallbackState.Update){filterDetails.forEach(function(filter){var filterOptions=filter.filterOptions,selectedFilterOptions=filterOptions.filter(function(x){return x.isSelected==true});if(filter.value!=null&&filterOptions!=null)switch(filter.value){case KbSearchControl_1.Constants.ArticleStatusFilter:_this_1._stateManager.selectedStateCode=selectedFilterOptions[0].value;break;case KbSearchControl_1.Constants.ArticleVisibilityFilter:if(selectedFilterOptions[0].value==KbSearchControl_1.Constants.IsInternal)_this_1._stateManager.selectedVisibility="true";else if(selectedFilterOptions[0].value==KbSearchControl_1.Constants.IsExternal)_this_1._stateManager.selectedVisibility="false";else if(selectedFilterOptions[0].value==null)_this_1._stateManager.selectedVisibility=null;break;case KbSearchControl_1.Constants.ArticleDateFilter:if(selectedFilterOptions[0].value!=null)_this_1._stateManager.selectedDateRange=parseInt(selectedFilterOptions[0].value);else _this_1._stateManager.selectedDateRange=null;break;case KbSearchControl_1.Constants.ArticleLanguageFilter:if(selectedFilterOptions[0].value!=null)_this_1._stateManager.selectedLanguage=selectedFilterOptions[0].value;else _this_1._stateManager.selectedLanguage=_this_1._stateManager.ArticleLanguageFilter.DefaultLanguageLocaleId.text;_this_1._context.utils.requestRender();break}});this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}else if(filterDetails!=null&&filterState==MscrmControls.VirtualFilterControl.RequestedCallbackState.Close){this._stateManager.filtersVisible=!this._stateManager.filtersVisible;this._context.utils.requestRender(function(){_this_1._context.accessibility.focusElementById(KbSearchControl_1.Constants.FilterIconId+KbSearchControl_1.Constants.IconIdButtonPostfix)})}else if(filterDetails!=null&&filterState==MscrmControls.VirtualFilterControl.RequestedCallbackState.Clear){this._stateManager.selectedStateCode=this._stateManager.ArticleStatusFilter.SelectedItemStateCode();this._stateManager.selectedLanguage=this._stateManager.ArticleLanguageFilter.DefaultLanguageLocaleId.text;this._stateManager.selectedVisibility=null;this._stateManager.selectedDateRange=null;this._context.utils.requestRender();this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}else if(filterDetails!=null&&filterState==MscrmControls.VirtualFilterControl.RequestedCallbackState.ExpandChange){filterDetails.forEach(function(filter){if(filter)switch(filter.value){case KbSearchControl_1.Constants.ArticleStatusFilter:_this_1._stateManager.isArticleStatusFilterExpanded=filter.isExpanded;break;case KbSearchControl_1.Constants.ArticleVisibilityFilter:_this_1._stateManager.isArticleVisibilityFilterExpanded=filter.isExpanded;break;case KbSearchControl_1.Constants.ArticleDateFilter:_this_1._stateManager.isArticleDateFilterExpanded=filter.isExpanded;break;case KbSearchControl_1.Constants.ArticleLanguageFilter:_this_1._stateManager.isArticleLanguageFilterExpanded=filter.isExpanded;break}});this._context.utils.requestRender()}};KbSearchControl.prototype.StandaloneControlMaxHeight=function(isExpandedMode){if(MscrmControls.KbCommonUtils.CommonUtils.IsMultisessionHost(this.Context)&&!MscrmControls.KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(this.Context)){var tabElement=document.getElementById("tabcontent");if(tabElement!=null)return tabElement.clientHeight}var searchTextBox=document.querySelector('[data-id$="rendersearchboxrow"]'),resultCountAndSortFilterDiv=document.querySelector('[data-id$="resultCountAndSortFilterDivId"]'),filterContainerDivHeight=0,buffer=0;if(this.IsEdgeOrIE&&this._stateManager.filtersVisible){filterContainerDivHeight=searchTextBox.clientHeight;if(!isExpandedMode){var resultContainerDiv=document.querySelector('[data-id$="resultCountAndSortFilterDivId"]');filterContainerDivHeight+=resultContainerDiv.clientHeight}buffer=0}return window.innerHeight-(typeof searchTextBox!="undefined"&&searchTextBox!=null?searchTextBox.clientHeight:10)-(typeof resultCountAndSortFilterDiv!="undefined"&&resultCountAndSortFilterDiv!=null?resultCountAndSortFilterDiv.clientHeight:19)-filterContainerDivHeight-buffer};KbSearchControl.prototype.UpdateActiveLanguages=function(){if(this.activeLanguages&&this._stateManager.ArticleLanguageFilter.languageFilterOptions.length==0){this._stateManager.ArticleLanguageFilter.SetLanguageFilters(this.activeLanguages);var useState=MscrmControls.KbCommonUtils.FCBUtil.IsStatePersistenceEnabled(this._context)&&this._state&&this._state.searchState&&!this._state.searchState.loading;if(useState){if(this._stateManager.loading)this._stateManager.loading=false}else this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype.updateView=function(context){var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"updateView");this.Context=context;if(this.isInitialized){if(context.utils.isFeatureEnabled(KbSearchControl_1.Constants.UCKMControlRelevanceSearch)&&this._stateManager.isExternalSearchIndexEnabled)this._isRelevanceSearchSyncStatusValid=this._validateRelevanceSearchSyncStatus()}else return this.initLoader();if(MscrmControls.KbCommonUtils.CommonUtils.IsHostedInMultisessionStandaloneMode(this.Context)&&!this.isTitleSetForStandAloneMode){MscrmControls.KbCommonUtils.MultisessionUtils.SetAppTabTitle(KbSearchControl_1.KbSearchControlLocale.StandalonePageTitle);this.isTitleSetForStandAloneMode=true}if(this._isRelevanceSearchSyncStatusValid){if(context.utils.isFeatureEnabled(KbSearchControl_1.Constants.UCKMControlRelevanceSearch)&&this._stateManager.isExternalSearchIndexEnabled)this.kbRelevanceSearchRecordCollection=this._stateManager.getRelevanceSearchRecordsToDisplay();this.handleSearchWidgetActionResult();this.UpdateActiveLanguages();this.handleFilterQuery();this.handleNumberOfResults();this.handleSearchQueryUpdate();var statePersistenceEnabled=MscrmControls.KbCommonUtils.FCBUtil.IsStatePersistenceEnabled(this._context);(this.isInitialized&&!statePersistenceEnabled||!this._state)&&this._stateManager.ExecuteKbSearchHelper.UpdateAutoSuggestionsFormField()}this._stateManager.shouldShowSelected&&this._stateManager.LoadSelectedArticles();if(!this._stateManager.GetIsSearchMode()&&MscrmControls.KbCommonUtils.CommonUtils.IsReferencePanel(this._context)&&this._context.parameters.value.records&&this._context.parameters.value.records.length>0)for(var record=this._context.parameters.value.records&&this._context.parameters.value.records[0],_i=0,_a=this._stateManager.ExecuteKbSearchHelper.getSearchProviders();_i<_a.length;_i++){var searchProvider=_a[_i];if(record.searchProviderId===searchProvider.SearchProviderId){this._stateManager.ExecuteKbSearchHelper.setSelectedSearchProvider(searchProvider);break}}this._stateManager.SetAvailableArticleActions();var result=this.renderControl();watermarkTelemetryEvent.End();this.handleInitialFocusInStandAloneMode();this.handleScrollPositionForStatePersistence();this._stateManager.SetArticleSelectedInPreviousRender();return result};KbSearchControl.prototype.initLoader=function(){var _this_1=this,dataBlock=[];dataBlock.push(this.renderLoading());var controlMaxHeight=this.StandaloneControlMaxHeight(true),searchControlContainerId="searchControlContainer",addPadding=!MscrmControls.KbCommonUtils.CommonUtils.IsReferencePanel(this.Context),searchAndDataBlockContainerId=KbSearchControl_1.Constants.SearchAndDataBlockContainerId,scrollingDataBlockContainer=this.Context.factory.createElement("SCROLLCONTAINER",{id:searchAndDataBlockContainerId,key:searchAndDataBlockContainerId,style:{flexDirection:"column",flexGrow:1,flexShrink:1,overflowY:"auto",overflowX:"hidden",paddingLeft:addPadding&&!this._stateManager.GetIsSearchMode()?this._context.theming.measures.measure100:"inherit",paddingRight:addPadding&&!this._stateManager.GetIsSearchMode()?this._context.theming.measures.measure100:"inherit"}},dataBlock),result=this.Context.factory.createElement("CONTAINER",{id:searchControlContainerId,key:searchControlContainerId,className:"mscrm-kbSearchContainer",style:{width:"100%",height:"auto",minHeight:"inherit",display:"flex",flexDirection:"column",maxHeight:controlMaxHeight,backgroundColor:this._context.theming.colors.whitebackground,overflowX:"hidden",overflowY:"hidden",fontFamily:this._context.theming.fontfamilies.regular},onKeyDown:function(event){return _this_1.onKeyDownSkipContent(event)}},scrollingDataBlockContainer);return result};KbSearchControl.prototype.handleInitialFocusInStandAloneMode=function(){var _this_1=this;if(!MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this.Context))return;if(!this.isInitialFocusSetOnStandAloneMode){window.setTimeout(function(){_this_1._context.accessibility.focusElementById(KbSearchControl_1.Constants.SearchTextBoxId)},0);this.isInitialFocusSetOnStandAloneMode=true}var selectedArticle=this._stateManager.GetSelectedArticle();if(this._stateManager.IsExpandedMode&&selectedArticle!=null&&selectedArticle!=this._stateManager.GetArticleSelectedInPreviousRender()){var count=0,kbSearchResult=this._stateManager.GetKbSearchResult(selectedArticle);if(kbSearchResult&&kbSearchResult.articleActions)count=kbSearchResult.articleActions.length;count>0&&window.setTimeout(function(){var elementId="searchResultActionsDropdown_0_Action_"+selectedArticle.knowledgeArticleId;_this_1._context.accessibility.focusElementById(elementId)},0)}};KbSearchControl.prototype.handleScrollPositionForStatePersistence=function(){var _this_1=this;if(!MscrmControls.KbCommonUtils.FCBUtil.IsStatePersistenceEnabled(this._context))return;window.setTimeout(function(){var searchBlockId=_this_1._context.accessibility.getUniqueId(KbSearchControl_1.Constants.SearchAndDataBlockContainerId);if(searchBlockId!=null){var element=document.getElementById(searchBlockId);if(element!=null&&_this_1._stateManager.searchResultsScrollPos!=0){element.scrollTop=_this_1._stateManager.searchResultsScrollPos;_this_1._stateManager.searchResultsScrollPos=0}}var filterBlockParentId=_this_1._context.accessibility.getUniqueId("VirtualFilterControlContainer");if(filterBlockParentId!=null){var parent_1=document.getElementById(filterBlockParentId);if(parent_1!=null){var element=parent_1.querySelector(".webkitScroll");if(element!=null&&_this_1._stateManager.filterPaneScrollPos!=0){element.scrollTop=_this_1._stateManager.filterPaneScrollPos;_this_1._stateManager.filterPaneScrollPos=0}}}},0)};KbSearchControl.prototype.handleSearchQueryUpdate=function(){this._stateManager.ExecuteKbSearchHelper.HandleCurrentSearchTextChanged(this.Context)};KbSearchControl.prototype._validateRelevanceSearchSyncStatus=function(){var isRelevanceSearchSyncStatusValid=this._validateEntitySyncStatus(this._stateManager.knowledgeArticleAttributeList,KbSearchControl_1.Constants.KnowledgeArticle_MandatoryFields);return isRelevanceSearchSyncStatusValid};KbSearchControl.prototype._validateEntitySyncStatus=function(entityQVFViewColumns,entityMandatoryFields){if(entityQVFViewColumns&&entityQVFViewColumns.length>0)return entityMandatoryFields.every(function(mandatoryField){return entityQVFViewColumns.indexOf(mandatoryField)>-1})&&this._validateAdditionalFilterStatus(entityQVFViewColumns);return false};KbSearchControl.prototype._validateAdditionalFilterStatus=function(entityQVFViewColumns){return !this._context.utils.isFeatureEnabled(KbSearchControl_1.Constants.MetadataDrivenFilterForKbSearch)||!this.Context.parameters.value.descriptors.enableMDF||Object.keys(this._stateManager.ExecuteKbSearchHelper.additionalKnowledgeArticleFilters).every(function(additionalFilter){return entityQVFViewColumns.indexOf(additionalFilter)>-1})};KbSearchControl.prototype.renderControl=function(){this.kbSearchResultAccessibilityText="";this.kbSearchErrorAccessibilityText="";this.initView();var renderParams=this.getViewRenderParams();return this.view.render(renderParams)};KbSearchControl.prototype.IsKBSearchFilterEnabled=function(){try{var urlParams=new URLSearchParams(window.location.search),showFilterValue=urlParams.get(KbSearchControl_1.Constants.ShowFilterString);return showFilterValue!=KbSearchControl_1.Constants.ShowFilterOff}catch(ex){return true}};KbSearchControl.prototype.getUsedHeightOfControl=function(){var usedHeight=0,controlBlockContainer=document.getElementById(this._context.accessibility.getUniqueId("controlBlockContainer"));if(controlBlockContainer)usedHeight+=controlBlockContainer.clientHeight;return usedHeight};KbSearchControl.prototype.renderLoading=function(){var progressIndicator=this.Context.factory.createElement("PROGRESSINDICATOR",{key:"kbsearchprogressIndicator",id:"kbsearchprogressIndicator",style:{width:"40px",height:"40px",display:"table",margin:"0 auto"},progressType:"ring",testhooks:{id:"kbsearchsearch-progress-indicator"},active:true},[]),LoadingText=this.Context.factory.createElement("Label",{id:"LoadingTextLabelId",key:"LoadingTextLabel",className:"LoadingTextLabel",style:{paddingTop:"50px"}},KbSearchControl_1.KbSearchControlLocale.LoadingTextLocale),progressIndicatorContainer=this.Context.factory.createElement("CONTAINER",{key:"kbsearchprogressIndicatorContainer",style:{display:"flex",position:"relative",alignSelf:"center",padding:"50px",margin:"0 auto"}},[progressIndicator,LoadingText]);return progressIndicatorContainer};KbSearchControl.prototype.handleSearchProviderDropDownClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._showSearchProviderDropDown=!this._showSearchProviderDropDown;this._context.utils.requestRender()}};KbSearchControl.prototype.isReflowControlCanBeActive=function(){return false};KbSearchControl.prototype.requestRenderIfNecessary=function(){if(this._stateManager.requestAdditionalRendering){this._stateManager.requestAdditionalRendering=false;var _this=this;setTimeout(function(){return _this.Context.utils.requestRender()},0)}};KbSearchControl.prototype.resetAdditionalRendering=function(){this._stateManager.requestAdditionalRendering=true};KbSearchControl.prototype.handleFilterQuery=function(){var needsToChange=true;if(this.Context.parameters.value.filterQueryParams){switch(this.Context.parameters.value.filterQueryParams.command){case KbSearchControl_1.SearchWidgetCommand.ArticlesFilter:needsToChange=this._stateManager.ArticleStatusFilter.SetSelectedArticleStatusFilterByFilterOption(this.Context.parameters.value.filterQueryParams.value);break;case KbSearchControl_1.SearchWidgetCommand.SortFilter:needsToChange=this._stateManager.SortFilter.SetSelectedSortFilterBySortOption(this.Context.parameters.value.filterQueryParams.value);break;case KbSearchControl_1.SearchWidgetCommand.LanguageFilter:needsToChange=this._stateManager.ArticleLanguageFilter.SetSelectedArticleLanguageFilterByFilterOption(this.Context.parameters.value.filterQueryParams.value);break;default:needsToChange=false;break}needsToChange&&this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype.handleNumberOfResults=function(){if(this._context.parameters.value.descriptors.numberOfResults!==this._stateManager.numberOfResults){this._stateManager.numberOfResults=this._context.parameters.value.descriptors.numberOfResults;this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype.handleWindowResize=function(){};KbSearchControl.prototype.handleSortButtonClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._showSortList=!this._showSortList;this._context.utils.requestRender()}};KbSearchControl.prototype.handleShowSelectedButtonClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._stateManager.shouldShowSelected=!this._stateManager.shouldShowSelected;if(!this._stateManager.shouldShowSelected){this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.ResetSelectedArticle();this._stateManager.SetIsSearchMode(true,this._context);this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}else this._context.utils.requestRender()}};KbSearchControl.prototype.handleFilterButtonClick=function(){if(!this._context.parameters.value.isControlDisabled){this._stateManager.filtersVisible=!this._stateManager.filtersVisible;if(this._stateManager.filtersVisible)this._stateManager.shouldFiltersGainDefaultFocus=true;this._context.utils.requestRender()}};KbSearchControl.prototype.onSortFlyoutOutsideClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._showSortList=false;this._context.utils.requestRender()}};KbSearchControl.prototype.handleSortFlyoutItemClick=function(event){var selectedSortOrder;if(event.type==KbSearchControl_1.Constants.KeyDownEventType&&event.keyCode==KbSearchControl_1.Constants.EscapeKeyCode){this._showSortList=false;var focusElementId=KbSearchControl_1.Constants.SortIconId+KbSearchControl_1.Constants.IconIdButtonPostfix;document.getElementById(this._context.accessibility.getUniqueId(focusElementId)).focus();this._context.utils.requestRender();return}var isMicrosoftSearch=this._stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider().SearchType==KbSearchControl_1.SearchType.MicrosoftSearch;switch(event&&event.currentTarget&&event.currentTarget.id){case this.Context.accessibility.getUniqueId(KbSearchControl_1.Constants.RelevanceSortId):if(event.type==KbSearchControl_1.Constants.ClickEventType||event.type==KbSearchControl_1.Constants.KeyDownEventType&&event.keyCode==KbSearchControl_1.Constants.EnterKeyCode)selectedSortOrder=this._stateManager.SortFilter.CreateOption(KbSearchControl_1.KbSearchControlLocale.RelevanceLocale,KbSearchControl_1.KbSearchControlLocale.RelevanceLocale,KbSearchControl_1.SearchResultSortOption.Relevance);if(event.type==KbSearchControl_1.Constants.KeyDownEventType){event.keyCode==KbSearchControl_1.Constants.DownArrowKeyCode&&event.currentTarget.nextElementSibling.focus();event.keyCode==KbSearchControl_1.Constants.UpArrowKeyCode&&document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl_1.Constants.LastModifiedDateOldestFirstLocaleSortId)).focus()}break;case this.Context.accessibility.getUniqueId(KbSearchControl_1.Constants.NumberOfViewsLocaleSortId):if(event.type==KbSearchControl_1.Constants.ClickEventType||event.type==KbSearchControl_1.Constants.KeyDownEventType&&event.keyCode==13)selectedSortOrder=this._stateManager.SortFilter.CreateOption(KbSearchControl_1.KbSearchControlLocale.NumberOfViewsLocale,KbSearchControl_1.KbSearchControlLocale.NumberOfViewsLocale,KbSearchControl_1.SearchResultSortOption.NumberOfViews);if(event.type==KbSearchControl_1.Constants.KeyDownEventType){event.keyCode==KbSearchControl_1.Constants.DownArrowKeyCode&&event.currentTarget.nextElementSibling.focus();event.keyCode==KbSearchControl_1.Constants.UpArrowKeyCode&&event.currentTarget.previousElementSibling.focus()}break;case this.Context.accessibility.getUniqueId(KbSearchControl_1.Constants.LastModifiedDateNewestFirstLocaleSortId):if(event.type==KbSearchControl_1.Constants.ClickEventType||event.type==KbSearchControl_1.Constants.KeyDownEventType&&event.keyCode==KbSearchControl_1.Constants.EnterKeyCode)selectedSortOrder=this._stateManager.SortFilter.CreateOption(KbSearchControl_1.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,KbSearchControl_1.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,KbSearchControl_1.SearchResultSortOption.LastModifiedDateNewestFirst);if(event.type==KbSearchControl_1.Constants.KeyDownEventType){event.keyCode==KbSearchControl_1.Constants.DownArrowKeyCode&&event.currentTarget.nextElementSibling.focus();if(event.keyCode==KbSearchControl_1.Constants.UpArrowKeyCode)if(!isMicrosoftSearch)event.currentTarget.previousElementSibling.focus();else document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl_1.Constants.LastModifiedDateOldestFirstLocaleSortId)).focus()}break;case this.Context.accessibility.getUniqueId(KbSearchControl_1.Constants.LastModifiedDateOldestFirstLocaleSortId):if(event.type==KbSearchControl_1.Constants.ClickEventType||event.type==KbSearchControl_1.Constants.KeyDownEventType&&event.keyCode==KbSearchControl_1.Constants.EnterKeyCode)selectedSortOrder=this._stateManager.SortFilter.CreateOption(KbSearchControl_1.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,KbSearchControl_1.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,KbSearchControl_1.SearchResultSortOption.LastModifiedDateOldestFirst);if(event.type==KbSearchControl_1.Constants.KeyDownEventType){if(event.keyCode==KbSearchControl_1.Constants.DownArrowKeyCode){var focusElementId_1=!isMicrosoftSearch?KbSearchControl_1.Constants.RelevanceSortId:KbSearchControl_1.Constants.LastModifiedDateNewestFirstLocaleSortId;document.getElementById(this._context.accessibility.getUniqueId(focusElementId_1)).focus()}event.keyCode==KbSearchControl_1.Constants.UpArrowKeyCode&&event.currentTarget.previousElementSibling.focus()}break;default:break}if(selectedSortOrder!=null){this._showSortList=false;this.handleSortFilterChange(selectedSortOrder);this._stateManager.SortFilter.SetSelectedSortFilterBySortOption(selectedSortOrder.Value)}};KbSearchControl.prototype.onSearchProviderFlyoutOutsideClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._showSearchProviderDropDown=false;this._context.utils.requestRender()}};KbSearchControl.prototype.handleSearchProviderFlyoutItemClick=function(event){if(!event||!event.currentTarget||!event.currentTarget.id){this.onSearchProviderFlyoutOutsideClick(event);return}var currentSearchProvider=this._stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider();if(currentSearchProvider&&currentSearchProvider.SearchProviderId&&this.Context.accessibility.getUniqueId(currentSearchProvider.SearchProviderId)==event.currentTarget.id){this.onSearchProviderFlyoutOutsideClick(event);return}for(var _i=0,_a=this._stateManager.ExecuteKbSearchHelper.getSearchProviders();_i<_a.length;_i++){var searchProvider=_a[_i];if(this.Context.accessibility.getUniqueId(searchProvider.SearchProviderId)==event.currentTarget.id){this._stateManager.ExecuteKbSearchHelper.setSelectedSearchProvider(searchProvider);KbSearchControl_1.KbSearchActionUtility.UpdateSearchProviderStateInContext(this._context,searchProvider);this._stateManager.SetIsSearchMode(true,this.Context);this._stateManager.ResetSelectedArticle();this._stateManager.clickKbArticleId="";if(!searchProvider.IsLoading&&!searchProvider.SearchResult.IsKnowledgeSearchInsightRecordCreated&&this._stateManager.isKnowledgeSearchInsightsEnabled){this._stateManager.ExecuteKbSearchHelper.SendKnowledgeSearchInsightRecord(searchProvider);searchProvider.SearchResult.IsKnowledgeSearchInsightRecordCreated=true}break}}this._showSearchProviderDropDown=false;this._context.utils.requestRender()};KbSearchControl.prototype.getOutputs=function(){return null};KbSearchControl.prototype.destroy=function(){this.fetchApiWrapper.Destroy();this.KbSearchResultArticleInfoObject&&this.KbSearchResultArticleInfoObject.destroy();this.KbSearchResultContentPaneObject&&this.KbSearchResultContentPaneObject.destroy();MscrmControls.KbCommonUtils.FCBUtil.IsStatePersistenceEnabled(this._context)&&this.isInitialized&&KbSearchControl_1.StateUtil.SaveState(this._context,this._stateManager,this._state);var proxyInstance=MscrmControls.KbCommonUtils.WindowPostMessageProxy.Instance();proxyInstance&&proxyInstance.deregister();MscrmControls.KbCommonUtils.CommonUtils.IsMultisessionHost(this._context)&&KbSearchControl_1.StateManager.Destroy(this._context.parameters.value.controlId)};KbSearchControl.prototype.onPreNavigation=function(){};KbSearchControl.prototype.getViewInitParams=function(){var initParams={CreateElement:this.Context.factory.createElement.bind(this.Context.factory),CreateComponent:this.Context.factory.createComponent.bind(this.Context.factory),FocusElementById:this.Context.accessibility.focusElementById.bind(this.Context.accessibility),GetUniqueId:this.Context.accessibility.getUniqueId.bind(this.Context.accessibility),GetString:this.Context.resources.getString.bind(this.Context.resources),FormatTime:this.Context.formatting.formatTime.bind(this.Context.formatting),StartWatermarkEvent:this.StartWatermarkEvent.bind(this),AddErrorLog:this.AddErrorLog.bind(this),HandleSearchBoxKeyPress:this.SearchBoxContainerObject.onKeyDown.bind(this.SearchBoxContainerObject),HandleSearchBoxKeyDown:this.SearchBoxContainerObject.handleKeyDownPress.bind(this.SearchBoxContainerObject),HandleSearchBoxChange:this.SearchBoxContainerObject.onTextBoxChanged.bind(this.SearchBoxContainerObject),HandleSearchBoxFocus:this.SearchBoxContainerObject.handleOnFocus.bind(this.SearchBoxContainerObject),HandleSearchBoxBlur:this.SearchBoxContainerObject.handleOnBlur.bind(this.SearchBoxContainerObject),HandleSearchButtonPress:this.SearchBoxContainerObject.handleSearchPress.bind(this.SearchBoxContainerObject),HandleSearchButtonClick:this.SearchBoxContainerObject.handleSearchButtonClick.bind(this.SearchBoxContainerObject),HandleCloseButtonPress:this.SearchBoxContainerObject.handleClosePress.bind(this.SearchBoxContainerObject),HandleCloseButtonClick:this.SearchBoxContainerObject.onClearTextClicked.bind(this.SearchBoxContainerObject),HandleCloseAndSearchIconsVisibilty:this.SearchBoxContainerObject.handleCloseAndSearchIconsVisibilty.bind(this.SearchBoxContainerObject),ToggleSearchResultActionMenu:this.SearchResultActionObject.toggleMenu.bind(this.SearchResultActionObject),HandleSearchResultActionClick:this.SearchResultActionObject.handleArticleActionClick.bind(this.SearchResultActionObject),HandleSearchResultActionKeyDown:this.SearchResultActionObject.handleSearchResultActionsDropdownInlineActionKeyDown.bind(this.SearchResultActionObject),HandleMenuFlyoutKeyDown:this.SearchResultActionObject.handleMenuFlyoutButtonPress.bind(this.SearchResultActionObject),HandleMenuFlyoutOptionKeyDown:this.SearchResultActionObject.handleFlyoutOptionKeyDown.bind(this.SearchResultActionObject),HandleArticleTitleKeyDown:this.SearchResultObject.handleKeyDownPress.bind(this.SearchResultObject),HandleArticleTitleClick:this.SearchResultObject.renderArticleContent.bind(this.SearchResultObject),HandleSearchResultClick:this.SearchResultObject._articleContainerClick.bind(this.SearchResultObject),HandleLoadMoreButtonClick:this.SearchResultObject.handleLoadMoreButtonClick.bind(this.SearchResultObject),HandleLoadMoreButtonKeyDown:this.SearchResultObject.handleLoadMoreButtonKeyDown.bind(this.SearchResultObject),HandleBackButtonKeyDown:this.SearchActionsObject.handleBackButtonPress.bind(this.SearchActionsObject),HandleBackButtonClick:this.SearchActionsObject.handleBackButtonClick.bind(this.SearchActionsObject),HandleSortButtonClick:this.handleSortButtonClick.bind(this),HandleFilterButtonClick:this.handleFilterButtonClick.bind(this),HandleShowSelectedButtonClick:this.handleShowSelectedButtonClick.bind(this),OnSortFlyoutOutsideClick:this.onSortFlyoutOutsideClick.bind(this),HandleSortFlyoutItemClick:this.handleSortFlyoutItemClick.bind(this),OnSearchProviderFlyoutOutsideClick:this.onSearchProviderFlyoutOutsideClick.bind(this),HandleSearchProviderFlyoutItemClick:this.handleSearchProviderFlyoutItemClick.bind(this),SetRuntimeFilters:this.setRuntimeFilters.bind(this),HandleSearchProviderDropDownClick:this.handleSearchProviderDropDownClick.bind(this),FilterChangedCallback:this.filterChangedCallback.bind(this)};return initParams};KbSearchControl.prototype.getViewRenderParams=function(){var renderParams={theming:this.Context.theming,isMetadataDrivenFilterEnabled:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this.Context,KbSearchControl_1.Constants.MetadataDrivenFilterForKbSearch),isCustomerEnabledForOct2020Wave:MscrmControls.KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave(),isFederatedSearchEnabled:this._stateManager.ExecuteKbSearchHelper.getIsFederatedSearchEnabled(),isRelevanceSearchEnabled:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this.Context,KbSearchControl_1.Constants.UCKMControlRelevanceSearch),resources:this.Context.resources,isOnPremises:this.Context.parameters.value.isOnPremises,showLabel:this.Context.parameters.value.showLabel,label:this.Context.parameters.value.label,hideSearchOnRecordLoad:this.Context.parameters.value.hideSearchOnRecordLoad,enableMDF:this.Context.parameters.value.descriptors.enableMDF,allowDisablingMDFOnUI:this.Context.parameters.value.descriptors.allowDisablingMDFOnUI,isRTL:this.Context.client.isRTL,isReferencePanel:MscrmControls.KbCommonUtils.CommonUtils.IsReferencePanel(this.Context),disableScroll:this.Context.client.disableScroll,isControlDisabled:this._context.parameters.value.isControlDisabled,numberOfResults:this.Context.parameters.value.descriptors.numberOfResults,controlMaxHeight:this.StandaloneControlMaxHeight(!(!this._stateManager.IsExpandedMode||window.IsUSD||this.Context.parameters.value.hideSearchOnRecordLoad)),controlId:this._context.parameters.value.controlId,isExpandedMode:this._stateManager.IsExpandedMode,isSearchMode:this._stateManager.GetIsSearchMode(),isLoading:this._stateManager.loading,searchHasBeenPerformed:this._stateManager.ExecuteKbSearchHelper.SearchHasBeenPerformed,showResults:this._stateManager.getShowResults(this.Context),isExternalSearchIndexEnabled:this._stateManager.isExternalSearchIndexEnabled,records:this._stateManager.records,relevanceSearchRecordCollection:this._stateManager.getRelevanceSearchRecordsToDisplay(),relevanceSearchRecords:this._stateManager.relevanceSearchRecords,searchType:this._stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider().SearchType,showSearchProviderDropDown:this._showSearchProviderDropDown,searchProviders:this._stateManager.ExecuteKbSearchHelper.getSearchProviders(),relevanceSearchMode:this._stateManager.ExecuteKbSearchHelper.mode,selectedSearchProvider:this._stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider(),totalCount:this._stateManager.totalCount,isRelevanceSearchSyncStatusValid:this._isRelevanceSearchSyncStatusValid,searchText:this._stateManager.ExecuteKbSearchHelper.searchText,kbSearchResultCollection:this._stateManager.GetKbSearchResultCollection(),selectedArticle:this._stateManager.GetSelectedArticle(),error:this._stateManager.error,errorMessage:this._stateManager.errorMessage,errorDetails:this._stateManager.errorDetails,formattedErrorMessage:this.getFormattedErrorMessage(),filterConfig:this.buildFilterConfig(),isKBSearchFilterEnabled:this.IsKBSearchFilterEnabled(),isShowSelectedDialogOptionVisible:this.isShowSelectedDialogOptionVisible(),multiselectDialogSelectedRecords:this.isShowSelectedDialogOptionVisible()?this.Context.parameters.WrapperContext.DialogContext.SelectedRecords:null,showSortList:this._showSortList,selectedSortOption:this._stateManager.SortFilter.SelectedSortFilter,isFiltersVisible:this._stateManager.filtersVisible,shouldFiltersGainDefaultFocus:this._stateManager.shouldFiltersGainDefaultFocus,selectedStateCode:this._stateManager.selectedStateCode,showArticleStatusFilter:this.Context.parameters.value.descriptors.showArticleStatusFilter,articleStatusFilter:this.Context.parameters.value.descriptors.articleStatusFilter,selectedVisibility:this._stateManager.selectedVisibility,isArticleStatusFilterExpanded:this._stateManager.isArticleStatusFilterExpanded,isArticleVisibilityFilterExpanded:this._stateManager.isArticleVisibilityFilterExpanded,selectedDateRange:this._stateManager.selectedDateRange,isArticleDateFilterExpanded:this._stateManager.isArticleDateFilterExpanded,defaultLangLocaleId:this._stateManager.ArticleLanguageFilter.DefaultLanguageLocaleId.text,selectedLanguage:this._stateManager.selectedLanguage,isArticleLanguageFilterExpanded:this._stateManager.isArticleLanguageFilterExpanded,articleLanguageFilter:this._stateManager.ArticleLanguageFilter,statusFilterOptions:this._stateManager.ArticleStatusFilter.ArticleFilterOptions,selectedStatusResourceName:this._stateManager.ArticleStatusFilter.SelectedItemResourceName,languageFilterOptions:this._stateManager.ArticleLanguageFilter.languageFilterOptions,selectedLanguageOption:this._stateManager.ArticleLanguageFilter.SelectLanguageOption,sortFilter:this._stateManager.SortFilter,shouldShowSelected:this._stateManager.shouldShowSelected,showLanguageFilter:this.Context.parameters.value.descriptors.showLanguageFilter,showLoadMoreButton:this._stateManager.ExecuteKbSearchHelper.ShowLoadMoreButton(this._stateManager.isExternalSearchIndexEnabled),allocatedWidth:this.Context.client.allocatedWidth,popupEnabled:this._stateManager.popupEnabled,enableMetadataFiltering:this._stateManager.ExecuteKbSearchHelper.enableMetadataFiltering,isSavedQueryApiFailed:this._stateManager.isSavedQueryApiFailed,kbSearchResultAccessibilityText:this.kbSearchResultAccessibilityText,clickedArticleId:this._stateManager.clickKbArticleId,entityDisplayName:this.Context.parameters.value.entityDisplayName,entityTypeName:this.Context.page.entityTypeName,enableRating:this.Context.parameters.value.descriptors.enableRating,enableSelection:this.Context.parameters.value.urlQueryParams&&this.Context.parameters.value.urlQueryParams.enableSelection,userAgent:this.Context.client.userAgent,OnKeyDownSkipContent:this.onKeyDownSkipContent.bind(this),shouldStopandRerenderinPP:this.shouldStopandRerenderinPP.bind(this),setFirstResultRender:this.setFirstResultRender.bind(this),isLoadedInProductivityPanel:MscrmControls.KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(this.Context),kbSearchResultArticleInfoObject:this.getArticleObject(),kbSearchResultContentPaneObject:this.getContentObject(),RequestRenderIfNecessary:this.requestRenderIfNecessary.bind(this),ResetAdditionalRendering:this.resetAdditionalRendering.bind(this)};return renderParams};KbSearchControl.prototype.getContentObject=function(){var _this_1=this;if(!this._stateManager.GetIsSearchMode()){this.KbSearchResultContentPaneObject=this._stateManager.GetkbSearchResultContentPaneObject();var contentControlContext=Object.assign({},this.Context);contentControlContext.parameters.record=this._stateManager.GetSelectedArticle();contentControlContext.setControlState=function(childState,globalSetting,pageLevel){_this_1._state=KbSearchControl_1.StateUtil.setChildControlState(childState,KbSearchControl_1.StateUtil.STATE_KEY_CONTENT,_this_1._state);return true};contentControlContext.shouldSetFocustoRatingControl=function(){var count=0,kbSearchResult=_this_1._stateManager.GetKbSearchResult(_this_1._stateManager.GetSelectedArticle());if(kbSearchResult&&kbSearchResult.articleActions)count=kbSearchResult.articleActions.length;return count==0?true:false};var contentState=KbSearchControl_1.StateUtil.getChildControlState(KbSearchControl_1.StateUtil.STATE_KEY_CONTENT,this._state);this.KbSearchResultContentPaneObject.init(contentControlContext,null,contentState)}return this.KbSearchResultContentPaneObject};KbSearchControl.prototype.getArticleObject=function(){var _this_1=this;if(!this._stateManager.GetIsSearchMode()){this.KbSearchResultArticleInfoObject=this._stateManager.GetkbSearchResultArticleInfoObject();var articleInfoControlContext=Object.assign({},this.Context);articleInfoControlContext.parameters.article=this._stateManager.GetSelectedArticle();articleInfoControlContext.parameters.enableRating=this.Context.parameters.value.descriptors.enableRating;articleInfoControlContext.parameters.entityDisplayName=this.Context.parameters.value.entityDisplayName;articleInfoControlContext.parameters.controlId=this.Context.parameters.value.controlId+"kbarticle";articleInfoControlContext.setControlState=function(childState,globalSetting,pageLevel){_this_1._state=KbSearchControl_1.StateUtil.setChildControlState(childState,KbSearchControl_1.StateUtil.STATE_KEY_ARTICLE,_this_1._state);return true};var articleState=KbSearchControl_1.StateUtil.getChildControlState(KbSearchControl_1.StateUtil.STATE_KEY_ARTICLE,this._state);this.KbSearchResultArticleInfoObject.init(articleInfoControlContext,null,articleState)}return this.KbSearchResultArticleInfoObject};KbSearchControl.prototype.getFormattedErrorMessage=function(){var formattedErrorMessage="";if(this._stateManager.errorMessage==KbSearchControl_1.Constants.KnowledgeManagementNotEnabledErrorMessageResourceName)formattedErrorMessage=MscrmCommon.ControlUtils.String.Format(this.Context.resources.getString(this._stateManager.errorMessage),this.Context.parameters.value.entityDisplayName);else formattedErrorMessage=this.Context.resources.getString(this._stateManager.errorMessage);return formattedErrorMessage};KbSearchControl.prototype.StartWatermarkEvent=function(webResourceName,functionName){return MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this.Context,webResourceName,functionName)};KbSearchControl.prototype.shouldStopandRerenderinPP=function(){if(MscrmControls.KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(this._context)&&this.isFirstResultRender){var scrollingDataBlockContainerId=KbSearchControl_1.Constants.SearchAndDataBlockContainerId,scrollingDataBlockContainer_1=document.getElementById(this._context.accessibility.getUniqueId(scrollingDataBlockContainerId));if(scrollingDataBlockContainer_1==null||scrollingDataBlockContainer_1.offsetParent==null){var self=this;window.setTimeout(function(){scrollingDataBlockContainer_1!=null&&scrollingDataBlockContainer_1.offsetParent!=null&&self._context.utils.requestRender()},0);return true}}return false};KbSearchControl.prototype.setFirstResultRender=function(){this.isFirstResultRender=false};KbSearchControl.prototype.AddErrorLog=function(errorMessage,errorDetails){MscrmControls.KbCommonUtils.TelemetryReporter.LogError(this.Context,{controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:errorMessage,eventParams:[{name:"errorDetails",value:errorDetails}]})};return KbSearchControl}();KbSearchControl_1.KbSearchControl=KbSearchControl})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchActionFactory=function(){function SearchActionFactory(){}SearchActionFactory.prototype.ExecuteAction=function(actionType,actionPayload){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(SearchActionFactory.actionList[actionType])){var action=SearchActionFactory.actionList[actionType]();return action.ExecuteAction(actionPayload)}};SearchActionFactory.Register=function(actionType,action){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(SearchActionFactory.actionList[actionType])){SearchActionFactory.actionList[actionType]=action;return true}return false};SearchActionFactory.Instance=new SearchActionFactory;SearchActionFactory.actionList={};return SearchActionFactory}();KbSearchControl.SearchActionFactory=SearchActionFactory})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var GetAssociatedArticlesSearchAction=function(){function GetAssociatedArticlesSearchAction(){}GetAssociatedArticlesSearchAction.prototype.ExecuteAction=function(actionPayload){var context=actionPayload.controlContext,fetchApiWrapper=actionPayload.fetchApiWrapper,entityTypeName=context.page.entityTypeName,parentEntityId=context.page.entityId,stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId),etn=KbSearchControl.Constants.KnowledgeArticles,fetchXml;if(entityTypeName===KbSearchControl.Constants.Incident){etn=KbSearchControl.Constants.KnowledgeArticleIncidents;fetchXml="<fetch mapping='logical'><entity name='knowledgearticleincident'><attribute name='knowledgearticleid'/><filter type='and'><condition attribute='incidentid' operator='eq' value='"+parentEntityId+"'/><condition attribute='statecode' operator='eq' value='0'/></filter></entity></fetch>"}else{var relation=stateManager.relations;fetchXml="<fetch mapping='logical'><entity name='knowledgearticle'><attribute name='articlepublicnumber' /><link-entity name='"+relation.IntersectEntityName+"' to='knowledgearticleid' from='knowledgearticleid' intersect='true' link-type='inner' alias='b'><filter type='and'><condition attribute= '"+relation.ReferencedEntityColumnName+"' operator='eq' value='"+parentEntityId+"'/></filter></link-entity></entity></fetch>"}var ODataEndPointUri=KbSearchControl.Constants.ODATA_PATH+"/"+etn+"?fetchXml="+fetchXml;return fetchApiWrapper.Fetch(context,MscrmControls.KbCommonUtils.GET_METHOD,ODataEndPointUri).then(function(results){results.value.length>0&&results.value.map(function(result){if(result.knowledgearticleid)stateManager.associatedArticles.push({knowledgeArticleId:result.knowledgearticleid,articlePublicNumber:result.articlepublicnumber});else stateManager.associatedArticles.push({knowledgeArticleId:result._knowledgearticleid_value,articlePublicNumber:result.articlepublicnumber})})},function(errorResponse){MscrmControls.KbCommonUtils.TelemetryReporter.LogError(context,{controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:errorResponse.message,eventParams:[{name:"errorDetails",value:errorResponse.innerror}]})})};GetAssociatedArticlesSearchAction.IsRegistered=KbSearchControl.SearchActionFactory.Register(KbSearchControl.SearchActionType.GetAssociatedArticles,function(){return new GetAssociatedArticlesSearchAction});return GetAssociatedArticlesSearchAction}();KbSearchControl.GetAssociatedArticlesSearchAction=GetAssociatedArticlesSearchAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var GetAssociatedFederatedArticlesSearchAction=function(){function GetAssociatedFederatedArticlesSearchAction(){}GetAssociatedFederatedArticlesSearchAction.prototype.ExecuteAction=function(actionPayload){var context=actionPayload.controlContext,fetchApiWrapper=actionPayload.fetchApiWrapper,parentEntityId=context.page.entityId,stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId),etn=MscrmControls.KbCommonUtils.Constants.FederatedArticleIncident,fetchXml;fetchXml="<fetch mapping='logical'><entity name='"+etn+"'><attribute name='"+MscrmControls.KbCommonUtils.Constants.FederatedSearchProviderArticleId+"'/><attribute name='"+MscrmControls.KbCommonUtils.Constants.FederatedArticleId+"'/><filter type = 'and' > <condition attribute='msdyn_incidentid' operator = 'eq' value = '"+parentEntityId+"'/><condition attribute='statecode' operator='eq' value='0'/></filter></entity></fetch>";var ODataEndPointUri=KbSearchControl.Constants.ODATA_PATH+"/"+MscrmControls.KbCommonUtils.Constants.FederatedArticleIncidents+"?fetchXml="+fetchXml,watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameExecuteKAAssociation,"retrieveAssociatedFederatedKnowledgeArticle");return fetchApiWrapper.Fetch(context,MscrmControls.KbCommonUtils.GET_METHOD,ODataEndPointUri).then(function(results){watermarkTelemetryEvent.End();results.value.length>0&&results.value.map(function(result){stateManager.associatedArticles.push({federatedArticleId:result[MscrmControls.KbCommonUtils.Constants.FederatedArticleIdValue],federatedArticleIncidentId:result[MscrmControls.KbCommonUtils.Constants.FederatedArticleIncidentId],knowledgeArticleId:result[MscrmControls.KbCommonUtils.Constants.FederatedSearchProviderArticleId],articlePublicNumber:""})})},function(errorResponse){watermarkTelemetryEvent.End();MscrmControls.KbCommonUtils.TelemetryReporter.LogError(context,{controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:errorResponse.message,eventParams:[{name:"errorDetails",value:errorResponse.innerror}]})})};GetAssociatedFederatedArticlesSearchAction.IsRegistered=KbSearchControl.SearchActionFactory.Register(KbSearchControl.SearchActionType.GetAssociatedFederatedArticles,function(){return new GetAssociatedFederatedArticlesSearchAction});return GetAssociatedFederatedArticlesSearchAction}();KbSearchControl.GetAssociatedFederatedArticlesSearchAction=GetAssociatedFederatedArticlesSearchAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var IncreaseViewActionCallback=function(){function IncreaseViewActionCallback(){}IncreaseViewActionCallback.prototype.successCallback=function(operationPayload,response){var context=operationPayload.controlContext,stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId),articleId=operationPayload.record.knowledgeArticleId;if(stateManager.relevanceSearchRecords!=null)stateManager.relevanceSearchRecords.value.forEach(function(record){if(record.objectId===articleId&&record.relevanceData.hasOwnProperty("knowledgearticleviews"))record.relevanceData.knowledgearticleviews++});else stateManager.records.forEach(function(record){if(record.knowledgeArticleId===articleId)record.knowledgeArticleViews++})};IncreaseViewActionCallback.prototype.failureCallback=function(operationPayload,error){var context=operationPayload.controlContext,stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId),errorMessage=error&&error.message||error&&error.error&&error.error.message||"";stateManager.errorMessage=errorMessage;stateManager.error=true;MscrmControls.KbCommonUtils.TelemetryReporter.LogError(context,{controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:error.message,eventParams:[{name:"errorDetails",value:error.innerror}]})};IncreaseViewActionCallback.IsRegistered=MscrmControls.KbCommonUtils.ActionCallbackFactory.Register(MscrmControls.KbCommonUtils.ArticleAction.IncreaseView,function(){return new IncreaseViewActionCallback});return IncreaseViewActionCallback}();KbSearchControl.IncreaseViewActionCallback=IncreaseViewActionCallback})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var LinkUnlinkActionCallback=function(){function LinkUnlinkActionCallback(){}LinkUnlinkActionCallback.prototype.successCallback=function(operationPayload,response){var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.controlContext,KbSearchControl.Constants.WebresourceNameKbSearchActions,MscrmControls.KbCommonUtils.TelemetryActionName.Link_KbArticle),context=operationPayload.controlContext,stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId),kbSearchRecord=operationPayload.record;if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(response)){stateManager.associatedArticles=stateManager.associatedArticles||[];var article={knowledgeArticleId:kbSearchRecord.knowledgeArticleId,articlePublicNumber:kbSearchRecord.articlePublicNumber};if(MscrmControls.KbCommonUtils.SearchProviderType.InternalDynamicsOrg!=operationPayload.record.searchProviderType){kbSearchRecord.federatedArticleIncidentId=response.id;article.federatedArticleId=kbSearchRecord.federatedArticleId;article.federatedArticleIncidentId=kbSearchRecord.federatedArticleIncidentId}if(!kbSearchRecord.isAssociated){kbSearchRecord.isAssociated=true;stateManager.associatedArticles.push(article)}else{for(var length_1=stateManager.associatedArticles.length,i=0;i<length_1;i++){var isAssociatedArticle=MscrmControls.KbCommonUtils.SearchProviderType.InternalDynamicsOrg!=operationPayload.record.searchProviderType?stateManager.associatedArticles[i].federatedArticleId==kbSearchRecord.federatedArticleId:stateManager.associatedArticles[i].knowledgeArticleId==kbSearchRecord.knowledgeArticleId;if(isAssociatedArticle){stateManager.associatedArticles.splice(i,1);break}}kbSearchRecord.isAssociated=false}var selectedArticle_1=operationPayload.record;stateManager.SetSelectedArticle(selectedArticle_1,context);if(selectedArticle_1!=null)if(stateManager.isExternalSearchIndexEnabled)this.formatSelectedArticle(selectedArticle_1,context).then(function(){context.utils.fireEvent("onAssociationDisassociationOccurred",selectedArticle_1)});else context.utils.fireEvent("onAssociationDisassociationOccurred",selectedArticle_1);this.refreshAllAssociatedGrid();context.utils.requestRender();watermarkTelemetryEvent.End()}else watermarkTelemetryEvent.EndAndLogError({controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:KbSearchControl.Constants.NoArticlesErrorMessageResourceName})};LinkUnlinkActionCallback.prototype.failureCallback=function(operationPayload,error){var context=operationPayload.controlContext,errorMessage=error&&error.message||error&&error.error&&error.error.message||"";MscrmControls.KbCommonUtils.TelemetryReporter.LogError(context,{controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:errorMessage})};LinkUnlinkActionCallback.prototype.refreshAllAssociatedGrid=function(){if(Xrm&&Xrm.Page&&Xrm.Page.getControl){var controls=Xrm.Page.getControl();if(controls)for(var _i=0,controls_1=controls;_i<controls_1.length;_i++){var control=controls_1[_i];if(control.getGridType){var entityName=control.getEntityName();(entityName===KbSearchControl.Constants.knowledgearticleEntityType||entityName===KbSearchControl.Constants.KnowledgeArticleIncident)&&control.refresh&&control.refresh()}}}};LinkUnlinkActionCallback.prototype.formatSelectedArticle=function(selectedArticle,context){var deferred=$.Deferred();return MscrmControls.KbCommonUtils.ActionOperationUtils.GetFormattedContent(context,selectedArticle.knowledgeArticleId,MscrmControls.KbCommonUtils.SearchProviderType.CrossDynamicsOrg==selectedArticle.searchProviderType,selectedArticle.resourceUri).done(function(response){selectedArticle.content=response;deferred.resolve()}).fail(function(error){if(typeof error==="string")selectedArticle.content=error;else console.error(error);deferred.reject()})};LinkUnlinkActionCallback.IsRegistered=MscrmControls.KbCommonUtils.ActionCallbackFactory.Register(MscrmControls.KbCommonUtils.ArticleAction.LinkArticle,function(){return new LinkUnlinkActionCallback})&&MscrmControls.KbCommonUtils.ActionCallbackFactory.Register(MscrmControls.KbCommonUtils.ArticleAction.UnlinkArticle,function(){return new LinkUnlinkActionCallback})&&MscrmControls.KbCommonUtils.ActionCallbackFactory.Register(MscrmControls.KbCommonUtils.ArticleAction.EmailArticle,function(){return new LinkUnlinkActionCallback})&&MscrmControls.KbCommonUtils.ActionCallbackFactory.Register(MscrmControls.KbCommonUtils.ArticleAction.EmailArticleContent,function(){return new LinkUnlinkActionCallback});return LinkUnlinkActionCallback}();KbSearchControl.LinkUnlinkActionCallback=LinkUnlinkActionCallback})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteMicrosoftSearchAction=function(){function ExecuteMicrosoftSearchAction(){}ExecuteMicrosoftSearchAction.prototype.ExecuteAction=function(actionPayload){var context=actionPayload.controlContext,kbSearchParameter=actionPayload.searchParam,fetchApiWrapper=actionPayload.fetchApiWrapper,searchProvider=actionPayload.searchProvider,additionalTelemetryEventParameters=[{name:"searchProvider",value:searchProvider.Name}],watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameMicrosoftSearchActions,"ExecuteMicrosoftSearchAction",additionalTelemetryEventParameters),microsoftSearchRequestData=KbSearchControl.BuildSearchRequestData.BuildSearchRequest(kbSearchParameter,searchProvider),deferred=$.Deferred();fetchApiWrapper.Fetch(context,microsoftSearchRequestData.method,microsoftSearchRequestData.odataEndPointUri,this.getRequestData(microsoftSearchRequestData),true,searchProvider.ResourceUri,MscrmControls.KbCommonUtils.Constants.MicrosoftSearchApiCall).then(function(response){watermarkTelemetryEvent.End();context.parameters.value.executeNotifyHandlersThatEventOccurred(kbSearchParameter.notifyHandlersThatEventOccurredParameter);if(response.value&&response.value.length<=0&&response.value[0].hitsContainers&&response.value[0].hitsContainers.length<=0){KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.NoArticlesErrorMessageResourceName,"");deferred.resolve(response);return}var searchResults=response.value[0].hitsContainers[0],kbSearchRecords=Array();if(kbSearchParameter.currentPageNumber>1)kbSearchRecords=searchProvider.SearchResult.Records;else{kbSearchRecords=Array();searchProvider.SearchResult.TotalCount=searchResults["total"]}if(searchResults&&searchResults.total>0&&searchResults.hits&&searchResults.hits.length>0){var md5_1=new MscrmControls.KbCommonUtils.Md5;searchResults.hits.map(function(searchResult){var recordTitle=MscrmControls.KbCommonUtils.SearchProviderType.MSSearchSharePoint==searchProvider.SearchProviderType?searchResult["_source"]["name"]:searchResult["_source"]["properties"][KbSearchControl.Constants.MicrosoftSearchConnectorStoredFieldTitle];if(recordTitle.length>99)recordTitle=recordTitle.substr(0,96)+"...";kbSearchRecords.push({knowledgeArticleId:MscrmControls.KbCommonUtils.SearchProviderType.MSSearchSharePoint==searchProvider.SearchProviderType?searchResult["_source"]["id"]:md5_1.appendStr(searchResult["_id"]).getGuid(),knowledgeArticleViews:0,title:recordTitle,content:MscrmControls.KbCommonUtils.SearchProviderType.MSSearchSharePoint==searchProvider.SearchProviderType?searchResult["_summary"]:searchResult["_source"]["properties"][KbSearchControl.Constants.MicrosoftSearchConnectorStoredFieldDescription],stateCode:3,statusCode:3,createdon:searchResult["_source"]["createdDateTime"],modifiedOn:searchResult["_source"]["lastModifiedDateTime"],isAssociated:false,searchProviderType:searchProvider.SearchProviderType,searchProviderId:searchProvider.SearchProviderId,articleUrl:MscrmControls.KbCommonUtils.SearchProviderType.MSSearchSharePoint==searchProvider.SearchProviderType?searchResult["_source"]["webUrl"]+"?web=1":searchResult["_source"]["properties"][KbSearchControl.Constants.MicrosoftSearchConnectorStoredFieldUrl],resourceUri:searchProvider.ResourceUri,systemUserId:searchProvider.Settings.SystemUserId})});var RecordIds=kbSearchRecords.map(function(record){return record.knowledgeArticleId});KbSearchControl.KbSearchActionUtility.UpdateSuccessStateInSearchProvider(searchProvider,kbSearchRecords,RecordIds,null)}else kbSearchRecords.length<=0&&KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.NoArticlesErrorMessageResourceName,"");if(!searchResults.moreResultsAvailable)searchProvider.SearchResult.TotalCount=kbSearchRecords.length;deferred.resolve(response)},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.ServerSearchFailure,errorMessage);watermarkTelemetryEvent.EndAndLogError({controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:"KbSearchControl.ExecuteMicrosoftSearchAction"+errorMessage,eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")}]});deferred.reject(error)});return deferred.promise()};ExecuteMicrosoftSearchAction.prototype.getRequestData=function(microsoftSearchRequestData){var requestObj={requests:microsoftSearchRequestData.requests};return JSON.stringify(requestObj)};ExecuteMicrosoftSearchAction.IsRegistered=KbSearchControl.SearchActionFactory.Register(KbSearchControl.SearchActionType.ExecuteMicrosoftSearch,function(){return new ExecuteMicrosoftSearchAction});return ExecuteMicrosoftSearchAction}();KbSearchControl.ExecuteMicrosoftSearchAction=ExecuteMicrosoftSearchAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchInitializor=function(){function KbSearchInitializor(){}KbSearchInitializor.prototype.initializeKbSearch=function(context,fetchApiWrapper,state){var _this=this,watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameKbSearchInitializor,"KbSearchInitializor.initializeKbSearch"),deferred=$.Deferred();this.context=context;this.stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this.fetchApiWrapper=fetchApiWrapper;this.getApplicationName();KbSearchControl.KbSearchControlLocale.initialize(function(id){return context.resources.getString(id)});MscrmControls.KbCommonUtils.KbCommonControlLocale.initialize(function(id){return context.resources.getString(id)});if(MscrmControls.KbCommonUtils.CommonUtils.IsInSearchPageContext())document.title=KbSearchControl.KbSearchControlLocale.StandalonePageTitle;this.stateManager.InitializeFilterModels();if(MscrmControls.KbCommonUtils.FCBUtil.IsStatePersistenceEnabled(this.context)&&state){KbSearchControl.StateUtil.RestoreState(this.context,this.stateManager,state);watermarkTelemetryEvent.End();deferred.resolve()}else this.loadKmServiceAppIframe().then(function(){_this.fetchInitializeSettings(_this.context,deferred);watermarkTelemetryEvent.End()});this.processAdditionalFilters();MscrmControls.KbCommonUtils.ActionOperationRegistration.RegisterAllActions();return deferred.promise()};KbSearchInitializor.prototype.processAdditionalFilters=function(){if(this.context.utils.isFeatureEnabled(KbSearchControl.Constants.MetadataDrivenFilterForKbSearch)&&this.context.parameters.value.descriptors.enableMDF){this.stateManager.ExecuteKbSearchHelper.enableMetadataFiltering=true;if(this.context.parameters.value.descriptors.mappedFields)for(var _i=0,_a=this.context.parameters.value.descriptors.mappedFields;_i<_a.length;_i++){var mapping=_a[_i];this.stateManager.ExecuteKbSearchHelper.additionalKnowledgeArticleFilters[mapping.kmAttr]=mapping.srcAttr}}};KbSearchInitializor.prototype.getApplicationName=function(){var _this=this;try{window.Xrm.Utility.getGlobalContext().getCurrentAppProperties().then(function(result){_this.stateManager.applicationName=result.uniqueName})}catch(error){this.context.page.appId!=null&&this.context.webAPI.retrieveRecord("appmodule",this.context.page.appId).then(function(result){_this.stateManager.applicationName=result.uniquename},function(errorResponse){_this.context.reporting.reportFailure("KbSeach",new Error("Failed to get appmodule name for appId "+_this.context.page.appId+". Error: "+errorResponse.message))})}};KbSearchInitializor.prototype.loadKmServiceAppIframe=function(){var deferred=$.Deferred();if(!this.stateManager.ExecuteKbSearchHelper.getIsFederatedSearchEnabled()){deferred.resolve();return deferred.promise()}MscrmControls.KbCommonUtils.KmAppServiceHelper.loadKmServiceAppIframe(this.context,KbSearchControl.Constants.WebresourceNameKbSearchInitializor).then(function(){deferred.resolve()});return deferred.promise()};KbSearchInitializor.prototype.fetchInitializeSettings=function(context,deferred){var _this=this,watermarkTelemetryEventFetchInitSettings=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this.context,KbSearchControl.Constants.WebresourceNameKbSearchInitializor,"KbSearchInitializor.fetchInitializeSettings");Promise.all([this.fetchControlInitSettings(),this.fetchSearchProviders()]).then(function(results){var value=results[0],searchProviders=[];searchProviders.push(_this.createCurrentOrgSearchProvider(context,value));if(_this.stateManager.ExecuteKbSearchHelper.getIsFederatedSearchEnabled()&&results[1]&&results[1].length>0){var sortedSearchProviders=results[1].sort(function(a,b){return a.Name.localeCompare(b.Name)});searchProviders=searchProviders.concat(sortedSearchProviders);_this.logFederatedSearchUsage()}else _this.stateManager.ExecuteKbSearchHelper.setIsFederatedSearchEnabled(false);_this.stateManager.ExecuteKbSearchHelper.setSearchProviders(searchProviders);_this.stateManager.ExecuteKbSearchHelper.setSelectedSearchProvider(_this.stateManager.ExecuteKbSearchHelper.getDefaultSearchProvider());var watermarkTelemetryEventFetchLangFilters=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(_this.context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"FetchLanguageFilters");Promise.all(_this.fetchLanguageXmlForFilters()).then(function(results){watermarkTelemetryEventFetchLangFilters.End();var langFetchXmlResult=[];if(results&&results.length>0)for(var languageId={},_i=0,results_1=results;_i<results_1.length;_i++)for(var result=results_1[_i],_a=0,_b=result.value;_a<_b.length;_a++){var language=_b[_a];if(!languageId[language["_languagelocaleid_value"]]){langFetchXmlResult.push(language);languageId[language["_languagelocaleid_value"]]=true}}_this.stateManager.langFetchXmlResult=langFetchXmlResult;watermarkTelemetryEventFetchInitSettings.End();deferred.resolve()},function(error){watermarkTelemetryEventFetchLangFilters.End();watermarkTelemetryEventFetchInitSettings.End();deferred.resolve()})},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";KbSearchControl.KbSearchActionUtility.UpdateErrorStateInContext(context,KbSearchControl.Constants.ServerSearchFailure,false,errorMessage);watermarkTelemetryEventFetchInitSettings.End();MscrmControls.KbCommonUtils.TelemetryReporter.LogError(_this.context,{controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:error.message?error.message:"",eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")},{name:"methodName",value:"KbSearchInitializor.fetchInitializeSettings"}]});deferred.reject()})};KbSearchInitializor.prototype.logFederatedSearchUsage=function(){MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this.context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Federation_Search_Initialized,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.FederationSearch,releaseWave:MscrmControls.KbCommonUtils.TelemetryReleaseWave.October2020})};KbSearchInitializor.prototype.fetchControlInitSettings=function(searchProvider){var _this=this,additionalTelemetryEventParameters=[{name:"searchProvider",value:searchProvider?searchProvider.Name:"[Current Org]"}],watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this.context,KbSearchControl.Constants.WebresourceNameKbSearchInitializor,"KbSearchInitializor.fetchControlInitSettings",additionalTelemetryEventParameters),entityIdentifier="";if(this.context.page.entityTypeName)entityIdentifier="EntityLogicalName='"+this.context.page.entityTypeName+"'";var appIdIdentifier="",appId=this.context.page.appId;if(!appId)appId=MscrmControls.KbCommonUtils.CommonUtils.GetAppIdInCIFramework();if(appId)appIdIdentifier="ApplicationId='"+appId+"'";var urlParams=[entityIdentifier,appIdIdentifier].filter(function(val){return val}).join(","),kmInitSettingsUrl=KbSearchControl.Constants.ODATA_PATH+MscrmControls.KbCommonUtils.Constants.RetrieveKMControlSettingsEndpoint+("("+urlParams+")"),loadUsingProxy=false,resourceUri,kmAppMethod;if(searchProvider&&MscrmControls.KbCommonUtils.SearchProviderType.CrossDynamicsOrg==searchProvider.SearchProviderType){loadUsingProxy=true;resourceUri=searchProvider.ResourceUri;kmAppMethod=MscrmControls.KbCommonUtils.Constants.CrossDynamicsOrgApiCall}return this.fetchApiWrapper.Fetch(this.context,MscrmControls.KbCommonUtils.GET_METHOD,kmInitSettingsUrl,"",loadUsingProxy,resourceUri,kmAppMethod).then(function(parsedValue){watermarkTelemetryEvent.End();return JSON.parse(parsedValue.Result)},function(error){watermarkTelemetryEvent.End();MscrmControls.KbCommonUtils.TelemetryReporter.LogError(_this.context,{controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:error.message?error.message:"",eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")},{name:"methodName",value:"KbSearchInitializor.fetchControlInitSettings"},{name:"searchProviderName",value:searchProvider.Name}]});error["isError"]=true;return error})};KbSearchInitializor.prototype.fetchSearchProviders=function(){var _this=this,deferred=$.Deferred();if(!this.stateManager.ExecuteKbSearchHelper.getIsFederatedSearchEnabled()){deferred.resolve();return deferred.promise()}var watermarkTelemetryEventFetchSearchProv=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this.context,KbSearchControl.Constants.WebresourceNameKbSearchInitializor,"KbSearchInitializor.fetchSearchProviders"),kbSearchProviders=[],dynamicsOrgSearchProvidersCount=0,kmsearchProviderSettingsUri=KbSearchControl.Constants.ODATA_PATH+"/"+MscrmControls.KbCommonUtils.Constants.RetrieveSearchProviders;this.fetchApiWrapper.Fetch(this.context,MscrmControls.KbCommonUtils.POST_METHOD,kmsearchProviderSettingsUri).then(function(result){var searchproviders=JSON.parse(result.Result);if(searchproviders&&searchproviders.length>0){for(var _loop_1=function(){var kbSearchProvider=new KbSearchControl.KbSearchProvider(value[MscrmControls.KbCommonUtils.Constants.FederatedSearchConfigId],value[MscrmControls.KbCommonUtils.Constants.FederatedSearchProviderName],value[MscrmControls.KbCommonUtils.Constants.FederatedSearchIsDefault],value[MscrmControls.KbCommonUtils.Constants.FederatedSearchProviderType],value[MscrmControls.KbCommonUtils.Constants.FederatedSearchOrganizationUrl],value[MscrmControls.KbCommonUtils.Constants.FederatedSearchConnectionId],value[MscrmControls.KbCommonUtils.Constants.FederatedSearchSharepointUrl]);if(MscrmControls.KbCommonUtils.SearchProviderType.CrossDynamicsOrg==kbSearchProvider.SearchProviderType){dynamicsOrgSearchProvidersCount++;var additionalTelemetryEventParameters=[{name:"searchProvider",value:kbSearchProvider.Name}],watermarkTelemetryEventFetchCrossOrgInit_1=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(_this.context,KbSearchControl.Constants.WebresourceNameKbSearchInitializor,"KbSearchInitializor.fetchCrossOrgInitSettings",additionalTelemetryEventParameters);_this.fetchControlInitSettings(kbSearchProvider).then(function(response){watermarkTelemetryEventFetchCrossOrgInit_1.End();if(response.isError||response.ErrorMessage!=""){kbSearchProvider.Settings.HasError=true;KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(kbSearchProvider,KbSearchControl.Constants.ServerSearchNoPermissions,response.message||response.ErrorMessage)}else _this.addSearchProviderInitSettings(kbSearchProvider,response);kbSearchProviders.push(kbSearchProvider);if(--dynamicsOrgSearchProvidersCount==0){watermarkTelemetryEventFetchSearchProv.End();deferred.resolve(kbSearchProviders)}},function(error){watermarkTelemetryEventFetchCrossOrgInit_1.End();if(--dynamicsOrgSearchProvidersCount==0){watermarkTelemetryEventFetchSearchProv.End();deferred.resolve(kbSearchProviders)}})}else{kbSearchProvider.SearchType=KbSearchControl.SearchType.MicrosoftSearch;kbSearchProvider.ResourceUri=KbSearchControl.Constants.MicrosoftSearchEndPoint;kbSearchProviders.push(kbSearchProvider)}},_i=0,searchproviders_1=searchproviders;_i<searchproviders_1.length;_i++){var value=searchproviders_1[_i];_loop_1()}if(0==dynamicsOrgSearchProvidersCount){watermarkTelemetryEventFetchSearchProv.End();deferred.resolve(kbSearchProviders)}}else{watermarkTelemetryEventFetchSearchProv.End();_this.stateManager.ExecuteKbSearchHelper.setIsFederatedSearchEnabled(false);deferred.resolve(kbSearchProviders)}},function(error){watermarkTelemetryEventFetchSearchProv.End();MscrmControls.KbCommonUtils.TelemetryReporter.LogError(_this.context,{controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:error.message?error.message:"",eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")},{name:"methodName",value:"KbSearchInitializor.fetchSearchProviders"}]});_this.stateManager.ExecuteKbSearchHelper.setIsFederatedSearchEnabled(false);deferred.resolve(kbSearchProviders)});return deferred.promise()};KbSearchInitializor.prototype.createCurrentOrgSearchProvider=function(context,value){var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this.context,KbSearchControl.Constants.WebresourceNameKbSearchInitializor,"KbSearchInitializor.createCurrentOrgSearchProvider"),searchProvider=new KbSearchControl.KbSearchProvider("2c1101e4-f3fe-47c2-99d2-cdac7baec032","[Current Org]",false,MscrmControls.KbCommonUtils.SearchProviderType.InternalDynamicsOrg,"",null,null);this.addSearchProviderInitSettings(searchProvider,value);this.stateManager.isExternalSearchIndexEnabled=context.utils.isFeatureEnabled(KbSearchControl.Constants.UCKMControlRelevanceSearch)&&value.IsRelevanceSearchEnabled;this.stateManager.relations=searchProvider.Settings.Relations;this.stateManager.isKnowledgeSearchInsightsEnabled=searchProvider.Settings.IsKnowledgeSearchInsightsEnabled;if(!this.stateManager.applicationName)this.stateManager.applicationName=searchProvider.Settings.ApplicationName;if(MscrmControls.KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(context)){context.parameters.value.isKnowledgeManagementEnabled=value.IsKnowledgeManagementEnabled;context.parameters.value.entityDisplayName=value.DisplayName}this.stateManager.ExecuteKbSearchHelper.setCurrentOrgSearchProvider(searchProvider);watermarkTelemetryEvent.End();return searchProvider};KbSearchInitializor.prototype.addSearchProviderInitSettings=function(searchProvider,initSettings){searchProvider.Settings.IsRelevanceSearchEnabled=initSettings.IsRelevanceSearchEnabled;searchProvider.SearchType=searchProvider.Settings.IsRelevanceSearchEnabled?KbSearchControl.SearchType.RelevanceSearch:KbSearchControl.SearchType.FullTextSearch;searchProvider.Settings.ActiveLanguages=initSettings.ActiveLanguages;searchProvider.Settings.kmPrivileges=initSettings.KMPrivileges;searchProvider.Settings.UseExternalKMPortal=initSettings.UseExternalKMPortal;searchProvider.Settings.ExternalKMPortalURL=initSettings.ExternalKMPortalURL;searchProvider.Settings.Relations=initSettings.Relationship;searchProvider.Settings.KnowledgeArticleAttributeList=this.getKnowledgeArticleAttributeList(initSettings);searchProvider.Settings.SystemUserId=initSettings.SystemUserId;searchProvider.Settings.IsKnowledgeSearchInsightsEnabled=initSettings.IsKnowledgeSearchInsightsEnabled;searchProvider.Settings.ApplicationName=initSettings.ApplicationName};KbSearchInitializor.prototype.getKnowledgeArticleAttributeList=function(value){var list,attributeDict=value.AttributeDictionary&&value.AttributeDictionary.filter(function(obj){return obj.Key==KbSearchControl.Constants.knowledgearticleEntityType});if(attributeDict&&attributeDict.length>0)list=attributeDict&&attributeDict[0].Value.map(function(attribute){return attribute.LogicalName});return list};KbSearchInitializor.prototype.fetchLanguageXmlForFilters=function(){for(var oDataUri=MscrmControls.KbCommonUtils.Constants.ODATA_PATH+"/knowledgearticles?fetchXml="+KbSearchControl.Constants.ActiveLanguagesFetchXml,promises=[],_i=0,_a=this.stateManager.ExecuteKbSearchHelper.getSearchProviders();_i<_a.length;_i++){var searchProvider=_a[_i];KbSearchControl.SearchType.MicrosoftSearch!=searchProvider.SearchType&&!searchProvider.Settings.HasError&&promises.push(this.fetchApiWrapper.Fetch(this.context,MscrmControls.KbCommonUtils.GET_METHOD,oDataUri,"",MscrmControls.KbCommonUtils.SearchProviderType.CrossDynamicsOrg==searchProvider.SearchProviderType,searchProvider.ResourceUri,MscrmControls.KbCommonUtils.Constants.CrossDynamicsOrgApiCall))}return promises};return KbSearchInitializor}();KbSearchControl.KbSearchInitializor=KbSearchInitializor})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var BuildSearchRequestData=function(){function BuildSearchRequestData(){}BuildSearchRequestData.BuildSearchRequest=function(searchParameter,searchProvider){var key=BuildSearchRequestData.getKey(searchProvider.SearchType,searchProvider.SearchProviderType),buildSearchRequestDataExecutor=BuildSearchRequestData.s_objects[key]();if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(BuildSearchRequestData.s_objects[key]))return buildSearchRequestDataExecutor.buildSearchRequest(searchParameter,searchProvider)};BuildSearchRequestData.Register=function(searchType,searchProviderType,buildSearchRequestData){var key=BuildSearchRequestData.getKey(searchType,searchProviderType);if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(BuildSearchRequestData.s_objects[key])){BuildSearchRequestData.s_objects[key]=buildSearchRequestData;return true}return false};BuildSearchRequestData.getKey=function(searchType,searchProviderType){var key=searchType;if(searchType==KbSearchControl.SearchType.MicrosoftSearch)key=searchProviderType;return key};BuildSearchRequestData.s_objects={};return BuildSearchRequestData}();KbSearchControl.BuildSearchRequestData=BuildSearchRequestData})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteSearchFactory=function(){function ExecuteSearchFactory(){}ExecuteSearchFactory.ExecuteSearch=function(searchtype,contextToken,searchHelper,searchProvider,fetchApiWrapper){var searchExecutor=ExecuteSearchFactory.s_objects[searchtype](),searchParameter=KbSearchControl.SearchParameterFactory.getSearchParamter(searchtype,searchHelper,searchProvider);if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(ExecuteSearchFactory.s_objects[searchtype])){contextToken.parameters.value.executeUpdateCurrentSearchText(contextToken.parameters.value.contextToken,"");contextToken.parameters.value.currentSearchText="";return searchExecutor.executeSearch(searchParameter,contextToken,searchProvider,fetchApiWrapper)}};ExecuteSearchFactory.Register=function(searchtype,Executesearch){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(ExecuteSearchFactory.s_objects[searchtype])){ExecuteSearchFactory.s_objects[searchtype]=Executesearch;return true}return false};ExecuteSearchFactory.s_objects={};return ExecuteSearchFactory}();KbSearchControl.ExecuteSearchFactory=ExecuteSearchFactory})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteMicrosoftSearch=function(){function ExecuteMicrosoftSearch(){}ExecuteMicrosoftSearch.prototype.executeSearch=function(kbSearchParameter,context,searchProvider,fetchApiWrapper){var deferred=$.Deferred();if(!KbSearchControl.KbSearchActionUtility.ValidateSearchActions(kbSearchParameter,context,searchProvider)){deferred.resolve();return deferred.promise()}var additionalTelemetryEventParameters=[{name:"searchProvider",value:searchProvider.Name}],watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameMicrosoftSearchActions,"ExecuteMicrosoftSearch",additionalTelemetryEventParameters),actionPayload={searchParam:kbSearchParameter,controlContext:context,searchProvider:searchProvider,fetchApiWrapper:fetchApiWrapper};KbSearchControl.SearchActionFactory.Instance.ExecuteAction(KbSearchControl.SearchActionType.ExecuteMicrosoftSearch,actionPayload).then(function(){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.MicrosoftSearchCompleted]);context.parameters.value.executeUpdateSearchResults(context.parameters.value.contextToken,searchProvider.SearchResult.Records);deferred.resolve();watermarkTelemetryEvent.End()},function(){watermarkTelemetryEvent.End();deferred.resolve()});return deferred.promise()};ExecuteMicrosoftSearch.isRegistered=KbSearchControl.ExecuteSearchFactory.Register(KbSearchControl.SearchType.MicrosoftSearch,function(){return new ExecuteMicrosoftSearch});return ExecuteMicrosoftSearch}();KbSearchControl.ExecuteMicrosoftSearch=ExecuteMicrosoftSearch})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var BuildMicrosoftSearchConnectorRequestData=function(){function BuildMicrosoftSearchConnectorRequestData(){}BuildMicrosoftSearchConnectorRequestData.prototype.buildSearchRequest=function(kbSearchParameter,searchProvider){var microsoftSearchRequest=new KbSearchControl.MicrosoftSearchRequest([MscrmControls.KbCommonUtils.Constants.MicrosoftSearchConnectorEntityType],kbSearchParameter.currentPageNumber==1?0:(kbSearchParameter.currentPageNumber-1)*kbSearchParameter.numberOfResults,kbSearchParameter.numberOfResults,this.generateQueryString(kbSearchParameter),searchProvider.ConnectionId,[KbSearchControl.Constants.MicrosoftSearchConnectorStoredFieldTitle,KbSearchControl.Constants.MicrosoftSearchConnectorStoredFieldUrl,KbSearchControl.Constants.MicrosoftSearchConnectorStoredFieldDescription]);return new KbSearchControl.MicrosoftSearchRequestData([microsoftSearchRequest],MscrmControls.KbCommonUtils.POST_METHOD,KbSearchControl.Constants.MicrosoftSearchOdataPath)};BuildMicrosoftSearchConnectorRequestData.prototype.generateQueryString=function(kbSearchParameter){var microsoftSearchQuery=(new KbSearchControl.MicrosoftSearchQueryStringBuilder(kbSearchParameter.searchText)).Build();return new KbSearchControl.MicrosoftSearchQueryString(microsoftSearchQuery)};BuildMicrosoftSearchConnectorRequestData.isRegistered=KbSearchControl.BuildSearchRequestData.Register(KbSearchControl.SearchType.MicrosoftSearch,MscrmControls.KbCommonUtils.SearchProviderType.MSSearchConnector,function(){return new BuildMicrosoftSearchConnectorRequestData});return BuildMicrosoftSearchConnectorRequestData}();KbSearchControl.BuildMicrosoftSearchConnectorRequestData=BuildMicrosoftSearchConnectorRequestData})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,BuildMicrosoftSearchSharePointRequestData=function(){function BuildMicrosoftSearchSharePointRequestData(){}BuildMicrosoftSearchSharePointRequestData.prototype.buildSearchRequest=function(kbSearchParameter,searchProvider){var microsoftSearchRequest=new KbSearchControl.MicrosoftSearchRequest([MscrmControls.KbCommonUtils.Constants.MicrosoftSearchSharePointEntityType],kbSearchParameter.currentPageNumber==1?0:(kbSearchParameter.currentPageNumber-1)*kbSearchParameter.numberOfResults,kbSearchParameter.numberOfResults,this.generateQueryString(kbSearchParameter,searchProvider));return new KbSearchControl.MicrosoftSearchRequestData([microsoftSearchRequest],MscrmControls.KbCommonUtils.POST_METHOD,KbSearchControl.Constants.MicrosoftSearchOdataPath)};BuildMicrosoftSearchSharePointRequestData.prototype.generateQueryString=function(kbSearchParameter,searchProvider){var microsoftSearchQueryStringBuilder=new KbSearchControl.MicrosoftSearchQueryStringBuilder(kbSearchParameter.searchText);microsoftSearchQueryStringBuilder.withPath(searchProvider.SharepointUrl).and().withOnlyDocuments().and().excludeFileType("aspx").and().withLocale(kbSearchParameter.locale);!MscrmObject.isNullOrUndefined(kbSearchParameter.dateRange)&&microsoftSearchQueryStringBuilder.and().withDateRange(kbSearchParameter.dateRange);return new KbSearchControl.MicrosoftSearchQueryString(microsoftSearchQueryStringBuilder.Build())};BuildMicrosoftSearchSharePointRequestData.isRegistered=KbSearchControl.BuildSearchRequestData.Register(KbSearchControl.SearchType.MicrosoftSearch,MscrmControls.KbCommonUtils.SearchProviderType.MSSearchSharePoint,function(){return new BuildMicrosoftSearchSharePointRequestData});return BuildMicrosoftSearchSharePointRequestData}();KbSearchControl.BuildMicrosoftSearchSharePointRequestData=BuildMicrosoftSearchSharePointRequestData})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MicrosoftSearchQuery=function(){function MicrosoftSearchQuery(query){this.query=query}return MicrosoftSearchQuery}();KbSearchControl.MicrosoftSearchQuery=MicrosoftSearchQuery})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MicrosoftSearchQueryString=function(){function MicrosoftSearchQueryString(query_string){this.query_string=query_string}return MicrosoftSearchQueryString}();KbSearchControl.MicrosoftSearchQueryString=MicrosoftSearchQueryString})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,MicrosoftSearchQueryStringBuilder=function(){function MicrosoftSearchQueryStringBuilder(searchText){this.queryString=searchText}MicrosoftSearchQueryStringBuilder.prototype.and=function(){this.queryString+=" AND";return this};MicrosoftSearchQueryStringBuilder.prototype.withLocale=function(locale){if(!MscrmObject.isNullOrUndefined(locale))this.queryString+=' detectedLanguage="'+locale+'"';return this};MicrosoftSearchQueryStringBuilder.prototype.withPath=function(path){if(!MscrmObject.isNullOrUndefined(path))this.queryString+=" path:"+path;return this};MicrosoftSearchQueryStringBuilder.prototype.withOnlyDocuments=function(){this.queryString+=" isDocument=true";return this};MicrosoftSearchQueryStringBuilder.prototype.excludeFileType=function(fileType){if(fileType!=null)this.queryString+=" NOT filetype:"+fileType;return this};MicrosoftSearchQueryStringBuilder.prototype.withDateRange=function(dateRange){if(dateRange!=null){var today=moment().utc(),lowerLimit=moment().utc();switch(dateRange){case KbSearchControl.DateFilterOptions.Last7Days:lowerLimit=lowerLimit.subtract(7,"days");this.queryString+=" lastmodifiedtime>="+lowerLimit.format()+" AND lastmodifiedtime<="+today.format();break;case KbSearchControl.DateFilterOptions.LastXDays:lowerLimit=lowerLimit.subtract(30,"days");this.queryString+=" lastmodifiedtime>="+lowerLimit.format()+" AND lastmodifiedtime<="+today.format();break;case KbSearchControl.DateFilterOptions.LastXMonths:lowerLimit=lowerLimit.subtract(6,"months");this.queryString+=" lastmodifiedtime>="+lowerLimit.format()+" AND lastmodifiedtime<="+today.format();break;case KbSearchControl.DateFilterOptions.LastXYears:lowerLimit=lowerLimit.subtract(1,"years");this.queryString+=" lastmodifiedtime>="+lowerLimit.format()+" AND lastmodifiedtime<="+today.format();break;default:break}}return this};MicrosoftSearchQueryStringBuilder.prototype.Build=function(){return new KbSearchControl.MicrosoftSearchQuery(this.queryString)};return MicrosoftSearchQueryStringBuilder}();KbSearchControl.MicrosoftSearchQueryStringBuilder=MicrosoftSearchQueryStringBuilder})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,MicrosoftSearchRequest=function(){function MicrosoftSearchRequest(entityTypes,from,size,query,contentSources,stored_fields){this.entityTypes=entityTypes;this.from=from;this.size=size;this.query=query;if(!MscrmObject.isNullOrUndefined(contentSources))this.contentSources=contentSources;if(!MscrmObject.isNullOrUndefined(stored_fields))this.stored_fields=stored_fields}return MicrosoftSearchRequest}();KbSearchControl.MicrosoftSearchRequest=MicrosoftSearchRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MicrosoftSearchRequestData=function(){function MicrosoftSearchRequestData(request,method,endpoint){this.method=method;this.odataEndPointUri=endpoint;this.requests=request}return MicrosoftSearchRequestData}();KbSearchControl.MicrosoftSearchRequestData=MicrosoftSearchRequestData})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var BuildRelevanceSearchRequestData=function(){function BuildRelevanceSearchRequestData(){}BuildRelevanceSearchRequestData.prototype.buildSearchRequest=function(relevanceSearchParameters,searchProvider){var relevanceSearchRequestType=KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_INDEXEDSEARCH,searchRequest=KbSearchControl.RelevanceSearchRequestFactory.Instance.GetRequestObject(relevanceSearchRequestType,relevanceSearchParameters),endpoint=searchRequest.GenerateURL(),queryString=searchRequest.GenerateQueryString();queryString=queryString.replace(/\t|\r|\n/g,"");var relevanceSearchRequest=new KbSearchControl.RelevanceSearchKnowledgeArticleRequest(queryString);return new KbSearchControl.RelevanceSearchRequestData([relevanceSearchRequest],MscrmControls.KbCommonUtils.GET_METHOD,endpoint)};BuildRelevanceSearchRequestData.isRegistered=KbSearchControl.BuildSearchRequestData.Register(KbSearchControl.SearchType.RelevanceSearch,null,function(){return new BuildRelevanceSearchRequestData});return BuildRelevanceSearchRequestData}();KbSearchControl.BuildRelevanceSearchRequestData=BuildRelevanceSearchRequestData})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var RelevanceSearchKnowledgeArticleRequest=function(){function RelevanceSearchKnowledgeArticleRequest(urlParameters){this.urlParameters=urlParameters}return RelevanceSearchKnowledgeArticleRequest}();KbSearchControl.RelevanceSearchKnowledgeArticleRequest=RelevanceSearchKnowledgeArticleRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var RelevanceSearchRequestData=function(){function RelevanceSearchRequestData(request,method,endpoint){this.method=method;this.odataEndPointUri=endpoint;this.requests=request}return RelevanceSearchRequestData}();KbSearchControl.RelevanceSearchRequestData=RelevanceSearchRequestData})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,KbSearchProvider=function(){function KbSearchProvider(searchProviderId,name,isDefault,searchProviderType,resourceUri,connectionid,sharepointurl){this.SearchType=KbSearchControl.SearchType.None;this.IsLoading=false;this.Settings=new KbSearchControl.KbSearchProviderSettings;this.SearchParameters=new KbSearchControl.KbSearchProviderParameters;this.SearchResult=new KbSearchControl.KbSearchProviderResult;this.SearchError=null;this.SearchProviderId=searchProviderId;this.Name=name;this.IsDefault=isDefault;this.SearchProviderType=searchProviderType;this.ResourceUri=resourceUri;this.SharepointUrl=sharepointurl;if(!MscrmObject.isNullOrUndefined(connectionid)){this.ConnectionId=[];for(var connectionIdArr=connectionid.split(","),_i=0,connectionIdArr_1=connectionIdArr;_i<connectionIdArr_1.length;_i++){var connId=connectionIdArr_1[_i];this.ConnectionId.push(KbSearchControl.Constants.MicrosoftSearchConnectionIdPrefix+connId)}}}return KbSearchProvider}();KbSearchControl.KbSearchProvider=KbSearchProvider})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchProviderError=function(){function KbSearchProviderError(errorMessage,errorDetails){this.ErrorMessage="";this.ErrorDetails="";this.ErrorMessage=errorMessage;this.ErrorDetails=errorDetails}return KbSearchProviderError}();KbSearchControl.KbSearchProviderError=KbSearchProviderError})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchProviderParameters=function(){function KbSearchProviderParameters(){this.CurrentPageNumber=1;this.kbArticlesIDList=[]}return KbSearchProviderParameters}();KbSearchControl.KbSearchProviderParameters=KbSearchProviderParameters})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchProviderResult=function(){function KbSearchProviderResult(){this.TotalCount=0;this.Records=[];this.RecordIds=[];this.KbRelevanceSearchRecordCollection=[];this.KbSearchResultCollection=[];this.AnnotationRecords=[];this.KnowledgeSearchInsightRecord=new MscrmControls.KbCommonUtils.KnowledgeSearchInsight;this.IsKnowledgeSearchInsightRecordCreated=false;this.IsKnowledgeSearchInsightRecordWaitingForCreate=false}return KbSearchProviderResult}();KbSearchControl.KbSearchProviderResult=KbSearchProviderResult})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchProviderSettings=function(){function KbSearchProviderSettings(){this.IsRelevanceSearchEnabled=false;this.kmPrivileges={CanAssociateAndDisassociate:true,CanCopyLink:true,CanEmail:false};this.ActiveLanguages=[];this.UseExternalKMPortal=false;this.ExternalKMPortalURL="";this.KnowledgeArticleAttributeList=[];this.SystemUserId="";this.IsKnowledgeSearchInsightsEnabled=false;this.ApplicationName="";this.HasError=false}return KbSearchProviderSettings}();KbSearchControl.KbSearchProviderSettings=KbSearchProviderSettings})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchParameterBase=function(){function KbSearchParameterBase(){}return KbSearchParameterBase}();KbSearchControl.KbSearchParameterBase=KbSearchParameterBase})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchParameterFactory=function(){function SearchParameterFactory(){}SearchParameterFactory.getSearchParamter=function(sType,searchHelper,searchProvider){var SearchParam=SearchParameterFactory.s_params[sType]();SearchParam.setParameterFromsearchHelper(searchHelper,searchProvider);return SearchParam};SearchParameterFactory.Register=function(sType,searchParam){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(SearchParameterFactory.s_params[sType])){SearchParameterFactory.s_params[sType]=searchParam;return true}return false};SearchParameterFactory.s_params={};return SearchParameterFactory}();KbSearchControl.SearchParameterFactory=SearchParameterFactory})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,MicrosoftSearchParameter=function(_super){__extends(MicrosoftSearchParameter,_super);function MicrosoftSearchParameter(){var _this=_super.call(this)||this;_this.setDefaultSettings();return _this}MicrosoftSearchParameter.prototype.setDefaultSettings=function(){this.searchText="";this.stateCode=KbSearchControl.Constants.ArticleState[KbSearchControl.Constants.PublishedState];this.languageLocaleId="";this.locale="";this.sortBy="";this.isDescending=true;this.currentPageNumber=1;this.numberOfResults=KbSearchControl.Constants.NumberofResults;this.notifyHandlersThatEventOccurredParameter={eventName:KbSearchControl.Constants.ON_POST_SEARCH,fieldName:"",pageId:"",contextToken:""}};MicrosoftSearchParameter.prototype.setParameterFromsearchHelper=function(searchHelper,searchProvider){if(!MscrmObject.isNullOrUndefined(searchHelper.searchText))this.searchText=searchHelper.searchText.trim();if(!MscrmObject.isNullOrUndefined(searchHelper.stateCode))this.stateCode=searchHelper.stateCode;if(!MscrmObject.isNullOrUndefined(searchHelper.sortBy))this.sortBy=searchHelper.sortBy;if(!MscrmObject.isNullOrUndefined(searchHelper.languageLocaleId))this.languageLocaleId=searchHelper.languageLocaleId;if(!MscrmObject.isNullOrUndefined(searchHelper.locale))this.locale=searchHelper.locale.split("-")[0];if(!MscrmObject.isNullOrUndefined(searchHelper.isDescending))this.isDescending=searchHelper.isDescending;if(!MscrmObject.isNullOrUndefined(searchHelper.currentPageNumber)){if(searchHelper.searchParametersResetted)searchProvider.SearchParameters.CurrentPageNumber=searchHelper.currentPageNumber;this.currentPageNumber=searchProvider.SearchParameters.CurrentPageNumber}if(!MscrmObject.isNullOrUndefined(searchHelper.numberOfResults))this.numberOfResults=searchHelper.numberOfResults;if(!MscrmObject.isNullOrUndefined(searchHelper.notifyHandlersThatEventOccurredParameter))this.notifyHandlersThatEventOccurredParameter=searchHelper.notifyHandlersThatEventOccurredParameter;if(!MscrmObject.isNullOrUndefined(searchHelper.useInflection))this.useInflection=searchHelper.useInflection;if(!MscrmObject.isNullOrUndefined(searchHelper.removeDuplicates))this.removeDuplicates=searchHelper.removeDuplicates;if(!MscrmObject.isNullOrUndefined(searchHelper.showRatingUsing))this.showRatingUsing=searchHelper.showRatingUsing;if(!MscrmObject.isNullOrUndefined(searchHelper.visibility))this.visibility=searchHelper.visibility;if(!MscrmObject.isNullOrUndefined(searchHelper.dateRange))this.dateRange=searchHelper.dateRange};MicrosoftSearchParameter.IsRegistered=KbSearchControl.SearchParameterFactory.Register(KbSearchControl.SearchType.MicrosoftSearch,function(){return new MicrosoftSearchParameter});return MicrosoftSearchParameter}(KbSearchControl.KbSearchParameterBase);KbSearchControl.MicrosoftSearchParameter=MicrosoftSearchParameter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var MAX_PRECISION_VALUE=4,SHORT_PRECISION_VALUE=2,RelevanceSearchVersion=function(){function RelevanceSearchVersion(majorVersion,minorVersion,buildNumber,revisionNumber){this._majorVersion=majorVersion;this._minorVersion=minorVersion;this._buildNumber=buildNumber;this._revisionNumber=revisionNumber}RelevanceSearchVersion.prototype.ToShortString=function(){return this.ToPrecisionString(SHORT_PRECISION_VALUE)};RelevanceSearchVersion.prototype.ToLongString=function(){return this.ToPrecisionString(MAX_PRECISION_VALUE)};RelevanceSearchVersion.prototype.ToPrecisionString=function(precisionValue){for(var precisionStringList=[],i=0;i<Math.min(precisionValue,MAX_PRECISION_VALUE);i++)precisionStringList.push("{"+i+"}");return MscrmCommon.ControlUtils.String.Format(precisionStringList.join("."),this._majorVersion,this._minorVersion,this._buildNumber,this._revisionNumber)};return RelevanceSearchVersion}();KbSearchControl.RelevanceSearchVersion=RelevanceSearchVersion})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var AssociateDisassociateKnowledgeArticleRequest=function(){function AssociateDisassociateKnowledgeArticleRequest(regardingObjectId,regardingObjectTypeCode,associationRelationshipName,knowledgeArticleId,entityName){this.RegardingObjectId=regardingObjectId;this.RegardingObjectTypeCode=regardingObjectTypeCode;this.AssociationRelationshipName=associationRelationshipName;this.KnowledgeArticleId=knowledgeArticleId;this.EntityName=entityName}return AssociateDisassociateKnowledgeArticleRequest}();KbSearchControl.AssociateDisassociateKnowledgeArticleRequest=AssociateDisassociateKnowledgeArticleRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ColumnSet=function(){function ColumnSet(allColumns,columns){this.AllColumns=allColumns;this.Columns=columns}return ColumnSet}();KbSearchControl.ColumnSet=ColumnSet})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ODataObject=function(){function ODataObject(type,value){this.Type=type;this.Value=value}return ODataObject}();KbSearchControl.ODataObject=ODataObject;var ConditionExpression=function(){function ConditionExpression(entityName,attributeName,operator,values){this.EntityName=entityName;this.AttributeName=attributeName;this.Operator=operator;this.Values=values}return ConditionExpression}();KbSearchControl.ConditionExpression=ConditionExpression})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var JoinOperator;(function(JoinOperator){JoinOperator[JoinOperator["Inner"]=0]="Inner";JoinOperator[JoinOperator["LeftOuter"]=1]="LeftOuter";JoinOperator[JoinOperator["Natural"]=2]="Natural"})(JoinOperator=KbSearchControl.JoinOperator||(KbSearchControl.JoinOperator={}));var OrderType;(function(OrderType){OrderType[OrderType["Ascending"]=0]="Ascending";OrderType[OrderType["Descending"]=1]="Descending"})(OrderType=KbSearchControl.OrderType||(KbSearchControl.OrderType={}))})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var FilterExpression=function(){function FilterExpression(filterOperator,conditions,filters,isQuickFindFilter){this.FilterOperator=filterOperator;this.Conditions=conditions;this.Filters=filters;this.IsQuickFindFilter=isQuickFindFilter}return FilterExpression}();KbSearchControl.FilterExpression=FilterExpression})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var FullTextSearchKnowledgeArticleRequest=function(){function FullTextSearchKnowledgeArticleRequest(searchText,useInflection,removeDuplicates,stateCode,queryExpression){this.SearchText=searchText;this.UseInflection=useInflection;this.RemoveDuplicates=removeDuplicates;this.StateCode=stateCode;this.QueryExpression=queryExpression}return FullTextSearchKnowledgeArticleRequest}();KbSearchControl.FullTextSearchKnowledgeArticleRequest=FullTextSearchKnowledgeArticleRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var LinkEntity=function(){function LinkEntity(linkFromAttributeName,linkFromEntityName,linkToEntityName,linkToAttributeName,joinOperator,linkCriteria,linkEntities,columns,entityAlias,orders){this.LinkFromAttributeName=linkFromAttributeName;this.LinkFromEntityName=linkFromEntityName;this.LinkToEntityName=linkToEntityName;this.LinkToAttributeName=linkToAttributeName;this.JoinOperator=joinOperator;this.LinkCriteria=linkCriteria;this.LinkEntities=linkEntities;this.Columns=columns;this.EntityAlias=entityAlias;this.Orders=orders}return LinkEntity}();KbSearchControl.LinkEntity=LinkEntity})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var OrderExpression=function(){function OrderExpression(attributeName,orderType){this.AttributeName=attributeName;this.OrderType=orderType}return OrderExpression}();KbSearchControl.OrderExpression=OrderExpression})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var PagingInfo=function(){function PagingInfo(pageNumber,count,returnTotalRecordCount,pagingCookie){this.PageNumber=pageNumber;this.Count=count;this.ReturnTotalRecordCount=returnTotalRecordCount;this.PagingCookie=pagingCookie}return PagingInfo}();KbSearchControl.PagingInfo=PagingInfo})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var QueryBase=function(){function QueryBase(){}return QueryBase}();KbSearchControl.QueryBase=QueryBase;var QueryExpression=function(_super){__extends(QueryExpression,_super);function QueryExpression(distinct,noLock,pageInfo,linkEntities,criteria,orders,entityName,columnSet,topCount){var _this=_super.call(this)||this;_this.Distinct=distinct;_this.NoLock=noLock;_this.PageInfo=pageInfo;_this.LinkEntities=linkEntities;_this.Criteria=criteria;_this.Orders=orders;_this.EntityName=entityName;_this.ColumnSet=columnSet;_this.TopCount=topCount;_this["@odata.type"]="#Microsoft.Dynamics.CRM.QueryExpression";return _this}return QueryExpression}(QueryBase);KbSearchControl.QueryExpression=QueryExpression})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var BuildFullTextSearchRequestData=function(){function BuildFullTextSearchRequestData(){}BuildFullTextSearchRequestData.prototype.buildSearchRequest=function(kbSearchParameter,searchProvider){var useInflection=kbSearchParameter.useInflection||false,removeDuplicates=kbSearchParameter.removeDuplicates||false,stateCode=parseInt(kbSearchParameter.stateCode,10),fullTextSearchRequest=new KbSearchControl.FullTextSearchKnowledgeArticleRequest(kbSearchParameter.searchText,useInflection,removeDuplicates,stateCode,this.getQueryExpression(kbSearchParameter)),ODataEndPointUri=KbSearchControl.Constants.ODATA_PATH+"/FullTextSearchKnowledgeArticle";return new KbSearchControl.FullTextSearchRequestData([fullTextSearchRequest],MscrmControls.KbCommonUtils.POST_METHOD,ODataEndPointUri)};BuildFullTextSearchRequestData.prototype.getPagingInfo=function(kbSearchParameter){var currentPageNumber=parseInt(kbSearchParameter.currentPageNumber.toString(),10),numberOfResults=parseInt(kbSearchParameter.numberOfResults.toString(),10);return new KbSearchControl.PagingInfo(currentPageNumber,numberOfResults,true,"")};BuildFullTextSearchRequestData.prototype.getOrderExpression=function(kbSearchParameter){var orderExpressionArray=[];kbSearchParameter.sortBy&&orderExpressionArray.push(new KbSearchControl.OrderExpression(kbSearchParameter.sortBy,kbSearchParameter.isDescending?KbSearchControl.OrderType.Descending.toString():KbSearchControl.OrderType.Ascending.toString()));return orderExpressionArray};BuildFullTextSearchRequestData.prototype.addRatingFieldToColumnSet=function(kbSearchParameter,columns){if(!kbSearchParameter.showRatingUsing)return;if(columns.filter(function(value,index,obj){return obj[index]===kbSearchParameter.showRatingUsing}))return;columns.push(kbSearchParameter.showRatingUsing)};BuildFullTextSearchRequestData.prototype.getFilterExpression=function(kbSearchParameter){var objArray=[],conditionExpressionArray=[];if(kbSearchParameter.languageLocaleId){objArray.push(new KbSearchControl.ODataObject("System.Guid",kbSearchParameter.languageLocaleId));conditionExpressionArray.push(new KbSearchControl.ConditionExpression(KbSearchControl.Constants.knowledgearticleEntityType,KbSearchControl.Constants.languagelocaleid,KbSearchControl.Constants.ConditionOperatorMapping[KbSearchControl.ConditionOperator.Equal],objArray))}if(kbSearchParameter.visibility){objArray=[];objArray.push(new KbSearchControl.ODataObject("System.Boolean",kbSearchParameter.visibility));conditionExpressionArray.push(new KbSearchControl.ConditionExpression(KbSearchControl.Constants.knowledgearticleEntityType,KbSearchControl.Constants.isinternal,KbSearchControl.Constants.ConditionOperatorMapping[KbSearchControl.ConditionOperator.In],objArray))}if(kbSearchParameter.dateRange){objArray=[];if(kbSearchParameter.dateRange==KbSearchControl.DateFilterOptions.LastXDays)objArray.push(new KbSearchControl.ODataObject("System.Int32","30"));else if(kbSearchParameter.dateRange==KbSearchControl.DateFilterOptions.LastXMonths)objArray.push(new KbSearchControl.ODataObject("System.Int32","6"));else kbSearchParameter.dateRange==KbSearchControl.DateFilterOptions.LastXYears&&objArray.push(new KbSearchControl.ODataObject("System.Int32","1"));conditionExpressionArray.push(new KbSearchControl.ConditionExpression(KbSearchControl.Constants.knowledgearticleEntityType,KbSearchControl.Constants.modifiedon,KbSearchControl.Constants.ConditionOperatorMapping[kbSearchParameter.dateRange],objArray))}var filterExpressionArray=[];return new KbSearchControl.FilterExpression(KbSearchControl.Constants.LogicalOperatorMapping[KbSearchControl.LogicalOperator.And],conditionExpressionArray,filterExpressionArray,false)};BuildFullTextSearchRequestData.prototype.getColumnSet=function(kbSearchParameter){var columns=[KbSearchControl.Constants.knowledgearticleid,KbSearchControl.Constants.articlepublicnumber,KbSearchControl.Constants.title,KbSearchControl.Constants.description,KbSearchControl.Constants.content,KbSearchControl.Constants.knowledgearticleviews,KbSearchControl.Constants.createdon,KbSearchControl.Constants.modifiedon,KbSearchControl.Constants.statecode,KbSearchControl.Constants.statuscode,KbSearchControl.Constants.expirationdate,KbSearchControl.Constants.languagelocaleid,KbSearchControl.Constants.majorversionnumber,KbSearchControl.Constants.minorversionnumber,KbSearchControl.Constants.islatestversion,KbSearchControl.Constants.rating,KbSearchControl.Constants.isinternal];this.addRatingFieldToColumnSet(kbSearchParameter,columns);return new KbSearchControl.ColumnSet(false,columns)};BuildFullTextSearchRequestData.prototype.getLinkEntitySet=function(){var linkEntitySet=[];return linkEntitySet};BuildFullTextSearchRequestData.prototype.getQueryExpression=function(kbSearchParameter){return new KbSearchControl.QueryExpression(false,false,this.getPagingInfo(kbSearchParameter),this.getLinkEntitySet(),this.getFilterExpression(kbSearchParameter),this.getOrderExpression(kbSearchParameter),"knowledgearticle",this.getColumnSet(kbSearchParameter),null)};BuildFullTextSearchRequestData.isRegistered=KbSearchControl.BuildSearchRequestData.Register(KbSearchControl.SearchType.FullTextSearch,MscrmControls.KbCommonUtils.SearchProviderType.InternalDynamicsOrg,function(){return new BuildFullTextSearchRequestData});return BuildFullTextSearchRequestData}();KbSearchControl.BuildFullTextSearchRequestData=BuildFullTextSearchRequestData})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var FullTextSearchRequestData=function(){function FullTextSearchRequestData(request,method,endpoint){this.method=method;this.odataEndPointUri=endpoint;this.requests=request}return FullTextSearchRequestData}();KbSearchControl.FullTextSearchRequestData=FullTextSearchRequestData})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ArticleLanguage=function(){function ArticleLanguage(){}Object.defineProperty(ArticleLanguage.prototype,"Name",{"get":function(){return this._name},"set":function(name){this._name=name},enumerable:true,configurable:true});Object.defineProperty(ArticleLanguage.prototype,"LocaleId",{"get":function(){return this._localeId},"set":function(localeId){this._localeId=localeId},enumerable:true,configurable:true});Object.defineProperty(ArticleLanguage.prototype,"LanguageLocaleId",{"get":function(){return this._languageLocaleId},"set":function(languageLocaleId){this._languageLocaleId=languageLocaleId},enumerable:true,configurable:true});return ArticleLanguage}();KbSearchControl.ArticleLanguage=ArticleLanguage})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ArticleLanguageOption=function(){function ArticleLanguageOption(){}return ArticleLanguageOption}();KbSearchControl.ArticleLanguageOption=ArticleLanguageOption})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,FullTextSearchParameter=function(_super){__extends(FullTextSearchParameter,_super);function FullTextSearchParameter(){var _this=_super.call(this)||this;_this.setDefaultSettings();return _this}FullTextSearchParameter.prototype.setDefaultSettings=function(){this.searchText="";this.stateCode=KbSearchControl.Constants.ArticleState[KbSearchControl.Constants.PublishedState];this.languageLocaleId="";this.sortBy="";this.isDescending=true;this.currentPageNumber=1;this.numberOfResults=KbSearchControl.Constants.NumberofResults;this.notifyHandlersThatEventOccurredParameter={eventName:KbSearchControl.Constants.ON_POST_SEARCH,fieldName:"",pageId:"",contextToken:""}};FullTextSearchParameter.prototype.setParameterFromsearchHelper=function(searchHelper,searchProvider){if(!MscrmObject.isNullOrUndefined(searchHelper.searchText))this.searchText=searchHelper.searchText.trim();if(!MscrmObject.isNullOrUndefined(searchHelper.stateCode))this.stateCode=searchHelper.stateCode;if(!MscrmObject.isNullOrUndefined(searchHelper.sortBy))this.sortBy=searchHelper.sortBy;if(!MscrmObject.isNullOrUndefined(searchHelper.languageLocaleId))this.languageLocaleId=searchHelper.languageLocaleId;if(!MscrmObject.isNullOrUndefined(searchHelper.isDescending))this.isDescending=searchHelper.isDescending;if(!MscrmObject.isNullOrUndefined(searchHelper.currentPageNumber)){if(searchHelper.searchParametersResetted)searchProvider.SearchParameters.CurrentPageNumber=searchHelper.currentPageNumber;this.currentPageNumber=searchProvider.SearchParameters.CurrentPageNumber}if(!MscrmObject.isNullOrUndefined(searchHelper.numberOfResults))this.numberOfResults=searchHelper.numberOfResults;if(!MscrmObject.isNullOrUndefined(searchHelper.notifyHandlersThatEventOccurredParameter))this.notifyHandlersThatEventOccurredParameter=searchHelper.notifyHandlersThatEventOccurredParameter;if(!MscrmObject.isNullOrUndefined(searchHelper.useInflection))this.useInflection=searchHelper.useInflection;if(!MscrmObject.isNullOrUndefined(searchHelper.removeDuplicates))this.removeDuplicates=searchHelper.removeDuplicates;if(!MscrmObject.isNullOrUndefined(searchHelper.showRatingUsing))this.showRatingUsing=searchHelper.showRatingUsing;if(!MscrmObject.isNullOrUndefined(searchHelper.visibility))this.visibility=searchHelper.visibility;if(!MscrmObject.isNullOrUndefined(searchHelper.dateRange))this.dateRange=searchHelper.dateRange};FullTextSearchParameter.IsRegistered=KbSearchControl.SearchParameterFactory.Register(KbSearchControl.SearchType.FullTextSearch,function(){return new FullTextSearchParameter});return FullTextSearchParameter}(KbSearchControl.KbSearchParameterBase);KbSearchControl.FullTextSearchParameter=FullTextSearchParameter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SHOW_TITLE_MATCHES=false,MapRelevanceSearchResultsDataUtility=function(){function MapRelevanceSearchResultsDataUtility(){}Object.defineProperty(MapRelevanceSearchResultsDataUtility,"Instance",{"get":function(){if(!MapRelevanceSearchResultsDataUtility.instance)MapRelevanceSearchResultsDataUtility.instance=new MapRelevanceSearchResultsDataUtility;return MapRelevanceSearchResultsDataUtility.instance},enumerable:true,configurable:true});MapRelevanceSearchResultsDataUtility.prototype.generateMergedHighlightText=function(highlights){var localHighlights=highlights.slice(0);localHighlights.splice(0,0,"");localHighlights.splice(localHighlights.length,0,"");return localHighlights.join("...")};MapRelevanceSearchResultsDataUtility.prototype.convertRelevanceRecord=function(kbRelSearchRecord,processHighlights,searchProvider){if(processHighlights===void 0)processHighlights=true;var kbSearchRecord={highlights:{}};kbSearchRecord.knowledgeArticleId=kbRelSearchRecord.objectId;kbSearchRecord.knowledgeArticleViews=kbRelSearchRecord.relevanceData.knowledgearticleviews;kbSearchRecord.articlePublicNumber=kbRelSearchRecord.relevanceData.articlepublicnumber;kbSearchRecord.title=kbRelSearchRecord.relevanceData.title;kbSearchRecord.content=kbRelSearchRecord.relevanceData.content;kbSearchRecord.stateCode=kbRelSearchRecord.relevanceData.statecode&&kbRelSearchRecord.relevanceData.statecode.length>0&&kbRelSearchRecord.relevanceData.statecode[0];kbSearchRecord.statusCode=kbRelSearchRecord.relevanceData.statuscode&&kbRelSearchRecord.relevanceData.statuscode.length>0&&kbRelSearchRecord.relevanceData.statuscode[0];kbSearchRecord.createdon=kbRelSearchRecord.relevanceData.createdon;kbSearchRecord.modifiedOn=kbRelSearchRecord.relevanceData.modifiedon;kbSearchRecord.languageLocaleId=kbRelSearchRecord.relevanceData.languagelocaleid;kbSearchRecord.rating=kbRelSearchRecord.relevanceData.rating;kbSearchRecord.isAssociated=kbRelSearchRecord.relevanceData.isAssociated;kbSearchRecord.searchProviderType=searchProvider.SearchProviderType;kbSearchRecord.searchProviderId=searchProvider.SearchProviderId;kbSearchRecord.resourceUri=searchProvider.ResourceUri;kbSearchRecord.systemUserId=searchProvider.Settings.SystemUserId;if(processHighlights){if(SHOW_TITLE_MATCHES)if(kbRelSearchRecord.highlights.hasOwnProperty("title"))kbSearchRecord.highlights.title=this.generateMergedHighlightText(kbRelSearchRecord.highlights.title);if(kbRelSearchRecord.highlights.hasOwnProperty("content"))kbSearchRecord.highlights.content=this.generateMergedHighlightText(kbRelSearchRecord.highlights.content);kbSearchRecord.additionalMatches=Object.keys(kbRelSearchRecord.highlights).filter(function(key){return key!=="title"&&key!=="content"})}return kbSearchRecord};MapRelevanceSearchResultsDataUtility.prototype.checkAnnotationForAttachmentAndNotes=function(kbSearchRecord,annotation){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(kbSearchRecord.annotationAttachmentCount))kbSearchRecord.annotationAttachmentCount=0;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(kbSearchRecord.annotationNotesCount))kbSearchRecord.annotationNotesCount=0;if(annotation.highlights.hasOwnProperty(KbSearchControl.Constants.AttachmentFileName)||annotation.highlights.hasOwnProperty(KbSearchControl.Constants.AttachmentBody))kbSearchRecord.annotationAttachmentCount++;if(annotation.highlights.hasOwnProperty(KbSearchControl.Constants.NoteSubject)||annotation.highlights.hasOwnProperty(KbSearchControl.Constants.NoteText))kbSearchRecord.annotationNotesCount++};MapRelevanceSearchResultsDataUtility.prototype.processAnnotations=function(context,searchProvider,fetchApiWrapper,searchParam){var deferred=$.Deferred(),watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"processAnnotations"),kbArticleIDList=[];searchProvider.SearchResult.AnnotationRecords.forEach(function(annotation){var kbArticleId=annotation.relevanceData&&annotation.relevanceData.objectid;if(kbArticleId)kbArticleIDList.indexOf(kbArticleId)===-1&&kbArticleIDList.push(kbArticleId)});if(kbArticleIDList.length>0){this._stateManager.isMakeAdditionalCallToGetArticleDetails=false;searchProvider.SearchParameters.kbArticlesIDList=kbArticleIDList;var searchActionPayload={searchProvider:searchProvider,searchParam:searchParam,fetchApiWrapper:fetchApiWrapper,controlContext:context},promise=KbSearchControl.SearchActionFactory.Instance.ExecuteAction(KbSearchControl.SearchActionType.GetArticlesFromIds,searchActionPayload);watermarkTelemetryEvent.End();promise.then(function(response){deferred.resolve(response)},function(error){deferred.reject(error)})}else{watermarkTelemetryEvent.End();deferred.resolve()}return deferred.promise()};MapRelevanceSearchResultsDataUtility.prototype.UpdateAnnotationWithMatchedKbRecords=function(context,searchProvider){var _this=this,deferred=$.Deferred(),watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"processAnnotations"),matchedRecords=searchProvider.SearchResult.MatchedkbSearchRecords&&searchProvider.SearchResult.MatchedkbSearchRecords.value;searchProvider.SearchResult.AnnotationRecords.forEach(function(annotation){var kbArticleId=annotation.relevanceData&&annotation.relevanceData.objectid;if(kbArticleId){var existingRecord=searchProvider.SearchResult.KbRelevanceSearchRecordCollection&&searchProvider.SearchResult.KbRelevanceSearchRecordCollection.filter(function(kbRelevanceRecord){return kbRelevanceRecord.knowledgeArticleId===kbArticleId}),matchedRecord=matchedRecords&&matchedRecords.filter(function(kbRelevanceRecord){return kbRelevanceRecord.objectId===kbArticleId});if(existingRecord&&existingRecord.length>0){var kbSearchRecord=existingRecord[0];_this.checkAnnotationForAttachmentAndNotes(kbSearchRecord,annotation)}else if(matchedRecord&&matchedRecord.length>0){var kbMatchedRecord=matchedRecord[0],convertedRecord=_this.convertRelevanceRecord(kbMatchedRecord,false,searchProvider);convertedRecord.sortOrder=annotation.sortOrder;_this.checkAnnotationForAttachmentAndNotes(convertedRecord,annotation);if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(searchProvider.SearchResult.KbRelevanceSearchRecordCollection))searchProvider.SearchResult.KbRelevanceSearchRecordCollection=[];searchProvider.SearchResult.KbRelevanceSearchRecordCollection.push(convertedRecord);_this.AddKbSearchResult(convertedRecord,searchProvider)}}});this.updateCanCallRelevanceSearch(searchProvider);watermarkTelemetryEvent.End();deferred.resolve();return deferred.promise()};MapRelevanceSearchResultsDataUtility.prototype.MapRelevanceSearchResultData=function(context,searchProvider,fetchApiWrapper,searchParam){var deferred=$.Deferred();this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"MapRelevanceSearchResultData");searchProvider.SearchResult.KbRelevanceSearchRecordCollection=[];searchProvider.SearchResult.AnnotationRecords=[];searchProvider.SearchResult.TotalCount=0;var kbRelevanceSearchRecords=searchProvider.SearchResult.RelevanceSearchRecords;if(kbRelevanceSearchRecords){if(!searchProvider.IsLoading){kbRelevanceSearchRecords.warnings.forEach(function(warningMessage){context.utils.addGlobalNotification(KbSearchControl.Constants.GLOBAL_NOTIFICATION_TYPE_TOAST,KbSearchControl.Constants.GLOBAL_NOTIFICATION_LEVEL_WARNING,warningMessage,KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchWarningTitle,null,null)});kbRelevanceSearchRecords.warnings.splice(0)}for(var i=0;i<kbRelevanceSearchRecords.value.length;i++){var kbRelSearchRecord=kbRelevanceSearchRecords.value[i];kbRelSearchRecord.sortOrder=i;if(kbRelSearchRecord.entityName===KbSearchControl.Constants.knowledgearticleEntityType){var kbSearchRecord=this.convertRelevanceRecord(kbRelSearchRecord,true,searchProvider);kbSearchRecord.sortOrder=i;searchProvider.SearchResult.KbRelevanceSearchRecordCollection.push(kbSearchRecord);this.AddKbSearchResult(kbSearchRecord,searchProvider)}else searchProvider.SearchResult.AnnotationRecords.push(kbRelSearchRecord)}if(searchProvider.SearchResult.AnnotationRecords.length>0){var processAnnotationStatus=this.processAnnotations(context,searchProvider,fetchApiWrapper,searchParam);watermarkTelemetryEvent.End();searchProvider.SearchResult.KbRelevanceSearchRecordCollection.sort(function(a,b){return a.sortOrder-b.sortOrder});processAnnotationStatus.then(function(response){deferred.resolve(response)},function(error){deferred.reject(error)})}else deferred.resolve();searchProvider.SearchResult.TotalCount=kbRelevanceSearchRecords.totalCount;searchProvider.SearchResult.RecordIds=searchProvider.SearchResult.KbRelevanceSearchRecordCollection.map(function(record){return record.knowledgeArticleId});this.updateCanCallRelevanceSearch(searchProvider)}else{deferred.resolve();watermarkTelemetryEvent.End()}return deferred.promise()};MapRelevanceSearchResultsDataUtility.prototype.AddKbSearchResult=function(value,searchProvider){var matchingKbSearchResultCollection=searchProvider.SearchResult.KbSearchResultCollection.filter(function(kbSearchResult){return kbSearchResult.kbSearchRecord.knowledgeArticleId===value.knowledgeArticleId});matchingKbSearchResultCollection.length===0&&searchProvider.SearchResult.KbSearchResultCollection.push(new KbSearchControl.KbSearchResult(value))};MapRelevanceSearchResultsDataUtility.prototype.updateCanCallRelevanceSearch=function(searchProvider){if(this._stateManager.ExecuteKbSearchHelper.mode===1){var kbRelevanceSearchRecords=searchProvider.SearchResult.RelevanceSearchRecords;if(kbRelevanceSearchRecords.totalCount==kbRelevanceSearchRecords.value.length)searchProvider.canCallRelevanceSearch=false}};return MapRelevanceSearchResultsDataUtility}();KbSearchControl.MapRelevanceSearchResultsDataUtility=MapRelevanceSearchResultsDataUtility})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchRequestFactory=function(){function RelevanceSearchRequestFactory(){this._requestCache={};this._registerRequestMaps()}Object.defineProperty(RelevanceSearchRequestFactory,"Instance",{"get":function(){if(!this._instance)this._instance=new RelevanceSearchRequestFactory;return this._instance},enumerable:true,configurable:true});RelevanceSearchRequestFactory.prototype._registerRequestMaps=function(){this._requestCache[KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_INDEXEDSEARCH]=function(version){return new KbSearchControl.IndexedSearchRequest(version)};this._requestCache[KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_GETKBARTICLESSEARCH]=function(version){return new KbSearchControl.KbArticlesFromIDListRequest(version)};this._requestCache[KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_STATUS]=function(version){return new KbSearchControl.StatusRequest(version)}};RelevanceSearchRequestFactory.prototype.GetRequestObject=function(requestType,searchParameter){var relevanceSearchRequest=this._requestCache[requestType]();relevanceSearchRequest.PopulateAdditionalParameters(searchParameter);return relevanceSearchRequest};return RelevanceSearchRequestFactory}();KbSearchControl.RelevanceSearchRequestFactory=RelevanceSearchRequestFactory})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchRequest=function(){function RelevanceSearchRequest(version,controller,indexId,searchType){this._version=version;this._controller=controller;this._indexId=indexId;this._searchType=searchType}Object.defineProperty(RelevanceSearchRequest.prototype,"Controller",{"get":function(){return this._controller},enumerable:true,configurable:true});Object.defineProperty(RelevanceSearchRequest.prototype,"IndexId",{"get":function(){return this._indexId},enumerable:true,configurable:true});Object.defineProperty(RelevanceSearchRequest.prototype,"SearchType",{"get":function(){return this._searchType},enumerable:true,configurable:true});Object.defineProperty(RelevanceSearchRequest.prototype,"Version",{"get":function(){return this._version},enumerable:true,configurable:true});return RelevanceSearchRequest}();KbSearchControl.RelevanceSearchRequest=RelevanceSearchRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,RelevanceSearchParameter=function(_super){__extends(RelevanceSearchParameter,_super);function RelevanceSearchParameter(){var _this=_super.call(this)||this;_this.setDefaultSettings();return _this}RelevanceSearchParameter.prototype.setDefaultSettings=function(){this.searchText="";this.stateCode=KbSearchControl.Constants.ArticleState[KbSearchControl.Constants.PublishedState];this.languageLocaleId="";this.sortBy="";this.isDescending=true;this.currentPageNumber=1;this.numberOfResults=KbSearchControl.Constants.NumberofResults;this.notifyHandlersThatEventOccurredParameter={eventName:KbSearchControl.Constants.ON_POST_SEARCH,fieldName:"",pageId:"",contextToken:""};this.searchMode=1;this.numberTimeExternalRelevanceSearchCall=1};RelevanceSearchParameter.prototype.setParameterFromsearchHelper=function(searchHelper,searchProvider){if(!MscrmObject.isNullOrUndefined(searchHelper.searchText))this.searchText=searchHelper.searchText.trim();if(!MscrmObject.isNullOrUndefined(searchHelper.stateCode))this.stateCode=searchHelper.stateCode;if(!MscrmObject.isNullOrUndefined(searchHelper.sortBy))this.sortBy=searchHelper.sortBy;if(!MscrmObject.isNullOrUndefined(searchHelper.languageLocaleId))this.languageLocaleId=searchHelper.languageLocaleId;if(!MscrmObject.isNullOrUndefined(searchHelper.isDescending))this.isDescending=searchHelper.isDescending;if(!MscrmObject.isNullOrUndefined(searchHelper.currentPageNumber)){if(searchHelper.searchParametersResetted)searchProvider.SearchParameters.CurrentPageNumber=searchHelper.currentPageNumber;this.currentPageNumber=searchProvider.SearchParameters.CurrentPageNumber}if(!MscrmObject.isNullOrUndefined(searchHelper.numberTimeExternalRelevanceSearchCall)){if(searchHelper.searchParametersResetted)searchProvider.SearchParameters.numberTimeExternalRelevanceSearchCall=searchHelper.numberTimeExternalRelevanceSearchCall;this.numberTimeExternalRelevanceSearchCall=searchProvider.SearchParameters.numberTimeExternalRelevanceSearchCall}if(!MscrmObject.isNullOrUndefined(searchHelper.numberOfResults))this.numberOfResults=searchHelper.numberOfResults;if(!MscrmObject.isNullOrUndefined(searchHelper.mode))this.searchMode=searchHelper.mode;if(!MscrmObject.isNullOrUndefined(searchHelper.notifyHandlersThatEventOccurredParameter))this.notifyHandlersThatEventOccurredParameter=searchHelper.notifyHandlersThatEventOccurredParameter;if(!MscrmObject.isNullOrUndefined(searchProvider.SearchParameters.kbArticlesIDList))this.kbArticleIDList=searchProvider.SearchParameters.kbArticlesIDList;if(!MscrmObject.isNullOrUndefined(searchHelper.visibility))this.visibility=searchHelper.visibility;if(!MscrmObject.isNullOrUndefined(searchHelper.dateRange))this.dateRange=searchHelper.dateRange;this.isMdfDisabled=!searchHelper.enableMetadataFiltering;if(searchHelper.enableMetadataFiltering)this.additionalKnowledgeArticleFilters=searchHelper.GetLiveAdditionalFilters()};RelevanceSearchParameter.IsRegistered=KbSearchControl.SearchParameterFactory.Register(KbSearchControl.SearchType.RelevanceSearch,function(){return new RelevanceSearchParameter});return RelevanceSearchParameter}(KbSearchControl.KbSearchParameterBase);KbSearchControl.RelevanceSearchParameter=RelevanceSearchParameter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var IndexedSearchParameter=function(){function IndexedSearchParameter(searchText,searchEntities,facets,pageSize,pageNumber,sortAttribute,isDescending,filters){this._searchText=searchText;this._searchEntities=searchEntities;this._facets=facets;this._pageSize=pageSize;this._pageNumber=pageNumber;this._sortAttribute=sortAttribute;this._isDescending=isDescending;this._filters=filters}IndexedSearchParameter.prototype.GetFilterString=function(){var filterQueryParts=[],encodeURISearchText="*";if(this._searchText)encodeURISearchText=encodeURIComponent(this._searchText);filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("search={0}",encodeURISearchText));filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("searchEntities={0}",this._searchEntities.join(",")));filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("$top={0}",this._pageSize));filterQueryParts.push("$count=true");this._pageNumber>1&&filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("$skip={0}",(this._pageNumber-1)*this._pageSize));if(this._facets.length>0){var facetString=void 0;if(this._facets.length===1)facetString=KbSearchControl.RelevanceSearchEnumHelper.mapEnumToString(this._facets[0]);else facetString="("+this._facets.map(function(facet){return KbSearchControl.RelevanceSearchEnumHelper.mapEnumToString(facet)}).join("),(")+")";filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("facet={0}",facetString))}if(this._sortAttribute){var sortString=this._sortAttribute;if(this._isDescending)sortString+=" desc";filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("orderby={0}",sortString))}this._filters.length>0&&filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("$filter={0}",this._filters.map(function(entityFilter){return entityFilter.FilterString}).join(",")));return filterQueryParts.join("&")};return IndexedSearchParameter}();KbSearchControl.IndexedSearchParameter=IndexedSearchParameter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ENTITY_NAME_KNOWLEDGE_ARTICLE="knowledgearticle",ENTITY_NAME_ANNOTATION="annotation",ATTRIBUTE_STATE_CODE="statecode",ATTRIBUTE_LANGUAGE_LOCALE_ID="languagelocaleid",ATTRIBUTE_OBJECT_TYPE_CODE="objecttypecode",ATTRIBUTE_ISINTERNAL="isinternal",ATTRIBUTE_MODIFIEDON="modifiedon",OPERATOR_EQUALS="eq",OPERATOR_GREATERTHANEQUAL="ge",OPERATOR_LESSERTHAN="lt",STRFORM_QUOTED_STRING="'{0}'",IndexedSearchRequest=function(_super){__extends(IndexedSearchRequest,_super);function IndexedSearchRequest(version){return _super.call(this,version||KbSearchControl.RELEVANCESEARCH_DEFAULT_VERSION,KbSearchControl.RelevanceSearchControllers.SearchIndexController,KbSearchControl.RELEVANCESEARCH_DEFAULT_IDENTIFIER,KbSearchControl.RelevanceSearchTypes.Entities)||this}IndexedSearchRequest.prototype._getQuotedString=function(baseString){return MscrmCommon.ControlUtils.String.Format(STRFORM_QUOTED_STRING,baseString)};IndexedSearchRequest.prototype.PopulateAdditionalParameters=function(parameter){var searchEntities=[ENTITY_NAME_KNOWLEDGE_ARTICLE],relevanceFilters=[],articleFilter=new KbSearchControl.RelevanceSearchFilter(ENTITY_NAME_KNOWLEDGE_ARTICLE);articleFilter.AddCondition(ATTRIBUTE_STATE_CODE,OPERATOR_EQUALS,parameter.stateCode);articleFilter.AddCondition(ATTRIBUTE_LANGUAGE_LOCALE_ID,OPERATOR_EQUALS,this._getQuotedString(parameter.languageLocaleId));parameter.visibility!=null&&articleFilter.AddCondition(ATTRIBUTE_ISINTERNAL,OPERATOR_EQUALS,parameter.visibility);if(parameter.dateRange!=null){var today=moment().utc(),lowerLimit=moment().utc();switch(parameter.dateRange){case KbSearchControl.DateFilterOptions.Last7Days:lowerLimit=lowerLimit.subtract(7,"days");articleFilter.Add2ConditionsForAnAttribute(ATTRIBUTE_MODIFIEDON,OPERATOR_GREATERTHANEQUAL,lowerLimit.format(),OPERATOR_LESSERTHAN,today.format());break;case KbSearchControl.DateFilterOptions.LastXDays:lowerLimit=lowerLimit.subtract(30,"days");articleFilter.Add2ConditionsForAnAttribute(ATTRIBUTE_MODIFIEDON,OPERATOR_GREATERTHANEQUAL,lowerLimit.format(),OPERATOR_LESSERTHAN,today.format());break;case KbSearchControl.DateFilterOptions.LastXMonths:lowerLimit=lowerLimit.subtract(6,"months");articleFilter.Add2ConditionsForAnAttribute(ATTRIBUTE_MODIFIEDON,OPERATOR_GREATERTHANEQUAL,lowerLimit.format(),OPERATOR_LESSERTHAN,today.format());break;case KbSearchControl.DateFilterOptions.LastXYears:lowerLimit=lowerLimit.subtract(1,"years");articleFilter.Add2ConditionsForAnAttribute(ATTRIBUTE_MODIFIEDON,OPERATOR_GREATERTHANEQUAL,lowerLimit.format(),OPERATOR_LESSERTHAN,today.format());break;default:break}}if(parameter.additionalKnowledgeArticleFilters)for(var attribute in parameter.additionalKnowledgeArticleFilters)articleFilter.AddCondition(attribute,OPERATOR_EQUALS,this._getQuotedString(parameter.additionalKnowledgeArticleFilters[attribute]));relevanceFilters.push(articleFilter);var pageSize=parameter.numberOfResults,pageNumber=parameter.currentPageNumber;if(parameter.searchMode===1){searchEntities.push(ENTITY_NAME_ANNOTATION);var annotationFilter=new KbSearchControl.RelevanceSearchFilter(ENTITY_NAME_ANNOTATION);annotationFilter.AddCondition(ATTRIBUTE_OBJECT_TYPE_CODE,OPERATOR_EQUALS,this._getQuotedString(ENTITY_NAME_KNOWLEDGE_ARTICLE));relevanceFilters.push(annotationFilter);pageSize=Math.max(KbSearchControl.ADVANCED_RELEVANCE_SEARCH_MAX_PAGE_SIZE,parameter.numberOfResults);pageNumber=parameter.numberTimeExternalRelevanceSearchCall}this._indexedSearchParams=new KbSearchControl.IndexedSearchParameter(parameter.searchText,searchEntities,[KbSearchControl.RelevanceSearchFacets.EntityName],pageSize,pageNumber,parameter.sortBy,parameter.isDescending,relevanceFilters)};IndexedSearchRequest.prototype.GenerateURL=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_URL_PATTERN,KbSearchControl.RelevanceSearchEnumHelper.mapEnumToString(this.Controller),this.IndexId,KbSearchControl.RelevanceSearchEnumHelper.mapEnumToString(this.SearchType))};IndexedSearchRequest.prototype.GenerateQueryString=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_QUERYSTRING_PATTERN,this.Version.ToShortString(),this._indexedSearchParams.GetFilterString())};return IndexedSearchRequest}(KbSearchControl.RelevanceSearchRequest);KbSearchControl.IndexedSearchRequest=IndexedSearchRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var KbArticlesFromIDListRequest=function(_super){__extends(KbArticlesFromIDListRequest,_super);function KbArticlesFromIDListRequest(version){return _super.call(this,version||KbSearchControl.RELEVANCESEARCH_DEFAULT_VERSION,KbSearchControl.RelevanceSearchControllers.SearchIndexController,KbSearchControl.RELEVANCESEARCH_DEFAULT_IDENTIFIER,KbSearchControl.RelevanceSearchTypes.Entities)||this}KbArticlesFromIDListRequest.prototype.PopulateAdditionalParameters=function(parameter){this._KbArticlesFromIDsSearchParams=new KbSearchControl.KbArticlesFromIDsSearchParameter(parameter.kbArticleIDList,parameter.stateCode,parameter.languageLocaleId)};KbArticlesFromIDListRequest.prototype.GenerateURL=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_URL_PATTERN,KbSearchControl.RelevanceSearchEnumHelper.mapEnumToString(this.Controller),this.IndexId,KbSearchControl.RelevanceSearchEnumHelper.mapEnumToString(this.SearchType))};KbArticlesFromIDListRequest.prototype.GenerateQueryString=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_QUERYSTRING_PATTERN,this.Version.ToShortString(),this._KbArticlesFromIDsSearchParams.GetFilterString())};return KbArticlesFromIDListRequest}(KbSearchControl.RelevanceSearchRequest);KbSearchControl.KbArticlesFromIDListRequest=KbArticlesFromIDListRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ENTITY_NAME_KNOWLEDGE_ARTICLE="knowledgearticle",ATTRIBUTE_STATE_CODE="statecode",ATTRIBUTE_LANGUAGE_LOCALE_ID="languagelocaleid",ATTRIBUTE_KNOWLEDGE_ARTICLE_ID="knowledgearticleid",OPERATOR_EQUALS="eq",STRFORM_QUOTED_STRING="'{0}'",STRFORM_PARANTHESIS_STRING="({0})",KbArticlesFromIDsSearchParameter=function(){function KbArticlesFromIDsSearchParameter(knowledgeArticleIdList,stateCode,languageLocaleId){this._knowledgeArticleIdConditions=this._constructArticleListConditions(knowledgeArticleIdList);this._searchFilter=this._constructAdditionalFilter(stateCode,languageLocaleId)}KbArticlesFromIDsSearchParameter.prototype._constructArticleListConditions=function(knowledgeArticleIdList){for(var articleConditions=[],_i=0,knowledgeArticleIdList_1=knowledgeArticleIdList;_i<knowledgeArticleIdList_1.length;_i++){var knowledgeArticleId=knowledgeArticleIdList_1[_i];articleConditions.push(new KbSearchControl.RelevanceSearchCondition(ATTRIBUTE_KNOWLEDGE_ARTICLE_ID,OPERATOR_EQUALS,this._getQuotedString(knowledgeArticleId)))}return articleConditions};KbArticlesFromIDsSearchParameter.prototype._constructAdditionalFilter=function(stateCode,languageLocaleId){var articleFilter=new KbSearchControl.RelevanceSearchFilter(ENTITY_NAME_KNOWLEDGE_ARTICLE);articleFilter.AddCondition(ATTRIBUTE_STATE_CODE,OPERATOR_EQUALS,stateCode);articleFilter.AddCondition(ATTRIBUTE_LANGUAGE_LOCALE_ID,OPERATOR_EQUALS,this._getQuotedString(languageLocaleId));return articleFilter};KbArticlesFromIDsSearchParameter.prototype._getQuotedString=function(baseString){return MscrmCommon.ControlUtils.String.Format(STRFORM_QUOTED_STRING,baseString)};KbArticlesFromIDsSearchParameter.prototype.GetFilterString=function(){var filterQueryParts=[];filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("searchEntities={0}",ENTITY_NAME_KNOWLEDGE_ARTICLE));filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("$filter={0}",this._getMergedAttributeFilter()));filterQueryParts.push("$count=true");return filterQueryParts.join("&")};KbArticlesFromIDsSearchParameter.prototype._getMergedAttributeFilter=function(){var attributeFilterParts=[];attributeFilterParts.push(this._searchFilter.FilterString);attributeFilterParts.push(MscrmCommon.ControlUtils.String.Format(STRFORM_PARANTHESIS_STRING,this._knowledgeArticleIdConditions.map(function(articleCondition){return articleCondition.FilterString}).join(" or ")));return attributeFilterParts.join(" and ")};return KbArticlesFromIDsSearchParameter}();KbSearchControl.KbArticlesFromIDsSearchParameter=KbArticlesFromIDsSearchParameter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchCondition=function(){function RelevanceSearchCondition(attribute,operator,value){this._attribute=attribute;this._operator=operator;this._value=value}Object.defineProperty(RelevanceSearchCondition.prototype,"FilterString",{"get":function(){return this._attribute+" "+this._operator+" "+this._value},enumerable:true,configurable:true});return RelevanceSearchCondition}();KbSearchControl.RelevanceSearchCondition=RelevanceSearchCondition})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){KbSearchControl.RELEVANCESEARCH_URL_PATTERN="/api/search/{0}/{1}/{2}";KbSearchControl.RELEVANCESEARCH_BASE_QUERYSTRING_PATTERN="?api-version={0}";KbSearchControl.RELEVANCESEARCH_QUERYSTRING_PATTERN="?api-version={0}&{1}";KbSearchControl.RELEVANCESEARCH_DEFAULT_VERSION=new KbSearchControl.RelevanceSearchVersion(9,0,0,0);KbSearchControl.EXECUTE_RELEVANCESEARCH_REDUCER_BASE="execute.relevancesearch";KbSearchControl.ADVANCED_RELEVANCE_SEARCH_MAX_PAGE_SIZE=50;KbSearchControl.RELEVANCESEARCH_INDEX_CONTROLLER="indexes";KbSearchControl.RELEVANCESEARCH_DEFAULT_IDENTIFIER="default";KbSearchControl.RELEVANCESEARCH_ENTITY_TYPE="entities";KbSearchControl.RELEVANCESEARCH_MAPPING_TYPE="mapping";KbSearchControl.RELEVANCESEARCH_STATUS_TYPE="status";KbSearchControl.RELEVANCESEARCH_STATS_TYPE="stats";KbSearchControl.RELEVANCESEARCH_FACET_ENTITYNAME="@search.entityname";KbSearchControl.RELEVANCESEARCH_FACET_OBJECTID="@search.objectid";KbSearchControl.RELEVANCESEARCH_FACET_HIGHLIGHTS="@search.highlights";KbSearchControl.RELEVANCESEARCH_FACET_SCORE="@search.score";KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_INDEXEDSEARCH="IndexedRelevanceSearch";KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_GETKBARTICLESSEARCH="GetKbArticlesFromIDList";KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_STATUS="Status"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchControllers;(function(RelevanceSearchControllers){RelevanceSearchControllers[RelevanceSearchControllers["SearchIndexController"]=0]="SearchIndexController"})(RelevanceSearchControllers=KbSearchControl.RelevanceSearchControllers||(KbSearchControl.RelevanceSearchControllers={}));var RelevanceSearchTypes;(function(RelevanceSearchTypes){RelevanceSearchTypes[RelevanceSearchTypes["Entities"]=100]="Entities";RelevanceSearchTypes[RelevanceSearchTypes["FieldMappings"]=101]="FieldMappings";RelevanceSearchTypes[RelevanceSearchTypes["Status"]=102]="Status";RelevanceSearchTypes[RelevanceSearchTypes["Statistics"]=103]="Statistics"})(RelevanceSearchTypes=KbSearchControl.RelevanceSearchTypes||(KbSearchControl.RelevanceSearchTypes={}));var RelevanceSearchFacets;(function(RelevanceSearchFacets){RelevanceSearchFacets[RelevanceSearchFacets["EntityName"]=1e4]="EntityName";RelevanceSearchFacets[RelevanceSearchFacets["ObjectId"]=10001]="ObjectId";RelevanceSearchFacets[RelevanceSearchFacets["Score"]=10002]="Score";RelevanceSearchFacets[RelevanceSearchFacets["Highlights"]=10003]="Highlights"})(RelevanceSearchFacets=KbSearchControl.RelevanceSearchFacets||(KbSearchControl.RelevanceSearchFacets={}));var RelevanceSearchEnumHelper=function(){function RelevanceSearchEnumHelper(){}RelevanceSearchEnumHelper.mapEnumToString=function(enumValue){switch(enumValue){case RelevanceSearchControllers.SearchIndexController:return KbSearchControl.RELEVANCESEARCH_INDEX_CONTROLLER;case RelevanceSearchTypes.Entities:return KbSearchControl.RELEVANCESEARCH_ENTITY_TYPE;case RelevanceSearchTypes.FieldMappings:return KbSearchControl.RELEVANCESEARCH_MAPPING_TYPE;case RelevanceSearchTypes.Statistics:return KbSearchControl.RELEVANCESEARCH_STATS_TYPE;case RelevanceSearchTypes.Status:return KbSearchControl.RELEVANCESEARCH_STATUS_TYPE;case RelevanceSearchFacets.EntityName:return KbSearchControl.RELEVANCESEARCH_FACET_ENTITYNAME;case RelevanceSearchFacets.Highlights:return KbSearchControl.RELEVANCESEARCH_FACET_HIGHLIGHTS;case RelevanceSearchFacets.ObjectId:return KbSearchControl.RELEVANCESEARCH_FACET_OBJECTID;case RelevanceSearchFacets.Score:return KbSearchControl.RELEVANCESEARCH_FACET_SCORE;default:throw"Enumeration currently not supported for string conversion. Update mapper to handle parsing for the enum"}};return RelevanceSearchEnumHelper}();KbSearchControl.RelevanceSearchEnumHelper=RelevanceSearchEnumHelper})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchFilter=function(){function RelevanceSearchFilter(entityName){this._entityName=entityName;this._conditions=[]}Object.defineProperty(RelevanceSearchFilter.prototype,"FilterString",{"get":function(){var baseString=this._conditions.map(function(cond){return cond.FilterString}).join(" and ");return this._entityName+":"+baseString},enumerable:true,configurable:true});RelevanceSearchFilter.prototype.AddCondition=function(attribute,operator,value){this._conditions.push(new KbSearchControl.RelevanceSearchCondition(attribute,operator,value))};RelevanceSearchFilter.prototype.Add2ConditionsForAnAttribute=function(attribute,operator1,value1,operator2,value2){this._conditions.push(new KbSearchControl.RelevanceSearchCondition(attribute,operator1,value1));this._conditions.push(new KbSearchControl.RelevanceSearchCondition(attribute,operator2,value2))};return RelevanceSearchFilter}();KbSearchControl.RelevanceSearchFilter=RelevanceSearchFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var StatusRequest=function(_super){__extends(StatusRequest,_super);function StatusRequest(version){return _super.call(this,version||KbSearchControl.RELEVANCESEARCH_DEFAULT_VERSION,KbSearchControl.RelevanceSearchControllers.SearchIndexController,KbSearchControl.RELEVANCESEARCH_DEFAULT_IDENTIFIER,KbSearchControl.RelevanceSearchTypes.Status)||this}StatusRequest.prototype.PopulateAdditionalParameters=function(parameter){};StatusRequest.prototype.GenerateURL=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_URL_PATTERN,KbSearchControl.RelevanceSearchEnumHelper.mapEnumToString(this.Controller),this.IndexId,KbSearchControl.RelevanceSearchEnumHelper.mapEnumToString(this.SearchType))};StatusRequest.prototype.GenerateQueryString=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_BASE_QUERYSTRING_PATTERN,this.Version.ToShortString())};return StatusRequest}(KbSearchControl.RelevanceSearchRequest);KbSearchControl.StatusRequest=StatusRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchActionUtility=function(){function KbSearchActionUtility(){}KbSearchActionUtility.UpdateErrorStateInContext=function(context,errorMessage,isControlDisabled,errorDescription,additionalProperties){if(isControlDisabled===void 0)isControlDisabled=false;var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.errorDetails=errorDescription;stateManager.errorMessage=errorMessage;context.parameters.value.isControlDisabled=isControlDisabled;stateManager.error=true;stateManager.loading=false;stateManager.recordIds=[];stateManager.records=[];stateManager.relevanceSearchRecords=null;stateManager.kbRelevanceSearchRecordCollection=[];additionalProperties&&Object.assign(stateManager,additionalProperties)};KbSearchActionUtility.UpdateLoadingStateInContext=function(context){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.errorMessage="";stateManager.error=false;stateManager.loading=true};KbSearchActionUtility.UpdateRelevanceSearchResultsInContext=function(context,searchProvider){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.relevanceSearchRecords=searchProvider.SearchResult.RelevanceSearchRecords;stateManager.kbRelevanceSearchRecordCollection=searchProvider.SearchResult.KbRelevanceSearchRecordCollection;stateManager.SetKbSearchResultCollection(searchProvider.SearchResult.KbSearchResultCollection);stateManager.records=null;stateManager.recordIds=null;context.parameters.value.isControlDisabled=false;stateManager.loading=searchProvider.IsLoading};KbSearchActionUtility.CheckSearchConditions=function(context){if(!context.parameters.value.isKnowledgeManagementEnabled){KbSearchActionUtility.UpdateErrorStateInContext(context,KbSearchControl.Constants.KnowledgeManagementNotEnabledErrorMessageResourceName);context.utils.requestRender();return false}return true};KbSearchActionUtility.UpdateErrorStateInSearchProvider=function(searchProvider,errorMessage,errorDescription){searchProvider.SearchError=new KbSearchControl.KbSearchProviderError(errorMessage,errorDescription);searchProvider.SearchResult.RecordIds=[];searchProvider.SearchResult.Records=[];searchProvider.SearchResult.RelevanceSearchRecords=null;searchProvider.SearchResult.KbRelevanceSearchRecordCollection=[];searchProvider.SearchResult.TotalCount=0;searchProvider.SearchResult.IsKnowledgeSearchInsightRecordCreated=false};KbSearchActionUtility.UpdateSuccessStateInSearchProvider=function(searchProvider,searchRecords,recordIds,relevanceSearchRecords){searchProvider.SearchError=null;searchProvider.SearchResult.Records=searchRecords;searchProvider.SearchResult.RecordIds=recordIds;searchProvider.SearchResult.RelevanceSearchRecords=relevanceSearchRecords};KbSearchActionUtility.UpdateNonRelevanceSearchResultsInContext=function(context,searchProvider){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.relevanceSearchRecords=null;stateManager.records=searchProvider.SearchResult.Records;stateManager.recordIds=searchProvider.SearchResult.RecordIds;context.parameters.value.isControlDisabled=false;stateManager.loading=searchProvider.IsLoading};KbSearchActionUtility.ResetSearchResultsStateInContext=function(context){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.errorDetails="";stateManager.errorMessage="";stateManager.error=false;stateManager.recordIds=null;stateManager.records=null;stateManager.relevanceSearchRecords=null;stateManager.kbRelevanceSearchRecordCollection=[];stateManager.SetKbSearchResultCollection([]);stateManager.totalCount=0;stateManager.isExternalSearchIndexEnabled=false};KbSearchActionUtility.UpdateSearchProviderStateInContext=function(context,searchProvider){KbSearchActionUtility.ResetSearchResultsStateInContext(context);var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);if(searchProvider.IsLoading)stateManager.loading=searchProvider.IsLoading;else if(searchProvider.SearchError!=null)KbSearchActionUtility.UpdateErrorStateInContext(context,searchProvider.SearchError.ErrorMessage,false,searchProvider.SearchError.ErrorDetails,{totalCount:0});else if(searchProvider.SearchResult.TotalCount==0)KbSearchActionUtility.UpdateErrorStateInContext(context,KbSearchControl.Constants.NoArticlesErrorMessageResourceName,false,"",{totalCount:0});else{if(searchProvider.Settings.IsRelevanceSearchEnabled)KbSearchActionUtility.UpdateRelevanceSearchResultsInContext(context,searchProvider);else KbSearchActionUtility.UpdateNonRelevanceSearchResultsInContext(context,searchProvider);stateManager.isExternalSearchIndexEnabled=searchProvider.Settings.IsRelevanceSearchEnabled;stateManager.totalCount=searchProvider.SearchResult.TotalCount}};KbSearchActionUtility.SearchParameterIsExecutable=function(kbSearchParameter,searchProvider){if(searchProvider.SearchType==KbSearchControl.SearchType.MicrosoftSearch){if(kbSearchParameter&&kbSearchParameter.locale)return true}else if(kbSearchParameter&&kbSearchParameter.languageLocaleId)return true;return false};KbSearchActionUtility.ValidateSearchActions=function(kbSearchParameter,context,searchProvider){if(!KbSearchActionUtility.SearchParameterIsExecutable(kbSearchParameter,searchProvider)){KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.MandatoryFieldMissingErrorMessage);return false}if(!KbSearchActionUtility.CheckSearchConditions(context)){KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.KnowledgeManagementNotEnabledErrorMessageResourceName);return false}if(!kbSearchParameter.searchText){KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.NoSearchErrorMessageResourceName,"");return false}return true};KbSearchActionUtility.checkAssociation=function(linkedArticles,knowledgeArticleId){return linkedArticles.filter(function(associatedArticle){var associatedArticleId=associatedArticle.knowledgeArticleId;return associatedArticleId===knowledgeArticleId}).length>0};return KbSearchActionUtility}();KbSearchControl.KbSearchActionUtility=KbSearchActionUtility})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteFullTextSearchAction=function(){function ExecuteFullTextSearchAction(){}ExecuteFullTextSearchAction.prototype.ExecuteAction=function(actionPayload){var context=actionPayload.controlContext,kbSearchParameter=actionPayload.searchParam,fetchApiWrapper=actionPayload.fetchApiWrapper,searchProvider=actionPayload.searchProvider,additionalTelemetryEventParameters=[{name:"searchProvider",value:searchProvider.Name}],watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameFullTextSearchActions,"ExecuteFullTextSearchAction",additionalTelemetryEventParameters),deferred=$.Deferred(),fullTextSearchRequestData=KbSearchControl.BuildSearchRequestData.BuildSearchRequest(kbSearchParameter,searchProvider),additionalHeaders={prefer:'odata.include-annotations="*"'};fetchApiWrapper.Fetch(context,fullTextSearchRequestData.method,fullTextSearchRequestData.odataEndPointUri,JSON.stringify(fullTextSearchRequestData.requests[0]),MscrmControls.KbCommonUtils.SearchProviderType.CrossDynamicsOrg==searchProvider.SearchProviderType,searchProvider.ResourceUri,MscrmControls.KbCommonUtils.Constants.CrossDynamicsOrgApiCall,additionalHeaders).then(function(searchResults){watermarkTelemetryEvent.End();context.parameters.value.executeNotifyHandlersThatEventOccurred(kbSearchParameter.notifyHandlersThatEventOccurredParameter);if(searchResults&&searchResults.error){var errorDescription=searchResults.error.message?searchResults.error.message:"";KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.ServerSearchFailure,errorDescription)}else if(searchResults&&searchResults.value&&searchResults.value.length>0){searchProvider.SearchResult.TotalCount=searchResults["@Microsoft.Dynamics.CRM.totalrecordcount"];var kbSearchRecords_1=Array();if(kbSearchParameter.currentPageNumber>1)kbSearchRecords_1=searchProvider.SearchResult.Records;else kbSearchRecords_1=Array();var showRatingUsing_1=kbSearchParameter.showRatingUsing?kbSearchParameter.showRatingUsing:"rating";searchResults.value.map(function(searchResult){kbSearchRecords_1.push({knowledgeArticleId:searchResult.knowledgearticleid,articlePublicNumber:searchResult.articlepublicnumber,title:searchResult.title,content:searchResult.content,knowledgeArticleViews:searchResult.knowledgearticleviews,createdon:searchResult.createdon,modifiedOn:searchResult.modifiedon,expirationdate:searchResult.expirationdate,stateCode:searchResult.statecode,statusCode:searchResult.statuscode,languageLocaleId:searchResult._languagelocaleid_value,rating:searchResult[showRatingUsing_1],isAssociated:false,searchProviderType:searchProvider.SearchProviderType,searchProviderId:searchProvider.SearchProviderId,resourceUri:searchProvider.ResourceUri,systemUserId:searchProvider.Settings.SystemUserId})});var recordIds=kbSearchRecords_1.map(function(record){return record.knowledgeArticleId});KbSearchControl.KbSearchActionUtility.UpdateSuccessStateInSearchProvider(searchProvider,kbSearchRecords_1,recordIds,null);context.parameters.value.isControlDisabled=false}else KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.NoArticlesErrorMessageResourceName,"");deferred.resolve(searchResults)},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.ServerSearchFailure,errorMessage);watermarkTelemetryEvent.EndAndLogError({controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:"KbSearchControl.ExecuteFullTextSearchAction"+errorMessage,eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")}]});deferred.reject(error)});return deferred.promise()};ExecuteFullTextSearchAction.IsRegistered=KbSearchControl.SearchActionFactory.Register(KbSearchControl.SearchActionType.ExecuteFullTextSearch,function(){return new ExecuteFullTextSearchAction});return ExecuteFullTextSearchAction}();KbSearchControl.ExecuteFullTextSearchAction=ExecuteFullTextSearchAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var GetArticlesFromIdsSearchAction=function(){function GetArticlesFromIdsSearchAction(){}GetArticlesFromIdsSearchAction.prototype.ExecuteAction=function(actionPayload){var context=actionPayload.controlContext,getKbArticlesSearchParameters=actionPayload.searchParam,searchProvider=actionPayload.searchProvider,fetchApiWrapper=actionPayload.fetchApiWrapper,relevanceSearchRequestType=KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_GETKBARTICLESSEARCH,deferred=$.Deferred();this.buildAndExecutegetKbArticlesFromIDsSearch(context,relevanceSearchRequestType,getKbArticlesSearchParameters,searchProvider,fetchApiWrapper).then(function(matchedRecords){if(!matchedRecords||!matchedRecords.value)KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.ServerSearchFailure,"");else{var matchedkbRecords=this.buildGetKbArticlesResponse(getKbArticlesSearchParameters,matchedRecords);this.getKBArticleSearchSuccess(context,matchedkbRecords,searchProvider)}deferred.resolve(matchedRecords)}.bind(this),function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.ServerSearchFailure,errorMessage);deferred.reject(error)});return deferred.promise()};GetArticlesFromIdsSearchAction.prototype.getKBArticleSearchSuccess=function(context,matchedkbRecords,searchProvider){searchProvider.SearchResult.MatchedkbSearchRecords=matchedkbRecords;KbSearchControl.MapRelevanceSearchResultsDataUtility.Instance.UpdateAnnotationWithMatchedKbRecords(context,searchProvider)};GetArticlesFromIdsSearchAction.prototype.buildGetKbArticlesResponse=function(getKbArticlesSearchParameters,matchedRecords){var parsedCount=0;if("@odata.count" in matchedRecords&&matchedRecords["@odata.count"])parsedCount=matchedRecords["@odata.count"];var parsedValues=[];matchedRecords.value.forEach(function(val){var dataKeys=Object.keys(val).filter(function(key){return key.indexOf("@")!=0}),dataValues={};dataKeys.forEach(function(dKey){dataValues[dKey]=val[dKey]});parsedValues.push({score:val["@search.score"],entityName:val["@search.entityname"],objectId:val["@search.objectid"],objectTypeCode:val["@search.objecttypecode"],highlights:Object.freeze(Object.assign({},val["@search.highlights"])),relevanceData:dataValues})});return {errors:matchedRecords.errors,warnings:matchedRecords.warnings,facets:matchedRecords.facets,value:parsedValues,totalCount:parsedCount}};GetArticlesFromIdsSearchAction.prototype.buildkbArticledfromIDsSearch=function(relevanceSearchRequestType,getKbArticlesSearchParameters){var kbArticlesFromIDListSearchRequest=KbSearchControl.RelevanceSearchRequestFactory.Instance.GetRequestObject(relevanceSearchRequestType,getKbArticlesSearchParameters);return {method:MscrmControls.KbCommonUtils.GET_METHOD,endpoint:kbArticlesFromIDListSearchRequest.GenerateURL(),urlParameters:kbArticlesFromIDListSearchRequest.GenerateQueryString()}};GetArticlesFromIdsSearchAction.prototype.buildAndExecutegetKbArticlesFromIDsSearch=function(context,relevanceSearchRequestType,getKbArticlesSearchParameters,searchProvider,fetchApiWrapper){var getkbarticlesfromIDsRequest=this.buildkbArticledfromIDsSearch(relevanceSearchRequestType,getKbArticlesSearchParameters);getkbarticlesfromIDsRequest.urlParameters=getkbarticlesfromIDsRequest.urlParameters.replace(/\t|\r|\n/g,"");var odataUri=getkbarticlesfromIDsRequest.endpoint+getkbarticlesfromIDsRequest.urlParameters;return fetchApiWrapper.Fetch(context,getkbarticlesfromIDsRequest.method,odataUri,"",MscrmControls.KbCommonUtils.SearchProviderType.CrossDynamicsOrg==searchProvider.SearchProviderType,searchProvider.ResourceUri,MscrmControls.KbCommonUtils.Constants.CrossDynamicsOrgApiCall)};GetArticlesFromIdsSearchAction.IsRegistered=KbSearchControl.SearchActionFactory.Register(KbSearchControl.SearchActionType.GetArticlesFromIds,function(){return new GetArticlesFromIdsSearchAction});return GetArticlesFromIdsSearchAction}();KbSearchControl.GetArticlesFromIdsSearchAction=GetArticlesFromIdsSearchAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ExecuteRelevanceSearchAction=function(){function ExecuteRelevanceSearchAction(){}ExecuteRelevanceSearchAction.prototype.ExecuteAction=function(actionPayload){var context=actionPayload.controlContext,relevanceSearchParameters=actionPayload.searchParam,fetchApiWrapper=actionPayload.fetchApiWrapper,searchProvider=actionPayload.searchProvider,additionalTelemetryEventParameters=[{name:"searchProvider",value:searchProvider.Name}],watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameRelevanceSearchActions,"ExecuteRelevanceSearchAction",additionalTelemetryEventParameters),relevanceSearchRequestType=KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_INDEXEDSEARCH,deferred=$.Deferred();this.buildAndExecuteRelevanceSearch(context,relevanceSearchRequestType,relevanceSearchParameters,searchProvider,fetchApiWrapper).then(function(relevanceSearchResults){watermarkTelemetryEvent.End();context.parameters.value.executeNotifyHandlersThatEventOccurred(relevanceSearchParameters.notifyHandlersThatEventOccurredParameter);if(!relevanceSearchResults||!relevanceSearchResults.value){KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.ServerSearchFailure,"");deferred.resolve(relevanceSearchResults);return}var relevanceSearchResponse=this.buildRelevanceSearchResponse(relevanceSearchParameters,relevanceSearchResults,context);if(relevanceSearchResponse.errors.length>0){var concatenatedErrorMessage=relevanceSearchResponse.errors.join("\\n");KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.ServerSearchFailure,concatenatedErrorMessage);deferred.resolve(relevanceSearchResults)}else{relevanceSearchResponse.warnings.length>0&&deferred.resolve(relevanceSearchResults);if(relevanceSearchResponse.value.length>0)this.relevanceSearchSuccess(context,relevanceSearchResponse,searchProvider,fetchApiWrapper,relevanceSearchParameters).then(function(){deferred.resolve(relevanceSearchResults)},function(){deferred.resolve(relevanceSearchResults)});else{KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.NoArticlesErrorMessageResourceName,"");deferred.resolve(relevanceSearchResults)}}}.bind(this),function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||error&&error.Message||error&&error.error&&error.error.Message||"";KbSearchControl.KbSearchActionUtility.UpdateErrorStateInSearchProvider(searchProvider,KbSearchControl.Constants.ServerSearchFailure,errorMessage);watermarkTelemetryEvent.EndAndLogError({controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:"KbSearchControl.ExecuteRelevanceSearchAction"+errorMessage,eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")}]});deferred.reject(error)});return deferred.promise()};ExecuteRelevanceSearchAction.prototype.buildAndExecuteRelevanceSearch=function(context,relevanceSearchRequestType,relevanceSearchParameters,searchProvider,fetchApiWrapper){var relevanceRequest=KbSearchControl.BuildSearchRequestData.BuildSearchRequest(relevanceSearchParameters,searchProvider);return fetchApiWrapper.Fetch(context,relevanceRequest.method,relevanceRequest.odataEndPointUri+relevanceRequest.requests[0].urlParameters,"",MscrmControls.KbCommonUtils.SearchProviderType.CrossDynamicsOrg==searchProvider.SearchProviderType,searchProvider.ResourceUri,MscrmControls.KbCommonUtils.Constants.CrossDynamicsOrgApiCall)};ExecuteRelevanceSearchAction.prototype.buildRelevanceSearchResponse=function(relevanceSearchParameters,relevanceSearchResults,context){var parsedCount=0;if("@odata.count" in relevanceSearchResults&&relevanceSearchResults["@odata.count"])parsedCount=relevanceSearchResults["@odata.count"];for(var parsedFacets={},parsedValues=[],_loop_2=function(key){parsedFacets[key]=[];relevanceSearchResults.facets[key].forEach(function(facet){parsedFacets[key].push({facetType:facet.Type,facetValue:facet.Value,count:facet.Count})})},_i=0,_a=Object.keys(relevanceSearchResults.facets);_i<_a.length;_i++){var key=_a[_i];_loop_2(key)}if(relevanceSearchParameters.currentPageNumber>1){var relevanceRecords=KbSearchControl.StateManager.Instance(context.parameters.value.controlId).relevanceSearchRecords;parsedValues=relevanceRecords.value}relevanceSearchResults.value.forEach(function(val){var dataKeys=Object.keys(val).filter(function(key){return key.indexOf("@")!=0}),dataValues={};dataKeys.forEach(function(dKey){dataValues[dKey]=val[dKey]});parsedValues.push({score:val["@search.score"],entityName:val["@search.entityname"],objectId:val["@search.objectid"],objectTypeCode:val["@search.objecttypecode"],highlights:Object.freeze(Object.assign({},val["@search.highlights"])),relevanceData:dataValues})});return {errors:relevanceSearchResults.errors,warnings:relevanceSearchResults.warnings,facets:parsedFacets,value:parsedValues,totalCount:parsedCount}};ExecuteRelevanceSearchAction.prototype.relevanceSearchSuccess=function(context,relevanceSearchResults,searchProvider,fetchApiWrapper,relevanceSearchParameters){KbSearchControl.KbSearchActionUtility.UpdateSuccessStateInSearchProvider(searchProvider,null,null,relevanceSearchResults);return KbSearchControl.MapRelevanceSearchResultsDataUtility.Instance.MapRelevanceSearchResultData(context,searchProvider,fetchApiWrapper,relevanceSearchParameters)};ExecuteRelevanceSearchAction.IsRegistered=KbSearchControl.SearchActionFactory.Register(KbSearchControl.SearchActionType.ExecuteRelevanceSearch,function(){return new ExecuteRelevanceSearchAction});return ExecuteRelevanceSearchAction}();KbSearchControl.ExecuteRelevanceSearchAction=ExecuteRelevanceSearchAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteFullTextSearch=function(){function ExecuteFullTextSearch(){}ExecuteFullTextSearch.prototype.executeSearch=function(kbSearchParameter,context,searchProvider,fetchApiWrapper){var deferred=$.Deferred();if(!KbSearchControl.KbSearchActionUtility.ValidateSearchActions(kbSearchParameter,context,searchProvider)){deferred.resolve();return deferred.promise()}var additionalTelemetryEventParameters=[{name:"searchProvider",value:searchProvider.Name}],watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameFullTextSearchActions,"ExecuteFullTextSearch",additionalTelemetryEventParameters),actionPayload={searchParam:kbSearchParameter,controlContext:context,searchProvider:searchProvider,fetchApiWrapper:fetchApiWrapper};KbSearchControl.SearchActionFactory.Instance.ExecuteAction(KbSearchControl.SearchActionType.ExecuteFullTextSearch,actionPayload).then(function(){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.FullTextSearchCompleted]);context.parameters.value.executeUpdateSearchResults(context.parameters.value.contextToken,searchProvider.SearchResult.Records);deferred.resolve();watermarkTelemetryEvent.End()},function(){deferred.resolve();watermarkTelemetryEvent.End()});return deferred.promise()};ExecuteFullTextSearch.isRegistered=KbSearchControl.ExecuteSearchFactory.Register(KbSearchControl.SearchType.FullTextSearch,function(){return new ExecuteFullTextSearch});return ExecuteFullTextSearch}();KbSearchControl.ExecuteFullTextSearch=ExecuteFullTextSearch})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MDFSearchEvent=function(){function MDFSearchEvent(context,searchParameter){this.eventName=KbSearchControl.Constants.MDFSearchEventName;this.eventParameters=[];this.eventParameters.push({name:"canDisableMDF",value:context.parameters.value.descriptors.allowDisablingMDFOnUI});this.eventParameters.push({name:"hasDisabledMDF",value:searchParameter.isMdfDisabled})}return MDFSearchEvent}(),ExecuteRelevanceSearch=function(){function ExecuteRelevanceSearch(){}ExecuteRelevanceSearch.prototype.executeSearch=function(kbSearchParameter,context,searchProvider,fetchApiWrapper){var deferred=$.Deferred();if(!KbSearchControl.KbSearchActionUtility.ValidateSearchActions(kbSearchParameter,context,searchProvider)){deferred.resolve();return deferred.promise()}var performSearch=ExecuteRelevanceSearch.shouldPerformRelevanceSearch(KbSearchControl.StateManager.Instance(context.parameters.value.controlId));if(!performSearch){context.utils.requestRender();return}var additionalTelemetryEventParameters=[{name:"searchProvider",value:searchProvider.Name}],watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbSearchControl.Constants.WebresourceNameRelevanceSearchActions,"ExecuteRelevanceSearch",additionalTelemetryEventParameters),actionPayload={searchParam:kbSearchParameter,controlContext:context,searchProvider:searchProvider,fetchApiWrapper:fetchApiWrapper};KbSearchControl.SearchActionFactory.Instance.ExecuteAction(KbSearchControl.SearchActionType.ExecuteRelevanceSearch,actionPayload).then(function(){if(!searchProvider.canCallRelevanceSearch)searchProvider.SearchResult.TotalCount=searchProvider.SearchResult.KbRelevanceSearchRecordCollection.length;var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.RelevanceSearchCompleted]);context.parameters.value.executeUpdateSearchResults(context.parameters.value.contextToken,searchProvider.SearchResult.KbRelevanceSearchRecordCollection);watermarkTelemetryEvent.End();deferred.resolve()},function(){deferred.resolve();watermarkTelemetryEvent.End()});if(context.parameters.value.descriptors.enableMDF&&context.utils.isFeatureEnabled(KbSearchControl.Constants.MetadataDrivenFilterForKbSearch)){var mdfEvent=new MDFSearchEvent(context,kbSearchParameter);mdfEvent.eventName!=""&&mdfEvent.eventParameters!=null&&context.reporting.reportEvent(mdfEvent)}return deferred.promise()};ExecuteRelevanceSearch.shouldPerformRelevanceSearch=function(stateManager){if(stateManager.ExecuteKbSearchHelper.mode===2)return true;var kbRelevanceSearchRecordCollection=stateManager.kbRelevanceSearchRecordCollection;if(!kbRelevanceSearchRecordCollection)return true;var currentPageNumber=stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider().SearchParameters.CurrentPageNumber,numOfResults=stateManager.ExecuteKbSearchHelper.numberOfResults;if(currentPageNumber*numOfResults>kbRelevanceSearchRecordCollection.length&&stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider().canCallRelevanceSearch)return true;return false};ExecuteRelevanceSearch.isRegistered=KbSearchControl.ExecuteSearchFactory.Register(KbSearchControl.SearchType.RelevanceSearch,function(){return new ExecuteRelevanceSearch});return ExecuteRelevanceSearch}();KbSearchControl.ExecuteRelevanceSearch=ExecuteRelevanceSearch})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchHelperState=function(){function SearchHelperState(){}return SearchHelperState}();KbSearchControl.SearchHelperState=SearchHelperState})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchState=function(){function SearchState(){}return SearchState}();KbSearchControl.SearchState=SearchState})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultAction=function(){function SearchResultAction(){}SearchResultAction.prototype.init=function(context,fetchApiWrapper){this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this._context=context;this.fetchApiWrapper=fetchApiWrapper};SearchResultAction.prototype.getOutputs=function(){return null};SearchResultAction.prototype.destroy=function(){};SearchResultAction.prototype.onPreNavigation=function(){};SearchResultAction.prototype.handleSearchResultActionsDropdownInlineActionKeyDown=function(event,firstAction,kbSearchRecord){if(event.key===KbSearchControl.Constants.EnterKeyValue){event.stopPropagation();event.preventDefault();this.handleArticleActionClick(event,firstAction,kbSearchRecord)}};SearchResultAction.prototype.handleFlyoutOptionKeyDown=function(event,actionIndex,articleActionId,kbSearchRecord,articleActions){var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleFlyoutOptionKeyDown");if(event.keyCode!==KbSearchControl.Constants.DownArrowKeyCode&&event.keyCode!==KbSearchControl.Constants.SpaceKeyCode&&event.keyCode!==KbSearchControl.Constants.UpArrowKeyCode&&event.keyCode!==KbSearchControl.Constants.EscapeKeyCode&&event.keyCode!==KbSearchControl.Constants.EnterKeyCode){watermarkTelemetryEvent.End();return}if(event.keyCode===KbSearchControl.Constants.EnterKeyCode||event.keyCode===KbSearchControl.Constants.SpaceKeyCode){this.handleArticleActionClick.bind(this);this.handleArticleActionClick(event,articleActionId,kbSearchRecord);watermarkTelemetryEvent.End();return}var newActionIndex=event.keyCode===KbSearchControl.Constants.UpArrowKeyCode?actionIndex-1:actionIndex+1;if(event.keyCode===KbSearchControl.Constants.EscapeKeyCode){var kbSearchResult=this._stateManager.GetKbSearchResult(kbSearchRecord);this.toggleMenu(kbSearchResult);this._context.accessibility.focusElementById("microsoftIcon_menuFlyoutButton_"+kbSearchRecord.knowledgeArticleId);watermarkTelemetryEvent.End();return}else if(newActionIndex>=articleActions.length){watermarkTelemetryEvent.End();return}else{var uniqueActionId="flyout_"+this.getUniqueActionId(kbSearchRecord.knowledgeArticleId,newActionIndex);if(document.getElementById(this._context.accessibility.getUniqueId(uniqueActionId))){this._context.accessibility.focusElementById(uniqueActionId);event.stopPropagation();event.preventDefault()}watermarkTelemetryEvent.End()}};SearchResultAction.prototype.handleMenuFlyoutButtonPress=function(event,kbSearchResult,actionPos){var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleMenuFlyoutButtonPress");if(event.keyCode===KbSearchControl.Constants.TabKeyCode)this.tryToggleCloseMenu(kbSearchResult);else if(event.key===KbSearchControl.Constants.EnterKeyValue||event.keyCode===KbSearchControl.Constants.SpaceKeyCode){this.toggleMenu(kbSearchResult);event.stopPropagation();event.preventDefault()}else if(event.keyCode===KbSearchControl.Constants.TabKeyCode){for(var articleTitleID=this._context.accessibility.getUniqueId("articleTitle"),articleIndex=$("[id="+articleTitleID+"]"),selectedRecordTitle=this._stateManager.GetSelectedArticle().title,i=0;i<articleIndex.length;i++)if(articleIndex[i].attributes["title"].nodeValue==selectedRecordTitle)i!=articleIndex.length-1&&this._stateManager.SetSelectedArticle(this._stateManager.records[i+1],this._context)}else if(event.keyCode===KbSearchControl.Constants.DownArrowKeyCode){var uniqueActionId="flyout_"+this.getUniqueActionId(kbSearchResult.kbSearchRecord.knowledgeArticleId,actionPos);this._context.accessibility.focusElementById(uniqueActionId);event.stopPropagation();event.preventDefault()}watermarkTelemetryEvent.End()};SearchResultAction.prototype.handleArticleActionClick=function(event,articleActionId,kbSearchRecord){var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleArticleActionClick");event.stopPropagation();event.preventDefault();var selectedArticleActionId=articleActionId,selectedKnowledgeArticleId=kbSearchRecord.knowledgeArticleId;if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.LinkArticle)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Link_KbArticle,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Link_KbArticle});else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.UnlinkArticle)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Unlink_KbArticle,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Unlink_KbArticle});else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.EmailArticleContent)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Email_Article_Content,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Email_Article_Content});else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.EmailArticle)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Email_Article_URL,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Email_Article_URL});else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.PopoutArticle)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Popout_KbArticle,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Popout_KbArticle});else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.CopyLink)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Copy_Link,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Copy_Link});else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.SendToCTI)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Send_Link_ToCTI,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Send_Link_ToCTI});else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.SelectContent)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Select_Content,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Select_Content});else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.SelectUrl)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Select_Url,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Select_Url});else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.UnselectContent)MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Unselect_Content,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Unselect_Content});else selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.UnselectUrl&&MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Unselect_Url,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.ArticleActions,subFeatureName:MscrmControls.KbCommonUtils.TelemetryActionName.Unselect_Url});if(selectedArticleActionId<0||!selectedKnowledgeArticleId){watermarkTelemetryEvent.End();return}if(!MscrmControls.KbCommonUtils.ArticleAction[selectedArticleActionId]){watermarkTelemetryEvent.End();return}if(selectedArticleActionId==MscrmControls.KbCommonUtils.ArticleAction.PopoutArticle&&this._stateManager.GetIsSearchMode()){var operationPayload_1={controlContext:this._context,record:kbSearchRecord,fetchApiWrapper:this.fetchApiWrapper,stateManager:this._stateManager,actionOperationCallback:MscrmControls.KbCommonUtils.ActionCallbackFactory.Instance.GetActionCallback(MscrmControls.KbCommonUtils.ArticleAction.IncreaseView)};!MscrmControls.KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(kbSearchRecord)&&MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(MscrmControls.KbCommonUtils.ArticleAction.IncreaseView,operationPayload_1)}var operationPayload={controlContext:this._context,record:kbSearchRecord,fetchApiWrapper:this.fetchApiWrapper,stateManager:this._stateManager,actionOperationCallback:MscrmControls.KbCommonUtils.ActionCallbackFactory.Instance.GetActionCallback(articleActionId)};MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(selectedArticleActionId,operationPayload);this.reportActionToTelemetry(selectedArticleActionId);if(this._stateManager.isKnowledgeSearchInsightsEnabled){var interactionType=MscrmControls.KbCommonUtils.CommonUtils.ConvertArticleActionToInteractionType(selectedArticleActionId);MscrmControls.KbCommonUtils.CommonUtils.CreateKnowledgeInteractionRecord(this._context,kbSearchRecord.knowledgeOperationId,interactionType,kbSearchRecord.knowledgeArticleId,kbSearchRecord.articleRank)}this.tryToggleCloseMenu(this._stateManager.GetKbSearchResult(kbSearchRecord));watermarkTelemetryEvent.End()};SearchResultAction.prototype.toggleMenu=function(kbSearchResult){kbSearchResult.isMenuVisible=!kbSearchResult.isMenuVisible;this._context.utils.requestRender()};SearchResultAction.prototype.tryToggleCloseMenu=function(kbSearchResult){kbSearchResult.isMenuVisible&&this.toggleMenu(kbSearchResult)};SearchResultAction.prototype.getUniqueActionId=function(knowledgeArticleId,actionPosition){return "actionItem_"+actionPosition+"_"+knowledgeArticleId};SearchResultAction.prototype.reportActionToTelemetry=function(id){switch(id){case MscrmControls.KbCommonUtils.ArticleAction.LinkArticle:this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.LinkButtonClicked]);break;case MscrmControls.KbCommonUtils.ArticleAction.CopyLink:this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.CopyLinkButtonClicked]);break;case MscrmControls.KbCommonUtils.ArticleAction.EmailArticleContent:this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.LinkAndEmailContentButtonClicked]);break;case MscrmControls.KbCommonUtils.ArticleAction.EmailArticle:this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.LinkAndEmailButtonClicked]);break}};return SearchResultAction}();KbSearchControl.SearchResultAction=SearchResultAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ArticleStatusFilter=function(){function ArticleStatusFilter(context){this._context=context;this._articleFilterOptions=[this._createOption(KbSearchControl.KbSearchControlLocale.AllDraftArticlesLocale,KbSearchControl.KbSearchControlLocale.AllDraftArticlesLocale,1),this._createOption(KbSearchControl.KbSearchControlLocale.AllApprovedArticlesLocale,KbSearchControl.KbSearchControlLocale.AllApprovedArticlesLocale,2),this._createOption(KbSearchControl.KbSearchControlLocale.AllPublishedArticlesLocale,KbSearchControl.KbSearchControlLocale.AllPublishedArticlesLocale,3)];this.SelectedItemResourceName=this._getConfiguredArticleStateFilter()}ArticleStatusFilter.prototype._createOption=function(label,text,value){return {text:text,Label:label,Value:value}};Object.defineProperty(ArticleStatusFilter.prototype,"ArticleFilterOptions",{"get":function(){return this._articleFilterOptions},enumerable:true,configurable:true});Object.defineProperty(ArticleStatusFilter.prototype,"SelectedItemResourceName",{"get":function(){return this._selectedItemResourceName},"set":function(value){this._selectedItemResourceName=value},enumerable:true,configurable:true});ArticleStatusFilter.prototype.SelectedItemStateCode=function(){var searchLabel=this.SelectedItemResourceName["text"]||this.SelectedItemResourceName["Label"]||"";switch(searchLabel){case KbSearchControl.KbSearchControlLocale.AllDraftArticlesLocale:return KbSearchControl.Constants.ArticleState["Draft"];case KbSearchControl.KbSearchControlLocale.AllApprovedArticlesLocale:return KbSearchControl.Constants.ArticleState["Approved"];case KbSearchControl.KbSearchControlLocale.AllPublishedArticlesLocale:default:return KbSearchControl.Constants.ArticleState["Published"]}};ArticleStatusFilter.prototype._getConfiguredArticleStateFilter=function(){var stateCodeDescriptor=this._context.parameters.value.descriptors.articleStatusFilter;switch(stateCodeDescriptor){case KbSearchControl.Constants.AllDraftArticlesDescriptor:return this.ArticleFilterOptions[0];case KbSearchControl.Constants.AllApprovedArticlesDescriptor:return this.ArticleFilterOptions[1];case KbSearchControl.Constants.AllPublishedArticlesDescriptor:default:return this.ArticleFilterOptions[2]}};ArticleStatusFilter.prototype.SetSelectedArticleStatusFilterByFilterOption=function(filterOption){var needsToChange=false;switch(filterOption){case KbSearchControl.ArticleStatusFilterOption.Draft:var draftArticleStatus=this.ArticleFilterOptions.filter(function(filterOption){return filterOption.text===KbSearchControl.KbSearchControlLocale.AllDraftArticlesLocale})[0];if(this.SelectedItemResourceName&&draftArticleStatus&&this.SelectedItemResourceName.Value!=draftArticleStatus.Value){this.SelectedItemResourceName=draftArticleStatus;needsToChange=true}break;case KbSearchControl.ArticleStatusFilterOption.Approved:var approvedArticleStatus=this.ArticleFilterOptions.filter(function(filterOption){return filterOption.text===KbSearchControl.KbSearchControlLocale.AllApprovedArticlesLocale})[0];if(this.SelectedItemResourceName&&approvedArticleStatus&&this.SelectedItemResourceName.Value!=approvedArticleStatus.Value){this.SelectedItemResourceName=approvedArticleStatus;needsToChange=true}break;case KbSearchControl.ArticleStatusFilterOption.Published:default:var publishedArticleStatus=this.ArticleFilterOptions.filter(function(filterOption){return filterOption.text===KbSearchControl.KbSearchControlLocale.AllPublishedArticlesLocale})[0];if(this.SelectedItemResourceName&&publishedArticleStatus&&this.SelectedItemResourceName.Value!=publishedArticleStatus.Value){this.SelectedItemResourceName=publishedArticleStatus;needsToChange=true}break}return needsToChange};return ArticleStatusFilter}();KbSearchControl.ArticleStatusFilter=ArticleStatusFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ArticleLanguageFilter=function(){function ArticleLanguageFilter(context){this.languageFilterOptions=[];this.languageFilters=[];this._context=context}Object.defineProperty(ArticleLanguageFilter.prototype,"SelectLanguageOption",{"get":function(){return this._selectedLanguageOption||this.DefaultLanguageLocaleId},"set":function(value){this._selectedLanguageOption=value},enumerable:true,configurable:true});Object.defineProperty(ArticleLanguageFilter.prototype,"DefaultLanguageLocaleId",{"get":function(){var languageFilter=this._context.parameters.value.descriptors.languageFilter,defaultFilter=languageFilter&&languageFilter!="00000000-0000-0000-0000-000000000000"&&(this.GetLanguageOptionByLanguageLocaleId(languageFilter)||this.GetLanguageOptionByLocaleId(languageFilter));defaultFilter=defaultFilter||this.GetLanguageOptionByLocaleId(this._context.client.languageCode);defaultFilter=defaultFilter||this.languageFilterOptions.length>0&&this.languageFilterOptions[0];return defaultFilter},enumerable:true,configurable:true});ArticleLanguageFilter.prototype.GetLanguageOptionByLanguageLocaleId=function(languageLocaleId){return this.languageFilterOptions.filter(function(languageOption){return languageOption.text===languageLocaleId})[0]};ArticleLanguageFilter.prototype.GetLanguageOptionByLocaleId=function(localeId){var filteredLanguage,languageCode=parseInt(localeId,10);if(!isNaN(languageCode))filteredLanguage=this.languageFilters.filter(function(language){return language.LocaleId===languageCode})[0];return filteredLanguage&&this.GetLanguageOptionByLanguageLocaleId(filteredLanguage.LanguageLocaleId)};ArticleLanguageFilter.prototype._createOption=function(label,text,value){return {text:text,Label:label,Value:value}};ArticleLanguageFilter.prototype.SetLanguageFilters=function(activeLanguages){if(activeLanguages&&activeLanguages.length>0)this.languageFilters=activeLanguages;this.CreateAndSetLanguageOptionsList()};ArticleLanguageFilter.prototype.CreateAndSetLanguageOptionsList=function(){var _this=this;this.languageFilterOptions.splice(0);this.languageFilters.forEach(function(language,index){_this.languageFilterOptions.push(_this._createOption(language.Name,language.LanguageLocaleId,index+1))})};ArticleLanguageFilter.prototype.SetSelectedArticleLanguageFilterByFilterOption=function(languageFilterOption){var needsToChange=false,filterArticleLanguage=this.languageFilters.filter(function(filterOption){return filterOption.LocaleId.toString()===languageFilterOption.toString()})[0],currentLanguageFilterOption=filterArticleLanguage&&this.languageFilterOptions.filter(function(filterOption){return filterOption.text==filterArticleLanguage.LanguageLocaleId})[0];if(this.SelectLanguageOption&&currentLanguageFilterOption&&this.SelectLanguageOption.Value!=currentLanguageFilterOption.Value){this.SelectLanguageOption=currentLanguageFilterOption;needsToChange=true}return needsToChange};return ArticleLanguageFilter}();KbSearchControl.ArticleLanguageFilter=ArticleLanguageFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteKbSearchHelper=function(){function ExecuteKbSearchHelper(context,fetchApiWrapper){this._searchHasBeenPerformed=false;this.searchProviders=[];this.isFederatedSearchEnabled=false;this._context=context;this.fetchApiWrapper=fetchApiWrapper;this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this.previouslyProcessedKeyPhrasesString="";this.previouslyProcessedAutoSuggestionFormFieldString="";this.mode=context.utils.isFeatureEnabled(KbSearchControl.Constants.KMSimpleRelevanceSearch)?2:1;this.additionalKnowledgeArticleFilters={};this.enableMetadataFiltering=false;this.visibility=null;this.dateRange=null;this.useInflection=true;this.removeDuplicates=true;this.setIsFederatedSearchEnabled(context.utils.isFeatureEnabled(MscrmControls.KbCommonUtils.FCBUtil.KMFederatedSearch)&&MscrmControls.KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()&&MscrmControls.KbCommonUtils.OrganizationSettings.IsSupportedCloudType)}Object.defineProperty(ExecuteKbSearchHelper.prototype,"SearchHasBeenPerformed",{"get":function(){return this._searchHasBeenPerformed},"set":function(value){this._searchHasBeenPerformed=value},enumerable:true,configurable:true});ExecuteKbSearchHelper.prototype.setSearchProviders=function(searchProviders){this.searchProviders=searchProviders};ExecuteKbSearchHelper.prototype.getSearchProviders=function(){return this.searchProviders};ExecuteKbSearchHelper.prototype.setCurrentOrgSearchProvider=function(searchProvider){this.currentOrgSearchProvider=searchProvider};ExecuteKbSearchHelper.prototype.getCurrentOrgSearchProvider=function(){return this.currentOrgSearchProvider};ExecuteKbSearchHelper.prototype.getDefaultSearchProvider=function(){for(var defaultSearchProvider,_i=0,_a=this.searchProviders;_i<_a.length;_i++){var searchProvider=_a[_i];if(searchProvider.IsDefault){defaultSearchProvider=searchProvider;break}}return !defaultSearchProvider?this.getCurrentOrgSearchProvider():defaultSearchProvider};ExecuteKbSearchHelper.prototype.setSelectedSearchProvider=function(selectedSearchProvider){var prevSelectedSearchProvider=this.selectedSearchProvider;this.selectedSearchProvider=selectedSearchProvider;this._stateManager.SetSelectedSearchProviderSettings();MscrmControls.KbCommonUtils.TelemetryReporter.LogInfo(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Federation_Search_Provider_Change,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,eventParams:[{name:"PreviousSearchProvider",value:prevSelectedSearchProvider?prevSelectedSearchProvider.Name:""},{name:"PreviousSearchProviderResultCount",value:prevSelectedSearchProvider?prevSelectedSearchProvider.SearchResult.TotalCount:"-"},{name:"CurrentSearchProvider",value:this.selectedSearchProvider.Name},{name:"CurrentSearchProviderResultCount",value:!this.selectedSearchProvider.IsLoading?this.selectedSearchProvider.SearchResult.TotalCount:"-"},{name:"SetDefaultSearchProviderEvent",value:prevSelectedSearchProvider?false:true},{name:"SearchProviderChangeEvent",value:prevSelectedSearchProvider?true:false},{name:"HasError",value:this.selectedSearchProvider.SearchError!=null?true:false},{name:"ErrorDetails",value:this.selectedSearchProvider.SearchError!=null?this.selectedSearchProvider.SearchError.ErrorDetails:""},{name:"IsSelectedSearchLoadingResults",value:this.selectedSearchProvider.IsLoading}]})};ExecuteKbSearchHelper.prototype.getSelectedSearchProvider=function(){return this.selectedSearchProvider};ExecuteKbSearchHelper.prototype.getIsFederatedSearchEnabled=function(){return this.isFederatedSearchEnabled};ExecuteKbSearchHelper.prototype.setIsFederatedSearchEnabled=function(isFederatedSearchEnabled){this.isFederatedSearchEnabled=isFederatedSearchEnabled};Object.defineProperty(ExecuteKbSearchHelper.prototype,"SearchType",{"get":function(){return this.getSelectedSearchProvider().SearchType},enumerable:true,configurable:true});ExecuteKbSearchHelper.prototype.HandleCurrentSearchTextChanged=function(context){if(context.parameters.value.currentSearchText&&context.parameters.value.currentSearchText!=this.searchText){this.searchText=context.parameters.value.currentSearchText;context.parameters.value.currentSearchText=null;this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this.ExecuteKbSearch()}};ExecuteKbSearchHelper.prototype.ParseKeyPhrasesString=function(keyPhrasesString){var valueIndex=keyPhrasesString.indexOf(ExecuteKbSearchHelper._valueString);if(valueIndex<0)return "";return keyPhrasesString.substring(valueIndex+8,keyPhrasesString.length-2)};ExecuteKbSearchHelper.prototype.SetCurrentStateSearchParameters=function(){this.stateCode=this._stateManager.selectedStateCode?this._stateManager.selectedStateCode:this._stateManager.ArticleStatusFilter.SelectedItemStateCode();this.dateRange=this._stateManager.selectedDateRange?this._stateManager.selectedDateRange:null;this.visibility=this._stateManager.selectedVisibility?this._stateManager.selectedVisibility:null;this.sortBy=this._stateManager.SortFilter.SelectedSortFilterByAttributeName();this.languageLocaleId=this._stateManager.selectedLanguage?this._stateManager.selectedLanguage:this._stateManager.ArticleLanguageFilter.SelectLanguageOption.text;this.locale=this._context.client.locale;this.isDescending=this._stateManager.SortFilter.IsDescending;this.showRatingUsing=this._context.parameters.value.descriptors.enableRating?this._context.parameters.value.descriptors.showRatingUsing:"";this.numberOfResults=this._context.parameters.value.descriptors.numberOfResults;this.notifyHandlersThatEventOccurredParameter={eventName:KbSearchControl.Constants.ON_POST_SEARCH,fieldName:this._context.parameters.value.controlId,pageId:this._context.parameters.value.pageId,contextToken:this._context.parameters.value.contextToken};this.currentPageNumber=1;this.searchParametersResetted=true;this.numberTimeExternalRelevanceSearchCall=1};ExecuteKbSearchHelper.prototype.ExecuteKbSearch=function(loadMore){if(loadMore===void 0)loadMore=false;var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameExecuteKbSearchHelper,"ExecuteKbSearch");if(!KbSearchControl.KbSearchActionUtility.CheckSearchConditions(this._context)){watermarkTelemetryEvent.End();return}if(!this.searchText||""==this.searchText.trim()){watermarkTelemetryEvent.End();KbSearchControl.KbSearchActionUtility.UpdateErrorStateInContext(this._context,KbSearchControl.Constants.NoSearchErrorMessageResourceName,false,"",{totalCount:0});this._context.utils.requestRender();return}if(!this._context.utils.isFeatureEnabled(KbSearchControl.Constants.KMSimpleRelevanceSearch))this.mode=this.sortBy===KbSearchControl.Constants.SORT_BY_NUMBER_OF_VIEWS?2:1;if(loadMore){this.getSelectedSearchProvider().SearchParameters.CurrentPageNumber+=1;this.searchParametersResetted=false;if(this.getSelectedSearchProvider().SearchType===KbSearchControl.SearchType.RelevanceSearch&&this.mode===1){var performRelevanceSearch=KbSearchControl.ExecuteRelevanceSearch.shouldPerformRelevanceSearch(this._stateManager);if(performRelevanceSearch)this.getSelectedSearchProvider().SearchParameters.numberTimeExternalRelevanceSearchCall+=1}}else{this.SetCurrentStateSearchParameters();for(var _i=0,_a=this.getSearchProviders();_i<_a.length;_i++){var searchProvider=_a[_i];searchProvider.canCallRelevanceSearch=true}this._stateManager.kbRelevanceSearchRecordCollection=[]}if(this.getSelectedSearchProvider().SearchParameters.CurrentPageNumber===1){KbSearchControl.KbSearchActionUtility.UpdateLoadingStateInContext(this._context);this._context.utils.requestRender()}this._stateManager.associatedArticles=[];var retrieveFederatedSearchAssociatedArticlesPromise,retrieveAssociatedArticlesPromise,isHostedInEntityContext=MscrmControls.KbCommonUtils.CommonUtils.IsHostedInEntityContext(this._context);if(isHostedInEntityContext){var actionPayload={controlContext:this._context,fetchApiWrapper:this.fetchApiWrapper};retrieveAssociatedArticlesPromise=KbSearchControl.SearchActionFactory.Instance.ExecuteAction(KbSearchControl.SearchActionType.GetAssociatedArticles,actionPayload);if(this.getIsFederatedSearchEnabled())retrieveFederatedSearchAssociatedArticlesPromise=KbSearchControl.SearchActionFactory.Instance.ExecuteAction(KbSearchControl.SearchActionType.GetAssociatedFederatedArticles,actionPayload)}this._stateManager.shouldShowSelected=false;this.correlationId=MscrmControls.KbCommonUtils.CommonUtils.GenerateUUID();var selectedSearchProvider=this.getSelectedSearchProvider(),executionPromise=this.HandleSearch(selectedSearchProvider,retrieveAssociatedArticlesPromise,retrieveFederatedSearchAssociatedArticlesPromise);if(!loadMore)for(var _b=0,_c=this.getSearchProviders();_b<_c.length;_b++){var searchProvider=_c[_b];searchProvider.SearchProviderId!=selectedSearchProvider.SearchProviderId&&!searchProvider.Settings.HasError&&this.HandleSearch(searchProvider,retrieveAssociatedArticlesPromise,retrieveFederatedSearchAssociatedArticlesPromise)}this._context.parameters.value.descriptors.showLanguageFilter=="true"&&this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.LanguageFilterUsed]);this._context.parameters.value.descriptors.showArticleStatusFilter=="true"&&this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.ArticleStateFilterUsed]);if(executionPromise)this.SearchHasBeenPerformed=true;this._stateManager.IsActionPerformedOnFirstResult=false;watermarkTelemetryEvent.End()};ExecuteKbSearchHelper.prototype.HandleSearch=function(searchProvider,retrieveAssociatedArticlesPromise,retrieveFederatedSearchAssociatedArticlesPromise){var _this=this,additionalTelemetryEventParameters=[{name:"searchProvider",value:searchProvider.Name}],watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"HandleSearch",additionalTelemetryEventParameters),startTime=new Date;searchProvider.IsLoading=true;var executionPromise=null;if(searchProvider.Settings.HasError){executionPromise=$.Deferred();executionPromise.resolve()}else executionPromise=KbSearchControl.ExecuteSearchFactory.ExecuteSearch(searchProvider.SearchType,this._context,this,searchProvider,this.fetchApiWrapper);Promise.all([MscrmControls.KbCommonUtils.SearchProviderType.InternalDynamicsOrg==searchProvider.SearchProviderType?retrieveAssociatedArticlesPromise:retrieveFederatedSearchAssociatedArticlesPromise,executionPromise]).then(function(){watermarkTelemetryEvent.End();var endTime=new Date;_this.GenerateKnowledgeSearchInsightRecord(searchProvider,endTime.getTime()-startTime.getTime());if(searchProvider.SearchProviderId==_this.getSelectedSearchProvider().SearchProviderId&&_this._stateManager.isKnowledgeSearchInsightsEnabled){_this.SendKnowledgeSearchInsightRecord(searchProvider);searchProvider.SearchResult.IsKnowledgeSearchInsightRecordCreated=true}searchProvider.SearchResult.TotalCount>0&&_this.PerformAssociation(searchProvider);searchProvider.IsLoading=false;searchProvider.SearchProviderId==_this.selectedSearchProvider.SearchProviderId&&KbSearchControl.KbSearchActionUtility.UpdateSearchProviderStateInContext(_this._context,searchProvider);_this._context.utils.requestRender()});return executionPromise};ExecuteKbSearchHelper.prototype.PerformAssociation=function(searchProvider){var associatedArticles=KbSearchControl.StateManager.Instance(this._context.parameters.value.controlId).associatedArticles,records=searchProvider.Settings.IsRelevanceSearchEnabled?searchProvider.SearchResult.KbRelevanceSearchRecordCollection:searchProvider.SearchResult.Records;if(records&&associatedArticles)for(var n=records.length,i=0;i<n;i++)if(records[i]!=null)if(MscrmControls.KbCommonUtils.SearchProviderType.InternalDynamicsOrg!=searchProvider.SearchProviderType){var assocArticles=this.CheckAssociation(associatedArticles,records[i].knowledgeArticleId);if(assocArticles.length>0){records[i].isAssociated=true;records[i].federatedArticleId=assocArticles[0].federatedArticleId;records[i].federatedArticleIncidentId=assocArticles[0].federatedArticleIncidentId}}else records[i].isAssociated=KbSearchControl.KbSearchActionUtility.checkAssociation(associatedArticles,records[i].knowledgeArticleId)};ExecuteKbSearchHelper.prototype.CheckAssociation=function(linkedArticles,knowledgeArticleId){return linkedArticles.filter(function(associatedArticle){return associatedArticle.knowledgeArticleId===knowledgeArticleId})};ExecuteKbSearchHelper.prototype.ShowLoadMoreButton=function(isExternalSearchIndexEnabled){if(isExternalSearchIndexEnabled){if(this.mode===2){var relevanceSearchRecords=this._stateManager.relevanceSearchRecords;if(!relevanceSearchRecords||!relevanceSearchRecords.value)return false;var knowledgeArticleEntityNameFacet=relevanceSearchRecords.facets[KbSearchControl.Constants.SearchEntityNameFacet].filter(function(facet){return facet.facetValue===KbSearchControl.Constants.knowledgearticleEntityType});if(knowledgeArticleEntityNameFacet&&knowledgeArticleEntityNameFacet.length>0){var knowledgeArticleEntityCount=knowledgeArticleEntityNameFacet[0].count;return relevanceSearchRecords.value.length<knowledgeArticleEntityCount||this._context.client.disableScroll&&relevanceSearchRecords.value.length>this._context.parameters.value.descriptors.numberOfResults}}else if(this.mode===1){var kbRelevanceSearchRecordCollection=this._stateManager.kbRelevanceSearchRecordCollection;if(!kbRelevanceSearchRecordCollection)return false;var currentPageNumber=this._stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider().SearchParameters.CurrentPageNumber,numOfResults=this._stateManager.ExecuteKbSearchHelper.numberOfResults;if(currentPageNumber*numOfResults<kbRelevanceSearchRecordCollection.length||this._stateManager.ExecuteKbSearchHelper.getSelectedSearchProvider().canCallRelevanceSearch)return true}return false}if(!this._stateManager.recordIds||!this._stateManager.recordIds.length||!this._stateManager.totalCount)return false;if(this._stateManager.recordIds.length<this._stateManager.totalCount||this._context.client.disableScroll&&this._stateManager.recordIds.length>this._context.parameters.value.descriptors.numberOfResults)return true;return false};ExecuteKbSearchHelper.prototype.UpdateAutoSuggestionsFormField=function(){if(this._context.parameters.value.descriptors.isAutoSuggestionsEnabled==="true")if(this._context.parameters.AutoSuggestionField&&this._context.parameters.AutoSuggestionField.formatted&&this.previouslyProcessedAutoSuggestionFormFieldString!==this._context.parameters.AutoSuggestionField.formatted){MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.KbSearch_Performed,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.KbSearch,subFeatureName:MscrmControls.KbCommonUtils.TelemetrySubFeatureName.AutoSearch});this.previouslyProcessedAutoSuggestionFormFieldString=this._context.parameters.AutoSuggestionField.formatted;var currentSearchText=this._context.parameters.AutoSuggestionField.formatted;if(this.searchText!=currentSearchText){this.searchText=currentSearchText;this.currentPageNumber=1;this.ExecuteKbSearch();this._context.parameters.value.executeUpdateCurrentSearchText(this._context.parameters.value.contextToken,this.searchText)}}};ExecuteKbSearchHelper.prototype.GetLiveAdditionalFilters=function(){for(var liveFilters={},_i=0,_a=Object.keys(this.additionalKnowledgeArticleFilters);_i<_a.length;_i++){var kmAttr=_a[_i],liveValue=this.GetLiveFilter(this.additionalKnowledgeArticleFilters[kmAttr]);if(liveValue)liveFilters[kmAttr]=liveValue}return liveFilters};ExecuteKbSearchHelper.prototype.GetLiveFilter=function(srcAttr){var formAttribute=Xrm.Page.getAttribute(srcAttr);if(formAttribute&&formAttribute.getValue()&&formAttribute.getValue().length>0){var valueString=formAttribute.getValue()[0].id,valueGuid=Guid.tryParse(valueString);if(!Guid.equals(valueGuid,Guid.EMPTY))return valueGuid.toString()}return null};ExecuteKbSearchHelper.prototype.saveSearchHelperState=function(){var searchHelperState=new KbSearchControl.SearchHelperState;searchHelperState.searchText=this.searchText;searchHelperState.searchHasBeenPerformed=this.SearchHasBeenPerformed;searchHelperState.currentPage=this.currentPageNumber;searchHelperState.numberTimeExternalRelevanceSearchCall=this.numberTimeExternalRelevanceSearchCall;searchHelperState.isFederatedSearchEnabled=this.getIsFederatedSearchEnabled();searchHelperState.selectedSearchProvider=this.getSelectedSearchProvider();searchHelperState.searchProviders=this.getSearchProviders();searchHelperState.currentOrgSearchProvider=this.getCurrentOrgSearchProvider();return searchHelperState};ExecuteKbSearchHelper.prototype.restoreSearchHelperState=function(searchHelperState){this.searchText=searchHelperState.searchText;this.SearchHasBeenPerformed=searchHelperState.searchHasBeenPerformed;this.setIsFederatedSearchEnabled(searchHelperState.isFederatedSearchEnabled);this.setSearchProviders(searchHelperState.searchProviders);this.setSelectedSearchProvider(searchHelperState.selectedSearchProvider);this.setCurrentOrgSearchProvider(searchHelperState.currentOrgSearchProvider);if(this.SearchHasBeenPerformed){this.SetCurrentStateSearchParameters();KbSearchControl.KbSearchActionUtility.UpdateSearchProviderStateInContext(this._context,this.selectedSearchProvider)}this.currentPageNumber=searchHelperState.currentPage;this.numberTimeExternalRelevanceSearchCall=searchHelperState.numberTimeExternalRelevanceSearchCall};ExecuteKbSearchHelper.prototype.GenerateKnowledgeSearchInsightRecord=function(searchProvider,responseTime){searchProvider.SearchResult.IsKnowledgeSearchInsightRecordCreated=false;var filters={Status:this.stateCode,Visibility:this.visibility,ModifiedDate:this.dateRange?KbSearchControl.DateFilterOptions[this.dateRange]:null,Language:this.languageLocaleId};searchProvider.SearchResult.KnowledgeSearchInsightRecord={CorrelationId:this.correlationId,SearchTerm:MscrmControls.KbCommonUtils.CommonUtils.GetMaxString(this.searchText,256),Timestamp:new Date,ResultCount:searchProvider.SearchResult.TotalCount,ApplicationName:MscrmControls.KbCommonUtils.CommonUtils.GetMaxString(this._stateManager.applicationName,100),EntityType:MscrmControls.KbCommonUtils.CommonUtils.GetMaxString(this._context.page.entityTypeName,100),EntityRecordId:this._context.page.entityId,SearchProviderName:MscrmControls.KbCommonUtils.CommonUtils.GetMaxString(searchProvider.Name,100),SearchProviderId:searchProvider.SearchProviderId,CustomControlId:MscrmControls.KbCommonUtils.CommonUtils.GetMaxString(this._context.parameters.value.controlId,200),SortBy:KbSearchControl.SearchResultSortOption[this._stateManager.SortFilter.SelectedSortFilterBySortOption()],Filters:JSON.stringify(filters),ResponseTime:responseTime,SearchType:KbSearchControl.SearchType[searchProvider.SearchType],InitiatedBy:this._context.parameters.AutoSuggestionField&&this._context.parameters.AutoSuggestionField.formatted&&this._context.parameters.AutoSuggestionField.formatted===this.searchText?MscrmControls.KbCommonUtils.InitiatedBy.AutoSearch:MscrmControls.KbCommonUtils.InitiatedBy.ManualSearch}};ExecuteKbSearchHelper.prototype.SendKnowledgeSearchInsightRecord=function(searchProvider){var _this=this,searchRecordPayload=searchProvider.SearchResult.KnowledgeSearchInsightRecord;if(searchProvider.Settings.HasError)return;if(!searchRecordPayload.SearchTerm||searchRecordPayload.ResponseTime==-1||!searchRecordPayload.ApplicationName||searchRecordPayload.ApplicationName===MscrmControls.KbCommonUtils.Constants.UnknownApp){MscrmControls.KbCommonUtils.TelemetryReporter.LogError(this._context,{componentName:MscrmControls.KbCommonUtils.TelemetryComponentName.KMInsights_FailedCreateSearchRecord,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:"Invalid SearchTerm or ApplicationName or ResponseTime",eventParams:[{name:"ResponseTime",value:searchRecordPayload.ResponseTime},{name:"ApplicationName",value:searchRecordPayload.ApplicationName}]});return}var eventParams=[];eventParams.push({name:"SearchType",value:searchRecordPayload.SearchType});eventParams.push({name:"IsManualSearch",value:searchRecordPayload.InitiatedBy==MscrmControls.KbCommonUtils.InitiatedBy.ManualSearch});eventParams.push({name:"TotalCount",value:searchRecordPayload.ResultCount});eventParams.push({name:"SearchProviderName",value:searchRecordPayload.SearchProviderName});eventParams.push({name:"SearchProviderId",value:searchRecordPayload.SearchProviderId});var requestData={SearchRecordPayload:JSON.stringify(searchRecordPayload)},OdataUri=KbSearchControl.Constants.ODATA_PATH+"/CreateKMInsightRecord";this.fetchApiWrapper.Fetch(this._context,MscrmControls.KbCommonUtils.POST_METHOD,OdataUri,JSON.stringify(requestData)).then(function(result){if(result.RecordId!=null){var searchResults=_this._stateManager.isExternalSearchIndexEnabled?searchProvider.SearchResult.KbRelevanceSearchRecordCollection:searchProvider.SearchResult.Records;searchResults&&searchResults.map(function(item,index){item.knowledgeOperationId=result.RecordId;item.articleRank=index+1;return item});eventParams.push({name:"SearchInsightRecordId",value:result.RecordId});MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(_this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.KMInsights_Search,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,releaseWave:MscrmControls.KbCommonUtils.TelemetryReleaseWave.October2020,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.KMInsights,eventParams:eventParams})}},function(errorResponse){MscrmControls.KbCommonUtils.TelemetryReporter.LogError(_this._context,{componentName:MscrmControls.KbCommonUtils.TelemetryComponentName.KMInsights_FailedCreateSearchRecord,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:errorResponse.message,eventParams:eventParams})})};ExecuteKbSearchHelper._valueString='value:{"';return ExecuteKbSearchHelper}();KbSearchControl.ExecuteKbSearchHelper=ExecuteKbSearchHelper})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SortFilter=function(){function SortFilter(context){this._context=context;this.sortFilters=[this.CreateOption(KbSearchControl.KbSearchControlLocale.RelevanceLocale,KbSearchControl.KbSearchControlLocale.RelevanceLocale,1),this.CreateOption(KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale,KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale,2),this.CreateOption(KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,3),this.CreateOption(KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,4)];this.SelectedSortFilter=this.sortFilters[0];this._isDescending=true}SortFilter.prototype.CreateOption=function(label,text,value){return {text:text,Label:label,Value:value}};Object.defineProperty(SortFilter.prototype,"IsDescending",{"get":function(){return this._isDescending},enumerable:true,configurable:true});SortFilter.prototype.SelectedSortFilterByAttributeName=function(){switch(this.SelectedSortFilter["text"]){case KbSearchControl.KbSearchControlLocale.RelevanceLocale:return "";case KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale:this._isDescending=true;return "knowledgearticleviews";case KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale:this._isDescending=true;return "modifiedon";case KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale:this._isDescending=false;return "modifiedon";default:return ""}};SortFilter.prototype.SelectedSortFilterBySortOption=function(){switch(this.SelectedSortFilter["text"]){case KbSearchControl.KbSearchControlLocale.RelevanceLocale:return KbSearchControl.SearchResultSortOption.Relevance;case KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale:return KbSearchControl.SearchResultSortOption.NumberOfViews;case KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale:return KbSearchControl.SearchResultSortOption.LastModifiedDateNewestFirst;case KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale:return KbSearchControl.SearchResultSortOption.LastModifiedDateOldestFirst;default:return KbSearchControl.SearchResultSortOption.Relevance}};SortFilter.prototype.SetSelectedSortFilterBySortOption=function(sortOption){var needsToChange=false;switch(sortOption){case KbSearchControl.SearchResultSortOption.Rating:break;case KbSearchControl.SearchResultSortOption.NumberOfViews:var numberOfViewFilter=this.sortFilters.filter(function(sortOption){return sortOption.text===KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale})[0];if(this.SelectedSortFilter&&numberOfViewFilter&&this.SelectedSortFilter.Value!=numberOfViewFilter.Value){this.SelectedSortFilter=numberOfViewFilter;needsToChange=true}break;case KbSearchControl.SearchResultSortOption.LastModifiedDateOldestFirst:var lastModifiedOldSortFilter=this.sortFilters.filter(function(sortOption){return sortOption.text===KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale})[0];if(this.SelectedSortFilter&&lastModifiedOldSortFilter&&this.SelectedSortFilter.Value!=lastModifiedOldSortFilter.Value){this.SelectedSortFilter=lastModifiedOldSortFilter;needsToChange=true}this._isDescending=false;break;case KbSearchControl.SearchResultSortOption.LastModifiedDateNewestFirst:var lastModifiedNewSortFilter=this.sortFilters.filter(function(sortOption){return sortOption.text===KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale})[0];if(this.SelectedSortFilter&&lastModifiedNewSortFilter&&this.SelectedSortFilter.Value!=lastModifiedNewSortFilter.Value){this.SelectedSortFilter=lastModifiedNewSortFilter;needsToChange=true}this._isDescending=true;break;case KbSearchControl.SearchResultSortOption.Relevance:default:var relevanceSortFilter=this.sortFilters.filter(function(sortOption){return sortOption.text===KbSearchControl.KbSearchControlLocale.RelevanceLocale})[0];if(this.SelectedSortFilter&&relevanceSortFilter&&this.SelectedSortFilter.Value!=relevanceSortFilter.Value){this.SelectedSortFilter=relevanceSortFilter;needsToChange=true}break}return needsToChange};return SortFilter}();KbSearchControl.SortFilter=SortFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchControlLocale=function(){function KbSearchControlLocale(){}KbSearchControlLocale.initialize=function(getString){KbSearchControlLocale.NumberOfResultsFoundText=getString(KbSearchControl.Constants.NumberOfResultsFoundResourceName);KbSearchControlLocale.TextAnalyticsText=getString(KbSearchControl.Constants.TextAnalyticsResourceName);KbSearchControlLocale.FilterOpenTitleText=getString(KbSearchControl.Constants.FilterOpenTitleResourceName);KbSearchControlLocale.FilterCloseTitleText=getString(KbSearchControl.Constants.FilterCloseTitleResourceName);KbSearchControlLocale.FilterOpenAltText=getString(KbSearchControl.Constants.FilterOpenAltTextResourceName);KbSearchControlLocale.FilterCloseAltText=getString(KbSearchControl.Constants.FilterCloseAltTextResourceName);KbSearchControlLocale.SortFilterTitleText=getString(KbSearchControl.Constants.SortFilterTitleResourceName);KbSearchControlLocale.AutoSuggestionTitleText=getString(KbSearchControl.Constants.AutoSuggestionTitleResourceName);KbSearchControlLocale.AutoSuggestionAltText=getString(KbSearchControl.Constants.AutoSuggestionAltTextResourceName);KbSearchControlLocale.SearchBoxPlaceholder=getString(KbSearchControl.Constants.SearchBoxPlaceholderResourceName);KbSearchControlLocale.SearchBoxAriaLabel=getString(KbSearchControl.Constants.SearchBoxAriaLabelResourceName);KbSearchControlLocale.SearchIconAltText=getString(KbSearchControl.Constants.SearchIconAltTextResourceName);KbSearchControlLocale.RemoveIconAltText=getString(KbSearchControl.Constants.RemoveIconAltTextResourceName);KbSearchControlLocale.FilterResultsByLabel=getString(KbSearchControl.Constants.FilterResultsByLabelResourceName);KbSearchControlLocale.SortByLabel=getString(KbSearchControl.Constants.SortByLabelResourceName);KbSearchControlLocale.AllDraftArticlesLocale=getString(KbSearchControl.Constants.AllDraftArticlesResourceName);KbSearchControlLocale.AllPublishedArticlesLocale=getString(KbSearchControl.Constants.AllPublishedArticlesResourceName);KbSearchControlLocale.AllApprovedArticlesLocale=getString(KbSearchControl.Constants.AllApprovedArticlesResourceName);KbSearchControlLocale.AllApprovedArticlesLocale=getString(KbSearchControl.Constants.AllApprovedArticlesResourceName);KbSearchControlLocale.RelevanceLocale=getString(KbSearchControl.Constants.RelevanceResourceName);KbSearchControlLocale.RatingLocale=getString(KbSearchControl.Constants.RatingResourceName);KbSearchControlLocale.NumberOfViewsLocale=getString(KbSearchControl.Constants.NumberOfViewsResourceName);KbSearchControlLocale.LastModifiedDateNewestFirstLocale=getString(KbSearchControl.Constants.LastModifiedDateNewestFirstResourceName);KbSearchControlLocale.LastModifiedDateOldestFirstLocale=getString(KbSearchControl.Constants.LastModifiedDateOldestFirstResourceName);KbSearchControlLocale.LoadMoreButtonLocale=getString(KbSearchControl.Constants.LoadMoreButton);KbSearchControlLocale.LoadingTextLocale=getString(KbSearchControl.Constants.LoadingText);KbSearchControlLocale.ConfirmDialogTitle=getString(KbSearchControl.Constants.ConfirmDialogTitle);KbSearchControlLocale.ConfirmDialogText=getString(KbSearchControl.Constants.ConfirmDialogTextResourceName);KbSearchControlLocale.ContentPaneBackButtonLabelText=getString(KbSearchControl.Constants.ContentPaneBackButtonLabelResourceName);KbSearchControlLocale.ContentPaneBackButtonToolTip=getString(KbSearchControl.Constants.ContentPaneBackButtonToolTip);KbSearchControlLocale.ContentPaneBackButtonAltText=getString(KbSearchControl.Constants.ContentPaneBackButtonAltText);KbSearchControlLocale.ModifiedOnLabel=getString(KbSearchControl.Constants.ModifiedOnLabelResourceName);KbSearchControlLocale.ModifiedOnLabelToolTip=getString(KbSearchControl.Constants.ModifiedOnLabelToolTip);KbSearchControlLocale.NumberOfViewsIconToolTip=getString(KbSearchControl.Constants.NumberOfViewsIconToolTip);KbSearchControlLocale.RatingIconToolTip=getString(KbSearchControl.Constants.RatingIconToolTip);KbSearchControlLocale.ArticleIconToolTipUnAssociated=getString(KbSearchControl.Constants.ArticleIconToolTipUnAssociated);KbSearchControlLocale.ArticleIconToolTipAssociated=getString(KbSearchControl.Constants.ArticleIconToolTipAssociated);KbSearchControlLocale.ArticleTagLabelAssociated=getString(KbSearchControl.Constants.ArticleTagLabelAssociated);KbSearchControlLocale.ResultStatusDraft=getString(KbSearchControl.Constants.ResultStatusDraftResourceName);KbSearchControlLocale.ResultStatusApproved=getString(KbSearchControl.Constants.ResultStatusApprovedResourceName);KbSearchControlLocale.ResultStatusScheduled=getString(KbSearchControl.Constants.ResultStatusScheduledResourceName);KbSearchControlLocale.MoreActionsText=getString(KbSearchControl.Constants.MoreActionsTextResourceName);KbSearchControlLocale.ContentPaneText=getString(KbSearchControl.Constants.ContentPaneTextResourceName);KbSearchControlLocale.NoArticlesErrorMessage=getString(KbSearchControl.Constants.NoArticlesErrorMessageResourceName);KbSearchControlLocale.RecordDoesNotExistErrorMessage=getString(KbSearchControl.Constants.RecordDoesNotExistErrorMessageResourceName);KbSearchControlLocale.NoSearchErrorMessage=getString(KbSearchControl.Constants.NoSearchErrorMessageResourceName);KbSearchControlLocale.SearchAndSelectArticleMessage=getString(KbSearchControl.Constants.SearchAndSelectArticleMessageResourceName);KbSearchControlLocale.NoPermissionErrorMessage=getString(KbSearchControl.Constants.NoPermissionErrorMessageResourceName);KbSearchControlLocale.TextAnalyticsErrorMessage=getString(KbSearchControl.Constants.TextAnalyticsErrorMessageResourceName);KbSearchControlLocale.SearchWidgetRelevanceSearchAdditionalMatches=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchAdditionalMatches);KbSearchControlLocale.SearchWidgetRelevanceSearchAnnotationMatchCount=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchAnnotationMatchCount);KbSearchControlLocale.SearchWidgetRelevanceSearchNotesAnnotationMatchCount=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchNotesAttachmentMatchCount);KbSearchControlLocale.SearchWidgetRelevanceSearchWarningTitle=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchWarningTitle);KbSearchControlLocale.NumberOfRatingToolTip=getString(KbSearchControl.Constants.NumberOfRatingToolTip);KbSearchControlLocale.SearchWidgetRelevanceSearchNotesMatchCount=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchNotesMatchCount);KbSearchControlLocale.MandatoryFieldsMissingError=getString(KbSearchControl.Constants.MandatoryFieldMissingErrorMessage);KbSearchControlLocale.MandatoryFieldMissingLinkFormat=getString(KbSearchControl.Constants.MandatoryFieldMissingLinkFormat);KbSearchControlLocale.MandatoryFieldMissingLinkText=getString(KbSearchControl.Constants.MandatoryFieldMissingLinkText);KbSearchControlLocale.SavedQueryApiFailedErrorMessage=getString(KbSearchControl.Constants.SavedQueryApiFailedErrorMessage);KbSearchControlLocale.QuickFindDocumentationHelpLink=getString(KbSearchControl.Constants.QuickFindDocumentationHelpLink);KbSearchControlLocale.MDFLabelText=getString(KbSearchControl.Constants.MDFLabelText);KbSearchControlLocale.MDFTooltipText=getString(KbSearchControl.Constants.MDFTooltipText);KbSearchControlLocale.InternalArticlesText=getString(KbSearchControl.Constants.InternalArticlesResourceName);KbSearchControlLocale.ExternalArticlesText=getString(KbSearchControl.Constants.ExternalArticlesResourceName);KbSearchControlLocale.ArticleStatusFilterText=getString(KbSearchControl.Constants.ArticleStatusFilterResourceName);KbSearchControlLocale.ArticleVisibilityFilterText=getString(KbSearchControl.Constants.ArticleVisibilityFilterResourceName);KbSearchControlLocale.ArticleLanguageFilterText=getString(KbSearchControl.Constants.ArticleLanguageFilterResourceName);KbSearchControlLocale.ArticleDateFilterText=getString(KbSearchControl.Constants.ArticleDateFilterResourceName);KbSearchControlLocale.Last7DaysText=getString(KbSearchControl.Constants.Last7DaysFilterResourceName);KbSearchControlLocale.Last30DaysText=getString(KbSearchControl.Constants.Last30DaysFilterResourceName);KbSearchControlLocale.Last6MonthsText=getString(KbSearchControl.Constants.Last6MonthsFilterResourceName);KbSearchControlLocale.LastYearText=getString(KbSearchControl.Constants.LastYearFilterResourceName);KbSearchControlLocale.FilterOptionAllText=getString(KbSearchControl.Constants.FilterOptionAllResourceName);KbSearchControlLocale.KnowledgeSearch=getString(KbSearchControl.Constants.KnowledgeSearch);KbSearchControlLocale.SortedByText=getString(KbSearchControl.Constants.SortedByText);KbSearchControlLocale.StandalonePageTitle=getString(KbSearchControl.Constants.StandalonePageTitle)};return KbSearchControlLocale}();KbSearchControl.KbSearchControlLocale=KbSearchControlLocale})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var EntitySearchResultLegends=function(){function EntitySearchResultLegends(){}EntitySearchResultLegends.prototype.init=function(context,notifyOutputChanged,state,container){this._context=context};EntitySearchResultLegends.prototype.renderEntitySearchResultLegendsContainer=function(){var EntitySearchResultLegendContainer=this.renderEntitySearchResultLegendContainer();return this._context.factory.createElement("CONTAINER",{key:"entitySearchResultLegendContainer",id:"entitySearchResultLegendContainerid"},EntitySearchResultLegendContainer)};EntitySearchResultLegends.prototype.getLegendTemplate=function(){return this._context.factory.createElement("LABEL",{key:"LegendTemplate",id:"kbSearchResultLegendsSpan"})};EntitySearchResultLegends.prototype.renderEntitySearchResultLegendContainer=function(){var entitySearchResultLegendContainerChildren=[],legendTemplate=this.getLegendTemplate();entitySearchResultLegendContainerChildren.push(legendTemplate);return entitySearchResultLegendContainerChildren};EntitySearchResultLegends.prototype.render=function(){return this.renderEntitySearchResultLegendsContainer()};EntitySearchResultLegends.prototype.getOutputs=function(){return null};EntitySearchResultLegends.prototype.destroy=function(){};EntitySearchResultLegends.prototype.onPreNavigation=function(){};return EntitySearchResultLegends}();KbSearchControl.EntitySearchResultLegends=EntitySearchResultLegends})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchFilter=function(){function KbSearchFilter(){}KbSearchFilter.prototype.init=function(context,notifyOutputChanged,state,container){this._context=context};KbSearchFilter.prototype.render=function(){return this._context.factory.createElement("LABEL",{key:"KbSearchFilter"},"KbSearchFilter")};KbSearchFilter.prototype.getOutputs=function(){return null};KbSearchFilter.prototype.destroy=function(){};KbSearchFilter.prototype.onPreNavigation=function(){};return KbSearchFilter}();KbSearchControl.KbSearchFilter=KbSearchFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchActions=function(){function SearchActions(){}SearchActions.prototype.init=function(context){this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this._context=context};SearchActions.prototype.handleBackButtonClick=function(event){this._stateManager.SetIsSearchMode(true,this._context);this._context.utils.requestRender();this.reportBackButtonClickEvent()};SearchActions.prototype.handleBackButtonPress=function(event){if(event.key==="Enter"){this._stateManager.SetIsSearchMode(true,this._context);this._context.utils.requestRender(this.onBackKeyDown.bind(this));this.reportBackButtonClickEvent()}};SearchActions.prototype.onBackKeyDown=function(){for(var articleTitleID=this._context.accessibility.getUniqueId("articleTitle"),articleIndex=$("[id="+articleTitleID+"]"),i=0;i<articleIndex.length;i++)articleIndex[i].attributes["title"].nodeValue==this._stateManager.GetSelectedArticle().title&&articleIndex[i].focus()};SearchActions.prototype.reportBackButtonClickEvent=function(){if(this._stateManager.records[0].knowledgeArticleId===this._stateManager.GetSelectedArticle().knowledgeArticleId)!this._stateManager.IsActionPerformedOnFirstResult&&this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.BackButtonClickedWithoutAction]);this._stateManager.IsActionPerformedOnFirstResult=false};SearchActions.prototype.getOutputs=function(){return null};return SearchActions}();KbSearchControl.SearchActions=SearchActions})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var SearchResult=function(){function SearchResult(){}SearchResult.prototype.init=function(context,fetchApiWrapper){this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this._context=context;this.fetchApiWrapper=fetchApiWrapper};SearchResult.prototype.handleKeyDownPress=function(keyEvent,kbSearchRecord){var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResults,"handleKeyDownPress"),articleTitleID=this._context.accessibility.getUniqueId("articleTitle");if(keyEvent.keyCode==KbSearchControl.Constants.DownArrowKeyCode){var articleIndex=$("[id="+articleTitleID+"]"),articleIndexCount=articleIndex.index(document.activeElement);if(articleIndexCount!=articleIndex.length-1){articleIndex[articleIndexCount+1].focus();this._stateManager.SetSelectedArticle(this._stateManager.records[articleIndexCount+1],this._context)}else{var loadMoreLabel=document.getElementById(this._context.accessibility.getUniqueId("loadMoreLabel"));loadMoreLabel&&loadMoreLabel.focus()}}else if(keyEvent.keyCode==KbSearchControl.Constants.UpArrowKeyCode){var articleIndex=$("[id="+articleTitleID+"]"),articleIndexCount=articleIndex.index(document.activeElement);if(articleIndexCount!=0){articleIndex[articleIndexCount-1].focus();this._stateManager.SetSelectedArticle(this._stateManager.records[articleIndexCount-1],this._context)}else{var searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.SearchTextBoxId));searchTextBox.focus()}}else keyEvent.keyCode==KbSearchControl.Constants.EnterKey&&this.renderArticleContent(keyEvent,kbSearchRecord);watermarkTelemetryEvent.End()};SearchResult.prototype.articleClick=function(kbSearchRecord,event,errorOccured){if(errorOccured===void 0)errorOccured=false;var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResults,"articleClick");this._stateManager.isKnowledgeSearchInsightsEnabled&&MscrmControls.KbCommonUtils.CommonUtils.CreateKnowledgeInteractionRecord(this._context,kbSearchRecord.knowledgeOperationId,MscrmControls.KbCommonUtils.InteractionType.ViewArticle,kbSearchRecord.knowledgeArticleId,kbSearchRecord.articleRank);if(this._stateManager.recordIds){var articleIndex=this._stateManager.recordIds.indexOf(kbSearchRecord.knowledgeArticleId);MscrmControls.KbCommonUtils.TelemetryReporter.LogInfo(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.Open_Article_To_Read,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,eventParams:[{name:"KbArticleIndex",value:articleIndex}]})}this._stateManager.clickKbArticleId=kbSearchRecord.knowledgeArticleId;if(MscrmControls.KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(kbSearchRecord)){this._stateManager.SetSelectedArticle(kbSearchRecord,this._context);MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(MscrmControls.KbCommonUtils.ArticleAction.PopoutArticle,{controlContext:this._context,record:kbSearchRecord,stateManager:this._stateManager});this._context.utils.requestRender();event.preventDefault()}else{if(!errorOccured){var operationPayload_2={controlContext:this._context,record:kbSearchRecord,fetchApiWrapper:this.fetchApiWrapper,stateManager:this._stateManager,actionOperationCallback:MscrmControls.KbCommonUtils.ActionCallbackFactory.Instance.GetActionCallback(MscrmControls.KbCommonUtils.ArticleAction.IncreaseView)};MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(MscrmControls.KbCommonUtils.ArticleAction.IncreaseView,operationPayload_2)}this._fireEvent(kbSearchRecord);if(this._context.parameters.value.blockClick){event.stopPropagation();event.preventDefault();this._stateManager.SetSelectedArticle(kbSearchRecord,this._context);this._stateManager.CallResultOpenedNotifyHandler(this._context);this._context.utils.requestRender();return}var operationPayload={controlContext:this._context,record:kbSearchRecord,fetchApiWrapper:this.fetchApiWrapper,stateManager:this._stateManager,actionOperationCallback:MscrmControls.KbCommonUtils.ActionCallbackFactory.Instance.GetActionCallback(MscrmControls.KbCommonUtils.ArticleAction.OpenResult)};MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(MscrmControls.KbCommonUtils.ArticleAction.OpenResult,operationPayload);event.stopPropagation();event.preventDefault();watermarkTelemetryEvent.End()}};SearchResult.prototype._fireEvent=function(kbSearchRecord){var searchWidgetParameter=Object.assign({},this._context.parameters.value),updatedKbSearchRecord=Object.assign({},kbSearchRecord,{knowledgeArticleViews:kbSearchRecord.knowledgeArticleViews+1});searchWidgetParameter.records=[updatedKbSearchRecord];searchWidgetParameter.recordIds=[updatedKbSearchRecord.knowledgeArticleId];searchWidgetParameter.hideSearchOnRecordLoad=true;searchWidgetParameter.Visible=true;this._context.utils.fireEvent("onSearchWidgetResultOpened",searchWidgetParameter)};SearchResult.prototype.renderArticleContent=function(event,kbSearchRecord){var _this=this;if(this._stateManager.isExternalSearchIndexEnabled){var cloneKbRecord=JSON.parse(JSON.stringify(kbSearchRecord));window.$.when(this.getKATitleContent(cloneKbRecord)).done(function(kbResponse){kbResponse.isAssociated=kbSearchRecord.isAssociated;return _this.articleClick(kbResponse,event)}).fail(function(errorObject){if(errorObject&&errorObject.knowledgeArticleId)return _this.articleClick(errorObject,event,true)});event.stopPropagation();event.preventDefault()}else return this.articleClick(kbSearchRecord,event)};SearchResult.prototype.getOutputs=function(){return null};SearchResult.prototype.destroy=function(){};SearchResult.prototype.onPreNavigation=function(){};SearchResult.prototype._articleContainerClick=function(event,kbSearchRecord){this._stateManager.clickKbArticleId=kbSearchRecord.knowledgeArticleId;this.renderArticleContent(event,kbSearchRecord)};SearchResult.prototype.getKATitleContent=function(kbSearchRecord){var _this=this,deferred=$.Deferred();MscrmControls.KbCommonUtils.ActionOperationUtils.GetFormattedContent(this._context,kbSearchRecord.knowledgeArticleId,MscrmControls.KbCommonUtils.SearchProviderType.CrossDynamicsOrg==kbSearchRecord.searchProviderType,kbSearchRecord.resourceUri).done(function(response){kbSearchRecord.content=response;deferred.resolve(kbSearchRecord)}).fail(function(error){if(typeof error==="string"){kbSearchRecord.content=error;deferred.rejectWith(_this,[kbSearchRecord])}else{console.error(error);deferred.reject()}});return deferred.promise()};SearchResult.prototype.handleLoadMoreButtonClick=function(event){MscrmControls.KbCommonUtils.TelemetryReporter.LogInfo(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.SeeMore_Option_Clicked,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl});var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"_handleLoadMoreButtonClick");this._stateManager.popupEnabled=this._context.client.disableScroll;this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.ShowMoreClicked]);this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch(true);var articleIndex=$('[id="'+this.getArticleTitle()+'Text"]');if(articleIndex&&articleIndex.length>0){var articleIndexCount=articleIndex.length-1;articleIndex[articleIndexCount].tabIndex=0;articleIndex[articleIndexCount].focus()}watermarkTelemetryEvent.End()};SearchResult.prototype.handleLoadMoreButtonKeyDown=function(event){if(event.keyCode==KbSearchControl.Constants.UpArrowKeyCode){var articleIndex=$('[id="'+this.getArticleTitle()+'"]'),articleIndexCount=articleIndex.length-1;if(articleIndexCount!=0){articleIndex[articleIndexCount].focus();this._stateManager.SetSelectedArticle(this._stateManager.records[articleIndexCount],this._context)}}else if(event.keyCode===KbSearchControl.Constants.EnterKey){this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch(true);var articleIndex=$('[id="'+this.getArticleTitle()+'Text"]');if(articleIndex&&articleIndex.length>0){var articleIndexCount=articleIndex.length-1;articleIndex[articleIndexCount].tabIndex=0;articleIndex[articleIndexCount].focus()}}};SearchResult.prototype.getArticleTitle=function(){var articleTitleID=this._context.accessibility.getUniqueId("articleTitle");return articleTitleID};return SearchResult}();KbSearchControl.SearchResult=SearchResult})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchBoxContainer=function(){function SearchBoxContainer(){this.minLettersToTriggerAutoSearch=4;this.searchBoxTypeTimeInterval=600;this.setTimeoutHandle=null;this.isValidKeyEntered=true}SearchBoxContainer.prototype.onClearTextClicked=function(event){var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"onClearTextClicked");if(!this._context.parameters.value.isControlDisabled){document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_closeButton_")).style.display="none";this._stateManager.ExecuteKbSearchHelper.searchText="";this._context.parameters.value.executeUpdateCurrentSearchText(this._context.parameters.value.contextToken,"");this._context.parameters.value.currentSearchText="";this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch();this._stateManager.ExecuteKbSearchHelper.SearchHasBeenPerformed=false;this._stateManager.SetIsSearchMode(true,this._context);this._context.accessibility.focusElementById(KbSearchControl.Constants.SearchTextBoxId)}watermarkTelemetryEvent.End()};SearchBoxContainer.prototype.onKeyDown=function(event){if(!this._context.parameters.value.isControlDisabled){if(event.key==="Enter"){this.handleSearchButtonClick(event);event.stopPropagation();event.preventDefault();this.setFocusOnSearchTextBox()}this.isValidKeyEntered=this.isValidKey(event.key)}};SearchBoxContainer.prototype.handleKeyDownPress=function(keyEvent){var watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"handleKeyDownPress");if(keyEvent.keyCode==KbSearchControl.Constants.DownArrowKeyCode){var articleTitleID=this._context.accessibility.getUniqueId("articleTitle"),articleIndex=$("[id="+articleTitleID+"]");if(articleIndex.length>0){articleIndex[0].focus();this._stateManager.SetSelectedArticle(this._stateManager.records[0],this._context)}}watermarkTelemetryEvent.End()};SearchBoxContainer.prototype.handleCloseAndSearchIconsVisibilty=function(searchText){var searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.SearchTextBoxId));if(searchTextBox!=null){var showIcons=searchText;if(!showIcons)document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_closeButton_")).style.display="none";else document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_closeButton_")).style.display="block"}};SearchBoxContainer.prototype.getSearchBox=function(){var searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.SearchTextBoxId));return searchTextBox};SearchBoxContainer.prototype.onTextBoxChanged=function(event){var _this=this,watermarkTelemetryEvent=MscrmControls.KbCommonUtils.WatermarkTelemetryEvent.Start(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"onTextBoxChanged");this.inEditMode=true;document.getElementById(this._context.accessibility.getUniqueId("searchIconContainer")).style.display="none";this._stateManager.ResetSelectedArticle();this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.ExecuteKbSearchHelper.searchText=event.target.value;var searchText=this._stateManager.ExecuteKbSearchHelper.searchText;this.handleCloseAndSearchIconsVisibilty(searchText);if(this.setTimeoutHandle!=null){window.clearTimeout(this.setTimeoutHandle);this.setTimeoutHandle=null}var isTypeAheadEnabled=!this._context.utils.isFeatureEnabled("April2020Update");if(isTypeAheadEnabled&&this._stateManager.ExecuteKbSearchHelper.searchText.length>=this.minLettersToTriggerAutoSearch&&this.isValidKeyEntered)this.setTimeoutHandle=setTimeout(function(){return _this.handleSearchButtonClick(event)},this.searchBoxTypeTimeInterval);if(this._stateManager.ExecuteKbSearchHelper.searchText.length==0){var searchRecordsCount=-1,isRelevanceSearchEnabled=this._context.utils.isFeatureEnabled(KbSearchControl.Constants.UCKMControlRelevanceSearch)&&this._stateManager.isExternalSearchIndexEnabled;if(isRelevanceSearchEnabled&&this._stateManager.relevanceSearchRecords!=null&&this._stateManager.relevanceSearchRecords.value!=null)searchRecordsCount=this._stateManager.relevanceSearchRecords.value.length;else if(this._stateManager.records!=null)searchRecordsCount=this._stateManager.records.length;if(!(searchRecordsCount>0)){this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch();this._stateManager.ExecuteKbSearchHelper.SearchHasBeenPerformed=false}}watermarkTelemetryEvent.End()};SearchBoxContainer.prototype.handleSearchButtonClick=function(event){this.inEditMode=false;document.getElementById(this._context.accessibility.getUniqueId("searchIconContainer")).style.display="inline-flex";if(!this._context.parameters.value.isControlDisabled){MscrmControls.KbCommonUtils.TelemetryReporter.LogUsage(this._context,{actionName:MscrmControls.KbCommonUtils.TelemetryActionName.KbSearch_Performed,controlType:MscrmControls.KbCommonUtils.TelemetryControlType.KbSearchControl,featureName:MscrmControls.KbCommonUtils.TelemetryFeatureName.KbSearch,subFeatureName:MscrmControls.KbCommonUtils.TelemetrySubFeatureName.ManualSearch});this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.ResetSelectedArticle();this._stateManager.SetIsSearchMode(true,this._context);this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch();this._context.parameters.value.executeUpdateCurrentSearchText(this._context.parameters.value.contextToken,this.getSearchBox().value)}};SearchBoxContainer.prototype.handleFilterButtonClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._stateManager.filtersVisible=!this._stateManager.filtersVisible;this._context.utils.requestRender()}};SearchBoxContainer.prototype.setFocusOnSearchTextBox=function(){var searchTextBoxNode;searchTextBoxNode="";searchTextBoxNode instanceof Element&&$(searchTextBoxNode).focus()};SearchBoxContainer.prototype.handleOnBlur=function(evt){document.getElementById(this._context.accessibility.getUniqueId("searchIconContainer")).style.display=this.inEditMode?"none":"inline-flex"};SearchBoxContainer.prototype.handleOnFocus=function(evt){document.getElementById(this._context.accessibility.getUniqueId("searchIconContainer")).style.display=this.inEditMode?"none":"inline-flex";var searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.SearchTextBoxId)),searchTextBoxNode=searchTextBox,strLength=searchTextBoxNode.value.length;setTimeout(function(){searchTextBoxNode.setSelectionRange&&searchTextBoxNode.setSelectionRange(strLength,strLength)},0)};SearchBoxContainer.prototype.isValidKey=function(keyName){switch(keyName){case "ArrowRight":case "ArrowLeft":case "ArrowUp":case "ArrowDown":case "Tab":case "Shift":case "Control":case "Alt":case "Escape":case " ":case "End":case "Home":case "F2":case "F4":case "F9":case "F10":case "F12":case "CapsLock":case "Insert":case "PageDown":case "PageUp":return false;default:return true}};SearchBoxContainer.prototype.getInitialState=function(){return {currentText:""}};SearchBoxContainer.prototype.init=function(context,notifyOutputChanged,state,container){this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this._context=context};SearchBoxContainer.prototype.handleSearchPress=function(event){if(!this._context.parameters.value.isControlDisabled)event.key==="Enter"&&this.handleSearchButtonClick(event)};SearchBoxContainer.prototype.handleClosePress=function(event){if(!this._context.parameters.value.isControlDisabled)if(event.key==="Enter"){event.stopPropagation();event.preventDefault();this.onClearTextClicked(event)}};return SearchBoxContainer}();KbSearchControl.SearchBoxContainer=SearchBoxContainer})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var KbSearchUtil=function(){function KbSearchUtil(){}KbSearchUtil.isCustomerEnabledForCurrentWave=function(context){if(context.utils.isFeatureEnabled(this.CurrentWave))return true};KbSearchUtil.IsFeatureEnabled=function(context,feature){if(context.utils.isFeatureEnabled(feature)&&this.isCustomerEnabledForCurrentWave(context))return true;else return false};KbSearchUtil.CurrentWave="October2019Update";return KbSearchUtil}();KbSearchControl.KbSearchUtil=KbSearchUtil})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var StateUtil=function(){function StateUtil(){}StateUtil.SaveState=function(context,stateManager,currentState){var searchState=new KbSearchControl.SearchState;stateManager.saveState(searchState);var state={};state[StateUtil.STATE_KEY_SEARCH]=searchState;if(currentState&&currentState[StateUtil.STATE_KEY_ARTICLE])state[this.STATE_KEY_ARTICLE]=currentState[StateUtil.STATE_KEY_ARTICLE];if(currentState&&currentState[StateUtil.STATE_KEY_CONTENT])state[this.STATE_KEY_CONTENT]=currentState[StateUtil.STATE_KEY_CONTENT];context.mode.setControlState(state,false,true)};StateUtil.RestoreState=function(context,stateManager,state){state&&state[StateUtil.STATE_KEY_SEARCH]&&stateManager.restoreState(state[StateUtil.STATE_KEY_SEARCH])};StateUtil.setChildControlState=function(childState,childKey,parentState){if(!parentState)parentState={};parentState[childKey]=childState;return parentState};StateUtil.getChildControlState=function(childKey,parentState){if(parentState)return parentState[childKey];return null};StateUtil.STATE_KEY_SEARCH="searchState";StateUtil.STATE_KEY_ARTICLE="articleState";StateUtil.STATE_KEY_CONTENT="contentState";return StateUtil}();KbSearchControl.StateUtil=StateUtil})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchView=function(){function SearchView(){}SearchView.prototype.init=function(initParams){this.CreateElement=initParams.CreateElement;this.CreateComponent=initParams.CreateComponent;this.FocusElementById=initParams.FocusElementById;this.GetUniqueId=initParams.GetUniqueId;this.GetString=initParams.GetString;this.FormatTime=initParams.FormatTime;this.StartWatermarkEvent=initParams.StartWatermarkEvent;this.AddErrorLog=initParams.AddErrorLog;return this};return SearchView}();KbSearchControl.SearchView=SearchView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchActionsView=function(_super){__extends(SearchActionsView,_super);function SearchActionsView(){return _super!==null&&_super.apply(this,arguments)||this}SearchActionsView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.searchResultActionView=new KbSearchControl.SearchResultActionView;this.searchResultActionView.init(initParams);this.HandleBackButtonKeyDown=initParams.HandleBackButtonKeyDown;this.HandleBackButtonClick=initParams.HandleBackButtonClick;return this};SearchActionsView.prototype.render=function(renderParams){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchActions,"renderControlBlock"),controlBlock=[],backButtonAndActionLinks=[];if(!renderParams.hideSearchOnRecordLoad&&(!renderParams.isExpandedMode||window.IsUSD)){var backButton=this.CreateElement("MICROSOFTICON",{id:"ContentPaneBackButtonContainer",key:"ContentPaneBackButtonContainer",accessibilityLabel:KbSearchControl.KbSearchControlLocale.ContentPaneBackButtonToolTip,tabIndex:0,onKeyDown:this.HandleBackButtonKeyDown.bind(this),onClick:this.HandleBackButtonClick.bind(this),role:"button",type:56,title:KbSearchControl.KbSearchControlLocale.ContentPaneBackButtonToolTip}),backButtonDiv=this.CreateElement("CONTAINER",{style:{display:"inline-block",cursor:"pointer",fontSize:"16px",paddingRight:renderParams.isRTL?0:"14px",paddingLeft:renderParams.isRTL?"14px":0,borderRight:renderParams.isRTL?0:renderParams.theming.borders.border02,borderLeft:renderParams.isRTL?renderParams.theming.borders.border02:0,marginRight:renderParams.isRTL?renderParams.theming.measures.measure025:renderParams.theming.measures.measure050,marginLeft:renderParams.isRTL?renderParams.theming.measures.measure050:renderParams.theming.measures.measure025}},backButton);backButtonAndActionLinks.push(backButtonDiv)}var renderActionLinks=this.searchResultActionView.render(renderParams,renderParams.selectedArticle,this.GetUniqueId("contentPaneArticleTitle"),false),actions=this.CreateElement("Container",{id:"ContentPaneActionLinks",key:"ContentPaneActionLinksDiv",style:{display:"inline-block",width:"100%",height:!renderParams.isReferencePanel?renderParams.theming.measures.measure275:"auto"},className:"ContentPaneActionLinks"},renderActionLinks);backButtonAndActionLinks.push(actions);controlBlock.push(this.CreateElement("Container",{id:"ContentPaneHeader",key:"ContentPaneHeaderDiv",style:{marginTop:0,borderBottomWidth:"1px",borderBottomStyle:"solid",borderStyle:"solid",borderBottomColor:"#D7D7D7",paddingBottom:renderParams.isReferencePanel?"8px":0,paddingTop:renderParams.isReferencePanel?"8px":0,width:"100%",alignItems:"center",height:!renderParams.isReferencePanel?renderParams.theming.measures.measure275:"auto"},className:"ContentPaneHeader"},backButtonAndActionLinks));var result=this.CreateElement("Container",{id:"controlBlockActionHeaderReadPane",key:"controlBlockActionReadPanelDiv",ref:"controlBlockActionReadPanelDiv",className:"controlBlockHeaderReadPane",height:!renderParams.isReferencePanel?renderParams.theming.measures.measure275:"auto"},controlBlock);watermarkTelemetryEvent.End();return result};return SearchActionsView}(KbSearchControl.SearchView);KbSearchControl.SearchActionsView=SearchActionsView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchErrorView=function(_super){__extends(SearchErrorView,_super);function SearchErrorView(){return _super!==null&&_super.apply(this,arguments)||this}SearchErrorView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);return this};SearchErrorView.prototype.render=function(renderParams){var errorValues=[];if(!renderParams.isRelevanceSearchSyncStatusValid)if(renderParams.isSavedQueryApiFailed){var savedQueryErrorMessage=KbSearchControl.KbSearchControlLocale.SavedQueryApiFailedErrorMessage;errorValues.push(this.CreateElement("Container",{style:{flexDirection:"row",overflow:"auto",width:"100%"}},savedQueryErrorMessage))}else{var messageHeader=KbSearchControl.KbSearchControlLocale.MandatoryFieldsMissingError,messageLinkParts=KbSearchControl.KbSearchControlLocale.MandatoryFieldMissingLinkFormat.split("{0}"),messagePartArray=[];messageLinkParts[0]&&messagePartArray.push(this.CreateElement("Label",{className:"mscrm-kbSearchResultDescription",style:{color:renderParams.theming.colors.grays.gray05,fontSize:renderParams.theming.fontsizes.font100,whiteSpace:"normal",wordBreak:"break-word"}},messageLinkParts[0]));messagePartArray.push(this.CreateElement("HYPERLINK",{href:KbSearchControl.Constants.MandatoryFieldKbLink,target:"_blank",style:{fontSize:renderParams.theming.fontsizes.font100,whiteSpace:"normal",wordBreak:"break-word"},accessibilityLabel:KbSearchControl.KbSearchControlLocale.QuickFindDocumentationHelpLink},KbSearchControl.KbSearchControlLocale.MandatoryFieldMissingLinkText));messageLinkParts[1]&&messagePartArray.push(this.CreateElement("Label",{className:"mscrm-kbSearchResultDescription",style:{color:renderParams.theming.colors.grays.gray05,fontSize:renderParams.theming.fontsizes.font100,whiteSpace:"normal",wordBreak:"break-word"}},messageLinkParts[1]));errorValues.push(this.CreateElement("Container",{style:{overflow:"auto",width:"100%"}},messageHeader));errorValues.push(this.CreateElement("Container",{style:{overflow:"auto",width:"100%",display:"block"}},messagePartArray))}else if(renderParams.error&&renderParams.errorMessage!=""){errorValues=this.constructErrorMessage(renderParams,renderParams.formattedErrorMessage,renderParams.errorDetails,renderParams.errorMessage);this.AddErrorLog(renderParams.formattedErrorMessage,renderParams.errorDetails)}else errorValues=this.constructErrorMessage(renderParams,KbSearchControl.KbSearchControlLocale.NoArticlesErrorMessage,null,KbSearchControl.Constants.NoArticlesErrorMessageResourceName);return this.CreateElement("Container",{id:"kbSearchErrorResults.body.id",key:"kbSearchErrorResults.body",style:{minHeight:renderParams.theming.measures.measure250,display:"block",paddingLeft:"17px",paddingRight:"17px"}},errorValues)};SearchErrorView.prototype.constructErrorMessage=function(renderParams,errorMsg,errorDetails,errorConstant){var errorValues=[],errorMessage=errorMsg,errorHeader=this.CreateElement("Label",{className:"mscrm-kbSearchResultDescription",style:{color:renderParams.theming.colors.grays.gray05,overflow:"auto",width:"100%",fontSize:renderParams.theming.fontsizes.font100,whiteSpace:"normal",wordBreak:"break-word"}},errorMessage),errorHeaderProps=errorHeader.getProperties();errorHeaderProps.style["text-align"]="center";errorHeaderProps.style["padding-top"]=renderParams.theming.measures.measure100;switch(errorConstant){case KbSearchControl.Constants.NoArticlesErrorMessageResourceName:case KbSearchControl.Constants.RecordDoesNotExistErrorMessageResourceName:case KbSearchControl.Constants.NoSearchErrorMessageResourceName:var imageElement=this.CreateElement("IMG",{source:"/Webresources/msdyncrm_/KBSearchStandalone/LeftPane_EmptyState.png",altText:errorMessage,style:{width:renderParams.theming.measures.measure350,height:renderParams.theming.measures.measure350,"padding-top":renderParams.theming.measures.measure100}});errorValues.push(this.CreateElement("Container",{style:{flexDirection:"row","justify-content":"center"}},imageElement));break;default:break}errorValues.push(this.CreateElement("Container",{style:{flexDirection:"row"}},errorHeader));if(errorDetails){for(var errorDetailsLines=errorDetails.replace(/\\r/g,"").split("\\n"),errorLines=[],_i=0,errorDetailsLines_1=errorDetailsLines;_i<errorDetailsLines_1.length;_i++){var errorDetailItem=errorDetailsLines_1[_i];errorLines.push(this.CreateElement("Text",{semanticTag:"div",style:{display:"block",whiteSpace:"nowrap"}},errorDetailItem))}var errorDetailContainer=this.CreateElement("Container",{style:{display:"inline-block",overflow:"auto"}},errorLines);errorValues.push(this.CreateElement("Container",{style:{paddingTop:renderParams.theming.measures.measure100,maxHeight:"calc(2*"+renderParams.theming.measures.measure1075+")"}},errorDetailContainer))}return errorValues};return SearchErrorView}(KbSearchControl.SearchView);KbSearchControl.SearchErrorView=SearchErrorView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchFilterView=function(_super){__extends(SearchFilterView,_super);function SearchFilterView(){return _super!==null&&_super.apply(this,arguments)||this}SearchFilterView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.FilterChangedCallback=initParams.FilterChangedCallback;return this};SearchFilterView.prototype.render=function(renderParams){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchControl,"renderFiltersWithFilterControl");if(!renderParams.isFiltersVisible||renderParams.selectedSearchProvider.SearchProviderType==MscrmControls.KbCommonUtils.SearchProviderType.MSSearchConnector)return;var filteringControlProps={parameters:{value:{Usage:3,Static:false,Value:JSON.stringify(renderParams.filterConfig),Type:"SingleLine.Text",Attributes:{DisplayName:"VirtualFilterControl_Value",LogicalName:"VirtualFilterControl_Value",Type:"string"},Callback:this.FilterChangedCallback}},controlstates:{height:!renderParams.isReferencePanel?300:-1}},filteringControl=this.CreateComponent("MscrmControls.VirtualFilterControl.VirtualFilterControl","VirtualFilteringControl_Container",filteringControlProps),filteringContainer=this.CreateElement("Container",{id:"VirtualFilterControlContainer",key:"VirtualFilterControlContainer",ref:"VirtualFilterControlContainer",style:{display:"inline",width:"100%"}},filteringControl);watermarkTelemetryEvent.End();return filteringContainer};return SearchFilterView}(KbSearchControl.SearchView);KbSearchControl.SearchFilterView=SearchFilterView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchLoadingView=function(_super){__extends(SearchLoadingView,_super);function SearchLoadingView(){return _super!==null&&_super.apply(this,arguments)||this}SearchLoadingView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);return this};SearchLoadingView.prototype.render=function(renderParams){var progressIndicator=this.CreateElement("PROGRESSINDICATOR",{key:"kbsearchprogressIndicator",id:"kbsearchprogressIndicator",style:{width:"40px",height:"40px",display:"table",margin:"0 auto"},progressType:"ring",testhooks:{id:"kbsearchsearch-progress-indicator"},active:true},[]),LoadingText=this.CreateElement("Label",{id:"LoadingTextLabelId",key:"LoadingTextLabel",className:"LoadingTextLabel",style:{paddingTop:"50px"}},KbSearchControl.KbSearchControlLocale.LoadingTextLocale),progressIndicatorContainer=this.CreateElement("CONTAINER",{key:"kbsearchprogressIndicatorContainer",style:{display:"flex",position:"relative",alignSelf:"center",padding:"50px",margin:"0 auto"}},[progressIndicator,LoadingText]);return progressIndicatorContainer};return SearchLoadingView}(KbSearchControl.SearchView);KbSearchControl.SearchLoadingView=SearchLoadingView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchHeaderView=function(_super){__extends(SearchHeaderView,_super);function SearchHeaderView(){return _super!==null&&_super.apply(this,arguments)||this}SearchHeaderView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.HandleSortButtonClick=initParams.HandleSortButtonClick;this.HandleFilterButtonClick=initParams.HandleFilterButtonClick;this.HandleShowSelectedButtonClick=initParams.HandleShowSelectedButtonClick;this.OnSortFlyoutOutsideClick=initParams.OnSortFlyoutOutsideClick;this.HandleSortFlyoutItemClick=initParams.HandleSortFlyoutItemClick;this.OnSearchProviderFlyoutOutsideClick=initParams.OnSearchProviderFlyoutOutsideClick;this.HandleSearchProviderFlyoutItemClick=initParams.HandleSearchProviderFlyoutItemClick;this.SetRuntimeFilters=initParams.SetRuntimeFilters;return this};SearchHeaderView.prototype.render=function(renderParams){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchControl,"renderHeader"),controlBlock=[],header=renderParams.showLabel?renderParams.label:"";if(!renderParams.isReferencePanel&&MscrmCommon.ControlUtils.String.isNullOrEmpty(header))header=KbSearchControl.KbSearchControlLocale.KnowledgeSearch;var headerLabelStyles={width:"50%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:renderParams.theming.fontsizes.font100,marginTop:renderParams.theming.measures.measure025};headerLabelStyles.color="#333333";headerLabelStyles.fontFamily=renderParams.theming.fontfamilies.semibold;headerLabelStyles.fontSize=renderParams.theming.fontsizes.font100;if(renderParams.isCustomerEnabledForOct2020Wave){headerLabelStyles.fontWeight="400";headerLabelStyles.fontSize="14px"}headerLabelStyles.marginTop="6px";headerLabelStyles.display="block";headerLabelStyles.marginTop="";headerLabelStyles.width="";var headerLabel=this.CreateElement("text",{key:"headerLabel",className:"mscrm-kbSearchControlLabel",semanticTag:"h3",style:headerLabelStyles},header),headerLabelContainer=this.CreateElement("CONTAINER",{key:"headerLabelContainer",style:{display:"flex",alignItems:"center",width:"50%"}},headerLabel);controlBlock.push(headerLabelContainer);var actionBlock=[],isRelevanceSearchEnabled=renderParams.isRelevanceSearchEnabled,shouldShowDisableOption=renderParams.isMetadataDrivenFilterEnabled&&renderParams.enableMDF&&renderParams.allowDisablingMDFOnUI&&isRelevanceSearchEnabled&&renderParams.isSearchMode,sortIconElement=this.buildIcon(renderParams,KbSearchControl.KbSearchControlLocale.SortFilterTitleText,KbSearchControl.Constants.SortIconId,255,this.HandleSortButtonClick,null,renderParams.showSortList),filterIconElement=renderParams.isKBSearchFilterEnabled?this.buildIcon(renderParams,KbSearchControl.KbSearchControlLocale.FilterOpenTitleText,KbSearchControl.Constants.FilterIconId,44,this.HandleFilterButtonClick,null,renderParams.isFiltersVisible):null,showSelectedIconElement=this.buildIcon(renderParams,"Show Selected Articles",KbSearchControl.Constants.ShowSelectedIconId,renderParams.shouldShowSelected?296:297,this.HandleShowSelectedButtonClick,null);renderParams.isShowSelectedDialogOptionVisible&&actionBlock.push(showSelectedIconElement);filterIconElement!=null&&actionBlock.push(filterIconElement);actionBlock.push(sortIconElement);if(renderParams.showSortList){var sortOptions=this.makeSortOptionsLayout(renderParams);actionBlock.push(sortOptions)}renderParams.showSearchProviderDropDown&&actionBlock.push(this.makeSearchProvidersOptionsLayout(renderParams));if(shouldShowDisableOption){var checkbox=this.CreateElement("BOOLEAN",{key:"disableMDF",id:"disableMDF",value:renderParams.enableMetadataFiltering,accessibilityLabel:KbSearchControl.KbSearchControlLocale.MDFTooltipText,title:KbSearchControl.KbSearchControlLocale.MDFLabelText,style:{width:"auto",":focus":{outlineOffset:navigator.userAgent.indexOf("Edge/")>-1?"0 !important":"-1px"}},onValueChange:this.SetRuntimeFilters.bind(this)},[]);actionBlock.push(this.CreateElement("CONTAINER",{key:"disableMDFContainer",style:{display:"flex","justify-content":"center","align-items":"center"}},[checkbox]));actionBlock.push(this.CreateElement("LABEL",{key:"disableMDFLabel",id:"disableMDFLabel",accessibilityLabel:KbSearchControl.KbSearchControlLocale.MDFTooltipText,style:{"max-width":"100%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:KbSearchControl.KbSearchControlLocale.MDFTooltipText},KbSearchControl.KbSearchControlLocale.MDFLabelText))}controlBlock.push(this.CreateElement("CONTAINER",{id:"headerActionContainer",key:"headerActionContainer",style:{width:"50%",display:"inline-flex","justify-content":"flex-end","align-items":"center"}},actionBlock));var headerContainerStyle={};if(renderParams.showLabel&&header||shouldShowDisableOption){headerContainerStyle={borderBottom:"",height:renderParams.theming.measures.measure225,minHeight:renderParams.theming.measures.measure225};headerContainerStyle["height"]=renderParams.isCustomerEnabledForOct2020Wave?"36px":"38px";headerContainerStyle["minHeight"]=renderParams.isCustomerEnabledForOct2020Wave?"36px":"38px";headerContainerStyle["paddingTop"]=renderParams.isCustomerEnabledForOct2020Wave?"0px":renderParams.theming.measures.measure075;if(!renderParams.showLabel)headerContainerStyle["justifyContent"]="flex-end"}else if(!renderParams.isSearchMode&&!renderParams.isExpandedMode)headerContainerStyle={height:0,minHeight:0};if(renderParams.hideSearchOnRecordLoad)headerContainerStyle={height:0,minHeight:0};headerContainerStyle["width"]="100%";var result=this.CreateElement("Container",{id:"headerContainer",key:"headerContainer",className:"mscrm-kbheaderContainer",style:headerContainerStyle},controlBlock);watermarkTelemetryEvent.End();return result};SearchHeaderView.prototype.buildIcon=function(renderParams,titleText,IconId,iconType,onClickFunction,accessibilityLabel,isExpanded){var _this=this;if(isExpanded===void 0)isExpanded=false;if(!titleText||iconType<0||!IconId||!onClickFunction)return;var buttonName=IconId+KbSearchControl.Constants.IconIdButtonPostfix,containerName=IconId+KbSearchControl.Constants.IconIdContainerPostfix,showDisabledIcon=KbSearchControl.Constants.SortIconId==IconId&&KbSearchControl.SearchType.MicrosoftSearch==renderParams.selectedSearchProvider.SearchType||KbSearchControl.Constants.FilterIconId==IconId&&MscrmControls.KbCommonUtils.SearchProviderType.MSSearchConnector==renderParams.selectedSearchProvider.SearchProviderType,iconElement=this.CreateElement("MICROSOFTICON",{id:IconId,key:IconId,type:iconType,style:{fontSize:"16px",color:!showDisabledIcon?"#000000":"#A19F9D"}}),iconButtonElement=this.CreateElement("BUTTON",{id:buttonName,key:buttonName,role:"button",style:{fontSize:renderParams.theming.fontsizes.font100,background:"transparent",borderColor:"transparent",color:"#333333",cursor:!showDisabledIcon?"pointer":"default",display:"flex",width:"36px",height:"36px",alignItems:"center",alignSelf:"center",justifyContent:"center",alignContent:"center",verticalAlign:"middle",padding:"0px",margin:"0px",border:"0px",":focus":{outline:!showDisabledIcon?"1px dotted #666666 !important;":""},":hover":{backgroundColor:!showDisabledIcon?renderParams.theming.colors.grays.gray02:""}},accessibilityLabel:accessibilityLabel,tabIndex:0,hidden:false,onClick:!showDisabledIcon?onClickFunction.bind(this):"",onPointerOver:function(e){return _this.FocusElementById(buttonName)},title:titleText,accessibilityExpanded:isExpanded},iconElement),iconContainer=this.CreateElement("Container",{id:containerName,key:containerName,style:{display:"inline-flex",margin:"0em",cursor:"pointer"}},iconButtonElement);return iconContainer};SearchHeaderView.prototype.makeSortOptionsLayout=function(renderParams){var _this=this;if(!renderParams.showSortList)return null;var optionsList=[];if(renderParams.searchType!=KbSearchControl.SearchType.MicrosoftSearch){var relevanceItem=this.createSortListItem(renderParams,KbSearchControl.KbSearchControlLocale.RelevanceLocale,KbSearchControl.Constants.RelevanceSortId),numberOfViewsListItem=this.createSortListItem(renderParams,KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale,KbSearchControl.Constants.NumberOfViewsLocaleSortId);optionsList.push(relevanceItem);optionsList.push(numberOfViewsListItem)}var lastModifiedDateItem=this.createSortListItem(renderParams,KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,KbSearchControl.Constants.LastModifiedDateNewestFirstLocaleSortId),lastModifiedDateOldestFirst=this.createSortListItem(renderParams,KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,KbSearchControl.Constants.LastModifiedDateOldestFirstLocaleSortId);optionsList.push(lastModifiedDateItem);optionsList.push(lastModifiedDateOldestFirst);var moreOptionsLayout=this.CreateElement("list",{key:"KM_sortOptionsList",role:"menu",tabIndex:0,style:{border:"1px solid #d8d8d8",boxShadow:"4px -4px 5px rgba(179,179,179,0.5)",color:renderParams.theming.colors.grays.gray02,fontSize:renderParams.theming.fontsizes.font085,flexDirection:"column",backgroundColor:renderParams.theming.colors.whitebackground,listStyleType:"none",display:"flex",cursor:"pointer",padding:"1em 0em"}},optionsList),menuFlyout=this.CreateElement("flyout",{key:"KM_sortOptionsFlyout",id:"KM_sortOptionsFlyout",flyoutDirection:7,positionType:"relative",relativeToElementId:"KM_sortIcon_Container",onOutsideClick:function(e){return _this.OnSortFlyoutOutsideClick(e)},tabIndex:0,focusElementId:KbSearchControl.Constants.RelevanceSortId,style:{display:"block",border:"10px solid #d8d8d8",listStyleType:"none",backgroundColor:renderParams.theming.colors.whitebackground,flexDirection:"column",minWidth:"12em",maxWidth:"26em",fontSize:renderParams.theming.fontsizes.font085,cursor:"pointer",padding:"1em 0em"}},moreOptionsLayout),sortElementContainer=this.CreateElement("Container",{id:"KM_sortOptionsContainer",key:"KM_sortOptionsContainer"},menuFlyout);return sortElementContainer};SearchHeaderView.prototype.createSortListItem=function(renderParams,title,id){var _this=this,selectedOption=renderParams.selectedSortOption;if(!title||!id)return null;var isSelectedOption=false;if(selectedOption&&selectedOption.Label)isSelectedOption=selectedOption.Label===title;var elementList=[],leftPadValue="1.2em",rightPadValue="1.2em";if(isSelectedOption){var iconElement=this.CreateElement("MICROSOFTICON",{id:"KM-saveascomplete",key:"KM-saveascomplete",type:109,style:{fontSize:renderParams.theming.fontsizes.font100,color:"#000000",":hover":{color:"#2266E3"}}});leftPadValue="0.2em";elementList.push(iconElement)}var labelElement=this.CreateElement("LABEL",{key:id+"_label",title:title,style:{cursor:"pointer",paddingLeft:renderParams.isRTL?"0px":leftPadValue,paddingRight:renderParams.isRTL?rightPadValue:"0px",display:"flex",wordBreak:"break-word",textOverflow:"ellipsis"}},title);elementList.push(labelElement);var itemContainer=this.CreateElement("Container",{id:"KM-SortFlyoutContainerId",key:"KM-SortFlyoutContainerId",style:{display:"flex",fontSize:renderParams.theming.fontsizes.font100,background:"transparent"}},elementList),item=this.CreateElement("listitem",{key:id,id:id,onClick:function(e){return _this.HandleSortFlyoutItemClick(e)},onKeyDown:function(e){return _this.HandleSortFlyoutItemClick(e)},role:"menuitem",onPointerOver:function(e){return _this.FocusElementById(id)},tabIndex:0,style:{fontSize:renderParams.theming.fontsizes.font085,padding:"0.5em 1em 0.5em 1em",display:"flex",color:"#333333",backgroundColor:renderParams.theming.colors.whitebackground,flexDirection:"column",cursor:"pointer",listStyleType:"none",border:"1px #d8d8d8",":hover":{backgroundColor:renderParams.theming.colors.grays.gray02},":focus":{outline:"1px dotted #666666 !important;",zIndex:1}}},itemContainer);return item};SearchHeaderView.prototype.makeSearchProvidersOptionsLayout=function(renderParams){var _this=this;if(!renderParams.showSearchProviderDropDown||renderParams.searchProviders.length<=0)return null;var optionsList=[],firstFocusableElementId;renderParams.searchProviders.forEach(function(searchProvider,currentMenuItemIndex,items){var isFirstFocusableFlyoutMenuItem=false,isLastFocusableFlyoutMenuItem=false;if(currentMenuItemIndex===0){firstFocusableElementId=items[0].SearchProviderId;isFirstFocusableFlyoutMenuItem=true}else if(currentMenuItemIndex===items.length-1)isLastFocusableFlyoutMenuItem=true;var previousIndex=(currentMenuItemIndex-1+items.length)%items.length,nextIndex=(currentMenuItemIndex+1)%items.length,previousFocusableFlyoutMenuItemId=items[previousIndex].SearchProviderId,nextFocusableFlyoutMenuItemId=items[nextIndex].SearchProviderId;optionsList.push(_this.createSearchProviderListItem(renderParams,searchProvider,isFirstFocusableFlyoutMenuItem,isLastFocusableFlyoutMenuItem,previousFocusableFlyoutMenuItemId,nextFocusableFlyoutMenuItemId))});var moreOptionsLayout=this.CreateElement("list",{id:"KM_SearchProvider_OptionsList",key:"KM_SearchProvider_OptionsList",role:"menu",style:{backgroundColor:renderParams.theming.colors.whitebackground,display:"flex",flexDirection:"column",cursor:"pointer",border:renderParams.theming.borders.border02}},optionsList),beginningCloseMenuButton=this.createHiddenCloseButton(renderParams,"beginning"),endCloseMenuButton=this.createHiddenCloseButton(renderParams,"end"),menuFlyout=this.CreateElement("flyout",{key:"KM_SearchProvider_Flyout",id:"KM_SearchProvider_Flyout",flyoutDirection:7,positionType:"relative",relativeToElementId:"KM-SearchProviderTextAndDropDownContainer",onOutsideClick:function(e){return _this.OnSearchProviderFlyoutOutsideClick(e)},focusElementId:firstFocusableElementId,style:{backgroundColor:renderParams.theming.colors.whitebackground}},[beginningCloseMenuButton,moreOptionsLayout,endCloseMenuButton]),searchProviderElementContainer=this.CreateElement("Container",{id:"KM_SearchProvider_Flyout_Container",key:"KM_SearchProvider_Flyout_Container"},menuFlyout);return searchProviderElementContainer};SearchHeaderView.prototype.createSearchProviderListItem=function(renderParams,searchProvider,isFirstFocusableItemTarget,isLastFocusableItemTarget,previousFocusableFlyoutMenuItemId,nextFocusableFlyoutMenuItemId){var _this=this,selectedOption=renderParams.selectedSearchProvider,searchProviderName=searchProvider.Name,searchProviderId=searchProvider.SearchProviderId;if(!searchProviderName||!searchProviderId)return null;var isSelectedOption=false;if(selectedOption&&selectedOption.SearchProviderId)isSelectedOption=selectedOption.SearchProviderId===searchProviderId;var elementList=[],leftPadValue=renderParams.theming.measures.measure150;if(isSelectedOption){var iconElement=this.CreateElement("MICROSOFTICON",{id:"KM-selectedSearchProvider-icon-"+searchProviderId,key:"KM-selectedSearchProvider-icon-"+searchProviderId,type:109,accessibilityHidden:true,style:{width:renderParams.theming.measures.measure100,height:renderParams.theming.measures.measure100,left:renderParams.theming.measures.measure050,fontSize:renderParams.theming.fontsizes.font100,lineHeight:renderParams.theming.measures.measure125,color:renderParams.theming.colors.grays.gray07}});leftPadValue=renderParams.theming.measures.measure050;elementList.push(iconElement)}var labelElement=this.CreateElement("LABEL",{key:searchProviderId+"_label",title:searchProviderName,accessibilityHidden:true,style:{cursor:"pointer",paddingLeft:!renderParams.isRTL?leftPadValue:"",paddingRight:renderParams.isRTL?leftPadValue:"",display:"inline-block",width:"100%",maxWidth:renderParams.theming.measures.measure900,minWidth:renderParams.theming.measures.measure550,fontFamily:renderParams.theming.fontfamilies.regular,fontStyle:"normal",fontWeight:"normal",fontSize:renderParams.theming.fontsizes.font085,lineHeight:renderParams.theming.measures.measure125,color:renderParams.theming.colors.grays.gray07,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},searchProviderName),totalCount=searchProvider.IsLoading?"-":searchProvider.SearchResult.TotalCount<=9999?searchProvider.SearchResult.TotalCount:"9999+",totalCountElement=this.CreateElement("LABEL",{key:searchProviderId+"_count",title:totalCount,accessibilityHidden:true,style:{cursor:"pointer",paddingLeft:!renderParams.isRTL?renderParams.theming.measures.measure100:"",paddingRight:renderParams.isRTL?renderParams.theming.measures.measure100:"",display:"inline-block",flexDirection:"row-reverse",width:renderParams.theming.measures.measure300,fontFamily:renderParams.theming.fontfamilies.regular,fontStyle:"normal",fontWeight:"normal",fontSize:renderParams.theming.fontsizes.font085,lineHeight:renderParams.theming.measures.measure125,textAlign:"right",color:renderParams.theming.colors.grays.gray05}},"("+totalCount+")");elementList.push(labelElement);elementList.push(totalCountElement);var itemContainer=this.CreateElement("Container",{id:"KM-SearchProvider-Flyout-ContainerId-"+searchProviderId,key:"KM-SearchProvider-Flyout-ContainerId-"+searchProviderId,style:{display:"flex",fontSize:renderParams.theming.fontsizes.font100,background:"transparent"},accessibilityHidden:false},elementList),accessibilityLabelListItem=searchProvider.IsLoading?MscrmCommon.ControlUtils.String.Format(renderParams.resources.getString(KbSearchControl.Constants.SearchProviderDropdownLoadingResults),searchProviderName):MscrmCommon.ControlUtils.String.Format(renderParams.resources.getString(KbSearchControl.Constants.SearchProviderDropdownResultsFound),searchProviderName,totalCount),item=this.CreateElement("listitem",{key:searchProviderId,id:searchProviderId,role:"menuitem",tabIndex:0,accessibilityLabel:accessibilityLabelListItem,onClick:function(event){return _this.HandleSearchProviderFlyoutItemClick(event)},onKeyDown:function(event){return _this.onKeyDownForFlyoutMenuItem(event,renderParams,isFirstFocusableItemTarget,isLastFocusableItemTarget,previousFocusableFlyoutMenuItemId,nextFocusableFlyoutMenuItemId)},style:{padding:renderParams.theming.measures.measure050,display:"flex",flexDirection:"column",cursor:"pointer",listStyleType:"none",":hover":{backgroundColor:renderParams.theming.colors.grays.gray01}}},itemContainer);return item};SearchHeaderView.prototype.createHiddenCloseButton=function(renderParams,uniqueKeySuffix){var _this=this;return this.CreateElement("Button",{key:"KM_SearchProvider_flyoutMenuCloseButton_"+uniqueKeySuffix,tabIndex:-1,accessibilityLabel:MscrmCommon.ControlUtils.String.Format(renderParams.resources.getString(KbSearchControl.Constants.FlyoutMenuCloseButton),"Search Provider"),onClick:function(event){return _this.OnSearchProviderFlyoutOutsideClick(event)},style:{position:"absolute",top:"-10px",height:"5px",width:"5px",opacity:"none"}})};SearchHeaderView.prototype.onKeyDownForFlyoutMenuItem=function(event,renderParams,isFirstFocusableItemTarget,isLastFocusableItemTarget,previousFocusableFlyoutMenuItemId,nextFocusableFlyoutMenuItemId){if(event.type===KbSearchControl.Constants.KeyDownEventType){if(event.shiftKey&&event.keyCode===KbSearchControl.Constants.TabKeyCode)if(isFirstFocusableItemTarget){this.OnSearchProviderFlyoutOutsideClick(event);event.preventDefault();event.stopPropagation();return true}if(!event.shiftKey&&event.keyCode===KbSearchControl.Constants.TabKeyCode)if(isLastFocusableItemTarget){this.OnSearchProviderFlyoutOutsideClick(event);event.preventDefault();event.stopPropagation();return true}if(event.keyCode===KbSearchControl.Constants.EscapeKeyCode){this.OnSearchProviderFlyoutOutsideClick(event);event.preventDefault();event.stopPropagation();return true}if(event.keyCode===KbSearchControl.Constants.UpArrowKeyCode){this.FocusElementById(previousFocusableFlyoutMenuItemId);event.preventDefault();event.stopPropagation();return true}if(event.keyCode===KbSearchControl.Constants.DownArrowKeyCode){this.FocusElementById(nextFocusableFlyoutMenuItemId);event.preventDefault();event.stopPropagation();return true}if(event.keyCode===KbSearchControl.Constants.EnterKey){this.HandleSearchProviderFlyoutItemClick(event);event.preventDefault();event.stopPropagation();return true}if(event.type===KbSearchControl.Constants.KeyDownEventType&&!(event.keyCode===KbSearchControl.Constants.EnterKeyCode||event.keyCode===KbSearchControl.Constants.SpaceKeyCode))return true}return false};return SearchHeaderView}(KbSearchControl.SearchView);KbSearchControl.SearchHeaderView=SearchHeaderView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultActionView=function(_super){__extends(SearchResultActionView,_super);function SearchResultActionView(){return _super!==null&&_super.apply(this,arguments)||this}SearchResultActionView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.ToggleSearchResultActionMenu=initParams.ToggleSearchResultActionMenu;this.HandleSearchResultActionClick=initParams.HandleSearchResultActionClick;this.HandleSearchResultActionKeyDown=initParams.HandleSearchResultActionKeyDown;this.HandleMenuFlyoutKeyDown=initParams.HandleMenuFlyoutKeyDown;this.HandleMenuFlyoutOptionKeyDown=initParams.HandleMenuFlyoutOptionKeyDown;return this};SearchResultActionView.prototype.render=function(renderParams,kbSearchRecord,describedByElementId,isResultView){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"render");this.renderActionFlags=[];var controlBlock=[],articleActions=this.GetKbSearchResult(renderParams,kbSearchRecord).articleActions;if(articleActions.length==0)return null;articleActions&&articleActions.length>0&&controlBlock.push(this.renderInlineActions(renderParams,kbSearchRecord,describedByElementId,articleActions,isResultView));articleActions.length-this.renderActionFlags.length>0&&controlBlock.push(this.renderMenuFlyout(renderParams,kbSearchRecord,describedByElementId,articleActions));var id,key,className,style;if(!isResultView&&renderParams.isExpandedMode){if(renderParams.isSearchMode)style={width:"100%",display:"flex",maxHeight:renderParams.theming.measures.measure150};else{style={width:"100%",display:"flex"};if(!renderParams.isReferencePanel)style.height=renderParams.theming.measures.measure275}className="mscrm-searchResultActionsDropdown";id="searchResultActionsDropdown_"+kbSearchRecord.knowledgeArticleId.toString();key="searchResultActionsDropdown"}else{var styleClass=renderParams.isSearchMode||renderParams.isExpandedMode?"actions-container-standardmode-UIEnhancements":"actions-container-non-searchmode-UIEnhancements";className="mscrm-searchResultActionsDropdown "+styleClass;style={};id="searchResultActionsDropdown_UIEnhancement_"+kbSearchRecord.knowledgeArticleId.toString();key="searchResultActionsDropdown_UIEnhancement"}var result=this.CreateElement("CONTAINER",{id:id,key:key,className:className,style:style},controlBlock);watermarkTelemetryEvent.End();return result};SearchResultActionView.prototype.renderInlineActions=function(renderParams,kbSearchRecord,describedByElementId,articleActions,isResultView){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"renderInlineActions"),childrenActions=[],scrollingDataBlockContainerId=KbSearchControl.Constants.SearchAndDataBlockContainerId,scrollingDataBlockContainer=document.getElementById(this.GetUniqueId(scrollingDataBlockContainerId)),id,key,styleClass;if(!isResultView&&renderParams.isExpandedMode){!scrollingDataBlockContainer&&renderParams.ResetAdditionalRendering();for(var i=0;i<articleActions.length;i++){var actionId=articleActions[i],actionContainer=this.renderActionContainer(renderParams,kbSearchRecord,describedByElementId,actionId,articleActions);childrenActions.push(actionContainer);this.renderActionFlags[i]=true}id="searchResultActionsDropdownInlineActions_"+kbSearchRecord.knowledgeArticleId.toString();key="searchResultActionsDropdownInlineActions"}else{var totalAvailableSpace=0;if(!scrollingDataBlockContainer||scrollingDataBlockContainer.offsetParent==null)renderParams.ResetAdditionalRendering();else totalAvailableSpace=scrollingDataBlockContainer.offsetWidth;totalAvailableSpace-=parseFloat(renderParams.theming.fontsizes.font100)*3.5;for(var numberOfInlineActions=renderParams.isLoadedInProductivityPanel?1:renderParams.isSearchMode?Math.min(articleActions.length,3):articleActions.length,i=0;i<numberOfInlineActions;i++){var actionId=articleActions[i],actionLabel=this.GetString(this.getArticleActionToLabelNameMapping(renderParams,actionId)),actionWidth=this.spaceAvailableForActionTitle(renderParams,actionLabel,i==0?true:false);if(totalAvailableSpace-actionWidth>=0){var actionButton=this.renderActionIconButton(renderParams,kbSearchRecord,describedByElementId,actionId,articleActions);childrenActions.push(actionButton);this.renderActionFlags[i]=true;totalAvailableSpace-=actionWidth}else break}styleClass=renderParams.isSearchMode||renderParams.isExpandedMode?"actions-container-standardmode-UIEnhancements":"actions-container-non-searchmode-UIEnhancements";id="searchResultActionsDropdownInlineActions_UIEnhancement_"+kbSearchRecord.knowledgeArticleId.toString();key="searchResultActionsDropdownInlineActions_UIEnhancement"}var result=this.CreateElement("CONTAINER",{id:id,key:key,className:styleClass},childrenActions);watermarkTelemetryEvent.End();return result};SearchResultActionView.prototype.renderActionIconButton=function(renderParams,kbSearchRecord,describedByElementId,articleActionId,articleActions){var _this=this,watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"renderAction "+articleActionId),actionPosition=articleActions.indexOf(articleActionId),actionTooltip=this.GetLocalizedActionTooltip(renderParams,articleActionId),actionLabel=this.GetString(this.getArticleActionToLabelNameMapping(renderParams,articleActionId)),actionLabelPrefix="Actions-SearchResult-",style={display:"flex",border:"none",margin:0,padding:"0px 4px",fontSize:renderParams.theming.fontsizes.font115,color:"buttontext",backgroundColor:"transparent",cursor:"pointer"};if(renderParams.isSearchMode&&(renderParams.isReferencePanel||renderParams.isLoadedInProductivityPanel)){if(actionPosition===0)style.padding=renderParams.isRTL?"0px 0px 0px 4px":"0px 4px 0px 0px";else if(actionPosition===articleActions.length-1)style.padding=renderParams.isRTL?"0px 4px 0px 0px":"0px 0px 0px 4px"}else if(!renderParams.isExpandedMode){style.padding="8px";style.color=MscrmControls.KbCommonUtils.Constants.COLOR_ACTION_ICON;actionLabelPrefix="Actions-NonSearchMode-"}var actionIconId=actionLabelPrefix+"UIEnhancements-"+actionPosition+"-"+kbSearchRecord.knowledgeArticleId.toString(),actionBtnProps={id:actionIconId,key:actionIconId,style:style,title:actionTooltip,accessibilityLabel:actionLabel,describedByElementId:describedByElementId,onClick:function(event){_this.HandleSearchResultActionClick.bind(_this);_this.HandleSearchResultActionClick(event,articleActionId,kbSearchRecord)},onKeyDown:function(event){_this.HandleSearchResultActionKeyDown.bind(_this);_this.HandleSearchResultActionKeyDown(event,articleActionId,kbSearchRecord)}},actionBtnIcon=this.CreateElement("MICROSOFTICON",{type:this.GetMicrosoftSymbolIconByArticleActionId(renderParams,articleActionId),key:actionIconId}),actionButton=this.CreateElement("button",actionBtnProps,[actionBtnIcon]);watermarkTelemetryEvent.End();return actionButton};SearchResultActionView.prototype.renderActionContainer=function(renderParams,kbSearchRecord,describedByElementId,articleActionId,articleActions){var _this=this,additionalTelemetryEventParameters=[{name:"articleActionId",value:""+articleActionId}],watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"renderActionContainer",additionalTelemetryEventParameters),actionPosition=articleActions.indexOf(articleActionId),actionIcon=this.renderArticleActionIcon(renderParams,kbSearchRecord,articleActionId,actionPosition==0,actionPosition==1),actionTitle=this.renderActionTitle(renderParams,kbSearchRecord,articleActionId,articleActions,true),searchResultActionsDropdownActionLabel=this.GetString(this.getArticleActionToLabelNameMapping(renderParams,articleActionId)),searchResultActionsDropdownActionTooltip=this.GetLocalizedActionTooltip(renderParams,articleActionId),style;if(renderParams.isSearchMode){style={display:"inline-flex",cursor:"pointer",color:"#333333",":hover":{color:MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION}};if(!renderParams.isReferencePanel)style.height="100%"}else{style={display:"inline-flex",cursor:"pointer",color:"#333333",":hover":{backgroundColor:MscrmControls.KbCommonUtils.Constants.BGCOLOR_ACTION}};if(renderParams.isReferencePanel){style.paddingTop=renderParams.theming.measures.measure050;style.paddingBottom=renderParams.theming.measures.measure050}else style.height="100%"}var actionContainer=this.CreateElement("CONTAINER",{id:"searchResultActionsDropdown_"+actionPosition+"_Action_"+kbSearchRecord.knowledgeArticleId.toString(),key:"searchResultActionsDropdownAction",style:style,tabIndex:0,role:"button",title:searchResultActionsDropdownActionTooltip,accessibilityLabel:searchResultActionsDropdownActionLabel,describedByElementId:describedByElementId,onKeyDown:function(event){_this.HandleSearchResultActionKeyDown(event,articleActionId,kbSearchRecord)},onClick:function(event){_this.HandleSearchResultActionClick.bind(_this);_this.HandleSearchResultActionClick(event,articleActionId,kbSearchRecord)}},[actionIcon,actionTitle]);watermarkTelemetryEvent.End();return actionContainer};SearchResultActionView.prototype.GetKbSearchResult=function(renderParams,kbSearchRecord){var matchingKbSearchResultCollection=renderParams.kbSearchResultCollection.filter(function(kbSearchResult){return kbSearchResult.kbSearchRecord.knowledgeArticleId===kbSearchRecord.knowledgeArticleId});if(matchingKbSearchResultCollection.length>0)return matchingKbSearchResultCollection[0];return null};SearchResultActionView.prototype.renderMenuFlyout=function(renderParams,kbSearchRecord,describedByElementId,articleActions){var _this=this,watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"renderMenuFlyout"),containerChildren=[],kbSearchResult=this.GetKbSearchResult(renderParams,kbSearchRecord),style={display:"inline-flex",alignItems:"center",borderLeft:0,borderRight:0},onClickHandler=!kbSearchResult.isMenuVisible?function(event){event.stopPropagation();event.preventDefault();_this.ToggleSearchResultActionMenu.bind(_this);return _this.ToggleSearchResultActionMenu(kbSearchResult)}:function(event){},menuFlyoutButtonIconId="microsoftIcon_menuFlyoutButton_"+kbSearchRecord.knowledgeArticleId.toString(),menuFlyoutButtonIcon=this.CreateElement("MICROSOFTICON",{id:menuFlyoutButtonIconId,key:menuFlyoutButtonIconId,role:"button",accessibilityExpanded:kbSearchResult.isMenuVisible,accessibilityHasPopup:true,tabIndex:0,style:{":hover":{color:MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION}},accessibilityLabel:KbSearchControl.KbSearchControlLocale.MoreActionsText,onKeyDown:function(event){return _this.HandleMenuFlyoutKeyDown(event,kbSearchResult,_this.renderActionFlags.length)},hidden:false,onClick:onClickHandler,type:MscrmControls.KbCommonUtils.IconSymbolCode.More}),menuFlyoutButtonContainer=this.CreateElement("Container",{id:"menuFlyoutButtonContainer_"+kbSearchRecord.knowledgeArticleId.toString(),key:"menuFlyoutButtonContainer",style:{display:"inline-flex",marginTop:renderParams.theming.measures.measure025,marginBottom:renderParams.theming.measures.measure025,marginLeft:renderParams.theming.measures.measure050,marginRight:renderParams.theming.measures.measure050,backgroundColor:"transparent",cursor:"pointer",fontSize:renderParams.theming.fontsizes.font115}},menuFlyoutButtonIcon);containerChildren.push(menuFlyoutButtonContainer);if(kbSearchResult.isMenuVisible&&!renderParams.popupEnabled){var dropdownChildren_1=[],actionIndex_1=this.renderActionFlags.length;articleActions.map(function(currentAction){if(articleActions.length-actionIndex_1>0&&currentAction===articleActions[actionIndex_1]){var menuFlyoutActionIcon=_this.renderArticleActionIcon(renderParams,kbSearchRecord,currentAction,false,false,true),menuFlyoutActionTitle=_this.renderActionTitle(renderParams,kbSearchRecord,currentAction,articleActions),flyoutOptionId="flyout_"+_this.getUniqueActionId(renderParams,kbSearchRecord.knowledgeArticleId,actionIndex_1),searchResultActionsDropdownActionLabel=_this.GetString(_this.getArticleActionToLabelNameMapping(renderParams,currentAction)),searchResultActionsDropdownActionTooltip=_this.GetLocalizedActionTooltip(renderParams,currentAction),menuFlyoutAction=_this.CreateElement("CONTAINER",{id:flyoutOptionId,key:flyoutOptionId,style:{boxSizing:"border-box",paddingLeft:renderParams.theming.measures.measure100,paddingRight:renderParams.theming.measures.measure100,paddingBottom:renderParams.theming.measures.measure050,paddingTop:renderParams.theming.measures.measure050,"float":"left",width:"100%",cursor:"pointer",":hover":{color:MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION,backgroundColor:MscrmControls.KbCommonUtils.Constants.BGCOLOR_ACTION}},onClick:function(event){_this.HandleSearchResultActionClick.bind(_this);return _this.HandleSearchResultActionClick(event,currentAction,kbSearchRecord)},onKeyDown:function(event){_this.HandleMenuFlyoutOptionKeyDown.bind(_this);return _this.HandleMenuFlyoutOptionKeyDown(event,articleActions.indexOf(currentAction),currentAction,kbSearchRecord,articleActions)},tabIndex:0,role:"button",title:searchResultActionsDropdownActionTooltip,accessibilityLabel:searchResultActionsDropdownActionLabel,describedByElementId:describedByElementId},[menuFlyoutActionIcon,menuFlyoutActionTitle]);dropdownChildren_1.push(menuFlyoutAction);actionIndex_1+=1}});var dropdownChildrenDiv=this.CreateElement("CONTAINER",{id:"MenuFlyoutChildrenContainer_"+kbSearchRecord.knowledgeArticleId.toString(),key:"MenuFlyoutChildrenContainer",style:{width:renderParams.theming.measures.measure1075,paddingRight:0,paddingLeft:0,boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.15)",border:renderParams.theming.borders.border02,backgroundColor:"white",alignItems:"flex-start",flexDirection:"column"},":hover":{color:MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION},className:"mscrm-MenuFlyoutContainer"},dropdownChildren_1),_a=renderParams.theming,textbox=_a.textbox,solidborderstyle=_a.solidborderstyle,flyoutStyle={borderColor:"white",borderLeftWidth:textbox.linethickness,borderRightWidth:textbox.linethickness,borderBottomWidth:textbox.linethickness,borderTopWidth:"0px",backgroundColor:"white",display:"flex"},flyout=this.CreateElement("FLYOUT",{id:"searchResultActionsDropdownMenuFlyout_"+kbSearchRecord.knowledgeArticleId.toString(),key:"searchResultActionsDropdownMenuFlyout",relativeToElementId:menuFlyoutButtonIconId,onOutsideClick:function(event){_this.ToggleSearchResultActionMenu.bind(_this);return _this.ToggleSearchResultActionMenu(kbSearchResult)},positionType:"relative",size:{minWidth:210,maxHeight:300},flyoutDirection:7,flyoutStyle:flyoutStyle},dropdownChildrenDiv);containerChildren.push(flyout)}var result=this.CreateElement("CONTAINER",{id:"MenuFlyoutContainer_"+kbSearchRecord.knowledgeArticleId.toString(),key:"MenuFlyoutContainer",style:style,className:"mscrm-MenuFlyoutContainer"},containerChildren);watermarkTelemetryEvent.End();return result};SearchResultActionView.prototype.renderArticleActionIcon=function(renderParams,kbSearchRecord,currentAction,firstAction,secondAction,flyoutAction){if(firstAction===void 0)firstAction=false;if(secondAction===void 0)secondAction=false;if(flyoutAction===void 0)flyoutAction=false;var prefixString;if(!flyoutAction)prefixString="_inlineArticleAction_";else prefixString="_flyoutArticleAction_";var menuActionIconId="microsoftIcon"+prefixString+kbSearchRecord.knowledgeArticleId.toString()+"_"+currentAction+"_",searchResultActionsDropdownActionTooltip=this.GetLocalizedActionTooltip(renderParams,currentAction),style;if(firstAction)style={display:"inline-flex",fontSize:renderParams.theming.fontsizes.font115,paddingRight:renderParams.isRTL?renderParams.isSearchMode?"0rem":renderParams.theming.measures.measure050:renderParams.theming.measures.measure050,paddingLeft:renderParams.isRTL?renderParams.theming.measures.measure050:renderParams.isSearchMode?"0rem":renderParams.theming.measures.measure050,paddingTop:renderParams.theming.measures.measure015};else if(secondAction)style={display:"inline-flex",fontSize:renderParams.theming.fontsizes.font115,paddingRight:renderParams.theming.measures.measure050,paddingLeft:renderParams.theming.measures.measure050,paddingTop:renderParams.theming.measures.measure015};else style={display:"inline-flex",fontSize:renderParams.theming.fontsizes.font115,paddingLeft:renderParams.isRTL?renderParams.theming.measures.measure050:0,paddingRight:renderParams.isRTL?0:renderParams.theming.measures.measure050,paddingTop:renderParams.theming.measures.measure015};if(!renderParams.isReferencePanel&&!renderParams.isLoadedInProductivityPanel)style.margin="auto";if(!renderParams.isSearchMode)style.color=MscrmControls.KbCommonUtils.Constants.COLOR_ACTION_ICON;var menuFlyoutActionIcon=this.CreateElement("MICROSOFTICON",{id:menuActionIconId,key:menuActionIconId,accessibilityHidden:true,role:"presentation",tabIndex:-1,title:searchResultActionsDropdownActionTooltip,style:{":hover":{color:MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION}},hidden:false,type:this.GetMicrosoftSymbolIconByArticleActionId(renderParams,currentAction)});return this.CreateElement("Container",{id:"menuActionIconContainer_"+menuActionIconId,key:"menuActionIconContainer_"+menuActionIconId,style:style},menuFlyoutActionIcon)};SearchResultActionView.prototype.renderActionTitle=function(renderParams,kbSearchRecord,currentAction,articleActions,inlineAction){if(inlineAction===void 0)inlineAction=false;var actionTitleId=this.getUniqueActionId(renderParams,kbSearchRecord.knowledgeArticleId,currentAction),searchResultActionsDropdownActionLabel=this.GetString(this.getArticleActionToLabelNameMapping(renderParams,currentAction));if(inlineAction)return this.CreateElement("LABEL",{id:actionTitleId,key:actionTitleId,role:"button",tabIndex:-1,style:{fontSize:renderParams.theming.fontsizes.font100,paddingLeft:renderParams.isRTL?renderParams.theming.measures.measure050:0,paddingRight:renderParams.isRTL?0:renderParams.theming.measures.measure050,cursor:"pointer",margin:!renderParams.isReferencePanel?"auto":"initial"}},searchResultActionsDropdownActionLabel);else return this.CreateElement("LABEL",{id:actionTitleId,key:actionTitleId,role:"menuitem",tabIndex:-1,style:{fontSize:renderParams.theming.fontsizes.font100,cursor:"pointer"}},searchResultActionsDropdownActionLabel)};SearchResultActionView.prototype.GetMicrosoftSymbolIconByArticleActionId=function(renderParams,actionId){return MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.GetSymbolCode(actionId)};SearchResultActionView.prototype.getUniqueActionId=function(renderParams,knowledgeArticleId,actionPosition){return "actionItem_"+actionPosition+"_"+knowledgeArticleId};SearchResultActionView.prototype.GetLocalizedActionTooltip=function(renderParams,action){if(action==MscrmControls.KbCommonUtils.ArticleAction.EmailArticle||action==MscrmControls.KbCommonUtils.ArticleAction.EmailArticleContent)return MscrmCommon.ControlUtils.String.Format(this.GetString(this.getArticleActionToTooltipNameMapping(renderParams,action)),renderParams.entityDisplayName);return this.GetString(this.getArticleActionToTooltipNameMapping(renderParams,action))};SearchResultActionView.prototype.getArticleActionToLabelNameMapping=function(renderParams,articleAction){return MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.GetLabel(articleAction)};SearchResultActionView.prototype.getArticleActionToTooltipNameMapping=function(renderParams,articleAction){return MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.GetTooltip(articleAction)};SearchResultActionView.prototype.spaceAvailableForActionTitle=function(renderParams,actionTitle,firstAction){var remToPixelConversion=parseFloat(renderParams.theming.fontsizes.font100),spaceAvailable=parseFloat(renderParams.theming.fontsizes.font115)+remToPixelConversion;if(firstAction)spaceAvailable+=.75*remToPixelConversion;else spaceAvailable+=1.25*remToPixelConversion;var hiddenActionSpan=this.getHiddenActionSpan();if(hiddenActionSpan!=null){hiddenActionSpan.text(actionTitle);spaceAvailable+=hiddenActionSpan.width()}return spaceAvailable};SearchResultActionView.prototype.getHiddenActionSpan=function(){var hiddenActionUniqueId=this.GetUniqueId("hiddenActionid"),hiddenActionSpan=$(document.getElementById(hiddenActionUniqueId));if(!(hiddenActionSpan instanceof Element))hiddenActionSpan=null;return hiddenActionSpan};return SearchResultActionView}(KbSearchControl.SearchView);KbSearchControl.SearchResultActionView=SearchResultActionView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchControlView=function(_super){__extends(SearchControlView,_super);function SearchControlView(){return _super!==null&&_super.apply(this,arguments)||this}SearchControlView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.searchBoxView=new KbSearchControl.SearchBoxContainerView;this.searchBoxView=this.searchBoxView.init(initParams);this.searchActionsView=new KbSearchControl.SearchActionsView;this.searchActionsView.init(initParams);this.searchResultView=new KbSearchControl.SearchResultView;this.searchResultView.init(initParams);this.searchHeaderView=new KbSearchControl.SearchHeaderView;this.searchHeaderView.init(initParams);this.searchFilterView=new KbSearchControl.SearchFilterView;this.searchFilterView.init(initParams);this.searchResultInfoView=new KbSearchControl.SearchResultInfoView;this.searchResultInfoView.init(initParams);this.searchErrorView=new KbSearchControl.SearchErrorView;this.searchErrorView.init(initParams);this.searchLoadingView=new KbSearchControl.SearchLoadingView;this.searchLoadingView.init(initParams);return this};SearchControlView.prototype.overrideReferencePanelMaxHeight=function(renderParams){var _this=this;setTimeout(function(){var searchContainerID=_this.GetUniqueId("searchControlContainer"),searchContainer=$("#"+searchContainerID.replace(/\./g,"\\."));searchContainer.parent().css("max-height","none");var refpanelcontainer=searchContainer.closest("[id*='ReferencePanelContainer']");refpanelcontainer&&refpanelcontainer.length>0&&refpanelcontainer.css("height","inherit");var refPanelSessionandContent=searchContainer.closest("[id*='ReferencePanelSessionAndContent']");refPanelSessionandContent&&refPanelSessionandContent.length>0&&refPanelSessionandContent.css("height","100%")})};SearchControlView.prototype.renderResultsAccessibilityContainer=function(renderParams){return this.CreateElement("Container",{id:"resultAccessibilityContainer",key:"resultAccessibilityContainer",accessibilityLive:"assertive",accessibilityAtomic:"true",accessibilityRelevant:"all",style:{height:"0",width:"0",overflow:"hidden"}},renderParams.kbSearchResultAccessibilityText)};SearchControlView.prototype.renderErrorResultsAccessibilityContainer=function(renderParams){return this.CreateElement("Container",{id:"errorResultAccessibilityContainer",key:"errorResultAccessibilityContainer",accessibilityLive:"assertive",accessibilityAtomic:"true",accessibilityRelevant:"all",style:{height:"0",width:"0",overflow:"hidden"}},renderParams.formattedErrorMessage)};SearchControlView.prototype.renderArticleAndContentControl=function(renderParams,dataBlock){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchControl,"renderArticleAndContentControl");dataBlock.push(this.searchActionsView.render(renderParams));dataBlock.push(renderParams.kbSearchResultArticleInfoObject.render());dataBlock.push(renderParams.kbSearchResultContentPaneObject.render());this.overrideReferencePanelMaxHeight(renderParams);watermarkTelemetryEvent.End()};return SearchControlView}(KbSearchControl.SearchView);KbSearchControl.SearchControlView=SearchControlView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultFooterView=function(_super){__extends(SearchResultFooterView,_super);function SearchResultFooterView(){return _super!==null&&_super.apply(this,arguments)||this}SearchResultFooterView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.HandleLoadMoreButtonClick=initParams.HandleLoadMoreButtonClick;this.HandleLoadMoreButtonKeyDown=initParams.HandleLoadMoreButtonKeyDown;return this};SearchResultFooterView.prototype.render=function(renderParams){var _this=this,watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchControl,"renderSearchResultFooter");if(!renderParams.showLoadMoreButton){watermarkTelemetryEvent.End();return}var loadMoreButton=this.CreateElement("Label",{key:"loadMoreLabel",id:"loadMoreLabel",className:"mscrm-loadMoreLabel",style:{width:"100%",whiteSpace:"nowrap",fontSize:renderParams.theming.fontsizes.font100,color:renderParams.theming.colors.base.blue,marginTop:renderParams.theming.measures.measure100,paddingLeft:renderParams.isReferencePanel&&!renderParams.isRTL?0:renderParams.theming.measures.measure100,paddingRight:renderParams.theming.measures.measure100},role:"link",onClick:function(e){return _this.HandleLoadMoreButtonClick(e)},onKeyDown:function(e){return _this.HandleLoadMoreButtonKeyDown(e)},tabIndex:0,accessibilityLabel:KbSearchControl.KbSearchControlLocale.LoadMoreButtonLocale},KbSearchControl.KbSearchControlLocale.LoadMoreButtonLocale);loadMoreButton.getProperties().style.color="#3B79B7";loadMoreButton.getProperties().style[":hover"]={cursor:"pointer",color:"#2E5FA4"};var result=this.CreateElement("Container",{id:"loadMoreButtonContainer",key:"loadMoreButtonContainer",style:{height:renderParams.theming.measures.measure225,display:"inline-block",marginTop:"8px"}},loadMoreButton);watermarkTelemetryEvent.End();return result};return SearchResultFooterView}(KbSearchControl.SearchView);KbSearchControl.SearchResultFooterView=SearchResultFooterView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultInfoView=function(_super){__extends(SearchResultInfoView,_super);function SearchResultInfoView(){return _super!==null&&_super.apply(this,arguments)||this}SearchResultInfoView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.HandleSearchProviderDropDownClick=initParams.HandleSearchProviderDropDownClick;return this};SearchResultInfoView.prototype.render=function(renderParams){var filterContainer=[],resultCountAndSortFilterStyle={display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"baseline",justifyContent:"space-between",boxSizing:"border-box"};resultCountAndSortFilterStyle["width"]="100%";resultCountAndSortFilterStyle["alignSelf"]=renderParams.isExpandedMode?"baseline":"auto";resultCountAndSortFilterStyle["paddingBottom"]=renderParams.isFederatedSearchEnabled?renderParams.theming.measures.measure025:renderParams.isExpandedMode?renderParams.theming.measures.measure075:renderParams.theming.measures.measure050;if(!renderParams.searchHasBeenPerformed||!renderParams.totalCount)resultCountAndSortFilterStyle["justifyContent"]="flex-start";if(!renderParams.isLoading){var resultCount=this.renderResultsCount(renderParams);filterContainer.push(resultCount)}renderParams.isFederatedSearchEnabled&&renderParams.searchHasBeenPerformed&&filterContainer.push(this.renderSelectedSearchProviderWithDropdownIcon(renderParams));return this.CreateElement("Container",{id:"resultCountAndSortFilterDivId",key:"resultCountAndSortFilterDiv",style:resultCountAndSortFilterStyle,className:"mscrm-resultCountAndSortFilterContainer"},filterContainer)};SearchResultInfoView.prototype.renderResultsCount=function(renderParams){if(!renderParams.searchHasBeenPerformed||!renderParams.isExternalSearchIndexEnabled&&!renderParams.records||renderParams.isExternalSearchIndexEnabled&&!renderParams.relevanceSearchRecordCollection)return this.CreateElement("Container",{id:"resultsContainer",style:{display:"inline-block",whiteSpace:"nowrap",marginLeft:renderParams.isRTL?renderParams.theming.measures.measure100:0,marginRight:renderParams.isRTL?0:renderParams.theming.measures.measure100,marginTop:0}});var resultsFoundText,resultCount=0;if(!renderParams.isExternalSearchIndexEnabled&&renderParams.records||renderParams.isExternalSearchIndexEnabled&&renderParams.relevanceSearchRecordCollection){if(renderParams.isExternalSearchIndexEnabled&&renderParams.relevanceSearchMode===1)if(renderParams.selectedSearchProvider.canCallRelevanceSearch)if(renderParams.relevanceSearchRecords)resultCount=renderParams.relevanceSearchRecords.totalCount;else resultCount=0;else resultCount=renderParams.selectedSearchProvider.SearchResult.KbRelevanceSearchRecordCollection.length;else resultCount=renderParams.totalCount;resultsFoundText=MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.NumberOfResultsFoundText,resultCount)}renderParams.kbSearchResultAccessibilityText=resultsFoundText;var resultsLabel=this.CreateElement("label",{id:"resultsFoundTextId",ref:"resultsFoundText",accessibilityLabel:resultsFoundText,style:{display:"inline-block",maxWidth:"100%",width:"100%",fontSize:renderParams.theming.fontsizes.font085,marginRight:0,marginLeft:0}},resultsFoundText),resultsContainer=[];resultsContainer.push(resultsLabel);if(!renderParams.isFederatedSearchEnabled){var sortedByLabel=null;if(resultCount>0){resultsLabel.getProperties().style["width"]="auto";var sortedByText=MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.SortedByText,renderParams.selectedSortOption.Label);renderParams.kbSearchResultAccessibilityText+=sortedByText;sortedByLabel=this.CreateElement("label",{id:"sortedByTextId",ref:"sortedBText",accessibilityLabel:sortedByText,style:{display:"inline-block",textAlign:renderParams.isRTL?"left":"right",fontSize:renderParams.theming.fontsizes.font085}},sortedByText)}resultsContainer.push(sortedByLabel)}return this.CreateElement("Container",{id:"resultsContainer",style:{display:"flex",width:renderParams.isFederatedSearchEnabled?"auto":"100%",flexWrap:"wrap",justifyContent:"space-between",marginLeft:0,marginRight:0,marginTop:0}},resultsContainer)};SearchResultInfoView.prototype.renderSelectedSearchProviderWithDropdownIcon=function(renderParams){var filterContainer=[],selectedSearchProviderText=renderParams.selectedSearchProvider.Name,selectedSearchProviderLabel=this.CreateElement("label",{id:"selectedSearchProviderText",ref:"selectedSearchProviderText",style:{position:"static",height:renderParams.theming.measures.measure125,right:renderParams.theming.measures.measure175,bottom:renderParams.theming.measures.measure025,fontFamily:renderParams.theming.fontfamilies.regular,fontStyle:"normal",fontWeight:"normal",fontSize:renderParams.theming.fontsizes.font085,lineHeight:renderParams.theming.measures.measure125,textAlign:"right",color:renderParams.theming.colors.basecolor.blue.blue3,flex:"none",order:0,alignSelf:"center",paddingTop:renderParams.theming.measures.measure025,paddingBottom:renderParams.theming.measures.measure025,paddingLeft:renderParams.theming.measures.measure050,paddingRight:renderParams.theming.measures.measure050,cursor:"pointer"},accessibilityHidden:true},selectedSearchProviderText),iconElement=this.CreateElement("MICROSOFTICON",{id:KbSearchControl.Constants.SearchProviderDropdownIconId,key:KbSearchControl.Constants.SearchProviderDropdownIconId,type:72,style:{height:renderParams.theming.measures.measure075,width:renderParams.theming.measures.measure075,right:renderParams.theming.measures.measure050,position:"static",fontFamily:"Fabric MDL2 Assets",fontSize:renderParams.theming.fontsizes.font075,lineHeight:renderParams.theming.measures.measure075,color:renderParams.theming.colors.grays.gray05,flex:"none",order:1,alignSelf:"center",marginTop:renderParams.theming.measures.measure050,marginBottom:renderParams.theming.measures.measure050,marginLeft:"0px",marginRight:"0px",borderColor:"transparent",background:"transparent",cursor:"pointer"},accessibilityHidden:true});filterContainer.push(selectedSearchProviderLabel);filterContainer.push(iconElement);return this.CreateElement("button",{id:"KM-SearchProviderTextAndDropDownContainer",key:"KM-SearchProviderTextAndDropDownContainer",role:"button",style:{display:"flex",flexDirection:"row",height:renderParams.theming.measures.measure200,right:"0px",":hover":{background:renderParams.theming.colors.grays.gray01},cursor:"pointer",border:"none",paddingRight:!renderParams.isRTL?renderParams.theming.measures.measure050:"",paddingLeft:renderParams.isRTL?renderParams.theming.measures.measure050:"",background:renderParams.showSearchProviderDropDown?renderParams.theming.colors.grays.gray02:renderParams.theming.colors.basecolor.white,marginLeft:!renderParams.isRTL?"auto":"",marginRight:renderParams.isRTL?"auto":""},accessibilityLabel:selectedSearchProviderText,accessibilityHasPopup:true,accessibilityExpanded:renderParams.showSearchProviderDropDown,onClick:this.HandleSearchProviderDropDownClick.bind(null,this)},filterContainer)};return SearchResultInfoView}(KbSearchControl.SearchView);KbSearchControl.SearchResultInfoView=SearchResultInfoView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var RENDER_ADDITIONAL_ATTRIBUTE_MATCHES=false,SearchResultItemView=function(_super){__extends(SearchResultItemView,_super);function SearchResultItemView(){return _super!==null&&_super.apply(this,arguments)||this}SearchResultItemView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.HandleArticleTitleKeyDown=initParams.HandleArticleTitleKeyDown;this.HandleArticleTitleClick=initParams.HandleArticleTitleClick;this.HandleSearchResultClick=initParams.HandleSearchResultClick;this.searchResultActionView=new KbSearchControl.SearchResultActionView;this.searchResultActionView.init(initParams);this.searchResultStatusView=new KbSearchControl.SearchResultStatusView;this.searchResultStatusView.init(initParams);this.searchResultLegendView=new KbSearchControl.SearchResultLegendView;this.searchResultLegendView.init(initParams);return this};SearchResultItemView.prototype.renderKbSearchResultStatusInfo=function(renderParams,stateCode){return this.searchResultStatusView.render(renderParams,stateCode)};SearchResultItemView.prototype.renderAssociationLink=function(){var associationLinkId="microsoftIcon_articleLink_",associationLink=this.CreateElement("MICROSOFTICON",{id:associationLinkId,key:associationLinkId,type:149});return this.CreateElement("Container",{id:"kbSearchResults.associationLinkid",key:"kbSearchResults.associationLink",className:"mscrm-KbAssociatedLink mscrm-kbSerachResultHeaderCell mscrm-kbSearchResultHeaderSidebar",style:{fontSize:"16px"}},associationLink)};SearchResultItemView.prototype.sanitizeStatusString=function(stateString){var checkString=stateString.indexOf("[")===0&&stateString.indexOf("]")===stateString.length-1?stateString:"["+stateString+"]";switch(checkString){case KbSearchControl.KbSearchControlLocale.ResultStatusDraft:case KbSearchControl.KbSearchControlLocale.ResultStatusApproved:case KbSearchControl.KbSearchControlLocale.ResultStatusScheduled:return checkString;default:return}};SearchResultItemView.prototype.getStatusByStateCode=function(stateCode){var kbSearchResultStatusValue="";if(typeof stateCode==="string")return this.sanitizeStatusString(stateCode);switch(stateCode){case 0:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusDraft;break;case 1:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusApproved;break;case 2:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusScheduled;break;case 3:case 5:case 6:default:return}return kbSearchResultStatusValue};SearchResultItemView.prototype.GetKbSearchResult=function(renderParams,kbSearchRecord){var matchingKbSearchResultCollection=renderParams.kbSearchResultCollection.filter(function(kbSearchResult){return kbSearchResult.kbSearchRecord.knowledgeArticleId===kbSearchRecord.knowledgeArticleId});if(matchingKbSearchResultCollection.length>0)return matchingKbSearchResultCollection[0];return null};SearchResultItemView.prototype.renderSearchResultRow=function(renderParams,kbSearchRecord){var _this=this,watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchResults,"renderSearchResultRow"),titleBlock=[],title=kbSearchRecord.title,articleAriaLabel=kbSearchRecord.title,isArticleClicked=renderParams.clickedArticleId===kbSearchRecord.knowledgeArticleId,renderKbSearchResultStatusInfo=this.renderKbSearchResultStatusInfo(renderParams,kbSearchRecord.stateCode),KbSearchResultStatusInfo=this.getStatusByStateCode(kbSearchRecord.stateCode);renderKbSearchResultStatusInfo&&titleBlock.push(renderKbSearchResultStatusInfo);if(KbSearchResultStatusInfo)articleAriaLabel=KbSearchResultStatusInfo+" "+title;var highlightedTitle=kbSearchRecord.highlights&&kbSearchRecord.highlights.title;titleBlock=titleBlock.concat(this._generatetHtmlElementsfromCrmhitText(renderParams,highlightedTitle?highlightedTitle:title));var articleTitle=this.CreateElement("text",{id:"articleTitleText_"+kbSearchRecord.knowledgeArticleId.toString(),key:"articleTitleText_"+kbSearchRecord.knowledgeArticleId.toString(),semanticTag:"h4",title:title,noExpandable:true,singleLineTruncation:false,truncatedlines:2,maskingColor:"#F8F7F6",flexibleTextContainerStyle:{lineHeight:"1.4em"},flexibleTextStyle:{lineHeight:"1.4em",textOverflow:"ellipsis",wordBreak:"break-all"},style:{color:renderParams.enableSelection?isArticleClicked?"#000000":"#333333":"inherit"}},titleBlock),articleTitleId="articleTitle"+kbSearchRecord.knowledgeArticleId,articleTitleLink=this.CreateElement("Hyperlink",{id:articleTitleId,key:articleTitleId,onKeyDown:function(event){return _this.HandleArticleTitleKeyDown(event,kbSearchRecord)},onClick:function(event){return _this.HandleArticleTitleClick(event,kbSearchRecord)},style:{paddingLeft:!renderParams.isReferencePanel||renderParams.isRTL?renderParams.theming.measures.measure100:0,paddingRight:!renderParams.isReferencePanel?renderParams.theming.measures.measure100:0,width:"calc(100% - "+renderParams.theming.measures.measure350+")",maxHeight:"2.8em",textDecoration:"none",color:renderParams.theming.colors.grays.gray06,overflow:"hidden",fontFamily:renderParams.theming.fontfamilies.semibold,fontSize:renderParams.theming.fontsizes.font100,cursor:"pointer",whiteSpace:"normal",":hover":{color:MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION}},accessibilityLabel:articleAriaLabel,tabIndex:0},articleTitle),articleIconDiv=null,actionsRender=this.searchResultActionView.render(renderParams,kbSearchRecord,articleTitleId,true),kbSearchResult=this.GetKbSearchResult(renderParams,kbSearchRecord),actionsWidthAllocation=Math.min(kbSearchResult.articleActions.length,renderParams.isLoadedInProductivityPanel?2:4)*24+"px",actionsDiv=null;if(actionsRender!=null)actionsDiv=this.CreateElement("Container",{id:"kbSearchResults.action.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.action",role:"presentation",className:"actions-root-container-standardmode-UIEnhancements",style:{width:actionsWidthAllocation,paddingRight:!renderParams.isRTL&&renderParams.isReferencePanel?0:renderParams.theming.measures.measure100,paddingLeft:renderParams.isRTL?renderParams.theming.measures.measure100:""}},actionsRender);var kbSearchResultsRow=this.CreateElement("Container",{id:"kbSearchResults.row.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.row",className:"mscrm-kbSearchResultTitle mscrm-kbSerachResultHeaderCell mscrm-kbSerachResultHeaderTitle",style:{width:actionsRender!=null?"calc(100% - "+actionsWidthAllocation+")":"100%",whiteSpace:"normal",alignItems:"center"}},[articleTitleLink]),rowsForRender=[kbSearchResultsRow,actionsDiv],headerDiv=this.CreateElement("Container",{id:"kbSearchResults.header.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.header",className:"mscrm-kbSearchResultHeader mscrm-kbSerachResultHeaderTable",style:{width:"100%",paddingBottom:renderParams.theming.measures.measure050}},rowsForRender),fullResultContent=kbSearchRecord.content;fullResultContent=$($["parseHTML"](fullResultContent)).text().substring(0,KbSearchControl.Constants.MaxCharacterAllowedInKbToolTip);var highlightedContent=kbSearchRecord.highlights&&kbSearchRecord.highlights.content,fullResultContentArray=this._generatetHtmlElementsfromCrmhitText(renderParams,highlightedContent?highlightedContent:fullResultContent),descriptionDiv=this.CreateElement("Text",{id:"kbSearchResults.description.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.description",className:"mscrm-kbSearchResultDescription mscrm-multilineEllipsis",tabIndex:-1,noExpandable:true,singleLineTruncation:false,truncatedlines:3,maskingColor:"#F8F7F6",flexibleTextContainerStyle:{width:"inherit"},flexibleTextStyle:{width:"inherit",lineHeight:"1.4em",textOverflow:"ellipsis",wordBreak:"break-all"},style:{color:renderParams.enableSelection?isArticleClicked?"#333333":"#666666":"inherit",":hover":{color:renderParams.enableSelection?isArticleClicked?"#333333":"#444444":"inherit"}}},fullResultContentArray),descriptionDivContainer=this.CreateElement("Container",{id:"kbSearchResults.descriptionContainer.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.descriptionContainer",className:"mscrm-kbSearchResultDescriptionContainer",style:{color:renderParams.theming.colors.grays.gray06,paddingLeft:renderParams.isReferencePanel&&!renderParams.isRTL?0:renderParams.theming.measures.measure100,paddingRight:renderParams.theming.measures.measure100,width:"100%",fontSize:renderParams.theming.fontsizes.font100,height:"",whiteSpace:"normal",overflow:"hidden",textOverflow:"ellipsis"},tabIndex:-1},descriptionDiv),bodyDiv=this.CreateElement("Container",{id:"kbSearchResults.body.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.body",style:{width:"100%",marginBottom:renderParams.theming.measures.measure050}},descriptionDivContainer),articleState={};articleState["isArticleClicked"]=isArticleClicked;var additionalMatches=kbSearchRecord.additionalMatches,annotationAttachmentCount=kbSearchRecord.annotationAttachmentCount,annotationNotesCount=kbSearchRecord.annotationNotesCount,shouldRenderAdditionalMatches=additionalMatches&&additionalMatches.length>0&&RENDER_ADDITIONAL_ATTRIBUTE_MATCHES,shouldRenderAnnotationMatches=annotationAttachmentCount&&annotationAttachmentCount>0||annotationNotesCount&&annotationNotesCount>0,footerDiv=this.renderArticleMetadata(renderParams,kbSearchRecord,articleState,shouldRenderAdditionalMatches||shouldRenderAnnotationMatches),articleRenderComponents=[headerDiv,bodyDiv,footerDiv];shouldRenderAdditionalMatches&&articleRenderComponents.push(this.renderAdditionalMetadata(renderParams,kbSearchRecord,MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchAdditionalMatches,additionalMatches.length)));if(shouldRenderAnnotationMatches)if(annotationAttachmentCount&&annotationNotesCount)articleRenderComponents.push(this.renderAdditionalMetadata(renderParams,kbSearchRecord,MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchNotesAnnotationMatchCount,annotationAttachmentCount)));else if(annotationAttachmentCount)articleRenderComponents.push(this.renderAdditionalMetadata(renderParams,kbSearchRecord,MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchAnnotationMatchCount,annotationAttachmentCount)));else annotationNotesCount&&articleRenderComponents.push(this.renderAdditionalMetadata(renderParams,kbSearchRecord,MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchNotesMatchCount,annotationNotesCount)));var contentContainer=this.CreateElement("Container",{id:"kbSearchResults.contentContainer.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.contentContainer",style:{display:"flex",flexDirection:"column",width:"100%",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},articleRenderComponents),result=this.CreateElement("Container",{id:"kbSearchResults.content.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.content",className:null,style:{display:"flex",paddingTop:renderParams.theming.measures.measure050,cursor:"pointer"},onClick:function(event){return _this.HandleSearchResultClick(event,kbSearchRecord)}},[articleIconDiv,contentContainer]);watermarkTelemetryEvent.End();return result};SearchResultItemView.prototype.renderAdditionalMetadata=function(renderParams,kbSearchRecord,additionalMetadataString){var isArticleClicked=renderParams.clickedArticleId===kbSearchRecord.knowledgeArticleId,additionalMetadataId="kbsearchcontrol_additionalMetadata_",additionalMetadataIconId=additionalMetadataId+"Icon_"+kbSearchRecord.knowledgeArticleId.toString(),iconComponent=this.CreateElement("MICROSOFTICON",{id:additionalMetadataIconId,key:additionalMetadataIconId,type:179,style:{color:"#3B79B7",padding:renderParams.theming.measures.measure050}}),additionalMetadataTextId=additionalMetadataId+"Text_",textComponent=this.CreateElement("LABEL",{id:"articleTitleText_"+kbSearchRecord.knowledgeArticleId.toString(),key:"articleTitleText_"+kbSearchRecord.knowledgeArticleId.toString(),title:additionalMetadataString,style:{lineHeight:"1"},accessibilityLabel:additionalMetadataString},additionalMetadataString),additionalMetadataContainerId=additionalMetadataId+"Container_"+kbSearchRecord.knowledgeArticleId.toString(),metadataComponent=this.CreateElement("Container",{id:additionalMetadataContainerId,key:additionalMetadataContainerId,style:{display:"flex",width:"100%",alignItems:"center",fontSize:renderParams.theming.fontsizes.font100,marginBottom:renderParams.theming.measures.measure100,background:"#EFEFEF"}},[iconComponent,textComponent]);return this.CreateElement("Container",{style:{marginBottom:renderParams.theming.measures.measure050,marginLeft:renderParams.isRTL?0:renderParams.theming.measures.measure100,marginRight:renderParams.isRTL?renderParams.theming.measures.measure100:0,borderBottom:renderParams.enableSelection&&isArticleClicked?"none":renderParams.theming.borders.border01}},metadataComponent)};SearchResultItemView.prototype.renderArticleMetadata=function(renderParams,kbSearchRecord,articleState,additionalMetadataPresent){var isArticleClicked=renderParams.clickedArticleId===kbSearchRecord.knowledgeArticleId,resultLegends=this.searchResultLegendView.render(renderParams,kbSearchRecord);return this.CreateElement("Container",{id:"kbSearchResults.footer.id_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footer",className:"mscrm-kbSearchResultFooter",style:{width:"calc(100% - "+renderParams.theming.measures.measure350+")",display:"flex",marginLeft:renderParams.isReferencePanel?0:renderParams.theming.measures.measure100,marginRight:renderParams.isReferencePanel?0:renderParams.theming.measures.measure100,whiteSpace:"normal",borderBottom:additionalMetadataPresent||renderParams.enableSelection&&isArticleClicked?"none":renderParams.theming.borders.border01,paddingBottom:renderParams.theming.measures.measure050,position:"relative"}},resultLegends)};SearchResultItemView.prototype.render=function(renderParams,kbSearchRecord){var resultDiv=this.renderSearchResultRow(renderParams,kbSearchRecord);return this.CreateElement("LISTITEM",{key:"kbSearchResults.searchResultDiv"+kbSearchRecord.knowledgeArticleId.toString(),id:"kbSearchResults.searchResultDiv"+kbSearchRecord.knowledgeArticleId,style:this._getStyles(renderParams,kbSearchRecord.knowledgeArticleId),role:"listitem"},resultDiv)};SearchResultItemView.prototype._getStyles=function(renderParams,knowledgeArticleId){var nonSelectedStyle={":hover":{backgroundColor:"#F3F2F1"}},selectedStyle={backgroundColor:"#F0F5FF"},normalStyle={};normalStyle.display=renderParams.userAgent.isBrowserIE?"list-item":"inline-block";if(renderParams.clickedArticleId===knowledgeArticleId&&renderParams.enableSelection)return Object.assign({},selectedStyle,normalStyle);else return Object.assign({},nonSelectedStyle,normalStyle)};SearchResultItemView.prototype._generatetHtmlElementsfromCrmhitText=function(renderParams,crmHitText,htmlArray){if(htmlArray==null)htmlArray=[];if(!crmHitText)return htmlArray;var crmHitStartPos=crmHitText.indexOf(KbSearchControl.Constants.CrmHitStartTag);if(crmHitStartPos!=-1){var crmHitEndPos=crmHitText.indexOf(KbSearchControl.Constants.CrmHitEndTag),textOutsideCrmHit=crmHitText.slice(0,crmHitStartPos),textInsideCrmHit=crmHitText.slice(crmHitStartPos,crmHitEndPos+9);htmlArray.push(this._generateSpan(renderParams,textOutsideCrmHit,false));htmlArray.push(this._generateSpan(renderParams,this._removeCrmHitText(renderParams,textInsideCrmHit),true));var truncatedstring=crmHitText.slice(crmHitEndPos+9,crmHitText.length);return this._generatetHtmlElementsfromCrmhitText(renderParams,truncatedstring,htmlArray)}htmlArray.push(this._generateSpan(renderParams,crmHitText,false));return htmlArray};SearchResultItemView.prototype._generateSpan=function(renderParams,text,isCrmHit){return this.CreateElement("LABEL",{style:isCrmHit?Object.assign({},KbSearchControl.Constants.CrmHitStyle):Object.assign({},KbSearchControl.Constants.NormalStyle)},text)};SearchResultItemView.prototype._removeCrmHitText=function(renderParams,text){if(text.indexOf(KbSearchControl.Constants.CrmHitStartTag)!=-1)return text.replace(new RegExp(KbSearchControl.Constants.CrmHitStartTag,"g"),"").replace(new RegExp(KbSearchControl.Constants.CrmHitEndTag,"g"),"");return text};return SearchResultItemView}(KbSearchControl.SearchView);KbSearchControl.SearchResultItemView=SearchResultItemView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultLegendView=function(_super){__extends(SearchResultLegendView,_super);function SearchResultLegendView(){return _super!==null&&_super.apply(this,arguments)||this}SearchResultLegendView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);return this};SearchResultLegendView.prototype.render=function(renderParams,kbSearchRecord){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchResultLegends,"render"),isArticleSelected=kbSearchRecord.knowledgeArticleId===renderParams.clickedArticleId,controlBlock=[],knowledgeArticleViews=kbSearchRecord.knowledgeArticleViews?kbSearchRecord.knowledgeArticleViews:0,knowledgeArticleViewsTooltipValue=MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.NumberOfViewsIconToolTip,knowledgeArticleViews.toString()),modifiedOnResourceTooltipValue=KbSearchControl.KbSearchControlLocale.ModifiedOnLabelToolTip,knowledgeArticleViewsLabel=this.CreateElement("LABEL",{id:"knowledgeArticleViews_"+kbSearchRecord.knowledgeArticleId.toString(),key:"knowledgeArticleViews_"+kbSearchRecord.knowledgeArticleId.toString(),title:knowledgeArticleViewsTooltipValue,accessibilityHidden:true,tabIndex:-1,style:{color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit",fontSize:renderParams.theming.fontsizes.font085,lineHeight:renderParams.theming.fontsizes.font115}},knowledgeArticleViews),knowledgeArticleViewsAccessibilityLabel=this.CreateElement("LABEL",{id:"knowledgeArticleViewsAccessibilityLabel_"+kbSearchRecord.knowledgeArticleId.toString(),key:"knowledgeArticleViewsAccessibilityLabel_"+kbSearchRecord.knowledgeArticleId.toString(),style:MscrmControls.KbCommonUtils.Constants.AccessibilityLabelStyle},knowledgeArticleViewsTooltipValue),rating=kbSearchRecord.rating?kbSearchRecord.rating:0,ratingAccessibilityLabelText=MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.NumberOfRatingToolTip,rating.toString()),ratingLabel=this.CreateElement("LABEL",{id:"rating_"+kbSearchRecord.knowledgeArticleId.toString(),key:"rating_"+kbSearchRecord.knowledgeArticleId.toString(),title:ratingAccessibilityLabelText,accessibilityHidden:true,tabIndex:-1,style:{color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit",fontSize:renderParams.theming.fontsizes.font085,lineHeight:renderParams.theming.fontsizes.font115}},rating),ratingAccessibilityLabel=this.CreateElement("LABEL",{id:"ratingAccessibilityLabel_"+kbSearchRecord.knowledgeArticleId.toString(),key:"ratingAccessibilityLabel_"+kbSearchRecord.knowledgeArticleId.toString(),style:MscrmControls.KbCommonUtils.Constants.AccessibilityLabelStyle},ratingAccessibilityLabelText);if(kbSearchRecord.modifiedOn){var modifiedOnValue,formattedDateTime=this.FormatTime(new Date(kbSearchRecord.modifiedOn.toString()),1).split(/\s/);modifiedOnValue=formattedDateTime.length>1?formattedDateTime[0]:""}modifiedOnResourceTooltipValue=modifiedOnResourceTooltipValue.concat(" "+modifiedOnValue);var modifiedOnValueLabel=this.CreateElement("LABEL",{id:"modifiedOnValue_"+kbSearchRecord.knowledgeArticleId.toString(),key:"modifiedOnValue_"+kbSearchRecord.knowledgeArticleId.toString(),style:{padding:"",fontSize:renderParams.theming.fontsizes.font085,lineHeight:renderParams.theming.fontsizes.font115,color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:renderParams.theming.colors.grays.gray05},title:modifiedOnResourceTooltipValue,accessibilityLabel:modifiedOnResourceTooltipValue},modifiedOnValue),modifiedOnDiv=this.CreateElement("Container",{id:"kbSearchResults.footerDivModifiedOn_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footerDivModifiedOn_"+kbSearchRecord.knowledgeArticleId.toString(),style:{whiteSpace:"nowrap",flexWrap:"wrap",marginLeft:MscrmControls.KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(kbSearchRecord)?"auto":0,marginRight:0,display:"flex",color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit"}},[modifiedOnValueLabel]),numberOfViewsIconId="microsoftIcon_numberOfViewsButton__"+kbSearchRecord.knowledgeArticleId.toString(),numberOfViewsIcon=this.CreateElement("MICROSOFTICON",{id:numberOfViewsIconId,key:numberOfViewsIconId,type:MscrmControls.KbCommonUtils.IconSymbolCode.NumberOfViews,accessibilityHidden:true,tabIndex:-1}),numberOfViewsIconDiv=this.CreateElement("Container",{id:"numberOfViewsIcon_"+kbSearchRecord.knowledgeArticleId.toString(),key:"numberOfViewsIconDiv",ref:"numberOfViewsIconDiv",style:{whiteSpace:"nowrap",display:"inline-block",paddingLeft:renderParams.isRTL?renderParams.theming.measures.measure025:0,paddingRight:renderParams.isRTL?0:renderParams.theming.measures.measure025,fontSize:"16px",color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit"},title:knowledgeArticleViewsTooltipValue,accessibilityLabel:knowledgeArticleViewsTooltipValue},[numberOfViewsIcon,knowledgeArticleViewsAccessibilityLabel]);controlBlock.push(numberOfViewsIconDiv,knowledgeArticleViewsLabel);controlBlock.push(this.renderMetadataSeparator(renderParams,MscrmControls.KbCommonUtils.Constants.NumberOfViews,kbSearchRecord.knowledgeArticleId.toString()));if(renderParams.enableRating=="true"){var ratingFullIconId="microsoftIcon_ratingFullButton__"+kbSearchRecord.knowledgeArticleId.toString(),ratingFullIcon=this.CreateElement("MICROSOFTICON",{id:ratingFullIconId,key:ratingFullIconId,type:MscrmControls.KbCommonUtils.CommonUtils.getRatingIcon(),accessibilityHidden:true,tabIndex:-1}),ratingFullIconDiv=this.CreateElement("Container",{id:"ratingFullIcon_"+kbSearchRecord.knowledgeArticleId.toString(),key:"ratingFullIconDiv",ref:"ratingFullIconDiv",style:{whiteSpace:"nowrap",display:"inline-block",marginLeft:"",marginRight:"",paddingLeft:renderParams.isRTL?renderParams.theming.measures.measure025:0,paddingRight:renderParams.isRTL?0:renderParams.theming.measures.measure025,fontSize:"16px",color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit"},title:ratingAccessibilityLabelText,accessibilityLabel:ratingAccessibilityLabelText},[ratingFullIcon,ratingAccessibilityLabel]);controlBlock.unshift(ratingFullIconDiv,ratingLabel,this.renderMetadataSeparator(renderParams,MscrmControls.KbCommonUtils.Constants.Rating,kbSearchRecord.knowledgeArticleId.toString()))}var footerDivRatingandArticleView=this.CreateElement("Container",{id:"kbSearchResults.footerDivRatingandArticleView_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footerDivRatingandArticleView_"+kbSearchRecord.knowledgeArticleId.toString(),style:{whiteSpace:"normal",display:"flex",flexWrap:"nowrap",color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit",marginLeft:renderParams.isRTL?"":!renderParams.isLoadedInProductivityPanel?"auto":"",marginRight:renderParams.isRTL?!renderParams.isLoadedInProductivityPanel?"auto":"":""}},controlBlock),linkedTooltipValue=MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.ArticleIconToolTipAssociated,renderParams.entityDisplayName?renderParams.entityDisplayName:renderParams.entityTypeName),enhancedLabelStyle={color:"#323130",fontSize:renderParams.theming.fontsizes.font085,lineHeight:renderParams.theming.fontsizes.font115},linkedArticleLabel=this.CreateElement("LABEL",{id:"knowledgeArticleLinked_"+kbSearchRecord.knowledgeArticleId.toString(),key:"knowledgeArticleLinked_"+kbSearchRecord.knowledgeArticleId.toString(),title:linkedTooltipValue,accessibilityLabel:linkedTooltipValue,style:enhancedLabelStyle},MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.ArticleTagLabelAssociated,renderParams.entityDisplayName)),linkedArticle=this.CreateElement("Container",{id:"kbSearchResults.footerDivLinkedArticle_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footerDivLinkedArticle_"+kbSearchRecord.knowledgeArticleId.toString(),style:{color:"",backgroundColor:"#CCDEFF",borderColor:"",borderRadius:"2px",marginRight:"",padding:"1px 5px"}},linkedArticleLabel),headerContent=[];if(kbSearchRecord.isAssociated)if(renderParams.isLoadedInProductivityPanel){var linkedArticleContainer=this.CreateElement("Container",{id:"kbSearchResults.footerDivLinkedArticleContainer_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footerDivLinkedArticleContainer_"+kbSearchRecord.knowledgeArticleId.toString(),style:{width:"100%",marginBottom:renderParams.theming.measures.measure050}},linkedArticle);headerContent.push(linkedArticleContainer)}else headerContent.push(linkedArticle);if(renderParams.isShowSelectedDialogOptionVisible&&renderParams.multiselectDialogSelectedRecords[kbSearchRecord.knowledgeArticleId]){var isContentSelected=renderParams.multiselectDialogSelectedRecords[kbSearchRecord.knowledgeArticleId].content,isUrlSelected=renderParams.multiselectDialogSelectedRecords[kbSearchRecord.knowledgeArticleId].url,selectedTooltipValue=void 0;if(isContentSelected&&isUrlSelected)selectedTooltipValue="Content and URL Selected";else if(isContentSelected)selectedTooltipValue="Content Selected";else selectedTooltipValue="Url Selected";var SelectedArticleLabel=this.CreateElement("LABEL",{id:"knowledgeArticleSelected_"+kbSearchRecord.knowledgeArticleId.toString(),key:"knowledgeArticleSelected_"+kbSearchRecord.knowledgeArticleId.toString(),title:selectedTooltipValue,accessibilityLabel:selectedTooltipValue,style:enhancedLabelStyle},selectedTooltipValue),SelectedArticle=this.CreateElement("Container",{id:"kbSearchResults.footerDivSelectedArticle_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footerDivSelectedArticle_"+kbSearchRecord.knowledgeArticleId.toString(),style:{color:"",backgroundColor:MscrmControls.KbCommonUtils.Constants.BGCOLOR_SEARCH_RESULT_LABEL_CONTAINER,borderRadius:"2px",marginRight:"",padding:"1px 5px"}},SelectedArticleLabel);headerContent.push(SelectedArticle)}MscrmControls.KbCommonUtils.CommonUtils.IsRecordFromDynamicsSearch(kbSearchRecord)&&headerContent.push(footerDivRatingandArticleView);headerContent.push(modifiedOnDiv);var headerIconsBlock=this.CreateElement("Container",{id:"controlBlockHeaderIconPane_"+kbSearchRecord.knowledgeArticleId.toString(),key:"controlBlockHeaderIconPaneDiv",ref:"controlBlockHeaderIconPaneDiv",className:"controlBlockHeaderIconPane",style:{width:"100%",flexWrap:"wrap"}},headerContent);watermarkTelemetryEvent.End();return headerIconsBlock};SearchResultLegendView.prototype.renderMetadataSeparator=function(renderParams,separatorId,kbArticleId){return this.CreateElement("LABEL",{id:"searchMetadataSeparator_"+separatorId+"_"+kbArticleId+"_"+renderParams.controlId,key:"modifiedOnValue_"+separatorId+"_"+kbArticleId+"_"+renderParams.controlId,accessibilityHidden:true,tabIndex:-1,style:{fontSize:renderParams.theming.fontsizes.font085,paddingLeft:renderParams.theming.measures.measure050,paddingRight:renderParams.theming.measures.measure050,fontWeight:800}},MscrmControls.KbCommonUtils.Constants.MiddleDotUnicode)};return SearchResultLegendView}(KbSearchControl.SearchView);KbSearchControl.SearchResultLegendView=SearchResultLegendView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultStatusView=function(_super){__extends(SearchResultStatusView,_super);function SearchResultStatusView(){return _super!==null&&_super.apply(this,arguments)||this}SearchResultStatusView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);return this};SearchResultStatusView.prototype.render=function(renderParams,stateCode){var kbSearchResultStatusValue="",kbSearchResultStatusClass="";if(typeof stateCode==="string"){kbSearchResultStatusValue=this.sanitizeStatusString(stateCode);if(!kbSearchResultStatusValue)return}else switch(stateCode){case 0:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusDraft;kbSearchResultStatusClass="mscrm-kbSearchResultStatusInfo-Draft";break;case 1:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusApproved;kbSearchResultStatusClass="mscrm-kbSearchResultStatusInfo-Approved";break;case 2:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusScheduled;kbSearchResultStatusClass="mscrm-kbSearchResultStatusInfo-Scheduled";break;case 3:case 5:case 6:default:return}if(kbSearchResultStatusValue!="")kbSearchResultStatusClass="mscrm-kbSearchResultStatusInfo mscrm-kbSerachResultHeaderCell mscrm-ContentPaneArticleNameContainerCell "+kbSearchResultStatusClass;return this.CreateElement("LABEL",{id:"KbSearchResultStatusid",key:"KbSearchResultStatus",className:kbSearchResultStatusClass,style:{color:"#CA5010",marginRight:"5px"}},kbSearchResultStatusValue)};SearchResultStatusView.prototype.getStatusByStateCode=function(stateCode){var kbSearchResultStatusValue="";if(typeof stateCode==="string")return this.sanitizeStatusString(stateCode);switch(stateCode){case 0:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusDraft;break;case 1:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusApproved;break;case 2:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusScheduled;break;case 3:case 5:case 6:default:return}return kbSearchResultStatusValue};SearchResultStatusView.prototype.sanitizeStatusString=function(stateString){var checkString=stateString.indexOf("[")===0&&stateString.indexOf("]")===stateString.length-1?stateString:"["+stateString+"]";switch(checkString){case KbSearchControl.KbSearchControlLocale.ResultStatusDraft:case KbSearchControl.KbSearchControlLocale.ResultStatusApproved:case KbSearchControl.KbSearchControlLocale.ResultStatusScheduled:return checkString;default:return}};return SearchResultStatusView}(KbSearchControl.SearchView);KbSearchControl.SearchResultStatusView=SearchResultStatusView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultView=function(_super){__extends(SearchResultView,_super);function SearchResultView(){return _super!==null&&_super.apply(this,arguments)||this}SearchResultView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.searchResultItemView=new KbSearchControl.SearchResultItemView;this.searchResultItemView.init(initParams);this.searchResultFooterView=new KbSearchControl.SearchResultFooterView;this.searchResultFooterView.init(initParams);return this};SearchResultView.prototype.render=function(renderParams){if(renderParams.shouldStopandRerenderinPP())return;var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchControl,MscrmControls.KbCommonUtils.TelemetryActionName.Load_Search_Results),searchResultsContainer=this.renderSearchResultsContainer(renderParams);searchResultsContainer.push(this.searchResultFooterView.render(renderParams));var searchResultsList=this.CreateElement("LIST",{id:"kbSearchResultsListId",Key:"kbSearchResultsList",style:{flexDirection:"Column"},role:"list"},searchResultsContainer);watermarkTelemetryEvent.End();renderParams.setFirstResultRender();return searchResultsList};SearchResultView.prototype.renderSearchResultsContainer=function(renderParams){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchControl,"renderSearchResultsContainer"),isRelevanceSearchEnabled=renderParams.isRelevanceSearchEnabled&&renderParams.isExternalSearchIndexEnabled,searchResults=isRelevanceSearchEnabled?renderParams.relevanceSearchRecordCollection:renderParams.records,searchResultContainerChildren=[];if(searchResults)for(var i=0,l=searchResults.length;i<l;i++){if(renderParams.disableScroll&&i+1>renderParams.numberOfResults)break;searchResultContainerChildren.push(this.searchResultItemView.render(renderParams,searchResults[i]))}watermarkTelemetryEvent.End();return searchResultContainerChildren};return SearchResultView}(KbSearchControl.SearchView);KbSearchControl.SearchResultView=SearchResultView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var StandaloneSearchControlView=function(_super){__extends(StandaloneSearchControlView,_super);function StandaloneSearchControlView(){return _super!==null&&_super.apply(this,arguments)||this}StandaloneSearchControlView.prototype.render=function(renderParams){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchControl,"renderStandaloneSearchControl"),controlBlock=[],dataBlock=[],resultsPane=[];controlBlock.push(this.searchHeaderView.render(renderParams));!renderParams.hideSearchOnRecordLoad&&controlBlock.push(this.searchBoxView.render(renderParams));if(renderParams.isSearchMode||!renderParams.popupEnabled||renderParams.hideSearchOnRecordLoad){var isLoading=renderParams.isLoading;controlBlock.push(this.searchFilterView.render(renderParams));this.overrideReferencePanelMaxHeight(renderParams);controlBlock.push(this.searchResultInfoView.render(renderParams));if(!renderParams.isRelevanceSearchSyncStatusValid||renderParams.error&&renderParams.errorMessage!="")dataBlock.push(this.searchErrorView.render(renderParams));else if(isLoading)dataBlock.push(this.searchLoadingView.render(renderParams));else if(renderParams.showResults&&renderParams.records||renderParams.showResults&&renderParams.relevanceSearchRecordCollection&&renderParams.relevanceSearchRecordCollection.length>0)dataBlock.push(this.searchResultView.render(renderParams));else renderParams.showResults&&renderParams.relevanceSearchRecordCollection&&renderParams.relevanceSearchRecordCollection.length<=0&&dataBlock.push(this.searchErrorView.render(renderParams));!renderParams.isSearchMode&&this.renderArticleAndContentControl(renderParams,resultsPane)}var controlBlockContainer=this.CreateElement("CONTAINER",{id:"controlBlockContainer",key:"controlBlockContainer",style:{flexDirection:"column",overflowY:"hidden",overflowX:"hidden",flexShrink:0,alignItems:"flex-end",borderBottom:"",paddingLeft:renderParams.theming.measures.measure100,paddingRight:renderParams.theming.measures.measure100}},controlBlock),searchAndDataBlockContainerId=KbSearchControl.Constants.SearchAndDataBlockContainerId,scrollingDataBlockContainer=this.CreateElement("CONTAINER",{id:searchAndDataBlockContainerId,key:searchAndDataBlockContainerId,style:{flexDirection:"column",flexGrow:1,flexShrink:1,overflowY:"auto",overflowX:"hidden"}},dataBlock);if(resultsPane.length==0){var defaultRightPaneIcon=this.CreateElement("IMG",{source:"/Webresources/msdyncrm_/KBSearchStandalone/RightPane_EmptyState.png",altText:KbSearchControl.KbSearchControlLocale.SearchAndSelectArticleMessage,style:{width:"14.35rem",height:"14.35rem","text-align":"center",display:"block","vertical-align":"middle",margin:"auto"}}),defaultRightPaneLabel=this.CreateElement("LABEL",{id:"defaultRightPaneLabel",key:"defaultRightPaneLabel",style:{fontFamily:renderParams.theming.fontfamilies.semibold,fontSize:renderParams.theming.fontsizes.font125,textAlign:"center",paddingTop:renderParams.theming.measures.measure100}},KbSearchControl.KbSearchControlLocale.SearchAndSelectArticleMessage),defaultRightPaneMessage=this.CreateElement("CONTAINER",{id:"defaultRightPaneMessage",key:"defaultRightPaneMessage",style:{display:"flex",justifyContent:"center"}},defaultRightPaneLabel),defaultIconAndMessage=this.CreateElement("CONTAINER",{id:"defaultIconAndMessage",key:"defaultIconAndMessage",style:{display:"flex",flexDirection:"column",margin:"auto"}},[defaultRightPaneIcon,defaultRightPaneMessage]);resultsPane.push(defaultIconAndMessage)}var resultsBlockContainer=this.CreateElement("CONTAINER",{id:"resultsBlockContainer",key:"resultsBlockContainer",style:{flexDirection:"column",flexGrow:7,width:0,overflowY:"hidden",overflowX:"hidden",padding:0}},resultsPane),popup;renderParams.RequestRenderIfNecessary();var resultsAccessibilityContainer=this.renderResultsAccessibilityContainer(renderParams),errorAccessibilityContainer=this.renderErrorResultsAccessibilityContainer(renderParams),searchControlContainerId="searchControlContainer",leftPane=this.CreateElement("SCROLLCONTAINER",{id:searchControlContainerId+"LeftPane",key:searchControlContainerId+"LeftPane",className:"mscrm-kbSearchContainer",style:{width:renderParams.allocatedWidth>=1300?"30%":"390px",height:"auto",maxHeight:renderParams.controlMaxHeight+"px",minHeight:"inherit",display:"flex",flexDirection:"column",overflowX:"hidden",overflowY:"auto",borderRight:"1.5px solid #efefef",fontFamily:renderParams.theming.fontfamilies.regular},onKeyDown:function(event){return renderParams.OnKeyDownSkipContent(event)}},[controlBlockContainer,scrollingDataBlockContainer,popup,resultsAccessibilityContainer,errorAccessibilityContainer]),rightPane=this.CreateElement("CONTAINER",{id:"searchControlContainerIdRightPane",key:"searchControlContainerIdRightPane",className:"mscrm-kbSearchContainer",style:{width:renderParams.allocatedWidth>=1300?"70%":"calc(100% - 390px)",maxHeight:renderParams.controlMaxHeight+16+"px",height:"auto",minHeight:"inherit",display:"flex",flexDirection:"row",overflowX:"hidden",fontFamily:renderParams.theming.fontfamilies.regular},onKeyDown:function(event){return renderParams.OnKeyDownSkipContent(event)}},resultsBlockContainer),result=this.CreateElement("CONTAINER",{id:searchControlContainerId,key:searchControlContainerId,className:"mscrm-kbSearchContainer",style:{width:"calc(100% - "+renderParams.theming.measures.measure100+" - "+renderParams.theming.measures.measure100+")",height:"auto",minHeight:"inherit",flex:"1 1 auto",display:"flex",flexDirection:"row",overflow:"hidden",fontFamily:renderParams.theming.fontfamilies.regular,backgroundColor:"#ffffff"}},[leftPane,rightPane]);watermarkTelemetryEvent.End();return result};return StandaloneSearchControlView}(KbSearchControl.SearchControlView);KbSearchControl.StandaloneSearchControlView=StandaloneSearchControlView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var StandardSearchControlView=function(_super){__extends(StandardSearchControlView,_super);function StandardSearchControlView(){return _super!==null&&_super.apply(this,arguments)||this}StandardSearchControlView.prototype.render=function(renderParams){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchControl,"renderStandardModeControl"),controlBlock=[],dataBlock=[];controlBlock.push(this.searchHeaderView.render(renderParams));!renderParams.hideSearchOnRecordLoad&&controlBlock.push(this.searchBoxView.render(renderParams));if(renderParams.isSearchMode){var isLoading=renderParams.isLoading;controlBlock.push(this.searchFilterView.render(renderParams));this.overrideReferencePanelMaxHeight(renderParams);controlBlock.push(this.searchResultInfoView.render(renderParams));if(!renderParams.isRelevanceSearchSyncStatusValid||renderParams.error&&renderParams.errorMessage!="")dataBlock.push(this.searchErrorView.render(renderParams));else if(isLoading)dataBlock.push(this.searchLoadingView.render(renderParams));else if(renderParams.showResults&&renderParams.records||renderParams.showResults&&renderParams.relevanceSearchRecordCollection&&renderParams.relevanceSearchRecordCollection.length>0)dataBlock.push(this.searchResultView.render(renderParams));else renderParams.showResults&&renderParams.relevanceSearchRecordCollection&&renderParams.relevanceSearchRecordCollection.length<=0&&dataBlock.push(this.searchErrorView.render(renderParams))}else{this.renderArticleAndContentControl(renderParams,dataBlock);this.overrideReferencePanelMaxHeight(renderParams)}var addPadding=!renderParams.isReferencePanel;if(!renderParams.isSearchMode){var header=renderParams.showLabel?renderParams.label:"";if(!renderParams.isReferencePanel&&MscrmCommon.ControlUtils.String.isNullOrEmpty(header))header=KbSearchControl.KbSearchControlLocale.KnowledgeSearch;if(!MscrmCommon.ControlUtils.String.isNullOrEmpty(header)){controlBlock=[];var headerTitle=this.CreateElement("text",{key:"headerLabel",className:"mscrm-kbSearchControlLabel",semanticTag:"h3",style:{marginTop:"6px",display:"block",fontSize:renderParams.theming.fontsizes.font100,fontFamily:renderParams.theming.fontfamilies.semibold,color:"#333333",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},header);controlBlock.push(this.CreateElement("CONTAINER",{id:"headerTitleContainer",key:"headerTitleContainer",style:{height:"38px",paddingTop:renderParams.theming.measures.measure075,borderBottom:"1px solid #D7D7D7"}},headerTitle))}}var controlBlockContainer=this.CreateElement("CONTAINER",{id:"controlBlockContainer",key:"controlBlockContainer",style:{flexDirection:"column",overflowY:"hidden",overflowX:"hidden",flexShrink:0,paddingLeft:addPadding?renderParams.theming.measures.measure100:"inherit",paddingRight:addPadding?renderParams.theming.measures.measure100:"inherit"}},controlBlock),searchAndDataBlockContainerId=KbSearchControl.Constants.SearchAndDataBlockContainerId,scrollingDataBlockContainer=this.CreateElement("SCROLLCONTAINER",{id:searchAndDataBlockContainerId,key:searchAndDataBlockContainerId,style:{flexDirection:"column",flexGrow:1,flexShrink:1,overflowY:"auto",overflowX:"hidden",paddingLeft:addPadding&&!renderParams.isSearchMode?renderParams.theming.measures.measure100:"inherit",paddingRight:addPadding&&!renderParams.isSearchMode?renderParams.theming.measures.measure100:"inherit"}},dataBlock),popup;renderParams.RequestRenderIfNecessary();var resultsAccessibilityContainer=this.renderResultsAccessibilityContainer(renderParams),errorAccessibilityContainer=this.renderErrorResultsAccessibilityContainer(renderParams),searchControlContainerId="searchControlContainer",controlMaxHeight="",overFlowYCalculated="hidden";if(renderParams.isReferencePanel||renderParams.isLoadedInProductivityPanel)controlMaxHeight="none";else if(window.IsUSD){controlMaxHeight=renderParams.controlMaxHeight+"px";overFlowYCalculated="auto"}else controlMaxHeight=renderParams.controlMaxHeight+"px";var result=this.CreateElement("CONTAINER",{id:searchControlContainerId,key:searchControlContainerId,className:"mscrm-kbSearchContainer",style:{width:"100%",height:"auto",minHeight:"inherit",display:"flex",flexDirection:"column",maxHeight:controlMaxHeight,backgroundColor:renderParams.theming.colors.whitebackground,overflowX:"hidden",overflowY:overFlowYCalculated,fontFamily:renderParams.theming.fontfamilies.regular},onKeyDown:function(event){return renderParams.OnKeyDownSkipContent(event)}},[controlBlockContainer,scrollingDataBlockContainer,popup,resultsAccessibilityContainer,errorAccessibilityContainer]);watermarkTelemetryEvent.End();return result};return StandardSearchControlView}(KbSearchControl.SearchControlView);KbSearchControl.StandardSearchControlView=StandardSearchControlView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchBoxContainerView=function(_super){__extends(SearchBoxContainerView,_super);function SearchBoxContainerView(){return _super!==null&&_super.apply(this,arguments)||this}SearchBoxContainerView.prototype.init=function(initParams){_super.prototype.init.call(this,initParams);this.HandleSearchBoxKeyPress=initParams.HandleSearchBoxKeyPress;this.HandleSearchBoxKeyDown=initParams.HandleSearchBoxKeyDown;this.HandleSearchBoxChange=initParams.HandleSearchBoxChange;this.HandleSearchBoxFocus=initParams.HandleSearchBoxFocus;this.HandleSearchBoxBlur=initParams.HandleSearchBoxBlur;this.HandleSearchButtonPress=initParams.HandleSearchButtonPress;this.HandleSearchButtonClick=initParams.HandleSearchButtonClick;this.HandleCloseButtonPress=initParams.HandleCloseButtonPress;this.HandleCloseButtonClick=initParams.HandleCloseButtonClick;this.HandleCloseAndSearchIconsVisibilty=initParams.HandleCloseAndSearchIconsVisibilty;return this};SearchBoxContainerView.prototype.render=function(renderParams){var watermarkTelemetryEvent=this.StartWatermarkEvent(KbSearchControl.Constants.WebresourceNameKbSearchControl,"renderSearchBoxContainer"),searchBoxRowChildren=[],searchTextBoxWidth="none",searchTextBoxId=KbSearchControl.Constants.SearchTextBoxId,textbox=this.CreateElement("TextInput",{id:searchTextBoxId,key:searchTextBoxId,style:{borderStyle:"none",paddingLeft:renderParams.theming.measures.measure050,paddingRight:renderParams.theming.measures.measure050,fontSize:renderParams.theming.fontsizes.font100,flexGrow:1,":focus":{outline:"none !important"},maxWidth:searchTextBoxWidth,"::-ms-clear":{display:"none"}},placeholder:KbSearchControl.KbSearchControlLocale.SearchBoxPlaceholder,onChange:this.HandleSearchBoxChange.bind(this),value:renderParams.searchText,disabled:renderParams.isControlDisabled,onKeyPress:this.HandleSearchBoxKeyPress.bind(this),onKeyDown:this.HandleSearchBoxKeyDown.bind(this),onFocus:this.HandleSearchBoxFocus.bind(this),onBlur:this.HandleSearchBoxBlur.bind(this),maxLength:2e3,accessibilityLabel:KbSearchControl.KbSearchControlLocale.SearchBoxAriaLabel}),isSearchIconHidden=!document.getElementById(this.GetUniqueId("microsoftIcon_searchButton_"))||document.getElementById(this.GetUniqueId("microsoftIcon_searchButton_")).style.display!=="none"?false:true,searchIconId="microsoftIcon_searchButton_",searchIcon=null;searchIcon=this.CreateElement("MICROSOFTICON",{id:searchIconId,accessibilityLabel:KbSearchControl.KbSearchControlLocale.SearchIconAltText,title:KbSearchControl.KbSearchControlLocale.SearchIconAltText,tabIndex:0,style:{cursor:"pointer"},key:searchIconId,hidden:isSearchIconHidden,onKeyDown:this.HandleSearchButtonPress.bind(this),onClick:this.HandleSearchButtonClick.bind(this),type:61,role:"button"});var closeIconId="microsoftIcon_closeButton_",closeIcon=this.CreateElement("MICROSOFTICON",{id:closeIconId,tabIndex:0,accessibilityLabel:KbSearchControl.KbSearchControlLocale.RemoveIconAltText,title:KbSearchControl.KbSearchControlLocale.RemoveIconAltText,style:{cursor:"pointer"},key:closeIconId,hidden:MscrmCommon.ControlUtils.String.isNullOrEmpty(renderParams.searchText),onKeyDown:this.HandleCloseButtonPress.bind(this),onClick:this.HandleCloseButtonClick.bind(this),type:97,role:"button"}),closeIconContainer=null,searchIconContainer=null;searchIconContainer=this.CreateElement("Container",{id:"searchIconContainer",key:"searchIconContainer",style:{display:"inline-flex",marginLeft:renderParams.isRTL?0:renderParams.theming.measures.measure050,marginRight:!renderParams.isRTL?0:renderParams.theming.measures.measure050,cursor:"pointer",fontSize:"16px",alignItems:"center"}},searchIcon);closeIconContainer=this.CreateElement("Container",{id:"closeIconContainer",key:"closeIconContainer",style:{display:"inline-flex",marginRight:renderParams.isRTL?0:renderParams.theming.measures.measure050,marginLeft:!renderParams.isRTL?0:renderParams.theming.measures.measure050,cursor:"pointer",fontSize:"16px",alignItems:"center"}},closeIcon);var hiddenActionSpan=this.CreateElement("LABEL",{id:"hiddenActionid",ref:"hiddenAction",style:{display:"none",fontSize:renderParams.theming.fontsizes.font100},className:"mscrm-hiddenSpan"}),searchContainerBoxWidth="100%",searchBoxContainerChildren=[searchIconContainer,textbox,closeIconContainer,hiddenActionSpan],searchBoxContainer=this.CreateElement("Container",{id:"searchBoxContainer",key:"searchBoxContainer",className:"mscrm-kbSearchBoxContainer",style:{marginTop:"",marginBottom:"",marginLeft:0,marginRight:0,border:renderParams.theming.borders.border02,"flex-grow":1,display:"inline-flex",maxWidth:searchContainerBoxWidth,paddingBottom:renderParams.theming.measures.measure025,paddingTop:renderParams.theming.measures.measure025}},searchBoxContainerChildren);searchBoxRowChildren.push(searchBoxContainer);this.HandleCloseAndSearchIconsVisibilty(renderParams.searchText);var result=this.CreateElement("Container",{id:"rendersearchboxrow",key:"searchbox",style:{display:"flex",width:"100%",alignSelf:renderParams.isExpandedMode?"center":"auto",flexdirection:"wrap",marginTop:renderParams.isCustomerEnabledForOct2020Wave?"0px":renderParams.theming.measures.measure075,marginBottom:renderParams.isFederatedSearchEnabled?renderParams.theming.measures.measure025:renderParams.theming.measures.measure075,minHeight:renderParams.theming.measures.measure225}},searchBoxRowChildren);watermarkTelemetryEvent.End();return result};return SearchBoxContainerView}(KbSearchControl.SearchView);KbSearchControl.SearchBoxContainerView=SearchBoxContainerView})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}))