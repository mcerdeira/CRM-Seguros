var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}(),MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var Constants=function(){function Constants(){}Constants.SEARCH_RESULT_ITEM_HEIGHT=255;Constants.LOAD_MORE_HEIGHT=36;Constants.OBJECT_TYPE_CODE_KNOWLEDGE_ARTICLE=9953;Constants.OBJECT_TYPE_CODE_ANNOTATION=5;Constants.ON_RESULT_OPENED="onresultopened";Constants.ON_SELECTION="onselection";Constants.ON_POST_SEARCH="onpostsearch";Constants.SELECTEDRESULT="SelectedResult";Constants.SearchEntityNameFacet="@search.entityname";Constants.MDFSearchEventName="MDFSearchEvent";Constants.MandatoryFieldKbLink="https://docs.microsoft.com/en-us/dynamics365/customer-engagement/customer-service/search-knowledge-articles-csh#before-you-begin-using-relevance-search";Constants.NumberOfResultsFoundResourceName="SearchWidget.SearchKMArticles.NumberOfResultsFoundText";Constants.TextAnalyticsResourceName="SearchWidget.Filters.TextAnalyticsText";Constants.FilterOpenTitleResourceName="SearchWidget.Filters.FilterOpenTitleText";Constants.FilterCloseTitleResourceName="SearchWidget.Filters.FilterCloseTitleText";Constants.FilterOpenAltTextResourceName="SearchWidget.Filters.FilterOpenAltText";Constants.FilterCloseAltTextResourceName="SearchWidget.Filters.FilterCloseAltText";Constants.FilterResourceName="SearchWidget.Filters.FilterText";Constants.userDefaultLanguageLocaleId="00000000-0000-0000-0000-000000000000";Constants.AutoSuggestionSourceFormField="0";Constants.AutoSuggestionSourceAnalyticsService="1";Constants.ArticleStateFilterTitleResourceName="SearchWidget.Filters.ArticleStateFilterTitleText";Constants.ArticleLanguageFilterTitleResourceName="SearchWidget.Filters.LanguageFilterTitleText";Constants.SortFilterTitleResourceName="SearchWidget.Filters.SortFilterTitleText";Constants.AutoSuggestionTitleResourceName="SearchWidget.SearchBox.AutoSuggestionTitleText";Constants.AutoSuggestionAltTextResourceName="SearchWidget.SearchBox.AutoSuggestionAltText";Constants.SearchBoxPlaceholderResourceName="SearchWidget.SearchBox.Placeholder";Constants.SearchIconAltTextResourceName="SearchWidget.SearchBox.SearchIconAltText";Constants.RemoveIconAltTextResourceName="SearchWidget.SearchBox.RemoveIconAltText";Constants.SearchBoxAriaLabelResourceName="SearchWidget.SearchBox.AriaLabel";Constants.FilterResultsByLabelResourceName="SearchWidget.Filters.Label.FilterResultBy";Constants.ArticleStatusFilterLabelResourceName="SearchWidget.Filters.Label.ArticleState";Constants.LanguageFilterLabelResourceName="SearchWidget.Filters.Label.Language";Constants.SortByLabelResourceName="SearchWidget.Filters.Label.SortBy";Constants.AllDraftArticlesResourceName="SearchWidget.Filters.AllDraftArticles";Constants.AllPublishedArticlesResourceName="SearchWidget.Filters.AllPublishedArticles";Constants.AllApprovedArticlesResourceName="SearchWidget.Filters.AllApprovedArticles";Constants.InternalArticlesResourceName="SearchWidget.Filters.InternalArticles";Constants.ExternalArticlesResourceName="SearchWidget.Filters.ExternalArticles";Constants.ArticleStatusFilterResourceName="SearchWidget.Filters.StatusFilter";Constants.ArticleVisibilityFilterResourceName="SearchWidget.Filters.VisibilityFilter";Constants.ArticleLanguageFilterResourceName="SearchWidget.Filters.LanguageFilter";Constants.ArticleDateFilterResourceName="SearchWidget.Filters.DateFilter";Constants.Last7DaysFilterResourceName="SearchWidget.Filters.Last7Days";Constants.Last30DaysFilterResourceName="SearchWidget.Filters.Last30Days";Constants.Last6MonthsFilterResourceName="SearchWidget.Filters.Last6Months";Constants.LastYearFilterResourceName="SearchWidget.Filters.LastYear";Constants.FilterOptionAllResourceName="SearchWidget.Filters.All";Constants.RelevanceResourceName="SearchWidget.Filters.Relevance";Constants.RatingResourceName="SearchWidget.Filters.Rating";Constants.NumberOfViewsResourceName="SearchWidget.Filters.NumberOfViews";Constants.LastModifiedDateNewestFirstResourceName="SearchWidget.Filters.LastModifiedDate.NewestFirst";Constants.LastModifiedDateOldestFirstResourceName="SearchWidget.Filters.LastModifiedDate.OldestFirst";Constants.LoadMoreButton="SearchWidget.SearchKMArticles.ShowMoreArticlesText";Constants.LoadingText="SearchWidget.SearchKMArticles.LoadingText";Constants.NoArticlesErrorMessageResourceName="SearchWidget.SearchKMArticles.NoArticlesErrorMessage";Constants.RecordDoesNotExistErrorMessageResourceName="SearchWidget.SearchKMArticles.RecordDoesNotExistErrorMessageResourceName";Constants.NoSearchErrorMessageResourceName="SearchWidget.SearchKMArticles.NoSearchErrorMessage";Constants.SearchAndSelectArticleMessageResourceName="SearchWidget.SearchKMArticles.SearchAndSelectArticleMessage";Constants.NoPermissionErrorMessageResourceName="SearchWidget.SearchKMArticles.NoPermissionErrorMessage";Constants.TextAnalyticsErrorMessageResourceName="SearchWidget.SearchKMArticles.TextAnalyticsErrorMessage";Constants.KnowledgeManagementNotEnabledErrorMessageResourceName="SearchWidget.SearchKMArticles.KnowledgeManagementNotEnabledErrorMessage";Constants.NumberOfRatingToolTip="SearchWidget.SearchKMArticles.NumberOfRatingToolTip";Constants.MandatoryFieldMissingErrorMessage="SearchWidget.SearchKMArticles.MandatoryFieldMissingErrorMessage";Constants.MandatoryFieldMissingLinkFormat="SearchWidget.SearchKMArticles.MandatoryFieldMissingLinkFormat";Constants.MandatoryFieldMissingLinkText="SearchWidget.SearchKMArticles.MandatoryFieldMissingLinkText";Constants.SavedQueryApiFailedErrorMessage="SearchWidget.SearchKMArticles.ServerFailure";Constants.KnowledgeSearch="SearchWidget.SearchKMArticles.KnowledgeSearch";Constants.SortedByText="SearchWidget.SearchKMArticles.SortedByText";Constants.StandalonePageTitle="SearchWidget.Standalone.PageTitle";Constants.EnterKeyValue="Enter";Constants.TabKeyCode=9;Constants.EnterKeyCode=13;Constants.EscapeKeyCode=27;Constants.SpaceKeyCode=32;Constants.UpArrowKeyCode=38;Constants.DownArrowKeyCode=40;Constants.Letter_E_KeyCode=69;Constants.ConfirmDialogTitle="SearchWidget.SearchKMArticles.ConfirmDialogTitle";Constants.ConfirmDialogTextResourceName="SearchWidget.SearchKMArticles.ConfirmDialogText";Constants.ContentPaneBackButtonLabelResourceName="SearchWidget.BackToSearchResult";Constants.ContentPaneBackButtonToolTip="SearchWidget.BackToSearchResult.Tooltip";Constants.ContentPaneBackButtonAltText="SearchWidget.BackToSearchResult.AltText";Constants.ModifiedOnLabelResourceName="SearchWidget.SearchKMArticles.LastModifiedDateLabel";Constants.ModifiedOnLabelToolTip="SearchWidget.SearchKMArticles.LastModifiedDateLabelToolTip";Constants.NumberOfViewsIconToolTip="SearchWidget.SearchKMArticles.NumberOfViewsToolTip";Constants.RatingIconToolTip="SearchWidget.SearchKMArticles.RatingIconToolTip";Constants.ArticleIconToolTipUnAssociated="SearchWidget.ArticleIconToolTip.UnAssociated";Constants.ArticleIconToolTipAssociated="SearchWidget.ArticleIconToolTip.Associated";Constants.ArticleTagLabelAssociated="SearchWidget.ArticleTagLabel.Associated";Constants.ResultStatusDraftResourceName="SearchWidget.Articles.Drafts";Constants.ResultStatusApprovedResourceName="SearchWidget.Articles.Approved";Constants.ResultStatusScheduledResourceName="SearchWidget.Articles.Scheduled";Constants.EnterKey=13;Constants.TabKey=9;Constants.SearchWidgetRelevanceSearchAdditionalMatches="SearchWidget.RelevanceSearch.AdditionalMatches";Constants.SearchWidgetRelevanceSearchAnnotationMatchCount="SearchWidget.RelevanceSearch.AnnotationMatchCount";Constants.SearchWidgetRelevanceSearchWarningTitle="SearchWidget.RelevanceSearch.WarningTitle";Constants.SearchWidgetRelevanceSearchNotesMatchCount="SearchWidget.RelevanceSearch.AnnotationNotesMatchCount";Constants.SearchWidgetRelevanceSearchNotesAttachmentMatchCount="SearchWidget.RelevanceSearch.AnnotationNotesAttachmentMatchCount";Constants.QuickFindDocumentationHelpLink="SearchWidget.SearchKMArticles.DocumentationHelpLink";Constants.AttachmentFileName="filename";Constants.AttachmentBody="documentbody";Constants.NoteSubject="subject";Constants.NoteText="notetext";Constants.MDFLabelText="SearchWidget.SearchKMArticles.MDFText";Constants.MDFTooltipText="SearchWidget.SearchKMArticles.MDFTooltip";Constants.MoreActionsTextResourceName="SearchWidget.AccessibilityText.MoreActionsText";Constants.ContentPaneTextResourceName="SearchWidget.AccessibilityText.ContentPaneText";Constants.AllDraftArticlesDescriptor="2";Constants.AllPublishedArticlesDescriptor="3";Constants.AllApprovedArticlesDescriptor="6";Constants.CrmHitStartTag="{crmhit}";Constants.CrmHitEndTag="{/crmhit}";Constants.NormalStyle={color:"inherit",fontStyle:"normal",cursor:"inherit"};Constants.CrmHitStyle={background:"yellow",cursor:"inherit"};Constants.PopupPrefixId="Popup";Constants.SearchTextBoxId="SearchTextBox";Constants.SearchAndDataBlockContainerId="SearchAndDataBlockContainer";Constants.ContentPaneArticleContentContainerPrefix="ContentPaneArticleContentContainer";Constants.knowledgearticleEntityType="knowledgearticle";Constants.MaxCharacterAllowedInKbToolTip=1e3;Constants.ArticleFooterTextColorWhenSelected="#333333";Constants.KMSimpleRelevanceSearch="KMSimpleRelevanceSearch";Constants.UCKMControlRelevanceSearch="UCKMControlRelevanceSearch";Constants.MetadataDrivenFilterForKbSearch="MetadataDrivenFilterForKbSearch";Constants.KMRefreshSearchUI="KMRefreshUI";Constants.RelevanceSortId="KMSortRelevance";Constants.NumberOfViewsLocaleSortId="KMSortNumberOfViewsLocale";Constants.LastModifiedDateNewestFirstLocaleSortId="KMSortLastModifiedDateNewestFirstLocale";Constants.LastModifiedDateOldestFirstLocaleSortId="KMSortLastModifiedDateOldestFirstLocale";Constants.SortIconId="KM_sortIcon";Constants.FilterIconId="KM_filterIcon";Constants.ShowSelectedIconId="KM_showSelectedIcon";Constants.IconIdButtonPostfix="_Button";Constants.IconIdContainerPostfix="_Container";Constants.PublishedState="Published";Constants.NumberofResults=10;Constants.knowledgearticleid="knowledgearticleid";Constants.articlepublicnumber="articlepublicnumber";Constants.title="title";Constants.description="description";Constants.content="content";Constants.knowledgearticleviews="knowledgearticleviews";Constants.createdon="createdon";Constants.modifiedon="modifiedon";Constants.statecode="statecode";Constants.statuscode="statuscode";Constants.expirationdate="expirationdate";Constants.languagelocaleid="languagelocaleid";Constants.majorversionnumber="majorversionnumber";Constants.minorversionnumber="minorversionnumber";Constants.islatestversion="islatestversion";Constants.rating="rating";Constants.isinternal="isinternal";Constants.keywords="keywords";Constants.objecttypecode="objecttypecode";Constants.IsInternal="1";Constants.IsExternal="0";Constants.ArticleStatusFilter="ArticleStatusFilter";Constants.ArticleVisibilityFilter="ArticleVisibilityFilter";Constants.ArticleLanguageFilter="ArticleLanguageFilter";Constants.ArticleDateFilter="ArticleDateFilter";Constants.ExtraQueryString="extraqs";Constants.KBSearchFilter="kbsearchfilter";Constants.ShowFilterString="showFilter";Constants.KBSearchFilterOff="off";Constants.ShowFilterOff="0";Constants.Colon=":";Constants.KnowledgeArticle_MandatoryFields=[Constants.articlepublicnumber,Constants.title,Constants.content,Constants.createdon,Constants.keywords,Constants.knowledgearticleviews,Constants.languagelocaleid,Constants.majorversionnumber,Constants.minorversionnumber,Constants.rating,Constants.statecode,Constants.modifiedon];Constants.Annotation_MandatoryFields=[Constants.objecttypecode];Constants.ArticleState={Draft:"0",Approved:"1",Published:"3"};Constants.SearchWidgetEventMapping={0:"SearchPerformed",1:"LanguageFilterUsed",2:"ArticleStateFilterUsed",3:"SortChanged",4:"FirstPageFirstResultSelected",5:"FirstPageOtherResultSelected",6:"OtherPageOtherResultSelected",7:"BackButtonClickedWithoutAction",8:"ShowMoreClicked",9:"LinkButtonClicked",10:"LinkAndEmailButtonClicked",11:"LinkAndEmailContentButtonClicked",12:"CopyLinkButtonClicked",13:"SendToCTIClicked",14:"FullTextSearchCompleted"};Constants.GLOBAL_NOTIFICATION_TYPE_TOAST=1;Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS=1;Constants.GLOBAL_NOTIFICATION_LEVEL_WARNING=3;Constants.WebresourceNameKbSearchControl="KbSearchControl";Constants.WebresourceNameKbSearchActions="KbSearchActions";Constants.WebresourceNameFullTextSearchActions="KbFullTextSearchActions";Constants.WebresourceNameRelevanceSearchActions="KbRelevanceSearchActions";Constants.WebresourceNameGetKbArticlesSearchActions="KbGetKbArticlesSearchActions";Constants.WebresourceNameKbSearchResultLegends="KbSearchResultLegends";Constants.WebresourceNameKbSearchResults="KbSearchResults";Constants.WebresourceNameSearchBoxContainer="SearchBoxContainer";Constants.WebresourceNameSearchResultActionsDropdown="SearchResultActionsDropdown";Constants.WebresourceNameSearchResultActionsUIEnhancement="SearchResultActionsUIEnhancement";Constants.WebresourceNameExecuteKbSearchHelper="ExecuteKbSearchHelper";Constants.ODATA_PATH="/api/data/v9.0";Constants.URL_KA_TITLE_CONTENT="/knowledgearticles?$select=content&$filter=knowledgearticleid eq {0}";Constants.SORT_BY_NUMBER_OF_VIEWS="knowledgearticleviews";Constants.Incident="incident";Constants.KnowledgeArticleIncident="knowledgearticleincident";Constants.KnowledgeArticleId="knowledgearticleid";Constants.EntityName="knowledgearticle";Constants.LanguageLocale="languagelocale";Constants.LanguageLocaleId="languagelocaleid";Constants.IncidentRelationshipName="knowledgearticlescategories";Constants.ServerSearchFailure="SearchWidget.SearchKMArticles.ServerFailure";Constants.ViewDateFormat="YYYY-MM-DD";Constants.ConditionOperatorMapping={0:"Equal",1:"NotEqual",2:"GreaterThan",3:"LessThan",4:"GreaterEqual",5:"LessEqual",6:"Like",7:"NotLike",8:"In",17:"Last7Days",22:"LastMonth",28:"LastYear",33:"LastXDays",39:"LastXYears",37:"LastXMonths",82:"OlderThanXYears"};Constants.LogicalOperatorMapping={0:"And",1:"Or"};Constants.ActiveLanguagesFetchXml="<fetch mapping='logical' distinct='true' version='1.0'> <entity name='knowledgearticle'> <attribute name='languagelocaleid' alias='languagelocaleid' /> <filter> <condition attribute='statecode' operator='in'> <value>0</value> <value>1</value> <value>2</value> <value>3</value> </condition> </filter> <link-entity name='languagelocale' from='languagelocaleid' to='languagelocaleid' link-type='inner'> <attribute name='name' alias='name' /> </link-entity> </entity> </fetch>";Constants.KnowledgeArticleViewCountWebLocation={Dynamics:1,Portal:2};return Constants}();KbSearchControl.Constants=Constants})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var SearchWidgetEvent;(function(SearchWidgetEvent){SearchWidgetEvent[SearchWidgetEvent["SearchPerformed"]=0]="SearchPerformed";SearchWidgetEvent[SearchWidgetEvent["LanguageFilterUsed"]=1]="LanguageFilterUsed";SearchWidgetEvent[SearchWidgetEvent["ArticleStateFilterUsed"]=2]="ArticleStateFilterUsed";SearchWidgetEvent[SearchWidgetEvent["SortChanged"]=3]="SortChanged";SearchWidgetEvent[SearchWidgetEvent["FirstPageFirstResultSelected"]=4]="FirstPageFirstResultSelected";SearchWidgetEvent[SearchWidgetEvent["FirstPageOtherResultSelected"]=5]="FirstPageOtherResultSelected";SearchWidgetEvent[SearchWidgetEvent["OtherPageOtherResultSelected"]=6]="OtherPageOtherResultSelected";SearchWidgetEvent[SearchWidgetEvent["BackButtonClickedWithoutAction"]=7]="BackButtonClickedWithoutAction";SearchWidgetEvent[SearchWidgetEvent["ShowMoreClicked"]=8]="ShowMoreClicked";SearchWidgetEvent[SearchWidgetEvent["LinkButtonClicked"]=9]="LinkButtonClicked";SearchWidgetEvent[SearchWidgetEvent["LinkAndEmailButtonClicked"]=10]="LinkAndEmailButtonClicked";SearchWidgetEvent[SearchWidgetEvent["LinkAndEmailContentButtonClicked"]=11]="LinkAndEmailContentButtonClicked";SearchWidgetEvent[SearchWidgetEvent["CopyLinkButtonClicked"]=12]="CopyLinkButtonClicked";SearchWidgetEvent[SearchWidgetEvent["SendToCTIButtonClicked"]=13]="SendToCTIButtonClicked";SearchWidgetEvent[SearchWidgetEvent["FullTextSearchCompleted"]=14]="FullTextSearchCompleted";SearchWidgetEvent[SearchWidgetEvent["RelevanceSearchCompleted"]=15]="RelevanceSearchCompleted"})(SearchWidgetEvent=KbSearchControl.SearchWidgetEvent||(KbSearchControl.SearchWidgetEvent={}));var SearchWidgetCommand;(function(SearchWidgetCommand){SearchWidgetCommand[SearchWidgetCommand["ArticlesFilter"]=0]="ArticlesFilter";SearchWidgetCommand[SearchWidgetCommand["LanguageFilter"]=1]="LanguageFilter";SearchWidgetCommand[SearchWidgetCommand["SortFilter"]=2]="SortFilter"})(SearchWidgetCommand=KbSearchControl.SearchWidgetCommand||(KbSearchControl.SearchWidgetCommand={}));var ArticleStatusFilterOption;(function(ArticleStatusFilterOption){ArticleStatusFilterOption[ArticleStatusFilterOption["Draft"]=0]="Draft";ArticleStatusFilterOption[ArticleStatusFilterOption["Approved"]=1]="Approved";ArticleStatusFilterOption[ArticleStatusFilterOption["Published"]=3]="Published"})(ArticleStatusFilterOption=KbSearchControl.ArticleStatusFilterOption||(KbSearchControl.ArticleStatusFilterOption={}));var SearchResultSortOption;(function(SearchResultSortOption){SearchResultSortOption[SearchResultSortOption["Relevance"]=1]="Relevance";SearchResultSortOption[SearchResultSortOption["Rating"]=2]="Rating";SearchResultSortOption[SearchResultSortOption["NumberOfViews"]=3]="NumberOfViews";SearchResultSortOption[SearchResultSortOption["LastModifiedDateOldestFirst"]=4]="LastModifiedDateOldestFirst";SearchResultSortOption[SearchResultSortOption["LastModifiedDateNewestFirst"]=5]="LastModifiedDateNewestFirst"})(SearchResultSortOption=KbSearchControl.SearchResultSortOption||(KbSearchControl.SearchResultSortOption={}));var SearchType;(function(SearchType){SearchType[SearchType["None"]=0]="None";SearchType[SearchType["FullTextSearch"]=1]="FullTextSearch";SearchType[SearchType["RelevanceSearch"]=2]="RelevanceSearch";SearchType[SearchType["GetkbArticle"]=3]="GetkbArticle"})(SearchType=KbSearchControl.SearchType||(KbSearchControl.SearchType={}));var Browsers;(function(Browsers){Browsers[Browsers["Others"]=0]="Others";Browsers[Browsers["Chrome"]=1]="Chrome";Browsers[Browsers["Firefox"]=2]="Firefox";Browsers[Browsers["IE"]=3]="IE";Browsers[Browsers["Safari"]=4]="Safari";Browsers[Browsers["Edge"]=5]="Edge"})(Browsers=KbSearchControl.Browsers||(KbSearchControl.Browsers={}));var ConditionOperator;(function(ConditionOperator){ConditionOperator[ConditionOperator["Equal"]=0]="Equal";ConditionOperator[ConditionOperator["NotEqual"]=1]="NotEqual";ConditionOperator[ConditionOperator["GreaterThan"]=2]="GreaterThan";ConditionOperator[ConditionOperator["LessThan"]=3]="LessThan";ConditionOperator[ConditionOperator["GreaterEqual"]=4]="GreaterEqual";ConditionOperator[ConditionOperator["LessEqual"]=5]="LessEqual";ConditionOperator[ConditionOperator["Like"]=6]="Like";ConditionOperator[ConditionOperator["NotLike"]=7]="NotLike";ConditionOperator[ConditionOperator["In"]=8]="In";ConditionOperator[ConditionOperator["NotIn"]=9]="NotIn";ConditionOperator[ConditionOperator["Between"]=10]="Between";ConditionOperator[ConditionOperator["NotBetween"]=11]="NotBetween";ConditionOperator[ConditionOperator["Null"]=12]="Null";ConditionOperator[ConditionOperator["NotNull"]=13]="NotNull";ConditionOperator[ConditionOperator["Yesterday"]=14]="Yesterday";ConditionOperator[ConditionOperator["Today"]=15]="Today";ConditionOperator[ConditionOperator["Tomorrow"]=16]="Tomorrow";ConditionOperator[ConditionOperator["Last7Days"]=17]="Last7Days";ConditionOperator[ConditionOperator["Next7Days"]=18]="Next7Days";ConditionOperator[ConditionOperator["LastWeek"]=19]="LastWeek";ConditionOperator[ConditionOperator["ThisWeek"]=20]="ThisWeek";ConditionOperator[ConditionOperator["NextWeek"]=21]="NextWeek";ConditionOperator[ConditionOperator["LastMonth"]=22]="LastMonth";ConditionOperator[ConditionOperator["ThisMonth"]=23]="ThisMonth";ConditionOperator[ConditionOperator["NextMonth"]=24]="NextMonth";ConditionOperator[ConditionOperator["On"]=25]="On";ConditionOperator[ConditionOperator["OnOrBefore"]=26]="OnOrBefore";ConditionOperator[ConditionOperator["OnOrAfter"]=27]="OnOrAfter";ConditionOperator[ConditionOperator["LastYear"]=28]="LastYear";ConditionOperator[ConditionOperator["ThisYear"]=29]="ThisYear";ConditionOperator[ConditionOperator["NextYear"]=30]="NextYear";ConditionOperator[ConditionOperator["LastXHours"]=31]="LastXHours";ConditionOperator[ConditionOperator["NextXHours"]=32]="NextXHours";ConditionOperator[ConditionOperator["LastXDays"]=33]="LastXDays";ConditionOperator[ConditionOperator["NextXDays"]=34]="NextXDays";ConditionOperator[ConditionOperator["LastXWeeks"]=35]="LastXWeeks";ConditionOperator[ConditionOperator["NextXWeeks"]=36]="NextXWeeks";ConditionOperator[ConditionOperator["LastXMonths"]=37]="LastXMonths";ConditionOperator[ConditionOperator["NextXMonths"]=38]="NextXMonths";ConditionOperator[ConditionOperator["LastXYears"]=39]="LastXYears";ConditionOperator[ConditionOperator["NextXYears"]=40]="NextXYears";ConditionOperator[ConditionOperator["EqualUserId"]=41]="EqualUserId";ConditionOperator[ConditionOperator["NotEqualUserId"]=42]="NotEqualUserId";ConditionOperator[ConditionOperator["EqualBusinessId"]=43]="EqualBusinessId";ConditionOperator[ConditionOperator["NotEqualBusinessId"]=44]="NotEqualBusinessId";ConditionOperator[ConditionOperator["ChildOf"]=45]="ChildOf";ConditionOperator[ConditionOperator["Mask"]=46]="Mask";ConditionOperator[ConditionOperator["NotMask"]=47]="NotMask";ConditionOperator[ConditionOperator["MasksSelect"]=48]="MasksSelect";ConditionOperator[ConditionOperator["Contains"]=49]="Contains";ConditionOperator[ConditionOperator["DoesNotContain"]=50]="DoesNotContain";ConditionOperator[ConditionOperator["EqualUserLanguage"]=51]="EqualUserLanguage";ConditionOperator[ConditionOperator["NotOn"]=52]="NotOn";ConditionOperator[ConditionOperator["OlderThanXMonths"]=53]="OlderThanXMonths";ConditionOperator[ConditionOperator["BeginsWith"]=54]="BeginsWith";ConditionOperator[ConditionOperator["DoesNotBeginWith"]=55]="DoesNotBeginWith";ConditionOperator[ConditionOperator["EndsWith"]=56]="EndsWith";ConditionOperator[ConditionOperator["DoesNotEndWith"]=57]="DoesNotEndWith";ConditionOperator[ConditionOperator["ThisFiscalYear"]=58]="ThisFiscalYear";ConditionOperator[ConditionOperator["ThisFiscalPeriod"]=59]="ThisFiscalPeriod";ConditionOperator[ConditionOperator["NextFiscalYear"]=60]="NextFiscalYear";ConditionOperator[ConditionOperator["NextFiscalPeriod"]=61]="NextFiscalPeriod";ConditionOperator[ConditionOperator["LastFiscalYear"]=62]="LastFiscalYear";ConditionOperator[ConditionOperator["LastFiscalPeriod"]=63]="LastFiscalPeriod";ConditionOperator[ConditionOperator["LastXFiscalYears"]=64]="LastXFiscalYears";ConditionOperator[ConditionOperator["LastXFiscalPeriods"]=65]="LastXFiscalPeriods";ConditionOperator[ConditionOperator["NextXFiscalYears"]=66]="NextXFiscalYears";ConditionOperator[ConditionOperator["NextXFiscalPeriods"]=67]="NextXFiscalPeriods";ConditionOperator[ConditionOperator["InFiscalYear"]=68]="InFiscalYear";ConditionOperator[ConditionOperator["InFiscalPeriod"]=69]="InFiscalPeriod";ConditionOperator[ConditionOperator["InFiscalPeriodAndYear"]=70]="InFiscalPeriodAndYear";ConditionOperator[ConditionOperator["InOrBeforeFiscalPeriodAndYear"]=71]="InOrBeforeFiscalPeriodAndYear";ConditionOperator[ConditionOperator["InOrAfterFiscalPeriodAndYear"]=72]="InOrAfterFiscalPeriodAndYear";ConditionOperator[ConditionOperator["EqualUserTeams"]=73]="EqualUserTeams";ConditionOperator[ConditionOperator["EqualUserOrUserTeams"]=74]="EqualUserOrUserTeams";ConditionOperator[ConditionOperator["Under"]=75]="Under";ConditionOperator[ConditionOperator["NotUnder"]=76]="NotUnder";ConditionOperator[ConditionOperator["UnderOrEqual"]=77]="UnderOrEqual";ConditionOperator[ConditionOperator["Above"]=78]="Above";ConditionOperator[ConditionOperator["AboveOrEqual"]=79]="AboveOrEqual";ConditionOperator[ConditionOperator["EqualUserOrUserHierarchy"]=80]="EqualUserOrUserHierarchy";ConditionOperator[ConditionOperator["EqualUserOrUserHierarchyAndTeams"]=81]="EqualUserOrUserHierarchyAndTeams";ConditionOperator[ConditionOperator["OlderThanXYears"]=82]="OlderThanXYears";ConditionOperator[ConditionOperator["OlderThanXWeeks"]=83]="OlderThanXWeeks";ConditionOperator[ConditionOperator["OlderThanXDays"]=84]="OlderThanXDays";ConditionOperator[ConditionOperator["OlderThanXHours"]=85]="OlderThanXHours";ConditionOperator[ConditionOperator["OlderThanXMinutes"]=86]="OlderThanXMinutes"})(ConditionOperator=KbSearchControl.ConditionOperator||(KbSearchControl.ConditionOperator={}));var LogicalOperator;(function(LogicalOperator){LogicalOperator[LogicalOperator["And"]=0]="And";LogicalOperator[LogicalOperator["Or"]=1]="Or"})(LogicalOperator=KbSearchControl.LogicalOperator||(KbSearchControl.LogicalOperator={}));var DateFilterOptions;(function(DateFilterOptions){DateFilterOptions[DateFilterOptions["Last7Days"]=17]="Last7Days";DateFilterOptions[DateFilterOptions["LastXDays"]=33]="LastXDays";DateFilterOptions[DateFilterOptions["LastXYears"]=39]="LastXYears";DateFilterOptions[DateFilterOptions["LastXMonths"]=37]="LastXMonths"})(DateFilterOptions=KbSearchControl.DateFilterOptions||(KbSearchControl.DateFilterOptions={}))})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var EventName="ucikbsearchcontrol",KbSearchEventTelemetry=function(){function KbSearchEventTelemetry(controlAction){this.eventName=EventName;this.eventParameters=[{name:"Action",value:controlAction},{name:"EventTime",value:new Date}]}KbSearchEventTelemetry.reportEvent=function(context,event){if(context===null)return;context.reporting.reportEvent(event)};return KbSearchEventTelemetry}();KbSearchControl.KbSearchEventTelemetry=KbSearchEventTelemetry})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchResult=function(){function KbSearchResult(kbSearchRecord){this.kbSearchRecord=kbSearchRecord;this.isMenuVisible=false}return KbSearchResult}();KbSearchControl.KbSearchResult=KbSearchResult})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var StateManager=function(){function StateManager(){this.IsActionPerformedOnFirstResult=false;this.popupEnabled=false;this.isSearchMode=true;this.shouldShowSelected=false;this.showResultCount=false;this.requestAdditionalRendering=false;this.filtersVisible=false;this.relations=null;this.loading=true;this.canCallRelevanceSearch=true;this.isMakeAdditionalCallToGetArticleDetails=true;this.selectedStateCode=null;this.isArticleStatusFilterExpanded=false;this.selectedVisibility=null;this.isArticleVisibilityFilterExpanded=false;this.selectedDateRange=null;this.isArticleDateFilterExpanded=false;this.selectedLanguage=null;this.isArticleLanguageFilterExpanded=false;this.shouldFiltersGainDefaultFocus=false;this.selectedArticle=null;this.kbSearchResultCollection=[];this.isSavedQueryApiFailed=false}StateManager.Instance=function(controlId,initializingControl){if(initializingControl===void 0)initializingControl=false;if(!StateManager._stateManager[controlId]||initializingControl)StateManager._stateManager[controlId]=new StateManager;return StateManager._stateManager[controlId]};Object.defineProperty(StateManager.prototype,"IsExpandedMode",{"get":function(){return this._context.client.allocatedWidth>=parseInt(this._context.theming.breakpoints.dimensionm,10)},enumerable:true,configurable:true});Object.defineProperty(StateManager.prototype,"IsPopupRenderedInExpandedMode",{"get":function(){var popupSearchControlContainer=document.getElementById(this._context.accessibility.getUniqueId("popupsearchControlContainer"));if(!popupSearchControlContainer)return false;return popupSearchControlContainer.clientWidth>=parseInt(this._context.theming.breakpoints.dimensionm,10)},enumerable:true,configurable:true});StateManager.prototype.GetkbSearchResultArticleInfoObject=function(){if(!this.kbSearchResultArticleInfoObject)this.kbSearchResultArticleInfoObject=new MscrmControls.KbArticleControl.KbArticleControl;return this.kbSearchResultArticleInfoObject};StateManager.prototype.LoadSelectedArticles=function(){if(!(this._context.parameters.DialogContext&&this._context.parameters.DialogContext.isMultiSelect)){this.shouldShowSelected=false;return}var dictionary=this._context.parameters.DialogContext.SelectedRecords,totalCount=Object.keys(dictionary).length,kbSearchRecords=Array();for(var key in dictionary){var value=dictionary[key];kbSearchRecords.push(value.record)}this.records=kbSearchRecords;this.recordIds=kbSearchRecords.map(function(record){return record.knowledgeArticleId});this.loading=false;this.totalCount=totalCount;this.ExecuteKbSearchHelper.SearchHasBeenPerformed=true;this._context.parameters.value.isControlDisabled=false};StateManager.prototype.GetkbSearchResultContentPaneObject=function(){if(!this.kbSearchResultContentPaneObject)this.kbSearchResultContentPaneObject=new MscrmControls.KbContentControl.KbContentControl;return this.kbSearchResultContentPaneObject};StateManager.prototype.GetIsSearchMode=function(){return !this._context.parameters.value.hideSearchOnRecordLoad&&this.isSearchMode};StateManager.prototype.SetIsSearchMode=function(isSearchMode,context){this.isSearchMode=isSearchMode;!isSearchMode&&this.CallResultOpenedNotifyHandler(context)};StateManager.prototype.getShowResults=function(context){return !this.loading&&this.ExecuteKbSearchHelper.SearchHasBeenPerformed};StateManager.prototype.setShowResults=function(showResults){this.showResultCount=showResults};StateManager.prototype.GetSelectedArticle=function(){if(this._context.parameters.value.hideSearchOnRecordLoad){this.records=this._context.parameters.value.records;return this.records[0]}return this.selectedArticle};StateManager.prototype.SetSelectedArticle=function(selectedKbSearchRecord,context){this.selectedArticle=selectedKbSearchRecord;context.parameters.value.executeNotifyHandlersThatEventOccurred({eventName:KbSearchControl.Constants.ON_SELECTION,fieldName:context.parameters.value.controlId,pageId:context.parameters.value.pageId,contextToken:context.parameters.value.contextToken,record:this.selectedArticle});MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(MscrmControls.KbCommonUtils.ArticleAction.SelectedResult,{controlContext:context,record:this.selectedArticle,stateManager:this})};StateManager.prototype.UpdateSelectedArticleDetails=function(context){if(this._context.parameters.value.hideSearchOnRecordLoad)return;if(!this.GetSelectedArticle())return;var selectedknowledgeArticleId=this.GetSelectedArticle().knowledgeArticleId,records=this.records;if(records&&records.length>0)for(var i=0;i<records.length;i++)if(records[i]["knowledgeArticleId"]==selectedknowledgeArticleId){this.selectedArticle.knowledgeArticleViews=records[i].knowledgeArticleViews;break}};StateManager.prototype.GetKbSearchResultCollection=function(){return this.kbSearchResultCollection};StateManager.prototype.GetKbSearchResult=function(kbSearchRecord){var matchingKbSearchResultCollection=this.kbSearchResultCollection.filter(function(kbSearchResult){return kbSearchResult.kbSearchRecord.knowledgeArticleId===kbSearchRecord.knowledgeArticleId});if(matchingKbSearchResultCollection.length>0)return matchingKbSearchResultCollection[0];return null};StateManager.prototype.AddKbSearchResult=function(value){var matchingKbSearchResultCollection=this.kbSearchResultCollection.filter(function(kbSearchResult){return kbSearchResult.kbSearchRecord.knowledgeArticleId===value.knowledgeArticleId});matchingKbSearchResultCollection.length===0&&this.kbSearchResultCollection.push(new KbSearchControl.KbSearchResult(value))};StateManager.prototype.ReportEventToTelemetry=function(actionName){var kbSearchControlEvent=new KbSearchControl.KbSearchEventTelemetry(actionName);KbSearchControl.KbSearchEventTelemetry.reportEvent(this._context,kbSearchControlEvent)};StateManager.prototype.InitializeModels=function(context){this._context=context;this.ArticleStatusFilter=new KbSearchControl.ArticleStatusFilter(context);this.ArticleLanguageFilter=new KbSearchControl.ArticleLanguageFilter(context);this.SortFilter=new KbSearchControl.SortFilter(context);this.ExecuteKbSearchHelper=new KbSearchControl.ExecuteKbSearchHelper(context)};StateManager.prototype.CallResultOpenedNotifyHandler=function(context){context.parameters.value.executeNotifyHandlersThatEventOccurred({eventName:KbSearchControl.Constants.ON_RESULT_OPENED,fieldName:context.parameters.value.controlId,pageId:context.parameters.value.pageId,contextToken:context.parameters.value.contextToken,record:this.selectedArticle})};StateManager.prototype.ResetSelectedArticle=function(){this.selectedArticle=null};StateManager.prototype.getRelevanceSearchRecordsToDisplay=function(){if(this.ExecuteKbSearchHelper.mode===2)return this.kbRelevanceSearchRecordCollection;var currentPageNumber=this.ExecuteKbSearchHelper.currentPageNumber,numOfResults=this.ExecuteKbSearchHelper.numberOfResults,kbDisplayRelevanceSearchRecordCollection=[];if(!currentPageNumber||!numOfResults)return kbDisplayRelevanceSearchRecordCollection;var maxResultsToDisplay=Math.min(currentPageNumber*numOfResults,this.kbRelevanceSearchRecordCollection.length);kbDisplayRelevanceSearchRecordCollection=this.kbRelevanceSearchRecordCollection.slice(0,maxResultsToDisplay);return kbDisplayRelevanceSearchRecordCollection};StateManager.prototype.saveState=function(state){state.sortOption=this.SortFilter.SelectedSortFilterBySortOption();state.statusFilterOption=this.selectedStateCode;state.visibilityFilterOption=this.selectedVisibility;state.dateFilterOption=this.selectedDateRange;state.selectedLanguage=this.selectedLanguage;state.areFiltersVisible=this.filtersVisible;state.isStatusFilterOpen=this.isArticleStatusFilterExpanded;state.isVisibilityFilterOpen=this.isArticleVisibilityFilterExpanded;state.isDateFilterOpen=this.isArticleDateFilterExpanded;state.isLanguageFilterOpen=this.isArticleLanguageFilterExpanded;state.canCallRelevanceSearch=this.canCallRelevanceSearch;state.loading=this.loading;state.records=this.records;state.recordIds=this.recordIds;state.totalCount=this.totalCount;state.selectedArticle=this.selectedArticle;state.isSearchMode=this.isSearchMode;state.relevanceSearchRecords=this.relevanceSearchRecords;state.matchedkbSearchRecords=this.matchedkbSearchRecords;state.associatedArticles=this.associatedArticles;state.kbRelevanceSearchRecordCollection=this.kbRelevanceSearchRecordCollection;state.kbSearchResultCollection=this.kbSearchResultCollection;state.error=this.error;state.errorMessage=this.errorMessage;state.errorDetails=this.errorDetails;state.isSavedQueryApiFailed=this.isSavedQueryApiFailed;if(this.ArticleLanguageFilter)state.articleSelectLanguageOption=this.ArticleLanguageFilter.SelectLanguageOption;if(this.ExecuteKbSearchHelper)state.searchHelperState=this.ExecuteKbSearchHelper.saveSearchHelperState();else state.searchHelperState=null};StateManager.prototype.restoreState=function(state){this.records=state.records;this.recordIds=state.recordIds;this.SortFilter.SetSelectedSortFilterBySortOption(state.sortOption);this.selectedStateCode=state.statusFilterOption;this.selectedVisibility=state.visibilityFilterOption;this.selectedDateRange=state.dateFilterOption;this.selectedLanguage=state.selectedLanguage;this.filtersVisible=state.areFiltersVisible;this.isArticleStatusFilterExpanded=state.isStatusFilterOpen;this.isArticleVisibilityFilterExpanded=state.isVisibilityFilterOpen;this.isArticleDateFilterExpanded=state.isDateFilterOpen;this.isArticleLanguageFilterExpanded=state.isLanguageFilterOpen;this.canCallRelevanceSearch=state.canCallRelevanceSearch;this.totalCount=state.totalCount;this.selectedArticle=state.selectedArticle;this.isSearchMode=state.isSearchMode;this.relevanceSearchRecords=state.relevanceSearchRecords;this.matchedkbSearchRecords=state.matchedkbSearchRecords;this.associatedArticles=state.associatedArticles;this.kbRelevanceSearchRecordCollection=state.kbRelevanceSearchRecordCollection;this.kbSearchResultCollection=state.kbSearchResultCollection;this.error=state.error;this.errorMessage=state.errorMessage;this.errorDetails=state.errorDetails;this.isSavedQueryApiFailed=state.isSavedQueryApiFailed;if(this.ArticleLanguageFilter)this.ArticleLanguageFilter.SelectLanguageOption=state.articleSelectLanguageOption;var searchHelperState=state.searchHelperState;searchHelperState&&this.ExecuteKbSearchHelper&&this.ExecuteKbSearchHelper.restoreSearchHelperState(searchHelperState)};StateManager._stateManager={};return StateManager}();KbSearchControl.StateManager=StateManager})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl_1){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,SHOW_TITLE_MATCHES=false,KbSearchControl=function(){function KbSearchControl(){this.hiddenSpanWidthValue=53;this.hiddenSpanReflowWidthValue=52;this.kbRelevanceSearchRecordCollection=[];this.activeLanguages=[];this.executeLanguageFetchXml=true;this.promiseResolved=false;this.langFetchXmlResult=null;this.kbSearchResultAccessibilityText="";this.kbSearchErrorAccessibilityText="";this.searchUIEnhancementsEnabled=false;this.isInitialFocusSetOnStandAloneMode=false}Object.defineProperty(KbSearchControl.prototype,"Context",{"get":function(){return this._context},"set":function(value){var _this_1=this;this._context=value;if(this._context.parameters.value.hideSearchOnRecordLoad)this._stateManager.records=this._context.parameters.value.records;var kbSearchRecordCollection=this._stateManager.records;kbSearchRecordCollection&&kbSearchRecordCollection.forEach(function(kbSearchRecord){_this_1._stateManager.AddKbSearchResult(kbSearchRecord)})},enumerable:true,configurable:true});Object.defineProperty(KbSearchControl.prototype,"IsEdgeOrIE",{"get":function(){return this.Context.client.userAgent.isBrowserIE||navigator.userAgent.indexOf("Edge")>-1},enumerable:true,configurable:true});KbSearchControl.prototype.generateMergedHighlightText=function(highlights){var localHighlights=highlights.slice(0);localHighlights.splice(0,0,"");localHighlights.splice(localHighlights.length,0,"");return localHighlights.join("...")};KbSearchControl.prototype.init=function(context,notifyOutputChanged,state,container){var _this_1=this;KbSearchControl_1.PerformanceTelemetry.Instance.AddStartMarker(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_LOAD_KBSEARCH_CONTROL,context);KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"init","");this._isRelevanceSearchSyncStatusValid=true;this.isInitializing=false;this._stateManager=KbSearchControl_1.StateManager.Instance(context.parameters.value.controlId,true);context.parameters.value.currentSearchText=null;this.Context=context;this._state=state;this._recordNotSaved=!context.parameters.value.entityReference||!context.parameters.value.entityReference.Id;MscrmControls.KbCommonUtils.FCBUtil.SetCustomerEnabledWaves(context);KbSearchControl_1.KbSearchControlLocale.initialize(function(id){return context.resources.getString(id)});MscrmControls.KbCommonUtils.KbCommonControlLocale.initialize(function(id){return context.resources.getString(id)});if(MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)&&this.IsStandaloneMode())document.title=KbSearchControl_1.KbSearchControlLocale.StandalonePageTitle;this._stateManager.numberOfResults=this._context.parameters.value.descriptors.numberOfResults;KbSearchControl_1.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_KBSEARCH_CONTROL_INITIALIZED,context);this.fetchControlInitSettings().then(function(value){_this_1.isInitializing=true;_this_1._stateManager.isExternalSearchIndexEnabled=context.utils.isFeatureEnabled(KbSearchControl_1.Constants.UCKMControlRelevanceSearch)&&value.IsRelevanceSearchEnabled;_this_1.activeLanguages=value.ActiveLanguages;_this_1.kmPrivileges=value.KMPrivileges;_this_1.useExternalKMPortal=value.UseExternalKMPortal;_this_1.externalKMPortalURL=value.ExternalKMPortalURL;_this_1._stateManager.relations=value.Relationship;_this_1._stateManager.knowledgeArticleAttributeList=_this_1.getKnowledgeArticleAttributeList(value);_this_1.Context.utils.requestRender()},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";KbSearchControl_1.UpdateErrorStateInContext(context,KbSearchControl_1.Constants.ServerSearchFailure,false,errorMessage)});this.Context.client.trackContainerResize(true);this._stateManager.InitializeModels(this.Context);if(this._context.parameters.value.searchWidgetActionResult&&this._context.parameters.value.searchWidgetActionResult.action&&this._context.parameters.value.searchWidgetActionResult.action.ActionExecutionId)this._stateManager.PreviousActionExecutionId=this._context.parameters.value.searchWidgetActionResult.action.ActionExecutionId;if(this._context.parameters.value.urlQueryParams){this._context.parameters.value.urlQueryParams.sort&&this._stateManager.SortFilter.SetSelectedSortFilterBySortOption(this._context.parameters.value.urlQueryParams.sort);if(this._context.parameters.value.urlQueryParams.queryString){var searchText=this._context.parameters.value.urlQueryParams.queryString;this._stateManager.ExecuteKbSearchHelper.searchText=searchText;this.Context.parameters.value.executeUpdateCurrentSearchText(this.Context.parameters.value.contextToken,searchText)}}this._context.utils.isFeatureEnabled(KbSearchControl_1.Constants.MetadataDrivenFilterForKbSearch)&&this.processAdditionalFilters();MscrmControls.KbCommonUtils.ActionOperationRegistration.RegisterAllActions();MscrmControls.KbCommonUtils.FCBUtil.IsStatePersistenceEnabled(this._context)&&KbSearchControl_1.StateUtil.RestoreState(this._context,this._stateManager,this._state);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"init","")};KbSearchControl.prototype.fetchControlInitSettings=function(){var entityIdentifier="";if(this.Context.page.entityTypeName)entityIdentifier="EntityLogicalName='"+this.Context.page.entityTypeName+"'";var kmInitSettingsUrl=this._context.page.getClientUrl()+"/api/data/v9.0/RetrieveKMControlInitializationSettings("+entityIdentifier+")";return KbSearchControl_1.Fetch(this.Context.client.userAgent,KbSearchControl_1.GET_METHOD,kmInitSettingsUrl).then(function(parsedValue){return JSON.parse(parsedValue.Result)})};KbSearchControl.prototype.processAdditionalFilters=function(){if(!this._context.parameters.value.descriptors.enableMDF)return;this._stateManager.ExecuteKbSearchHelper.enableMetadataFiltering=true;if(this._context.parameters.value.descriptors.mappedFields)for(var _i=0,_a=this._context.parameters.value.descriptors.mappedFields;_i<_a.length;_i++){var mapping=_a[_i];this._stateManager.ExecuteKbSearchHelper.additionalKnowledgeArticleFilters[mapping.kmAttr]=mapping.srcAttr}};KbSearchControl.prototype.getArticleTitle=function(evt){var articleTitleID=evt._context.accessibility.getUniqueId("articleTitle");return articleTitleID};KbSearchControl.prototype.handleKeyDownPress=function(evt,keyEvent){if(keyEvent.keyCode==KbSearchControl_1.Constants.UpArrowKeyCode){var articleIndex=$('[id="'+evt.getArticleTitle(evt)+'"]'),articleIndexCount=articleIndex.length-1;if(articleIndexCount!=0){articleIndex[articleIndexCount].focus();evt._stateManager.SetSelectedArticle(evt._stateManager.records[articleIndexCount],evt._context)}}else if(keyEvent.keyCode===13){evt._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch(true);var articleIndex=$('[id="'+evt.getArticleTitle(evt)+'Text"]');if(articleIndex&&articleIndex.length>0){var articleIndexCount=articleIndex.length-1;articleIndex[articleIndexCount].tabIndex=0;articleIndex[articleIndexCount].focus()}}};KbSearchControl.prototype.handleKeyDownPressResultFound=function(evt,keyEvent){if(keyEvent.keyCode==KbSearchControl_1.Constants.TabKeyCode){var articleIndex=$('[id="'+evt.getArticleTitle(evt)+'"]');articleIndex.length>0&&evt._stateManager.SetSelectedArticle(evt._stateManager.records[0],evt._context)}};KbSearchControl.prototype.OnKeyDownSkipContent=function(keyEvent){if(this._stateManager.records&&keyEvent.keyCode==KbSearchControl_1.Constants.Letter_E_KeyCode&&keyEvent.altKey){var articleIndex=$('[id="'+this.getArticleTitle(this)+'"]');if(articleIndex.length>0){var articleIndexCount=articleIndex.length-1;if(articleIndexCount!=0){articleIndex[articleIndexCount].focus();this._stateManager.SetSelectedArticle(this._stateManager.records[articleIndexCount],this._context)}}}};KbSearchControl.prototype.renderSearchResultFooter=function(isPopupControl){KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderSearchResultFooter","");if(!this._stateManager.ExecuteKbSearchHelper.ShowLoadMoreButton(isPopupControl,this._stateManager.isExternalSearchIndexEnabled)){KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderSearchResultFooter","");return}var loadMoreButton=this.Context.factory.createElement("Label",{key:"loadMoreLabel",id:"loadMoreLabel",className:"mscrm-loadMoreLabel",style:{width:"100%",whiteSpace:"nowrap",fontSize:this._context.theming.fontsizes.font100,color:this._context.theming.colors.base.blue,marginTop:this._context.theming.measures.measure100},role:"link",onClick:this._handleLoadMoreButtonClick.bind(this),onKeyDown:this.handleKeyDownPress.bind(null,this),tabIndex:0,accessibilityLabel:KbSearchControl_1.KbSearchControlLocale.LoadMoreButtonLocale},KbSearchControl_1.KbSearchControlLocale.LoadMoreButtonLocale);if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)){loadMoreButton.getProperties().style.color="#3B79B7";loadMoreButton.getProperties().style[":hover"]={cursor:"pointer",color:"#2E5FA4"}}var result=this._context.factory.createElement("Container",{id:"loadMoreButtonContainer",key:"loadMoreButtonContainer",style:{height:this._context.theming.measures.measure225,display:"inline-block",marginTop:KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)?"8px":"0"}},loadMoreButton);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderSearchResultFooter","");return result};KbSearchControl.prototype.renderSearchResults=function(isPopupControl){if(isPopupControl===void 0)isPopupControl=false;KbSearchControl_1.PerformanceTelemetry.Instance.AddStartMarker(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_LOAD_SEARCH_RESULTS,this.Context);var searchResultsContainer=this.renderSearchResultsContainer(isPopupControl);searchResultsContainer.push(this.renderSearchResultFooter(isPopupControl));var searchResultsList=this.Context.factory.createElement("LIST",{id:"kbSearchResultsListId",Key:"kbSearchResultsList",style:{flexDirection:"Column"},role:"list"},searchResultsContainer);KbSearchControl_1.PerformanceTelemetry.Instance.AddEndMarker(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_LOAD_SEARCH_RESULTS,this._context);return searchResultsList};KbSearchControl.prototype.getHiddenActionSpan=function(){var hiddenActionUniqueId=this._context.accessibility.getUniqueId("hiddenActionid"),hiddenActionSpan=$(document.getElementById(hiddenActionUniqueId));if(!(hiddenActionSpan instanceof Element))hiddenActionSpan=null;return hiddenActionSpan};KbSearchControl.prototype.renderSearchResultsContainer=function(isPopupControl){KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderSearchResultsContainer","");var isRelevanceSearchEnabled=this._context.utils.isFeatureEnabled(KbSearchControl_1.Constants.UCKMControlRelevanceSearch)&&this._stateManager.isExternalSearchIndexEnabled,searchResults=isRelevanceSearchEnabled?this.kbRelevanceSearchRecordCollection:this._stateManager.records,searchResultContainerChildren=[];if(this.KbSearchResultsObject==null){this.KbSearchResultsObject=new KbSearchControl_1.KbSearchResults;this.KbSearchResultsObject.init(this.Context,null,null,null,this.getHiddenActionSpan(),parseFloat(this._context.theming.fontsizes.font115))}if(searchResults)for(var i=0,l=searchResults.length;i<l;i++){if(this._context.client.disableScroll&&!isPopupControl&&i+1>this._context.parameters.value.descriptors.numberOfResults)break;searchResultContainerChildren.push(this.KbSearchResultsObject.render(searchResults[i],isPopupControl,isRelevanceSearchEnabled))}KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderSearchResultsContainer","");return searchResultContainerChildren};KbSearchControl.prototype.renderArticleActions=function(isPopupControl){if(!this.KbSearchActionsObject){this.KbSearchActionsObject=new KbSearchControl_1.KbSearchActions;this.KbSearchActionsObject.init(this.Context,null,null,null,this.getHiddenActionSpan(),parseFloat(this._context.theming.fontsizes.font115))}return this.KbSearchActionsObject.render(isPopupControl)};KbSearchControl.prototype.isShowSelectedDialogOptionVisible=function(){return this._context.parameters.DialogContext&&this._context.parameters.DialogContext.isMultiSelect&&this._context.parameters.DialogContext.SelectedRecords&&Object.keys(this._context.parameters.DialogContext.SelectedRecords).length>0};KbSearchControl.prototype.renderHeader=function(){KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderHeader","");var controlBlock=[],header=this.Context.parameters.value.showLabel?this.Context.parameters.value.label:"";if(this.searchUIEnhancementsEnabled&&!KbSearchControl_1.KbSearchUtil.IsHostedInFormContext(this.Context)&&MscrmCommon.ControlUtils.String.isNullOrEmpty(header))header=KbSearchControl_1.KbSearchControlLocale.KnowledgeSearch;var headerLabelStyles={width:"50%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:this._context.theming.fontsizes.font100,marginTop:this._context.theming.measures.measure025};if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this.Context,KbSearchControl_1.Constants.KMRefreshSearchUI)){headerLabelStyles.color="#333333";headerLabelStyles.fontFamily=this._context.theming.fontfamilies.semibold;headerLabelStyles.fontSize=MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?this._context.theming.fontsizes.font100:this._context.theming.fontsizes.font115;if(MscrmControls.KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()){headerLabelStyles.fontWeight="400";headerLabelStyles.fontSize="14px"}headerLabelStyles.marginTop="6px";headerLabelStyles.display="block"}if(this.searchUIEnhancementsEnabled){headerLabelStyles.marginTop="";headerLabelStyles.width=""}var headerLabel=this.Context.factory.createElement("text",{key:"headerLabel",className:"mscrm-kbSearchControlLabel",semanticTag:"h3",style:headerLabelStyles},header),headerLabelContainer=this.Context.factory.createElement("CONTAINER",{key:"headerLabelContainer",style:{display:"flex",alignItems:"center",width:"50%"}},headerLabel);controlBlock.push(this.searchUIEnhancementsEnabled?headerLabelContainer:headerLabel);var actionBlock=[],isRelevanceSearchEnabled=this._context.utils.isFeatureEnabled(KbSearchControl_1.Constants.UCKMControlRelevanceSearch),shouldShowDisableOption=this._context.utils.isFeatureEnabled(KbSearchControl_1.Constants.MetadataDrivenFilterForKbSearch)&&this._context.parameters.value.descriptors.enableMDF&&this._context.parameters.value.descriptors.allowDisablingMDFOnUI&&isRelevanceSearchEnabled&&this._stateManager.GetIsSearchMode();if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)){var sortIconElement=this.buildIcon(KbSearchControl_1.KbSearchControlLocale.SortFilterTitleText,KbSearchControl_1.Constants.SortIconId,255,this.handleSortButtonClick,null),filterIconElement=this.IsKBSearchFilterEnabled()?this.buildIcon(KbSearchControl_1.KbSearchControlLocale.FilterOpenTitleText,KbSearchControl_1.Constants.FilterIconId,44,this.handleFilterButtonClick,null,this._stateManager.filtersVisible):null,showSelectedIconElement=this.buildIcon("Show Selected Articles",KbSearchControl_1.Constants.ShowSelectedIconId,this._stateManager.shouldShowSelected?296:297,this.handleShowSelectedButtonClick,null);if(this.searchUIEnhancementsEnabled){this.isShowSelectedDialogOptionVisible()&&actionBlock.push(showSelectedIconElement);filterIconElement!=null&&actionBlock.push(filterIconElement);actionBlock.push(sortIconElement)}else if(!this._stateManager.IsExpandedMode){this.isShowSelectedDialogOptionVisible()&&actionBlock.push(showSelectedIconElement);actionBlock.push(sortIconElement);filterIconElement!=null&&actionBlock.push(filterIconElement)}if(this._showSortList){var sortOptions=this.makeSortOptionsLayout();actionBlock.push(sortOptions)}}if(shouldShowDisableOption){var checkbox=this.Context.factory.createElement("BOOLEAN",{key:"disableMDF",id:"disableMDF",value:this._stateManager.ExecuteKbSearchHelper.enableMetadataFiltering,accessibilityLabel:KbSearchControl_1.KbSearchControlLocale.MDFTooltipText,title:KbSearchControl_1.KbSearchControlLocale.MDFLabelText,style:{width:"auto",":focus":{outlineOffset:navigator.userAgent.indexOf("Edge/")>-1?"0 !important":"-1px"}},onValueChange:this.setRuntimeFilters.bind(this)},[]);actionBlock.push(this.Context.factory.createElement("CONTAINER",{key:"disableMDFContainer",style:{display:"flex","justify-content":"center","align-items":"center"}},[checkbox]));actionBlock.push(this.Context.factory.createElement("LABEL",{key:"disableMDFLabel",id:"disableMDFLabel",accessibilityLabel:KbSearchControl_1.KbSearchControlLocale.MDFTooltipText,style:{"max-width":"100%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:KbSearchControl_1.KbSearchControlLocale.MDFTooltipText},KbSearchControl_1.KbSearchControlLocale.MDFLabelText))}controlBlock.push(this.Context.factory.createElement("CONTAINER",{id:"headerActionContainer",key:"headerActionContainer",style:{width:"50%",display:"inline-flex","justify-content":"flex-end","align-items":"center"}},actionBlock));var headerContainerStyle={};if(this.Context.parameters.value.showLabel&&header||shouldShowDisableOption){headerContainerStyle={borderBottom:this.searchUIEnhancementsEnabled?"":this._context.theming.borders.border02,height:this._context.theming.measures.measure225,minHeight:this._context.theming.measures.measure225};if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)){headerContainerStyle["height"]=MscrmControls.KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"36px":"38px";headerContainerStyle["minHeight"]=MscrmControls.KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"36px":"38px"}if(this.searchUIEnhancementsEnabled)headerContainerStyle["paddingTop"]=MscrmControls.KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"0px":this._context.theming.measures.measure075;if(!this.Context.parameters.value.showLabel)headerContainerStyle["justifyContent"]="flex-end"}else if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)&&!this._stateManager.GetIsSearchMode()&&!this._stateManager.IsExpandedMode)headerContainerStyle={height:0,minHeight:0};if(this.Context.parameters.value.hideSearchOnRecordLoad)headerContainerStyle={height:0,minHeight:0};headerContainerStyle["width"]="100%";var result=this.Context.factory.createElement("Container",{id:"headerContainer",key:"headerContainer",className:"mscrm-kbheaderContainer",style:headerContainerStyle},controlBlock);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderHeader","");return result};KbSearchControl.prototype.setRuntimeFilters=function(value){this._stateManager.ExecuteKbSearchHelper.enableMetadataFiltering=value;this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()};KbSearchControl.prototype.renderArticleStatusFilter=function(isPopupControl){var expandedRendering=isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode||this._stateManager.IsExpandedMode,filterContainer=[];if(this.Context.parameters.value.descriptors.showArticleStatusFilter&&this.Context.parameters.value.descriptors.articleStatusFilter){expandedRendering&&filterContainer.push(this.Context.factory.createElement("Label",{id:"articleStatusFilterLabelId",key:"articleStatusFilterLabel",className:"articleStatusFilterLabel",style:{display:"block",color:this._context.theming.colors.grays.gray06,overflow:"auto",width:"100%",fontSize:this._context.theming.fontsizes.font100,whiteSpace:"normal",marginBottom:this._context.theming.measures.measure050,marginTop:this._context.theming.measures.measure100}},KbSearchControl_1.KbSearchControlLocale.ArticleStatusFilterLabel));var articleComboBox=this.Context.factory.createElement("SELECT",{id:"kbArticleFilterComboBoxid",ref:"kbArticleFilterComboBox",className:"mscrm-kbSearchArticleStatusFilter",key:"kbArticleFilterComboBox_container",style:this.selectStyle(isPopupControl),freeTextMode:false,onChange:this._handleArticleStatusFilterChange.bind(this),value:this._stateManager.ArticleStatusFilter.SelectedItemResourceName,disabled:false,autoFocus:true,options:this._stateManager.ArticleStatusFilter.ArticleFilterOptions,accessibilityLabel:KbSearchControl_1.KbSearchControlLocale.ArticleStateFilterTitleText,title:KbSearchControl_1.KbSearchControlLocale.ArticleStateFilterTitleText});filterContainer.push(articleComboBox)}return this.Context.factory.createElement("Container",{id:"articleStatusFilterDivid",key:"articleStatusFilterDiv",style:{width:expandedRendering?"100%":"",maxWidth:expandedRendering?"100%":"50%",display:"inline-block",justifyContent:"flex-start",marginRight:"2px",marginBottom:expandedRendering?this._context.theming.measures.measure100:this._context.theming.measures.measure050},className:"mscrm-kbSearchArticleStatusFilterContainer"},filterContainer)};KbSearchControl.prototype.renderLanguageFilter=function(isPopupControl){var expandedRendering=isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode||this._stateManager.IsExpandedMode,langComboBoxContainer=[];if(this.Context.parameters.value.descriptors.showLanguageFilter){expandedRendering&&langComboBoxContainer.push(this.Context.factory.createElement("Label",{id:"languageFilterLabelId",key:"languageFilterLabel",className:"languageFilterLabel",style:{display:"block",color:this._context.theming.colors.grays.gray05,overflow:"auto",width:"100%",fontSize:this._context.theming.fontsizes.font100,whiteSpace:"normal",marginBottom:this._context.theming.measures.measure050}},KbSearchControl_1.KbSearchControlLocale.LanguageFilterLabel));var langComboBox=this.Context.factory.createElement("SELECT",{id:"kbArticleLanguageFilterComboBoxid",ref:"kbArticleLanguageFilterComboBox",className:"mscrm-kbSearchArticleLanguageFilter",key:"kbArticleLanguageFilterComboBox_container",style:this.selectStyle(isPopupControl),freeTextMode:false,onChange:this._handleArticleLanguageFilterChange.bind(this),value:this._stateManager.ArticleLanguageFilter.SelectLanguageOption,disabled:false,autoFocus:true,options:this._stateManager.ArticleLanguageFilter.languageFilterOptions,accessibilityLabel:KbSearchControl_1.KbSearchControlLocale.ArticleLanguageFilterTitleText,title:KbSearchControl_1.KbSearchControlLocale.ArticleLanguageFilterTitleText});langComboBoxContainer.push(langComboBox);return this.Context.factory.createElement("Container",{id:"articleLanguageFilterDivid",key:"articleLanguageFilterDiv",style:{width:expandedRendering?"100%":"",maxWidth:expandedRendering?"100%":"50%",display:"inline-block",justifyContent:"flex-start",marginRight:"2px",marginBottom:expandedRendering?this._context.theming.measures.measure100:this._context.theming.measures.measure050},className:"mscrm-kbSearchLanguageFilterContainer"},langComboBoxContainer)}};KbSearchControl.prototype._handleLoadMoreButtonClick=function(event){KbSearchControl_1.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_SEE_MORE_OPTION_CLICKED,this._context);KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"_handleLoadMoreButtonClick","");this._stateManager.popupEnabled=this._context.client.disableScroll;this._stateManager.ReportEventToTelemetry(KbSearchControl_1.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.ShowMoreClicked]);this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch(true);var articleIndex=$('[id="'+this.getArticleTitle(this)+'Text"]');if(articleIndex&&articleIndex.length>0){var articleIndexCount=articleIndex.length-1;articleIndex[articleIndexCount].tabIndex=0;articleIndex[articleIndexCount].focus()}KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"_handleLoadMoreButtonClick","")};KbSearchControl.prototype.handleSearchWidgetActionResult=function(){var _this_1=this;if(this.Context.parameters.value.searchWidgetActionResult)if(this._stateManager.PreviousActionExecutionId!=this.Context.parameters.value.searchWidgetActionResult.action.ActionExecutionId){this._stateManager.PreviousActionExecutionId=this.Context.parameters.value.searchWidgetActionResult.action.ActionExecutionId;switch(this.Context.parameters.value.searchWidgetActionResult.action.Id){case MscrmControls.KbCommonUtils.ArticleAction.OpenResult:var filteredRecords=void 0;if(this._context.utils.isFeatureEnabled(KbSearchControl_1.Constants.UCKMControlRelevanceSearch)&&this._stateManager.isExternalSearchIndexEnabled)filteredRecords=this.kbRelevanceSearchRecordCollection.filter(function(item){return item.knowledgeArticleId===_this_1.Context.parameters.value.searchWidgetActionResult.payload.articleId});else filteredRecords=this._stateManager.records.filter(function(item){return item.knowledgeArticleId===_this_1.Context.parameters.value.searchWidgetActionResult.payload.articleId});MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(MscrmControls.KbCommonUtils.ArticleAction.OpenResult,{controlContext:this.Context,record:filteredRecords[0],stateManager:this._stateManager});break;default:break}}};KbSearchControl.prototype._handleArticleStatusFilterChange=function(selectedStatusFilter){if(this._stateManager.ArticleStatusFilter.SelectedItemResourceName&&selectedStatusFilter&&this._stateManager.ArticleStatusFilter.SelectedItemResourceName.Value!=selectedStatusFilter.Value){KbSearchControl_1.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_STATUS_FILTER_CHANGED,this._context,selectedStatusFilter.Label);this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.ArticleStatusFilter.SelectedItemResourceName=selectedStatusFilter;this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype._handleArticleLanguageFilterChange=function(selectedLanguageFilter){if(this._stateManager.ArticleLanguageFilter.SelectLanguageOption&&selectedLanguageFilter&&this._stateManager.ArticleLanguageFilter.SelectLanguageOption.Value!=selectedLanguageFilter.Value){KbSearchControl_1.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_LANGUAGE_FILTER_CHANGED,this._context,selectedLanguageFilter.Label);this._stateManager.ArticleLanguageFilter.SelectLanguageOption=selectedLanguageFilter;this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype._handleSortFilterChange=function(selectedSortOrder){if(this._stateManager.SortFilter.SelectedSortFilter&&selectedSortOrder&&this._stateManager.SortFilter.SelectedSortFilter.Value!=selectedSortOrder.Value){KbSearchControl_1.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_SORT_ORDER_CHANGED,this._context,selectedSortOrder.Label);this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.SortFilter.SelectedSortFilter=selectedSortOrder;this._stateManager.ReportEventToTelemetry(KbSearchControl_1.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.SortChanged]);this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype.renderFilters=function(isPopupControl){KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderFilters","");var expandedRendering=isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode||this._stateManager.IsExpandedMode,filterContainer=[];filterContainer.push(this.renderArticleStatusFilter(isPopupControl));filterContainer.push(this.renderLanguageFilter(isPopupControl));var filterContainerId=isPopupControl?"filterContainerInPopup":"filterContainer",result=this.Context.factory.createElement("Container",{id:filterContainerId,key:filterContainerId,style:{flexWrap:"wrap",justifyContent:"space-between",display:expandedRendering?"flex":this._stateManager.filtersVisible?"flex":"none",borderBottom:this._context.theming.borders.border02,marginTop:this._context.theming.measures.measure050},className:"mscrm-kbSearchFilterContainer"},filterContainer);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderFilters","");return result};KbSearchControl.prototype.buildFilterConfig=function(){var _this_1=this,filterDetails=[],filterConfig={filterDetails:filterDetails,isCloseable:this.searchUIEnhancementsEnabled?true:!this._stateManager.IsExpandedMode,shouldGainDefaultFocus:this._stateManager.shouldFiltersGainDefaultFocus};this._stateManager.shouldFiltersGainDefaultFocus=false;var statusFilterOptions=[],visibilityFilterOptions=[],dateFilterOptions=[],defaultLanguageFilterOptions=[],activeLanguagesFilterOptions=[];if(!this._stateManager.selectedStateCode)this._stateManager.selectedStateCode=this._stateManager.ArticleStatusFilter.SelectedItemStateCode();if(!this._stateManager.selectedLanguage)this._stateManager.selectedLanguage=this._stateManager.ArticleLanguageFilter.DefaultLanguageLocaleId.text;statusFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.AllDraftArticlesLocale,value:KbSearchControl_1.ArticleStatusFilterOption.Draft.toString(),isSelected:KbSearchControl_1.ArticleStatusFilterOption.Draft.toString()==this._stateManager.selectedStateCode});statusFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.AllApprovedArticlesLocale,value:KbSearchControl_1.ArticleStatusFilterOption.Approved.toString(),isSelected:KbSearchControl_1.ArticleStatusFilterOption.Approved.toString()==this._stateManager.selectedStateCode});statusFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.AllPublishedArticlesLocale,value:KbSearchControl_1.ArticleStatusFilterOption.Published.toString(),isSelected:KbSearchControl_1.ArticleStatusFilterOption.Published.toString()==this._stateManager.selectedStateCode});this.Context.parameters.value.descriptors.showArticleStatusFilter&&this.Context.parameters.value.descriptors.articleStatusFilter&&filterDetails.push({filterOptions:statusFilterOptions,name:KbSearchControl_1.KbSearchControlLocale.ArticleStatusFilterText,value:KbSearchControl_1.Constants.ArticleStatusFilter,isMultiSelect:false,isExpanded:this._stateManager.isArticleStatusFilterExpanded});visibilityFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.InternalArticlesText,value:KbSearchControl_1.Constants.IsInternal,isSelected:this._stateManager.selectedVisibility==true.toString()});visibilityFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.ExternalArticlesText,value:KbSearchControl_1.Constants.IsExternal,isSelected:this._stateManager.selectedVisibility==false.toString()});visibilityFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.FilterOptionAllText,value:null,isSelected:this._stateManager.selectedVisibility==null});filterDetails.push({filterOptions:visibilityFilterOptions,name:KbSearchControl_1.KbSearchControlLocale.ArticleVisibilityFilterText,value:KbSearchControl_1.Constants.ArticleVisibilityFilter,isMultiSelect:false,isExpanded:this._stateManager.isArticleVisibilityFilterExpanded});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.Last7DaysText,value:KbSearchControl_1.DateFilterOptions.Last7Days.toString(),isSelected:KbSearchControl_1.DateFilterOptions.Last7Days==this._stateManager.selectedDateRange});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.Last30DaysText,value:KbSearchControl_1.DateFilterOptions.LastXDays.toString(),isSelected:KbSearchControl_1.DateFilterOptions.LastXDays==this._stateManager.selectedDateRange});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.Last6MonthsText,value:KbSearchControl_1.DateFilterOptions.LastXMonths.toString(),isSelected:KbSearchControl_1.DateFilterOptions.LastXMonths==this._stateManager.selectedDateRange});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.LastYearText,value:KbSearchControl_1.DateFilterOptions.LastXYears.toString(),isSelected:KbSearchControl_1.DateFilterOptions.LastXYears==this._stateManager.selectedDateRange});dateFilterOptions.push({label:KbSearchControl_1.KbSearchControlLocale.FilterOptionAllText,value:null,isSelected:this._stateManager.selectedDateRange==null});filterDetails.push({filterOptions:dateFilterOptions,name:KbSearchControl_1.KbSearchControlLocale.ArticleDateFilterText,value:KbSearchControl_1.Constants.ArticleDateFilter,isMultiSelect:false,isExpanded:this._stateManager.isArticleDateFilterExpanded});var defaultLangLocaleId=this._stateManager.ArticleLanguageFilter.DefaultLanguageLocaleId.text;if(this.Context.parameters.value.descriptors.showLanguageFilter)if(this.promiseResolved){if(this.langFetchXmlResult)for(var _i=0,_a=this.langFetchXmlResult;_i<_a.length;_i++){var entity=_a[_i],languageLocaleId=entity._languagelocaleid_value,languageOption=this._stateManager.ArticleLanguageFilter.GetLanguageOptionByLanguageLocaleId(languageLocaleId);activeLanguagesFilterOptions.push({label:languageOption.Label,value:languageLocaleId,isSelected:languageLocaleId==this._stateManager.selectedLanguage})}filterDetails.push({filterOptions:activeLanguagesFilterOptions,name:KbSearchControl_1.KbSearchControlLocale.ArticleLanguageFilterText,value:KbSearchControl_1.Constants.ArticleLanguageFilter,isMultiSelect:false,isExpanded:false})}else{defaultLanguageFilterOptions.push({label:this._stateManager.ArticleLanguageFilter.GetLanguageOptionByLanguageLocaleId(defaultLangLocaleId).Label,value:defaultLangLocaleId,isSelected:this._stateManager.selectedLanguage==defaultLangLocaleId});filterDetails.push({filterOptions:defaultLanguageFilterOptions,name:KbSearchControl_1.KbSearchControlLocale.ArticleLanguageFilterText,value:KbSearchControl_1.Constants.ArticleLanguageFilter,isMultiSelect:false,isExpanded:this._stateManager.isArticleLanguageFilterExpanded})}if(this.executeLanguageFetchXml){this.executeLanguageFetchXml=false;this._context.webAPI.retrieveMultipleRecords(KbSearchControl_1.Constants.EntityName,"?fetchXml="+KbSearchControl_1.Constants.ActiveLanguagesFetchXml).then(function(results){if(results.entities.length>0){_this_1.langFetchXmlResult=results.entities;_this_1.promiseResolved=true;_this_1._context.utils.requestRender()}},function(errorResponse){console.error(errorResponse)})}return filterConfig};KbSearchControl.prototype.renderFiltersWithFilterControl=function(){KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderFiltersWithFilterControl","");if(!this._stateManager.filtersVisible)return;var filterConfig=this.buildFilterConfig(),filteringControlProps={parameters:{value:{Usage:3,Static:false,Value:JSON.stringify(filterConfig),Type:"SingleLine.Text",Attributes:{DisplayName:"VirtualFilterControl_Value",LogicalName:"VirtualFilterControl_Value",Type:"string"},Callback:this.filterChangedCallback.bind(this)}},controlstates:{height:this.searchUIEnhancementsEnabled&&this.IsStandaloneMode()?300:-1}},filteringControl=this._context.factory.createComponent("MscrmControls.VirtualFilterControl.VirtualFilterControl","VirtualFilteringControl_Container",filteringControlProps),filteringContainer=this._context.factory.createElement("Container",{id:"VirtualFilterControlContainer",key:"VirtualFilterControlContainer",ref:"VirtualFilterControlContainer",style:{display:"inline",width:"100%"}},filteringControl);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderFiltersWithFilterControl","");return filteringContainer};KbSearchControl.prototype.filterChangedCallback=function(filterOutput){var _this_1=this,filterState=filterOutput.state,filterDetails=filterOutput.value;if(filterDetails!=null&&filterState==MscrmControls.VirtualFilterControl.RequestedCallbackState.Update){filterDetails.forEach(function(filter){var filterOptions=filter.filterOptions,selectedFilterOptions=filterOptions.filter(function(x){return x.isSelected==true});if(filter.value!=null&&filterOptions!=null)switch(filter.value){case KbSearchControl_1.Constants.ArticleStatusFilter:_this_1._stateManager.selectedStateCode=selectedFilterOptions[0].value;break;case KbSearchControl_1.Constants.ArticleVisibilityFilter:if(selectedFilterOptions[0].value==KbSearchControl_1.Constants.IsInternal)_this_1._stateManager.selectedVisibility="true";else if(selectedFilterOptions[0].value==KbSearchControl_1.Constants.IsExternal)_this_1._stateManager.selectedVisibility="false";else if(selectedFilterOptions[0].value==null)_this_1._stateManager.selectedVisibility=null;break;case KbSearchControl_1.Constants.ArticleDateFilter:if(selectedFilterOptions[0].value!=null)_this_1._stateManager.selectedDateRange=parseInt(selectedFilterOptions[0].value);else _this_1._stateManager.selectedDateRange=null;break;case KbSearchControl_1.Constants.ArticleLanguageFilter:if(selectedFilterOptions[0].value!=null)_this_1._stateManager.selectedLanguage=selectedFilterOptions[0].value;else _this_1._stateManager.selectedLanguage=_this_1._stateManager.ArticleLanguageFilter.DefaultLanguageLocaleId.text;_this_1._context.utils.requestRender();break}});this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}else if(filterDetails!=null&&filterState==MscrmControls.VirtualFilterControl.RequestedCallbackState.Close){this._stateManager.filtersVisible=!this._stateManager.filtersVisible;this._context.utils.requestRender(function(){_this_1._context.accessibility.focusElementById(KbSearchControl_1.Constants.FilterIconId+KbSearchControl_1.Constants.IconIdButtonPostfix)})}else if(filterDetails!=null&&filterState==MscrmControls.VirtualFilterControl.RequestedCallbackState.Clear){this._stateManager.selectedStateCode=this._stateManager.ArticleStatusFilter.SelectedItemStateCode();this._stateManager.selectedLanguage=this._stateManager.ArticleLanguageFilter.DefaultLanguageLocaleId.text;this._stateManager.selectedVisibility=null;this._stateManager.selectedDateRange=null;this._context.utils.requestRender();this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}else if(filterDetails!=null&&filterState==MscrmControls.VirtualFilterControl.RequestedCallbackState.ExpandChange){filterDetails.forEach(function(filter){if(filter)switch(filter.value){case KbSearchControl_1.Constants.ArticleStatusFilter:_this_1._stateManager.isArticleStatusFilterExpanded=filter.isExpanded;break;case KbSearchControl_1.Constants.ArticleVisibilityFilter:_this_1._stateManager.isArticleVisibilityFilterExpanded=filter.isExpanded;break;case KbSearchControl_1.Constants.ArticleDateFilter:_this_1._stateManager.isArticleDateFilterExpanded=filter.isExpanded;break;case KbSearchControl_1.Constants.ArticleLanguageFilter:_this_1._stateManager.isArticleLanguageFilterExpanded=filter.isExpanded;break}});this._context.utils.requestRender()}};KbSearchControl.prototype.ControlMaxHeight=function(isExpandedMode){var topNav=document.querySelector('[data-id="topBar"]'),searchTextBox=document.querySelector('[data-id$="rendersearchboxrow"]'),serachResultsDiv=document.querySelector('[data-id$="resultsFoundTextId"]'),filterContainerDivHeight=0,buffer=0;if(!this.searchUIEnhancementsEnabled&&this.IsEdgeOrIE)buffer=30;if(this.IsEdgeOrIE&&this._stateManager.filtersVisible){filterContainerDivHeight=searchTextBox.clientHeight;if(!isExpandedMode){var resultContainerDiv=document.querySelector('[data-id$="resultCountAndSortFilterDivId"]');filterContainerDivHeight+=resultContainerDiv.clientHeight}buffer=0}return window.innerHeight-(typeof topNav!="undefined"&&topNav!=null?topNav.clientHeight:0)-(typeof searchTextBox!="undefined"&&searchTextBox!=null?searchTextBox.clientHeight:10)-(typeof serachResultsDiv!="undefined"&&serachResultsDiv!=null?serachResultsDiv.clientHeight:19)-filterContainerDivHeight-buffer-20};KbSearchControl.prototype.StandaloneControlMaxHeight=function(isExpandedMode){var searchTextBox=document.querySelector('[data-id$="rendersearchboxrow"]'),resultCountAndSortFilterDiv=document.querySelector('[data-id$="resultCountAndSortFilterDivId"]'),filterContainerDivHeight=0,buffer=0;if(this.IsEdgeOrIE&&this._stateManager.filtersVisible){filterContainerDivHeight=searchTextBox.clientHeight;if(!isExpandedMode){var resultContainerDiv=document.querySelector('[data-id$="resultCountAndSortFilterDivId"]');filterContainerDivHeight+=resultContainerDiv.clientHeight}buffer=0}return window.innerHeight-(typeof searchTextBox!="undefined"&&searchTextBox!=null?searchTextBox.clientHeight:10)-(typeof resultCountAndSortFilterDiv!="undefined"&&resultCountAndSortFilterDiv!=null?resultCountAndSortFilterDiv.clientHeight:19)-filterContainerDivHeight-buffer};KbSearchControl.prototype.UpdateActiveLanguages=function(){if(this.activeLanguages&&this._stateManager.ArticleLanguageFilter.languageFilterOptions.length==0){this._stateManager.ArticleLanguageFilter.SetLanguageFilters(this.activeLanguages);var useState=MscrmControls.KbCommonUtils.FCBUtil.IsStatePersistenceEnabled(this._context)&&this._state&&this._state.searchState&&!this._state.searchState.loading;if(useState){if(this._stateManager.loading)this._stateManager.loading=false}else this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype.handleClosePopup=function(){this._stateManager.popupEnabled=false;!this._stateManager.GetIsSearchMode()&&this._stateManager.SetIsSearchMode(true,this.Context);this.Context.utils.requestRender()};KbSearchControl.prototype.renderClosePopup=function(){KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderClosePopup","");var closeIconId="closeSearchWidgetPopup",closeIcon=this._context.factory.createElement("MICROSOFTICON",{id:closeIconId,tabIndex:0,accessibilityLabel:KbSearchControl_1.KbSearchControlLocale.RemoveIconAltText,style:{margin:this._context.theming.measures.measure050,cursor:"pointer"},key:closeIconId,onKeyDown:this.handleClosePopup.bind(this),onClick:this.handleClosePopup.bind(this),type:97}),closePopupInnerBlock=this.Context.factory.createElement("CONTAINER",{id:"closePopupInnerContainer",key:"closePopupInnerContainer",style:{height:"inherit",alignItems:"center"}},closeIcon),result=this.Context.factory.createElement("CONTAINER",{id:"closePopupContainer",key:"closePopupContainer",style:{width:"100%",height:this.Context.theming.measures.measure300,minHeight:this.Context.theming.measures.measure300,justifyContent:"flex-end",fontSize:"16px"}},closePopupInnerBlock);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderClosePopup","");return result};KbSearchControl.prototype.updateView=function(context){KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"updateView","");this.Context=context;this.searchUIEnhancementsEnabled=MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements);if(this.isInitializing){this._stateManager.ExecuteKbSearchHelper.setSearchType(this._stateManager.isExternalSearchIndexEnabled);if(context.utils.isFeatureEnabled(KbSearchControl_1.Constants.UCKMControlRelevanceSearch)&&this._stateManager.isExternalSearchIndexEnabled)this._isRelevanceSearchSyncStatusValid=this._validateRelevanceSearchSyncStatus()}else return;if(this._isRelevanceSearchSyncStatusValid){if(context.utils.isFeatureEnabled(KbSearchControl_1.Constants.UCKMControlRelevanceSearch)&&this._stateManager.isExternalSearchIndexEnabled)this.kbRelevanceSearchRecordCollection=this._stateManager.getRelevanceSearchRecordsToDisplay();this.handleSearchWidgetActionResult();this.UpdateActiveLanguages();this.handleFilterQuery();this.handleNumberOfResults();this.handleSearchQueryUpdate();var statePersistenceEnabled=MscrmControls.KbCommonUtils.FCBUtil.IsStatePersistenceEnabled(this._context);(this.isInitializing&&!statePersistenceEnabled||!this._state)&&this._stateManager.ExecuteKbSearchHelper.UpdateAutoSuggestionsFormField();this._stateManager.kmPrivileges=this.kmPrivileges;this._stateManager.useExternalKMPortal=this.useExternalKMPortal;this._stateManager.externalKMPortalURL=this.externalKMPortalURL}this._stateManager.shouldShowSelected&&this._stateManager.LoadSelectedArticles();var result=this.renderControl(false);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"updateView","");this.handleInitialFocusInStandAloneMode();return result};KbSearchControl.prototype.IsStandaloneMode=function(){return MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(this._context.page.entityTypeName)};KbSearchControl.prototype.handleInitialFocusInStandAloneMode=function(){var _this_1=this;if(!this.IsStandaloneMode())return;if(!this.isInitialFocusSetOnStandAloneMode){window.setTimeout(function(){_this_1._context.accessibility.focusElementById(KbSearchControl_1.Constants.SearchTextBoxId)},0);this.isInitialFocusSetOnStandAloneMode=true}};KbSearchControl.prototype.handleSearchQueryUpdate=function(){this._stateManager.ExecuteKbSearchHelper.HandleCurrentSearchTextChanged(this.Context)};KbSearchControl.prototype._validateRelevanceSearchSyncStatus=function(){var isRelevanceSearchSyncStatusValid=this._validateEntitySyncStatus(this._stateManager.knowledgeArticleAttributeList,KbSearchControl_1.Constants.KnowledgeArticle_MandatoryFields);return isRelevanceSearchSyncStatusValid};KbSearchControl.prototype._validateEntitySyncStatus=function(entityQVFViewColumns,entityMandatoryFields){if(entityQVFViewColumns&&entityQVFViewColumns.length>0)return entityMandatoryFields.every(function(mandatoryField){return entityQVFViewColumns.indexOf(mandatoryField)>-1})&&this._validateAdditionalFilterStatus(entityQVFViewColumns);return false};KbSearchControl.prototype._validateAdditionalFilterStatus=function(entityQVFViewColumns){return !this._context.utils.isFeatureEnabled(KbSearchControl_1.Constants.MetadataDrivenFilterForKbSearch)||!this.Context.parameters.value.descriptors.enableMDF||Object.keys(this._stateManager.ExecuteKbSearchHelper.additionalKnowledgeArticleFilters).every(function(additionalFilter){return entityQVFViewColumns.indexOf(additionalFilter)>-1})};KbSearchControl.prototype.renderControl=function(isPopupControl){this.kbSearchResultAccessibilityText="";this.kbSearchErrorAccessibilityText="";var isExpandedMode=!isPopupControl?this._stateManager.IsExpandedMode:this._stateManager.IsPopupRenderedInExpandedMode;if(!isExpandedMode||this.searchUIEnhancementsEnabled&&window.IsUSD)return this.renderStandardModeControl(isPopupControl);else return this.searchUIEnhancementsEnabled?this.renderStandaloneSearchControl(isPopupControl):this.renderExpandedModeControl(isPopupControl)};KbSearchControl.prototype.renderStandaloneSearchControl=function(isPopupControl){var _this_1=this;if(this.Context.parameters.value.hideSearchOnRecordLoad)return this.renderStandardModeControl(isPopupControl);KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderStandaloneSearchControl","");var controlBlock=[],dataBlock=[],resultsPane=[];isPopupControl&&controlBlock.push(this.renderClosePopup());(!this.Context.parameters.value.isOnPremises||this.Context.parameters.value.showLabel||KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI))&&controlBlock.push(this.renderHeader());if(this.SearchBoxContainerObject==null){this.SearchBoxContainerObject=new KbSearchControl_1.SearchBoxContainer;this.SearchBoxContainerObject.init(this.Context)}!this._context.parameters.value.hideSearchOnRecordLoad&&controlBlock.push(this.SearchBoxContainerObject.render(isPopupControl));if(this._stateManager.GetIsSearchMode()){var isLoading=this._stateManager.loading;if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)){controlBlock.push(this.renderFiltersWithFilterControl());this.overrideReferencePanelMaxHeight()}else controlBlock.push(this.renderFilters(isPopupControl));controlBlock.push(this.renderResultCountAndSortFilterInline(isPopupControl));if(!this._isRelevanceSearchSyncStatusValid||this._stateManager.error&&this._stateManager.errorMessage!="")dataBlock.push(this.renderErrorMessage());else if(isLoading)dataBlock.push(this.renderLoading());else if(this._stateManager.getShowResults(this._context)&&this._stateManager.records||this._stateManager.getShowResults(this._context)&&this.kbRelevanceSearchRecordCollection&&this.kbRelevanceSearchRecordCollection.length>0)dataBlock.push(this.renderSearchResults(isPopupControl));else this._stateManager.getShowResults(this._context)&&this.kbRelevanceSearchRecordCollection&&this.kbRelevanceSearchRecordCollection.length<=0&&dataBlock.push(this.noRecordsForRelevanceSearch())}else if(!this._stateManager.popupEnabled||isPopupControl||this._context.parameters.value.hideSearchOnRecordLoad){var isLoading=this._stateManager.loading;if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)){controlBlock.push(this.renderFiltersWithFilterControl());this.overrideReferencePanelMaxHeight()}else controlBlock.push(this.renderFilters(isPopupControl));controlBlock.push(this.renderResultCountAndSortFilterInline(isPopupControl));if(!this._isRelevanceSearchSyncStatusValid||this._stateManager.error&&this._stateManager.errorMessage!="")dataBlock.push(this.renderErrorMessage());else if(isLoading)dataBlock.push(this.renderLoading());else if(this._stateManager.getShowResults(this._context)&&this._stateManager.records||this._stateManager.getShowResults(this._context)&&this.kbRelevanceSearchRecordCollection&&this.kbRelevanceSearchRecordCollection.length>0)dataBlock.push(this.renderSearchResults(isPopupControl));else this._stateManager.getShowResults(this._context)&&this.kbRelevanceSearchRecordCollection&&this.kbRelevanceSearchRecordCollection.length<=0&&dataBlock.push(this.noRecordsForRelevanceSearch());this.initializeArticleAndContentControl(resultsPane,isPopupControl)}var controlBlockContainer=this.Context.factory.createElement("CONTAINER",{id:"controlBlockContainer",key:"controlBlockContainer",style:{flexDirection:"column",overflowY:"hidden",overflowX:"hidden",flexShrink:0,alignItems:"flex-end",borderBottom:this.searchUIEnhancementsEnabled?"":"1.5px solid #efefef",paddingLeft:this._context.theming.measures.measure100,paddingRight:this._context.theming.measures.measure100}},controlBlock),searchAndDataBlockContainerId=(isPopupControl?KbSearchControl_1.Constants.PopupPrefixId:"")+KbSearchControl_1.Constants.SearchAndDataBlockContainerId,scrollingDataBlockContainer=this.Context.factory.createElement("CONTAINER",{id:searchAndDataBlockContainerId,key:searchAndDataBlockContainerId,style:{flexDirection:"column",flexGrow:1,flexShrink:1,overflowY:"auto",overflowX:"hidden"}},dataBlock);if(resultsPane.length==0){var defaultRightPaneIcon=this.Context.factory.createElement("IMG",{source:"/Webresources/msdyncrm_/KBSearchStandalone/RightPane_EmptyState.png",altText:KbSearchControl_1.KbSearchControlLocale.SearchAndSelectArticleMessage,style:{width:"14.35rem",height:"14.35rem","text-align":"center",display:"block","vertical-align":"middle",margin:"auto"}}),defaultRightPaneLabel=this._context.factory.createElement("LABEL",{id:"defaultRightPaneLabel",key:"defaultRightPaneLabel",style:{fontFamily:this._context.theming.fontfamilies.semibold,fontSize:this._context.theming.fontsizes.font125,textAlign:"center",paddingTop:this._context.theming.measures.measure100}},KbSearchControl_1.KbSearchControlLocale.SearchAndSelectArticleMessage),defaultRightPaneMessage=this._context.factory.createElement("CONTAINER",{id:"defaultRightPaneMessage",key:"defaultRightPaneMessage",style:{display:"flex",justifyContent:"center"}},defaultRightPaneLabel),defaultIconAndMessage=this._context.factory.createElement("CONTAINER",{id:"defaultIconAndMessage",key:"defaultIconAndMessage",style:{display:"flex",flexDirection:"column",margin:"auto"}},[defaultRightPaneIcon,defaultRightPaneMessage]);resultsPane.push(defaultIconAndMessage)}var resultsBlockContainer=this.Context.factory.createElement("CONTAINER",{id:"resultsBlockContainer",key:"resultsBlockContainer",style:{flexDirection:"column",flexGrow:7,width:0,overflowY:"hidden",overflowX:"hidden",padding:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?0:"10px 16px"}},resultsPane),popup;if(this._stateManager.popupEnabled&&!isPopupControl)popup=this.Context.factory.createElement("POPUP",{type:1,name:"searchWidgetPopup",popupToOpen:"searchWidgetPopup",popupStyle:{width:"calc(100% - "+this.Context.theming.measures.measure250+" - "+this.Context.theming.measures.measure250+")",height:"calc(100% - "+this.Context.theming.measures.measure250+" - "+this.Context.theming.measures.measure250+")",display:"block",margin:this.Context.theming.measures.measure250,paddingLeft:this.Context.theming.measures.measure050,paddingRight:this.Context.theming.measures.measure050,paddingBottom:this.Context.theming.measures.measure150,backgroundColor:"white",boxShadow:"0px 0px 9px -1px"},shadowStyle:{top:"0",left:"0",position:"fixed",backgroundColor:"rgba(0, 55, 0, 0.3)",width:"100%",height:"100%"}},this.renderControl(!isPopupControl));this.requestRenderIfNecessary();var resultsAccessibilityContainer=this.renderResultsAccessibilityContainer(),errorAccessibilityContainer=this.renderErrorResultsAccessibilityContainer(),searchControlContainerRootId=isPopupControl?"popup":"",searchControlContainerId=searchControlContainerRootId+"searchControlContainer",controlMaxHeight=this.StandaloneControlMaxHeight(true),leftPane=this.Context.factory.createElement("SCROLLCONTAINER",{id:searchControlContainerId+"LeftPane",key:searchControlContainerId+"LeftPane",className:"mscrm-kbSearchContainer",style:{width:this._context.client.allocatedWidth>=1300?"30%":"390px",height:isPopupControl?"100%":"auto",maxHeight:controlMaxHeight+"px",minHeight:"inherit",display:"flex",flexDirection:"column",overflowX:"hidden",overflowY:"auto",borderRight:"1.5px solid #efefef",fontFamily:this._context.theming.fontfamilies.regular},onKeyDown:function(event){return _this_1.OnKeyDownSkipContent(event)}},[controlBlockContainer,scrollingDataBlockContainer,popup,resultsAccessibilityContainer,errorAccessibilityContainer]),rightPane=this.Context.factory.createElement("CONTAINER",{id:"searchControlContainerIdRightPane",key:"searchControlContainerIdRightPane",className:"mscrm-kbSearchContainer",style:{width:this._context.client.allocatedWidth>=1300?"70%":"calc(100% - 390px)",maxHeight:controlMaxHeight+16+"px",height:isPopupControl?"100%":"auto",minHeight:"inherit",display:"flex",flexDirection:"row",overflowX:"hidden",fontFamily:this._context.theming.fontfamilies.regular},onKeyDown:function(event){return _this_1.OnKeyDownSkipContent(event)}},resultsBlockContainer);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderStandaloneSearchControl","");!this._stateManager.loading&&KbSearchControl_1.PerformanceTelemetry.Instance.AddEndMarker(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_LOAD_KBSEARCH_CONTROL,this._context);var result=this.Context.factory.createElement("CONTAINER",{id:searchControlContainerId,key:searchControlContainerId,className:"mscrm-kbSearchContainer",style:{width:"calc(100% - "+this.Context.theming.measures.measure100+" - "+this.Context.theming.measures.measure100+")",height:!this._stateManager.popupEnabled||!isPopupControl?"auto":"100%",minHeight:"inherit",flex:"1 1 auto",display:"flex",flexDirection:"row",overflow:"hidden",fontFamily:this._context.theming.fontfamilies.regular,backgroundColor:"#ffffff"}},[leftPane,rightPane]);return result};KbSearchControl.prototype.renderExpandedModeControl=function(isPopupControl){var _this_1=this;KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderExpandedModeControl","");var headerBlock=[],filterBlock=[],searchAndDataBlock=[],itemsForFlexContainer=[];this._stateManager.filtersVisible=false;isPopupControl&&headerBlock.push(this.renderClosePopup());(!this.Context.parameters.value.isOnPremises||this.Context.parameters.value.showLabel)&&headerBlock.push(this.renderHeader());if(this.SearchBoxContainerObject==null){this.SearchBoxContainerObject=new KbSearchControl_1.SearchBoxContainer;this.SearchBoxContainerObject.init(this.Context)}if(this._stateManager.GetIsSearchMode()){!this._context.parameters.value.hideSearchOnRecordLoad&&searchAndDataBlock.push(this.SearchBoxContainerObject.render(isPopupControl));var isLoading=this._stateManager.loading,labelText=KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)?"":KbSearchControl_1.KbSearchControlLocale.FilterResultsByLabel;filterBlock.push(this.Context.factory.createElement("Label",{id:"filterResultsByLabelId",key:"filterResultsByLabel",className:"filterResultsByLabel",style:{color:this._context.theming.colors.grays.gray06,overflow:"auto",width:"100%",fontSize:this._context.theming.fontsizes.font100,whiteSpace:"normal",marginTop:this._context.theming.measures.measure050,paddingBottom:this._context.theming.measures.measure050,borderBottom:this._context.theming.borders.border02}},labelText));if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)){this._stateManager.filtersVisible=true;filterBlock.push(this.renderFiltersWithFilterControl());this.overrideReferencePanelMaxHeight()}else{filterBlock.push(this.renderArticleStatusFilter(isPopupControl));filterBlock.push(this.renderLanguageFilter(isPopupControl))}filterBlock.push(this.renderSortPane(isPopupControl));searchAndDataBlock.push(this.renderResultsCount());if(!this._isRelevanceSearchSyncStatusValid||this._stateManager.error&&this._stateManager.errorMessage!="")searchAndDataBlock.push(this.renderErrorMessage());else if(isLoading)searchAndDataBlock.push(this.renderLoading());else if(this._stateManager.getShowResults(this._context)&&this._stateManager.records||this._stateManager.getShowResults(this._context)&&this.kbRelevanceSearchRecordCollection&&this.kbRelevanceSearchRecordCollection.length>0){var dataBlockContainer=this.Context.factory.createElement("SCROLLCONTAINER",{id:"dataBlockContainer",key:"dataBlockContainer",className:"mscrm-dataBlockContainer",style:{flexDirection:"column",maxHeight:!isPopupControl?this.ControlMaxHeight(true)+"px":"none",overflowY:"auto",overflowX:"hidden"}},this.renderSearchResults(isPopupControl));searchAndDataBlock.push(dataBlockContainer)}else this._stateManager.getShowResults(this._context)&&this.kbRelevanceSearchRecordCollection&&this.kbRelevanceSearchRecordCollection.length<=0&&searchAndDataBlock.push(this.noRecordsForRelevanceSearch())}else if(!this._stateManager.popupEnabled||isPopupControl||this._context.parameters.value.hideSearchOnRecordLoad){this.initializeArticleAndContentControl(searchAndDataBlock,isPopupControl);this.searchUIEnhancementsEnabled&&this.overrideReferencePanelMaxHeight()}var headerBlockStyles={flexBasis:"auto",flexShrink:"0",flexDirection:"column",overflowY:"auto",overflowX:"hidden"};if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this.Context,KbSearchControl_1.Constants.KMRefreshSearchUI)){headerBlockStyles.overflowY="hidden";headerBlockStyles.height="32px"}var headerBlockContainer=this.Context.factory.createElement("CONTAINER",{id:"controlBlockContainer",key:"controlBlockContainer",style:headerBlockStyles},headerBlock),filterBlockContainer=this.Context.factory.createElement("SCROLLCONTAINER",{id:"filterBlockContainer",key:"filterBlockContainer",style:{flexDirection:"column",flexGrow:3,width:0,overflowY:"auto",overflowX:"hidden",marginTop:this._context.theming.measures.measure075,paddingLeft:this.Context.theming.measures.measure100,paddingRight:this.Context.theming.measures.measure100,backgroundColor:"#DEDEDE"}},filterBlock),searchAndDataBlockContainerId=(isPopupControl?KbSearchControl_1.Constants.PopupPrefixId:"")+KbSearchControl_1.Constants.SearchAndDataBlockContainerId,searchAndDataBlockContainer=this.Context.factory.createElement("CONTAINER",{id:searchAndDataBlockContainerId,key:searchAndDataBlockContainerId,style:{flexDirection:"column",flexGrow:7,width:0,overflowY:"hidden",overflowX:"hidden",paddingLeft:this.Context.client.isRTL?"0px":this._stateManager.GetIsSearchMode()?this.Context.theming.measures.measure100:"0px",paddingRight:this.Context.client.isRTL?this._stateManager.GetIsSearchMode()?this.Context.theming.measures.measure100:"0px":"0px"}},searchAndDataBlock);this._stateManager.GetIsSearchMode()&&this.IsKBSearchFilterEnabled()&&itemsForFlexContainer.push(filterBlockContainer);itemsForFlexContainer.push(searchAndDataBlockContainer);var flexContainer=this.Context.factory.createElement("CONTAINER",{id:"flexContainer",key:"flexContainer",className:"mscrm-kbSearchContainer",style:{width:"100%",display:"flex",flex:1,flexBasis:"auto",overflowX:"hidden",overflowY:"hidden"},onKeyDown:function(event){return _this_1.OnKeyDownSkipContent(event)}},itemsForFlexContainer),popup;if(this._stateManager.popupEnabled&&!isPopupControl)popup=this.Context.factory.createElement("POPUP",{type:1,name:"searchWidgetPopup",popupToOpen:"searchWidgetPopup",popupStyle:{width:"calc(100% - "+this.Context.theming.measures.measure250+" - "+this.Context.theming.measures.measure250+")",height:"calc(100% - "+this.Context.theming.measures.measure250+" - "+this.Context.theming.measures.measure250+")",display:"block",margin:this.Context.theming.measures.measure250,paddingLeft:this.Context.theming.measures.measure050,paddingRight:this.Context.theming.measures.measure050,backgroundColor:"white",boxShadow:"0px 0px 9px -1px"},shadowStyle:{top:"0",left:"0",position:"fixed",backgroundColor:"rgba(0, 55, 0, 0.3)",width:"100%",height:"100%"}},this.renderControl(!isPopupControl));this.requestRenderIfNecessary();var resultsAccessibilityContainer=this.renderResultsAccessibilityContainer(),errorAccessibilityContainer=this.renderErrorResultsAccessibilityContainer(),searchControlContainerRootId=isPopupControl?"popup":"",searchControlContainerId=searchControlContainerRootId+"searchControlContainer",result=this.Context.factory.createElement("CONTAINER",{id:searchControlContainerId,key:searchControlContainerId,className:"mscrm-kbSearchContainer",style:{width:"calc(100% - "+this.Context.theming.measures.measure100+" - "+this.Context.theming.measures.measure100+")",height:!this._stateManager.popupEnabled||!isPopupControl?"auto":"100%",minHeight:"inherit",marginLeft:this.Context.theming.measures.measure100,marginRight:this.Context.theming.measures.measure100,flex:"1 1 auto",display:"flex",flexDirection:"column",overflowX:"hidden",overflowY:"hidden",fontFamily:this._context.theming.fontfamilies.regular}},[headerBlockContainer,flexContainer,popup,resultsAccessibilityContainer,errorAccessibilityContainer]);!this._stateManager.loading&&KbSearchControl_1.PerformanceTelemetry.Instance.AddEndMarker(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_LOAD_KBSEARCH_CONTROL,this._context);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderExpandedModeControl","");return result};KbSearchControl.prototype.IsKBSearchFilterEnabled=function(){try{var urlParams=new URLSearchParams(window.location.search),showFilterValue=urlParams.get(KbSearchControl_1.Constants.ShowFilterString);return showFilterValue!=KbSearchControl_1.Constants.ShowFilterOff}catch(ex){return true}};KbSearchControl.prototype.overrideReferencePanelMaxHeight=function(){var _this_1=this;setTimeout(function(){var searchContainerID=_this_1._context.accessibility.getUniqueId("searchControlContainer"),searchContainer=$("#"+searchContainerID.replace(/\./g,"\\."));searchContainer.parent().css("max-height","none");var refpanelcontainer=searchContainer.closest("[id*='ReferencePanelContainer']");refpanelcontainer&&refpanelcontainer.length>0&&refpanelcontainer.css("height","inherit");var refPanelSessionandContent=searchContainer.closest("[id*='ReferencePanelSessionAndContent']");refPanelSessionandContent&&refPanelSessionandContent.length>0&&refPanelSessionandContent.css("height","100%")})};KbSearchControl.prototype.renderStandardModeControl=function(isPopupControl){var _this_1=this;KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderStandardModeControl","");var controlBlock=[],dataBlock=[];isPopupControl&&controlBlock.push(this.renderClosePopup());(!this.Context.parameters.value.isOnPremises||this.Context.parameters.value.showLabel||KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI))&&controlBlock.push(this.renderHeader());if(this.SearchBoxContainerObject==null){this.SearchBoxContainerObject=new KbSearchControl_1.SearchBoxContainer;this.SearchBoxContainerObject.init(this.Context)}!this._context.parameters.value.hideSearchOnRecordLoad&&controlBlock.push(this.SearchBoxContainerObject.render(isPopupControl));if(this._stateManager.GetIsSearchMode()){var isLoading=this._stateManager.loading;if(KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)){controlBlock.push(this.renderFiltersWithFilterControl());this.overrideReferencePanelMaxHeight()}else controlBlock.push(this.renderFilters(isPopupControl));controlBlock.push(this.renderResultCountAndSortFilterInline(isPopupControl));if(!this._isRelevanceSearchSyncStatusValid||this._stateManager.error&&this._stateManager.errorMessage!="")dataBlock.push(this.renderErrorMessage());else if(isLoading)dataBlock.push(this.renderLoading());else if(this._stateManager.getShowResults(this._context)&&this._stateManager.records||this._stateManager.getShowResults(this._context)&&this.kbRelevanceSearchRecordCollection&&this.kbRelevanceSearchRecordCollection.length>0)dataBlock.push(this.renderSearchResults(isPopupControl));else this._stateManager.getShowResults(this._context)&&this.kbRelevanceSearchRecordCollection&&this.kbRelevanceSearchRecordCollection.length<=0&&dataBlock.push(this.noRecordsForRelevanceSearch())}else if(!this._stateManager.popupEnabled||isPopupControl||this._context.parameters.value.hideSearchOnRecordLoad){this.initializeArticleAndContentControl(dataBlock,isPopupControl);this.searchUIEnhancementsEnabled&&this.overrideReferencePanelMaxHeight()}var addPadding=this.searchUIEnhancementsEnabled&&!KbSearchControl_1.KbSearchUtil.IsHostedInFormContext(this.Context),renderOnlyheaderTitle=this.searchUIEnhancementsEnabled&&!this._stateManager.GetIsSearchMode();if(renderOnlyheaderTitle){var header=this.Context.parameters.value.showLabel?this.Context.parameters.value.label:"";if(this.searchUIEnhancementsEnabled&&!KbSearchControl_1.KbSearchUtil.IsHostedInFormContext(this.Context)&&MscrmCommon.ControlUtils.String.isNullOrEmpty(header))header=KbSearchControl_1.KbSearchControlLocale.KnowledgeSearch;if(!MscrmCommon.ControlUtils.String.isNullOrEmpty(header)){controlBlock=[];var headerTitle=this.Context.factory.createElement("text",{key:"headerLabel",className:"mscrm-kbSearchControlLabel",semanticTag:"h3",style:{marginTop:"6px",display:"block",fontSize:this._context.theming.fontsizes.font100,fontFamily:this._context.theming.fontfamilies.semibold,color:"#333333",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},header);controlBlock.push(this.Context.factory.createElement("CONTAINER",{id:"headerTitleContainer",key:"headerTitleContainer",style:{height:"38px",paddingTop:this._context.theming.measures.measure075,borderBottom:"1px solid #D7D7D7"}},headerTitle))}}var controlBlockContainer=this.Context.factory.createElement("CONTAINER",{id:"controlBlockContainer",key:"controlBlockContainer",style:{flexDirection:"column",overflowY:"hidden",overflowX:"hidden",flexShrink:0,paddingLeft:addPadding?this._context.theming.measures.measure100:"inherit",paddingRight:addPadding?this._context.theming.measures.measure100:"inherit"}},controlBlock),searchAndDataBlockContainerId=(isPopupControl?KbSearchControl_1.Constants.PopupPrefixId:"")+KbSearchControl_1.Constants.SearchAndDataBlockContainerId,scrollingDataBlockContainer=this.Context.factory.createElement("SCROLLCONTAINER",{id:searchAndDataBlockContainerId,key:searchAndDataBlockContainerId,style:{flexDirection:"column",flexGrow:1,flexShrink:1,overflowY:"auto",overflowX:"hidden",paddingLeft:addPadding&&!this._stateManager.GetIsSearchMode()?this._context.theming.measures.measure100:"inherit",paddingRight:addPadding&&!this._stateManager.GetIsSearchMode()?this._context.theming.measures.measure100:"inherit"}},dataBlock),popup;if(this._stateManager.popupEnabled&&!isPopupControl)popup=this.Context.factory.createElement("POPUP",{type:1,name:"searchWidgetPopup",popupToOpen:"searchWidgetPopup",popupStyle:{width:"calc(100% - "+this.Context.theming.measures.measure250+" - "+this.Context.theming.measures.measure250+")",height:"calc(100% - "+this.Context.theming.measures.measure250+" - "+this.Context.theming.measures.measure250+")",display:"block",margin:this.Context.theming.measures.measure250,paddingLeft:this.Context.theming.measures.measure050,paddingRight:this.Context.theming.measures.measure050,paddingBottom:this.Context.theming.measures.measure150,backgroundColor:"white",boxShadow:"0px 0px 9px -1px"},shadowStyle:{top:"0",left:"0",position:"fixed",backgroundColor:"rgba(0, 55, 0, 0.3)",width:"100%",height:"100%"}},this.renderControl(!isPopupControl));this.requestRenderIfNecessary();var resultsAccessibilityContainer=this.renderResultsAccessibilityContainer(),errorAccessibilityContainer=this.renderErrorResultsAccessibilityContainer(),searchControlContainerRootId=isPopupControl?"popup":"",searchControlContainerId=searchControlContainerRootId+"searchControlContainer",controlMaxHeight="";if(isPopupControl||KbSearchControl_1.KbSearchUtil.IsHostedInFormContext(this.Context)||window.IsUSD)controlMaxHeight="none";else controlMaxHeight=this.StandaloneControlMaxHeight(false)+"px";var result=this.Context.factory.createElement("CONTAINER",{id:searchControlContainerId,key:searchControlContainerId,className:"mscrm-kbSearchContainer",style:{width:"100%",height:isPopupControl?"100%":"auto",minHeight:"inherit",display:"flex",flexDirection:"column",maxHeight:controlMaxHeight,backgroundColor:this.searchUIEnhancementsEnabled?this._context.theming.colors.whitebackground:"inherit",overflowX:"hidden",overflowY:"hidden",fontFamily:this._context.theming.fontfamilies.regular},onKeyDown:function(event){return _this_1.OnKeyDownSkipContent(event)}},[this.searchUIEnhancementsEnabled||this._stateManager.GetIsSearchMode()?controlBlockContainer:null,scrollingDataBlockContainer,popup,resultsAccessibilityContainer,errorAccessibilityContainer]);KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"renderStandardModeControl","");!this._stateManager.loading&&KbSearchControl_1.PerformanceTelemetry.Instance.AddEndMarker(KbSearchControl_1.TelemetryConstants.WATERMARK_ACTION_LOAD_KBSEARCH_CONTROL,this._context);return result};KbSearchControl.prototype.getUsedHeightOfControl=function(){var usedHeight=0,controlBlockContainer=document.getElementById(this._context.accessibility.getUniqueId("controlBlockContainer"));if(controlBlockContainer)usedHeight+=controlBlockContainer.clientHeight;return usedHeight};KbSearchControl.prototype.renderLoading=function(){var progressIndicator=this.Context.factory.createElement("PROGRESSINDICATOR",{key:"kbsearchprogressIndicator",id:"kbsearchprogressIndicator",style:{width:"40px",height:"40px",display:"table",margin:"0 auto"},progressType:"ring",testhooks:{id:"kbsearchsearch-progress-indicator"},active:true},[]),LoadingText=this.Context.factory.createElement("Label",{id:"LoadingTextLabelId",key:"LoadingTextLabel",className:"LoadingTextLabel",style:{paddingTop:"50px"}},KbSearchControl_1.KbSearchControlLocale.LoadingTextLocale),progressIndicatorContainer=this.Context.factory.createElement("CONTAINER",{key:"kbsearchprogressIndicatorContainer",style:{display:"flex",position:"relative",alignSelf:"center",padding:"50px",margin:"0 auto"}},[progressIndicator,LoadingText]);return progressIndicatorContainer};KbSearchControl.prototype.renderSortPane=function(isPopupControl){var expandedRendering=isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode||this._stateManager.IsExpandedMode,filterContainer=[],sortLabelAndComboBoxContainer=[],sortStyle=this.selectStyle(isPopupControl);if(!expandedRendering){sortStyle["maxWidth"]="75%";sortStyle["flex"]="1"}else sortStyle["minWidth"]="100%";sortLabelAndComboBoxContainer.push(this.Context.factory.createElement("Label",{id:"sortByLabelId",key:"sortByLabel",className:"sortByLabel",style:{display:expandedRendering?"block":"",color:this._context.theming.colors.grays.gray06,overflow:"hidden",maxWidth:"inherit",marginLeft:this._context.client.isRTL?this._context.theming.measures.measure050:0,marginRight:this._context.client.isRTL?0:this._context.theming.measures.measure050,marginBottom:expandedRendering?this._context.theming.measures.measure050:this._context.theming.measures.measure025,fontFamily:this._context.theming.fontfamilies.regular,fontSize:this._context.theming.fontsizes.font100,whiteSpace:"nowrap",textOverflow:"hidden"}},KbSearchControl_1.KbSearchControlLocale.SortByLabel));var sortComboBox=this.Context.factory.createElement("SELECT",{id:"kbSortFilterComboBoxid",key:"kbSortFilterComboBox_container",value:this._stateManager.SortFilter.SelectedSortFilter,onChange:this._handleSortFilterChange.bind(this),disabled:false,freeTextMode:false,autoFocus:true,style:sortStyle,options:this._stateManager.SortFilter.sortFilters,accessibilityLabel:KbSearchControl_1.KbSearchControlLocale.SortFilterTitleText,accessibilityReadOnly:true,title:KbSearchControl_1.KbSearchControlLocale.SortFilterTitleText},this._stateManager.SortFilter.sortFilters);sortLabelAndComboBoxContainer.push(sortComboBox);var sortReflowContainer=this.Context.factory.createElement("Container",{id:"sortReflowContainerid",key:"sortReflowContainer",style:{display:"flex",flexDirection:"row",flexWrap:"wrap",flexBasis:"auto",position:"relative",maxWidth:"100%",alignItems:"baseline"}},sortLabelAndComboBoxContainer);filterContainer.push(sortReflowContainer);return this.Context.factory.createElement("Container",{id:"sortFilterDivid",key:"sortFilterDiv",style:{display:expandedRendering?"inline-block":"flex",flexDirection:expandedRendering?"column":"row",maxWidth:"100%",alignItems:"center","float":"right",flexWrap:"wrap",marginBottom:this._context.theming.measures.measure100,marginTop:this._context.theming.measures.measure050,justifyContent:"flex-end","flex-grow":"1","flex-basis":"auto",minWidth:"1px"},className:"mscrm-mscrm-kbSearchSortFilterContainer"},filterContainer)};KbSearchControl.prototype.selectStyle=function(isPopupControl){var selectStyle={height:this._context.theming.measures.measure225,fontSize:this._context.theming.fontsizes.font100,minWidth:"100px",maxWidth:"100%",display:"flex"};if(this._stateManager.IsExpandedMode||isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode)selectStyle["width"]="100%";return {selectStyle:selectStyle}};KbSearchControl.prototype.renderResultCountAndSortFilterInline=function(isPopupControl){var filterContainer=[],resultCountAndSortFilterStyle={display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"baseline",justifyContent:"space-between",boxSizing:"border-box"};if(MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)){resultCountAndSortFilterStyle["width"]="100%";resultCountAndSortFilterStyle["alignSelf"]=this._stateManager.IsExpandedMode?"baseline":"auto";resultCountAndSortFilterStyle["paddingBottom"]=this._stateManager.IsExpandedMode?this._context.theming.measures.measure075:this._context.theming.measures.measure050}if(!this._stateManager.ExecuteKbSearchHelper.SearchHasBeenPerformed||!this._stateManager.totalCount)resultCountAndSortFilterStyle["justifyContent"]=this.searchUIEnhancementsEnabled?"flex-start":"flex-end";if(!this._stateManager.loading){var resultCount=this.renderResultsCount();filterContainer.push(resultCount)}if(!KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)){var sortComboBox=this.renderSortPane(isPopupControl);filterContainer.push(sortComboBox)}return this.Context.factory.createElement("Container",{id:"resultCountAndSortFilterDivId",key:"resultCountAndSortFilterDiv",style:resultCountAndSortFilterStyle,className:"mscrm-resultCountAndSortFilterContainer"},filterContainer)};KbSearchControl.prototype.renderResultsAccessibilityContainer=function(){return this.Context.factory.createElement("Container",{id:"resultAccessibilityContainer",key:"resultAccessibilityContainer",accessibilityLive:"assertive",accessibilityAtomic:"true",accessibilityRelevant:"all",style:{height:"0",width:"0",overflow:"hidden"}},this.kbSearchResultAccessibilityText)};KbSearchControl.prototype.renderErrorResultsAccessibilityContainer=function(){return this.Context.factory.createElement("Container",{id:"errorResultAccessibilityContainer",key:"errorResultAccessibilityContainer",accessibilityLive:"assertive",accessibilityAtomic:"true",accessibilityRelevant:"all",style:{height:"0",width:"0",overflow:"hidden"}},this.kbSearchErrorAccessibilityText)};KbSearchControl.prototype.renderResultsCount=function(){if(!this._stateManager.ExecuteKbSearchHelper.SearchHasBeenPerformed||!this._stateManager.isExternalSearchIndexEnabled&&!this._stateManager.records||this._stateManager.isExternalSearchIndexEnabled&&!this.kbRelevanceSearchRecordCollection)return this.Context.factory.createElement("Container",{id:"resultsContainer",style:{display:"inline-block",whiteSpace:"nowrap",marginLeft:this._context.client.isRTL?this._context.theming.measures.measure100:0,marginRight:this._context.client.isRTL?0:this._context.theming.measures.measure100,marginTop:KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)?0:this._context.theming.measures.measure050}});var resultsFoundText,resultCount=0;if(!this._stateManager.isExternalSearchIndexEnabled&&this._stateManager.records||this._stateManager.isExternalSearchIndexEnabled&&this.kbRelevanceSearchRecordCollection){if(this._stateManager.isExternalSearchIndexEnabled&&this._stateManager.ExecuteKbSearchHelper.mode===1)if(this._stateManager.canCallRelevanceSearch)if(this._stateManager.relevanceSearchRecords)resultCount=this._stateManager.relevanceSearchRecords.totalCount;else resultCount=0;else resultCount=this._stateManager.kbRelevanceSearchRecordCollection.length;else resultCount=this._stateManager.totalCount;resultsFoundText=MscrmCommon.ControlUtils.String.Format(KbSearchControl_1.KbSearchControlLocale.NumberOfResultsFoundText,resultCount)}this.kbSearchResultAccessibilityText=resultsFoundText;var resultsLabel=this.Context.factory.createElement("label",{id:"resultsFoundTextId",ref:"resultsFoundText",accessibilityLabel:resultsFoundText,style:{display:"inline-block",maxWidth:"100%",width:"100%",fontSize:this.searchUIEnhancementsEnabled?this._context.theming.fontsizes.font085:this._context.theming.fontsizes.font100,marginRight:0,marginLeft:0}},resultsFoundText),sortedByLabel=null;if(this.searchUIEnhancementsEnabled&&resultCount>0){resultsLabel.getProperties().style["width"]="auto";var sortedByText=MscrmCommon.ControlUtils.String.Format(KbSearchControl_1.KbSearchControlLocale.SortedByText,this._stateManager.SortFilter.SelectedSortFilter.Label);this.kbSearchResultAccessibilityText+=sortedByText;sortedByLabel=this.Context.factory.createElement("label",{id:"sortedByTextId",ref:"sortedBText",accessibilityLabel:sortedByText,style:{display:"inline-block",textAlign:this._context.client.isRTL?"left":"right",fontSize:this._context.theming.fontsizes.font085}},sortedByText)}return this.Context.factory.createElement("Container",{id:"resultsContainer",style:{display:"flex",width:"100%",flexWrap:"wrap",justifyContent:"space-between",marginLeft:this._context.client.isRTL&&!this.searchUIEnhancementsEnabled?this._context.theming.measures.measure100:0,marginRight:this._context.client.isRTL||this.searchUIEnhancementsEnabled?0:this._context.theming.measures.measure100,marginTop:KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)?0:this._context.theming.measures.measure050}},[resultsLabel,sortedByLabel])};KbSearchControl.prototype.isReflowControlCanBeActive=function(){return false};KbSearchControl.prototype.renderErrorMessage=function(){var errorValues=[];if(!this._isRelevanceSearchSyncStatusValid)if(this._stateManager.isSavedQueryApiFailed){var savedQueryErrorMessage=KbSearchControl_1.KbSearchControlLocale.SavedQueryApiFailedErrorMessage;errorValues.push(this.Context.factory.createElement("Container",{style:{flexDirection:"row",overflow:"auto",width:"100%"}},savedQueryErrorMessage))}else{var messageHeader=KbSearchControl_1.KbSearchControlLocale.MandatoryFieldsMissingError,messageLinkParts=KbSearchControl_1.KbSearchControlLocale.MandatoryFieldMissingLinkFormat.split("{0}"),messagePartArray=[];messageLinkParts[0]&&messagePartArray.push(this.Context.factory.createElement("Label",{className:"mscrm-kbSearchResultDescription",style:{color:this._context.theming.colors.grays.gray05,fontSize:this._context.theming.fontsizes.font100,whiteSpace:"normal",wordBreak:"break-word"}},messageLinkParts[0]));messagePartArray.push(this.Context.factory.createElement("HYPERLINK",{href:KbSearchControl_1.Constants.MandatoryFieldKbLink,target:"_blank",style:{fontSize:this._context.theming.fontsizes.font100,whiteSpace:"normal",wordBreak:"break-word"},accessibilityLabel:KbSearchControl_1.KbSearchControlLocale.QuickFindDocumentationHelpLink},KbSearchControl_1.KbSearchControlLocale.MandatoryFieldMissingLinkText));messageLinkParts[1]&&messagePartArray.push(this.Context.factory.createElement("Label",{className:"mscrm-kbSearchResultDescription",style:{color:this._context.theming.colors.grays.gray05,fontSize:this._context.theming.fontsizes.font100,whiteSpace:"normal",wordBreak:"break-word"}},messageLinkParts[1]));errorValues.push(this.Context.factory.createElement("Container",{style:{overflow:"auto",width:"100%"}},messageHeader));errorValues.push(this.Context.factory.createElement("Container",{style:{overflow:"auto",width:"100%",display:"block"}},messagePartArray))}else{var errorMessage="";if(this._stateManager.errorMessage==KbSearchControl_1.Constants.KnowledgeManagementNotEnabledErrorMessageResourceName)errorMessage=MscrmCommon.ControlUtils.String.Format(this.Context.resources.getString(this._stateManager.errorMessage),this._context.parameters.value.entityDisplayName);else errorMessage=this.Context.resources.getString(this._stateManager.errorMessage);this.kbSearchErrorAccessibilityText=errorMessage;errorValues=this.constructErrorMessage(errorMessage,this._stateManager.errorDetails,this._stateManager.errorMessage);var errorDetails="";if(this._stateManager.errorDetails)errorDetails=this._stateManager.errorDetails;KbSearchControl_1.PerformanceTelemetry.Instance.AddErrorLog(this.Context,errorMessage,errorDetails)}return this._context.factory.createElement("Container",{id:"kbSearchErrorResults.body.id",key:"kbSearchErrorResults.body",style:{minHeight:this._context.theming.measures.measure250,display:"block",paddingLeft:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?"17px":0,paddingRight:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?"17px":0}},errorValues)};KbSearchControl.prototype.requestRenderIfNecessary=function(){if(this._stateManager.requestAdditionalRendering){this._stateManager.requestAdditionalRendering=false;var _this=this;setTimeout(function(){return _this.Context.utils.requestRender()},0)}};KbSearchControl.prototype.handleFilterQuery=function(){var needsToChange=true;if(this.Context.parameters.value.filterQueryParams){switch(this.Context.parameters.value.filterQueryParams.command){case KbSearchControl_1.SearchWidgetCommand.ArticlesFilter:needsToChange=this._stateManager.ArticleStatusFilter.SetSelectedArticleStatusFilterByFilterOption(this.Context.parameters.value.filterQueryParams.value);break;case KbSearchControl_1.SearchWidgetCommand.SortFilter:needsToChange=this._stateManager.SortFilter.SetSelectedSortFilterBySortOption(this.Context.parameters.value.filterQueryParams.value);break;case KbSearchControl_1.SearchWidgetCommand.LanguageFilter:needsToChange=this._stateManager.ArticleLanguageFilter.SetSelectedArticleLanguageFilterByFilterOption(this.Context.parameters.value.filterQueryParams.value);break;default:needsToChange=false;break}needsToChange&&this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype.handleNumberOfResults=function(){if(this._context.parameters.value.descriptors.numberOfResults!==this._stateManager.numberOfResults){this._stateManager.numberOfResults=this._context.parameters.value.descriptors.numberOfResults;this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}};KbSearchControl.prototype.initializeArticleAndContentControl=function(dataBlock,isPopupControl){KbSearchControl_1.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"initializeArticleAndContentControl","");this.KbSearchResultArticleInfoObject=this._stateManager.GetkbSearchResultArticleInfoObject();this.KbSearchResultContentPaneObject=this._stateManager.GetkbSearchResultContentPaneObject();var articleInfoControlContext=Object.assign({},this.Context);articleInfoControlContext.parameters.article=this._stateManager.GetSelectedArticle();articleInfoControlContext.parameters.enableRating=this._context.parameters.value.descriptors.enableRating;articleInfoControlContext.parameters.entityDisplayName=this._context.parameters.value.entityDisplayName;articleInfoControlContext.parameters.controlId=this._context.parameters.value.controlId+"kbarticle";var contentControlContext=Object.assign({},this.Context);contentControlContext.parameters.record=this._stateManager.GetSelectedArticle();this.KbSearchResultArticleInfoObject.init(articleInfoControlContext);this.KbSearchResultContentPaneObject.init(contentControlContext);this._stateManager.UpdateSelectedArticleDetails(this.Context);dataBlock.push(this.renderArticleActions(isPopupControl));dataBlock.push(this.KbSearchResultArticleInfoObject.render(isPopupControl));dataBlock.push(this.KbSearchResultContentPaneObject.render(isPopupControl));KbSearchControl_1.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl_1.Constants.KMRefreshSearchUI)&&this.overrideReferencePanelMaxHeight();KbSearchControl_1.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl_1.Constants.WebresourceNameKbSearchControl,"initializeArticleAndContentControl","")};KbSearchControl.prototype.checkAnnotationForAttachmentAndNotes=function(kbSearchRecord,annotation){if(MscrmObject.isNullOrUndefined(kbSearchRecord.annotationAttachmentCount))kbSearchRecord.annotationAttachmentCount=0;if(MscrmObject.isNullOrUndefined(kbSearchRecord.annotationNotesCount))kbSearchRecord.annotationNotesCount=0;if(annotation.highlights.hasOwnProperty("documentbody"))kbSearchRecord.annotationAttachmentCount++;if(annotation.highlights.hasOwnProperty("notetext"))kbSearchRecord.annotationNotesCount++};KbSearchControl.prototype.constructErrorMessage=function(errorMsg,errorDetails,errorConstant){var errorValues=[],errorMessage=errorMsg,errorHeader=this.Context.factory.createElement("Label",{className:"mscrm-kbSearchResultDescription",style:{color:this._context.theming.colors.grays.gray05,overflow:"auto",width:"100%",fontSize:this._context.theming.fontsizes.font100,whiteSpace:"normal",wordBreak:"break-word"}},errorMessage);if(MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this.Context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)){var errorHeaderProps=errorHeader.getProperties();errorHeaderProps.style["text-align"]="center";errorHeaderProps.style["padding-top"]=this._context.theming.measures.measure100;switch(errorConstant){case KbSearchControl_1.Constants.NoArticlesErrorMessageResourceName:case KbSearchControl_1.Constants.RecordDoesNotExistErrorMessageResourceName:case KbSearchControl_1.Constants.NoSearchErrorMessageResourceName:var imageElement=this.Context.factory.createElement("IMG",{source:"/Webresources/msdyncrm_/KBSearchStandalone/LeftPane_EmptyState.png",altText:errorMessage,style:{width:this.Context.theming.measures.measure350,height:this.Context.theming.measures.measure350,"padding-top":this._context.theming.measures.measure100}});errorValues.push(this.Context.factory.createElement("Container",{style:{flexDirection:"row","justify-content":"center"}},imageElement));break;default:break}}errorValues.push(this.Context.factory.createElement("Container",{style:{flexDirection:"row"}},errorHeader));if(errorDetails){for(var errorDetailsLines=errorDetails.replace(/\\r/g,"").split("\\n"),errorLines=[],_i=0,errorDetailsLines_1=errorDetailsLines;_i<errorDetailsLines_1.length;_i++){var errorDetailItem=errorDetailsLines_1[_i];errorLines.push(this.Context.factory.createElement("Text",{semanticTag:"div",style:{display:"block",whiteSpace:"nowrap"}},errorDetailItem))}var errorDetailContainer=this.Context.factory.createElement("Container",{style:{display:"inline-block",overflow:"auto"}},errorLines);errorValues.push(this.Context.factory.createElement("Container",{style:{paddingTop:this._context.theming.measures.measure100,maxHeight:"calc(2*"+this._context.theming.measures.measure1075+")"}},errorDetailContainer))}return errorValues};KbSearchControl.prototype.noRecordsForRelevanceSearch=function(){var errorMessage=KbSearchControl_1.KbSearchControlLocale.NoArticlesErrorMessage,errorValues=this.constructErrorMessage(errorMessage,null,KbSearchControl_1.Constants.NoArticlesErrorMessageResourceName);return this._context.factory.createElement("Container",{id:"kbSearchErrorResults.body.id",key:"kbSearchErrorResults.body",style:{minHeight:this._context.theming.measures.measure250,display:"block"}},errorValues)};KbSearchControl.prototype.handleWindowResize=function(){};KbSearchControl.prototype.handleSortButtonClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._showSortList=!this._showSortList;this._context.utils.requestRender()}};KbSearchControl.prototype.handleShowSelectedButtonClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._stateManager.shouldShowSelected=!this._stateManager.shouldShowSelected;if(!this._stateManager.shouldShowSelected){this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.ResetSelectedArticle();this._stateManager.SetIsSearchMode(true,this._context);this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch()}else this._context.utils.requestRender()}};KbSearchControl.prototype.handleFilterButtonClick=function(){if(!this._context.parameters.value.isControlDisabled){this._stateManager.filtersVisible=!this._stateManager.filtersVisible;if(this._stateManager.filtersVisible)this._stateManager.shouldFiltersGainDefaultFocus=true;this._context.utils.requestRender()}};KbSearchControl.prototype.buildIcon=function(titleText,IconId,iconType,onClickFunction,accessibilityLabel,isExpanded){var _this_1=this;if(isExpanded===void 0)isExpanded=false;if(!titleText||iconType<0||!IconId||!onClickFunction)return;var buttonName=IconId+KbSearchControl_1.Constants.IconIdButtonPostfix,containerName=IconId+KbSearchControl_1.Constants.IconIdContainerPostfix,iconElement=this._context.factory.createElement("MICROSOFTICON",{id:IconId,key:IconId,type:iconType,style:{fontSize:"16px",color:"#000000"}}),iconButtonElement=this._context.factory.createElement("BUTTON",{id:buttonName,key:buttonName,role:"button",style:{fontSize:this._context.theming.fontsizes.font100,background:"transparent",borderColor:"transparent",color:"#333333",cursor:"pointer",display:"flex",width:"36px",height:"36px",alignItems:"center",alignSelf:"center",justifyContent:"center",alignContent:"center",verticalAlign:"middle",padding:"0px",margin:"0px",border:"0px",":focus":{outline:"1px dotted #666666 !important;"},":hover":{backgroundColor:this._context.theming.colors.grays.gray02}},accessibilityLabel:accessibilityLabel,tabIndex:0,hidden:false,onClick:onClickFunction.bind(this),onPointerOver:function(e){return _this_1._context.accessibility.focusElementById(buttonName)},title:titleText,accessibilityExpanded:isExpanded},iconElement),iconContainer=this._context.factory.createElement("Container",{id:containerName,key:containerName,style:{display:"inline-flex",margin:"0em",cursor:"pointer"}},iconButtonElement);return iconContainer};KbSearchControl.prototype.createSortListItem=function(title,id){var _this_1=this,selectedOption=this._stateManager.SortFilter.SelectedSortFilter;if(!title||!id)return null;var isSelectedOption=false;if(selectedOption&&selectedOption.Label)isSelectedOption=selectedOption.Label===title;var elementList=[],leftPadValue="1.2em",rightPadValue="1.2em";if(isSelectedOption){var iconElement=this._context.factory.createElement("MICROSOFTICON",{id:"KM-saveascomplete",key:"KM-saveascomplete",type:109,style:{fontSize:this._context.theming.fontsizes.font100,color:"#000000",":hover":{color:"#2266E3"}}});leftPadValue="0.2em";elementList.push(iconElement)}var labelElement=this.Context.factory.createElement("LABEL",{key:id+"_label",title:title,style:{cursor:"pointer",paddingLeft:this.Context.client.isRTL?"0px":leftPadValue,paddingRight:this.Context.client.isRTL?rightPadValue:"0px",display:"flex",wordBreak:"break-word",textOverflow:"ellipsis"}},title);elementList.push(labelElement);var itemContainer=this._context.factory.createElement("Container",{id:"KM-SortFlyoutContainerId",key:"KM-SortFlyoutContainerId",style:{display:"flex",fontSize:this._context.theming.fontsizes.font100,background:"transparent"}},elementList),item=this._context.factory.createElement("listitem",{key:id,id:id,onClick:function(e){return _this_1.handleSortFlyoutItemClick(e)},onKeyDown:function(e){return _this_1.handleSortFlyoutItemClick(e)},role:"menuitem",onPointerOver:function(e){return _this_1._context.accessibility.focusElementById(id)},tabIndex:0,style:{fontSize:this._context.theming.fontsizes.font085,padding:"0.5em 1em 0.5em 1em",display:"flex",color:"#333333",backgroundColor:this._context.theming.colors.whitebackground,flexDirection:"column",cursor:"pointer",listStyleType:"none",border:"1px #d8d8d8",":hover":{backgroundColor:this._context.theming.colors.grays.gray02},":focus":{outline:"1px dotted #666666 !important;"}}},itemContainer);return item};KbSearchControl.prototype.makeSortOptionsLayout=function(){if(!this._showSortList)return null;var optionsList=[],relevanceItem=this.createSortListItem(KbSearchControl_1.KbSearchControlLocale.RelevanceLocale,KbSearchControl_1.Constants.RelevanceSortId),numberOfViewsListItem=this.createSortListItem(KbSearchControl_1.KbSearchControlLocale.NumberOfViewsLocale,KbSearchControl_1.Constants.NumberOfViewsLocaleSortId),lastModifiedDateItem=this.createSortListItem(KbSearchControl_1.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,KbSearchControl_1.Constants.LastModifiedDateNewestFirstLocaleSortId),lastModifiedDateOldestFirst=this.createSortListItem(KbSearchControl_1.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,KbSearchControl_1.Constants.LastModifiedDateOldestFirstLocaleSortId);optionsList.push(relevanceItem);optionsList.push(numberOfViewsListItem);optionsList.push(lastModifiedDateItem);optionsList.push(lastModifiedDateOldestFirst);var moreOptionsLayout=this._context.factory.createElement("list",{key:"KM_sortOptionsList",role:"menu",style:{border:"1px solid #d8d8d8",boxShadow:"4px -4px 5px rgba(179,179,179,0.5)",color:this._context.theming.colors.grays.gray02,fontSize:this._context.theming.fontsizes.font085,flexDirection:"column",backgroundColor:this._context.theming.colors.whitebackground,listStyleType:"none",display:"flex",cursor:"pointer",padding:"1em 0em"}},optionsList),menuFlyout=this._context.factory.createElement("flyout",{key:"KM_sortOptionsFlyout",id:"KM_sortOptionsFlyout",flyoutDirection:7,positionType:"relative",relativeToElementId:"KM_sortIcon_Container",onOutsideClick:this.onSortFlyoutOutsideClick.bind(this),focusElementId:"KM_sortOptionsFlyout",style:{display:"block",border:"10px solid #d8d8d8",listStyleType:"none",backgroundColor:this._context.theming.colors.whitebackground,flexDirection:"column",minWidth:"12em",maxWidth:"26em",fontSize:this._context.theming.fontsizes.font085,cursor:"pointer",padding:"1em 0em"}},moreOptionsLayout),sortElementContainer=this._context.factory.createElement("Container",{id:"KM_sortOptionsContainer",key:"KM_sortOptionsContainer"},menuFlyout);return sortElementContainer};KbSearchControl.prototype.onSortFlyoutOutsideClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._showSortList=false;this._context.utils.requestRender()}};KbSearchControl.prototype.getKnowledgeArticleAttributeList=function(value){var list,attributeDict=value.AttributeDictionary&&value.AttributeDictionary.filter(function(obj){return obj.Key==KbSearchControl_1.Constants.knowledgearticleEntityType});if(attributeDict&&attributeDict.length>0)list=attributeDict&&attributeDict[0].Value.map(function(attribute){return attribute.LogicalName});return list};KbSearchControl.prototype.handleSortFlyoutItemClick=function(event){var selectedSortOrder;switch(event&&event.currentTarget&&event.currentTarget.id){case this.Context.accessibility.getUniqueId(KbSearchControl_1.Constants.RelevanceSortId):selectedSortOrder=this._stateManager.SortFilter.CreateOption(KbSearchControl_1.KbSearchControlLocale.RelevanceLocale,KbSearchControl_1.KbSearchControlLocale.RelevanceLocale,KbSearchControl_1.SearchResultSortOption.Relevance);break;case this.Context.accessibility.getUniqueId(KbSearchControl_1.Constants.NumberOfViewsLocaleSortId):selectedSortOrder=this._stateManager.SortFilter.CreateOption(KbSearchControl_1.KbSearchControlLocale.NumberOfViewsLocale,KbSearchControl_1.KbSearchControlLocale.NumberOfViewsLocale,KbSearchControl_1.SearchResultSortOption.NumberOfViews);break;case this.Context.accessibility.getUniqueId(KbSearchControl_1.Constants.LastModifiedDateNewestFirstLocaleSortId):selectedSortOrder=this._stateManager.SortFilter.CreateOption(KbSearchControl_1.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,KbSearchControl_1.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,KbSearchControl_1.SearchResultSortOption.LastModifiedDateNewestFirst);break;case this.Context.accessibility.getUniqueId(KbSearchControl_1.Constants.LastModifiedDateOldestFirstLocaleSortId):selectedSortOrder=this._stateManager.SortFilter.CreateOption(KbSearchControl_1.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,KbSearchControl_1.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,KbSearchControl_1.SearchResultSortOption.LastModifiedDateOldestFirst);break;default:break}if(selectedSortOrder!=null){this._showSortList=false;this._handleSortFilterChange(selectedSortOrder);this._stateManager.SortFilter.SetSelectedSortFilterBySortOption(selectedSortOrder.Value)}};KbSearchControl.prototype.getOutputs=function(){return null};KbSearchControl.prototype.destroy=function(){MscrmControls.KbCommonUtils.FCBUtil.IsStatePersistenceEnabled(this._context)&&this.isInitializing&&KbSearchControl_1.StateUtil.SaveState(this._context,this._stateManager)};KbSearchControl.prototype.onPreNavigation=function(){};return KbSearchControl}();KbSearchControl_1.KbSearchControl=KbSearchControl})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";KbSearchControl.GET_METHOD="GET";KbSearchControl.POST_METHOD="POST";var StreamResponseStructure=function(){function StreamResponseStructure(){}return StreamResponseStructure}();function ProcessInnerException(error){var innerExceptionStringParts=[];error.type&&innerExceptionStringParts.push(error.type);error.message&&innerExceptionStringParts.push(error.message);error.stacktrace&&innerExceptionStringParts.push(error.stacktrace);return innerExceptionStringParts.join("\r\n")}function ShowErrorMessage(error){if(error){if(error.error)error=error.error;var errorMessage=error.message,errorCode=error.code,details="";if(error.innererror)details=ProcessInnerException(error.innererror);if(errorMessage&&errorCode){var errorDialogOptions={errorCode:parseInt(errorCode),message:errorMessage,details:details};window.Xrm.Navigation.openErrorDialog(errorDialogOptions)}}}function Fetch(userAgent,method,odataUri,data){if(!userAgent.isIos&&typeof window.fetch==="function"){var input=null,init=null;if(method==KbSearchControl.GET_METHOD)input=new Request(odataUri,{method:method,credentials:"same-origin"});else{input=odataUri;init={method:method,credentials:"same-origin",headers:{"Content-Type":"application/json",prefer:'odata.include-annotations="*"',"odata-maxversion":"4.0","odata-version":"4.0"},body:data}}return fetch(input,init).then(function(res){if(res.ok){if(res.status===204)return "";return res.json()}else{var errorReader_1=res.body.getReader(),errorString_1="",errorDeferred_1=$.Deferred();errorReader_1.read().then(function processText(streamResponse){if(streamResponse.done){var errorObject=JSON.parse(errorString_1);ShowErrorMessage(errorObject);errorDeferred_1.reject(errorObject);return}errorString_1+=String.fromCharCode.apply(null,streamResponse.value);return errorReader_1.read().then(processText)});return errorDeferred_1.promise()}})}else{var deferred_1=$.Deferred(),xhr_1=new XMLHttpRequest;xhr_1.onreadystatechange=function(){if(xhr_1.readyState!==4)return;if(xhr_1.status===204)deferred_1.resolve("");else if(xhr_1.status>=200&&xhr_1.status<300&&xhr_1.responseText&&xhr_1.responseText.length>0)deferred_1.resolve(JSON.parse(xhr_1.responseText));else{var errorObject=JSON.parse(xhr_1.responseText);ShowErrorMessage(errorObject);deferred_1.reject(errorObject);return}};xhr_1.open(method,odataUri);if(method==KbSearchControl.GET_METHOD)xhr_1.send();else{xhr_1.setRequestHeader("Content-Type","application/json; charset=UTF-8");xhr_1.setRequestHeader("accept","application/json");xhr_1.setRequestHeader("prefer",'odata.include-annotations="*"');xhr_1.setRequestHeader("odata-maxversion","4.0");xhr_1.setRequestHeader("odata-version","4.0");xhr_1.send(data)}return deferred_1.promise()}}KbSearchControl.Fetch=Fetch})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var MAX_PRECISION_VALUE=4,SHORT_PRECISION_VALUE=2,RelevanceSearchVersion=function(){function RelevanceSearchVersion(majorVersion,minorVersion,buildNumber,revisionNumber){this._majorVersion=majorVersion;this._minorVersion=minorVersion;this._buildNumber=buildNumber;this._revisionNumber=revisionNumber}RelevanceSearchVersion.prototype.ToShortString=function(){return this.ToPrecisionString(SHORT_PRECISION_VALUE)};RelevanceSearchVersion.prototype.ToLongString=function(){return this.ToPrecisionString(MAX_PRECISION_VALUE)};RelevanceSearchVersion.prototype.ToPrecisionString=function(precisionValue){for(var precisionStringList=[],i=0;i<Math.min(precisionValue,MAX_PRECISION_VALUE);i++)precisionStringList.push("{"+i+"}");return MscrmCommon.ControlUtils.String.Format(precisionStringList.join("."),this._majorVersion,this._minorVersion,this._buildNumber,this._revisionNumber)};return RelevanceSearchVersion}();KbSearchControl.RelevanceSearchVersion=RelevanceSearchVersion})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var AssociateDisassociateKnowledgeArticleRequest=function(){function AssociateDisassociateKnowledgeArticleRequest(regardingObjectId,regardingObjectTypeCode,associationRelationshipName,knowledgeArticleId,entityName){this.RegardingObjectId=regardingObjectId;this.RegardingObjectTypeCode=regardingObjectTypeCode;this.AssociationRelationshipName=associationRelationshipName;this.KnowledgeArticleId=knowledgeArticleId;this.EntityName=entityName}return AssociateDisassociateKnowledgeArticleRequest}();KbSearchControl.AssociateDisassociateKnowledgeArticleRequest=AssociateDisassociateKnowledgeArticleRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ColumnSet=function(){function ColumnSet(allColumns,columns){this.AllColumns=allColumns;this.Columns=columns}return ColumnSet}();KbSearchControl.ColumnSet=ColumnSet})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ODataObject=function(){function ODataObject(type,value){this.Type=type;this.Value=value}return ODataObject}();KbSearchControl.ODataObject=ODataObject;var ConditionExpression=function(){function ConditionExpression(entityName,attributeName,operator,values){this.EntityName=entityName;this.AttributeName=attributeName;this.Operator=operator;this.Values=values}return ConditionExpression}();KbSearchControl.ConditionExpression=ConditionExpression})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var JoinOperator;(function(JoinOperator){JoinOperator[JoinOperator["Inner"]=0]="Inner";JoinOperator[JoinOperator["LeftOuter"]=1]="LeftOuter";JoinOperator[JoinOperator["Natural"]=2]="Natural"})(JoinOperator=KbSearchControl.JoinOperator||(KbSearchControl.JoinOperator={}));var OrderType;(function(OrderType){OrderType[OrderType["Ascending"]=0]="Ascending";OrderType[OrderType["Descending"]=1]="Descending"})(OrderType=KbSearchControl.OrderType||(KbSearchControl.OrderType={}))})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var FilterExpression=function(){function FilterExpression(filterOperator,conditions,filters,isQuickFindFilter){this.FilterOperator=filterOperator;this.Conditions=conditions;this.Filters=filters;this.IsQuickFindFilter=isQuickFindFilter}return FilterExpression}();KbSearchControl.FilterExpression=FilterExpression})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var FullTextSearchKnowledgeArticleRequest=function(){function FullTextSearchKnowledgeArticleRequest(searchText,useInflection,removeDuplicates,stateCode,queryExpression){this.SearchText=searchText;this.UseInflection=useInflection;this.RemoveDuplicates=removeDuplicates;this.StateCode=stateCode;this.QueryExpression=queryExpression}return FullTextSearchKnowledgeArticleRequest}();KbSearchControl.FullTextSearchKnowledgeArticleRequest=FullTextSearchKnowledgeArticleRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var LinkEntity=function(){function LinkEntity(linkFromAttributeName,linkFromEntityName,linkToEntityName,linkToAttributeName,joinOperator,linkCriteria,linkEntities,columns,entityAlias,orders){this.LinkFromAttributeName=linkFromAttributeName;this.LinkFromEntityName=linkFromEntityName;this.LinkToEntityName=linkToEntityName;this.LinkToAttributeName=linkToAttributeName;this.JoinOperator=joinOperator;this.LinkCriteria=linkCriteria;this.LinkEntities=linkEntities;this.Columns=columns;this.EntityAlias=entityAlias;this.Orders=orders}return LinkEntity}();KbSearchControl.LinkEntity=LinkEntity})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var OrderExpression=function(){function OrderExpression(attributeName,orderType){this.AttributeName=attributeName;this.OrderType=orderType}return OrderExpression}();KbSearchControl.OrderExpression=OrderExpression})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var PagingInfo=function(){function PagingInfo(pageNumber,count,returnTotalRecordCount,pagingCookie){this.PageNumber=pageNumber;this.Count=count;this.ReturnTotalRecordCount=returnTotalRecordCount;this.PagingCookie=pagingCookie}return PagingInfo}();KbSearchControl.PagingInfo=PagingInfo})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var QueryBase=function(){function QueryBase(){}return QueryBase}();KbSearchControl.QueryBase=QueryBase;var QueryExpression=function(_super){__extends(QueryExpression,_super);function QueryExpression(distinct,noLock,pageInfo,linkEntities,criteria,orders,entityName,columnSet,topCount){var _this=_super.call(this)||this;_this.Distinct=distinct;_this.NoLock=noLock;_this.PageInfo=pageInfo;_this.LinkEntities=linkEntities;_this.Criteria=criteria;_this.Orders=orders;_this.EntityName=entityName;_this.ColumnSet=columnSet;_this.TopCount=topCount;_this["@odata.type"]="#Microsoft.Dynamics.CRM.QueryExpression";return _this}return QueryExpression}(QueryBase);KbSearchControl.QueryExpression=QueryExpression})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict"})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ArticleLanguage=function(){function ArticleLanguage(){}Object.defineProperty(ArticleLanguage.prototype,"Name",{"get":function(){return this._name},"set":function(name){this._name=name},enumerable:true,configurable:true});Object.defineProperty(ArticleLanguage.prototype,"LocaleId",{"get":function(){return this._localeId},"set":function(localeId){this._localeId=localeId},enumerable:true,configurable:true});Object.defineProperty(ArticleLanguage.prototype,"LanguageLocaleId",{"get":function(){return this._languageLocaleId},"set":function(languageLocaleId){this._languageLocaleId=languageLocaleId},enumerable:true,configurable:true});return ArticleLanguage}();KbSearchControl.ArticleLanguage=ArticleLanguage})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ArticleLanguageOption=function(){function ArticleLanguageOption(){}return ArticleLanguageOption}();KbSearchControl.ArticleLanguageOption=ArticleLanguageOption})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteSearchFactory=function(){function ExecuteSearchFactory(){}ExecuteSearchFactory.ExecuteSearch=function(searchtype,contextToken,searchHelper){var searchExecutor=ExecuteSearchFactory.s_objects[searchtype](),searchParameter=KbSearchControl.SearchParameterFactory.getSearchParamter(searchtype,searchHelper);if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(ExecuteSearchFactory.s_objects[searchtype])){contextToken.parameters.value.executeUpdateCurrentSearchText(contextToken.parameters.value.contextToken,"");contextToken.parameters.value.currentSearchText="";return searchExecutor.executeSearch(searchParameter,contextToken)}};ExecuteSearchFactory.Register=function(searchtype,Executesearch){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(ExecuteSearchFactory.s_objects[searchtype])){ExecuteSearchFactory.s_objects[searchtype]=Executesearch;return true}return false};ExecuteSearchFactory.s_objects={};return ExecuteSearchFactory}();KbSearchControl.ExecuteSearchFactory=ExecuteSearchFactory})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchParameterBase=function(){function KbSearchParameterBase(){}return KbSearchParameterBase}();KbSearchControl.KbSearchParameterBase=KbSearchParameterBase})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchParameterFactory=function(){function SearchParameterFactory(){}SearchParameterFactory.getSearchParamter=function(sType,searchHelper){var SearchParam=SearchParameterFactory.s_params[sType]();SearchParam.setParameterFromsearchHelper(searchHelper);return SearchParam};SearchParameterFactory.Register=function(sType,searchParam){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(SearchParameterFactory.s_params[sType])){SearchParameterFactory.s_params[sType]=searchParam;return true}return false};SearchParameterFactory.s_params={};return SearchParameterFactory}();KbSearchControl.SearchParameterFactory=SearchParameterFactory})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,FullTextSearchParameter=function(_super){__extends(FullTextSearchParameter,_super);function FullTextSearchParameter(){var _this=_super.call(this)||this;_this.setDefaultSettings();return _this}FullTextSearchParameter.prototype.setDefaultSettings=function(){this.searchText="";this.stateCode=KbSearchControl.Constants.ArticleState[KbSearchControl.Constants.PublishedState];this.languageLocaleId="";this.sortBy="";this.isDescending=true;this.currentPageNumber=1;this.numberOfResults=KbSearchControl.Constants.NumberofResults;this.notifyHandlersThatEventOccurredParameter={eventName:KbSearchControl.Constants.ON_POST_SEARCH,fieldName:"",pageId:"",contextToken:""}};FullTextSearchParameter.prototype.setParameterFromsearchHelper=function(searchHelper){if(!MscrmObject.isNullOrUndefined(searchHelper.searchText))this.searchText=searchHelper.searchText.trim();if(!MscrmObject.isNullOrUndefined(searchHelper.stateCode))this.stateCode=searchHelper.stateCode;if(!MscrmObject.isNullOrUndefined(searchHelper.sortBy))this.sortBy=searchHelper.sortBy;if(!MscrmObject.isNullOrUndefined(searchHelper.languageLocaleId))this.languageLocaleId=searchHelper.languageLocaleId;if(!MscrmObject.isNullOrUndefined(searchHelper.isDescending))this.isDescending=searchHelper.isDescending;if(!MscrmObject.isNullOrUndefined(searchHelper.currentPageNumber))this.currentPageNumber=searchHelper.currentPageNumber;if(!MscrmObject.isNullOrUndefined(searchHelper.numberOfResults))this.numberOfResults=searchHelper.numberOfResults;if(!MscrmObject.isNullOrUndefined(searchHelper.notifyHandlersThatEventOccurredParameter))this.notifyHandlersThatEventOccurredParameter=searchHelper.notifyHandlersThatEventOccurredParameter;if(!MscrmObject.isNullOrUndefined(searchHelper.useInflection))this.useInflection=searchHelper.useInflection;if(!MscrmObject.isNullOrUndefined(searchHelper.removeDuplicates))this.removeDuplicates=searchHelper.removeDuplicates;if(!MscrmObject.isNullOrUndefined(searchHelper.showRatingUsing))this.showRatingUsing=searchHelper.showRatingUsing;if(!MscrmObject.isNullOrUndefined(searchHelper.visibility))this.visibility=searchHelper.visibility;if(!MscrmObject.isNullOrUndefined(searchHelper.dateRange))this.dateRange=searchHelper.dateRange};FullTextSearchParameter.IsRegistered=KbSearchControl.SearchParameterFactory.Register(KbSearchControl.SearchType.FullTextSearch,function(){return new FullTextSearchParameter});return FullTextSearchParameter}(KbSearchControl.KbSearchParameterBase);KbSearchControl.FullTextSearchParameter=FullTextSearchParameter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KMManyToManyRelationShipMetadata=function(){function KMManyToManyRelationShipMetadata(){}return KMManyToManyRelationShipMetadata}();KbSearchControl.KMManyToManyRelationShipMetadata=KMManyToManyRelationShipMetadata})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SHOW_TITLE_MATCHES=false,MapRelevanceSearchResultsDataUtility=function(){function MapRelevanceSearchResultsDataUtility(){}Object.defineProperty(MapRelevanceSearchResultsDataUtility,"Instance",{"get":function(){if(!MapRelevanceSearchResultsDataUtility.instance)MapRelevanceSearchResultsDataUtility.instance=new MapRelevanceSearchResultsDataUtility;return MapRelevanceSearchResultsDataUtility.instance},enumerable:true,configurable:true});MapRelevanceSearchResultsDataUtility.prototype.generateMergedHighlightText=function(highlights){var localHighlights=highlights.slice(0);localHighlights.splice(0,0,"");localHighlights.splice(localHighlights.length,0,"");return localHighlights.join("...")};MapRelevanceSearchResultsDataUtility.prototype.convertRelevanceRecord=function(kbRelSearchRecord,processHighlights){if(processHighlights===void 0)processHighlights=true;var kbSearchRecord={highlights:{}};kbSearchRecord.knowledgeArticleId=kbRelSearchRecord.objectId;kbSearchRecord.knowledgeArticleViews=kbRelSearchRecord.relevanceData.knowledgearticleviews;kbSearchRecord.articlePublicNumber=kbRelSearchRecord.relevanceData.articlepublicnumber;kbSearchRecord.title=kbRelSearchRecord.relevanceData.title;kbSearchRecord.content=kbRelSearchRecord.relevanceData.content;kbSearchRecord.stateCode=kbRelSearchRecord.relevanceData.statecode&&kbRelSearchRecord.relevanceData.statecode.length>0&&kbRelSearchRecord.relevanceData.statecode[0];kbSearchRecord.statusCode=kbRelSearchRecord.relevanceData.statuscode&&kbRelSearchRecord.relevanceData.statuscode.length>0&&kbRelSearchRecord.relevanceData.statuscode[0];kbSearchRecord.createdon=kbRelSearchRecord.relevanceData.createdon;kbSearchRecord.modifiedOn=kbRelSearchRecord.relevanceData.modifiedon;kbSearchRecord.languageLocaleId=kbRelSearchRecord.relevanceData.languagelocaleid;kbSearchRecord.rating=kbRelSearchRecord.relevanceData.rating;kbSearchRecord.isAssociated=kbRelSearchRecord.relevanceData.isAssociated;if(processHighlights){if(SHOW_TITLE_MATCHES)if(kbRelSearchRecord.highlights.hasOwnProperty("title"))kbSearchRecord.highlights.title=this.generateMergedHighlightText(kbRelSearchRecord.highlights.title);if(kbRelSearchRecord.highlights.hasOwnProperty("content"))kbSearchRecord.highlights.content=this.generateMergedHighlightText(kbRelSearchRecord.highlights.content);kbSearchRecord.additionalMatches=Object.keys(kbRelSearchRecord.highlights).filter(function(key){return key!=="title"&&key!=="content"})}return kbSearchRecord};MapRelevanceSearchResultsDataUtility.prototype.checkAnnotationForAttachmentAndNotes=function(kbSearchRecord,annotation){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(kbSearchRecord.annotationAttachmentCount))kbSearchRecord.annotationAttachmentCount=0;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(kbSearchRecord.annotationNotesCount))kbSearchRecord.annotationNotesCount=0;if(annotation.highlights.hasOwnProperty(KbSearchControl.Constants.AttachmentFileName)||annotation.highlights.hasOwnProperty(KbSearchControl.Constants.AttachmentBody))kbSearchRecord.annotationAttachmentCount++;if(annotation.highlights.hasOwnProperty(KbSearchControl.Constants.NoteSubject)||annotation.highlights.hasOwnProperty(KbSearchControl.Constants.NoteText))kbSearchRecord.annotationNotesCount++};MapRelevanceSearchResultsDataUtility.prototype.processAnnotations=function(context){var deferred=$.Deferred();KbSearchControl.TelemetryReporter.Instance.PostStartMarker(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"processAnnotations","");var kbArticleIDList=[];this.annotationsRecords.forEach(function(annotation){var kbArticleId=annotation.relevanceData&&annotation.relevanceData.objectid;if(kbArticleId)kbArticleIDList.indexOf(kbArticleId)===-1&&kbArticleIDList.push(kbArticleId)});if(kbArticleIDList.length>0){this._stateManager.isMakeAdditionalCallToGetArticleDetails=false;var promise=this._stateManager.ExecuteKbSearchHelper.ExecuteGetKbArticleSearch(kbArticleIDList);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"processAnnotations","");return promise}else{KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"processAnnotations","");deferred.resolve()}return deferred.promise()};MapRelevanceSearchResultsDataUtility.prototype.UpdateAnnotationWithMatchedKbRecords=function(context){var _this=this,deferred=$.Deferred();KbSearchControl.TelemetryReporter.Instance.PostStartMarker(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"processAnnotations","");var matchedRecords=this._stateManager.matchedkbSearchRecords&&this._stateManager.matchedkbSearchRecords.value;this.annotationsRecords.forEach(function(annotation){var kbArticleId=annotation.relevanceData&&annotation.relevanceData.objectid;if(kbArticleId){var existingRecord=_this._stateManager.kbRelevanceSearchRecordCollection&&_this._stateManager.kbRelevanceSearchRecordCollection.filter(function(kbRelevanceRecord){return kbRelevanceRecord.knowledgeArticleId===kbArticleId}),matchedRecord=matchedRecords&&matchedRecords.filter(function(kbRelevanceRecord){return kbRelevanceRecord.objectId===kbArticleId});if(existingRecord&&existingRecord.length>0){var kbSearchRecord=existingRecord[0];_this.checkAnnotationForAttachmentAndNotes(kbSearchRecord,annotation)}else if(matchedRecord&&matchedRecord.length>0){var kbMatchedRecord=matchedRecord[0],convertedRecord=_this.convertRelevanceRecord(kbMatchedRecord,false);convertedRecord.sortOrder=annotation.sortOrder;_this.checkAnnotationForAttachmentAndNotes(convertedRecord,annotation);if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(_this._stateManager.kbRelevanceSearchRecordCollection))_this._stateManager.kbRelevanceSearchRecordCollection=[];_this._stateManager.kbRelevanceSearchRecordCollection.push(convertedRecord);_this._stateManager.AddKbSearchResult(convertedRecord)}}});this.updateCanCallRelevanceSearch();KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"processAnnotations","");deferred.resolve();return deferred.promise()};MapRelevanceSearchResultsDataUtility.prototype.MapRelevanceSearchResultData=function(context){var deferred=$.Deferred();this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);KbSearchControl.TelemetryReporter.Instance.PostStartMarker(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"MapRelevanceSearchResultData","");this._stateManager.kbRelevanceSearchRecordCollection=[];this.annotationsRecords=[];this._stateManager.totalCount=0;var kbRelevanceSearchRecords=this._stateManager.relevanceSearchRecords;if(kbRelevanceSearchRecords){if(!this._stateManager.loading){kbRelevanceSearchRecords.warnings.forEach(function(warningMessage){context.utils.addGlobalNotification(KbSearchControl.Constants.GLOBAL_NOTIFICATION_TYPE_TOAST,KbSearchControl.Constants.GLOBAL_NOTIFICATION_LEVEL_WARNING,warningMessage,KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchWarningTitle,null,null)});kbRelevanceSearchRecords.warnings.splice(0)}for(var i=0;i<kbRelevanceSearchRecords.value.length;i++){var kbRelSearchRecord=kbRelevanceSearchRecords.value[i];kbRelSearchRecord.sortOrder=i;if(kbRelSearchRecord.entityName===KbSearchControl.Constants.knowledgearticleEntityType){var kbSearchRecord=this.convertRelevanceRecord(kbRelSearchRecord);kbSearchRecord.sortOrder=i;this._stateManager.kbRelevanceSearchRecordCollection.push(kbSearchRecord);this._stateManager.AddKbSearchResult(kbSearchRecord)}else this.annotationsRecords.push(kbRelSearchRecord)}if(this.annotationsRecords.length>0){var processAnnotationStatus=this.processAnnotations(context);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"MapRelevanceSearchResultData","");this._stateManager.kbRelevanceSearchRecordCollection.sort(function(a,b){return a.sortOrder-b.sortOrder});return processAnnotationStatus}this._stateManager.totalCount=kbRelevanceSearchRecords.totalCount;this.updateCanCallRelevanceSearch()}KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameKbSearchControl,"MapRelevanceSearchResultData","");deferred.resolve();return deferred.promise()};MapRelevanceSearchResultsDataUtility.prototype.updateCanCallRelevanceSearch=function(){if(this._stateManager.ExecuteKbSearchHelper.mode===1){var kbRelevanceSearchRecords=this._stateManager.relevanceSearchRecords;if(kbRelevanceSearchRecords.totalCount==kbRelevanceSearchRecords.value.length)this._stateManager.canCallRelevanceSearch=false}};return MapRelevanceSearchResultsDataUtility}();KbSearchControl.MapRelevanceSearchResultsDataUtility=MapRelevanceSearchResultsDataUtility})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchRequestFactory=function(){function RelevanceSearchRequestFactory(){this._requestCache={};this._registerRequestMaps()}Object.defineProperty(RelevanceSearchRequestFactory,"Instance",{"get":function(){if(!this._instance)this._instance=new RelevanceSearchRequestFactory;return this._instance},enumerable:true,configurable:true});RelevanceSearchRequestFactory.prototype._registerRequestMaps=function(){this._requestCache[KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_INDEXEDSEARCH]=function(version){return new KbSearchControl.IndexedSearchRequest(version)};this._requestCache[KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_GETKBARTICLESSEARCH]=function(version){return new KbSearchControl.KbArticlesFromIDListRequest(version)};this._requestCache[KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_STATUS]=function(version){return new KbSearchControl.StatusRequest(version)}};RelevanceSearchRequestFactory.prototype.GetRequestObject=function(requestType,searchParameter){var relevanceSearchRequest=this._requestCache[requestType]();relevanceSearchRequest.PopulateAdditionalParameters(searchParameter);return relevanceSearchRequest};return RelevanceSearchRequestFactory}();KbSearchControl.RelevanceSearchRequestFactory=RelevanceSearchRequestFactory})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchRequest=function(){function RelevanceSearchRequest(version,controller,indexId,searchType){this._version=version;this._controller=controller;this._indexId=indexId;this._searchType=searchType}Object.defineProperty(RelevanceSearchRequest.prototype,"Controller",{"get":function(){return this._controller},enumerable:true,configurable:true});Object.defineProperty(RelevanceSearchRequest.prototype,"IndexId",{"get":function(){return this._indexId},enumerable:true,configurable:true});Object.defineProperty(RelevanceSearchRequest.prototype,"SearchType",{"get":function(){return this._searchType},enumerable:true,configurable:true});Object.defineProperty(RelevanceSearchRequest.prototype,"Version",{"get":function(){return this._version},enumerable:true,configurable:true});return RelevanceSearchRequest}();KbSearchControl.RelevanceSearchRequest=RelevanceSearchRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MscrmObject=MscrmCommon.ControlUtils.Object,RelevanceSearchParameter=function(_super){__extends(RelevanceSearchParameter,_super);function RelevanceSearchParameter(){var _this=_super.call(this)||this;_this.setDefaultSettings();return _this}RelevanceSearchParameter.prototype.setDefaultSettings=function(){this.searchText="";this.stateCode=KbSearchControl.Constants.ArticleState[KbSearchControl.Constants.PublishedState];this.languageLocaleId="";this.sortBy="";this.isDescending=true;this.currentPageNumber=1;this.numberOfResults=KbSearchControl.Constants.NumberofResults;this.notifyHandlersThatEventOccurredParameter={eventName:KbSearchControl.Constants.ON_POST_SEARCH,fieldName:"",pageId:"",contextToken:""};this.searchMode=1;this.numberTimeExternalRelevanceSearchCall=1};RelevanceSearchParameter.prototype.setParameterFromsearchHelper=function(searchHelper){if(!MscrmObject.isNullOrUndefined(searchHelper.searchText))this.searchText=searchHelper.searchText.trim();if(!MscrmObject.isNullOrUndefined(searchHelper.stateCode))this.stateCode=searchHelper.stateCode;if(!MscrmObject.isNullOrUndefined(searchHelper.sortBy))this.sortBy=searchHelper.sortBy;if(!MscrmObject.isNullOrUndefined(searchHelper.languageLocaleId))this.languageLocaleId=searchHelper.languageLocaleId;if(!MscrmObject.isNullOrUndefined(searchHelper.isDescending))this.isDescending=searchHelper.isDescending;if(!MscrmObject.isNullOrUndefined(searchHelper.currentPageNumber))this.currentPageNumber=searchHelper.currentPageNumber;if(!MscrmObject.isNullOrUndefined(searchHelper.numberTimeExternalRelevanceSearchCall))this.numberTimeExternalRelevanceSearchCall=searchHelper.numberTimeExternalRelevanceSearchCall;if(!MscrmObject.isNullOrUndefined(searchHelper.numberOfResults))this.numberOfResults=searchHelper.numberOfResults;if(!MscrmObject.isNullOrUndefined(searchHelper.mode))this.searchMode=searchHelper.mode;if(!MscrmObject.isNullOrUndefined(searchHelper.notifyHandlersThatEventOccurredParameter))this.notifyHandlersThatEventOccurredParameter=searchHelper.notifyHandlersThatEventOccurredParameter;if(!MscrmObject.isNullOrUndefined(searchHelper.kbArticlesIDList))this.kbArticleIDList=searchHelper.kbArticlesIDList;if(!MscrmObject.isNullOrUndefined(searchHelper.visibility))this.visibility=searchHelper.visibility;if(!MscrmObject.isNullOrUndefined(searchHelper.dateRange))this.dateRange=searchHelper.dateRange;this.isMdfDisabled=!searchHelper.enableMetadataFiltering;if(searchHelper.enableMetadataFiltering)this.additionalKnowledgeArticleFilters=searchHelper.GetLiveAdditionalFilters()};RelevanceSearchParameter.IsRegistered=KbSearchControl.SearchParameterFactory.Register(KbSearchControl.SearchType.RelevanceSearch,function(){return new RelevanceSearchParameter})&&KbSearchControl.SearchParameterFactory.Register(KbSearchControl.SearchType.GetkbArticle,function(){return new RelevanceSearchParameter});return RelevanceSearchParameter}(KbSearchControl.KbSearchParameterBase);KbSearchControl.RelevanceSearchParameter=RelevanceSearchParameter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var IndexedSearchParameter=function(){function IndexedSearchParameter(searchText,searchEntities,facets,pageSize,pageNumber,sortAttribute,isDescending,filters){this._searchText=searchText;this._searchEntities=searchEntities;this._facets=facets;this._pageSize=pageSize;this._pageNumber=pageNumber;this._sortAttribute=sortAttribute;this._isDescending=isDescending;this._filters=filters}IndexedSearchParameter.prototype.GetFilterString=function(){var filterQueryParts=[],encodeURISearchText="*";if(this._searchText)encodeURISearchText=encodeURIComponent(this._searchText);filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("search={0}",encodeURISearchText));filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("searchEntities={0}",this._searchEntities.join(",")));filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("$top={0}",this._pageSize));filterQueryParts.push("$count=true");this._pageNumber>1&&filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("$skip={0}",(this._pageNumber-1)*this._pageSize));if(this._facets.length>0){var facetString=void 0;if(this._facets.length===1)facetString=KbSearchControl.mapEnumToString(this._facets[0]);else facetString="("+this._facets.map(function(facet){return KbSearchControl.mapEnumToString(facet)}).join("),(")+")";filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("facet={0}",facetString))}if(this._sortAttribute){var sortString=this._sortAttribute;if(this._isDescending)sortString+=" desc";filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("orderby={0}",sortString))}this._filters.length>0&&filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("$filter={0}",this._filters.map(function(entityFilter){return entityFilter.FilterString}).join(",")));return filterQueryParts.join("&")};return IndexedSearchParameter}();KbSearchControl.IndexedSearchParameter=IndexedSearchParameter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ENTITY_NAME_KNOWLEDGE_ARTICLE="knowledgearticle",ENTITY_NAME_ANNOTATION="annotation",ATTRIBUTE_STATE_CODE="statecode",ATTRIBUTE_LANGUAGE_LOCALE_ID="languagelocaleid",ATTRIBUTE_OBJECT_TYPE_CODE="objecttypecode",ATTRIBUTE_ISINTERNAL="isinternal",ATTRIBUTE_MODIFIEDON="modifiedon",OPERATOR_EQUALS="eq",OPERATOR_GREATERTHANEQUAL="ge",OPERATOR_LESSERTHAN="lt",STRFORM_QUOTED_STRING="'{0}'",IndexedSearchRequest=function(_super){__extends(IndexedSearchRequest,_super);function IndexedSearchRequest(version){return _super.call(this,version||KbSearchControl.RELEVANCESEARCH_DEFAULT_VERSION,KbSearchControl.RelevanceSearchControllers.SearchIndexController,KbSearchControl.RELEVANCESEARCH_DEFAULT_IDENTIFIER,KbSearchControl.RelevanceSearchTypes.Entities)||this}IndexedSearchRequest.prototype._getQuotedString=function(baseString){return MscrmCommon.ControlUtils.String.Format(STRFORM_QUOTED_STRING,baseString)};IndexedSearchRequest.prototype.PopulateAdditionalParameters=function(parameter){var searchEntities=[ENTITY_NAME_KNOWLEDGE_ARTICLE],relevanceFilters=[],articleFilter=new KbSearchControl.RelevanceSearchFilter(ENTITY_NAME_KNOWLEDGE_ARTICLE);articleFilter.AddCondition(ATTRIBUTE_STATE_CODE,OPERATOR_EQUALS,parameter.stateCode);articleFilter.AddCondition(ATTRIBUTE_LANGUAGE_LOCALE_ID,OPERATOR_EQUALS,this._getQuotedString(parameter.languageLocaleId));parameter.visibility!=null&&articleFilter.AddCondition(ATTRIBUTE_ISINTERNAL,OPERATOR_EQUALS,parameter.visibility);if(parameter.dateRange!=null){var today=moment().utc(),lowerLimit=moment().utc();switch(parameter.dateRange){case KbSearchControl.DateFilterOptions.Last7Days:lowerLimit=lowerLimit.subtract(7,"days");articleFilter.Add2ConditionsForAnAttribute(ATTRIBUTE_MODIFIEDON,OPERATOR_GREATERTHANEQUAL,lowerLimit.format(),OPERATOR_LESSERTHAN,today.format());break;case KbSearchControl.DateFilterOptions.LastXDays:lowerLimit=lowerLimit.subtract(30,"days");articleFilter.Add2ConditionsForAnAttribute(ATTRIBUTE_MODIFIEDON,OPERATOR_GREATERTHANEQUAL,lowerLimit.format(),OPERATOR_LESSERTHAN,today.format());break;case KbSearchControl.DateFilterOptions.LastXMonths:lowerLimit=lowerLimit.subtract(6,"months");articleFilter.Add2ConditionsForAnAttribute(ATTRIBUTE_MODIFIEDON,OPERATOR_GREATERTHANEQUAL,lowerLimit.format(),OPERATOR_LESSERTHAN,today.format());break;case KbSearchControl.DateFilterOptions.LastXYears:lowerLimit=lowerLimit.subtract(1,"years");articleFilter.Add2ConditionsForAnAttribute(ATTRIBUTE_MODIFIEDON,OPERATOR_GREATERTHANEQUAL,lowerLimit.format(),OPERATOR_LESSERTHAN,today.format());break;default:break}}if(parameter.additionalKnowledgeArticleFilters)for(var attribute in parameter.additionalKnowledgeArticleFilters)articleFilter.AddCondition(attribute,OPERATOR_EQUALS,this._getQuotedString(parameter.additionalKnowledgeArticleFilters[attribute]));relevanceFilters.push(articleFilter);var pageSize=parameter.numberOfResults,pageNumber=parameter.currentPageNumber;if(parameter.searchMode===1){searchEntities.push(ENTITY_NAME_ANNOTATION);var annotationFilter=new KbSearchControl.RelevanceSearchFilter(ENTITY_NAME_ANNOTATION);annotationFilter.AddCondition(ATTRIBUTE_OBJECT_TYPE_CODE,OPERATOR_EQUALS,this._getQuotedString(ENTITY_NAME_KNOWLEDGE_ARTICLE));relevanceFilters.push(annotationFilter);pageSize=Math.max(KbSearchControl.ADVANCED_RELEVANCE_SEARCH_MAX_PAGE_SIZE,parameter.numberOfResults);pageNumber=parameter.numberTimeExternalRelevanceSearchCall}this._indexedSearchParams=new KbSearchControl.IndexedSearchParameter(parameter.searchText,searchEntities,[KbSearchControl.RelevanceSearchFacets.EntityName],pageSize,pageNumber,parameter.sortBy,parameter.isDescending,relevanceFilters)};IndexedSearchRequest.prototype.GenerateURL=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_URL_PATTERN,KbSearchControl.mapEnumToString(this.Controller),this.IndexId,KbSearchControl.mapEnumToString(this.SearchType))};IndexedSearchRequest.prototype.GenerateQueryString=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_QUERYSTRING_PATTERN,this.Version.ToShortString(),this._indexedSearchParams.GetFilterString())};return IndexedSearchRequest}(KbSearchControl.RelevanceSearchRequest);KbSearchControl.IndexedSearchRequest=IndexedSearchRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var KbArticlesFromIDListRequest=function(_super){__extends(KbArticlesFromIDListRequest,_super);function KbArticlesFromIDListRequest(version){return _super.call(this,version||KbSearchControl.RELEVANCESEARCH_DEFAULT_VERSION,KbSearchControl.RelevanceSearchControllers.SearchIndexController,KbSearchControl.RELEVANCESEARCH_DEFAULT_IDENTIFIER,KbSearchControl.RelevanceSearchTypes.Entities)||this}KbArticlesFromIDListRequest.prototype.PopulateAdditionalParameters=function(parameter){this._KbArticlesFromIDsSearchParams=new KbSearchControl.KbArticlesFromIDsSearchParameter(parameter.kbArticleIDList,parameter.stateCode,parameter.languageLocaleId)};KbArticlesFromIDListRequest.prototype.GenerateURL=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_URL_PATTERN,KbSearchControl.mapEnumToString(this.Controller),this.IndexId,KbSearchControl.mapEnumToString(this.SearchType))};KbArticlesFromIDListRequest.prototype.GenerateQueryString=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_QUERYSTRING_PATTERN,this.Version.ToShortString(),this._KbArticlesFromIDsSearchParams.GetFilterString())};return KbArticlesFromIDListRequest}(KbSearchControl.RelevanceSearchRequest);KbSearchControl.KbArticlesFromIDListRequest=KbArticlesFromIDListRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ENTITY_NAME_KNOWLEDGE_ARTICLE="knowledgearticle",ATTRIBUTE_STATE_CODE="statecode",ATTRIBUTE_LANGUAGE_LOCALE_ID="languagelocaleid",ATTRIBUTE_KNOWLEDGE_ARTICLE_ID="knowledgearticleid",OPERATOR_EQUALS="eq",STRFORM_QUOTED_STRING="'{0}'",STRFORM_PARANTHESIS_STRING="({0})",KbArticlesFromIDsSearchParameter=function(){function KbArticlesFromIDsSearchParameter(knowledgeArticleIdList,stateCode,languageLocaleId){this._knowledgeArticleIdConditions=this._constructArticleListConditions(knowledgeArticleIdList);this._searchFilter=this._constructAdditionalFilter(stateCode,languageLocaleId)}KbArticlesFromIDsSearchParameter.prototype._constructArticleListConditions=function(knowledgeArticleIdList){for(var articleConditions=[],_i=0,knowledgeArticleIdList_1=knowledgeArticleIdList;_i<knowledgeArticleIdList_1.length;_i++){var knowledgeArticleId=knowledgeArticleIdList_1[_i];articleConditions.push(new KbSearchControl.RelevanceSearchCondition(ATTRIBUTE_KNOWLEDGE_ARTICLE_ID,OPERATOR_EQUALS,this._getQuotedString(knowledgeArticleId)))}return articleConditions};KbArticlesFromIDsSearchParameter.prototype._constructAdditionalFilter=function(stateCode,languageLocaleId){var articleFilter=new KbSearchControl.RelevanceSearchFilter(ENTITY_NAME_KNOWLEDGE_ARTICLE);articleFilter.AddCondition(ATTRIBUTE_STATE_CODE,OPERATOR_EQUALS,stateCode);articleFilter.AddCondition(ATTRIBUTE_LANGUAGE_LOCALE_ID,OPERATOR_EQUALS,this._getQuotedString(languageLocaleId));return articleFilter};KbArticlesFromIDsSearchParameter.prototype._getQuotedString=function(baseString){return MscrmCommon.ControlUtils.String.Format(STRFORM_QUOTED_STRING,baseString)};KbArticlesFromIDsSearchParameter.prototype.GetFilterString=function(){var filterQueryParts=[];filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("searchEntities={0}",ENTITY_NAME_KNOWLEDGE_ARTICLE));filterQueryParts.push(MscrmCommon.ControlUtils.String.Format("$filter={0}",this._getMergedAttributeFilter()));filterQueryParts.push("$count=true");return filterQueryParts.join("&")};KbArticlesFromIDsSearchParameter.prototype._getMergedAttributeFilter=function(){var attributeFilterParts=[];attributeFilterParts.push(this._searchFilter.FilterString);attributeFilterParts.push(MscrmCommon.ControlUtils.String.Format(STRFORM_PARANTHESIS_STRING,this._knowledgeArticleIdConditions.map(function(articleCondition){return articleCondition.FilterString}).join(" or ")));return attributeFilterParts.join(" and ")};return KbArticlesFromIDsSearchParameter}();KbSearchControl.KbArticlesFromIDsSearchParameter=KbArticlesFromIDsSearchParameter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchCondition=function(){function RelevanceSearchCondition(attribute,operator,value){this._attribute=attribute;this._operator=operator;this._value=value}Object.defineProperty(RelevanceSearchCondition.prototype,"FilterString",{"get":function(){return this._attribute+" "+this._operator+" "+this._value},enumerable:true,configurable:true});return RelevanceSearchCondition}();KbSearchControl.RelevanceSearchCondition=RelevanceSearchCondition})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){KbSearchControl.RELEVANCESEARCH_URL_PATTERN="/api/search/{0}/{1}/{2}";KbSearchControl.RELEVANCESEARCH_BASE_QUERYSTRING_PATTERN="?api-version={0}";KbSearchControl.RELEVANCESEARCH_QUERYSTRING_PATTERN="?api-version={0}&{1}";KbSearchControl.RELEVANCESEARCH_DEFAULT_VERSION=new KbSearchControl.RelevanceSearchVersion(9,0,0,0);KbSearchControl.EXECUTE_RELEVANCESEARCH_REDUCER_BASE="execute.relevancesearch";KbSearchControl.ADVANCED_RELEVANCE_SEARCH_MAX_PAGE_SIZE=50;KbSearchControl.RELEVANCESEARCH_INDEX_CONTROLLER="indexes";KbSearchControl.RELEVANCESEARCH_DEFAULT_IDENTIFIER="default";KbSearchControl.RELEVANCESEARCH_ENTITY_TYPE="entities";KbSearchControl.RELEVANCESEARCH_MAPPING_TYPE="mapping";KbSearchControl.RELEVANCESEARCH_STATUS_TYPE="status";KbSearchControl.RELEVANCESEARCH_STATS_TYPE="stats";KbSearchControl.RELEVANCESEARCH_FACET_ENTITYNAME="@search.entityname";KbSearchControl.RELEVANCESEARCH_FACET_OBJECTID="@search.objectid";KbSearchControl.RELEVANCESEARCH_FACET_HIGHLIGHTS="@search.highlights";KbSearchControl.RELEVANCESEARCH_FACET_SCORE="@search.score";KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_INDEXEDSEARCH="IndexedRelevanceSearch";KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_GETKBARTICLESSEARCH="GetKbArticlesFromIDList";KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_STATUS="Status";function getRelevanceSearchReducerString(reducerSpecificIdentifier){return [KbSearchControl.EXECUTE_RELEVANCESEARCH_REDUCER_BASE,reducerSpecificIdentifier].join(".")}KbSearchControl.getRelevanceSearchReducerString=getRelevanceSearchReducerString})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchControllers;(function(RelevanceSearchControllers){RelevanceSearchControllers[RelevanceSearchControllers["SearchIndexController"]=0]="SearchIndexController"})(RelevanceSearchControllers=KbSearchControl.RelevanceSearchControllers||(KbSearchControl.RelevanceSearchControllers={}));var RelevanceSearchTypes;(function(RelevanceSearchTypes){RelevanceSearchTypes[RelevanceSearchTypes["Entities"]=100]="Entities";RelevanceSearchTypes[RelevanceSearchTypes["FieldMappings"]=101]="FieldMappings";RelevanceSearchTypes[RelevanceSearchTypes["Status"]=102]="Status";RelevanceSearchTypes[RelevanceSearchTypes["Statistics"]=103]="Statistics"})(RelevanceSearchTypes=KbSearchControl.RelevanceSearchTypes||(KbSearchControl.RelevanceSearchTypes={}));var RelevanceSearchFacets;(function(RelevanceSearchFacets){RelevanceSearchFacets[RelevanceSearchFacets["EntityName"]=1e4]="EntityName";RelevanceSearchFacets[RelevanceSearchFacets["ObjectId"]=10001]="ObjectId";RelevanceSearchFacets[RelevanceSearchFacets["Score"]=10002]="Score";RelevanceSearchFacets[RelevanceSearchFacets["Highlights"]=10003]="Highlights"})(RelevanceSearchFacets=KbSearchControl.RelevanceSearchFacets||(KbSearchControl.RelevanceSearchFacets={}));function mapEnumToString(enumValue){switch(enumValue){case RelevanceSearchControllers.SearchIndexController:return KbSearchControl.RELEVANCESEARCH_INDEX_CONTROLLER;case RelevanceSearchTypes.Entities:return KbSearchControl.RELEVANCESEARCH_ENTITY_TYPE;case RelevanceSearchTypes.FieldMappings:return KbSearchControl.RELEVANCESEARCH_MAPPING_TYPE;case RelevanceSearchTypes.Statistics:return KbSearchControl.RELEVANCESEARCH_STATS_TYPE;case RelevanceSearchTypes.Status:return KbSearchControl.RELEVANCESEARCH_STATUS_TYPE;case RelevanceSearchFacets.EntityName:return KbSearchControl.RELEVANCESEARCH_FACET_ENTITYNAME;case RelevanceSearchFacets.Highlights:return KbSearchControl.RELEVANCESEARCH_FACET_HIGHLIGHTS;case RelevanceSearchFacets.ObjectId:return KbSearchControl.RELEVANCESEARCH_FACET_OBJECTID;case RelevanceSearchFacets.Score:return KbSearchControl.RELEVANCESEARCH_FACET_SCORE;default:throw"Enumeration currently not supported for string conversion. Update mapper to handle parsing for the enum"}}KbSearchControl.mapEnumToString=mapEnumToString})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RelevanceSearchFilter=function(){function RelevanceSearchFilter(entityName){this._entityName=entityName;this._conditions=[]}Object.defineProperty(RelevanceSearchFilter.prototype,"FilterString",{"get":function(){var baseString=this._conditions.map(function(cond){return cond.FilterString}).join(" and ");return this._entityName+":"+baseString},enumerable:true,configurable:true});RelevanceSearchFilter.prototype.AddCondition=function(attribute,operator,value){this._conditions.push(new KbSearchControl.RelevanceSearchCondition(attribute,operator,value))};RelevanceSearchFilter.prototype.Add2ConditionsForAnAttribute=function(attribute,operator1,value1,operator2,value2){this._conditions.push(new KbSearchControl.RelevanceSearchCondition(attribute,operator1,value1));this._conditions.push(new KbSearchControl.RelevanceSearchCondition(attribute,operator2,value2))};return RelevanceSearchFilter}();KbSearchControl.RelevanceSearchFilter=RelevanceSearchFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var StatusRequest=function(_super){__extends(StatusRequest,_super);function StatusRequest(version){return _super.call(this,version||KbSearchControl.RELEVANCESEARCH_DEFAULT_VERSION,KbSearchControl.RelevanceSearchControllers.SearchIndexController,KbSearchControl.RELEVANCESEARCH_DEFAULT_IDENTIFIER,KbSearchControl.RelevanceSearchTypes.Status)||this}StatusRequest.prototype.PopulateAdditionalParameters=function(parameter){};StatusRequest.prototype.GenerateURL=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_URL_PATTERN,KbSearchControl.mapEnumToString(this.Controller),this.IndexId,KbSearchControl.mapEnumToString(this.SearchType))};StatusRequest.prototype.GenerateQueryString=function(){return MscrmCommon.ControlUtils.String.Format(KbSearchControl.RELEVANCESEARCH_BASE_QUERYSTRING_PATTERN,this.Version.ToShortString())};return StatusRequest}(KbSearchControl.RelevanceSearchRequest);KbSearchControl.StatusRequest=StatusRequest})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteIncrementKnowledgeArticleViewCountAction=function(){function ExecuteIncrementKnowledgeArticleViewCountAction(){}Object.defineProperty(ExecuteIncrementKnowledgeArticleViewCountAction,"Instance",{"get":function(){if(!ExecuteIncrementKnowledgeArticleViewCountAction.instance)ExecuteIncrementKnowledgeArticleViewCountAction.instance=new ExecuteIncrementKnowledgeArticleViewCountAction;return ExecuteIncrementKnowledgeArticleViewCountAction.instance},enumerable:true,configurable:true});ExecuteIncrementKnowledgeArticleViewCountAction.prototype._retrieveResultsSuccess=function(articleId,context){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);if(stateManager.relevanceSearchRecords!=null){var relRecords=stateManager.relevanceSearchRecords.value.map(function(a){return Object.assign({},a)});relRecords.forEach(function(record){var knowledgeArticleId=record.objectId;if(knowledgeArticleId===articleId&&record.relevanceData.hasOwnProperty("knowledgearticleviews"))record.relevanceData.knowledgearticleviews++});stateManager.relevanceSearchRecords.value=relRecords}else{var records=stateManager.records.map(function(record){return Object.assign({},record)});records.forEach(function(record){var knowledgeArticleId=record.knowledgeArticleId;if(knowledgeArticleId===articleId)record.knowledgeArticleViews++});stateManager.records=records}};ExecuteIncrementKnowledgeArticleViewCountAction.prototype.executeIncrementKnowledgeArticleViewCount=function(entityReference,viewDate,location,count,context){var _this=this,url=context.page.getClientUrl()+KbSearchControl.Constants.ODATA_PATH+"/IncrementKnowledgeArticleViewCount(Source=@Source,ViewDate=@ViewDate,Location=@Location,Count=@Count)?@Source={'@odata.id':'knowledgearticles({0})'}&@ViewDate={1}&@Location={2}&@Count={3}",knowledgearticleId=entityReference.id;url=MscrmCommon.ControlUtils.String.Format(url,knowledgearticleId,viewDate,location,count);return KbSearchControl.Fetch(context.client.userAgent,KbSearchControl.GET_METHOD,url).then(function(incrementKnowledgeArticleViewCountResults){if(incrementKnowledgeArticleViewCountResults){_this._retrieveResultsSuccess(knowledgearticleId,context);return}},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"",stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.errorMessage=errorMessage;stateManager.error=true;KbSearchControl.PerformanceTelemetry.Instance.AddErrorLog(context,error.message,error.innerror)})};return ExecuteIncrementKnowledgeArticleViewCountAction}();KbSearchControl.ExecuteIncrementKnowledgeArticleViewCountAction=ExecuteIncrementKnowledgeArticleViewCountAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";function UpdateErrorStateInContext(context,errorMessage,isControlDisabled,errorDescription,additionalProperties){if(isControlDisabled===void 0)isControlDisabled=false;var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.errorDetails=errorDescription;stateManager.errorMessage=errorMessage;context.parameters.value.isControlDisabled=isControlDisabled;stateManager.error=true;stateManager.loading=false;stateManager.recordIds=[];stateManager.records=[];stateManager.relevanceSearchRecords=null;stateManager.kbRelevanceSearchRecordCollection=[];additionalProperties&&Object.assign(stateManager,additionalProperties)}KbSearchControl.UpdateErrorStateInContext=UpdateErrorStateInContext;function UpdateLoadingStateInContext(context){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.errorMessage="";stateManager.error=false;stateManager.loading=true}KbSearchControl.UpdateLoadingStateInContext=UpdateLoadingStateInContext;function UpdateRelevanceSearchResultsInContext(context,relevanceSearchResults){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.relevanceSearchRecords=relevanceSearchResults;stateManager.matchedkbSearchRecords=null;stateManager.records=null;stateManager.recordIds=null;context.parameters.value.isControlDisabled=false;stateManager.loading=false}KbSearchControl.UpdateRelevanceSearchResultsInContext=UpdateRelevanceSearchResultsInContext;function UpdateMatchedKbSearchRecordsInContext(context,matchedkbRecords){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.matchedkbSearchRecords=matchedkbRecords;stateManager.records=null;stateManager.recordIds=null;context.parameters.value.isControlDisabled=false;stateManager.loading=false}KbSearchControl.UpdateMatchedKbSearchRecordsInContext=UpdateMatchedKbSearchRecordsInContext;function CheckSearchConditions(context){if(!context.parameters.value.isKnowledgeManagementEnabled){UpdateErrorStateInContext(context,KbSearchControl.Constants.KnowledgeManagementNotEnabledErrorMessageResourceName);context.utils.requestRender();return false}return true}KbSearchControl.CheckSearchConditions=CheckSearchConditions;KbSearchControl.checkAssociation=function(linkedArticles,knowledgeArticleId){return linkedArticles.filter(function(associatedArticle){var associatedArticleId=associatedArticle.knowledgeArticleId;return associatedArticleId===knowledgeArticleId}).length>0}})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteFullTextSearchAction=function(){function ExecuteFullTextSearchAction(){}Object.defineProperty(ExecuteFullTextSearchAction,"Instance",{"get":function(){if(!ExecuteFullTextSearchAction.instance)ExecuteFullTextSearchAction.instance=new ExecuteFullTextSearchAction;return ExecuteFullTextSearchAction.instance},enumerable:true,configurable:true});ExecuteFullTextSearchAction.prototype.getPagingInfo=function(kbSearchParameter){var currentPageNumber=parseInt(kbSearchParameter.currentPageNumber.toString(),10),numberOfResults=parseInt(kbSearchParameter.numberOfResults.toString(),10);return new KbSearchControl.PagingInfo(currentPageNumber,numberOfResults,true,"")};ExecuteFullTextSearchAction.prototype.getOrderExpression=function(kbSearchParameter){var orderExpressionArray=[];kbSearchParameter.sortBy&&orderExpressionArray.push(new KbSearchControl.OrderExpression(kbSearchParameter.sortBy,kbSearchParameter.isDescending?KbSearchControl.OrderType.Descending.toString():KbSearchControl.OrderType.Ascending.toString()));return orderExpressionArray};ExecuteFullTextSearchAction.prototype.addRatingFieldToColumnSet=function(kbSearchParameter,columns){if(!kbSearchParameter.showRatingUsing)return;if(columns.filter(function(value,index,obj){return obj[index]===kbSearchParameter.showRatingUsing}))return;columns.push(kbSearchParameter.showRatingUsing)};ExecuteFullTextSearchAction.prototype.getFilterExpression=function(kbSearchParameter){var objArray=[],conditionExpressionArray=[];if(kbSearchParameter.languageLocaleId){objArray.push(new KbSearchControl.ODataObject("System.Guid",kbSearchParameter.languageLocaleId));conditionExpressionArray.push(new KbSearchControl.ConditionExpression(KbSearchControl.Constants.knowledgearticleEntityType,KbSearchControl.Constants.languagelocaleid,KbSearchControl.Constants.ConditionOperatorMapping[KbSearchControl.ConditionOperator.Equal],objArray))}if(kbSearchParameter.visibility){objArray=[];objArray.push(new KbSearchControl.ODataObject("System.Boolean",kbSearchParameter.visibility));conditionExpressionArray.push(new KbSearchControl.ConditionExpression(KbSearchControl.Constants.knowledgearticleEntityType,KbSearchControl.Constants.isinternal,KbSearchControl.Constants.ConditionOperatorMapping[KbSearchControl.ConditionOperator.In],objArray))}if(kbSearchParameter.dateRange){objArray=[];if(kbSearchParameter.dateRange==KbSearchControl.DateFilterOptions.LastXDays)objArray.push(new KbSearchControl.ODataObject("System.Int32","30"));else if(kbSearchParameter.dateRange==KbSearchControl.DateFilterOptions.LastXMonths)objArray.push(new KbSearchControl.ODataObject("System.Int32","6"));else kbSearchParameter.dateRange==KbSearchControl.DateFilterOptions.LastXYears&&objArray.push(new KbSearchControl.ODataObject("System.Int32","1"));conditionExpressionArray.push(new KbSearchControl.ConditionExpression(KbSearchControl.Constants.knowledgearticleEntityType,KbSearchControl.Constants.modifiedon,KbSearchControl.Constants.ConditionOperatorMapping[kbSearchParameter.dateRange],objArray))}var filterExpressionArray=[];return new KbSearchControl.FilterExpression(KbSearchControl.Constants.LogicalOperatorMapping[KbSearchControl.LogicalOperator.And],conditionExpressionArray,filterExpressionArray,false)};ExecuteFullTextSearchAction.prototype.getColumnSet=function(kbSearchParameter){var columns=[KbSearchControl.Constants.knowledgearticleid,KbSearchControl.Constants.articlepublicnumber,KbSearchControl.Constants.title,KbSearchControl.Constants.description,KbSearchControl.Constants.content,KbSearchControl.Constants.knowledgearticleviews,KbSearchControl.Constants.createdon,KbSearchControl.Constants.modifiedon,KbSearchControl.Constants.statecode,KbSearchControl.Constants.statuscode,KbSearchControl.Constants.expirationdate,KbSearchControl.Constants.languagelocaleid,KbSearchControl.Constants.majorversionnumber,KbSearchControl.Constants.minorversionnumber,KbSearchControl.Constants.islatestversion,KbSearchControl.Constants.rating,KbSearchControl.Constants.isinternal];this.addRatingFieldToColumnSet(kbSearchParameter,columns);return new KbSearchControl.ColumnSet(false,columns)};ExecuteFullTextSearchAction.prototype.getLinkEntitySet=function(){var linkEntitySet=[];return linkEntitySet};ExecuteFullTextSearchAction.prototype.getQueryExpression=function(kbSearchParameter){return new KbSearchControl.QueryExpression(false,false,this.getPagingInfo(kbSearchParameter),this.getLinkEntitySet(),this.getFilterExpression(kbSearchParameter),this.getOrderExpression(kbSearchParameter),"knowledgearticle",this.getColumnSet(kbSearchParameter),null)};ExecuteFullTextSearchAction.prototype.serializeAndExecuteFullTextSearchKnowledgeArticle=function(kbSearchParameter,context){var ODataEndPointUri=context.page.getClientUrl()+KbSearchControl.Constants.ODATA_PATH+"/FullTextSearchKnowledgeArticle",useInflection=kbSearchParameter.useInflection||false,removeDuplicates=kbSearchParameter.removeDuplicates||false,stateCode=parseInt(kbSearchParameter.stateCode,10),fullTextSearchKnowledgeArticleRequest=new KbSearchControl.FullTextSearchKnowledgeArticleRequest(kbSearchParameter.searchText,useInflection,removeDuplicates,stateCode,this.getQueryExpression(kbSearchParameter));return KbSearchControl.Fetch(context.client.userAgent,KbSearchControl.POST_METHOD,ODataEndPointUri,JSON.stringify(fullTextSearchKnowledgeArticleRequest)).then(function(searchResults){context.parameters.value.executeNotifyHandlersThatEventOccurred(kbSearchParameter.notifyHandlersThatEventOccurredParameter);if(searchResults&&searchResults.error){var errorDescription=searchResults.error.message?searchResults.error.message:"";KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.ServerSearchFailure,false,errorDescription,{totalCount:0})}else if(searchResults&&searchResults.value&&searchResults.value.length>0){var totalCount=searchResults["@Microsoft.Dynamics.CRM.totalrecordcount"],stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId),kbSearchRecords_1=Array();if(kbSearchParameter.currentPageNumber>1)kbSearchRecords_1=stateManager.records;else kbSearchRecords_1=Array();var showRatingUsing_1=kbSearchParameter.showRatingUsing?kbSearchParameter.showRatingUsing:"rating";searchResults.value.map(function(searchResult){kbSearchRecords_1.push({knowledgeArticleId:searchResult.knowledgearticleid,articlePublicNumber:searchResult.articlepublicnumber,title:searchResult.title,content:searchResult.content,knowledgeArticleViews:searchResult.knowledgearticleviews,createdon:searchResult.createdon,modifiedOn:searchResult.modifiedon,expirationdate:searchResult.expirationdate,stateCode:searchResult.statecode,statusCode:searchResult.statuscode,languageLocaleId:searchResult._languagelocaleid_value,rating:searchResult[showRatingUsing_1],isAssociated:false})});stateManager.records=kbSearchRecords_1;stateManager.recordIds=kbSearchRecords_1.map(function(record){return record.knowledgeArticleId});stateManager.loading=false;stateManager.totalCount=totalCount;context.parameters.value.isControlDisabled=false}else KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.NoArticlesErrorMessageResourceName,false,"",{totalCount:0})},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.ServerSearchFailure,false,errorMessage,{totalCount:0})})};return ExecuteFullTextSearchAction}();KbSearchControl.ExecuteFullTextSearchAction=ExecuteFullTextSearchAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteKAAssociationAction=function(){function ExecuteKAAssociationAction(){}Object.defineProperty(ExecuteKAAssociationAction,"Instance",{"get":function(){if(!ExecuteKAAssociationAction.instance)ExecuteKAAssociationAction.instance=new ExecuteKAAssociationAction;return ExecuteKAAssociationAction.instance},enumerable:true,configurable:true});ExecuteKAAssociationAction.prototype.serializeAndExecuteKnowledgeArticleAssociation=function(context,regardingObjectId,regardingObjectTypeCode,associationRelationshipName,knowledgeArticleId,entityName,isAssociated){var ODataEndPointUri=context.page.getClientUrl()+KbSearchControl.Constants.ODATA_PATH,apiEndPoint=!isAssociated?"/AssociateKnowledgeArticle":"/DisassociateKnowledgeArticle";ODataEndPointUri=ODataEndPointUri+apiEndPoint;var associateDisassociateKARequest=new KbSearchControl.AssociateDisassociateKnowledgeArticleRequest(regardingObjectId,regardingObjectTypeCode,associationRelationshipName,knowledgeArticleId,entityName);return KbSearchControl.Fetch(context.client.userAgent,KbSearchControl.POST_METHOD,ODataEndPointUri,JSON.stringify(associateDisassociateKARequest))};ExecuteKAAssociationAction.prototype.refreshAllAssociatedGrid=function(){if(Xrm&&Xrm.Page&&Xrm.Page.getControl){var controls=Xrm.Page.getControl();if(controls)for(var _i=0,controls_1=controls;_i<controls_1.length;_i++){var control=controls_1[_i];if(control.getGridType){var entityName=control.getEntityName();(entityName===KbSearchControl.Constants.knowledgearticleEntityType||entityName===KbSearchControl.Constants.KnowledgeArticleIncident)&&control.refresh&&control.refresh()}}}};ExecuteKAAssociationAction.prototype.performAssociation=function(controlId,articleId){var stateManager=KbSearchControl.StateManager.Instance(controlId),records=stateManager.records&&stateManager.records.length>0?stateManager.records:stateManager.kbRelevanceSearchRecordCollection,selectedArticle=null;if(records)for(var n=records.length,i=0;i<n;i++)if(records[i]!=null){records[i].isAssociated=KbSearchControl.checkAssociation(stateManager.associatedArticles,records[i].knowledgeArticleId);if(records[i].knowledgeArticleId===articleId)selectedArticle=records[i]}return selectedArticle};ExecuteKAAssociationAction.prototype.formatSelectedArticle=function(selectedArticle,context){var deferred=$.Deferred();return MscrmControls.KbCommonUtils.ActionOperationUtils.GetFormattedContent(context,selectedArticle.knowledgeArticleId).done(function(response){selectedArticle.content=response;deferred.resolve()}).fail(function(error){if(typeof error==="string")selectedArticle.content=error;else console.error(error);deferred.reject()})};ExecuteKAAssociationAction.prototype.executeAssociateDissociateKnowledgeArticle=function(context,article,entityReference,isAssociated){var _this=this,entityTypeName=context.page.entityTypeName,relationshipName,stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);if(entityTypeName===KbSearchControl.Constants.Incident)relationshipName=KbSearchControl.Constants.IncidentRelationshipName;else{var relation=KbSearchControl.StateManager.Instance(context.parameters.value.controlId).relations;relationshipName=relation.SchemaName}return this.serializeAndExecuteKnowledgeArticleAssociation(context,entityReference.Id.guid,-1,relationshipName,article.knowledgeArticleId,entityReference.LogicalName,isAssociated).then(function(response){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(response)){stateManager.associatedArticles=stateManager.associatedArticles||[];if(!isAssociated)stateManager.associatedArticles.push(article);else for(var length_1=stateManager.associatedArticles.length,i=0;i<length_1;i++)if(stateManager.associatedArticles[i].knowledgeArticleId==article.knowledgeArticleId){stateManager.associatedArticles.splice(i,1);break}var selectedArticle_1=_this.performAssociation(context.parameters.value.controlId,article.knowledgeArticleId);stateManager.SetSelectedArticle(selectedArticle_1,context);if(selectedArticle_1!=null)if(stateManager.isExternalSearchIndexEnabled)_this.formatSelectedArticle(selectedArticle_1,context).then(function(){context.utils.fireEvent("onAssociationDisassociationOccurred",selectedArticle_1)});else context.utils.fireEvent("onAssociationDisassociationOccurred",selectedArticle_1);_this.refreshAllAssociatedGrid();context.utils.requestRender()}else KbSearchControl.PerformanceTelemetry.Instance.AddErrorLog(context,KbSearchControl.Constants.NoArticlesErrorMessageResourceName,"")},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";KbSearchControl.PerformanceTelemetry.Instance.AddErrorLog(context,errorMessage,"")})};ExecuteKAAssociationAction.prototype.retrieveAssociatedKnowledgeArticle=function(context){var winObj=window,entityTypeName=context.page.entityTypeName,parentEntityId=context.page.entityId,stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId),etn=KbSearchControl.Constants.EntityName,fetchXml;if(entityTypeName===KbSearchControl.Constants.Incident){etn=KbSearchControl.Constants.KnowledgeArticleIncident;fetchXml="<fetch mapping='logical'><entity name='knowledgearticleincident'><attribute name='knowledgearticleid'/><filter type='and'><condition attribute='incidentid' operator='eq' value='"+parentEntityId+"'/><condition attribute='statecode' operator='eq' value='0'/></filter></entity></fetch>"}else{var relation=stateManager.relations;fetchXml="<fetch mapping='logical'><entity name='knowledgearticle'><attribute name='articlepublicnumber' /><link-entity name='"+relation.IntersectEntityName+"' to='knowledgearticleid' from='knowledgearticleid' intersect='true' link-type='inner' alias='b'><filter type='and'><condition attribute= '"+relation.ReferencedEntityColumnName+"' operator='eq' value='"+parentEntityId+"'/></filter></link-entity></entity></fetch>"}return winObj.Xrm.WebApi.online.retrieveMultipleRecords(etn,"?fetchXml="+fetchXml).then(function(results){var linkedArticles=[];results.entities.length>0&&results.entities.map(function(result){if(result.knowledgearticleid)linkedArticles.push({knowledgeArticleId:result.knowledgearticleid,articlePublicNumber:result.articlepublicnumber});else linkedArticles.push({knowledgeArticleId:result._knowledgearticleid_value,articlePublicNumber:result.articlepublicnumber})});stateManager.associatedArticles=linkedArticles},function(errorResponse){stateManager.associatedArticles=[];KbSearchControl.PerformanceTelemetry.Instance.AddErrorLog(context,errorResponse.message,errorResponse.innerror)})};return ExecuteKAAssociationAction}();KbSearchControl.ExecuteKAAssociationAction=ExecuteKAAssociationAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ExecuteGetKbArticlesFromIDsSearchAction=function(){function ExecuteGetKbArticlesFromIDsSearchAction(){}Object.defineProperty(ExecuteGetKbArticlesFromIDsSearchAction,"Instance",{"get":function(){if(!ExecuteGetKbArticlesFromIDsSearchAction.instance)ExecuteGetKbArticlesFromIDsSearchAction.instance=new ExecuteGetKbArticlesFromIDsSearchAction;return ExecuteGetKbArticlesFromIDsSearchAction.instance},enumerable:true,configurable:true});ExecuteGetKbArticlesFromIDsSearchAction.prototype.getKBArticleSearchSuccess=function(context,matchedkbRecords){KbSearchControl.UpdateMatchedKbSearchRecordsInContext(context,matchedkbRecords);KbSearchControl.MapRelevanceSearchResultsDataUtility.Instance.UpdateAnnotationWithMatchedKbRecords(context)};ExecuteGetKbArticlesFromIDsSearchAction.prototype.buildGetKbArticlesResponse=function(getKbArticlesSearchParameters,matchedRecords){var parsedCount=0;if("@odata.count" in matchedRecords&&matchedRecords["@odata.count"])parsedCount=matchedRecords["@odata.count"];var parsedValues=[];matchedRecords.value.forEach(function(val){var dataKeys=Object.keys(val).filter(function(key){return key.indexOf("@")!=0}),dataValues={};dataKeys.forEach(function(dKey){dataValues[dKey]=val[dKey]});parsedValues.push({score:val["@search.score"],entityName:val["@search.entityname"],objectId:val["@search.objectid"],objectTypeCode:val["@search.objecttypecode"],highlights:Object.freeze(Object.assign({},val["@search.highlights"])),relevanceData:dataValues})});return {errors:matchedRecords.errors,warnings:matchedRecords.warnings,facets:matchedRecords.facets,value:parsedValues,totalCount:parsedCount}};ExecuteGetKbArticlesFromIDsSearchAction.prototype.buildkbArticledfromIDsSearch=function(relevanceSearchRequestType,getKbArticlesSearchParameters){var kbArticlesFromIDListSearchRequest=KbSearchControl.RelevanceSearchRequestFactory.Instance.GetRequestObject(relevanceSearchRequestType,getKbArticlesSearchParameters);return {method:KbSearchControl.GET_METHOD,endpoint:kbArticlesFromIDListSearchRequest.GenerateURL(),urlParameters:kbArticlesFromIDListSearchRequest.GenerateQueryString()}};ExecuteGetKbArticlesFromIDsSearchAction.prototype.buildAndExecutegetKbArticlesFromIDsSearch=function(userAgent,relevanceSearchRequestType,getKbArticlesSearchParameters){var getkbarticlesfromIDsRequest=this.buildkbArticledfromIDsSearch(relevanceSearchRequestType,getKbArticlesSearchParameters);getkbarticlesfromIDsRequest.urlParameters=getkbarticlesfromIDsRequest.urlParameters.replace(/\t|\r|\n/g,"");var odataUri=getkbarticlesfromIDsRequest.endpoint+getkbarticlesfromIDsRequest.urlParameters;return KbSearchControl.Fetch(userAgent,getkbarticlesfromIDsRequest.method,odataUri)};ExecuteGetKbArticlesFromIDsSearchAction.prototype.executeGetKbArticlesFromIDsSearch=function(context,getKbArticlesSearchParameters){var relevanceSearchRequestType=KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_GETKBARTICLESSEARCH;return this.buildAndExecutegetKbArticlesFromIDsSearch(context.client.userAgent,relevanceSearchRequestType,getKbArticlesSearchParameters).then(function(matchedRecords){if(!matchedRecords||!matchedRecords.value)KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.ServerSearchFailure,false,"");else{var matchedkbRecords=this.buildGetKbArticlesResponse(getKbArticlesSearchParameters,matchedRecords);this.getKBArticleSearchSuccess(context,matchedkbRecords)}}.bind(this),function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.ServerSearchFailure,false,errorMessage,{totalCount:0})})};return ExecuteGetKbArticlesFromIDsSearchAction}();KbSearchControl.ExecuteGetKbArticlesFromIDsSearchAction=ExecuteGetKbArticlesFromIDsSearchAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var ExecuteRelevanceSearchAction=function(){function ExecuteRelevanceSearchAction(){}Object.defineProperty(ExecuteRelevanceSearchAction,"Instance",{"get":function(){if(!ExecuteRelevanceSearchAction.instance)ExecuteRelevanceSearchAction.instance=new ExecuteRelevanceSearchAction;return ExecuteRelevanceSearchAction.instance},enumerable:true,configurable:true});ExecuteRelevanceSearchAction.prototype.buildRelevanceSearch=function(relevanceSearchRequestType,relevanceSearchParameters){var relevanceSearchRequest=KbSearchControl.RelevanceSearchRequestFactory.Instance.GetRequestObject(relevanceSearchRequestType,relevanceSearchParameters);return {method:KbSearchControl.GET_METHOD,endpoint:relevanceSearchRequest.GenerateURL(),urlParameters:relevanceSearchRequest.GenerateQueryString()}};ExecuteRelevanceSearchAction.prototype.buildAndExecuteRelevanceSearch=function(userAgent,relevanceSearchRequestType,relevanceSearchParameters){var relevanceRequest=this.buildRelevanceSearch(relevanceSearchRequestType,relevanceSearchParameters);relevanceRequest.urlParameters=relevanceRequest.urlParameters.replace(/\t|\r|\n/g,"");return KbSearchControl.Fetch(userAgent,relevanceRequest.method,relevanceRequest.endpoint+relevanceRequest.urlParameters)};ExecuteRelevanceSearchAction.prototype.buildRelevanceSearchResponse=function(relevanceSearchParameters,relevanceSearchResults,context){var parsedCount=0;if("@odata.count" in relevanceSearchResults&&relevanceSearchResults["@odata.count"])parsedCount=relevanceSearchResults["@odata.count"];for(var parsedFacets={},parsedValues=[],_loop_1=function(key){parsedFacets[key]=[];relevanceSearchResults.facets[key].forEach(function(facet){parsedFacets[key].push({facetType:facet.Type,facetValue:facet.Value,count:facet.Count})})},_i=0,_a=Object.keys(relevanceSearchResults.facets);_i<_a.length;_i++){var key=_a[_i];_loop_1(key)}if(relevanceSearchParameters.currentPageNumber>1){var relevanceRecords=KbSearchControl.StateManager.Instance(context.parameters.value.controlId).relevanceSearchRecords;parsedValues=relevanceRecords.value}relevanceSearchResults.value.forEach(function(val){var dataKeys=Object.keys(val).filter(function(key){return key.indexOf("@")!=0}),dataValues={};dataKeys.forEach(function(dKey){dataValues[dKey]=val[dKey]});parsedValues.push({score:val["@search.score"],entityName:val["@search.entityname"],objectId:val["@search.objectid"],objectTypeCode:val["@search.objecttypecode"],highlights:Object.freeze(Object.assign({},val["@search.highlights"])),relevanceData:dataValues})});return {errors:relevanceSearchResults.errors,warnings:relevanceSearchResults.warnings,facets:parsedFacets,value:parsedValues,totalCount:parsedCount}};ExecuteRelevanceSearchAction.prototype.relevanceSearchSuccess=function(context,relevanceSearchResults){KbSearchControl.UpdateRelevanceSearchResultsInContext(context,relevanceSearchResults);return KbSearchControl.MapRelevanceSearchResultsDataUtility.Instance.MapRelevanceSearchResultData(context)};ExecuteRelevanceSearchAction.prototype.executeRelevanceSearch=function(relevanceSearchParameters,context){var relevanceSearchRequestType=KbSearchControl.RELEVANCESEARCH_REQUEST_TYPE_INDEXEDSEARCH,deferred=$.Deferred();this.buildAndExecuteRelevanceSearch(context.client.userAgent,relevanceSearchRequestType,relevanceSearchParameters).then(function(relevanceSearchResults){context.parameters.value.executeNotifyHandlersThatEventOccurred(relevanceSearchParameters.notifyHandlersThatEventOccurredParameter);if(!relevanceSearchResults||!relevanceSearchResults.value){KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.ServerSearchFailure,false,"");deferred.resolve();return}var relevanceSearchResponse=this.buildRelevanceSearchResponse(relevanceSearchParameters,relevanceSearchResults,context);if(relevanceSearchResponse.errors.length>0){var concatenatedErrorMessage=relevanceSearchResponse.errors.join("\\n");KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.ServerSearchFailure,false,concatenatedErrorMessage);deferred.resolve()}else{relevanceSearchResponse.warnings.length>0&&deferred.resolve();if(relevanceSearchResponse.value.length>0)this.relevanceSearchSuccess(context,relevanceSearchResponse).then(function(){deferred.resolve()},function(){deferred.resolve()});else{KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.NoArticlesErrorMessageResourceName,false,"",{totalCount:0});deferred.resolve()}}}.bind(this),function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||error&&error.Message||error&&error.error&&error.error.Message||"";KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.ServerSearchFailure,false,errorMessage)});return deferred.promise()};return ExecuteRelevanceSearchAction}();KbSearchControl.ExecuteRelevanceSearchAction=ExecuteRelevanceSearchAction})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteFullTextSearch=function(){function ExecuteFullTextSearch(){}ExecuteFullTextSearch.prototype.performAssociation=function(context){var records=KbSearchControl.StateManager.Instance(context.parameters.value.controlId).records,associatedArticles=KbSearchControl.StateManager.Instance(context.parameters.value.controlId).associatedArticles;if(records&&associatedArticles)for(var n=records.length,i=0;i<n;i++)if(records[i]!=null)records[i].isAssociated=KbSearchControl.checkAssociation(associatedArticles,records[i].knowledgeArticleId)};ExecuteFullTextSearch.prototype.executeSearch=function(kbSearchParameter,context){var _this=this,deferred=$.Deferred();if(!this.SearchParameterIsExecutable(kbSearchParameter))return;if(!KbSearchControl.CheckSearchConditions(context))return;if(!kbSearchParameter.searchText){KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.NoSearchErrorMessageResourceName,false,"",{totalCount:0});context.utils.requestRender();return}if(kbSearchParameter.currentPageNumber===1){KbSearchControl.UpdateLoadingStateInContext(context);context.utils.requestRender()}KbSearchControl.TelemetryReporter.Instance.PostStartMarker(context,KbSearchControl.Constants.WebresourceNameFullTextSearchActions,"ExecuteFullTextSearch","");var promises=[],isPageInfoIFormInput=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.page.entityTypeName);isPageInfoIFormInput&&promises.push(KbSearchControl.ExecuteKAAssociationAction.Instance.retrieveAssociatedKnowledgeArticle(context));promises.push(KbSearchControl.ExecuteFullTextSearchAction.Instance.serializeAndExecuteFullTextSearchKnowledgeArticle(kbSearchParameter,context));Promise.all(promises).then(function(){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.FullTextSearchCompleted]);_this.performAssociation(context);context.parameters.value.executeUpdateSearchResults(context.parameters.value.contextToken,stateManager.records);context.utils.requestRender();deferred.resolve();KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameFullTextSearchActions,"ExecuteFullTextSearch","")},function(){deferred.reject();KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameFullTextSearchActions,"ExecuteFullTextSearch","")});return deferred.promise()};ExecuteFullTextSearch.prototype.SearchParameterIsExecutable=function(kbSearchParameter){if(kbSearchParameter&&kbSearchParameter.languageLocaleId)return true;return false};ExecuteFullTextSearch.isRegistered=KbSearchControl.ExecuteSearchFactory.Register(KbSearchControl.SearchType.FullTextSearch,function(){return new ExecuteFullTextSearch});return ExecuteFullTextSearch}();KbSearchControl.ExecuteFullTextSearch=ExecuteFullTextSearch})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteGetKbArticleSearch=function(){function ExecuteGetKbArticleSearch(){}ExecuteGetKbArticleSearch.prototype.performAssociation=function(context){};ExecuteGetKbArticleSearch.prototype.executeSearch=function(searchParameter,context){var deferred=$.Deferred();KbSearchControl.TelemetryReporter.Instance.PostStartMarker(context,KbSearchControl.Constants.WebresourceNameGetKbArticlesSearchActions,"ExecuteGetKbArticlesSearch","");KbSearchControl.ExecuteGetKbArticlesFromIDsSearchAction.Instance.executeGetKbArticlesFromIDsSearch(context,searchParameter).then(function(){deferred.resolve();KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameGetKbArticlesSearchActions,"ExecuteGetKbArticlesSearch","")},function(){deferred.reject();KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameGetKbArticlesSearchActions,"ExecuteGetKbArticlesSearch","")});return deferred.promise()};ExecuteGetKbArticleSearch.isRegistered=KbSearchControl.ExecuteSearchFactory.Register(KbSearchControl.SearchType.GetkbArticle,function(){return new ExecuteGetKbArticleSearch});return ExecuteGetKbArticleSearch}();KbSearchControl.ExecuteGetKbArticleSearch=ExecuteGetKbArticleSearch})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var MDFSearchEvent=function(){function MDFSearchEvent(context,searchParameter){this.eventName=KbSearchControl.Constants.MDFSearchEventName;this.eventParameters=[];this.eventParameters.push({name:"canDisableMDF",value:context.parameters.value.descriptors.allowDisablingMDFOnUI});this.eventParameters.push({name:"hasDisabledMDF",value:searchParameter.isMdfDisabled})}return MDFSearchEvent}(),ExecuteRelevanceSearch=function(){function ExecuteRelevanceSearch(){}ExecuteRelevanceSearch.prototype.performAssociation=function(context){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId),records=stateManager.kbRelevanceSearchRecordCollection;if(records&&stateManager.associatedArticles)for(var n=records.length,i=0;i<n;i++)if(records[i]!=null)records[i].isAssociated=KbSearchControl.checkAssociation(stateManager.associatedArticles,records[i].knowledgeArticleId)};ExecuteRelevanceSearch.prototype.executeSearch=function(kbSearchParameter,context){var _this=this,deferred=$.Deferred();if(!this.SearchParameterIsExecutable(kbSearchParameter))return;if(!KbSearchControl.CheckSearchConditions(context))return;if(!kbSearchParameter.searchText){KbSearchControl.UpdateErrorStateInContext(context,KbSearchControl.Constants.NoSearchErrorMessageResourceName);context.utils.requestRender();return}var performSearch=ExecuteRelevanceSearch.shouldPerformRelevanceSearch(KbSearchControl.StateManager.Instance(context.parameters.value.controlId));if(!performSearch){context.utils.requestRender();return}if(kbSearchParameter.currentPageNumber===1){KbSearchControl.UpdateLoadingStateInContext(context);context.utils.requestRender()}KbSearchControl.TelemetryReporter.Instance.PostStartMarker(context,KbSearchControl.Constants.WebresourceNameRelevanceSearchActions,"ExecuteRelevanceSearch","");var promises=[],isPageInfoIFormInput=!MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.page.entityTypeName);promises.push(KbSearchControl.ExecuteRelevanceSearchAction.Instance.executeRelevanceSearch(kbSearchParameter,context));isPageInfoIFormInput&&promises.push(KbSearchControl.ExecuteKAAssociationAction.Instance.retrieveAssociatedKnowledgeArticle(context));Promise.all(promises).then(function(){var stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.RelevanceSearchCompleted]);_this.performAssociation(context);context.parameters.value.executeUpdateSearchResults(context.parameters.value.contextToken,stateManager.kbRelevanceSearchRecordCollection);context.utils.requestRender();KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameRelevanceSearchActions,"ExecuteRelevanceSearch","");deferred.resolve()},function(){deferred.reject();KbSearchControl.TelemetryReporter.Instance.PostEndMarker(context,KbSearchControl.Constants.WebresourceNameRelevanceSearchActions,"ExecuteRelevanceSearch","")});if(context.parameters.value.descriptors.enableMDF&&context.utils.isFeatureEnabled(KbSearchControl.Constants.MetadataDrivenFilterForKbSearch)){var mdfEvent=new MDFSearchEvent(context,kbSearchParameter);mdfEvent.eventName!=""&&mdfEvent.eventParameters!=null&&context.reporting.reportEvent(mdfEvent)}return deferred.promise()};ExecuteRelevanceSearch.prototype.SearchParameterIsExecutable=function(kbSearchParameter){if(kbSearchParameter&&kbSearchParameter.languageLocaleId)return true;return false};ExecuteRelevanceSearch.shouldPerformRelevanceSearch=function(stateManager){if(stateManager.ExecuteKbSearchHelper.mode===2)return true;var kbRelevanceSearchRecordCollection=stateManager.kbRelevanceSearchRecordCollection;if(!kbRelevanceSearchRecordCollection)return true;var currentPageNumber=stateManager.ExecuteKbSearchHelper.currentPageNumber,numOfResults=stateManager.ExecuteKbSearchHelper.numberOfResults;if(currentPageNumber*numOfResults>kbRelevanceSearchRecordCollection.length&&stateManager.canCallRelevanceSearch)return true;return false};ExecuteRelevanceSearch.isRegistered=KbSearchControl.ExecuteSearchFactory.Register(KbSearchControl.SearchType.RelevanceSearch,function(){return new ExecuteRelevanceSearch});return ExecuteRelevanceSearch}();KbSearchControl.ExecuteRelevanceSearch=ExecuteRelevanceSearch})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchHelperState=function(){function SearchHelperState(){}return SearchHelperState}();KbSearchControl.SearchHelperState=SearchHelperState})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchState=function(){function SearchState(){}return SearchState}();KbSearchControl.SearchState=SearchState})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultActionsBase=function(){function SearchResultActionsBase(){this.expandedRendering=false;this.searchUIEnhancementsEnabled=false}SearchResultActionsBase.prototype.init=function(context,notifyOutputChanged,state,container,hiddenActionSpan,fontIconSize){this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this._context=context;this.remToPixelConversion=parseFloat(this._context.theming.fontsizes.font100);this.renderActionFlags=[];this._hiddenActionSpan=hiddenActionSpan;this._fontIconSize=fontIconSize};SearchResultActionsBase.prototype.getOutputs=function(){return null};SearchResultActionsBase.prototype.destroy=function(){};SearchResultActionsBase.prototype.onPreNavigation=function(){};SearchResultActionsBase.prototype.getAvailableArticleActions=function(kbSearchRecord,isPopupControl){var _this=this;this.expandedRendering=isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode||this._stateManager.IsExpandedMode;this.searchUIEnhancementsEnabled=MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements);var shouldRenderAction=true;if(this._context.parameters.value.urlQueryParams)shouldRenderAction=this._context.parameters.value.urlQueryParams.enableContextualActions!==false;if(!shouldRenderAction)return [];var articleActions=Object.keys(MscrmControls.KbCommonUtils.ArticleAction).filter(function(val){return parseInt(val,10)>-1}).map(function(strVal){return parseInt(strVal,10)});articleActions=articleActions.filter(function(articleAction){return (_this._context.parameters.value.descriptors.showContextualActions==="ShowAll"||_this._context.parameters.value.descriptors.actionList&&_this._context.parameters.value.descriptors.actionList.indexOf(articleAction)>=0)&&_this.isActionValid(articleAction,kbSearchRecord)});return articleActions};SearchResultActionsBase.prototype.handleSearchResultActionsDropdownInlineActionKeyDown=function(event,firstAction,kbSearchRecord,articleActions){if(event.key===KbSearchControl.Constants.EnterKeyValue){event.stopPropagation();event.preventDefault();this.handleArticleActionClick(firstAction,kbSearchRecord,articleActions,event)}};SearchResultActionsBase.prototype.renderMenuFlyout=function(kbSearchRecord,isPopupControl,describedByElementId,articleActions){var _this=this;KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"renderMenuFlyout","");var containerChildren=[],kbSearchResult=this._stateManager.GetKbSearchResult(kbSearchRecord),style={display:"inline-flex",alignItems:"center",borderLeft:this.searchUIEnhancementsEnabled?0:this._context.client.isRTL?0:this._context.theming.borders.border02,borderRight:this.searchUIEnhancementsEnabled?0:this._context.client.isRTL?this._context.theming.borders.border02:0},onClickHandler=!kbSearchResult.isMenuVisible?function(event){if(_this.searchUIEnhancementsEnabled){event.stopPropagation();event.preventDefault()}_this.toggleMenu.bind(_this);return _this.toggleMenu(kbSearchResult)}:function(event){},menuFlyoutButtonPrefix=isPopupControl?"popup":"",menuFlyoutButtonIconId=menuFlyoutButtonPrefix+"microsoftIcon_menuFlyoutButton_"+kbSearchRecord.knowledgeArticleId.toString(),menuFlyoutButtonIcon=this._context.factory.createElement("MICROSOFTICON",{id:menuFlyoutButtonIconId,key:menuFlyoutButtonIconId,role:"button",accessibilityExpanded:kbSearchResult.isMenuVisible,accessibilityHasPopup:true,tabIndex:0,style:{":hover":{color:this.searchUIEnhancementsEnabled?MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION:""}},accessibilityLabel:KbSearchControl.KbSearchControlLocale.MoreActionsText,onKeyDown:function(event){return _this.handleMenuFlyoutButtonPress(event,kbSearchResult)},hidden:false,onClick:onClickHandler,type:MscrmControls.KbCommonUtils.IconSymbolCode.More}),menuFlyoutButtonContainer=this._context.factory.createElement("Container",{id:"menuFlyoutButtonContainer_"+kbSearchRecord.knowledgeArticleId.toString(),key:"menuFlyoutButtonContainer",style:{display:"inline-flex",marginTop:this._context.theming.measures.measure025,marginBottom:this._context.theming.measures.measure025,marginLeft:this._context.client.isRTL?this._context.theming.measures.measure050:this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure100,marginRight:this._context.client.isRTL?this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure100:this._context.theming.measures.measure050,backgroundColor:!this.searchUIEnhancementsEnabled&&kbSearchResult.isMenuVisible?"white":"transparent",cursor:"pointer",fontSize:this._context.theming.fontsizes.font115}},menuFlyoutButtonIcon);containerChildren.push(menuFlyoutButtonContainer);if(kbSearchResult.isMenuVisible&&(!this._stateManager.popupEnabled||isPopupControl)){var dropdownChildren_1=[],actionIndex_1=this.renderActionFlags.length;articleActions.map(function(currentAction){if(articleActions.length-actionIndex_1>0&&currentAction===articleActions[actionIndex_1]){var menuFlyoutActionIcon=_this.renderArticleActionIcon(kbSearchRecord,currentAction,false,false,true),menuFlyoutActionTitle=_this.renderActionTitle(kbSearchRecord,currentAction,articleActions),flyoutOptionId="flyout_"+_this.getUniqueActionId(kbSearchRecord.knowledgeArticleId,actionIndex_1),searchResultActionsDropdownActionLabel=_this._context.resources.getString(_this.getArticleActionToLabelNameMapping(currentAction)),searchResultActionsDropdownActionTooltip=_this.GetLocalizedActionTooltip(currentAction),menuFlyoutAction=_this._context.factory.createElement("CONTAINER",{id:flyoutOptionId,key:flyoutOptionId,style:{boxSizing:"border-box",paddingLeft:_this._context.theming.measures.measure100,paddingRight:_this._context.theming.measures.measure100,paddingBottom:_this.searchUIEnhancementsEnabled?_this._context.theming.measures.measure050:_this._context.theming.measures.measure150,paddingTop:_this.searchUIEnhancementsEnabled?_this._context.theming.measures.measure050:_this._context.theming.measures.measure150,"float":"left",width:"100%",cursor:"pointer",":hover":{color:KbSearchControl.KbSearchUtil.IsFeatureEnabled(_this._context,KbSearchControl.Constants.KMRefreshSearchUI)?MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION:"black",backgroundColor:_this.searchUIEnhancementsEnabled?MscrmControls.KbCommonUtils.Constants.BGCOLOR_ACTION:""}},onClick:_this.handleArticleActionClick.bind(_this,currentAction,kbSearchRecord,articleActions),onKeyDown:function(event){_this.handleFlyoutOptionKeyDown.bind(_this);return _this.handleFlyoutOptionKeyDown(articleActions.indexOf(currentAction),currentAction,kbSearchRecord,event,articleActions)},tabIndex:0,role:"button",title:searchResultActionsDropdownActionTooltip,accessibilityLabel:searchResultActionsDropdownActionLabel,describedByElementId:describedByElementId},[menuFlyoutActionIcon,menuFlyoutActionTitle]);dropdownChildren_1.push(menuFlyoutAction);actionIndex_1+=1}});var widthStyle=this.searchUIEnhancementsEnabled?0:this._context.theming.measures.measure050,dropdownChildrenDiv=this._context.factory.createElement("CONTAINER",{id:"MenuFlyoutChildrenContainer_"+kbSearchRecord.knowledgeArticleId.toString(),key:"MenuFlyoutChildrenContainer",style:{width:this.searchUIEnhancementsEnabled?this._context.theming.measures.measure1075:"calc(100% - "+widthStyle+" - "+widthStyle+")",paddingRight:widthStyle,paddingLeft:widthStyle,boxShadow:this.searchUIEnhancementsEnabled?"0px 2px 4px rgba(0, 0, 0, 0.15)":"4px 4px 5px rgba(128,128,128,0.25)",border:this._context.theming.borders.border02,backgroundColor:"white",alignItems:"flex-start",flexDirection:"column"},":hover":{color:KbSearchControl.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl.Constants.KMRefreshSearchUI)?MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION:"inherit"},className:"mscrm-MenuFlyoutContainer"},dropdownChildren_1),_a=this._context.theming,textbox=_a.textbox,solidborderstyle=_a.solidborderstyle,flyoutStyle={borderColor:"white",borderLeftWidth:textbox.linethickness,borderRightWidth:textbox.linethickness,borderBottomWidth:textbox.linethickness,borderTopWidth:"0px",backgroundColor:"white",display:"flex"},flyout=this._context.factory.createElement("FLYOUT",{id:"searchResultActionsDropdownMenuFlyout_"+kbSearchRecord.knowledgeArticleId.toString(),key:"searchResultActionsDropdownMenuFlyout",relativeToElementId:menuFlyoutButtonIconId,onOutsideClick:function(event){_this.toggleMenu.bind(_this);return _this.toggleMenu(kbSearchResult)},positionType:"relative",size:{minWidth:210,maxHeight:300},flyoutDirection:7,flyoutStyle:flyoutStyle},dropdownChildrenDiv);containerChildren.push(flyout)}var result=this._context.factory.createElement("CONTAINER",{id:"MenuFlyoutContainer_"+kbSearchRecord.knowledgeArticleId.toString(),key:"MenuFlyoutContainer",style:style,className:"mscrm-MenuFlyoutContainer"},containerChildren);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"renderMenuFlyout","");return result};SearchResultActionsBase.prototype.renderArticleActionIcon=function(kbSearchRecord,currentAction,firstAction,secondAction,flyoutAction){if(firstAction===void 0)firstAction=false;if(secondAction===void 0)secondAction=false;if(flyoutAction===void 0)flyoutAction=false;var prefixString;if(!flyoutAction)prefixString="_inlineArticleAction_";else prefixString="_flyoutArticleAction_";var menuActionIconId="microsoftIcon"+prefixString+kbSearchRecord.knowledgeArticleId.toString()+"_"+currentAction+"_",searchResultActionsDropdownActionTooltip=this.GetLocalizedActionTooltip(currentAction),style;if(firstAction)style={display:"inline-flex",fontSize:this._context.theming.fontsizes.font115,paddingRight:this._context.client.isRTL?this._stateManager.GetIsSearchMode()?"0rem":this._context.theming.measures.measure050:this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure025,paddingLeft:this._context.client.isRTL?this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure025:this._stateManager.GetIsSearchMode()?"0rem":this._context.theming.measures.measure050,paddingTop:this._context.theming.measures.measure015};else if(secondAction)style={display:"inline-flex",fontSize:this._context.theming.fontsizes.font115,paddingRight:this._context.client.isRTL?this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure100:this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure025,paddingLeft:this._context.client.isRTL?this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure025:this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure100,paddingTop:this._context.theming.measures.measure015};else style={display:"inline-flex",fontSize:this._context.theming.fontsizes.font115,paddingLeft:this._context.client.isRTL?this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure100:0,paddingRight:this._context.client.isRTL?0:this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure100,paddingTop:this._context.theming.measures.measure015};if(this.searchUIEnhancementsEnabled&&MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context))style.margin="auto";if(this.searchUIEnhancementsEnabled&&!this._stateManager.GetIsSearchMode())style.color=MscrmControls.KbCommonUtils.Constants.COLOR_ACTION_ICON;var menuFlyoutActionIcon=this._context.factory.createElement("MICROSOFTICON",{id:menuActionIconId,key:menuActionIconId,accessibilityHidden:true,role:"presentation",tabIndex:-1,title:searchResultActionsDropdownActionTooltip,style:{":hover":{color:this.searchUIEnhancementsEnabled?MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION:""}},hidden:false,type:this.GetMicrosoftSymbolIconByArticleActionId(currentAction)});return this._context.factory.createElement("Container",{id:"menuActionIconContainer_"+menuActionIconId,key:"menuActionIconContainer_"+menuActionIconId,style:style},menuFlyoutActionIcon)};SearchResultActionsBase.prototype.renderActionTitle=function(kbSearchRecord,currentAction,articleActions,inlineAction){if(inlineAction===void 0)inlineAction=false;var actionTitleId=this.getUniqueActionId(kbSearchRecord.knowledgeArticleId,currentAction),searchResultActionsDropdownActionLabel=this._context.resources.getString(this.getArticleActionToLabelNameMapping(currentAction));if(inlineAction)return this._context.factory.createElement("LABEL",{id:actionTitleId,key:actionTitleId,role:"button",tabIndex:-1,style:{fontSize:this._context.theming.fontsizes.font100,paddingLeft:this._context.client.isRTL?this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure100:0,paddingRight:this._context.client.isRTL?0:this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:this._context.theming.measures.measure100,cursor:"pointer",margin:MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)?"auto":"initial"}},searchResultActionsDropdownActionLabel);else return this._context.factory.createElement("LABEL",{id:actionTitleId,key:actionTitleId,role:"menuitem",tabIndex:-1,style:{fontSize:this._context.theming.fontsizes.font100,cursor:"pointer"}},searchResultActionsDropdownActionLabel)};SearchResultActionsBase.prototype.handleFlyoutOptionKeyDown=function(actionIndex,articleActionId,kbSearchRecord,event,articleActions){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleFlyoutOptionKeyDown","");if(event.keyCode!==KbSearchControl.Constants.DownArrowKeyCode&&event.keyCode!==KbSearchControl.Constants.SpaceKeyCode&&event.keyCode!==KbSearchControl.Constants.UpArrowKeyCode&&event.keyCode!==KbSearchControl.Constants.EscapeKeyCode&&event.keyCode!==KbSearchControl.Constants.EnterKeyCode){KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleFlyoutOptionKeyDown","");return}if(event.keyCode===KbSearchControl.Constants.EnterKeyCode||event.keyCode===KbSearchControl.Constants.SpaceKeyCode){this.handleArticleActionClick.bind(this);this.handleArticleActionClick(articleActionId,kbSearchRecord,articleActions,event);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleFlyoutOptionKeyDown","");return}var newActionIndex=event.keyCode===KbSearchControl.Constants.UpArrowKeyCode?actionIndex-1:actionIndex+1;if(event.keyCode===KbSearchControl.Constants.EscapeKeyCode){var kbSearchResult=this._stateManager.GetKbSearchResult(kbSearchRecord);this.toggleMenu(kbSearchResult);this._context.accessibility.focusElementById("microsoftIcon_menuFlyoutButton_"+kbSearchRecord.knowledgeArticleId);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleFlyoutOptionKeyDown","");return}else if(newActionIndex>=articleActions.length){KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleFlyoutOptionKeyDown","");return}else{var uniqueActionId="flyout_"+this.getUniqueActionId(kbSearchRecord.knowledgeArticleId,newActionIndex);if(document.getElementById(this._context.accessibility.getUniqueId(uniqueActionId))){this._context.accessibility.focusElementById(uniqueActionId);event.stopPropagation();event.preventDefault()}KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleFlyoutOptionKeyDown","")}};SearchResultActionsBase.prototype.handleMenuFlyoutButtonPress=function(event,kbSearchResult){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleMenuFlyoutButtonPress","");if(event.keyCode===KbSearchControl.Constants.TabKeyCode)this.tryToggleCloseMenu(kbSearchResult);else if(event.key===KbSearchControl.Constants.EnterKeyValue||event.keyCode===KbSearchControl.Constants.SpaceKeyCode){this.toggleMenu(kbSearchResult);event.stopPropagation();event.preventDefault()}else if(event.keyCode===KbSearchControl.Constants.TabKeyCode){for(var articleTitleID=this._context.accessibility.getUniqueId("articleTitle"),articleIndex=$("[id="+articleTitleID+"]"),selectedRecordTitle=this._stateManager.GetSelectedArticle().title,i=0;i<articleIndex.length;i++)if(articleIndex[i].attributes["title"].nodeValue==selectedRecordTitle)i!=articleIndex.length-1&&this._stateManager.SetSelectedArticle(this._stateManager.records[i+1],this._context)}else if(event.keyCode===KbSearchControl.Constants.DownArrowKeyCode){var uniqueActionId="flyout_"+this.getUniqueActionId(kbSearchResult.kbSearchRecord.knowledgeArticleId,this.renderActionFlags.length);this._context.accessibility.focusElementById(uniqueActionId);event.stopPropagation();event.preventDefault()}KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleMenuFlyoutButtonPress","")};SearchResultActionsBase.prototype.handleArticleActionClick=function(articleActionId,kbSearchRecord,articleActions,event){var _this=this;KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleArticleActionClick","");if(this.searchUIEnhancementsEnabled){event.stopPropagation();event.preventDefault()}var selectedArticleActionId=articleActionId,selectedKnowledgeArticleId=kbSearchRecord.knowledgeArticleId;if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.LinkArticle){KbSearchControl.PerformanceTelemetry.Instance.AddStartMarker(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_LINK_KBARTICLE,this._context,selectedKnowledgeArticleId);KbSearchControl.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_LINK_KBARTICLE,this._context)}else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.UnlinkArticle)KbSearchControl.PerformanceTelemetry.Instance.AddStartMarker(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_UNLINK_KBARTICLE,this._context,selectedKnowledgeArticleId);else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.EmailArticleContent){KbSearchControl.PerformanceTelemetry.Instance.AddStartMarker(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_CONTENT,this._context);KbSearchControl.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_CONTENT,this._context)}else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.EmailArticle){KbSearchControl.PerformanceTelemetry.Instance.AddStartMarker(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_URL,this._context);KbSearchControl.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_URL,this._context)}else if(selectedArticleActionId===MscrmControls.KbCommonUtils.ArticleAction.PopoutArticle){KbSearchControl.PerformanceTelemetry.Instance.AddStartMarker(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_POPOUT_KBARTICLE,this._context);KbSearchControl.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_POPOUT_KBARTICLE,this._context)}if(selectedArticleActionId<0||!selectedKnowledgeArticleId){KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleArticleActionClick","");return}if(!MscrmControls.KbCommonUtils.ArticleAction[selectedArticleActionId]){KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleArticleActionClick","");return}if(selectedArticleActionId==MscrmControls.KbCommonUtils.ArticleAction.PopoutArticle&&this._stateManager.GetIsSearchMode()){var viewDate=moment(new Date).toISOString(),knowledgearticleId=kbSearchRecord.knowledgeArticleId,entityReference={id:knowledgearticleId,entityType:KbSearchControl.Constants.knowledgearticleEntityType};KbSearchControl.ExecuteIncrementKnowledgeArticleViewCountAction.Instance.executeIncrementKnowledgeArticleViewCount(entityReference,viewDate,KbSearchControl.Constants.KnowledgeArticleViewCountWebLocation.Dynamics,1,this._context)}var executeAssociateAction=false;switch(selectedArticleActionId){case MscrmControls.KbCommonUtils.ArticleAction.LinkArticle:case MscrmControls.KbCommonUtils.ArticleAction.UnlinkArticle:executeAssociateAction=true;break;case MscrmControls.KbCommonUtils.ArticleAction.EmailArticle:case MscrmControls.KbCommonUtils.ArticleAction.EmailArticleContent:executeAssociateAction=!kbSearchRecord.isAssociated;break}if(executeAssociateAction){var article={knowledgeArticleId:kbSearchRecord.knowledgeArticleId,articlePublicNumber:kbSearchRecord.articlePublicNumber};KbSearchControl.ExecuteKAAssociationAction.Instance.executeAssociateDissociateKnowledgeArticle(this._context,article,this._context.parameters.value.entityReference,kbSearchRecord.isAssociated).then(function(){KbSearchControl.PerformanceTelemetry.Instance.AddEndMarker(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_UNLINK_KBARTICLE,_this._context,kbSearchRecord.knowledgeArticleId)})}MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Execute(selectedArticleActionId,{controlContext:this._context,record:kbSearchRecord,stateManager:this._stateManager});this.reportActionToTelemetry(selectedArticleActionId);this.tryToggleCloseMenu(this._stateManager.GetKbSearchResult(kbSearchRecord));KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"handleArticleActionClick","")};SearchResultActionsBase.prototype.toggleMenu=function(kbSearchResult){kbSearchResult.isMenuVisible=!kbSearchResult.isMenuVisible;this._context.utils.requestRender()};SearchResultActionsBase.prototype.tryToggleCloseMenu=function(kbSearchResult){kbSearchResult.isMenuVisible&&this.toggleMenu(kbSearchResult)};SearchResultActionsBase.prototype.GetMicrosoftSymbolIconByArticleActionId=function(actionId){return MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.GetSymbolCode(actionId)};SearchResultActionsBase.prototype.getUniqueActionId=function(knowledgeArticleId,actionPosition){return "actionItem_"+actionPosition+"_"+knowledgeArticleId};SearchResultActionsBase.prototype.GetLocalizedActionTooltip=function(action){if(action==MscrmControls.KbCommonUtils.ArticleAction.EmailArticle||action==MscrmControls.KbCommonUtils.ArticleAction.EmailArticleContent)return MscrmCommon.ControlUtils.String.Format(this._context.resources.getString(this.getArticleActionToTooltipNameMapping(action)),this._context.parameters.value.entityDisplayName);return this._context.resources.getString(this.getArticleActionToTooltipNameMapping(action))};SearchResultActionsBase.prototype.getArticleActionToLabelNameMapping=function(articleAction){return MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.GetLabel(articleAction)};SearchResultActionsBase.prototype.getArticleActionToTooltipNameMapping=function(articleAction){return MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.GetTooltip(articleAction)};SearchResultActionsBase.prototype.isActionValid=function(articleAction,kbSearchRecord){return MscrmControls.KbCommonUtils.ActionOperationFactory.Instance.Validate(articleAction,{controlContext:this._context,record:kbSearchRecord,stateManager:this._stateManager})};SearchResultActionsBase.prototype.reportActionToTelemetry=function(id){switch(id){case MscrmControls.KbCommonUtils.ArticleAction.LinkArticle:this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.LinkButtonClicked]);break;case MscrmControls.KbCommonUtils.ArticleAction.CopyLink:this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.CopyLinkButtonClicked]);break;case MscrmControls.KbCommonUtils.ArticleAction.EmailArticleContent:this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.LinkAndEmailContentButtonClicked]);break;case MscrmControls.KbCommonUtils.ArticleAction.EmailArticle:this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.LinkAndEmailButtonClicked]);break}};SearchResultActionsBase.prototype.spaceAvailableForActionTitle=function(actionTitle,firstAction){var spaceAvailable=this._fontIconSize+this.remToPixelConversion;if(firstAction)spaceAvailable+=.75*this.remToPixelConversion;else spaceAvailable+=1.25*this.remToPixelConversion;var hiddenActionSpan=this._hiddenActionSpan;if(hiddenActionSpan!=null){hiddenActionSpan.text(actionTitle);spaceAvailable+=hiddenActionSpan.width()}return spaceAvailable};return SearchResultActionsBase}();KbSearchControl.SearchResultActionsBase=SearchResultActionsBase})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultActionsUIEnhancement=function(_super){__extends(SearchResultActionsUIEnhancement,_super);function SearchResultActionsUIEnhancement(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.totalAvailableActions=0;return _this}SearchResultActionsUIEnhancement.prototype.render=function(kbSearchRecord,isPopupControl,describedByElementId){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"render","");this.renderActionFlags=[];var controlBlock=[],articleActions=this.getAvailableArticleActions(kbSearchRecord,isPopupControl);if(articleActions.length==0)return null;this.totalAvailableActions=articleActions.length;articleActions&&articleActions.length>0&&controlBlock.push(this.renderInlineActions(kbSearchRecord,isPopupControl,describedByElementId,articleActions));articleActions.length-this.renderActionFlags.length>0&&controlBlock.push(this.renderMenuFlyout(kbSearchRecord,isPopupControl,describedByElementId,articleActions));var styleClass=this._stateManager.GetIsSearchMode()||this.expandedRendering?"actions-container-standardmode-UIEnhancements":"actions-container-non-searchmode-UIEnhancements",result=this._context.factory.createElement("CONTAINER",{id:"searchResultActionsDropdown_UIEnhancement_"+kbSearchRecord.knowledgeArticleId.toString(),key:"searchResultActionsDropdown_UIEnhancement",className:"mscrm-searchResultActionsDropdown "+styleClass},controlBlock);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"render","");return result};SearchResultActionsUIEnhancement.prototype.renderActionIconButton=function(kbSearchRecord,describedByElementId,articleActionId,articleActions){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"renderAction "+articleActionId,"");var actionPosition=articleActions.indexOf(articleActionId),actionTooltip=this.GetLocalizedActionTooltip(articleActionId),actionLabel=this._context.resources.getString(this.getArticleActionToLabelNameMapping(articleActionId)),actionLabelPrefix="Actions-SearchResult-",_thisRef=this,onKeyDownHandler=function(event){return _thisRef.handleSearchResultActionsDropdownInlineActionKeyDown(event,articleActionId,kbSearchRecord,articleActions)},style={display:"flex",border:"none",margin:0,padding:"0px 4px",fontSize:this._context.theming.fontsizes.font115,color:"buttontext",backgroundColor:"transparent",cursor:"pointer"};if(this._stateManager.GetIsSearchMode()&&!MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)){if(actionPosition===0)style.padding=this._context.client.isRTL?"0px 0px 0px 4px":"0px 4px 0px 0px";else if(actionPosition===articleActions.length-1)style.padding=this._context.client.isRTL?"0px 4px 0px 0px":"0px 0px 0px 4px"}else if(!this.expandedRendering){style.padding="8px";style.color=MscrmControls.KbCommonUtils.Constants.COLOR_ACTION_ICON;actionLabelPrefix="Actions-NonSearchMode-"}var actionIconId=actionLabelPrefix+"UIEnhancements-"+actionPosition+"-"+kbSearchRecord.knowledgeArticleId.toString(),actionBtnProps={id:actionIconId,key:actionIconId,style:style,title:actionTooltip,accessibilityLabel:actionLabel,describedByElementId:describedByElementId,onClick:this.handleArticleActionClick.bind(this,articleActionId,kbSearchRecord,articleActions),onKeyDown:onKeyDownHandler},actionBtnIcon=this._context.factory.createElement("MICROSOFTICON",{type:this.GetMicrosoftSymbolIconByArticleActionId(articleActionId),key:actionIconId}),actionButton=this._context.factory.createElement("button",actionBtnProps,[actionBtnIcon]);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"renderAction "+articleActionId,"");return actionButton};SearchResultActionsUIEnhancement.prototype.renderInlineActions=function(kbSearchRecord,isPopupControl,describedByElementId,articleActions){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"renderInlineActions","");var childrenActions=[],scrollingDataBlockContainerId=(isPopupControl?KbSearchControl.Constants.PopupPrefixId:"")+KbSearchControl.Constants.SearchAndDataBlockContainerId,scrollingDataBlockContainer=document.getElementById(this._context.accessibility.getUniqueId(scrollingDataBlockContainerId)),totalAvailableSpace=0;if(!scrollingDataBlockContainer)this._stateManager.requestAdditionalRendering=true;else totalAvailableSpace=scrollingDataBlockContainer.offsetWidth;if(isPopupControl&&!(isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode))totalAvailableSpace-=this.remToPixelConversion*2;totalAvailableSpace-=this.remToPixelConversion*3.5;for(var numberOfInlineActions=this._stateManager.GetIsSearchMode()?Math.min(articleActions.length,3):articleActions.length,i=0;i<numberOfInlineActions;i++){var actionId=articleActions[i],actionLabel=this._context.resources.getString(this.getArticleActionToLabelNameMapping(actionId)),actionWidth=this.spaceAvailableForActionTitle(actionLabel,i==0?true:false);if(totalAvailableSpace-actionWidth>=0){var actionButton=this.renderActionIconButton(kbSearchRecord,describedByElementId,actionId,articleActions);childrenActions.push(actionButton);this.renderActionFlags[i]=true;totalAvailableSpace-=actionWidth}else break}var styleClass=this._stateManager.GetIsSearchMode()||this.expandedRendering?"actions-container-standardmode-UIEnhancements":"actions-container-non-searchmode-UIEnhancements",result=this._context.factory.createElement("CONTAINER",{id:"searchResultActionsDropdownInlineActions_UIEnhancement_"+kbSearchRecord.knowledgeArticleId.toString(),key:"searchResultActionsDropdownInlineActions_UIEnhancement",className:styleClass},childrenActions);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsUIEnhancement,"renderInlineActions","");return result};return SearchResultActionsUIEnhancement}(KbSearchControl.SearchResultActionsBase);KbSearchControl.SearchResultActionsUIEnhancement=SearchResultActionsUIEnhancement})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ArticleStatusFilter=function(){function ArticleStatusFilter(context){this._context=context;this._articleFilterOptions=[this._createOption(KbSearchControl.KbSearchControlLocale.AllDraftArticlesLocale,KbSearchControl.KbSearchControlLocale.AllDraftArticlesLocale,1),this._createOption(KbSearchControl.KbSearchControlLocale.AllApprovedArticlesLocale,KbSearchControl.KbSearchControlLocale.AllApprovedArticlesLocale,2),this._createOption(KbSearchControl.KbSearchControlLocale.AllPublishedArticlesLocale,KbSearchControl.KbSearchControlLocale.AllPublishedArticlesLocale,3)];this.SelectedItemResourceName=this._getConfiguredArticleStateFilter()}ArticleStatusFilter.prototype._createOption=function(label,text,value){return {text:text,Label:label,Value:value}};Object.defineProperty(ArticleStatusFilter.prototype,"ArticleFilterOptions",{"get":function(){return this._articleFilterOptions},enumerable:true,configurable:true});Object.defineProperty(ArticleStatusFilter.prototype,"SelectedItemResourceName",{"get":function(){return this._selectedItemResourceName},"set":function(value){this._selectedItemResourceName=value},enumerable:true,configurable:true});ArticleStatusFilter.prototype.SelectedItemStateCode=function(){var searchLabel=this.SelectedItemResourceName["text"]||this.SelectedItemResourceName["Label"]||"";switch(searchLabel){case KbSearchControl.KbSearchControlLocale.AllDraftArticlesLocale:return KbSearchControl.Constants.ArticleState["Draft"];case KbSearchControl.KbSearchControlLocale.AllApprovedArticlesLocale:return KbSearchControl.Constants.ArticleState["Approved"];case KbSearchControl.KbSearchControlLocale.AllPublishedArticlesLocale:default:return KbSearchControl.Constants.ArticleState["Published"]}};ArticleStatusFilter.prototype._getConfiguredArticleStateFilter=function(){var stateCodeDescriptor=this._context.parameters.value.descriptors.articleStatusFilter;switch(stateCodeDescriptor){case KbSearchControl.Constants.AllDraftArticlesDescriptor:return this.ArticleFilterOptions[0];case KbSearchControl.Constants.AllApprovedArticlesDescriptor:return this.ArticleFilterOptions[1];case KbSearchControl.Constants.AllPublishedArticlesDescriptor:default:return this.ArticleFilterOptions[2]}};ArticleStatusFilter.prototype.SetSelectedArticleStatusFilterByFilterOption=function(filterOption){var needsToChange=false;switch(filterOption){case KbSearchControl.ArticleStatusFilterOption.Draft:var draftArticleStatus=this.ArticleFilterOptions.filter(function(filterOption){return filterOption.text===KbSearchControl.KbSearchControlLocale.AllDraftArticlesLocale})[0];if(this.SelectedItemResourceName&&draftArticleStatus&&this.SelectedItemResourceName.Value!=draftArticleStatus.Value){this.SelectedItemResourceName=draftArticleStatus;needsToChange=true}break;case KbSearchControl.ArticleStatusFilterOption.Approved:var approvedArticleStatus=this.ArticleFilterOptions.filter(function(filterOption){return filterOption.text===KbSearchControl.KbSearchControlLocale.AllApprovedArticlesLocale})[0];if(this.SelectedItemResourceName&&approvedArticleStatus&&this.SelectedItemResourceName.Value!=approvedArticleStatus.Value){this.SelectedItemResourceName=approvedArticleStatus;needsToChange=true}break;case KbSearchControl.ArticleStatusFilterOption.Published:default:var publishedArticleStatus=this.ArticleFilterOptions.filter(function(filterOption){return filterOption.text===KbSearchControl.KbSearchControlLocale.AllPublishedArticlesLocale})[0];if(this.SelectedItemResourceName&&publishedArticleStatus&&this.SelectedItemResourceName.Value!=publishedArticleStatus.Value){this.SelectedItemResourceName=publishedArticleStatus;needsToChange=true}break}return needsToChange};return ArticleStatusFilter}();KbSearchControl.ArticleStatusFilter=ArticleStatusFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ArticleLanguageFilter=function(){function ArticleLanguageFilter(context){this.languageFilterOptions=[];this.languageFilters=[];this._context=context}Object.defineProperty(ArticleLanguageFilter.prototype,"SelectLanguageOption",{"get":function(){return this._selectedLanguageOption||this.DefaultLanguageLocaleId},"set":function(value){this._selectedLanguageOption=value},enumerable:true,configurable:true});Object.defineProperty(ArticleLanguageFilter.prototype,"DefaultLanguageLocaleId",{"get":function(){var languageFilter=this._context.parameters.value.descriptors.languageFilter,defaultFilter=languageFilter&&languageFilter!="00000000-0000-0000-0000-000000000000"&&(this.GetLanguageOptionByLanguageLocaleId(languageFilter)||this.GetLanguageOptionByLocaleId(languageFilter));defaultFilter=defaultFilter||this.GetLanguageOptionByLocaleId(this._context.client.languageCode);defaultFilter=defaultFilter||this.languageFilterOptions.length>0&&this.languageFilterOptions[0];return defaultFilter},enumerable:true,configurable:true});ArticleLanguageFilter.prototype.GetLanguageOptionByLanguageLocaleId=function(languageLocaleId){return this.languageFilterOptions.filter(function(languageOption){return languageOption.text===languageLocaleId})[0]};ArticleLanguageFilter.prototype.GetLanguageOptionByLocaleId=function(localeId){var filteredLanguage,languageCode=parseInt(localeId,10);if(!isNaN(languageCode))filteredLanguage=this.languageFilters.filter(function(language){return language.LocaleId===languageCode})[0];return filteredLanguage&&this.GetLanguageOptionByLanguageLocaleId(filteredLanguage.LanguageLocaleId)};ArticleLanguageFilter.prototype._createOption=function(label,text,value){return {text:text,Label:label,Value:value}};ArticleLanguageFilter.prototype.SetLanguageFilters=function(activeLanguages){if(activeLanguages&&activeLanguages.length>0)this.languageFilters=activeLanguages;this.CreateAndSetLanguageOptionsList()};ArticleLanguageFilter.prototype.CreateAndSetLanguageOptionsList=function(){var _this=this;this.languageFilterOptions.splice(0);this.languageFilters.forEach(function(language,index){_this.languageFilterOptions.push(_this._createOption(language.Name,language.LanguageLocaleId,index+1))})};ArticleLanguageFilter.prototype.SetSelectedArticleLanguageFilterByFilterOption=function(languageFilterOption){var needsToChange=false,filterArticleLanguage=this.languageFilters.filter(function(filterOption){return filterOption.LocaleId.toString()===languageFilterOption.toString()})[0],currentLanguageFilterOption=filterArticleLanguage&&this.languageFilterOptions.filter(function(filterOption){return filterOption.text==filterArticleLanguage.LanguageLocaleId})[0];if(this.SelectLanguageOption&&currentLanguageFilterOption&&this.SelectLanguageOption.Value!=currentLanguageFilterOption.Value){this.SelectLanguageOption=currentLanguageFilterOption;needsToChange=true}return needsToChange};return ArticleLanguageFilter}();KbSearchControl.ArticleLanguageFilter=ArticleLanguageFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var ExecuteKbSearchHelper=function(){function ExecuteKbSearchHelper(context){this._searchHasBeenPerformed=false;this._context=context;this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this.previouslyProcessedKeyPhrasesString="";this.previouslyProcessedAutoSuggestionFormFieldString="";this.searchType=KbSearchControl.SearchType.None;this.mode=context.utils.isFeatureEnabled(KbSearchControl.Constants.KMSimpleRelevanceSearch)?2:1;this.additionalKnowledgeArticleFilters={};this.enableMetadataFiltering=false;this.visibility=null;this.dateRange=null;this.useInflection=true;this.removeDuplicates=true}Object.defineProperty(ExecuteKbSearchHelper.prototype,"SearchHasBeenPerformed",{"get":function(){return this._searchHasBeenPerformed},"set":function(value){this._searchHasBeenPerformed=value},enumerable:true,configurable:true});ExecuteKbSearchHelper.prototype.setSearchType=function(isExternalSearchIndexEnabled){this.searchType=isExternalSearchIndexEnabled?KbSearchControl.SearchType.RelevanceSearch:KbSearchControl.SearchType.FullTextSearch};ExecuteKbSearchHelper.prototype.HandleCurrentSearchTextChanged=function(context){if(context.parameters.value.currentSearchText&&context.parameters.value.currentSearchText!=this.searchText){this.searchText=context.parameters.value.currentSearchText;context.parameters.value.currentSearchText=null;this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this.ExecuteKbSearch()}};ExecuteKbSearchHelper.prototype.ParseKeyPhrasesString=function(keyPhrasesString){var valueIndex=keyPhrasesString.indexOf(ExecuteKbSearchHelper._valueString);if(valueIndex<0)return "";return keyPhrasesString.substring(valueIndex+8,keyPhrasesString.length-2)};ExecuteKbSearchHelper.prototype.SetCurrentStateSearchParameters=function(){this.stateCode=this._stateManager.selectedStateCode?this._stateManager.selectedStateCode:this._stateManager.ArticleStatusFilter.SelectedItemStateCode();this.dateRange=this._stateManager.selectedDateRange?this._stateManager.selectedDateRange:null;this.visibility=this._stateManager.selectedVisibility?this._stateManager.selectedVisibility:null;this.sortBy=this._stateManager.SortFilter.SelectedSortFilterByAttributeName();this.languageLocaleId=this._stateManager.selectedLanguage?this._stateManager.selectedLanguage:this._stateManager.ArticleLanguageFilter.SelectLanguageOption.text;this.isDescending=this._stateManager.SortFilter.IsDescending;this.showRatingUsing=this._context.parameters.value.descriptors.enableRating?this._context.parameters.value.descriptors.showRatingUsing:"";this.numberOfResults=this._context.parameters.value.descriptors.numberOfResults;this.notifyHandlersThatEventOccurredParameter={eventName:KbSearchControl.Constants.ON_POST_SEARCH,fieldName:this._context.parameters.value.controlId,pageId:this._context.parameters.value.pageId,contextToken:this._context.parameters.value.contextToken};this.currentPageNumber=1;this.numberTimeExternalRelevanceSearchCall=1};ExecuteKbSearchHelper.prototype.ExecuteGetKbArticleSearch=function(kbArticleIDList){this.kbArticlesIDList=kbArticleIDList;return KbSearchControl.ExecuteSearchFactory.ExecuteSearch(KbSearchControl.SearchType.GetkbArticle,this._context,this)};ExecuteKbSearchHelper.prototype.ExecuteKbSearch=function(loadMore){if(loadMore===void 0)loadMore=false;KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameExecuteKbSearchHelper,"ExecuteKbSearch","");if(this.searchType===KbSearchControl.SearchType.None){KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameExecuteKbSearchHelper,"ExecuteKbSearch","");return}if(!this._context.utils.isFeatureEnabled(KbSearchControl.Constants.KMSimpleRelevanceSearch))this.mode=this.sortBy===KbSearchControl.Constants.SORT_BY_NUMBER_OF_VIEWS?2:1;if(loadMore){this.currentPageNumber+=1;if(this.searchType===KbSearchControl.SearchType.RelevanceSearch&&this.mode===1){var performRelevanceSearch=KbSearchControl.ExecuteRelevanceSearch.shouldPerformRelevanceSearch(this._stateManager);if(performRelevanceSearch)this.numberTimeExternalRelevanceSearchCall+=1}}else{this.SetCurrentStateSearchParameters();this._stateManager.canCallRelevanceSearch=true;this._stateManager.kbRelevanceSearchRecordCollection=[]}this._stateManager.shouldShowSelected=false;var executionPromise=KbSearchControl.ExecuteSearchFactory.ExecuteSearch(this.searchType,this._context,this);this._context.parameters.value.descriptors.showLanguageFilter=="true"&&this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.LanguageFilterUsed]);this._context.parameters.value.descriptors.showArticleStatusFilter=="true"&&this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.ArticleStateFilterUsed]);if(executionPromise)this.SearchHasBeenPerformed=true;this._stateManager.IsActionPerformedOnFirstResult=false;KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameExecuteKbSearchHelper,"ExecuteKbSearch","")};ExecuteKbSearchHelper.prototype.ShowLoadMoreButton=function(isPopupControl,isExternalSearchIndexEnabled){if(isExternalSearchIndexEnabled){if(this.mode===2){var relevanceSearchRecords=this._stateManager.relevanceSearchRecords;if(!relevanceSearchRecords)return false;var knowledgeArticleEntityNameFacet=relevanceSearchRecords.facets[KbSearchControl.Constants.SearchEntityNameFacet].filter(function(facet){return facet.facetValue===KbSearchControl.Constants.knowledgearticleEntityType});if(knowledgeArticleEntityNameFacet&&knowledgeArticleEntityNameFacet.length>0){var knowledgeArticleEntityCount=knowledgeArticleEntityNameFacet[0].count;return relevanceSearchRecords.value.length<knowledgeArticleEntityCount||!isPopupControl&&this._context.client.disableScroll&&relevanceSearchRecords.value.length>this._context.parameters.value.descriptors.numberOfResults}}else if(this.mode===1){var kbRelevanceSearchRecordCollection=this._stateManager.kbRelevanceSearchRecordCollection;if(!kbRelevanceSearchRecordCollection)return false;var currentPageNumber=this._stateManager.ExecuteKbSearchHelper.currentPageNumber,numOfResults=this._stateManager.ExecuteKbSearchHelper.numberOfResults;if(currentPageNumber*numOfResults<kbRelevanceSearchRecordCollection.length||this._stateManager.canCallRelevanceSearch)return true}return false}if(!this._stateManager.recordIds.length||!this._stateManager.totalCount)return false;if(this._stateManager.recordIds.length<this._stateManager.totalCount||!isPopupControl&&this._context.client.disableScroll&&this._stateManager.recordIds.length>this._context.parameters.value.descriptors.numberOfResults)return true;return false};ExecuteKbSearchHelper.prototype.UpdateAutoSuggestionsFormField=function(){if(this._context.parameters.value.descriptors.isAutoSuggestionsEnabled==="true")if(this._context.parameters.AutoSuggestionField&&this._context.parameters.AutoSuggestionField.formatted&&this.previouslyProcessedAutoSuggestionFormFieldString!==this._context.parameters.AutoSuggestionField.formatted){KbSearchControl.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_KBSEARCH_PERFORMED,this._context,false);this.previouslyProcessedAutoSuggestionFormFieldString=this._context.parameters.AutoSuggestionField.formatted;var currentSearchText=this._context.parameters.AutoSuggestionField.formatted;if(this.searchText!=currentSearchText){this.searchText=currentSearchText;this.currentPageNumber=1;this.ExecuteKbSearch();this._context.parameters.value.executeUpdateCurrentSearchText(this._context.parameters.value.contextToken,this.searchText)}}};ExecuteKbSearchHelper.prototype.GetLiveAdditionalFilters=function(){for(var liveFilters={},_i=0,_a=Object.keys(this.additionalKnowledgeArticleFilters);_i<_a.length;_i++){var kmAttr=_a[_i],liveValue=this.GetLiveFilter(this.additionalKnowledgeArticleFilters[kmAttr]);if(liveValue)liveFilters[kmAttr]=liveValue}return liveFilters};ExecuteKbSearchHelper.prototype.GetLiveFilter=function(srcAttr){var formAttribute=Xrm.Page.getAttribute(srcAttr);if(formAttribute&&formAttribute.getValue()&&formAttribute.getValue().length>0){var valueString=formAttribute.getValue()[0].id,valueGuid=Guid.tryParse(valueString);if(!Guid.equals(valueGuid,Guid.EMPTY))return valueGuid.toString()}return null};ExecuteKbSearchHelper.prototype.saveSearchHelperState=function(){var searchHelperState=new KbSearchControl.SearchHelperState;searchHelperState.searchText=this.searchText;searchHelperState.searchHasBeenPerformed=this.SearchHasBeenPerformed;searchHelperState.currentPage=this.currentPageNumber;searchHelperState.numberTimeExternalRelevanceSearchCall=this.numberTimeExternalRelevanceSearchCall;return searchHelperState};ExecuteKbSearchHelper.prototype.restoreSearchHelperState=function(searchHelperState){this.searchText=searchHelperState.searchText;this.SearchHasBeenPerformed=searchHelperState.searchHasBeenPerformed;this.SearchHasBeenPerformed&&this.SetCurrentStateSearchParameters();this.currentPageNumber=searchHelperState.currentPage;this.numberTimeExternalRelevanceSearchCall=searchHelperState.numberTimeExternalRelevanceSearchCall};ExecuteKbSearchHelper._valueString='value:{"';return ExecuteKbSearchHelper}();KbSearchControl.ExecuteKbSearchHelper=ExecuteKbSearchHelper})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SortFilter=function(){function SortFilter(context){this._context=context;this.sortFilters=[this.CreateOption(KbSearchControl.KbSearchControlLocale.RelevanceLocale,KbSearchControl.KbSearchControlLocale.RelevanceLocale,1),this.CreateOption(KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale,KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale,2),this.CreateOption(KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale,3),this.CreateOption(KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale,4)];this.SelectedSortFilter=this.sortFilters[0];this._isDescending=true}SortFilter.prototype.CreateOption=function(label,text,value){return {text:text,Label:label,Value:value}};Object.defineProperty(SortFilter.prototype,"IsDescending",{"get":function(){return this._isDescending},enumerable:true,configurable:true});SortFilter.prototype.SelectedSortFilterByAttributeName=function(){switch(this.SelectedSortFilter["text"]){case KbSearchControl.KbSearchControlLocale.RelevanceLocale:return "";case KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale:this._isDescending=true;return "knowledgearticleviews";case KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale:this._isDescending=true;return "modifiedon";case KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale:this._isDescending=false;return "modifiedon";default:return ""}};SortFilter.prototype.SelectedSortFilterBySortOption=function(){switch(this.SelectedSortFilter["text"]){case KbSearchControl.KbSearchControlLocale.RelevanceLocale:return KbSearchControl.SearchResultSortOption.Relevance;case KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale:return KbSearchControl.SearchResultSortOption.NumberOfViews;case KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale:return KbSearchControl.SearchResultSortOption.LastModifiedDateNewestFirst;case KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale:return KbSearchControl.SearchResultSortOption.LastModifiedDateOldestFirst;default:return KbSearchControl.SearchResultSortOption.Relevance}};SortFilter.prototype.SetSelectedSortFilterBySortOption=function(sortOption){var needsToChange=false;switch(sortOption){case KbSearchControl.SearchResultSortOption.Rating:break;case KbSearchControl.SearchResultSortOption.NumberOfViews:var numberOfViewFilter=this.sortFilters.filter(function(sortOption){return sortOption.text===KbSearchControl.KbSearchControlLocale.NumberOfViewsLocale})[0];if(this.SelectedSortFilter&&numberOfViewFilter&&this.SelectedSortFilter.Value!=numberOfViewFilter.Value){this.SelectedSortFilter=numberOfViewFilter;needsToChange=true}break;case KbSearchControl.SearchResultSortOption.LastModifiedDateOldestFirst:var lastModifiedOldSortFilter=this.sortFilters.filter(function(sortOption){return sortOption.text===KbSearchControl.KbSearchControlLocale.LastModifiedDateOldestFirstLocale})[0];if(this.SelectedSortFilter&&lastModifiedOldSortFilter&&this.SelectedSortFilter.Value!=lastModifiedOldSortFilter.Value){this.SelectedSortFilter=lastModifiedOldSortFilter;needsToChange=true}this._isDescending=false;break;case KbSearchControl.SearchResultSortOption.LastModifiedDateNewestFirst:var lastModifiedNewSortFilter=this.sortFilters.filter(function(sortOption){return sortOption.text===KbSearchControl.KbSearchControlLocale.LastModifiedDateNewestFirstLocale})[0];if(this.SelectedSortFilter&&lastModifiedNewSortFilter&&this.SelectedSortFilter.Value!=lastModifiedNewSortFilter.Value){this.SelectedSortFilter=lastModifiedNewSortFilter;needsToChange=true}this._isDescending=true;break;case KbSearchControl.SearchResultSortOption.Relevance:default:var relevanceSortFilter=this.sortFilters.filter(function(sortOption){return sortOption.text===KbSearchControl.KbSearchControlLocale.RelevanceLocale})[0];if(this.SelectedSortFilter&&relevanceSortFilter&&this.SelectedSortFilter.Value!=relevanceSortFilter.Value){this.SelectedSortFilter=relevanceSortFilter;needsToChange=true}break}return needsToChange};return SortFilter}();KbSearchControl.SortFilter=SortFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchControlLocale=function(){function KbSearchControlLocale(){}KbSearchControlLocale.initialize=function(getString){KbSearchControlLocale.NumberOfResultsFoundText=getString(KbSearchControl.Constants.NumberOfResultsFoundResourceName);KbSearchControlLocale.TextAnalyticsText=getString(KbSearchControl.Constants.TextAnalyticsResourceName);KbSearchControlLocale.FilterOpenTitleText=getString(KbSearchControl.Constants.FilterOpenTitleResourceName);KbSearchControlLocale.FilterCloseTitleText=getString(KbSearchControl.Constants.FilterCloseTitleResourceName);KbSearchControlLocale.FilterOpenAltText=getString(KbSearchControl.Constants.FilterOpenAltTextResourceName);KbSearchControlLocale.FilterCloseAltText=getString(KbSearchControl.Constants.FilterCloseAltTextResourceName);KbSearchControlLocale.FilterText=getString(KbSearchControl.Constants.FilterResourceName);KbSearchControlLocale.ArticleStateFilterTitleText=getString(KbSearchControl.Constants.ArticleStateFilterTitleResourceName);KbSearchControlLocale.ArticleLanguageFilterTitleText=getString(KbSearchControl.Constants.ArticleLanguageFilterTitleResourceName);KbSearchControlLocale.SortFilterTitleText=getString(KbSearchControl.Constants.SortFilterTitleResourceName);KbSearchControlLocale.AutoSuggestionTitleText=getString(KbSearchControl.Constants.AutoSuggestionTitleResourceName);KbSearchControlLocale.AutoSuggestionAltText=getString(KbSearchControl.Constants.AutoSuggestionAltTextResourceName);KbSearchControlLocale.SearchBoxPlaceholder=getString(KbSearchControl.Constants.SearchBoxPlaceholderResourceName);KbSearchControlLocale.SearchBoxAriaLabel=getString(KbSearchControl.Constants.SearchBoxAriaLabelResourceName);KbSearchControlLocale.SearchIconAltText=getString(KbSearchControl.Constants.SearchIconAltTextResourceName);KbSearchControlLocale.RemoveIconAltText=getString(KbSearchControl.Constants.RemoveIconAltTextResourceName);KbSearchControlLocale.FilterResultsByLabel=getString(KbSearchControl.Constants.FilterResultsByLabelResourceName);KbSearchControlLocale.ArticleStatusFilterLabel=getString(KbSearchControl.Constants.ArticleStatusFilterLabelResourceName);KbSearchControlLocale.LanguageFilterLabel=getString(KbSearchControl.Constants.LanguageFilterLabelResourceName);KbSearchControlLocale.SortByLabel=getString(KbSearchControl.Constants.SortByLabelResourceName);KbSearchControlLocale.AllDraftArticlesLocale=getString(KbSearchControl.Constants.AllDraftArticlesResourceName);KbSearchControlLocale.AllPublishedArticlesLocale=getString(KbSearchControl.Constants.AllPublishedArticlesResourceName);KbSearchControlLocale.AllApprovedArticlesLocale=getString(KbSearchControl.Constants.AllApprovedArticlesResourceName);KbSearchControlLocale.AllApprovedArticlesLocale=getString(KbSearchControl.Constants.AllApprovedArticlesResourceName);KbSearchControlLocale.RelevanceLocale=getString(KbSearchControl.Constants.RelevanceResourceName);KbSearchControlLocale.RatingLocale=getString(KbSearchControl.Constants.RatingResourceName);KbSearchControlLocale.NumberOfViewsLocale=getString(KbSearchControl.Constants.NumberOfViewsResourceName);KbSearchControlLocale.LastModifiedDateNewestFirstLocale=getString(KbSearchControl.Constants.LastModifiedDateNewestFirstResourceName);KbSearchControlLocale.LastModifiedDateOldestFirstLocale=getString(KbSearchControl.Constants.LastModifiedDateOldestFirstResourceName);KbSearchControlLocale.LoadMoreButtonLocale=getString(KbSearchControl.Constants.LoadMoreButton);KbSearchControlLocale.LoadingTextLocale=getString(KbSearchControl.Constants.LoadingText);KbSearchControlLocale.ConfirmDialogTitle=getString(KbSearchControl.Constants.ConfirmDialogTitle);KbSearchControlLocale.ConfirmDialogText=getString(KbSearchControl.Constants.ConfirmDialogTextResourceName);KbSearchControlLocale.ContentPaneBackButtonLabelText=getString(KbSearchControl.Constants.ContentPaneBackButtonLabelResourceName);KbSearchControlLocale.ContentPaneBackButtonToolTip=getString(KbSearchControl.Constants.ContentPaneBackButtonToolTip);KbSearchControlLocale.ContentPaneBackButtonAltText=getString(KbSearchControl.Constants.ContentPaneBackButtonAltText);KbSearchControlLocale.ModifiedOnLabel=getString(KbSearchControl.Constants.ModifiedOnLabelResourceName);KbSearchControlLocale.ModifiedOnLabelToolTip=getString(KbSearchControl.Constants.ModifiedOnLabelToolTip);KbSearchControlLocale.NumberOfViewsIconToolTip=getString(KbSearchControl.Constants.NumberOfViewsIconToolTip);KbSearchControlLocale.RatingIconToolTip=getString(KbSearchControl.Constants.RatingIconToolTip);KbSearchControlLocale.ArticleIconToolTipUnAssociated=getString(KbSearchControl.Constants.ArticleIconToolTipUnAssociated);KbSearchControlLocale.ArticleIconToolTipAssociated=getString(KbSearchControl.Constants.ArticleIconToolTipAssociated);KbSearchControlLocale.ArticleTagLabelAssociated=getString(KbSearchControl.Constants.ArticleTagLabelAssociated);KbSearchControlLocale.ResultStatusDraft=getString(KbSearchControl.Constants.ResultStatusDraftResourceName);KbSearchControlLocale.ResultStatusApproved=getString(KbSearchControl.Constants.ResultStatusApprovedResourceName);KbSearchControlLocale.ResultStatusScheduled=getString(KbSearchControl.Constants.ResultStatusScheduledResourceName);KbSearchControlLocale.MoreActionsText=getString(KbSearchControl.Constants.MoreActionsTextResourceName);KbSearchControlLocale.ContentPaneText=getString(KbSearchControl.Constants.ContentPaneTextResourceName);KbSearchControlLocale.NoArticlesErrorMessage=getString(KbSearchControl.Constants.NoArticlesErrorMessageResourceName);KbSearchControlLocale.RecordDoesNotExistErrorMessage=getString(KbSearchControl.Constants.RecordDoesNotExistErrorMessageResourceName);KbSearchControlLocale.NoSearchErrorMessage=getString(KbSearchControl.Constants.NoSearchErrorMessageResourceName);KbSearchControlLocale.SearchAndSelectArticleMessage=getString(KbSearchControl.Constants.SearchAndSelectArticleMessageResourceName);KbSearchControlLocale.NoPermissionErrorMessage=getString(KbSearchControl.Constants.NoPermissionErrorMessageResourceName);KbSearchControlLocale.TextAnalyticsErrorMessage=getString(KbSearchControl.Constants.TextAnalyticsErrorMessageResourceName);KbSearchControlLocale.SearchWidgetRelevanceSearchAdditionalMatches=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchAdditionalMatches);KbSearchControlLocale.SearchWidgetRelevanceSearchAnnotationMatchCount=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchAnnotationMatchCount);KbSearchControlLocale.SearchWidgetRelevanceSearchNotesAnnotationMatchCount=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchNotesAttachmentMatchCount);KbSearchControlLocale.SearchWidgetRelevanceSearchWarningTitle=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchWarningTitle);KbSearchControlLocale.NumberOfRatingToolTip=getString(KbSearchControl.Constants.NumberOfRatingToolTip);KbSearchControlLocale.SearchWidgetRelevanceSearchNotesMatchCount=getString(KbSearchControl.Constants.SearchWidgetRelevanceSearchNotesMatchCount);KbSearchControlLocale.MandatoryFieldsMissingError=getString(KbSearchControl.Constants.MandatoryFieldMissingErrorMessage);KbSearchControlLocale.MandatoryFieldMissingLinkFormat=getString(KbSearchControl.Constants.MandatoryFieldMissingLinkFormat);KbSearchControlLocale.MandatoryFieldMissingLinkText=getString(KbSearchControl.Constants.MandatoryFieldMissingLinkText);KbSearchControlLocale.SavedQueryApiFailedErrorMessage=getString(KbSearchControl.Constants.SavedQueryApiFailedErrorMessage);KbSearchControlLocale.QuickFindDocumentationHelpLink=getString(KbSearchControl.Constants.QuickFindDocumentationHelpLink);KbSearchControlLocale.MDFLabelText=getString(KbSearchControl.Constants.MDFLabelText);KbSearchControlLocale.MDFTooltipText=getString(KbSearchControl.Constants.MDFTooltipText);KbSearchControlLocale.InternalArticlesText=getString(KbSearchControl.Constants.InternalArticlesResourceName);KbSearchControlLocale.ExternalArticlesText=getString(KbSearchControl.Constants.ExternalArticlesResourceName);KbSearchControlLocale.ArticleStatusFilterText=getString(KbSearchControl.Constants.ArticleStatusFilterResourceName);KbSearchControlLocale.ArticleVisibilityFilterText=getString(KbSearchControl.Constants.ArticleVisibilityFilterResourceName);KbSearchControlLocale.ArticleLanguageFilterText=getString(KbSearchControl.Constants.ArticleLanguageFilterResourceName);KbSearchControlLocale.ArticleDateFilterText=getString(KbSearchControl.Constants.ArticleDateFilterResourceName);KbSearchControlLocale.Last7DaysText=getString(KbSearchControl.Constants.Last7DaysFilterResourceName);KbSearchControlLocale.Last30DaysText=getString(KbSearchControl.Constants.Last30DaysFilterResourceName);KbSearchControlLocale.Last6MonthsText=getString(KbSearchControl.Constants.Last6MonthsFilterResourceName);KbSearchControlLocale.LastYearText=getString(KbSearchControl.Constants.LastYearFilterResourceName);KbSearchControlLocale.FilterOptionAllText=getString(KbSearchControl.Constants.FilterOptionAllResourceName);KbSearchControlLocale.KnowledgeSearch=getString(KbSearchControl.Constants.KnowledgeSearch);KbSearchControlLocale.SortedByText=getString(KbSearchControl.Constants.SortedByText);KbSearchControlLocale.StandalonePageTitle=getString(KbSearchControl.Constants.StandalonePageTitle)};return KbSearchControlLocale}();KbSearchControl.KbSearchControlLocale=KbSearchControlLocale})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var EntitySearchResultLegends=function(){function EntitySearchResultLegends(){}EntitySearchResultLegends.prototype.init=function(context,notifyOutputChanged,state,container){this._context=context};EntitySearchResultLegends.prototype.renderEntitySearchResultLegendsContainer=function(){var EntitySearchResultLegendContainer=this.renderEntitySearchResultLegendContainer();return this._context.factory.createElement("CONTAINER",{key:"entitySearchResultLegendContainer",id:"entitySearchResultLegendContainerid"},EntitySearchResultLegendContainer)};EntitySearchResultLegends.prototype.getLegendTemplate=function(){return this._context.factory.createElement("LABEL",{key:"LegendTemplate",id:"kbSearchResultLegendsSpan"})};EntitySearchResultLegends.prototype.renderEntitySearchResultLegendContainer=function(){var entitySearchResultLegendContainerChildren=[],legendTemplate=this.getLegendTemplate();entitySearchResultLegendContainerChildren.push(legendTemplate);return entitySearchResultLegendContainerChildren};EntitySearchResultLegends.prototype.render=function(){return this.renderEntitySearchResultLegendsContainer()};EntitySearchResultLegends.prototype.getOutputs=function(){return null};EntitySearchResultLegends.prototype.destroy=function(){};EntitySearchResultLegends.prototype.onPreNavigation=function(){};return EntitySearchResultLegends}();KbSearchControl.EntitySearchResultLegends=EntitySearchResultLegends})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchFilter=function(){function KbSearchFilter(){}KbSearchFilter.prototype.init=function(context,notifyOutputChanged,state,container){this._context=context};KbSearchFilter.prototype.render=function(){return this._context.factory.createElement("LABEL",{key:"KbSearchFilter"},"KbSearchFilter")};KbSearchFilter.prototype.getOutputs=function(){return null};KbSearchFilter.prototype.destroy=function(){};KbSearchFilter.prototype.onPreNavigation=function(){};return KbSearchFilter}();KbSearchControl.KbSearchFilter=KbSearchFilter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchActions=function(){function KbSearchActions(){}KbSearchActions.prototype.init=function(context,notifyOutputChanged,state,container,hiddenActionSpan,fontIconSize){this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this._context=context;this._hiddenActionSpan=hiddenActionSpan;this._fontIconSize=fontIconSize};KbSearchActions.prototype.handleBackButtonClick=function(event){this._stateManager.SetIsSearchMode(true,this._context);this._context.utils.requestRender();this.reportBackButtonClickEvent()};KbSearchActions.prototype.handleBackButtonPress=function(event){if(event.key==="Enter"){this.selectedRecordTitle=this._stateManager.GetSelectedArticle().title;this._stateManager.SetIsSearchMode(true,this._context);this._context.utils.requestRender(this.onBackKeyDown.bind(this));this.reportBackButtonClickEvent()}};KbSearchActions.prototype.onBackKeyDown=function(){for(var articleTitleID=this._context.accessibility.getUniqueId("articleTitle"),articleIndex=$("[id="+articleTitleID+"]"),i=0;i<articleIndex.length;i++)articleIndex[i].attributes["title"].nodeValue==this.selectedRecordTitle&&articleIndex[i].focus()};KbSearchActions.prototype.renderActionLinks=function(isPopupControl){var expandedRendering=isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode||this._stateManager.IsExpandedMode;if(MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)&&!expandedRendering){if(this.SearchResultActionsUIEnhancementObject==null){this.SearchResultActionsUIEnhancementObject=new KbSearchControl.SearchResultActionsUIEnhancement;this.SearchResultActionsUIEnhancementObject.init(this._context,null,null,null,this._hiddenActionSpan,this._fontIconSize)}return this.SearchResultActionsUIEnhancementObject.render(this._stateManager.GetSelectedArticle(),isPopupControl,this._context.accessibility.getUniqueId("contentPaneArticleTitle"))}if(this.SearchResultActionsDropdownObject==null){this.SearchResultActionsDropdownObject=new KbSearchControl.SearchResultActionsDropdown;this.SearchResultActionsDropdownObject.init(this._context,null,null,null,this._hiddenActionSpan,this._fontIconSize)}return this.SearchResultActionsDropdownObject.render(this._stateManager.GetSelectedArticle(),isPopupControl,this._context.accessibility.getUniqueId("contentPaneArticleTitle"))};KbSearchActions.prototype.renderControlBlock=function(isPopupControl){if(isPopupControl===void 0)isPopupControl=false;KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchActions,"renderControlBlock","");var controlBlock=[],backButtonAndActionLinks=[];if(!this._context.parameters.value.hideSearchOnRecordLoad){var backButton=this._context.factory.createElement("MICROSOFTICON",{id:"ContentPaneBackButtonContainer",key:"ContentPaneBackButtonContainer",accessibilityLabel:KbSearchControl.KbSearchControlLocale.ContentPaneBackButtonToolTip,tabIndex:0,onKeyDown:this.handleBackButtonPress.bind(this),onClick:this.handleBackButtonClick.bind(this),role:"button",type:56,title:KbSearchControl.KbSearchControlLocale.ContentPaneBackButtonToolTip}),backButtonDiv=this._context.factory.createElement("CONTAINER",{style:{display:"inline-block",cursor:"pointer",fontSize:"16px",paddingRight:this._context.client.isRTL?0:"14px",paddingLeft:this._context.client.isRTL?"14px":0,borderRight:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?this._context.client.isRTL?0:this._context.theming.borders.border02:0,borderLeft:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?this._context.client.isRTL?this._context.theming.borders.border02:0:0,marginRight:this._context.client.isRTL?this._context.theming.measures.measure025:this._context.theming.measures.measure050,marginLeft:this._context.client.isRTL?this._context.theming.measures.measure050:this._context.theming.measures.measure025}},backButton);if(MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements))(!this._stateManager.IsExpandedMode||window.IsUSD)&&backButtonAndActionLinks.push(backButtonDiv);else backButtonAndActionLinks.push(backButtonDiv)}var renderActionLinks=this.renderActionLinks(isPopupControl),actions=this._context.factory.createElement("Container",{id:"ContentPaneActionLinks",key:"ContentPaneActionLinksDiv",style:{display:"inline-block",width:"100%",height:MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)&&MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?this._context.theming.measures.measure275:"auto"},className:"ContentPaneActionLinks"},renderActionLinks);backButtonAndActionLinks.push(actions);controlBlock.push(this._context.factory.createElement("Container",{id:"ContentPaneHeader",key:"ContentPaneHeaderDiv",style:{marginTop:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?0:this._context.theming.measures.measure075,borderBottomWidth:"1px",borderBottomStyle:"solid",borderStyle:"solid",borderBottomColor:"#D7D7D7",paddingBottom:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)&&!MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)?"8px":MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?0:this._context.theming.measures.measure075,paddingTop:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)&&!MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)?"8px":0,width:"100%",alignItems:"center",height:MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)&&MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?this._context.theming.measures.measure275:"auto"},className:"ContentPaneHeader"},backButtonAndActionLinks));var result=this._context.factory.createElement("Container",{id:"controlBlockActionHeaderReadPane",key:"controlBlockActionReadPanelDiv",ref:"controlBlockActionReadPanelDiv",className:"controlBlockHeaderReadPane",height:MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)&&MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)?this._context.theming.measures.measure275:"auto"},controlBlock);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchActions,"renderControlBlock","");return result};KbSearchActions.prototype.reportBackButtonClickEvent=function(){if(this._stateManager.records[0].knowledgeArticleId===this._stateManager.GetSelectedArticle().knowledgeArticleId)!this._stateManager.IsActionPerformedOnFirstResult&&this._stateManager.ReportEventToTelemetry(KbSearchControl.Constants.SearchWidgetEventMapping[MscrmControls.KbSearchControl.SearchWidgetEvent.BackButtonClickedWithoutAction]);this._stateManager.IsActionPerformedOnFirstResult=false};KbSearchActions.prototype.render=function(isPopupControl){return this.renderControlBlock(isPopupControl)};KbSearchActions.prototype.getOutputs=function(){return null};return KbSearchActions}();KbSearchControl.KbSearchActions=KbSearchActions})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchResultLegends=function(){function KbSearchResultLegends(){this._searchUIEnhancementsEnabled=false}KbSearchResultLegends.prototype.init=function(context,notifyOutputChanged,state,container){this._context=context;this._state=state};KbSearchResultLegends.prototype.render=function(kbSearchRecord){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResultLegends,"render","");this._searchUIEnhancementsEnabled=MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements);var isArticleSelected=false;if(this._state!=null&&this._state.hasOwnProperty("isArticleClicked"))isArticleSelected=this._state["isArticleClicked"];var controlBlock=[],knowledgeArticleViews=kbSearchRecord.knowledgeArticleViews?kbSearchRecord.knowledgeArticleViews:0,knowledgeArticleViewsTooltipValue=MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.NumberOfViewsIconToolTip,knowledgeArticleViews.toString()),modifiedOnResourceTooltipValue=KbSearchControl.KbSearchControlLocale.ModifiedOnLabelToolTip,ratingTooltipValue=KbSearchControl.KbSearchControlLocale.RatingIconToolTip,knowledgeArticleViewsLabel=this._context.factory.createElement("LABEL",{id:"knowledgeArticleViews_"+kbSearchRecord.knowledgeArticleId.toString(),key:"knowledgeArticleViews_"+kbSearchRecord.knowledgeArticleId.toString(),title:knowledgeArticleViewsTooltipValue,accessibilityHidden:true,tabIndex:-1,style:{color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit",fontSize:this._searchUIEnhancementsEnabled?this._context.theming.fontsizes.font085:"",lineHeight:this._searchUIEnhancementsEnabled?this._context.theming.fontsizes.font115:""}},knowledgeArticleViews),knowledgeArticleViewsAccessibilityLabel=this._context.factory.createElement("LABEL",{id:"knowledgeArticleViewsAccessibilityLabel_"+kbSearchRecord.knowledgeArticleId.toString(),key:"knowledgeArticleViewsAccessibilityLabel_"+kbSearchRecord.knowledgeArticleId.toString(),style:MscrmControls.KbCommonUtils.Constants.AccessibilityLabelStyle},knowledgeArticleViewsTooltipValue),rating=kbSearchRecord.rating?kbSearchRecord.rating:0,ratingAccessibilityLabelText=MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.NumberOfRatingToolTip,rating.toString()),ratingLabel=this._context.factory.createElement("LABEL",{id:"rating_"+kbSearchRecord.knowledgeArticleId.toString(),key:"rating_"+kbSearchRecord.knowledgeArticleId.toString(),title:ratingAccessibilityLabelText,accessibilityHidden:true,tabIndex:-1,style:{color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit",fontSize:this._searchUIEnhancementsEnabled?this._context.theming.fontsizes.font085:"",lineHeight:this._searchUIEnhancementsEnabled?this._context.theming.fontsizes.font115:""}},rating),ratingAccessibilityLabel=this._context.factory.createElement("LABEL",{id:"ratingAccessibilityLabel_"+kbSearchRecord.knowledgeArticleId.toString(),key:"ratingAccessibilityLabel_"+kbSearchRecord.knowledgeArticleId.toString(),style:MscrmControls.KbCommonUtils.Constants.AccessibilityLabelStyle},ratingAccessibilityLabelText);if(kbSearchRecord.modifiedOn){var modifiedOnValue,formattedDateTime=this._context.formatting.formatTime(new Date(kbSearchRecord.modifiedOn.toString()),1).split(/\s/);modifiedOnValue=formattedDateTime.length>1?formattedDateTime[0]:""}modifiedOnResourceTooltipValue=modifiedOnResourceTooltipValue.concat(" "+modifiedOnValue);var modifiedOnValueLabel=this._context.factory.createElement("LABEL",{id:"modifiedOnValue_"+kbSearchRecord.knowledgeArticleId.toString(),key:"modifiedOnValue_"+kbSearchRecord.knowledgeArticleId.toString(),style:{padding:this._searchUIEnhancementsEnabled?"":"0 0 0 3px",fontSize:this._searchUIEnhancementsEnabled?this._context.theming.fontsizes.font085:this._context.theming.fontsizes.font100,lineHeight:this._searchUIEnhancementsEnabled?this._context.theming.fontsizes.font115:"",color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:this._context.theming.colors.grays.gray05},title:modifiedOnResourceTooltipValue,accessibilityLabel:modifiedOnResourceTooltipValue},modifiedOnValue),modifiedOnResourceValue=KbSearchControl.KbSearchControlLocale.ModifiedOnLabel,modifiedOnResourceLabel=this._context.factory.createElement("LABEL",{id:"modifiedOnResourceValue_"+kbSearchRecord.knowledgeArticleId.toString(),key:"modifiedOnResourceValue_"+kbSearchRecord.knowledgeArticleId.toString(),style:{fontSize:this._context.theming.fontsizes.font100,color:this._context.theming.colors.grays.gray05,paddingLeft:"5px",paddingRight:"5px"},title:modifiedOnResourceTooltipValue,accessibilityHidden:true},modifiedOnResourceValue),modifiedOnDiv=this._context.factory.createElement("Container",{id:"kbSearchResults.footerDivModifiedOn_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footerDivModifiedOn_"+kbSearchRecord.knowledgeArticleId.toString(),style:{whiteSpace:"nowrap",flexWrap:"wrap",marginLeft:this._searchUIEnhancementsEnabled?0:this._context.client.isRTL?this._context.theming.measures.measure100:0,marginRight:this._searchUIEnhancementsEnabled?0:this._context.client.isRTL?0:this._context.theming.measures.measure100,display:"flex",color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit"}},[this._searchUIEnhancementsEnabled?null:modifiedOnResourceLabel,modifiedOnValueLabel]),numberOfViewsIconId="microsoftIcon_numberOfViewsButton__"+kbSearchRecord.knowledgeArticleId.toString(),numberOfViewsIcon=this._context.factory.createElement("MICROSOFTICON",{id:numberOfViewsIconId,key:numberOfViewsIconId,type:MscrmControls.KbCommonUtils.IconSymbolCode.NumberOfViews,accessibilityHidden:true,tabIndex:-1}),numberOfViewsIconDiv=this._context.factory.createElement("Container",{id:"numberOfViewsIcon_"+kbSearchRecord.knowledgeArticleId.toString(),key:"numberOfViewsIconDiv",ref:"numberOfViewsIconDiv",style:{whiteSpace:"nowrap",display:"inline-block",paddingLeft:this._context.client.isRTL?this._context.theming.measures.measure025:0,paddingRight:this._context.client.isRTL?0:this._context.theming.measures.measure025,fontSize:"16px",color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit"},title:knowledgeArticleViewsTooltipValue,accessibilityLabel:knowledgeArticleViewsTooltipValue},[numberOfViewsIcon,knowledgeArticleViewsAccessibilityLabel]);controlBlock.push(numberOfViewsIconDiv,knowledgeArticleViewsLabel);this._searchUIEnhancementsEnabled&&controlBlock.push(this.renderMetadataSeparator(MscrmControls.KbCommonUtils.Constants.NumberOfViews,kbSearchRecord.knowledgeArticleId.toString()));if(this._context.parameters.value.descriptors.enableRating=="true"){var ratingFullIconId="microsoftIcon_ratingFullButton__"+kbSearchRecord.knowledgeArticleId.toString(),ratingFullIcon=this._context.factory.createElement("MICROSOFTICON",{id:ratingFullIconId,key:ratingFullIconId,type:MscrmControls.KbCommonUtils.CommonUtils.getRatingIcon(this._context,this._searchUIEnhancementsEnabled),accessibilityHidden:true,tabIndex:-1}),ratingFullIconDiv=this._context.factory.createElement("Container",{id:"ratingFullIcon_"+kbSearchRecord.knowledgeArticleId.toString(),key:"ratingFullIconDiv",ref:"ratingFullIconDiv",style:{whiteSpace:"nowrap",display:"inline-block",marginLeft:this._searchUIEnhancementsEnabled?"":this._context.client.isRTL?0:this._context.theming.measures.measure100,marginRight:this._searchUIEnhancementsEnabled?"":this._context.client.isRTL?this._context.theming.measures.measure100:0,paddingLeft:this._context.client.isRTL?this._context.theming.measures.measure025:0,paddingRight:this._context.client.isRTL?0:this._context.theming.measures.measure025,fontSize:"16px",color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit"},title:ratingAccessibilityLabelText,accessibilityLabel:ratingAccessibilityLabelText},[ratingFullIcon,ratingAccessibilityLabel]);this._searchUIEnhancementsEnabled?controlBlock.unshift(ratingFullIconDiv,ratingLabel,this.renderMetadataSeparator(MscrmControls.KbCommonUtils.Constants.Rating,kbSearchRecord.knowledgeArticleId.toString())):controlBlock.push(ratingFullIconDiv,ratingLabel)}var footerDivRatingandArticleView=this._context.factory.createElement("Container",{id:"kbSearchResults.footerDivRatingandArticleView_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footerDivRatingandArticleView_"+kbSearchRecord.knowledgeArticleId.toString(),style:{whiteSpace:"normal",display:"flex",flexWrap:"nowrap",color:isArticleSelected?KbSearchControl.Constants.ArticleFooterTextColorWhenSelected:"inherit",marginLeft:this._context.client.isRTL?"":this._searchUIEnhancementsEnabled?"auto":"",marginRight:this._context.client.isRTL?this._searchUIEnhancementsEnabled?"auto":"":""}},controlBlock),linkedTooltipValue=MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.ArticleIconToolTipAssociated,this._context.parameters.value.entityDisplayName),enhancedLabelStyle={color:"#323130",fontSize:this._context.theming.fontsizes.font085,lineHeight:this._context.theming.fontsizes.font115},oldLableStyle={color:"white"},linkedArticleLabel=this._context.factory.createElement("LABEL",{id:"knowledgeArticleLinked_"+kbSearchRecord.knowledgeArticleId.toString(),key:"knowledgeArticleLinked_"+kbSearchRecord.knowledgeArticleId.toString(),title:linkedTooltipValue,accessibilityLabel:linkedTooltipValue,style:this._searchUIEnhancementsEnabled?enhancedLabelStyle:oldLableStyle},MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.ArticleTagLabelAssociated,this._context.parameters.value.entityDisplayName)),linkedArticle=this._context.factory.createElement("Container",{id:"kbSearchResults.footerDivLinkedArticle_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footerDivLinkedArticle_"+kbSearchRecord.knowledgeArticleId.toString(),style:{color:this._searchUIEnhancementsEnabled?"":"#fff",backgroundColor:this._searchUIEnhancementsEnabled?"#CCDEFF":"#337ab7",borderColor:this._searchUIEnhancementsEnabled?"":"#2e6da4",borderRadius:this._searchUIEnhancementsEnabled?"2px":"3px",marginRight:this._searchUIEnhancementsEnabled?"":"10px",padding:"1px 5px"}},linkedArticleLabel),headerContent=[];this._searchUIEnhancementsEnabled&&kbSearchRecord.isAssociated&&headerContent.push(linkedArticle);if(this._context.parameters.DialogContext&&this._context.parameters.DialogContext.isMultiSelect&&this._context.parameters.DialogContext.SelectedRecords[kbSearchRecord.knowledgeArticleId]){var isContentSelected=this._context.parameters.DialogContext.SelectedRecords[kbSearchRecord.knowledgeArticleId].content,isUrlSelected=this._context.parameters.DialogContext.SelectedRecords[kbSearchRecord.knowledgeArticleId].url,selectedTooltipValue=void 0;if(isContentSelected&&isUrlSelected)selectedTooltipValue="Content and URL Selected";else if(isContentSelected)selectedTooltipValue="Content Selected";else selectedTooltipValue="Url Selected";var SelectedArticleLabel=this._context.factory.createElement("LABEL",{id:"knowledgeArticleSelected_"+kbSearchRecord.knowledgeArticleId.toString(),key:"knowledgeArticleSelected_"+kbSearchRecord.knowledgeArticleId.toString(),title:selectedTooltipValue,accessibilityLabel:selectedTooltipValue,style:this._searchUIEnhancementsEnabled?enhancedLabelStyle:oldLableStyle},selectedTooltipValue),SelectedArticle=this._context.factory.createElement("Container",{id:"kbSearchResults.footerDivSelectedArticle_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footerDivSelectedArticle_"+kbSearchRecord.knowledgeArticleId.toString(),style:{color:this._searchUIEnhancementsEnabled?"":MscrmControls.KbCommonUtils.Constants.COLOR_SEARCH_RESULT_LABEL_CONTAINER,backgroundColor:MscrmControls.KbCommonUtils.Constants.BGCOLOR_SEARCH_RESULT_LABEL_CONTAINER,borderRadius:this._searchUIEnhancementsEnabled?"2px":"3px",marginRight:this._searchUIEnhancementsEnabled?"":"10px",padding:"1px 5px"}},SelectedArticleLabel);headerContent.push(SelectedArticle)}headerContent.push(footerDivRatingandArticleView);headerContent.push(modifiedOnDiv);var headerIconsBlock=this._context.factory.createElement("Container",{id:"controlBlockHeaderIconPane_"+kbSearchRecord.knowledgeArticleId.toString(),key:"controlBlockHeaderIconPaneDiv",ref:"controlBlockHeaderIconPaneDiv",className:"controlBlockHeaderIconPane",style:{width:"100%",flexWrap:this._searchUIEnhancementsEnabled?"wrap":""}},headerContent);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResultLegends,"render","");return headerIconsBlock};KbSearchResultLegends.prototype.renderMetadataSeparator=function(separatorId,kbArticleId){return this._context.factory.createElement("LABEL",{id:"searchMetadataSeparator_"+separatorId+"_"+kbArticleId+"_"+this._context.parameters.value.controlId,key:"modifiedOnValue_"+separatorId+"_"+kbArticleId+"_"+this._context.parameters.value.controlId,accessibilityHidden:true,tabIndex:-1,style:{fontSize:this._context.theming.fontsizes.font085,paddingLeft:this._context.theming.measures.measure050,paddingRight:this._context.theming.measures.measure050,fontWeight:800}},MscrmControls.KbCommonUtils.Constants.MiddleDotUnicode)};KbSearchResultLegends.prototype.getOutputs=function(){return null};KbSearchResultLegends.prototype.destroy=function(){};KbSearchResultLegends.prototype.onPreNavigation=function(){};return KbSearchResultLegends}();KbSearchControl.KbSearchResultLegends=KbSearchResultLegends})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var RENDER_ADDITIONAL_ATTRIBUTE_MATCHES=false,KbSearchResults=function(){function KbSearchResults(){this._searchUIEnhancementsEnabled=false}KbSearchResults.prototype.init=function(context,notifyOutputChanged,state,container,hiddenActionSpan,fontIconSize){this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this._context=context;this._searchUIEnhancementsEnabled=MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements);this._setEnableSelection();this._hiddenActionSpan=hiddenActionSpan;this._fontIconSize=fontIconSize};KbSearchResults.prototype.handleKeyDownPress=function(kbSearchRecord,keyEvent){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResults,"handleKeyDownPress","");var articleTitleID=this._context.accessibility.getUniqueId("articleTitle");if(keyEvent.keyCode==KbSearchControl.Constants.DownArrowKeyCode){var articleIndex=$("[id="+articleTitleID+"]"),articleIndexCount=articleIndex.index(document.activeElement);if(articleIndexCount!=articleIndex.length-1){articleIndex[articleIndexCount+1].focus();this._stateManager.SetSelectedArticle(this._stateManager.records[articleIndexCount+1],this._context)}else{var loadMoreLabel=document.getElementById(this._context.accessibility.getUniqueId("loadMoreLabel"));loadMoreLabel&&loadMoreLabel.focus()}}else if(keyEvent.keyCode==KbSearchControl.Constants.UpArrowKeyCode){var articleIndex=$("[id="+articleTitleID+"]"),articleIndexCount=articleIndex.index(document.activeElement);if(articleIndexCount!=0){articleIndex[articleIndexCount-1].focus();this._stateManager.SetSelectedArticle(this._stateManager.records[articleIndexCount-1],this._context)}else{var searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.PopupPrefixId+KbSearchControl.Constants.SearchTextBoxId));if(!searchTextBox)searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.SearchTextBoxId));searchTextBox.focus()}}else keyEvent.keyCode==KbSearchControl.Constants.EnterKey&&this.renderArticleContent(kbSearchRecord,keyEvent);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResults,"handleKeyDownPress","")};KbSearchResults.prototype.articleClick=function(kbSearchRecord,event,errorOccured){if(errorOccured===void 0)errorOccured=false;KbSearchControl.PerformanceTelemetry.Instance.AddStartMarker(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_OPEN_ARTICLE_TO_READ,this._context);if(this._stateManager.recordIds){var articleIndex=this._stateManager.recordIds.indexOf(kbSearchRecord.knowledgeArticleId);KbSearchControl.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_OPEN_ARTICLE_TO_READ,this._context,articleIndex)}if(this._searchUIEnhancementsEnabled)this._clickKbArticleId=kbSearchRecord.knowledgeArticleId;KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResults,"articleClick","");var _this=this,viewDate,location=1,count=1;viewDate=moment(new Date).toISOString();var knowledgearticleId=kbSearchRecord.knowledgeArticleId,entityReference={id:knowledgearticleId,entityType:KbSearchControl.Constants.knowledgearticleEntityType};!errorOccured&&KbSearchControl.ExecuteIncrementKnowledgeArticleViewCountAction.Instance.executeIncrementKnowledgeArticleViewCount(entityReference,viewDate,location,count,this._context);this._fireEvent(kbSearchRecord);_this._stateManager.SetSelectedArticle(kbSearchRecord,_this._context);if(this._context.parameters.value.blockClick){event.stopPropagation();event.preventDefault();_this._stateManager.CallResultOpenedNotifyHandler(_this._context);this._searchUIEnhancementsEnabled&&this._context.utils.requestRender();return}_this._stateManager.SetIsSearchMode(false,_this._context);var kbSearchResultContentPaneObject=_this._stateManager.GetkbSearchResultContentPaneObject();kbSearchResultContentPaneObject.updateIframe.bind(_this);var stateManagerObject=_this._stateManager;stateManagerObject.popupEnabled=_this._context.client.disableScroll;_this._context.utils.requestRender(function(){var backButton=document.getElementById(_this._context.accessibility.getUniqueId("ContentPaneBackButtonContainer"));backButton&&backButton.focus()});event.stopPropagation();event.preventDefault();KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResults,"articleClick","")};KbSearchResults.prototype._fireEvent=function(kbSearchRecord){var searchWidgetParameter=Object.assign({},this._context.parameters.value),updatedKbSearchRecord=Object.assign({},kbSearchRecord,{knowledgeArticleViews:kbSearchRecord.knowledgeArticleViews+1});searchWidgetParameter.records=[updatedKbSearchRecord];searchWidgetParameter.recordIds=[updatedKbSearchRecord.knowledgeArticleId];searchWidgetParameter.hideSearchOnRecordLoad=true;searchWidgetParameter.Visible=true;this._context.utils.fireEvent("onSearchWidgetResultOpened",searchWidgetParameter)};KbSearchResults.prototype.renderKbSearchResultStatusInfo=function(stateCode){if(this.KbSearchResultStatusObject==null){this.KbSearchResultStatusObject=new KbSearchControl.KbSearchResultStatus;this.KbSearchResultStatusObject.init(this._context)}return this.KbSearchResultStatusObject.render(stateCode)};KbSearchResults.prototype.getKbSearchResultStatusInfo=function(stateCode){if(this.KbSearchResultStatusObject==null){this.KbSearchResultStatusObject=new KbSearchControl.KbSearchResultStatus;this.KbSearchResultStatusObject.init(this._context)}return this.KbSearchResultStatusObject.getStatusByStateCode(stateCode)};KbSearchResults.prototype.renderAssociationLink=function(){var associationLinkId="microsoftIcon_articleLink_",associationLink=this._context.factory.createElement("MICROSOFTICON",{id:associationLinkId,key:associationLinkId,type:149});return this._context.factory.createElement("Container",{id:"kbSearchResults.associationLinkid",key:"kbSearchResults.associationLink",className:"mscrm-KbAssociatedLink mscrm-kbSerachResultHeaderCell mscrm-kbSearchResultHeaderSidebar",style:{fontSize:"16px"}},associationLink)};KbSearchResults.prototype.renderSearchResultActionsDropdown=function(kbSearchRecord,isPopupControl,describedByElementId){if(this.SearchResultsActionsDropdownObject==null){this.SearchResultsActionsDropdownObject=new KbSearchControl.SearchResultActionsDropdown;this.SearchResultsActionsDropdownObject.init(this._context,null,null,null,this._hiddenActionSpan,this._fontIconSize)}return this.SearchResultsActionsDropdownObject.render(kbSearchRecord,isPopupControl,this._context.accessibility.getUniqueId(describedByElementId))};KbSearchResults.prototype.renderSearchResultActionsSearchmode=function(kbSearchRecord,isPopupControl,describedByElementId){if(this.SearchResultActionsUIEnhancementObject==null){this.SearchResultActionsUIEnhancementObject=new KbSearchControl.SearchResultActionsUIEnhancement;this.SearchResultActionsUIEnhancementObject.init(this._context,null,null,null,this._hiddenActionSpan,this._fontIconSize)}return this.SearchResultActionsUIEnhancementObject.render(kbSearchRecord,isPopupControl,this._context.accessibility.getUniqueId(describedByElementId))};KbSearchResults.prototype.renderArticleContent=function(kbSearchRecord,event){var _this_1=this;if(this._stateManager.isExternalSearchIndexEnabled){var cloneKbRecord=JSON.parse(JSON.stringify(kbSearchRecord));window.$.when(this.getKATitleContent(cloneKbRecord)).done(function(kbResponse){kbResponse.isAssociated=kbSearchRecord.isAssociated;return _this_1.articleClick(kbResponse,event)}).fail(function(errorObject){if(errorObject&&errorObject.knowledgeArticleId)return _this_1.articleClick(errorObject,event,true)});event.stopPropagation();event.preventDefault()}else return this.articleClick(kbSearchRecord,event)};KbSearchResults.prototype.renderSearchResultRow=function(kbSearchRecord,isPopupControl,isExternalSearchIndexEnabled){var _this_1=this;KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResults,"renderSearchResultRow","");var titleBlock=[],title=kbSearchRecord.title,articleAriaLabel=kbSearchRecord.title,isArticleHover=false,isArticleClicked=false;if(this._hoverKbArticleId===kbSearchRecord.knowledgeArticleId)isArticleHover=true;if(this._clickKbArticleId===kbSearchRecord.knowledgeArticleId)isArticleClicked=true;var renderKbSearchResultStatusInfo=this.renderKbSearchResultStatusInfo(kbSearchRecord.stateCode),KbSearchResultStatusInfo=this.getKbSearchResultStatusInfo(kbSearchRecord.stateCode);renderKbSearchResultStatusInfo&&titleBlock.push(renderKbSearchResultStatusInfo);if(KbSearchResultStatusInfo)articleAriaLabel=KbSearchResultStatusInfo+" "+title;var highlightedTitle=kbSearchRecord.highlights&&kbSearchRecord.highlights.title;titleBlock=titleBlock.concat(this._generatetHtmlElementsfromCrmhitText(highlightedTitle?highlightedTitle:title));var articleTitle=this._context.factory.createElement("text",{id:"articleTitleText_"+kbSearchRecord.knowledgeArticleId.toString(),key:"articleTitleText_"+kbSearchRecord.knowledgeArticleId.toString(),semanticTag:"h4",title:title,noExpandable:true,singleLineTruncation:false,truncatedlines:2,maskingColor:"#F8F7F6",flexibleTextContainerStyle:{lineHeight:"1.4em"},flexibleTextStyle:{lineHeight:"1.4em",textOverflow:"ellipsis",wordBreak:"break-all"},style:{color:this.isEnableSelection?isArticleClicked?"#000000":"#333333":"inherit"}},titleBlock),articleTitleId="articleTitle"+kbSearchRecord.knowledgeArticleId,articleTitleLink=this._context.factory.createElement("Hyperlink",{id:articleTitleId,key:articleTitleId,onKeyDown:function(event){return _this_1.handleKeyDownPress(kbSearchRecord,event)},onFocus:function(event){return _this_1._handleFocus(kbSearchRecord,event)},onClick:function(event){return _this_1.renderArticleContent(kbSearchRecord,event)},style:{paddingLeft:!this._searchUIEnhancementsEnabled?this._context.client.isRTL?0:this._context.theming.measures.measure100:MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)||this._context.client.isRTL?this._context.theming.measures.measure100:0,paddingRight:!this._searchUIEnhancementsEnabled?this._context.client.isRTL?this._context.theming.measures.measure100:0:MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)?this._context.theming.measures.measure100:0,width:"calc(100% - "+this._context.theming.measures.measure350+')"',maxHeight:"2.8em",textDecoration:"none",color:this._context.theming.colors.grays.gray06,overflow:"hidden",fontFamily:this._context.theming.fontfamilies.semibold,fontSize:this._context.theming.fontsizes.font100,cursor:"pointer",whiteSpace:"normal",":hover":{color:KbSearchControl.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl.Constants.KMRefreshSearchUI)?MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION:"inherit"}},accessibilityLabel:articleAriaLabel,tabIndex:0},articleTitle),articleIconDiv=null;if(!this._searchUIEnhancementsEnabled){var articleIconType=0,articleIconTooltipValue="",isAssociatedArticle=kbSearchRecord.isAssociated;if(isAssociatedArticle){articleIconType=235;articleIconTooltipValue=MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.ArticleIconToolTipAssociated,this._context.parameters.value.entityReference.LogicalName)}else{articleIconType=236;articleIconTooltipValue=KbSearchControl.KbSearchControlLocale.ArticleIconToolTipUnAssociated}var articleIconId="microsoftIcon_articleButton_"+kbSearchRecord.knowledgeArticleId.toString(),articleIcon=this._context.factory.createElement("MICROSOFTICON",{id:articleIconId,key:articleIconId,title:articleIconTooltipValue,type:articleIconType,style:{color:this.isEnableSelection?isArticleClicked?"#FFFFFF":isArticleHover?"#444444":"#666666":"inherit"}});articleIconDiv=this._context.factory.createElement("Container",{id:"articleIcon.div.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"articleIcon.div",style:{height:this._context.theming.measures.measure250,minWidth:this._context.theming.measures.measure250,borderRadius:"50%",backgroundColor:this.isEnableSelection?isArticleClicked?"#3879B7":isArticleHover?"#D8D8D8":"#EFEFEF":!isAssociatedArticle?"#DEDEDE":"#3b79b7",alignItems:"center",justifyContent:"center",fontSize:"16px",color:isAssociatedArticle?"#ffffff":"",position:"relative"}},articleIcon)}var actionsRender=this.renderSearchResultActionsSearchmode(kbSearchRecord,isPopupControl,articleTitleId),actionsWidthAllocation=Math.min(this.SearchResultActionsUIEnhancementObject.totalAvailableActions,4)*24+"px",actionsDiv=null;if(actionsRender!=null)actionsDiv=this._context.factory.createElement("Container",{id:"kbSearchResults.action.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.action",role:"presentation",className:"actions-root-container-standardmode-UIEnhancements",style:{width:this._searchUIEnhancementsEnabled?actionsWidthAllocation:"auto",paddingRight:this._searchUIEnhancementsEnabled&&!this._context.client.isRTL&&!MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)?0:this._context.theming.measures.measure100,paddingLeft:this._searchUIEnhancementsEnabled&&this._context.client.isRTL?this._context.theming.measures.measure100:""}},actionsRender);var kbSearchResultsRow=this._context.factory.createElement("Container",{id:"kbSearchResults.row.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.row",className:"mscrm-kbSearchResultTitle mscrm-kbSerachResultHeaderCell mscrm-kbSerachResultHeaderTitle",style:{width:this._searchUIEnhancementsEnabled&&actionsRender!=null?"calc(100% - "+actionsWidthAllocation+")":"100%",whiteSpace:"normal",alignItems:"center"}},[articleTitleLink]),rowsForRender=[kbSearchResultsRow,this._searchUIEnhancementsEnabled?actionsDiv:null],headerDiv=this._context.factory.createElement("Container",{id:"kbSearchResults.header.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.header",className:"mscrm-kbSearchResultHeader mscrm-kbSerachResultHeaderTable",style:{width:"100%",paddingBottom:this._context.theming.measures.measure050}},rowsForRender),fullResultContent=kbSearchRecord.content;fullResultContent=$($["parseHTML"](fullResultContent)).text().substring(0,KbSearchControl.Constants.MaxCharacterAllowedInKbToolTip);var highlightedContent=kbSearchRecord.highlights&&kbSearchRecord.highlights.content,fullResultContentArray=this._generatetHtmlElementsfromCrmhitText(highlightedContent?highlightedContent:fullResultContent),descriptionDiv=this._context.factory.createElement("Text",{id:"kbSearchResults.description.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.description",className:"mscrm-kbSearchResultDescription mscrm-multilineEllipsis",tabIndex:-1,noExpandable:true,singleLineTruncation:false,truncatedlines:3,maskingColor:"#F8F7F6",flexibleTextContainerStyle:{width:"inherit"},flexibleTextStyle:{width:"inherit",lineHeight:"1.4em",textOverflow:"ellipsis",wordBreak:"break-all"},style:{color:this.isEnableSelection?isArticleClicked?"#333333":isArticleHover?"#444444":"#666666":"inherit"}},fullResultContentArray),descriptionDivContainer=this._context.factory.createElement("Container",{id:"kbSearchResults.descriptionContainer.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.descriptionContainer",className:"mscrm-kbSearchResultDescriptionContainer",style:{color:this._context.theming.colors.grays.gray06,paddingLeft:!this._searchUIEnhancementsEnabled?this._context.theming.measures.measure100:!MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)&&!this._context.client.isRTL?0:this._context.theming.measures.measure100,paddingRight:this._context.theming.measures.measure100,width:"100%",fontSize:this._context.theming.fontsizes.font100,height:this._searchUIEnhancementsEnabled?"":"4.50em",whiteSpace:"normal",overflow:"hidden",textOverflow:"ellipsis"},tabIndex:-1},descriptionDiv),bodyDiv=this._context.factory.createElement("Container",{id:"kbSearchResults.body.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.body",style:{width:"100%",marginBottom:this._context.theming.measures.measure050}},descriptionDivContainer),rowsForActionRender=this.renderSearchResultActionsDropdown(kbSearchRecord,isPopupControl,articleTitleId);if(rowsForActionRender!=null)var actionDiv=this._context.factory.createElement("Container",{id:"kbSearchResults.action.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.action",style:{width:"calc(100% - "+this._context.theming.measures.measure350+')"',height:this._context.theming.measures.measure175,marginBottom:this._context.theming.measures.measure050,marginLeft:this._context.client.isRTL?0:this._context.theming.measures.measure100,marginRight:this._context.client.isRTL?this._context.theming.measures.measure100:0,position:"relative"}},rowsForActionRender);var articleState={};articleState["isArticleClicked"]=isArticleClicked;var additionalMatches=kbSearchRecord.additionalMatches,annotationAttachmentCount=kbSearchRecord.annotationAttachmentCount,annotationNotesCount=kbSearchRecord.annotationNotesCount,shouldRenderAdditionalMatches=additionalMatches&&additionalMatches.length>0&&RENDER_ADDITIONAL_ATTRIBUTE_MATCHES,shouldRenderAnnotationMatches=annotationAttachmentCount&&annotationAttachmentCount>0||annotationNotesCount&&annotationNotesCount>0,footerDiv=this.renderArticleMetadata(kbSearchRecord,articleState,shouldRenderAdditionalMatches||shouldRenderAnnotationMatches),articleRenderComponents=this._searchUIEnhancementsEnabled?[headerDiv,bodyDiv,footerDiv]:[headerDiv,bodyDiv,actionDiv,footerDiv];shouldRenderAdditionalMatches&&articleRenderComponents.push(this.renderAdditionalMetadata(kbSearchRecord,MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchAdditionalMatches,additionalMatches.length)));if(shouldRenderAnnotationMatches)if(annotationAttachmentCount&&annotationNotesCount)articleRenderComponents.push(this.renderAdditionalMetadata(kbSearchRecord,MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchNotesAnnotationMatchCount,annotationAttachmentCount)));else if(annotationAttachmentCount)articleRenderComponents.push(this.renderAdditionalMetadata(kbSearchRecord,MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchAnnotationMatchCount,annotationAttachmentCount)));else annotationNotesCount&&articleRenderComponents.push(this.renderAdditionalMetadata(kbSearchRecord,MscrmCommon.ControlUtils.String.Format(KbSearchControl.KbSearchControlLocale.SearchWidgetRelevanceSearchNotesMatchCount,annotationNotesCount)));var contentContainer=this._context.factory.createElement("Container",{id:"kbSearchResults.contentContainer.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.contentContainer",style:{display:"flex",flexDirection:"column",width:"100%",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},articleRenderComponents),result=this._context.factory.createElement("Container",{id:"kbSearchResults.content.id"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.content",className:this._searchUIEnhancementsEnabled?null:"mscrm-kbSearchResultContent",style:{display:"flex",paddingTop:KbSearchControl.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl.Constants.KMRefreshSearchUI)?this._context.theming.measures.measure050:this._context.theming.measures.measure100,cursor:this._searchUIEnhancementsEnabled?"pointer":""},onClick:function(event){return _this_1._articleContainerClick(kbSearchRecord,event)},onPointerEnter:this._onMouseEnterHandler.bind(this,kbSearchRecord.knowledgeArticleId),onPointerLeave:this._onMouseLeaveHandler.bind(this)},[articleIconDiv,contentContainer]);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameKbSearchResults,"renderSearchResultRow","");return result};KbSearchResults.prototype.renderAdditionalMetadata=function(kbSearchRecord,additionalMetadataString){var isArticleClicked=false;if(this._clickKbArticleId===kbSearchRecord.knowledgeArticleId)isArticleClicked=true;var additionalMetadataId="kbsearchcontrol_additionalMetadata_",additionalMetadataIconId=additionalMetadataId+"Icon_"+kbSearchRecord.knowledgeArticleId.toString(),iconComponent=this._context.factory.createElement("MICROSOFTICON",{id:additionalMetadataIconId,key:additionalMetadataIconId,type:179,style:{color:"#3B79B7",padding:this._context.theming.measures.measure050}}),additionalMetadataTextId=additionalMetadataId+"Text_",textComponent=this._context.factory.createElement("LABEL",{id:"articleTitleText_"+kbSearchRecord.knowledgeArticleId.toString(),key:"articleTitleText_"+kbSearchRecord.knowledgeArticleId.toString(),title:additionalMetadataString,style:{lineHeight:"1"},accessibilityLabel:additionalMetadataString},additionalMetadataString),additionalMetadataContainerId=additionalMetadataId+"Container_"+kbSearchRecord.knowledgeArticleId.toString(),metadataComponent=this._context.factory.createElement("Container",{id:additionalMetadataContainerId,key:additionalMetadataContainerId,style:{display:"flex",width:"100%",alignItems:"center",fontSize:this._context.theming.fontsizes.font100,marginBottom:this._context.theming.measures.measure100,background:"#EFEFEF"}},[iconComponent,textComponent]);return this._context.factory.createElement("Container",{style:{marginBottom:this._context.theming.measures.measure050,marginLeft:this._context.client.isRTL?0:this._context.theming.measures.measure100,marginRight:this._context.client.isRTL?this._context.theming.measures.measure100:0,borderBottom:this.isEnableSelection&&isArticleClicked?"none":this._context.theming.borders.border01}},metadataComponent)};KbSearchResults.prototype.renderArticleMetadata=function(kbSearchRecord,articleState,additionalMetadataPresent){var isArticleClicked=false;if(this._clickKbArticleId===kbSearchRecord.knowledgeArticleId)isArticleClicked=true;if(this.KbSearchResultLegendsObject==null)this.KbSearchResultLegendsObject=new KbSearchControl.KbSearchResultLegends;this.KbSearchResultLegendsObject.init(this._context,null,articleState);var resultLegends=this.KbSearchResultLegendsObject.render(kbSearchRecord);return this._context.factory.createElement("Container",{id:"kbSearchResults.footer.id_"+kbSearchRecord.knowledgeArticleId.toString(),key:"kbSearchResults.footer",className:"mscrm-kbSearchResultFooter",style:{width:"calc(100% - "+this._context.theming.measures.measure350+')"',display:"flex",marginLeft:!this._searchUIEnhancementsEnabled?this._context.client.isRTL?0:this._context.theming.measures.measure100:!MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)?0:this._context.theming.measures.measure100,marginRight:!this._searchUIEnhancementsEnabled?this._context.client.isRTL?this._context.theming.measures.measure100:0:!MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)?0:this._context.theming.measures.measure100,whiteSpace:"normal",borderBottom:additionalMetadataPresent||this.isEnableSelection&&isArticleClicked?"none":this._context.theming.borders.border01,paddingBottom:this._context.theming.measures.measure050,position:"relative"}},resultLegends)};KbSearchResults.prototype.render=function(kbSearchRecord,isPopupControl,isExternalSearchIndexEnabled){this.setArticleSelectedAndHover();var resultDiv=this.renderSearchResultRow(kbSearchRecord,isPopupControl,isExternalSearchIndexEnabled);return this._context.factory.createElement("LISTITEM",{key:"kbSearchResults.searchResultDiv"+kbSearchRecord.knowledgeArticleId.toString(),absoluteId:"searchResultDiv"+kbSearchRecord.knowledgeArticleId,style:this._getStyles(kbSearchRecord.knowledgeArticleId),role:"listitem"},resultDiv)};KbSearchResults.prototype.getOutputs=function(){return null};KbSearchResults.prototype.destroy=function(){};KbSearchResults.prototype.onPreNavigation=function(){};KbSearchResults.prototype._onMouseEnterHandler=function(knowledgeArticleId,event){if(this.isEnableSelection){this._hoverKbArticleId=knowledgeArticleId;!this._searchUIEnhancementsEnabled&&this._context.utils.requestRender()}};KbSearchResults.prototype._onMouseLeaveHandler=function(event){if(this.isEnableSelection||this._searchUIEnhancementsEnabled){this._hoverKbArticleId="";!this._searchUIEnhancementsEnabled&&this._context.utils.requestRender()}};KbSearchResults.prototype._getStyles=function(knowledgeArticleId){var hoverStyle={backgroundColor:this._searchUIEnhancementsEnabled?"#F3F2F1":"#EFEFEF"},nonSelectedStyle={":hover":{backgroundColor:"#F3F2F1"}},selectedStyle={backgroundColor:this._searchUIEnhancementsEnabled?"#F0F5FF":"#C0D4E8"},normalStyle={};normalStyle.display=this._context.client.userAgent.isBrowserIE?"list-item":"inline-block";if(this.isEnableSelection||this._searchUIEnhancementsEnabled)if(this._clickKbArticleId===knowledgeArticleId&&this.isEnableSelection)return Object.assign({},selectedStyle,normalStyle);else if(this._searchUIEnhancementsEnabled)return Object.assign({},nonSelectedStyle,normalStyle);else if(this._hoverKbArticleId===knowledgeArticleId)return Object.assign({},hoverStyle,normalStyle);return normalStyle};KbSearchResults.prototype._articleContainerClick=function(kbSearchRecord,event){this._clickKbArticleId=kbSearchRecord.knowledgeArticleId;if(this._searchUIEnhancementsEnabled)this.renderArticleContent(kbSearchRecord,event);else this._stateManager.SetSelectedArticle(kbSearchRecord,this._context)};KbSearchResults.prototype._handleFocus=function(kbSearchRecord,keyEvent){if(!this._searchUIEnhancementsEnabled){this._clickKbArticleId=kbSearchRecord.knowledgeArticleId;this._stateManager.SetSelectedArticle(kbSearchRecord,this._context)}};KbSearchResults.prototype._setEnableSelection=function(){if(this._context.parameters.value.urlQueryParams&&this._context.parameters.value.urlQueryParams.enableSelection)this.isEnableSelection=true;else this.isEnableSelection=false};KbSearchResults.prototype._generatetHtmlElementsfromCrmhitText=function(crmHitText,htmlArray){if(htmlArray==null)htmlArray=[];if(!crmHitText)return htmlArray;var crmHitStartPos=crmHitText.indexOf(KbSearchControl.Constants.CrmHitStartTag);if(crmHitStartPos!=-1){var crmHitEndPos=crmHitText.indexOf(KbSearchControl.Constants.CrmHitEndTag),textOutsideCrmHit=crmHitText.slice(0,crmHitStartPos),textInsideCrmHit=crmHitText.slice(crmHitStartPos,crmHitEndPos+9);htmlArray.push(this._generateSpan(textOutsideCrmHit,false));htmlArray.push(this._generateSpan(this._removeCrmHitText(textInsideCrmHit),true));var truncatedstring=crmHitText.slice(crmHitEndPos+9,crmHitText.length);return this._generatetHtmlElementsfromCrmhitText(truncatedstring,htmlArray)}htmlArray.push(this._generateSpan(crmHitText,false));return htmlArray};KbSearchResults.prototype._generateSpan=function(text,isCrmHit){return this._context.factory.createElement("LABEL",{style:isCrmHit?Object.assign({},KbSearchControl.Constants.CrmHitStyle):Object.assign({},KbSearchControl.Constants.NormalStyle)},text)};KbSearchResults.prototype._removeCrmHitText=function(text){if(text.indexOf(KbSearchControl.Constants.CrmHitStartTag)!=-1)return text.replace(new RegExp(KbSearchControl.Constants.CrmHitStartTag,"g"),"").replace(new RegExp(KbSearchControl.Constants.CrmHitEndTag,"g"),"");return text};KbSearchResults.prototype.setArticleSelectedAndHover=function(){if(this._stateManager.GetSelectedArticle()==null){this._clickKbArticleId="";if(!this._searchUIEnhancementsEnabled)this._hoverKbArticleId=""}};KbSearchResults.prototype.getKATitleContent=function(kbSearchRecord){var _this_1=this,deferred=$.Deferred();MscrmControls.KbCommonUtils.ActionOperationUtils.GetFormattedContent(this._context,kbSearchRecord.knowledgeArticleId).done(function(response){kbSearchRecord.content=response;deferred.resolve(kbSearchRecord)}).fail(function(error){if(typeof error==="string"){kbSearchRecord.content=error;deferred.rejectWith(_this_1,[kbSearchRecord])}else{console.error(error);deferred.reject()}});return deferred.promise()};return KbSearchResults}();KbSearchControl.KbSearchResults=KbSearchResults})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var KbSearchResultStatus=function(){function KbSearchResultStatus(){}KbSearchResultStatus.prototype.init=function(context,notifyOutputChanged,state,container){this._context=context};KbSearchResultStatus.prototype.render=function(stateCode){var kbSearchResultStatusValue="",kbSearchResultStatusClass="";if(typeof stateCode==="string"){kbSearchResultStatusValue=this.sanitizeStatusString(stateCode);if(!kbSearchResultStatusValue)return}else switch(stateCode){case 0:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusDraft;kbSearchResultStatusClass="mscrm-kbSearchResultStatusInfo-Draft";break;case 1:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusApproved;kbSearchResultStatusClass="mscrm-kbSearchResultStatusInfo-Approved";break;case 2:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusScheduled;kbSearchResultStatusClass="mscrm-kbSearchResultStatusInfo-Scheduled";break;case 3:case 5:case 6:default:return}if(kbSearchResultStatusValue!="")kbSearchResultStatusClass="mscrm-kbSearchResultStatusInfo mscrm-kbSerachResultHeaderCell mscrm-ContentPaneArticleNameContainerCell "+kbSearchResultStatusClass;return this._context.factory.createElement("LABEL",{id:"KbSearchResultStatusid",key:"KbSearchResultStatus",className:kbSearchResultStatusClass,style:{color:this._context.theming.colors.base.orange,marginRight:"5px"}},kbSearchResultStatusValue)};KbSearchResultStatus.prototype.getStatusByStateCode=function(stateCode){var kbSearchResultStatusValue="";if(typeof stateCode==="string")return this.sanitizeStatusString(stateCode);switch(stateCode){case 0:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusDraft;break;case 1:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusApproved;break;case 2:kbSearchResultStatusValue=KbSearchControl.KbSearchControlLocale.ResultStatusScheduled;break;case 3:case 5:case 6:default:return}return kbSearchResultStatusValue};KbSearchResultStatus.prototype.sanitizeStatusString=function(stateString){var checkString=stateString.indexOf("[")===0&&stateString.indexOf("]")===stateString.length-1?stateString:"["+stateString+"]";switch(checkString){case KbSearchControl.KbSearchControlLocale.ResultStatusDraft:case KbSearchControl.KbSearchControlLocale.ResultStatusApproved:case KbSearchControl.KbSearchControlLocale.ResultStatusScheduled:return checkString;default:return}};KbSearchResultStatus.prototype.getOutputs=function(){return null};KbSearchResultStatus.prototype.destroy=function(){};KbSearchResultStatus.prototype.onPreNavigation=function(){};return KbSearchResultStatus}();KbSearchControl.KbSearchResultStatus=KbSearchResultStatus})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchBoxContainer=function(){function SearchBoxContainer(){this.minLettersToTriggerAutoSearch=4;this.searchBoxTypeTimeInterval=600;this.setTimeoutHandle=null;this.isFilterPaneVisible=false;this.isValidKeyEntered=true}SearchBoxContainer.prototype.onClearTextClicked=function(event){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"onClearTextClicked","");if(!this._context.parameters.value.isControlDisabled){document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_closeButton_")).style.display="none";if(!this.searchUIEnhancementsEnabled)document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_searchButton_")).style.display="block";this._stateManager.ExecuteKbSearchHelper.searchText="";this._context.parameters.value.executeUpdateCurrentSearchText(this._context.parameters.value.contextToken,"");this._context.parameters.value.currentSearchText="";this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch();this._stateManager.ExecuteKbSearchHelper.SearchHasBeenPerformed=false;this._stateManager.SetIsSearchMode(true,this._context);var searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.PopupPrefixId+KbSearchControl.Constants.SearchTextBoxId));if(searchTextBox)this._context.accessibility.focusElementById(KbSearchControl.Constants.PopupPrefixId+KbSearchControl.Constants.SearchTextBoxId);else this._context.accessibility.focusElementById(KbSearchControl.Constants.SearchTextBoxId)}KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"onClearTextClicked","")};SearchBoxContainer.prototype.onKeyDown=function(event){if(!this._context.parameters.value.isControlDisabled){if(event.key==="Enter"){this.handleSearchButtonClick(event);event.stopPropagation();event.preventDefault();this.setFocusOnSearchTextBox()}this.isValidKeyEntered=this.isValidKey(event.key)}};SearchBoxContainer.prototype.handleKeyDownPress=function(evt,keyEvent){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(evt._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"handleKeyDownPress","");if(keyEvent.keyCode==KbSearchControl.Constants.DownArrowKeyCode){var articleTitleID=evt._context.accessibility.getUniqueId("articleTitle"),articleIndex=$("[id="+articleTitleID+"]");if(articleIndex.length>0){articleIndex[0].focus();evt._stateManager.SetSelectedArticle(evt._stateManager.records[0],evt._context)}}KbSearchControl.TelemetryReporter.Instance.PostEndMarker(evt._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"handleKeyDownPress","")};SearchBoxContainer.prototype.handleCloseAndSearchIconsVisibilty=function(searchText){var searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.PopupPrefixId+KbSearchControl.Constants.SearchTextBoxId));if(!searchTextBox)searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.SearchTextBoxId));if(searchTextBox!=null){var showIcons=searchText;if(!showIcons){document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_closeButton_")).style.display="none";if(!this.searchUIEnhancementsEnabled)document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_searchButton_")).style.display="block";var closeButton=document.getElementById(this._context.accessibility.getUniqueId("popupmicrosoftIcon_closeButton_"));if(closeButton)closeButton.style.display="none";var searchButton=document.getElementById(this._context.accessibility.getUniqueId("popupmicrosoftIcon_searchButton_"));if(searchButton)searchButton.style.display="block"}else{document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_closeButton_")).style.display="block";if(!this.searchUIEnhancementsEnabled)document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_searchButton_")).style.display="none";var closeButton=document.getElementById(this._context.accessibility.getUniqueId("popupmicrosoftIcon_closeButton_"));if(closeButton)closeButton.style.display="block";var searchButton=document.getElementById(this._context.accessibility.getUniqueId("popupmicrosoftIcon_searchButton_"));if(searchButton)searchButton.style.display="none"}}};SearchBoxContainer.prototype.getSearchBox=function(){var searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.PopupPrefixId+KbSearchControl.Constants.SearchTextBoxId));if(!searchTextBox)searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.SearchTextBoxId));return searchTextBox};SearchBoxContainer.prototype.onTextBoxChanged=function(event){var _this=this;KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"onTextBoxChanged","");if(this.searchUIEnhancementsEnabled){this.inEditMode=true;document.getElementById(this._context.accessibility.getUniqueId("searchIconContainer")).style.display="none"}this._stateManager.ResetSelectedArticle();this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.ExecuteKbSearchHelper.searchText=event.target.value;var searchText=this._stateManager.ExecuteKbSearchHelper.searchText;this.handleCloseAndSearchIconsVisibilty(searchText);if(this.setTimeoutHandle!=null){window.clearTimeout(this.setTimeoutHandle);this.setTimeoutHandle=null}var isTypeAheadEnabled=!this._context.utils.isFeatureEnabled("April2020Update");if(isTypeAheadEnabled&&this._stateManager.ExecuteKbSearchHelper.searchText.length>=this.minLettersToTriggerAutoSearch&&this.isValidKeyEntered)this.setTimeoutHandle=setTimeout(function(){return _this.handleSearchButtonClick(event)},this.searchBoxTypeTimeInterval);if(this._stateManager.ExecuteKbSearchHelper.searchText.length==0){var searchRecordsCount=-1,isRelevanceSearchEnabled=this._context.utils.isFeatureEnabled(KbSearchControl.Constants.UCKMControlRelevanceSearch)&&this._stateManager.isExternalSearchIndexEnabled;if(isRelevanceSearchEnabled&&this._stateManager.relevanceSearchRecords!=null&&this._stateManager.relevanceSearchRecords.value!=null)searchRecordsCount=this._stateManager.relevanceSearchRecords.value.length;else if(this._stateManager.records!=null)searchRecordsCount=this._stateManager.records.length;if(!(searchRecordsCount>0)){this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch();this._stateManager.ExecuteKbSearchHelper.SearchHasBeenPerformed=false}}KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"onTextBoxChanged","")};SearchBoxContainer.prototype.handleSearchButtonClick=function(event){if(this.searchUIEnhancementsEnabled){this.inEditMode=false;document.getElementById(this._context.accessibility.getUniqueId("searchIconContainer")).style.display="inline-flex"}if(!this._context.parameters.value.isControlDisabled){KbSearchControl.PerformanceTelemetry.Instance.AddActionLogForUsageCalculations(KbSearchControl.TelemetryConstants.WATERMARK_ACTION_KBSEARCH_PERFORMED,this._context,true);this._stateManager.isMakeAdditionalCallToGetArticleDetails=true;this._stateManager.ResetSelectedArticle();this._stateManager.SetIsSearchMode(true,this._context);this._stateManager.ExecuteKbSearchHelper.ExecuteKbSearch();this._context.parameters.value.executeUpdateCurrentSearchText(this._context.parameters.value.contextToken,this.getSearchBox().value)}};SearchBoxContainer.prototype.handleFilterButtonClick=function(event){if(!this._context.parameters.value.isControlDisabled){this._stateManager.filtersVisible=!this._stateManager.filtersVisible;this._context.utils.requestRender()}};SearchBoxContainer.prototype.setFocusOnSearchTextBox=function(){var searchTextBoxNode;searchTextBoxNode="";searchTextBoxNode instanceof Element&&$(searchTextBoxNode).focus()};SearchBoxContainer.prototype.handleOnBlur=function(evt){if(this.searchUIEnhancementsEnabled)document.getElementById(this._context.accessibility.getUniqueId("searchIconContainer")).style.display=this.inEditMode?"none":"inline-flex"};SearchBoxContainer.prototype.handleOnFocus=function(evt){if(this.searchUIEnhancementsEnabled)document.getElementById(this._context.accessibility.getUniqueId("searchIconContainer")).style.display=this.inEditMode?"none":"inline-flex";var searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.PopupPrefixId+KbSearchControl.Constants.SearchTextBoxId));if(!searchTextBox)searchTextBox=document.getElementById(this._context.accessibility.getUniqueId(KbSearchControl.Constants.SearchTextBoxId));var searchTextBoxNode=searchTextBox,strLength=searchTextBoxNode.value.length;setTimeout(function(){searchTextBoxNode.setSelectionRange&&searchTextBoxNode.setSelectionRange(strLength,strLength)},0)};SearchBoxContainer.prototype.isValidKey=function(keyName){switch(keyName){case "ArrowRight":case "ArrowLeft":case "ArrowUp":case "ArrowDown":case "Tab":case "Shift":case "Control":case "Alt":case "Escape":case " ":case "End":case "Home":case "F2":case "F4":case "F9":case "F10":case "F12":case "CapsLock":case "Insert":case "PageDown":case "PageUp":return false;default:return true}};SearchBoxContainer.prototype.getInitialState=function(){return {currentText:""}};SearchBoxContainer.prototype.init=function(context,notifyOutputChanged,state,container){this._stateManager=KbSearchControl.StateManager.Instance(context.parameters.value.controlId);this._context=context;this.searchUIEnhancementsEnabled=MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)};SearchBoxContainer.prototype.renderSearchBoxContainer=function(isPopupControl){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"renderSearchBoxContainer","");var expandedRendering=isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode||this._stateManager.IsExpandedMode;if(KbSearchControl.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl.Constants.KMRefreshSearchUI))var searchTextBoxWidth="none";else var searchTextBoxWidth=this._stateManager.GetIsSearchMode()&&!expandedRendering?"calc(100% - "+this._context.theming.measures.measure225+" - "+this._context.theming.measures.measure125+")":"100%";var controlPrefix=isPopupControl?KbSearchControl.Constants.PopupPrefixId:"",searchTextBoxId=controlPrefix+KbSearchControl.Constants.SearchTextBoxId,textbox=this._context.factory.createElement("TextInput",{id:searchTextBoxId,key:searchTextBoxId,style:{borderStyle:"none",paddingLeft:!this.searchUIEnhancementsEnabled&&this._context.client.isRTL?0:this._context.theming.measures.measure050,paddingRight:this.searchUIEnhancementsEnabled||this._context.client.isRTL?this._context.theming.measures.measure050:0,fontSize:this._context.theming.fontsizes.font100,flexGrow:1,":focus":{outline:this.searchUIEnhancementsEnabled?"none !important":""},maxWidth:searchTextBoxWidth,"::-ms-clear":{display:"none"}},placeholder:KbSearchControl.KbSearchControlLocale.SearchBoxPlaceholder,onChange:this.onTextBoxChanged.bind(this),value:this._stateManager.ExecuteKbSearchHelper.searchText,disabled:this._context.parameters.value.isControlDisabled,onKeyPress:this.onKeyDown.bind(this),onKeyDown:this.handleKeyDownPress.bind(null,this),onFocus:this.handleOnFocus.bind(this),onBlur:this.handleOnBlur.bind(this),maxLength:2e3,accessibilityLabel:KbSearchControl.KbSearchControlLocale.SearchBoxAriaLabel}),isSearchIconHidden=!isPopupControl||!document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_searchButton_"))||document.getElementById(this._context.accessibility.getUniqueId("microsoftIcon_searchButton_")).style.display!=="none"?false:true,searchIconId=controlPrefix+"microsoftIcon_searchButton_",searchIcon=null;searchIcon=this._context.factory.createElement("MICROSOFTICON",{id:searchIconId,accessibilityLabel:KbSearchControl.KbSearchControlLocale.SearchIconAltText,title:KbSearchControl.KbSearchControlLocale.SearchIconAltText,tabIndex:0,style:{cursor:"pointer"},key:searchIconId,hidden:isSearchIconHidden,onKeyDown:this.handleSearchPress.bind(this),onClick:this.handleSearchButtonClick.bind(this),type:61,role:"button"});var closeIconId=controlPrefix+"microsoftIcon_closeButton_",closeIcon=this._context.factory.createElement("MICROSOFTICON",{id:closeIconId,tabIndex:0,accessibilityLabel:KbSearchControl.KbSearchControlLocale.RemoveIconAltText,title:KbSearchControl.KbSearchControlLocale.RemoveIconAltText,style:{cursor:"pointer"},key:closeIconId,hidden:!this.searchUIEnhancementsEnabled?!isSearchIconHidden:MscrmCommon.ControlUtils.String.isNullOrEmpty(this._stateManager.ExecuteKbSearchHelper.searchText),onKeyDown:this.handleClosePress.bind(this),onClick:this.onClearTextClicked.bind(this),type:97,role:"button"}),closeIconContainer=null,searchIconContainer=null;if(this.searchUIEnhancementsEnabled){searchIconContainer=this._context.factory.createElement("Container",{id:"searchIconContainer",key:"searchIconContainer",style:{display:"inline-flex",marginLeft:this._context.client.isRTL?0:this._context.theming.measures.measure050,marginRight:!this._context.client.isRTL?0:this._context.theming.measures.measure050,cursor:"pointer",fontSize:"16px",alignItems:"center"}},searchIcon);closeIconContainer=this._context.factory.createElement("Container",{id:"closeIconContainer",key:"closeIconContainer",style:{display:"inline-flex",marginRight:this._context.client.isRTL?0:this._context.theming.measures.measure050,marginLeft:!this._context.client.isRTL?0:this._context.theming.measures.measure050,cursor:"pointer",fontSize:"16px",alignItems:"center"}},closeIcon)}else searchIconContainer=this._context.factory.createElement("Container",{id:"searchIconContainer",key:"searchIconContainer",style:{display:"inline-flex",margin:this._context.theming.measures.measure050,cursor:"pointer",fontSize:"16px",alignItems:"center"}},[closeIcon,searchIcon]);var hiddenActionSpan=this._context.factory.createElement("LABEL",{id:"hiddenActionid",ref:"hiddenAction",style:{display:"none",fontSize:this._context.theming.fontsizes.font100},className:"mscrm-hiddenSpan"});if(KbSearchControl.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl.Constants.KMRefreshSearchUI))var searchContainerBoxWidth="100%";else var searchContainerBoxWidth=this._stateManager.GetIsSearchMode()&&!expandedRendering?"calc(100% - "+this._context.theming.measures.measure225+" - "+this._context.theming.measures.measure175+")":"100%";var resultList=this.searchUIEnhancementsEnabled?[searchIconContainer,textbox,closeIconContainer,hiddenActionSpan]:[textbox,searchIconContainer,hiddenActionSpan],result=this._context.factory.createElement("Container",{id:"searchBoxContainer",key:"searchBoxContainer",className:"mscrm-kbSearchBoxContainer",style:{marginTop:!this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:"",marginBottom:!this.searchUIEnhancementsEnabled?this._context.theming.measures.measure050:"",marginLeft:0,marginRight:0,border:this._context.theming.borders.border02,"flex-grow":1,display:"inline-flex",maxWidth:searchContainerBoxWidth,paddingBottom:this.searchUIEnhancementsEnabled?this._context.theming.measures.measure025:"",paddingTop:this.searchUIEnhancementsEnabled?this._context.theming.measures.measure025:""}},resultList);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"renderSearchBoxContainer","");return result};SearchBoxContainer.prototype.renderFilterIconContainer=function(isPopupControl){var titleText=KbSearchControl.KbSearchControlLocale.FilterOpenTitleText,filterAccessibilitylabel=KbSearchControl.KbSearchControlLocale.FilterText,filterIconId="microsoftIcon_filterButton_",filterIcon=this._context.factory.createElement("MICROSOFTICON",{id:filterIconId,key:filterIconId,type:44}),filterButton=this._context.factory.createElement("BUTTON",{id:"filterButton",key:"filterButton",style:{fontSize:"16px",background:"transparent",borderColor:"transparent",color:"#333333",":hover":{background:this._context.theming.colors.grays.gray01}},accessibilityLabel:filterAccessibilitylabel,tabIndex:0,hidden:false,onClick:this.handleFilterButtonClick.bind(this),title:titleText,accessibilityExpanded:this.isFilterPaneVisible},filterIcon);return this._context.factory.createElement("Container",{id:"filterIconContainer",key:"filterIconContainer",style:{display:"inline-flex",marginTop:"0.15rem",marginBottom:"0.15rem",marginLeft:this._context.client.isRTL?0:this._context.theming.measures.measure050,marginRight:this._context.client.isRTL?this._context.theming.measures.measure050:0,cursor:"pointer"}},filterButton)};SearchBoxContainer.prototype.render=function(isPopupControl){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"render","");var expandedRendering=isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode||this._stateManager.IsExpandedMode,searchBoxRowChildren=[];searchBoxRowChildren.push(this.renderSearchBoxContainer(isPopupControl));var searchText=this._stateManager.ExecuteKbSearchHelper.searchText;this.handleCloseAndSearchIconsVisibilty(searchText);var KMRefreshSearchUI=KbSearchControl.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl.Constants.KMRefreshSearchUI);this._stateManager.GetIsSearchMode()&&!expandedRendering&&!KMRefreshSearchUI&&searchBoxRowChildren.push(this.renderFilterIconContainer(isPopupControl));var result=this._context.factory.createElement("Container",{id:"rendersearchboxrow",key:"searchbox",style:{display:"flex",width:"100%",alignSelf:MscrmControls.KbCommonUtils.FCBUtil.IsFeatureEnabled(this._context,MscrmControls.KbCommonUtils.FCBUtil.SearchUIEnhancements)&&this._stateManager.IsExpandedMode?"center":"auto",flexdirection:"wrap",marginTop:MscrmControls.KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"0px":this._context.theming.measures.measure075,marginBottom:this._context.theming.measures.measure075,minHeight:this._context.theming.measures.measure225}},searchBoxRowChildren);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchBoxContainer,"render","");return result};SearchBoxContainer.prototype.handleSearchPress=function(event){if(!this._context.parameters.value.isControlDisabled)event.key==="Enter"&&this.handleSearchButtonClick(event)};SearchBoxContainer.prototype.handleClosePress=function(event){if(!this._context.parameters.value.isControlDisabled)if(event.key==="Enter"){event.stopPropagation();event.preventDefault();this.onClearTextClicked(event)}};SearchBoxContainer.prototype.handleFilterPress=function(event){if(!this._context.parameters.value.isControlDisabled)event.key==="Enter"&&this.handleFilterButtonClick(event)};SearchBoxContainer.prototype.getOutputs=function(){return null};SearchBoxContainer.prototype.destroy=function(){};SearchBoxContainer.prototype.onPreNavigation=function(){};return SearchBoxContainer}();KbSearchControl.SearchBoxContainer=SearchBoxContainer})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var SearchResultActionsDropdown=function(_super){__extends(SearchResultActionsDropdown,_super);function SearchResultActionsDropdown(){return _super!==null&&_super.apply(this,arguments)||this}SearchResultActionsDropdown.prototype.renderInlineActions=function(kbSearchRecord,isPopupControl,describedByElementId,articleActions){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"renderInlineActions","");var childrenActions=[],scrollingDataBlockContainerId=(isPopupControl?KbSearchControl.Constants.PopupPrefixId:"")+KbSearchControl.Constants.SearchAndDataBlockContainerId,scrollingDataBlockContainer=document.getElementById(this._context.accessibility.getUniqueId(scrollingDataBlockContainerId)),totalAvailableSpace=0;if(!scrollingDataBlockContainer)this._stateManager.requestAdditionalRendering=true;else totalAvailableSpace=scrollingDataBlockContainer.offsetWidth;if(isPopupControl&&!(isPopupControl&&this._stateManager.IsPopupRenderedInExpandedMode))totalAvailableSpace-=this.remToPixelConversion*2;totalAvailableSpace-=this.remToPixelConversion*3.5;if(articleActions.length>2&&!this.searchUIEnhancementsEnabled)totalAvailableSpace-=40;if(this.searchUIEnhancementsEnabled)for(var i=0;i<articleActions.length;i++){var actionId=articleActions[i],actionContainer=this.renderActionContainer(kbSearchRecord,describedByElementId,actionId,articleActions);childrenActions.push(actionContainer);this.renderActionFlags[i]=true}else for(var actionsLength=Math.min(articleActions.length,2),i=0;i<actionsLength;i++){var actionId=articleActions[i],actionLabel=this._context.resources.getString(this.getArticleActionToLabelNameMapping(actionId)),actionWidth=this.spaceAvailableForActionTitle(actionLabel,i==0?true:false);if(totalAvailableSpace-actionWidth>=0){var actionContainer=this.renderActionContainer(kbSearchRecord,describedByElementId,actionId,articleActions);childrenActions.push(actionContainer);this.renderActionFlags[i]=true;totalAvailableSpace-=actionWidth}else break}var result=this._context.factory.createElement("CONTAINER",{id:"searchResultActionsDropdownInlineActions_"+kbSearchRecord.knowledgeArticleId.toString(),key:"searchResultActionsDropdownInlineActions"},childrenActions);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"renderInlineActions","");return result};SearchResultActionsDropdown.prototype.renderActionContainer=function(kbSearchRecord,describedByElementId,articleActionId,articleActions){var _this=this;KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"renderActionContainer",""+articleActionId);var actionPosition=articleActions.indexOf(articleActionId),actionIcon=this.renderArticleActionIcon(kbSearchRecord,articleActionId,actionPosition==0,actionPosition==1),actionTitle=this.renderActionTitle(kbSearchRecord,articleActionId,articleActions,true),searchResultActionsDropdownActionLabel=this._context.resources.getString(this.getArticleActionToLabelNameMapping(articleActionId)),searchResultActionsDropdownActionTooltip=this.GetLocalizedActionTooltip(articleActionId),style;if(this.searchUIEnhancementsEnabled)if(this._stateManager.GetIsSearchMode()){style={display:"inline-flex",cursor:"pointer",color:"#333333",":hover":{color:MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION}};if(this.searchUIEnhancementsEnabled&&MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context))style.height="100%"}else{style={display:"inline-flex",cursor:"pointer",color:"#333333",":hover":{backgroundColor:MscrmControls.KbCommonUtils.Constants.BGCOLOR_ACTION}};if(!MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context)){style.paddingTop=this._context.theming.measures.measure050;style.paddingBottom=this._context.theming.measures.measure050}else style.height="100%"}else if(actionPosition==0&&(this._stateManager.GetIsSearchMode()||this._context.parameters.value.hideSearchOnRecordLoad)){style={display:"inline-flex",cursor:"pointer",color:"#333333",":hover":{color:KbSearchControl.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl.Constants.KMRefreshSearchUI)?MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION:"black"}};if(MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context))style.height="100%"}else{style={display:"inline-flex",cursor:"pointer",color:"#333333",borderLeft:this._context.client.isRTL?0:this._context.theming.borders.border02,borderRight:this._context.client.isRTL?this._context.theming.borders.border02:0,":hover":{color:KbSearchControl.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl.Constants.KMRefreshSearchUI)?MscrmControls.KbCommonUtils.Constants.COLOR_HOVER_ACTION:"black"}};if(MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context))style.height="100%"}var actionContainer=this._context.factory.createElement("CONTAINER",{id:"searchResultActionsDropdown_"+actionPosition+"_Action_"+kbSearchRecord.knowledgeArticleId.toString(),key:"searchResultActionsDropdownAction",style:style,tabIndex:0,role:"button",title:searchResultActionsDropdownActionTooltip,accessibilityLabel:searchResultActionsDropdownActionLabel,describedByElementId:describedByElementId,onKeyDown:function(event){_this.handleSearchResultActionsDropdownInlineActionKeyDown(event,articleActionId,kbSearchRecord,articleActions)},onClick:this.handleArticleActionClick.bind(this,articleActionId,kbSearchRecord,articleActions)},[actionIcon,actionTitle]);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"renderActionContainer",""+articleActionId);return actionContainer};SearchResultActionsDropdown.prototype.render=function(kbSearchRecord,isPopupControl,describedByElementId){KbSearchControl.TelemetryReporter.Instance.PostStartMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"render","");var style;this.renderActionFlags=[];var controlBlock=[],articleActions=this.getAvailableArticleActions(kbSearchRecord,isPopupControl);if(articleActions.length==0&&KbSearchControl.KbSearchUtil.IsFeatureEnabled(this._context,KbSearchControl.Constants.KMRefreshSearchUI))return null;articleActions&&articleActions.length>0&&controlBlock.push(this.renderInlineActions(kbSearchRecord,isPopupControl,describedByElementId,articleActions));articleActions.length-this.renderActionFlags.length>0&&controlBlock.push(this.renderMenuFlyout(kbSearchRecord,isPopupControl,describedByElementId,articleActions));if(this._stateManager.GetIsSearchMode())style={width:"100%",display:"flex",maxHeight:this._context.theming.measures.measure150};else{style={width:"100%",display:"flex"};if(this.searchUIEnhancementsEnabled&&MscrmControls.KbCommonUtils.CommonUtils.IsStandaloneMode(this._context))style.height=this._context.theming.measures.measure275}var result=this._context.factory.createElement("CONTAINER",{id:"searchResultActionsDropdown_"+kbSearchRecord.knowledgeArticleId.toString(),key:"searchResultActionsDropdown",style:style,className:"mscrm-searchResultActionsDropdown"},controlBlock);KbSearchControl.TelemetryReporter.Instance.PostEndMarker(this._context,KbSearchControl.Constants.WebresourceNameSearchResultActionsDropdown,"render","");return result};return SearchResultActionsDropdown}(KbSearchControl.SearchResultActionsBase);KbSearchControl.SearchResultActionsDropdown=SearchResultActionsDropdown})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var TelemetryReporter=function(){function TelemetryReporter(){this.eventStartMarkers={}}Object.defineProperty(TelemetryReporter,"Instance",{"get":function(){if(!TelemetryReporter.instance)TelemetryReporter.instance=new TelemetryReporter;return TelemetryReporter.instance},enumerable:true,configurable:true});TelemetryReporter.prototype.PostStartMarker=function(context,webResourceName,functionName,currentId,parentId){if(!context)return;if(context.parameters&&context.parameters.value&&context.parameters.value.entityReference&&context.parameters.value.entityReference.Id&&context.parameters.value.entityReference.Id.guid)currentId=context.parameters.value.entityReference.Id.guid;var telemetryevent=this.CreateTelemetryEvent(context,webResourceName,functionName,currentId,parentId),eventKey=webResourceName+"_"+functionName;this.eventStartMarkers[eventKey]=new Date;context.reporting.reportEvent(telemetryevent)};TelemetryReporter.prototype.PostEndMarker=function(context,webResourceName,functionName,currentId,parentId,isAsync){if(isAsync===void 0)isAsync=false;if(!context)return;var endTime=new Date;if(context.parameters&&context.parameters.value&&context.parameters.value.entityReference&&context.parameters.value.entityReference.Id&&context.parameters.value.entityReference.Id.guid)currentId=context.parameters.value.entityReference.Id.guid;var telemetryevent=this.CreateTelemetryEvent(context,webResourceName,functionName,currentId,parentId),eventKey=webResourceName+"_"+functionName;if(this.eventStartMarkers[eventKey]){var startTime=this.eventStartMarkers[eventKey],executionTime=endTime.getTime()-startTime.getTime();telemetryevent.eventParameters.push({name:"executionTime",value:executionTime});telemetryevent.eventParameters.push({name:"async",value:isAsync})}context.reporting.reportEvent(telemetryevent)};TelemetryReporter.prototype.CreateTelemetryEvent=function(context,webResourceName,functionName,currentId,parentId){var telemetryevent={eventName:"ServiceWebResources",eventParameters:[]};telemetryevent.eventParameters.push({name:"webResourceName",value:webResourceName});telemetryevent.eventParameters.push({name:"functionName",value:functionName});telemetryevent.eventParameters.push({name:"currentId",value:currentId});parentId&&parentId!=""&&telemetryevent.eventParameters.push({name:"parentId",value:parentId});telemetryevent.eventParameters.push({name:"userId",value:context.userSettings.userId});return telemetryevent};return TelemetryReporter}();KbSearchControl.TelemetryReporter=TelemetryReporter})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var TelemetryConstants=function(){function TelemetryConstants(){}TelemetryConstants.KBSEARCH_CONTROL_PERFORMANCE="KbSearchControlPerformance";TelemetryConstants.WATERMARK_ACTION_LOAD_KBSEARCH_CONTROL="Load_KBSearch_Control";TelemetryConstants.WATERMARK_ACTION_LOAD_SEARCH_RESULTS="Load_Search_Results";TelemetryConstants.WATERMARK_ACTION_OPEN_ARTICLE_TO_READ="Open_Article_To_Read";TelemetryConstants.WATERMARK_ACTION_LINK_KBARTICLE="Link_Knowledge_Article_To_Entity";TelemetryConstants.WATERMARK_ACTION_UNLINK_KBARTICLE="Unlink_Knowledge_Article_To_Entity";TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_CONTENT="Email_Article_Content";TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_URL="Email_Article_URL";TelemetryConstants.WATERMARK_ACTION_SEE_MORE_OPTION_CLICKED="SeeMore_Option_Clicked";TelemetryConstants.WATERMARK_ACTION_KBSEARCH_PERFORMED="KbSearch_Performed";TelemetryConstants.WATERMARK_ACTION_KBSEARCH_CONTROL_INITIALIZED="KBSearchControl_Initialized";TelemetryConstants.WATERMARK_ACTION_SORT_ORDER_CHANGED="Article_Sort_Order_Changed";TelemetryConstants.WATERMARK_ACTION_STATUS_FILTER_CHANGED="Article_Status_Filter_Changed";TelemetryConstants.WATERMARK_ACTION_LANGUAGE_FILTER_CHANGED="Article_Language_Filter_Changed";TelemetryConstants.WATERMARK_ACTION_POPOUT_KBARTICLE="Popout_Knowledge_Article_To_New_Window";return TelemetryConstants}();KbSearchControl.TelemetryConstants=TelemetryConstants})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var PerformanceTelemetry=function(){function PerformanceTelemetry(){this.perfEndMarkerCallbacks={}}Object.defineProperty(PerformanceTelemetry,"Instance",{"get":function(){if(!PerformanceTelemetry.instance)PerformanceTelemetry.instance=new PerformanceTelemetry;return PerformanceTelemetry.instance},enumerable:true,configurable:true});PerformanceTelemetry.prototype.GetStopwatchKeys=function(){return Object.keys(this.perfEndMarkerCallbacks)};PerformanceTelemetry.prototype.AddStartMarker=function(eventId,context){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];var key=eventId+params.join("");this.perfEndMarkerCallbacks[key]=this.perfEndMarkerCallbacks[key]||context.performance.createPerformanceStopwatch(eventId)};PerformanceTelemetry.prototype.AddEndMarker=function(eventId,context){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];var key=eventId+params.join("");if(this.perfEndMarkerCallbacks[key]){this.perfEndMarkerCallbacks[key]();delete this.perfEndMarkerCallbacks[key]}};PerformanceTelemetry.prototype.AddActionLogForUsageCalculations=function(actionName,context){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];var event={eventName:"KbSearchControlUsage",eventParameters:[]};event.eventParameters.push({name:"ActionName",value:actionName});event.eventParameters.push({name:"UserId",value:context.userSettings.userId});if(actionName===KbSearchControl.TelemetryConstants.WATERMARK_ACTION_KBSEARCH_PERFORMED&&params.length>0)event.eventParameters.push({name:"IsManualSearch",value:params[0]});else if(actionName===KbSearchControl.TelemetryConstants.WATERMARK_ACTION_OPEN_ARTICLE_TO_READ&&params.length>0)event.eventParameters.push({name:"KbArticleIndex",value:params[0]});else if(actionName===KbSearchControl.TelemetryConstants.WATERMARK_ACTION_SORT_ORDER_CHANGED&&params.length>0)event.eventParameters.push({name:"SelectedSortOrder",value:params[0]});else if(actionName===KbSearchControl.TelemetryConstants.WATERMARK_ACTION_STATUS_FILTER_CHANGED&&params.length>0)event.eventParameters.push({name:"SelectedStatusFilter",value:params[0]});else actionName===KbSearchControl.TelemetryConstants.WATERMARK_ACTION_LANGUAGE_FILTER_CHANGED&&params.length>0&&event.eventParameters.push({name:"SelectedLanguageFilter",value:params[0]});context&&context.reporting.reportEvent(event)};PerformanceTelemetry.prototype.AddErrorLog=function(context,errorMessage,errorDetails){var event={eventName:"KbSearchControlError",eventParameters:[]};event.eventParameters.push({name:"ErrorMessage",value:errorMessage});event.eventParameters.push({name:"ErrorDetails",value:errorDetails});context&&context.reporting.reportEvent(event)};return PerformanceTelemetry}();KbSearchControl.PerformanceTelemetry=PerformanceTelemetry})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){var KbSearchUtil=function(){function KbSearchUtil(){}KbSearchUtil.IsHostedInFormContext=function(context){return !MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.page.entityTypeName)&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.page.entityId)};KbSearchUtil.isCustomerEnabledForCurrentWave=function(context){if(context.utils.isFeatureEnabled(this.CurrentWave))return true};KbSearchUtil.IsFeatureEnabled=function(context,feature){if(context.utils.isFeatureEnabled(feature)&&this.isCustomerEnabledForCurrentWave(context))return true;else return false};KbSearchUtil.CurrentWave="October2019Update";return KbSearchUtil}();KbSearchControl.KbSearchUtil=KbSearchUtil})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbSearchControl;(function(KbSearchControl){"use strict";var StateUtil=function(){function StateUtil(){}StateUtil.SaveState=function(context,stateManager){var searchState=new KbSearchControl.SearchState;stateManager.saveState(searchState);context.mode.setControlState({searchState:searchState},false,true)};StateUtil.RestoreState=function(context,stateManager,state){state&&state.searchState&&stateManager.restoreState(state.searchState)};return StateUtil}();KbSearchControl.StateUtil=StateUtil})(KbSearchControl=MscrmControls.KbSearchControl||(MscrmControls.KbSearchControl={}))})(MscrmControls||(MscrmControls={}))