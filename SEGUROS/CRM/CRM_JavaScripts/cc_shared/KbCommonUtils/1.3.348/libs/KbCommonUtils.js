var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return {value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}t[2]&&_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return {value:op[0]?op[1]:void 0,done:true}}},MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOperationBase=function(){function ActionOperationBase(){}ActionOperationBase.prototype.ParseValidationRawPayload=function(operationPayload){var payload=new KbCommonUtils.ActionPayload;payload.ControlContext=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ControlContext,operationPayload);payload.ControlType=KbCommonUtils.TelemetryControlType.KbSearchControl;payload.KnowledgeArticleId=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KnowledgeArticleId,operationPayload);payload.Title=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KnowledgeArticleTitle,operationPayload);payload.IsSearchScenario=KbCommonUtils.ActionOperationUtils.GetActionSource(operationPayload)==KbCommonUtils.ActionSource.Search?true:false;payload.Record=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.Record,operationPayload);payload.StateManager=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.StateManager,operationPayload);payload.IsLoadedInProductivityPane=KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(payload.ControlContext)?true:false;payload[KbCommonUtils.Constants.KmPrivileges]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KmPrivileges,operationPayload);payload[KbCommonUtils.Constants.ExternalKMPortalURL]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ExternalKMPortalURL,operationPayload);payload[KbCommonUtils.Constants.ArticlePublicNumber]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ArticlePublicNumber,operationPayload);payload[KbCommonUtils.Constants.UseExternalKMPortal]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.UseExternalKMPortal,operationPayload);payload[KbCommonUtils.Constants.StateCode]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.StateCode,operationPayload);payload[KbCommonUtils.Constants.IsAssociated]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsAssociatedWithKnowledgeArticle,operationPayload);payload[KbCommonUtils.Constants.IsRelevanceSearchEnabled]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsRelevanceSearchEnabled,operationPayload);return payload};ActionOperationBase.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred(),actionPayload=new KbCommonUtils.ActionPayload;actionPayload.ControlContext=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ControlContext,operationPayload);actionPayload.KnowledgeArticleId=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KnowledgeArticleId,operationPayload);actionPayload.Title=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KnowledgeArticleTitle,operationPayload);actionPayload.IsSearchScenario=KbCommonUtils.ActionOperationUtils.GetActionSource(operationPayload)==KbCommonUtils.ActionSource.Search?true:false;actionPayload.IsLoadedInProductivityPane=KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(actionPayload.ControlContext)?true:false;actionPayload.Record=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.Record,operationPayload);actionPayload.StateManager=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.StateManager,operationPayload);actionPayload[KbCommonUtils.Constants.IsRelevanceSearchEnabled]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsRelevanceSearchEnabled,operationPayload);actionPayload[KbCommonUtils.Constants.WebresourceNameArticleActions]=KbCommonUtils.TelemetryConstants.WebresourceNameKbSearchActions;actionPayload.ControlType=KbCommonUtils.TelemetryControlType.KbSearchControl;contentPromise.resolve(actionPayload);return contentPromise.promise()};ActionOperationBase.prototype.ValidateOperation=function(validationPayload){return true};ActionOperationBase.prototype.PreExecuteOperation=function(operationPayload){var contentPromise=$.Deferred();contentPromise.resolve(new KbCommonUtils.ActionOutput);return contentPromise.promise()};ActionOperationBase.prototype.ExecuteOperation=function(operationPayload){var contentPromise=$.Deferred();contentPromise.resolve(new KbCommonUtils.ActionOutput);return contentPromise.promise()};ActionOperationBase.prototype.PostExecuteOperation=function(operationPayload){var contentPromise=$.Deferred();contentPromise.resolve(new KbCommonUtils.ActionOutput);return contentPromise.promise()};ActionOperationBase.prototype.GetActionOutput=function(status,operationPayload,error){var actionOutput=new KbCommonUtils.ActionOutput;actionOutput.status=status;return actionOutput};ActionOperationBase.prototype.SuccessCallbackAction=function(operationPayload,response){};ActionOperationBase.prototype.FailureCallbackAction=function(operationPayload,error){};return ActionOperationBase}();KbCommonUtils.ActionOperationBase=ActionOperationBase})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionCallbackFactory=function(){function ActionCallbackFactory(){}ActionCallbackFactory.Register=function(articleAction,callback){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(ActionCallbackFactory.callbackList[articleAction])){ActionCallbackFactory.callbackList[articleAction]=callback;return true}return false};ActionCallbackFactory.prototype.GetActionCallback=function(articleAction){var callback=ActionCallbackFactory.callbackList[articleAction];if(callback)return callback;var dummyCallback={successCallback:function(operationPayload,response){},failureCallback:function(operationPayload,error){}};return function(){return dummyCallback}};ActionCallbackFactory.Instance=new ActionCallbackFactory;ActionCallbackFactory.callbackList={};return ActionCallbackFactory}();KbCommonUtils.ActionCallbackFactory=ActionCallbackFactory})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionProperty;(function(ActionProperty){ActionProperty[ActionProperty["KnowledgeArticleId"]=0]="KnowledgeArticleId";ActionProperty[ActionProperty["KnowledgeArticleTitle"]=1]="KnowledgeArticleTitle";ActionProperty[ActionProperty["ExternalKMPortalURL"]=2]="ExternalKMPortalURL";ActionProperty[ActionProperty["ArticlePublicNumber"]=3]="ArticlePublicNumber";ActionProperty[ActionProperty["BrowserType"]=4]="BrowserType";ActionProperty[ActionProperty["AssociatedEntityReference"]=5]="AssociatedEntityReference";ActionProperty[ActionProperty["AssociatedEntityTypeName"]=6]="AssociatedEntityTypeName";ActionProperty[ActionProperty["AssociatedEntityId"]=7]="AssociatedEntityId";ActionProperty[ActionProperty["AssociationRelationshipName"]=8]="AssociationRelationshipName";ActionProperty[ActionProperty["FetchApiWrapper"]=9]="FetchApiWrapper";ActionProperty[ActionProperty["IsAssociatedWithKnowledgeArticle"]=10]="IsAssociatedWithKnowledgeArticle";ActionProperty[ActionProperty["SearchProviderType"]=11]="SearchProviderType";ActionProperty[ActionProperty["ResourceUri"]=12]="ResourceUri";ActionProperty[ActionProperty["ControlContext"]=13]="ControlContext";ActionProperty[ActionProperty["ArticleContentToEmail"]=14]="ArticleContentToEmail";ActionProperty[ActionProperty["IsExternalSearchIndexEnabled"]=15]="IsExternalSearchIndexEnabled";ActionProperty[ActionProperty["PrimaryCustomerForEmail"]=16]="PrimaryCustomerForEmail";ActionProperty[ActionProperty["IsLoadedInProductivityPanel"]=17]="IsLoadedInProductivityPanel";ActionProperty[ActionProperty["ShowResultNotification"]=18]="ShowResultNotification";ActionProperty[ActionProperty["ActionOperationCallback"]=19]="ActionOperationCallback";ActionProperty[ActionProperty["SuggestionForEntityId"]=20]="SuggestionForEntityId";ActionProperty[ActionProperty["SuggestionForEntityLogicalName"]=21]="SuggestionForEntityLogicalName";ActionProperty[ActionProperty["SuggestionRequestId"]=22]="SuggestionRequestId";ActionProperty[ActionProperty["ActionName"]=23]="ActionName";ActionProperty[ActionProperty["Feedback"]=24]="Feedback";ActionProperty[ActionProperty["RefreshCallback"]=25]="RefreshCallback";ActionProperty[ActionProperty["KmPrivileges"]=26]="KmPrivileges";ActionProperty[ActionProperty["UseExternalKMPortal"]=27]="UseExternalKMPortal";ActionProperty[ActionProperty["StateCode"]=28]="StateCode";ActionProperty[ActionProperty["StateManager"]=29]="StateManager";ActionProperty[ActionProperty["Record"]=30]="Record";ActionProperty[ActionProperty["IsRelevanceSearchEnabled"]=31]="IsRelevanceSearchEnabled";ActionProperty[ActionProperty["UserId"]=32]="UserId";ActionProperty[ActionProperty["LocDictionary"]=33]="LocDictionary"})(ActionProperty=KbCommonUtils.ActionProperty||(KbCommonUtils.ActionProperty={}));var ActionInputAccessorBase=function(){function ActionInputAccessorBase(){this.GetterMapping=null}ActionInputAccessorBase.GetProperty=function(property,operationPayload){var accessor=ActionInputAccessorBase.GetAccessor(operationPayload);return accessor.GetProperty(property,operationPayload)};ActionInputAccessorBase.GetAccessor=function(operationPayload){var actionSource=KbCommonUtils.ActionOperationUtils.GetActionSource(operationPayload),accessor=null;switch(actionSource){case KbCommonUtils.ActionSource.Suggestion:accessor=KbCommonUtils.SuggestionActionInputAccessor.Instance;break;case KbCommonUtils.ActionSource.Search:case KbCommonUtils.ActionSource.Unknown:accessor=KbCommonUtils.SearchActionInputAccessor.Instance}return accessor};ActionInputAccessorBase.prototype.GetProperty=function(property,operationPayload){this.InitializeGetterMapping();var getterFun=this.GetterMapping[property.toString()];return getterFun(operationPayload)};ActionInputAccessorBase.prototype.InitializeGetterMapping=function(){if(this.GetterMapping!=null)return;this.GetterMapping={};this.GetterMapping[ActionProperty.KnowledgeArticleId]=this.GetKnowledgeArticleId;this.GetterMapping[ActionProperty.KnowledgeArticleTitle]=this.GetKnowledgeArticleTitle;this.GetterMapping[ActionProperty.ExternalKMPortalURL]=this.GetExternalKMPortalURL;this.GetterMapping[ActionProperty.ArticlePublicNumber]=this.GetArticlePublicNumber;this.GetterMapping[ActionProperty.BrowserType]=this.GetBrowserType;this.GetterMapping[ActionProperty.AssociatedEntityReference]=this.GetAssociatedEntityReference;this.GetterMapping[ActionProperty.AssociatedEntityTypeName]=this.GetAssociatedEntityTypeName;this.GetterMapping[ActionProperty.AssociatedEntityId]=this.GetAssociatedEntityId;this.GetterMapping[ActionProperty.AssociationRelationshipName]=this.GetAssociationRelationshipName;this.GetterMapping[ActionProperty.FetchApiWrapper]=this.GetFetchApiWrapper;this.GetterMapping[ActionProperty.IsAssociatedWithKnowledgeArticle]=this.GetIsAssociatedWithKnowledgeArticle;this.GetterMapping[ActionProperty.SearchProviderType]=this.GetSearchProviderType;this.GetterMapping[ActionProperty.ResourceUri]=this.GetResourceUri;this.GetterMapping[ActionProperty.ControlContext]=this.GetControlContext;this.GetterMapping[ActionProperty.ArticleContentToEmail]=this.GetArticleContentToEmail;this.GetterMapping[ActionProperty.IsExternalSearchIndexEnabled]=this.GetIsExternalSearchIndexEnabled;this.GetterMapping[ActionProperty.PrimaryCustomerForEmail]=this.GetPrimaryCustomerForEmail;this.GetterMapping[ActionProperty.IsLoadedInProductivityPanel]=this.GetIsLoadedInProductivityPanel;this.GetterMapping[ActionProperty.ShowResultNotification]=this.GetShowResultNotification;this.GetterMapping[ActionProperty.ActionOperationCallback]=this.GetActionOperationCallback;this.GetterMapping[ActionProperty.SuggestionForEntityId]=this.GetSuggestionForEntityId;this.GetterMapping[ActionProperty.SuggestionForEntityLogicalName]=this.GetSuggestionForEntityLogicalName;this.GetterMapping[ActionProperty.SuggestionRequestId]=this.GetSuggestionRequestId;this.GetterMapping[ActionProperty.ActionName]=this.GetActionName;this.GetterMapping[ActionProperty.Feedback]=this.GetFeedback;this.GetterMapping[ActionProperty.RefreshCallback]=this.GetRefreshCallback;this.GetterMapping[ActionProperty.KmPrivileges]=this.GetKmPrivileges;this.GetterMapping[ActionProperty.UseExternalKMPortal]=this.GetUseExternalKMPortal;this.GetterMapping[ActionProperty.StateCode]=this.GetStateCode;this.GetterMapping[ActionProperty.StateManager]=this.GetStateManager;this.GetterMapping[ActionProperty.Record]=this.GetRecord;this.GetterMapping[ActionProperty.IsRelevanceSearchEnabled]=this.GetIsRelevanceSearchEnabled;this.GetterMapping[ActionProperty.UserId]=this.GetUserId;this.GetterMapping[ActionProperty.LocDictionary]=this.GetLocDictionary};return ActionInputAccessorBase}();KbCommonUtils.ActionInputAccessorBase=ActionInputAccessorBase})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SearchActionInputAccessor=function(_super){__extends(SearchActionInputAccessor,_super);function SearchActionInputAccessor(){return _super!==null&&_super.apply(this,arguments)||this}SearchActionInputAccessor.prototype.GetKnowledgeArticleId=function(operationPayload){return operationPayload.record.knowledgeArticleId};SearchActionInputAccessor.prototype.GetKnowledgeArticleTitle=function(operationPayload){return operationPayload.record.title};SearchActionInputAccessor.prototype.GetExternalKMPortalURL=function(operationPayload){return operationPayload.externalKMPortalURL};SearchActionInputAccessor.prototype.GetArticlePublicNumber=function(operationPayload){return operationPayload.record.articlePublicNumber};SearchActionInputAccessor.prototype.GetBrowserType=function(operationPayload){return KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.controlContext.client.userAgent)};SearchActionInputAccessor.prototype.GetAssociatedEntityReference=function(operationPayload){return operationPayload.controlContext.parameters.value?operationPayload.controlContext.parameters.value.entityReference:null};SearchActionInputAccessor.prototype.GetAssociatedEntityTypeName=function(operationPayload){return operationPayload.controlContext.page.entityTypeName};SearchActionInputAccessor.prototype.GetAssociatedEntityId=function(operationPayload){return operationPayload.controlContext.parameters.value&&operationPayload.controlContext.parameters.value.entityReference?operationPayload.controlContext.parameters.value.entityReference.Id.guid:Guid.EMPTY};SearchActionInputAccessor.prototype.GetAssociationRelationshipName=function(operationPayload){return operationPayload.stateManager&&operationPayload.stateManager.relations?operationPayload.stateManager.relations.SchemaName:""};SearchActionInputAccessor.prototype.GetFetchApiWrapper=function(operationPayload){return operationPayload.fetchApiWrapper};SearchActionInputAccessor.prototype.GetIsAssociatedWithKnowledgeArticle=function(operationPayload){return operationPayload.record.isAssociated};SearchActionInputAccessor.prototype.GetSearchProviderType=function(operationPayload){return operationPayload.record.searchProviderType};SearchActionInputAccessor.prototype.GetResourceUri=function(operationPayload){return operationPayload.record.resourceUri};SearchActionInputAccessor.prototype.GetControlContext=function(operationPayload){return operationPayload.controlContext};SearchActionInputAccessor.prototype.GetArticleContentToEmail=function(operationPayload){return operationPayload.record.content};SearchActionInputAccessor.prototype.GetIsExternalSearchIndexEnabled=function(operationPayload){return operationPayload.isExternalSearchIndexEnabled};SearchActionInputAccessor.prototype.GetPrimaryCustomerForEmail=function(operationPayload){return operationPayload.controlContext.parameters.value?operationPayload.controlContext.parameters.value.descriptors.selectPrimaryCustomer:""};SearchActionInputAccessor.prototype.GetIsLoadedInProductivityPanel=function(operationPayload){return KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(operationPayload.controlContext)};SearchActionInputAccessor.prototype.GetKmPrivileges=function(operationPayload){return operationPayload.kmPrivileges};SearchActionInputAccessor.prototype.GetUseExternalKMPortal=function(operationPayload){return operationPayload.useExternalKMPortal};SearchActionInputAccessor.prototype.GetStateCode=function(operationPayload){return operationPayload.record.stateCode};SearchActionInputAccessor.prototype.GetStateManager=function(operationPayload){return operationPayload.stateManager};SearchActionInputAccessor.prototype.GetRecord=function(operationPayload){return operationPayload.record};SearchActionInputAccessor.prototype.GetIsRelevanceSearchEnabled=function(operationPayload){return operationPayload.controlContext.utils.isFeatureEnabled(KbCommonUtils.Constants.UCKMControlRelevanceSearch)&&operationPayload.isExternalSearchIndexEnabled};SearchActionInputAccessor.prototype.GetShowResultNotification=function(operationPayload){return true};SearchActionInputAccessor.prototype.GetActionOperationCallback=function(operationPayload){return operationPayload.actionOperationCallback?operationPayload.actionOperationCallback():null};SearchActionInputAccessor.prototype.GetSuggestionForEntityId=function(operationPayload){return Guid.EMPTY};SearchActionInputAccessor.prototype.GetSuggestionForEntityLogicalName=function(operationPayload){return ""};SearchActionInputAccessor.prototype.GetSuggestionRequestId=function(operationPayload){return Guid.EMPTY};SearchActionInputAccessor.prototype.GetActionName=function(operationPayload){return ""};SearchActionInputAccessor.prototype.GetFeedback=function(operationPayload){return KbCommonUtils.FeedbackOptions.NotAvailable};SearchActionInputAccessor.prototype.GetRefreshCallback=function(operationPayload){return null};SearchActionInputAccessor.prototype.GetUserId=function(operationPayload){return operationPayload.record.systemUserId};SearchActionInputAccessor.prototype.GetLocDictionary=function(operationPayload){return ""};SearchActionInputAccessor.Instance=new SearchActionInputAccessor;return SearchActionInputAccessor}(KbCommonUtils.ActionInputAccessorBase);KbCommonUtils.SearchActionInputAccessor=SearchActionInputAccessor})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionActionInputAccessor=function(_super){__extends(SuggestionActionInputAccessor,_super);function SuggestionActionInputAccessor(){return _super!==null&&_super.apply(this,arguments)||this}SuggestionActionInputAccessor.prototype.GetKnowledgeArticleId=function(operationPayload){return operationPayload.customActionParams.KnowledgeArticleId};SuggestionActionInputAccessor.prototype.GetKnowledgeArticleTitle=function(operationPayload){return operationPayload.customActionParams.Title};SuggestionActionInputAccessor.prototype.GetExternalKMPortalURL=function(operationPayload){return operationPayload.customActionParams.ExternalKMPortalURL};SuggestionActionInputAccessor.prototype.GetArticlePublicNumber=function(operationPayload){return operationPayload.customActionParams.ArticlePublicNumber};SuggestionActionInputAccessor.prototype.GetBrowserType=function(operationPayload){return KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.controlContext.client.userAgent)};SuggestionActionInputAccessor.prototype.GetAssociatedEntityReference=function(operationPayload){var entityRef={Id:{}};entityRef.Id["guid"]=SuggestionActionInputAccessor.Instance.GetAssociatedEntityId(operationPayload);entityRef["LogicalName"]=SuggestionActionInputAccessor.Instance.GetAssociatedEntityTypeName(operationPayload);return entityRef};SuggestionActionInputAccessor.prototype.GetAssociatedEntityTypeName=function(operationPayload){var tabcontext=operationPayload[KbCommonUtils.Constants.TabContext];return tabcontext?tabcontext.entityName:""};SuggestionActionInputAccessor.prototype.GetAssociatedEntityId=function(operationPayload){var entityId="";if(operationPayload.customActionParams.SuggestionForEntityId!=null)entityId=operationPayload.customActionParams.SuggestionForEntityId;else{var tabcontext=operationPayload[KbCommonUtils.Constants.TabContext];entityId=tabcontext?KbCommonUtils.SuggestionActionUtils.GetEntityId(tabcontext):Guid.EMPTY.toString()}return entityId};SuggestionActionInputAccessor.prototype.GetAssociationRelationshipName=function(operationPayload){return ""};SuggestionActionInputAccessor.prototype.GetFetchApiWrapper=function(operationPayload){return null};SuggestionActionInputAccessor.prototype.GetIsAssociatedWithKnowledgeArticle=function(operationPayload){return operationPayload.customActionParams.IsAssociated};SuggestionActionInputAccessor.prototype.GetSearchProviderType=function(operationPayload){return KbCommonUtils.SearchProviderType.InternalDynamicsOrg};SuggestionActionInputAccessor.prototype.GetResourceUri=function(operationPayload){return ""};SuggestionActionInputAccessor.prototype.GetControlContext=function(operationPayload){return operationPayload.controlContext};SuggestionActionInputAccessor.prototype.GetArticleContentToEmail=function(operationPayload){return operationPayload.customActionParams.ContentToMail};SuggestionActionInputAccessor.prototype.GetIsExternalSearchIndexEnabled=function(operationPayload){return false};SuggestionActionInputAccessor.prototype.GetPrimaryCustomerForEmail=function(operationPayload){return null};SuggestionActionInputAccessor.prototype.GetIsLoadedInProductivityPanel=function(operationPayload){return true};SuggestionActionInputAccessor.prototype.GetKmPrivileges=function(operationPayload){return operationPayload.customActionParams.KmPrivileges};SuggestionActionInputAccessor.prototype.GetUseExternalKMPortal=function(operationPayload){return operationPayload.customActionParams.UseExternalPortalUrl};SuggestionActionInputAccessor.prototype.GetStateCode=function(operationPayload){return operationPayload.customActionParams.StateCode};SuggestionActionInputAccessor.prototype.GetStateManager=function(operationPayload){return ""};SuggestionActionInputAccessor.prototype.GetRecord=function(operationPayload){return ""};SuggestionActionInputAccessor.prototype.GetIsRelevanceSearchEnabled=function(operationPayload){return null};SuggestionActionInputAccessor.prototype.GetShowResultNotification=function(operationPayload){return false};SuggestionActionInputAccessor.prototype.GetActionOperationCallback=function(operationPayload){return ""};SuggestionActionInputAccessor.prototype.GetSuggestionForEntityId=function(operationPayload){return operationPayload.customActionParams.SuggestionForEntityId};SuggestionActionInputAccessor.prototype.GetSuggestionForEntityLogicalName=function(operationPayload){return operationPayload.customActionParams.SuggestionForEntityLogicalName};SuggestionActionInputAccessor.prototype.GetSuggestionRequestId=function(operationPayload){return operationPayload.customActionParams.SuggestionRequestId};SuggestionActionInputAccessor.prototype.GetActionName=function(operationPayload){return operationPayload.customActionParams.ActionName};SuggestionActionInputAccessor.prototype.GetFeedback=function(operationPayload){return operationPayload.customActionParams.Feedback};SuggestionActionInputAccessor.prototype.GetRefreshCallback=function(operationPayload){return operationPayload.refreshCallback};SuggestionActionInputAccessor.prototype.GetUserId=function(operationPayload){var userId="";try{var guid=operationPayload.controlContext.userSettings.userId.toLocaleLowerCase();if(userId.indexOf("{")!=-1)userId=guid.substring(guid.lastIndexOf("{")+1,guid.lastIndexOf("}"))}catch(error){console.log(error)}return userId};SuggestionActionInputAccessor.prototype.GetLocDictionary=function(operationPayload){return operationPayload.controlContext.parameters.LocString?operationPayload.controlContext.parameters.LocString.raw:null};SuggestionActionInputAccessor.Instance=new SuggestionActionInputAccessor;return SuggestionActionInputAccessor}(KbCommonUtils.ActionInputAccessorBase);KbCommonUtils.SuggestionActionInputAccessor=SuggestionActionInputAccessor})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var CTIActionOperation=function(_super){__extends(CTIActionOperation,_super);function CTIActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(CTIActionOperation.prototype,"Label",{"get":function(){return "KMControl.SearchKMArticles.SendToCTILabel"},enumerable:false,configurable:true});Object.defineProperty(CTIActionOperation.prototype,"Tooltip",{"get":function(){return "KMControl.SearchKMArticles.SendToCTITooltip"},enumerable:false,configurable:true});Object.defineProperty(CTIActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SendEmail},enumerable:false,configurable:true});CTIActionOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(payload){payload[KbCommonUtils.Constants.UseExternalKMPortal]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.UseExternalKMPortal,operationPayload);payload[KbCommonUtils.Constants.ExternalKMPortalURL]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ExternalKMPortalURL,operationPayload);payload[KbCommonUtils.Constants.ArticlePublicNumber]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ArticlePublicNumber,operationPayload);payload.Title=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KnowledgeArticleTitle,operationPayload);payload.ControlContext=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ControlContext,operationPayload);contentPromise.resolve(payload)});return contentPromise.promise()};CTIActionOperation.prototype.ValidateOperation=function(validationPayload){if(validationPayload.IsSearchScenario&&(KbCommonUtils.CommonUtils.IsArticleOpenInMultisessionAppTab(validationPayload.ControlContext)||KbCommonUtils.CommonUtils.IsHostedInMultisessionStandaloneMode(validationPayload.ControlContext)||KbCommonUtils.CommonUtils.IsMultisessionHost(validationPayload.ControlContext)&&(!validationPayload[KbCommonUtils.Constants.UseExternalKMPortal]||!KbCommonUtils.CommonUtils.IsEntityTypeConversation(validationPayload.ControlContext))))return false;return window&&window.top&&window.top["Microsoft"]&&window.top["Microsoft"].hasOwnProperty("CIFramework")&&window.top["Microsoft"]["CIFramework"].hasOwnProperty("External")||false};CTIActionOperation.prototype.PreExecuteOperation=function(operationPayload){var actionPromise=$.Deferred(),controlContext=operationPayload.ControlContext;if(KbCommonUtils.CommonUtils.IsMultisessionHost(controlContext)&&KbCommonUtils.CommonUtils.IsEntityTypeConversation(controlContext)){var anchorTabData=JSON.parse(controlContext.parameters.AnchorTabContext.raw),entityId=anchorTabData.entityId;if(entityId==null)if(anchorTabData.data!=null&&anchorTabData.data.ocContext!=null&&anchorTabData.data.ocContext.config&&anchorTabData.data.ocContext.config.sessionParams)entityId=anchorTabData.data.ocContext.config.sessionParams.LiveWorkItemId;entityId!=null&&controlContext.webAPI.retrieveRecord(KbCommonUtils.Constants.ConversationEntityName,entityId,"?$select=statuscode").then(function(apiResponse){if(apiResponse[KbCommonUtils.Constants.StatusCodeAttribute]!=MscrmControls.KbCommonUtils.LiveWorkItemStatus.Open&&apiResponse[KbCommonUtils.Constants.StatusCodeAttribute]!=MscrmControls.KbCommonUtils.LiveWorkItemStatus.Active){var title=KbCommonUtils.KbCommonControlLocale.CTIFailedMessageForConversationStateTitle,message=KbCommonUtils.KbCommonControlLocale.CTIFailedMessageForConversationStateText,status_1=apiResponse[KbCommonUtils.Constants.StatusCodeValue].toLowerCase(),failureMessage=MscrmCommon.ControlUtils.String.Format(message,status_1),alertMessage={text:failureMessage,title:title};Xrm.Navigation.openAlertDialog(alertMessage);var actionOutput=new KbCommonUtils.ActionOutput;actionOutput.status=false;actionPromise.resolve(actionOutput)}else actionPromise.resolve(new KbCommonUtils.ActionOutput)})}return actionPromise.promise()};CTIActionOperation.prototype.ExecuteOperation=function(operationPayload){var actionPromise=$.Deferred(),ctiDataPayload={detail:{title:operationPayload.Title,link:KbCommonUtils.ActionOperationUtils.GetKMExternalPortalUrl(operationPayload)}},event=new CustomEvent("KMClickToSend",ctiDataPayload),isSuccessfull=window.top.dispatchEvent(event);actionPromise.resolve(this.GetActionOutput(isSuccessfull,operationPayload,null));return actionPromise.promise()};return CTIActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.CTIActionOperation=CTIActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var EmailActionOperation=function(_super){__extends(EmailActionOperation,_super);function EmailActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(EmailActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.EmailArticleIconLabel"},enumerable:false,configurable:true});Object.defineProperty(EmailActionOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"SearchWidget.SearchKMArticles.EmailArticleIconToolTipNew":"SearchWidget.SearchKMArticles.EmailArticleIconToolTip"},enumerable:false,configurable:true});Object.defineProperty(EmailActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.EmailLink},enumerable:false,configurable:true});EmailActionOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(payload){payload[KbCommonUtils.Constants.FederatedSearchProviderType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SearchProviderType,operationPayload);payload[KbCommonUtils.Constants.ActionCallback]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ActionOperationCallback,operationPayload);payload[KbCommonUtils.Constants.AssociationRelationshipName]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociationRelationshipName,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityReference]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityReference,operationPayload);payload[KbCommonUtils.Constants.SelectPrimaryCustomer]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.PrimaryCustomerForEmail,operationPayload);payload[KbCommonUtils.Constants.FetchApiWrapper]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.FetchApiWrapper,operationPayload);payload[KbCommonUtils.Constants.SearchProviderType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SearchProviderType,operationPayload);payload[KbCommonUtils.Constants.ResourceUri]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ResourceUri,operationPayload);payload[KbCommonUtils.Constants.KmPrivileges]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KmPrivileges,operationPayload);payload[KbCommonUtils.Constants.UseExternalKMPortal]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.UseExternalKMPortal,operationPayload);payload[KbCommonUtils.Constants.ExternalKMPortalURL]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ExternalKMPortalURL,operationPayload);payload[KbCommonUtils.Constants.ArticlePublicNumber]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ArticlePublicNumber,operationPayload);payload[KbCommonUtils.Constants.StateCode]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.StateCode,operationPayload);payload[KbCommonUtils.Constants.IsAssociated]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsAssociatedWithKnowledgeArticle,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityId]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityId,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityTypeName,operationPayload);payload[KbCommonUtils.Constants.IsExternalSearchIndexEnabled]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsExternalSearchIndexEnabled,operationPayload);contentPromise.resolve(payload)});return contentPromise.promise()};EmailActionOperation.prototype.ValidateOperation=function(validationPayload){if(validationPayload.IsSearchScenario&&KbCommonUtils.CommonUtils.IsEntityTypeConversationHostedInProductivityPane(validationPayload.ControlContext))return false;if(validationPayload.IsSearchScenario&&!KbCommonUtils.CommonUtils.IsHostedInEntityContext(validationPayload.ControlContext))return false;return (validationPayload.Record.isIngestedArticle||validationPayload[KbCommonUtils.Constants.UseExternalKMPortal])&&KbCommonUtils.EmailActionUtils.IsValidToSendEmail(validationPayload)};EmailActionOperation.prototype.PreExecuteOperation=function(operationPayload){return KbCommonUtils.EmailActionUtils.PreExecuteEmailOperation(this,operationPayload)};EmailActionOperation.prototype.ExecuteOperation=function(operationPayload){var _this=this,actionPromise=$.Deferred(),watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.ControlContext,operationPayload[KbCommonUtils.Constants.WebresourceNameArticleActions],KbCommonUtils.TelemetryActionName.Email_Article_URL);if(KbCommonUtils.ActionOperationUtils.ShouldShowConfirmationDialog(operationPayload)){var dialogPromise=KbCommonUtils.ActionOperationUtils.ShowConfirmationDialog(operationPayload);dialogPromise.then(function(){KbCommonUtils.EmailActionUtils.sendEmailContent(operationPayload,false,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload[KbCommonUtils.Constants.SearchProviderType],operationPayload[KbCommonUtils.Constants.ResourceUri]).then(function(result){actionPromise.resolve(_this.GetActionOutput(true,operationPayload,null))},function(err){actionPromise.resolve(_this.GetActionOutput(false,operationPayload,err))});watermarkTelemetryEvent.End()},function(){watermarkTelemetryEvent.End()})}else{KbCommonUtils.EmailActionUtils.sendEmailContent(operationPayload,false,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload[KbCommonUtils.Constants.SearchProviderType],operationPayload[KbCommonUtils.Constants.ResourceUri]).then(function(result){actionPromise.resolve(_this.GetActionOutput(true,operationPayload,null))},function(err){actionPromise.resolve(_this.GetActionOutput(false,operationPayload,err))});watermarkTelemetryEvent.End()}return actionPromise.promise()};EmailActionOperation.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.ActionOperationUtils.GetDefaultOutputForTabOpenActions(status,operationPayload,error)};return EmailActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.EmailActionOperation=EmailActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var EmailContentActionOperation=function(_super){__extends(EmailContentActionOperation,_super);function EmailContentActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(EmailContentActionOperation.prototype,"Label",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"SearchWidget.SearchKMArticles.EmailArticleContentIconLabelNew":"SearchWidget.SearchKMArticles.EmailArticleContentIconLabel"},enumerable:false,configurable:true});Object.defineProperty(EmailContentActionOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"SearchWidget.SearchKMArticles.EmailArticleContentIconToolTipNew":"SearchWidget.SearchKMArticles.EmailArticleContentIconToolTip"},enumerable:false,configurable:true});Object.defineProperty(EmailContentActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SendEmail},enumerable:false,configurable:true});EmailContentActionOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(payload){payload[KbCommonUtils.Constants.FederatedSearchProviderType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SearchProviderType,operationPayload);payload[KbCommonUtils.Constants.ActionCallback]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ActionOperationCallback,operationPayload);payload[KbCommonUtils.Constants.AssociationRelationshipName]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociationRelationshipName,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityReference]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityReference,operationPayload);payload[KbCommonUtils.Constants.SelectPrimaryCustomer]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.PrimaryCustomerForEmail,operationPayload);payload[KbCommonUtils.Constants.FetchApiWrapper]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.FetchApiWrapper,operationPayload);payload[KbCommonUtils.Constants.SearchProviderType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SearchProviderType,operationPayload);payload[KbCommonUtils.Constants.ResourceUri]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ResourceUri,operationPayload);payload[KbCommonUtils.Constants.KmPrivileges]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KmPrivileges,operationPayload);payload[KbCommonUtils.Constants.UseExternalKMPortal]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.UseExternalKMPortal,operationPayload);payload[KbCommonUtils.Constants.StateCode]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.StateCode,operationPayload);payload[KbCommonUtils.Constants.IsAssociated]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsAssociatedWithKnowledgeArticle,operationPayload);payload[KbCommonUtils.Constants.ContentToMail]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ArticleContentToEmail,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityId]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityId,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityTypeName,operationPayload);payload[KbCommonUtils.Constants.IsExternalSearchIndexEnabled]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsExternalSearchIndexEnabled,operationPayload);contentPromise.resolve(payload)});return contentPromise.promise()};EmailContentActionOperation.prototype.PreExecuteOperation=function(operationPayload){return KbCommonUtils.EmailActionUtils.PreExecuteEmailOperation(this,operationPayload)};EmailContentActionOperation.prototype.ValidateOperation=function(validationPayload){if(validationPayload.IsSearchScenario&&KbCommonUtils.CommonUtils.IsEntityTypeConversationHostedInProductivityPane(validationPayload.ControlContext))return false;if(validationPayload.IsSearchScenario&&!KbCommonUtils.CommonUtils.IsHostedInEntityContext(validationPayload.ControlContext))return false;return !validationPayload.Record.isIngestedArticle&&KbCommonUtils.EmailActionUtils.IsValidToSendEmail(validationPayload)};EmailContentActionOperation.prototype.ExecuteOperation=function(operationPayload){var _this=this,actionPromise=$.Deferred(),watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.ControlContext,operationPayload[KbCommonUtils.Constants.WebresourceNameArticleActions],KbCommonUtils.TelemetryActionName.Email_Article_Content);if(KbCommonUtils.ActionOperationUtils.ShouldShowConfirmationDialog(operationPayload)){var dialogPromise=KbCommonUtils.ActionOperationUtils.ShowConfirmationDialog(operationPayload);dialogPromise.then(function(){KbCommonUtils.EmailActionUtils.sendEmailContent(operationPayload,true,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload[KbCommonUtils.Constants.SearchProviderType],operationPayload[KbCommonUtils.Constants.ResourceUri]).then(function(result){actionPromise.resolve(_this.GetActionOutput(true,operationPayload,null))},function(err){actionPromise.resolve(_this.GetActionOutput(false,operationPayload,err))});watermarkTelemetryEvent.End()},function(){watermarkTelemetryEvent.End()})}else{KbCommonUtils.EmailActionUtils.sendEmailContent(operationPayload,true,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload[KbCommonUtils.Constants.SearchProviderType],operationPayload[KbCommonUtils.Constants.ResourceUri]).then(function(result){actionPromise.resolve(_this.GetActionOutput(true,operationPayload,null))},function(err){actionPromise.resolve(_this.GetActionOutput(false,operationPayload,err))});watermarkTelemetryEvent.End()}return actionPromise.promise()};EmailContentActionOperation.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.ActionOperationUtils.GetDefaultOutputForTabOpenActions(status,operationPayload,error)};return EmailContentActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.EmailContentActionOperation=EmailContentActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var IncreaseViewActionOperation=function(_super){__extends(IncreaseViewActionOperation,_super);function IncreaseViewActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(IncreaseViewActionOperation.prototype,"Label",{"get":function(){throw"Not Implemented"},enumerable:false,configurable:true});Object.defineProperty(IncreaseViewActionOperation.prototype,"Tooltip",{"get":function(){throw"Not Implemented"},enumerable:false,configurable:true});Object.defineProperty(IncreaseViewActionOperation.prototype,"SymbolCode",{"get":function(){throw"Not Implemented"},enumerable:false,configurable:true});IncreaseViewActionOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){actionPayload[KbCommonUtils.Constants.FetchApiWrapper]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.FetchApiWrapper,operationPayload);actionPayload[KbCommonUtils.Constants.SearchProviderType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SearchProviderType,operationPayload);actionPayload[KbCommonUtils.Constants.ResourceUri]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ResourceUri,operationPayload);actionPayload[KbCommonUtils.Constants.ActionCallback]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ActionOperationCallback,operationPayload);contentPromise.resolve(actionPayload)});return contentPromise.promise()};IncreaseViewActionOperation.prototype.ValidateOperation=function(validationPayload){return false};IncreaseViewActionOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.ControlContext,watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(context,operationPayload[KbCommonUtils.Constants.WebresourceNameArticleActions],KbCommonUtils.TelemetryActionName.Increase_View_Count),entityReference={id:operationPayload.KnowledgeArticleId,entityType:KbCommonUtils.Constants.KnowledgeArticleEntityType},viewDate=moment().format(KbCommonUtils.Constants.ViewDateFormat),count=1,location=1,url=KbCommonUtils.Constants.ODATA_PATH+KbCommonUtils.Constants.IncreaseViewEndpoint,knowledgearticleId=entityReference.id;url=MscrmCommon.ControlUtils.String.Format(url,knowledgearticleId,viewDate,location,count);operationPayload[KbCommonUtils.Constants.FetchApiWrapper].Fetch(context,KbCommonUtils.GET_METHOD,url,"",KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload[KbCommonUtils.Constants.SearchProviderType],operationPayload[KbCommonUtils.Constants.ResourceUri],KbCommonUtils.Constants.CrossDynamicsOrgApiCall).then(function(response){operationPayload[KbCommonUtils.Constants.ActionCallback].successCallback(operationPayload,response);watermarkTelemetryEvent.End()},function(error){operationPayload[KbCommonUtils.Constants.ActionCallback].failureCallback(operationPayload,error);var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";watermarkTelemetryEvent.EndAndLogError({errorMessage:"IncreaseViewActionOperation: "+errorMessage,eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")}]})});var actionPromise=$.Deferred();actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};return IncreaseViewActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.IncreaseViewActionOperation=IncreaseViewActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var LinkActionOperation=function(_super){__extends(LinkActionOperation,_super);function LinkActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(LinkActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.AssociateArticleIconLabel"},enumerable:false,configurable:true});Object.defineProperty(LinkActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.AssociateArticleIconToolTip"},enumerable:false,configurable:true});Object.defineProperty(LinkActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?KbCommonUtils.IconSymbolCode.LinkArticleNew:KbCommonUtils.IconSymbolCode.LinkArticle},enumerable:false,configurable:true});LinkActionOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(payload){payload[KbCommonUtils.Constants.SearchProviderType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SearchProviderType,operationPayload);payload[KbCommonUtils.Constants.ActionCallback]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ActionOperationCallback,operationPayload);payload[KbCommonUtils.Constants.AssociationRelationshipName]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociationRelationshipName,operationPayload);payload[KbCommonUtils.Constants.FetchApiWrapper]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.FetchApiWrapper,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityId]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityId,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityTypeName,operationPayload);payload[KbCommonUtils.Constants.IsExternalSearchIndexEnabled]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsExternalSearchIndexEnabled,operationPayload);contentPromise.resolve(payload)});return contentPromise.promise()};LinkActionOperation.prototype.ValidateOperation=function(validationPayload){if(KbCommonUtils.ActionOperationUtils.GetStateOfArticle(validationPayload)!==KbCommonUtils.KnowledgeArticleState.Expired&&KbCommonUtils.ActionOperationUtils.GetStateOfArticle(validationPayload)!==KbCommonUtils.KnowledgeArticleState.Archived&&KbCommonUtils.ActionOperationUtils.GetStateOfArticle(validationPayload)!==KbCommonUtils.KnowledgeArticleState.Discarded){if(validationPayload.IsSearchScenario&&KbCommonUtils.CommonUtils.IsEntityTypeConversationHostedInProductivityPane(validationPayload.ControlContext))return false;var entityTypeNameToLink=validationPayload.ControlContext.page.entityTypeName;if(validationPayload.IsSearchScenario&&MscrmCommon.ControlUtils.Object.isNullOrUndefined(entityTypeNameToLink)&&KbCommonUtils.CommonUtils.IsLoadedInDialog(validationPayload.ControlContext))entityTypeNameToLink=validationPayload.ControlContext.parameters.WrapperContext.DialogContext.EntityTypeName;if(validationPayload.IsSearchScenario&&entityTypeNameToLink!==KbCommonUtils.Constants.Incident&&KbCommonUtils.CommonUtils.IsRecordFromFederatedSearch(validationPayload.Record))return false;var isHostedInEntityContext=validationPayload.IsSearchScenario?KbCommonUtils.CommonUtils.IsHostedInEntityContext(validationPayload.ControlContext):true;return isHostedInEntityContext&&validationPayload[KbCommonUtils.Constants.KmPrivileges]&&validationPayload[KbCommonUtils.Constants.KmPrivileges].CanAssociateAndDisassociate&&!validationPayload[KbCommonUtils.Constants.IsAssociated]}return false};LinkActionOperation.prototype.ExecuteOperation=function(operationPayload){var _this=this,actionPromise=$.Deferred(),controlContext=operationPayload.ControlContext,searchProvidertype=operationPayload[KbCommonUtils.Constants.SearchProviderType],promise=null,entityIdToLink=controlContext.page.entityId;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(entityIdToLink)&&KbCommonUtils.CommonUtils.IsLoadedInDialog(controlContext))entityIdToLink=controlContext.parameters.WrapperContext.DialogContext.EntityId;var entityTypeNameToLink=controlContext.page.entityTypeName;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(entityTypeNameToLink)&&KbCommonUtils.CommonUtils.IsLoadedInDialog(controlContext)){entityTypeNameToLink=controlContext.parameters.WrapperContext.DialogContext.EntityTypeName;operationPayload[KbCommonUtils.Constants.AssociatedEntityType]=entityTypeNameToLink}var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(controlContext,operationPayload[KbCommonUtils.Constants.WebresourceNameArticleActions],KbCommonUtils.TelemetryActionName.Link_KbArticle);if(operationPayload.IsSearchScenario){if(operationPayload.Record.isPending)return;operationPayload.Record.isPending=true}if(KbCommonUtils.SearchProviderType.InternalDynamicsOrg!=searchProvidertype)promise=this.LinkFederatedArticle(controlContext,entityIdToLink,operationPayload,watermarkTelemetryEvent);else promise=this.LinkArticle(controlContext,operationPayload,watermarkTelemetryEvent);promise.then(function(response){_this.SuccessCallbackAction(operationPayload,response);actionPromise.resolve(_this.GetActionOutput(true,operationPayload,{}));watermarkTelemetryEvent.End()},function(error){_this.FailureCallbackAction(operationPayload,error);actionPromise.resolve(_this.GetActionOutput(false,operationPayload,{}));var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";watermarkTelemetryEvent.EndAndLogError({errorMessage:"LinkActionOperation: "+errorMessage,eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")}]})});return actionPromise.promise()};LinkActionOperation.prototype.SuccessCallbackAction=function(operationPayload,response){var actionCallback=operationPayload[KbCommonUtils.Constants.ActionCallback];actionCallback.successCallback(operationPayload,response)};LinkActionOperation.prototype.FailureCallbackAction=function(operationPayload,error){var actionCallback=operationPayload[KbCommonUtils.Constants.ActionCallback];actionCallback.failureCallback(operationPayload,error)};LinkActionOperation.prototype.LinkArticle=function(controlContext,operationPayload,watermarkTelemetryEvent){var ODataEndPointUri=KbCommonUtils.Constants.ODATA_PATH+KbCommonUtils.Constants.AssociateEndpoint,promise=null,fetchApiWrapper=operationPayload[KbCommonUtils.Constants.FetchApiWrapper],associateDisassociateKARequest=new KbCommonUtils.AssociateDisassociateKnowledgeArticleRequest(operationPayload[KbCommonUtils.Constants.AssociatedEntityId],-1,operationPayload[KbCommonUtils.Constants.AssociatedEntityType]===KbCommonUtils.Constants.Incident?KbCommonUtils.Constants.IncidentRelationshipName:operationPayload[KbCommonUtils.Constants.AssociationRelationshipName],operationPayload.KnowledgeArticleId,operationPayload[KbCommonUtils.Constants.AssociatedEntityType]);if(fetchApiWrapper)promise=fetchApiWrapper.Fetch(controlContext,KbCommonUtils.POST_METHOD,ODataEndPointUri,JSON.stringify(associateDisassociateKARequest));else{var request=new KbCommonUtils.AssociateKnowledgeArticleRequest(operationPayload[KbCommonUtils.Constants.AssociatedEntityId],-1,operationPayload[KbCommonUtils.Constants.AssociatedEntityType]===KbCommonUtils.Constants.Incident?KbCommonUtils.Constants.IncidentRelationshipName:operationPayload[KbCommonUtils.Constants.AssociationRelationshipName],operationPayload.KnowledgeArticleId,operationPayload[KbCommonUtils.Constants.AssociatedEntityType]);promise=controlContext.webAPI.execute(request)}return promise};LinkActionOperation.prototype.LinkFederatedArticle=function(controlContext,entityId,operationPayload,watermarkTelemetryEvent){var promise=null,federatedArticleId=operationPayload.Record.federatedArticleId,federatedArticleIncidentId=operationPayload.Record.federatedArticleIncidentId,knowledgeArticleId=operationPayload.KnowledgeArticleId;if(!federatedArticleId){this.saveFederatedKnowledgeArticle(operationPayload);watermarkTelemetryEvent.End();return}if(!federatedArticleIncidentId){var data={"msdyn_federatedarticleid@odata.bind":"/msdyn_federatedarticles("+federatedArticleId+")","msdyn_incidentid@odata.bind":"/incidents("+entityId+")",statuscode:1,statecode:0,msdyn_searchproviderarticleid:knowledgeArticleId};promise=controlContext.webAPI.createRecord(KbCommonUtils.Constants.FederatedArticleIncident,data)}else promise=controlContext.webAPI.updateRecord(KbCommonUtils.Constants.FederatedArticleIncident,federatedArticleIncidentId,{statecode:0});return promise};LinkActionOperation.prototype.saveFederatedKnowledgeArticle=function(operationPayload){var _this=this,data={msdyn_title:operationPayload.Title,msdyn_searchproviderarticleid:operationPayload.KnowledgeArticleId,msdyn_url:operationPayload.Record.articleUrl,"msdyn_searchproviderid@odata.bind":"/msdyn_kmfederatedsearchconfigs("+operationPayload.Record.searchProviderId+")"};operationPayload.ControlContext.webAPI.createRecord(KbCommonUtils.Constants.FederatedArticle,data).then(function(response){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(response)){operationPayload.Record.federatedArticleId=response.id;operationPayload.Record.isPending=false;_this.ExecuteOperation(operationPayload)}},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||""})};return LinkActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.LinkActionOperation=LinkActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var OpenResultActionOperation=function(_super){__extends(OpenResultActionOperation,_super);function OpenResultActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(OpenResultActionOperation.prototype,"Label",{"get":function(){return "KMControl.SearchKMArticles.OpenResult"},enumerable:false,configurable:true});Object.defineProperty(OpenResultActionOperation.prototype,"Tooltip",{"get":function(){return "KMControl.SearchKMArticles.OpenResult"},enumerable:false,configurable:true});Object.defineProperty(OpenResultActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.Default},enumerable:false,configurable:true});OpenResultActionOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){actionPayload[KbCommonUtils.Constants.UserId]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.UserId,operationPayload);actionPayload[KbCommonUtils.Constants.SearchProviderType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SearchProviderType,operationPayload);actionPayload[KbCommonUtils.Constants.ResourceUri]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ResourceUri,operationPayload);contentPromise.resolve(actionPayload)});return contentPromise.promise()};OpenResultActionOperation.prototype.ValidateOperation=function(validationPayload){return false};OpenResultActionOperation.prototype.PreExecuteOperation=function(operationPayload){var _this=this,actionPromise=$.Deferred(),actionOutput=new KbCommonUtils.ActionOutput;if(operationPayload.IsLoadedInProductivityPane)KbCommonUtils.MultisessionUtils.GetTabIfOpened(operationPayload.ControlContext,operationPayload.KnowledgeArticleId).then(function(tab){if(tab!=null){tab.focus();return}if(!KbCommonUtils.MultisessionUtils.CanCreateNewAppTab())actionOutput=_this.GetActionOutput(false,operationPayload,new Error(KbCommonUtils.Constants.MAX_TAB_FAILURE));actionPromise.resolve(actionOutput)});else actionPromise.resolve(actionOutput);return actionPromise.promise()};OpenResultActionOperation.prototype.ExecuteOperation=function(operationPayload){var actionPromise=$.Deferred(),stateManager=operationPayload.StateManager,context=operationPayload.ControlContext,record=operationPayload.Record;stateManager&&stateManager.SetSelectedArticle(record,context);if(operationPayload.IsLoadedInProductivityPane)this.OpenArticleAppTab(actionPromise,operationPayload);else{stateManager.SetIsSearchMode(false,context);this.RequestRender(context);actionPromise.resolve(new KbCommonUtils.ActionOutput)}return actionPromise.promise()};OpenResultActionOperation.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.ActionOperationUtils.GetDefaultOutputForTabOpenActions(status,operationPayload,error)};OpenResultActionOperation.prototype.OpenArticleAppTab=function(actionPromise,operationPayload){var _this=this;KbCommonUtils.MultisessionUtils.OpenArticleAppTab(operationPayload).then(function(status){actionPromise.resolve(_this.GetActionOutput(status,operationPayload,null))},function(error){actionPromise.resolve(_this.GetActionOutput(false,operationPayload,error))})};OpenResultActionOperation.prototype.RequestRender=function(context){context.utils.requestRender(function(){var backButton=document.getElementById(context.accessibility.getUniqueId("ContentPaneBackButtonContainer"));backButton&&backButton.focus()})};return OpenResultActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.OpenResultActionOperation=OpenResultActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var PopoutActionOperation=function(_super){__extends(PopoutActionOperation,_super);function PopoutActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(PopoutActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.PopoutArticleIconLabel"},enumerable:false,configurable:true});Object.defineProperty(PopoutActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.PopoutArticleIconTooltip"},enumerable:false,configurable:true});Object.defineProperty(PopoutActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?KbCommonUtils.IconSymbolCode.PopoutArticleNew:KbCommonUtils.IconSymbolCode.PopoutArticle},enumerable:false,configurable:true});PopoutActionOperation.prototype.ValidateOperation=function(validationPayload){return !KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(validationPayload.Record)&&validationPayload.ControlContext.client.getClient()!=="Mobile"&&!KbCommonUtils.CommonUtils.IsInArticlePageContext()&&(validationPayload.Record.isIngestedArticle||!KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(validationPayload.ControlContext)&&!KbCommonUtils.CommonUtils.IsHostedInMultisessionStandaloneMode(validationPayload.ControlContext)&&!KbCommonUtils.CommonUtils.IsArticleOpenInMultisessionAppTab(validationPayload.ControlContext))&&!window.IsUSD};PopoutActionOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.ControlContext,record=operationPayload.Record,stateManager=operationPayload.StateManager,knowledgeArticleId=operationPayload.KnowledgeArticleId,url="",extraqsUrl="",watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(context,operationPayload[KbCommonUtils.Constants.WebresourceNameArticleActions],KbCommonUtils.TelemetryActionName.Popout_KbArticle);if(stateManager.isKnowledgeSearchInsightsEnabled){var knowledgeOperationId=record.knowledgeOperationId,articleRank=record.articleRank;if(knowledgeOperationId&&articleRank){var extraqs=KbCommonUtils.Constants.KnowledgeOperationIdParameter+"="+knowledgeOperationId+"&"+KbCommonUtils.Constants.ArticleRankParameter+"="+articleRank;extraqsUrl="&"+KbCommonUtils.Constants.ExtraQueryString+"="+encodeURIComponent(extraqs)}}if(KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(record)||record.isIngestedArticle)url=record.articleUrl;else url=record.resourceUri+KbCommonUtils.Constants.PopOutArticleUri+knowledgeArticleId+extraqsUrl;window.open(url,"KnowledgeArticle"+knowledgeArticleId);watermarkTelemetryEvent.End();var actionPromise=$.Deferred();actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};return PopoutActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.PopoutActionOperation=PopoutActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOutput=function(){function ActionOutput(){this.status=true;this.payload={}}return ActionOutput}();KbCommonUtils.ActionOutput=ActionOutput})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SelectContentDialogOperation=function(_super){__extends(SelectContentDialogOperation,_super);function SelectContentDialogOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(SelectContentDialogOperation.prototype,"Label",{"get":function(){return KbCommonUtils.Constants.InsertContentDialogButtonLabel},enumerable:false,configurable:true});Object.defineProperty(SelectContentDialogOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.Constants.InsertContentDialogButtonTooltip},enumerable:false,configurable:true});Object.defineProperty(SelectContentDialogOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SelectContent},enumerable:false,configurable:true});SelectContentDialogOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(payload){payload[KbCommonUtils.Constants.SearchProviderType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SearchProviderType,operationPayload);payload[KbCommonUtils.Constants.ResourceUri]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ResourceUri,operationPayload);payload[KbCommonUtils.Constants.IsRelevanceSearchEnabled]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsRelevanceSearchEnabled,operationPayload);payload[KbCommonUtils.Constants.ContentToMail]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ArticleContentToEmail,operationPayload);contentPromise.resolve(payload)});return contentPromise.promise()};SelectContentDialogOperation.prototype.ValidateOperation=function(validationPayload){var context=validationPayload.ControlContext;if(!KbCommonUtils.CommonUtils.IsLoadedInDialog(context))return false;var dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;if(!dictionary)return false;return KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(context)&&KbCommonUtils.FCBUtil.IsFeatureEnabled(context,KbCommonUtils.FCBUtil.KMInsertArticle)&&!window.IsUSD&&!KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(validationPayload.Record)&&!validationPayload.Record.isIngestedArticle&&!(dictionary[validationPayload.KnowledgeArticleId]&&dictionary[validationPayload.KnowledgeArticleId].content)};SelectContentDialogOperation.prototype.ExecuteOperation=function(operationPayload){KbCommonUtils.EmailActionUtils.getContentToMail(operationPayload,true,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload[KbCommonUtils.Constants.SearchProviderType],operationPayload[KbCommonUtils.Constants.ResourceUri]).then(function(contentToMail){var context=operationPayload.ControlContext,record=operationPayload.Record,dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;if(dictionary[operationPayload.KnowledgeArticleId])dictionary[operationPayload.KnowledgeArticleId].content=true;else{if(context.parameters.WrapperContext.DialogContext.isMultiSelect)if(Object.keys(dictionary).length>=3){window.Xrm.UI.addGlobalNotification(1,3,"Allowed limit of 3 articles already selected",null,null,null);return}dictionary[operationPayload.KnowledgeArticleId]={content:true,url:false,record:record,contentToMail:contentToMail}}if(context.parameters.WrapperContext.DialogContext.OutputParameter.raw!=null){var control=window.Xrm.Page.getControl(context.parameters.WrapperContext.DialogContext.OutputParameter.raw);if(control){control.getAttribute().setValue(JSON.stringify(dictionary));control.getAttribute().fireOnChange()}}context.parameters.WrapperContext.DialogContext.isMultiSelect&&context.utils.requestRender()});var actionPromise=$.Deferred();actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};return SelectContentDialogOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.SelectContentDialogOperation=SelectContentDialogOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SelectUrlDialogOperation=function(_super){__extends(SelectUrlDialogOperation,_super);function SelectUrlDialogOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(SelectUrlDialogOperation.prototype,"Label",{"get":function(){return KbCommonUtils.Constants.InsertURLDialogButtonLabel},enumerable:false,configurable:true});Object.defineProperty(SelectUrlDialogOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.Constants.InsertURLDialogButtonTooltip},enumerable:false,configurable:true});Object.defineProperty(SelectUrlDialogOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SelectUrl},enumerable:false,configurable:true});SelectUrlDialogOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){actionPayload[KbCommonUtils.Constants.KmPrivileges]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KmPrivileges,operationPayload);actionPayload[KbCommonUtils.Constants.UseExternalKMPortal]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.UseExternalKMPortal,operationPayload);actionPayload[KbCommonUtils.Constants.ExternalKMPortalURL]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ExternalKMPortalURL,operationPayload);actionPayload[KbCommonUtils.Constants.ArticlePublicNumber]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ArticlePublicNumber,operationPayload);contentPromise.resolve(actionPayload)});return contentPromise.promise()};SelectUrlDialogOperation.prototype.ValidateOperation=function(validationPayload){var context=validationPayload.ControlContext;if(!KbCommonUtils.CommonUtils.IsLoadedInDialog(context))return false;var dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;if(!dictionary)return false;return validationPayload[KbCommonUtils.Constants.KmPrivileges]&&validationPayload[KbCommonUtils.Constants.KmPrivileges].CanCopyLink&&(validationPayload[KbCommonUtils.Constants.UseExternalKMPortal]||KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(validationPayload.Record)||validationPayload.Record.isIngestedArticle)&&KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(context)&&KbCommonUtils.FCBUtil.IsFeatureEnabled(context,KbCommonUtils.FCBUtil.KMInsertArticle)&&!window.IsUSD&&!(dictionary[validationPayload.KowledgeArticleId]&&dictionary[validationPayload.KnowledgeArticleId].url)};SelectUrlDialogOperation.prototype.ExecuteOperation=function(operationPayload){var publicPortalUrl=KbCommonUtils.ActionOperationUtils.GetKMExternalPortalUrl(operationPayload),context=operationPayload.ControlContext,articleId=operationPayload.KnowledgeArticleId,dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;if(dictionary[articleId]){dictionary[articleId].url=!dictionary[articleId].url;dictionary[articleId].publicUrl=publicPortalUrl;if(!dictionary[articleId].content&&!dictionary[articleId].url)delete dictionary[articleId]}else{if(context.parameters.WrapperContext.DialogContext.isMultiSelect)if(Object.keys(dictionary).length>=3){window.Xrm.UI.addGlobalNotification(1,3,"Allowed limit of 3 articles already selected",null,null,null);return}dictionary[articleId]={content:false,url:true,record:operationPayload.Record,publicUrl:publicPortalUrl}}if(context.parameters.WrapperContext.DialogContext!=null&&context.parameters.WrapperContext.DialogContext.OutputParameter.raw!=null){var control=window.Xrm.Page.getControl(context.parameters.WrapperContext.DialogContext.OutputParameter.raw);if(control){control.getAttribute().setValue(JSON.stringify(dictionary));control.getAttribute().fireOnChange()}}context.parameters.WrapperContext.DialogContext.isMultiSelect&&context.utils.requestRender();var actionPromise=$.Deferred();actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};return SelectUrlDialogOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.SelectUrlDialogOperation=SelectUrlDialogOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var UnselectContentDialogOperation=function(_super){__extends(UnselectContentDialogOperation,_super);function UnselectContentDialogOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(UnselectContentDialogOperation.prototype,"Label",{"get":function(){return "Unselect Content"},enumerable:false,configurable:true});Object.defineProperty(UnselectContentDialogOperation.prototype,"Tooltip",{"get":function(){return "Unselect Content"},enumerable:false,configurable:true});Object.defineProperty(UnselectContentDialogOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.UnselectContent},enumerable:false,configurable:true});UnselectContentDialogOperation.prototype.ValidateOperation=function(validationPayload){var context=validationPayload.ControlContext;if(!KbCommonUtils.CommonUtils.IsLoadedInDialog(context))return false;var dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;if(!dictionary)return false;return KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(context)&&KbCommonUtils.FCBUtil.IsFeatureEnabled(context,KbCommonUtils.FCBUtil.KMInsertArticle)&&!window.IsUSD&&context.parameters.WrapperContext.DialogContext.isMultiSelect&&dictionary[validationPayload.KnowledgeArticleId]&&dictionary[validationPayload.KnowledgeArticleId].content};UnselectContentDialogOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.ControlContext,dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords,articleId=operationPayload.KnowledgeArticleId;dictionary[articleId].content=false;if(!dictionary[articleId].url)delete dictionary[articleId];if(context.parameters.WrapperContext.DialogContext!=null&&context.parameters.WrapperContext.DialogContext.OutputParameter.raw!=null){var control=window.Xrm.Page.getControl(context.parameters.WrapperContext.DialogContext.OutputParameter.raw);if(control){control.getAttribute().setValue(JSON.stringify(dictionary));control.getAttribute().fireOnChange()}}context.utils.requestRender();var actionPromise=$.Deferred();actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};return UnselectContentDialogOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.UnselectContentDialogOperation=UnselectContentDialogOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var UnselectUrlDialogOperation=function(_super){__extends(UnselectUrlDialogOperation,_super);function UnselectUrlDialogOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(UnselectUrlDialogOperation.prototype,"Label",{"get":function(){return "Unselect Url"},enumerable:false,configurable:true});Object.defineProperty(UnselectUrlDialogOperation.prototype,"Tooltip",{"get":function(){return "Unselect Url"},enumerable:false,configurable:true});Object.defineProperty(UnselectUrlDialogOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.UnselectUrl},enumerable:false,configurable:true});UnselectUrlDialogOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){actionPayload[KbCommonUtils.Constants.KmPrivileges]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KmPrivileges,operationPayload);actionPayload[KbCommonUtils.Constants.UseExternalKMPortal]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.UseExternalKMPortal,operationPayload);contentPromise.resolve(actionPayload)});return contentPromise.promise()};UnselectUrlDialogOperation.prototype.ValidateOperation=function(validationPayload){var context=validationPayload.ControlContext;if(!KbCommonUtils.CommonUtils.IsLoadedInDialog(context))return false;var dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;if(!dictionary)return false;return validationPayload[KbCommonUtils.Constants.KmPrivileges]&&validationPayload[KbCommonUtils.Constants.KmPrivileges].CanCopyLink&&validationPayload[KbCommonUtils.Constants.UseExternalKMPortal]&&KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(context)&&KbCommonUtils.FCBUtil.IsFeatureEnabled(context,KbCommonUtils.FCBUtil.KMInsertArticle)&&!window.IsUSD&&context.parameters.WrapperContext.DialogContext.isMultiSelect&&dictionary[validationPayload.KnowledgeArticleId]&&dictionary[validationPayload.KnowledgeArticleId].url};UnselectUrlDialogOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.ControlContext,dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords,articleId=operationPayload.KnowledgeArticleId;dictionary[articleId].url=false;if(!dictionary[articleId].content)delete dictionary[articleId];if(context.parameters.WrapperContext.DialogContext!=null&&context.parameters.WrapperContext.DialogContext.OutputParameter.raw!=null){var control=window.Xrm.Page.getControl(context.parameters.WrapperContext.DialogContext.OutputParameter.raw);if(control){control.getAttribute().setValue(JSON.stringify(dictionary));control.getAttribute().fireOnChange()}}context.utils.requestRender();var actionPromise=$.Deferred();actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};return UnselectUrlDialogOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.UnselectUrlDialogOperation=UnselectUrlDialogOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SelectResultActionOperation=function(_super){__extends(SelectResultActionOperation,_super);function SelectResultActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(SelectResultActionOperation.prototype,"Label",{"get":function(){return "KMControl.SearchKMArticles.SelectedResult"},enumerable:false,configurable:true});Object.defineProperty(SelectResultActionOperation.prototype,"Tooltip",{"get":function(){return "KMControl.SearchKMArticles.SelectedResult"},enumerable:false,configurable:true});Object.defineProperty(SelectResultActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.Default},enumerable:false,configurable:true});SelectResultActionOperation.prototype.ValidateOperation=function(validationPayload){return false};SelectResultActionOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.ControlContext;context.parameters.value.executeUpdateSelectedResult(context.parameters.value.contextToken,operationPayload.KnowledgeArticleId);var actionPromise=$.Deferred();actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};return SelectResultActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.SelectResultActionOperation=SelectResultActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var UnlinkActionOperation=function(_super){__extends(UnlinkActionOperation,_super);function UnlinkActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(UnlinkActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.DisassociateArticleIconLabel"},enumerable:false,configurable:true});Object.defineProperty(UnlinkActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.DisassociateArticleIconToolTip"},enumerable:false,configurable:true});Object.defineProperty(UnlinkActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?KbCommonUtils.IconSymbolCode.UnlinkArticleNew:KbCommonUtils.IconSymbolCode.UnlinkArticle},enumerable:false,configurable:true});UnlinkActionOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(payload){payload[KbCommonUtils.Constants.SearchProviderType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SearchProviderType,operationPayload);payload[KbCommonUtils.Constants.ActionCallback]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ActionOperationCallback,operationPayload);payload[KbCommonUtils.Constants.AssociationRelationshipName]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociationRelationshipName,operationPayload);payload[KbCommonUtils.Constants.FetchApiWrapper]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.FetchApiWrapper,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityId]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityId,operationPayload);payload[KbCommonUtils.Constants.AssociatedEntityType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityTypeName,operationPayload);payload[KbCommonUtils.Constants.IsExternalSearchIndexEnabled]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.IsExternalSearchIndexEnabled,operationPayload);contentPromise.resolve(payload)});return contentPromise.promise()};UnlinkActionOperation.prototype.ValidateOperation=function(validationPayload){if(KbCommonUtils.ActionOperationUtils.GetStateOfArticle(validationPayload)!==KbCommonUtils.KnowledgeArticleState.Expired&&KbCommonUtils.ActionOperationUtils.GetStateOfArticle(validationPayload)!==KbCommonUtils.KnowledgeArticleState.Archived&&KbCommonUtils.ActionOperationUtils.GetStateOfArticle(validationPayload)!==KbCommonUtils.KnowledgeArticleState.Discarded){if(validationPayload.IsSearchScenario&&KbCommonUtils.CommonUtils.IsEntityTypeConversationHostedInProductivityPane(validationPayload.ControlContext))return false;var entityTypeNameToLink=validationPayload.ControlContext.page.entityTypeName;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(entityTypeNameToLink)&&KbCommonUtils.CommonUtils.IsLoadedInDialog(validationPayload.ControlContext))entityTypeNameToLink=validationPayload.ControlContext.parameters.WrapperContext.DialogContext.EntityTypeName;if(validationPayload.IsSearchScenario&&entityTypeNameToLink!==KbCommonUtils.Constants.Incident&&KbCommonUtils.CommonUtils.IsRecordFromFederatedSearch(validationPayload.Record))return false;var isHostedInEntityContext=validationPayload.IsSearchScenario?KbCommonUtils.CommonUtils.IsHostedInEntityContext(validationPayload.ControlContext):true;return isHostedInEntityContext&&validationPayload[KbCommonUtils.Constants.KmPrivileges]&&validationPayload[KbCommonUtils.Constants.KmPrivileges].CanAssociateAndDisassociate&&validationPayload[KbCommonUtils.Constants.IsAssociated]}return false};UnlinkActionOperation.prototype.ExecuteOperation=function(operationPayload){var _this=this,actionPromise=$.Deferred(),controlContext=operationPayload.ControlContext,promise=null,entityTypeNameToLink=controlContext.page.entityTypeName;if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(entityTypeNameToLink)&&KbCommonUtils.CommonUtils.IsLoadedInDialog(controlContext)){entityTypeNameToLink=controlContext.parameters.WrapperContext.DialogContext.EntityTypeName;operationPayload[KbCommonUtils.Constants.AssociatedEntityType]=entityTypeNameToLink}var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(controlContext,operationPayload[KbCommonUtils.Constants.WebresourceNameArticleActions],KbCommonUtils.TelemetryActionName.Unlink_KbArticle);if(KbCommonUtils.SearchProviderType.InternalDynamicsOrg!=operationPayload[KbCommonUtils.Constants.SearchProviderType])promise=this.UnlinkFederatedArticle(controlContext,operationPayload);else promise=this.UnlinkArticle(controlContext,operationPayload);promise.then(function(response){_this.SuccessCallbackAction(operationPayload,response);actionPromise.resolve(_this.GetActionOutput(true,operationPayload,{}));watermarkTelemetryEvent.End()},function(error){_this.FailureCallbackAction(operationPayload,error);actionPromise.resolve(_this.GetActionOutput(false,operationPayload,error));var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";watermarkTelemetryEvent.EndAndLogError({errorMessage:"UnlinkActionOperation: "+errorMessage,eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")}]})});return actionPromise.promise()};UnlinkActionOperation.prototype.SuccessCallbackAction=function(operationPayload,response){var actionCallback=operationPayload[KbCommonUtils.Constants.ActionCallback];actionCallback.successCallback(operationPayload,response)};UnlinkActionOperation.prototype.FailureCallbackAction=function(operationPayload,error){var actionCallback=operationPayload[KbCommonUtils.Constants.ActionCallback];actionCallback.failureCallback(operationPayload,error)};UnlinkActionOperation.prototype.UnlinkArticle=function(controlContext,operationPayload){var promise=null,ODataEndPointUri=KbCommonUtils.Constants.ODATA_PATH+KbCommonUtils.Constants.DisassociateEndpoint,fetchApiWrapper=operationPayload[KbCommonUtils.Constants.FetchApiWrapper],associateDisassociateKARequest=new KbCommonUtils.AssociateDisassociateKnowledgeArticleRequest(operationPayload[KbCommonUtils.Constants.AssociatedEntityId],-1,operationPayload[KbCommonUtils.Constants.AssociatedEntityType]===KbCommonUtils.Constants.Incident?KbCommonUtils.Constants.IncidentRelationshipName:operationPayload[KbCommonUtils.Constants.AssociationRelationshipName],operationPayload.KnowledgeArticleId,operationPayload[KbCommonUtils.Constants.AssociatedEntityType]);if(fetchApiWrapper)promise=fetchApiWrapper.Fetch(controlContext,KbCommonUtils.POST_METHOD,ODataEndPointUri,JSON.stringify(associateDisassociateKARequest));else{var request=new KbCommonUtils.DisassociateKnowledgeArticleRequest(operationPayload[KbCommonUtils.Constants.AssociatedEntityId],-1,operationPayload[KbCommonUtils.Constants.AssociatedEntityType]===KbCommonUtils.Constants.Incident?KbCommonUtils.Constants.IncidentRelationshipName:operationPayload[KbCommonUtils.Constants.AssociationRelationshipName],operationPayload.KnowledgeArticleId,operationPayload[KbCommonUtils.Constants.AssociatedEntityType]);promise=controlContext.webAPI.execute(request)}return promise};UnlinkActionOperation.prototype.UnlinkFederatedArticle=function(controlContext,operationPayload){var promise=null;promise=controlContext.webAPI.updateRecord(KbCommonUtils.Constants.FederatedArticleIncident,operationPayload.Record.federatedArticleIncidentId,{statecode:1});return promise};return UnlinkActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.UnlinkActionOperation=UnlinkActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionPayload=function(){function ActionPayload(){}return ActionPayload}();KbCommonUtils.ActionPayload=ActionPayload})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KnowledgeSuggestionConstants=function(){function KnowledgeSuggestionConstants(){}KnowledgeSuggestionConstants.Incident="incident";KnowledgeSuggestionConstants.KnowledgeArticleIncident="knowledgearticleincident";KnowledgeSuggestionConstants.KnowledgeArticleId="knowledgearticleid";KnowledgeSuggestionConstants.KAEntityName="knowledgearticle";KnowledgeSuggestionConstants.LanguageLocale="languagelocale";KnowledgeSuggestionConstants.LanguageLocaleId="languagelocaleid";KnowledgeSuggestionConstants.IncidentRelationshipName="knowledgearticlescategories";KnowledgeSuggestionConstants.ServerSearchFailure="SearchWidget.SearchKMArticles.ServerFailure";KnowledgeSuggestionConstants.RegardingObjectId="regardingobjectid";KnowledgeSuggestionConstants.EntityRecord="entityrecord";KnowledgeSuggestionConstants.OCLiveWorkItem="msdyn_ocliveworkitem";KnowledgeSuggestionConstants.OCLiveWorkItemEntitySetName="msdyn_ocliveworkitems";KnowledgeSuggestionConstants.GetKnowledgeSuggestionApi="msdyn_RetrieveKnowledgeSuggestions";KnowledgeSuggestionConstants.EmptyParams="Cannot read params passed in.";KnowledgeSuggestionConstants.EmptyString="";KnowledgeSuggestionConstants.SuggestionInterationEntity="msdyn_suggestioninteraction";KnowledgeSuggestionConstants.AttributeInteractionContext="msdyn_interactioncontext";KnowledgeSuggestionConstants.AttributeInteractionType="msdyn_interactiontype";KnowledgeSuggestionConstants.AttributeSuggestedEntity="msdyn_suggestedentity";KnowledgeSuggestionConstants.AttributeSuggestionFor="msdyn_suggestionfor";KnowledgeSuggestionConstants.AttributeSuggestionInteractionId="msdyn_suggestioninteractionId";KnowledgeSuggestionConstants.AttributeSuggestionRequestPayload="msdyn_suggestionrequestpayload";KnowledgeSuggestionConstants.SuggestedEntityDataBindValue="msdyn_suggestedentity_knowledgearticle@odata.bind";KnowledgeSuggestionConstants.SuggestionForDataBindValue="msdyn_suggestionfor_{0}@odata.bind";KnowledgeSuggestionConstants.SuggestionRequestPayloadDataBindValue="msdyn_suggestionrequestpayload@odata.bind";KnowledgeSuggestionConstants.KAEntitySetName="knowledgearticles";KnowledgeSuggestionConstants.CaseEntitySetName="incidents";KnowledgeSuggestionConstants.SuggestionRequestPayloadEntitySetName="msdyn_suggestionrequestpayloads";KnowledgeSuggestionConstants.OperationFailureMessage="KnowledgeArticle_OperationFailure";KnowledgeSuggestionConstants.SendFeedbackFailedMessage=KnowledgeSuggestionConstants.OperationFailureMessage;KnowledgeSuggestionConstants.EmailArticleFailedMessage=KnowledgeSuggestionConstants.OperationFailureMessage;KnowledgeSuggestionConstants.OpenArticleFailedMessage=KnowledgeSuggestionConstants.OperationFailureMessage;KnowledgeSuggestionConstants.EmailArticleContentFailedMessage=KnowledgeSuggestionConstants.OperationFailureMessage;KnowledgeSuggestionConstants.LinkArticleFailedMessage="KnowledgeSuggestions_LinkArticleFailedMsg";KnowledgeSuggestionConstants.UnlinkArticleFailedMessage="KnowledgeSuggestions_UnlinkArticleFailedMsg";KnowledgeSuggestionConstants.CopyUrlSuccessMessage="KnowledgeArticle_CopyURLSuccessMsg";KnowledgeSuggestionConstants.CopyUrlFailedMessage="KnowledgeArticle_CopyURLFailureMsg";KnowledgeSuggestionConstants.CTIFailedMessage=KnowledgeSuggestionConstants.OperationFailureMessage;KnowledgeSuggestionConstants.CTIFailedMessageForConversationState="KnowledgeArticle_ConversationStateFailureMsg";KnowledgeSuggestionConstants.MaxTabFailureTitle="Error_Title_0x90000008";KnowledgeSuggestionConstants.MaxTabFailureMessage="Error_Message_0x90000008";KnowledgeSuggestionConstants.MaxTabsReachedFailureMessage="KnowledgeSuggestions_MaxTabsReachedFailureMessage";KnowledgeSuggestionConstants.KBArticleImageTagRegex=/<img\s+[^>]*msdyn_knowledgearticleimages[^>]*>/gm;KnowledgeSuggestionConstants.KBArticleImageTagSrcRegex=/src\s*=\s*"([^"]+)"/;KnowledgeSuggestionConstants.KBArticleImageTagmsdyntypeRegex=/data-msdyntype\s*=\s*"([^"]+)"/;KnowledgeSuggestionConstants.ConversationEntityName="msdyn_ocliveworkitem";KnowledgeSuggestionConstants.ConversationStatusCodeAttribute="statuscode";KnowledgeSuggestionConstants.ConversationStatusCodeValue="statuscode@OData.Community.Display.V1.FormattedValue";return KnowledgeSuggestionConstants}();KbCommonUtils.KnowledgeSuggestionConstants=KnowledgeSuggestionConstants})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var FeedbackOptions;(function(FeedbackOptions){FeedbackOptions[FeedbackOptions["NotAvailable"]=0]="NotAvailable";FeedbackOptions[FeedbackOptions["Yes"]=1]="Yes";FeedbackOptions[FeedbackOptions["No"]=2]="No"})(FeedbackOptions=KbCommonUtils.FeedbackOptions||(KbCommonUtils.FeedbackOptions={}))})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var PostKnowledgeSuggestionInteraction=function(){function PostKnowledgeSuggestionInteraction(){}PostKnowledgeSuggestionInteraction.ExecuteOperation=function(recordPayload){return __awaiter(this,void 0,void 0,function(){var suggestionForDataBindKey,record;return __generator(this,function(_a){suggestionForDataBindKey=this.SuggestionForDataBindKey(recordPayload.SuggestionForEntityLogicalName);record={};record[KbCommonUtils.KnowledgeSuggestionConstants.AttributeInteractionType]=recordPayload.InteractionType;record[KbCommonUtils.KnowledgeSuggestionConstants.AttributeInteractionContext]=recordPayload.InteractionContext;record[KbCommonUtils.KnowledgeSuggestionConstants.SuggestedEntityDataBindValue]=KbCommonUtils.KnowledgeSuggestionConstants.KAEntitySetName+"("+recordPayload.SuggestedEntityId+")";record[KbCommonUtils.KnowledgeSuggestionConstants.SuggestionRequestPayloadDataBindValue]=KbCommonUtils.KnowledgeSuggestionConstants.SuggestionRequestPayloadEntitySetName+"("+recordPayload.SuggestionRequestId+")";record[suggestionForDataBindKey]=this.EntitySetNameByLogicalName(recordPayload.SuggestionForEntityLogicalName)+"("+recordPayload.SuggestionForEntityId+")";return [2,window.Xrm.WebApi.createRecord(KbCommonUtils.KnowledgeSuggestionConstants.SuggestionInterationEntity,record)]})})};PostKnowledgeSuggestionInteraction.EntitySetNameByLogicalName=function(EntityLogicalName){if(EntityLogicalName==KbCommonUtils.KnowledgeSuggestionConstants.Incident)return KbCommonUtils.KnowledgeSuggestionConstants.CaseEntitySetName;if(EntityLogicalName==KbCommonUtils.KnowledgeSuggestionConstants.OCLiveWorkItem)return KbCommonUtils.KnowledgeSuggestionConstants.OCLiveWorkItemEntitySetName;return KbCommonUtils.KnowledgeSuggestionConstants.CaseEntitySetName};PostKnowledgeSuggestionInteraction.SuggestionForDataBindKey=function(EntityLogicalName){return KbCommonUtils.KnowledgeSuggestionConstants.SuggestionForDataBindValue.replace("{0}",EntityLogicalName)};return PostKnowledgeSuggestionInteraction}();KbCommonUtils.PostKnowledgeSuggestionInteraction=PostKnowledgeSuggestionInteraction})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionCTIAction=function(_super){__extends(SuggestionCTIAction,_super);function SuggestionCTIAction(){return _super!==null&&_super.apply(this,arguments)||this}SuggestionCTIAction.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){KbCommonUtils.SuggestionActionUtils.PopulateDefaultSuggestionPayload(operationPayload,actionPayload,KbCommonUtils.KnowledgeSuggestionConstants.EmptyString,KbCommonUtils.KnowledgeSuggestionConstants.CTIFailedMessage).then(function(status){contentPromise.resolve(actionPayload)})});return contentPromise.promise()};SuggestionCTIAction.prototype.PreExecuteOperation=function(operationPayload){var actionPromise=$.Deferred();KbCommonUtils.SuggestionActionUtils.PushSuggestionInteraction(operationPayload);var entityName=operationPayload[KbCommonUtils.Constants.SuggestionForEntityLogicalName];entityName==KbCommonUtils.KnowledgeSuggestionConstants.ConversationEntityName&&operationPayload.ControlContext.webAPI.retrieveRecord(entityName,operationPayload[KbCommonUtils.Constants.SuggestionForEntityId],"?$select=statuscode").then(function(record){var customActionReturn=KbCommonUtils.SuggestionActionUtils.getCustomActionReturnObject(operationPayload,{},KbCommonUtils.KnowledgeSuggestionConstants.EmptyString),actionOutput=new KbCommonUtils.ActionOutput;actionOutput.payload=customActionReturn;if(record[KbCommonUtils.KnowledgeSuggestionConstants.ConversationStatusCodeAttribute]!=KbCommonUtils.LiveWorkItemStatus.Open&&record[KbCommonUtils.KnowledgeSuggestionConstants.ConversationStatusCodeAttribute]!=KbCommonUtils.LiveWorkItemStatus.Active){var message=KbCommonUtils.SuggestionActionUtils.getLocalizedString(KbCommonUtils.KnowledgeSuggestionConstants.CTIFailedMessageForConversationState,operationPayload),status_2=record[KbCommonUtils.KnowledgeSuggestionConstants.ConversationStatusCodeValue].toLowerCase(),failureMessage=message.replace("{0}",status_2);customActionReturn.notificationMessage=failureMessage;actionOutput.status=false;actionOutput.payload=customActionReturn}actionPromise.resolve(actionOutput)});return actionPromise.promise()};SuggestionCTIAction.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.SuggestionActionUtils.GetActionOutput(status,operationPayload,error)};SuggestionCTIAction.prototype.PostExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.AddUsageTelemetry("SendToCTI",operationPayload)};return SuggestionCTIAction}(KbCommonUtils.CTIActionOperation);KbCommonUtils.SuggestionCTIAction=SuggestionCTIAction})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionEmailAction=function(_super){__extends(SuggestionEmailAction,_super);function SuggestionEmailAction(){return _super!==null&&_super.apply(this,arguments)||this}SuggestionEmailAction.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){KbCommonUtils.SuggestionActionUtils.ParseRawPayloadForEmailAndLinkActions(contentPromise,operationPayload,actionPayload,true)});return contentPromise.promise()};SuggestionEmailAction.prototype.PreExecuteOperation=function(operationPayload){var actionPromise=_super.prototype.PreExecuteOperation.call(this,operationPayload);KbCommonUtils.SuggestionActionUtils.PushSuggestionInteraction(operationPayload);return actionPromise};SuggestionEmailAction.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.SuggestionActionUtils.GetActionOutput(status,operationPayload,error)};SuggestionEmailAction.prototype.SuccessCallbackAction=function(operationPayload,response){var refreshArgs={type:0,data:{EnableLinkArticle:false,EnableUnlinkArticle:true}};operationPayload.refreshCallback(refreshArgs)};SuggestionEmailAction.prototype.PostExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.AddUsageTelemetry("EmailArticleAction",operationPayload)};return SuggestionEmailAction}(KbCommonUtils.EmailActionOperation);KbCommonUtils.SuggestionEmailAction=SuggestionEmailAction})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionEmailContentAction=function(_super){__extends(SuggestionEmailContentAction,_super);function SuggestionEmailContentAction(){return _super!==null&&_super.apply(this,arguments)||this}SuggestionEmailContentAction.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){KbCommonUtils.SuggestionActionUtils.ParseRawPayloadForEmailAndLinkActions(contentPromise,operationPayload,actionPayload,true)});return contentPromise.promise()};SuggestionEmailContentAction.prototype.PreExecuteOperation=function(operationPayload){var actionPromise=_super.prototype.PreExecuteOperation.call(this,operationPayload);KbCommonUtils.SuggestionActionUtils.PushSuggestionInteraction(operationPayload);return actionPromise};SuggestionEmailContentAction.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.SuggestionActionUtils.GetActionOutput(status,operationPayload,error)};SuggestionEmailContentAction.prototype.SuccessCallbackAction=function(operationPayload,response){var refreshArgs={type:0,data:{EnableLinkArticle:false,EnableUnlinkArticle:true}};operationPayload.refreshCallback(refreshArgs)};SuggestionEmailContentAction.prototype.PostExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.AddUsageTelemetry("EmailArticleContentAction",operationPayload)};return SuggestionEmailContentAction}(KbCommonUtils.EmailContentActionOperation);KbCommonUtils.SuggestionEmailContentAction=SuggestionEmailContentAction})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionFeedbackAction=function(_super){__extends(SuggestionFeedbackAction,_super);function SuggestionFeedbackAction(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(SuggestionFeedbackAction.prototype,"Label",{"get":function(){throw new Error("Method not implemented.")},enumerable:false,configurable:true});Object.defineProperty(SuggestionFeedbackAction.prototype,"Tooltip",{"get":function(){throw new Error("Method not implemented.")},enumerable:false,configurable:true});Object.defineProperty(SuggestionFeedbackAction.prototype,"SymbolCode",{"get":function(){throw new Error("Method not implemented.")},enumerable:false,configurable:true});SuggestionFeedbackAction.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){KbCommonUtils.SuggestionActionUtils.PopulateDefaultSuggestionPayload(operationPayload,actionPayload,KbCommonUtils.KnowledgeSuggestionConstants.EmptyString,KbCommonUtils.KnowledgeSuggestionConstants.SendFeedbackFailedMessage).then(function(status){actionPayload[KbCommonUtils.Constants.Feedback]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.Feedback,operationPayload);actionPayload[KbCommonUtils.Constants.RefreshCallback]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.RefreshCallback,operationPayload);contentPromise.resolve(actionPayload)})});return contentPromise.promise()};SuggestionFeedbackAction.prototype.ExecuteOperation=function(operationPayload){var GetActionOutput=this.GetActionOutput,SuccessCallback=this.SuccessCallbackAction,actionPromise=$.Deferred();try{KbCommonUtils.SuggestionActionUtils.PushSuggestionInteraction(operationPayload);SuccessCallback(operationPayload);actionPromise.resolve(GetActionOutput(true,operationPayload,null))}catch(ex){actionPromise.resolve(GetActionOutput(false,operationPayload,ex))}return actionPromise.promise()};SuggestionFeedbackAction.prototype.PostExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.AddUsageTelemetry("SendFeedbackAction",operationPayload)};SuggestionFeedbackAction.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.SuggestionActionUtils.GetActionOutput(status,operationPayload,error)};SuggestionFeedbackAction.prototype.SuccessCallbackAction=function(operationPayload){var feedback=parseInt(operationPayload[KbCommonUtils.Constants.Feedback]),actionType;if(feedback==KbCommonUtils.FeedbackOptions.Yes)actionType=0;else if(feedback==KbCommonUtils.FeedbackOptions.No)actionType=1;var refreshArgs={type:actionType,data:{HelpfulVote:feedback,IsInteracted:true}};operationPayload[KbCommonUtils.Constants.RefreshCallback](refreshArgs)};return SuggestionFeedbackAction}(KbCommonUtils.ActionOperationBase);KbCommonUtils.SuggestionFeedbackAction=SuggestionFeedbackAction})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionLinkAction=function(_super){__extends(SuggestionLinkAction,_super);function SuggestionLinkAction(){return _super!==null&&_super.apply(this,arguments)||this}SuggestionLinkAction.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){KbCommonUtils.SuggestionActionUtils.ParseRawPayloadForEmailAndLinkActions(contentPromise,operationPayload,actionPayload,false)});return contentPromise.promise()};SuggestionLinkAction.prototype.PreExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.PushSuggestionInteraction(operationPayload)};SuggestionLinkAction.prototype.PostExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.AddUsageTelemetry("LinkAction",operationPayload)};SuggestionLinkAction.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.SuggestionActionUtils.GetActionOutput(status,operationPayload,error)};SuggestionLinkAction.prototype.SuccessCallbackAction=function(operationPayload,response){var refreshArgs={type:0,data:{EnableLinkArticle:false,EnableUnlinkArticle:true}};operationPayload[KbCommonUtils.Constants.MarkSentToCustomer]&&KbCommonUtils.EmailActionUtils.markArticleSentToCustomer(operationPayload);operationPayload[KbCommonUtils.Constants.RefreshCallback](refreshArgs)};return SuggestionLinkAction}(KbCommonUtils.LinkActionOperation);KbCommonUtils.SuggestionLinkAction=SuggestionLinkAction})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionOpenArticleAction=function(_super){__extends(SuggestionOpenArticleAction,_super);function SuggestionOpenArticleAction(){return _super!==null&&_super.apply(this,arguments)||this}SuggestionOpenArticleAction.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){KbCommonUtils.SuggestionActionUtils.PopulateDefaultSuggestionPayload(operationPayload,actionPayload,KbCommonUtils.KnowledgeSuggestionConstants.EmptyString,KbCommonUtils.KnowledgeSuggestionConstants.OpenArticleFailedMessage).then(function(status){contentPromise.resolve(actionPayload)})});return contentPromise.promise()};SuggestionOpenArticleAction.prototype.PreExecuteOperation=function(operationPayload){var actionPromise=_super.prototype.PreExecuteOperation.call(this,operationPayload);KbCommonUtils.SuggestionActionUtils.PushSuggestionInteraction(operationPayload);return actionPromise};SuggestionOpenArticleAction.prototype.PostExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.AddUsageTelemetry("OpenArticleAction",operationPayload)};SuggestionOpenArticleAction.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.SuggestionActionUtils.GetActionOutput(status,operationPayload,error)};return SuggestionOpenArticleAction}(KbCommonUtils.OpenResultActionOperation);KbCommonUtils.SuggestionOpenArticleAction=SuggestionOpenArticleAction})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionUnlinkAction=function(_super){__extends(SuggestionUnlinkAction,_super);function SuggestionUnlinkAction(){return _super!==null&&_super.apply(this,arguments)||this}SuggestionUnlinkAction.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){KbCommonUtils.SuggestionActionUtils.ParseRawPayloadForEmailAndLinkActions(contentPromise,operationPayload,actionPayload,false)});return contentPromise.promise()};SuggestionUnlinkAction.prototype.PreExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.PushSuggestionInteraction(operationPayload)};SuggestionUnlinkAction.prototype.PostExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.AddUsageTelemetry("UnlinkAction",operationPayload)};SuggestionUnlinkAction.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.SuggestionActionUtils.GetActionOutput(status,operationPayload,error)};SuggestionUnlinkAction.prototype.SuccessCallbackAction=function(operationPayload,response){var refreshArgs={type:0,data:{EnableLinkArticle:true,EnableUnlinkArticle:false}};operationPayload[KbCommonUtils.Constants.RefreshCallback](refreshArgs)};return SuggestionUnlinkAction}(KbCommonUtils.UnlinkActionOperation);KbCommonUtils.SuggestionUnlinkAction=SuggestionUnlinkAction})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KbCommonDataHandler=function(){function KbCommonDataHandler(){}KbCommonDataHandler.GetNodeValue=function(dom,nodeName){if(dom.getElementsByTagName(KbCommonUtils.Constants.KMSettings).length>0&&dom.getElementsByTagName(KbCommonUtils.Constants.KMSettings)[0].getElementsByTagName(nodeName).length>0&&dom.getElementsByTagName(KbCommonUtils.Constants.KMSettings)[0].getElementsByTagName(nodeName)[0].childNodes.length>0)return dom.getElementsByTagName(KbCommonUtils.Constants.KMSettings)[0].getElementsByTagName(nodeName)[0].childNodes[0].nodeValue;return null};KbCommonDataHandler.GetKMSettings=function(context){var kmSettingsUri=KbCommonUtils.Constants.ODATA_PATH+KbCommonUtils.Constants.KMSettingsUri;return KbCommonUtils.FetchApiHelper.Fetch(context,KbCommonUtils.GET_METHOD,kmSettingsUri).then(function(result){var organizationRecord=result.value[0],kmSettingsXml=organizationRecord.kmsettings,parser=new DOMParser,dom=parser.parseFromString(kmSettingsXml,"application/xml"),kmSettingsResponse={organizationId:organizationRecord.organizationid,kmSettings:{isParature:Boolean(JSON.parse(KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.IsParatureKMSetting))),useExternalPortal:Boolean(JSON.parse(KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.UseExternalPortalKMSetting))),nativeCrmUrl:KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.NativeCrmUrlKMSetting),enableKMRating:Boolean(JSON.parse(KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.EnableKMRatingKMSetting)?KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.EnableKMRatingKMSetting):KbCommonUtils.Constants.DefaultEnableKMRatingKMSettingValue)),enableLanguageSettings:Boolean(JSON.parse(KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.EnableLanguageSettingsKMSetting))),useOrgUILanguage:Boolean(JSON.parse(KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.UseOrgUILanguageKMSetting))),kaAuthoringLanguage:KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.KAAuthoringLanguageKMSetting),enableLanguagePersonalization:Boolean(JSON.parse(KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.EnableLanguagePersonalizationKMSetting))),enableFilterPersonalization:Boolean(JSON.parse(KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.EnableFilterPersonalizationKMSetting))),enableFilterCustomization:Boolean(JSON.parse(KbCommonDataHandler.GetNodeValue(dom,KbCommonUtils.Constants.EnableFilterCustomizationKMSetting)))}};return kmSettingsResponse},function(error){return null})};return KbCommonDataHandler}();KbCommonUtils.KbCommonDataHandler=KbCommonDataHandler})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var AssociateKnowledgeArticleRequest=function(){function AssociateKnowledgeArticleRequest(regardingObjectId,regardingObjectTypeCode,associationRelationshipName,knowledgeArticleId,entityName){this.RegardingObjectId=regardingObjectId;this.RegardingObjectTypeCode=regardingObjectTypeCode;this.AssociationRelationshipName=associationRelationshipName;this.KnowledgeArticleId=knowledgeArticleId;this.EntityName=entityName}AssociateKnowledgeArticleRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{RegardingObjectId:{typeName:"Edm.String",structuralProperty:1},RegardingObjectTypeCode:{typeName:"Edm.Int32",structuralProperty:1},AssociationRelationshipName:{typeName:"Edm.String",structuralProperty:1},KnowledgeArticleId:{typeName:"Edm.String",structuralProperty:1},EntityName:{typeName:"Edm.String",structuralProperty:1}},operationName:"AssociateKnowledgeArticle",operationType:0};return metadata};return AssociateKnowledgeArticleRequest}();KbCommonUtils.AssociateKnowledgeArticleRequest=AssociateKnowledgeArticleRequest})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var DisassociateKnowledgeArticleRequest=function(){function DisassociateKnowledgeArticleRequest(regardingObjectId,regardingObjectTypeCode,associationRelationshipName,knowledgeArticleId,entityName){this.RegardingObjectId=regardingObjectId;this.RegardingObjectTypeCode=regardingObjectTypeCode;this.AssociationRelationshipName=associationRelationshipName;this.KnowledgeArticleId=knowledgeArticleId;this.EntityName=entityName}DisassociateKnowledgeArticleRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{RegardingObjectId:{typeName:"Edm.String",structuralProperty:1},RegardingObjectTypeCode:{typeName:"Edm.Int32",structuralProperty:1},AssociationRelationshipName:{typeName:"Edm.String",structuralProperty:1},KnowledgeArticleId:{typeName:"Edm.String",structuralProperty:1},EntityName:{typeName:"Edm.String",structuralProperty:1}},operationName:"DisassociateKnowledgeArticle",operationType:0};return metadata};return DisassociateKnowledgeArticleRequest}();KbCommonUtils.DisassociateKnowledgeArticleRequest=DisassociateKnowledgeArticleRequest})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var FetchApiHelper=function(){function FetchApiHelper(){}FetchApiHelper.ProcessInnerException=function(error){var innerExceptionStringParts=[];error.type&&innerExceptionStringParts.push(error.type);error.message&&innerExceptionStringParts.push(error.message);error.stacktrace&&innerExceptionStringParts.push(error.stacktrace);return innerExceptionStringParts.join("\r\n")};FetchApiHelper.ShowErrorMessage=function(error){if(error){if(error.error)error=error.error;var errorMessage=error.message,errorCode=error.code,details="";if(error.innererror)details=FetchApiHelper.ProcessInnerException(error.innererror);if(errorMessage&&errorCode){var errorDialogOptions={errorCode:parseInt(errorCode),message:errorMessage,details:details};window.Xrm.Navigation.openErrorDialog(errorDialogOptions)}}};FetchApiHelper.Fetch=function(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders){var additionalTelemetryEventParameters=[],queryStr=odataUri,queryStrIndex=queryStr.indexOf("?");if(queryStrIndex!==-1)queryStr=queryStr.substr(0,queryStrIndex);additionalTelemetryEventParameters.push({name:"queryUri",value:queryStr});resourceUri&&additionalTelemetryEventParameters.push({name:"resourceUrl",value:resourceUri});kmAppMethod&&additionalTelemetryEventParameters.push({name:"kmAppMethod",value:kmAppMethod});var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(context,"KnowledgeManagement","KbCommonUtils.FetchApiWrapper.Fetch",additionalTelemetryEventParameters);if(loadUsingProxy){var deferred_1=$.Deferred(),jsonData={method:kmAppMethod,data:{resourceUri:resourceUri,methodType:method,apiUrl:resourceUri+odataUri,clientUri:context.page.getClientUrl(),additionalHeaders:additionalHeaders||{}}};if(data&&data!="")jsonData.data.postdata=data;MscrmControls.KbCommonUtils.WindowPostMessageProxy.Instance().postMessage(jsonData).then(function(response){watermarkTelemetryEvent.End();return deferred_1.resolve(response)},function(error){watermarkTelemetryEvent.End();KbCommonUtils.TelemetryReporter.LogError(context,{controlType:KbCommonUtils.TelemetryControlType.KbCommonUtils,errorMessage:"KbCommonUtils.FetchApiWrapper.Fetch: "+error});return deferred_1.reject(error)});return deferred_1.promise()}else if(!context.client.userAgent.isIos&&typeof window.fetch==="function"){var input=null,init=null;if(method==KbCommonUtils.GET_METHOD)input=new Request(context.page.getClientUrl()+odataUri,{method:method,credentials:"same-origin"});else{input=context.page.getClientUrl()+odataUri;init={method:method,credentials:"same-origin",headers:{"Content-Type":"application/json",prefer:'odata.include-annotations="*"',"odata-maxversion":"4.0","odata-version":"4.0"},body:data}}return fetch(input,init).then(function(res){watermarkTelemetryEvent.End();if(res.ok){if(res.status===204)return "";return res.json()}else{var errorReader_1=res.body.getReader(),errorString_1="",errorDeferred_1=$.Deferred();errorReader_1.read().then(function processText(streamResponse){if(streamResponse.done){var errorObject=JSON.parse(errorString_1);KbCommonUtils.TelemetryReporter.LogError(context,{controlType:KbCommonUtils.TelemetryControlType.KbCommonUtils,errorMessage:"KbCommonUtils.FetchApiWrapper.Fetch: "+errorObject});FetchApiHelper.ShowErrorMessage(errorObject);errorDeferred_1.reject(errorObject);return}errorString_1+=String.fromCharCode.apply(null,streamResponse.value);return errorReader_1.read().then(processText)});return errorDeferred_1.promise()}})}else{var deferred_2=$.Deferred(),xhr_1=new XMLHttpRequest;xhr_1.onreadystatechange=function(){if(xhr_1.readyState!==4)return;watermarkTelemetryEvent.End();if(xhr_1.status===204)deferred_2.resolve("");else if(xhr_1.status>=200&&xhr_1.status<300&&xhr_1.responseText&&xhr_1.responseText.length>0)deferred_2.resolve(JSON.parse(xhr_1.responseText));else{var errorObject=JSON.parse(xhr_1.responseText);KbCommonUtils.TelemetryReporter.LogError(context,{controlType:KbCommonUtils.TelemetryControlType.KbCommonUtils,errorMessage:"KbCommonUtils.FetchApiWrapper.Fetch: "+errorObject});FetchApiHelper.ShowErrorMessage(errorObject);deferred_2.reject(errorObject);return}};xhr_1.open(method,context.page.getClientUrl()+odataUri);if(method==KbCommonUtils.GET_METHOD)xhr_1.send();else{xhr_1.setRequestHeader("Content-Type","application/json; charset=UTF-8");xhr_1.setRequestHeader("accept","application/json");xhr_1.setRequestHeader("prefer",'odata.include-annotations="*"');xhr_1.setRequestHeader("odata-maxversion","4.0");xhr_1.setRequestHeader("odata-version","4.0");xhr_1.send(data)}return deferred_2.promise()}};return FetchApiHelper}();KbCommonUtils.FetchApiHelper=FetchApiHelper})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";KbCommonUtils.GET_METHOD="GET";KbCommonUtils.POST_METHOD="POST";var StreamResponseStructure=function(){function StreamResponseStructure(){}return StreamResponseStructure}();KbCommonUtils.StreamResponseStructure=StreamResponseStructure;var CancelableFetchApiWrapper=function(){function CancelableFetchApiWrapper(){this.activePromises={}}CancelableFetchApiWrapper.prototype.GetCancelablePromise=function(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders){var isCanceled=false,deffered=$.Deferred(),wrappedPromise=KbCommonUtils.FetchApiHelper.Fetch(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders);wrappedPromise.then(function(response){if(isCanceled)deffered.reject({isCanceled:true,error:response});else deffered.resolve(response)},function(error){if(isCanceled)deffered.reject({isCanceled:true,error:error});else deffered.reject(error)});var promise=deffered.promise();return {promise:promise,cancel:function(){isCanceled=true}}};CancelableFetchApiWrapper.prototype.hasKey=function(key){return Object.keys(this.activePromises).indexOf(key)!==-1};CancelableFetchApiWrapper.prototype.makeid=function(length){for(var result,count=0;count<10;count++){result="";for(var characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",charactersLength=characters.length,i=0;i<length;i++)result+=characters.charAt(Math.floor(Math.random()*charactersLength));if(!this.hasKey(result))return result}throw"Unique key generation for maintaing active promises failed."};CancelableFetchApiWrapper.prototype.AddCancelablePromise=function(cancelablePromise){var _this=this,key=this.makeid(10);this.activePromises[key]=cancelablePromise;cancelablePromise.promise.then(function(){return delete _this.activePromises[key]},function(){return delete _this.activePromises[key]});return cancelablePromise};CancelableFetchApiWrapper.prototype.Fetch=function(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders){var cancelablePromise=this.GetCancelablePromise(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders);cancelablePromise=this.AddCancelablePromise(cancelablePromise);return cancelablePromise.promise};CancelableFetchApiWrapper.prototype.Destroy=function(){for(var _i=0,_a=Object.keys(this.activePromises);_i<_a.length;_i++){var key=_a[_i],cancelablePromise=this.activePromises[key];cancelablePromise.cancel();delete this.activePromises[key]}};return CancelableFetchApiWrapper}();KbCommonUtils.CancelableFetchApiWrapper=CancelableFetchApiWrapper})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var Constants=function(){function Constants(){}Constants.ODATA_PATH="/api/data/v9.0";Constants.URL_KA_TITLE_CONTENT="/knowledgearticles?$select=content&$filter=knowledgearticleid eq {0}";Constants.AssociateEndpoint="/AssociateKnowledgeArticle";Constants.DisassociateEndpoint="/DisassociateKnowledgeArticle";Constants.IncreaseViewEndpoint="/IncrementKnowledgeArticleViewCount(Source=@Source,ViewDate=@ViewDate,Location=@Location,Count=@Count)?@Source={'@odata.id':'knowledgearticles({0})'}&@ViewDate={1}&@Location={2}&@Count={3}";Constants.RetrieveKMControlSettingsEndpoint="/RetrieveKMControlInitializationSettings";Constants.KMSettingsUri="/organizations?$select=kmsettings";Constants.KMPersonalFilterUri="/msdyn_knowledgepersonalfilters?$filter=msdyn_knowledgepersonalfilterid eq {0}&$select=msdyn_preferredvalues";Constants.KMSettings="KMSettings";Constants.IsParatureKMSetting="IsParature";Constants.UseExternalPortalKMSetting="UseExternalPortal";Constants.NativeCrmUrlKMSetting="NativeCrmUrl";Constants.EnableKMRatingKMSetting="EnableKMRating";Constants.EnableLanguageSettingsKMSetting="EnableLanguageSettings";Constants.UseOrgUILanguageKMSetting="UseOrgUILanguage";Constants.KAAuthoringLanguageKMSetting="KAAuthoringLanguage";Constants.EnableLanguagePersonalizationKMSetting="EnableLanguagePersonalization";Constants.EnableFilterPersonalizationKMSetting="EnableFilterPersonalization";Constants.EnableFilterCustomizationKMSetting="EnableFilterCustomization";Constants.ViewDateFormat="YYYY-MM-DD";Constants.KnowledgeArticleEntityType="knowledgearticle";Constants.OrganizationEntityType="organization";Constants.IncidentRelationshipName="knowledgearticlescategories";Constants.NumberOfViewsIconToolTip="SearchWidget.SearchKMArticles.NumberOfViewsToolTip";Constants.ModifiedOnLabelToolTip="SearchWidget.SearchKMArticles.LastModifiedDateLabelToolTip";Constants.RatingIconToolTip="SearchWidget.SearchKMArticles.RatingIconToolTip";Constants.ModifiedOnLabel="SearchWidget.SearchKMArticles.LastModifiedDateLabel";Constants.CopyLinkButtonLabel="SearchWidget.SearchKMArticles.CopyLinkButtonLabel";Constants.CopyLinkButtonTooltip="SearchWidget.SearchKMArticles.CopyLinkButtonTooltip";Constants.PrintArticleButtonLabel="SearchWidget.SearchKMArticles.PrintArticleButtonLabel";Constants.PrintArticleButtonTooltip="SearchWidget.SearchKMArticles.PrintArticleButtonTooltip";Constants.InsertContentDialogButtonTooltip="SearchWidget.SearchKMArticles.InsertContentDialogButtonTooltip";Constants.InsertContentDialogButtonLabel="SearchWidget.SearchKMArticles.InsertContentDialogButtonLabel";Constants.InsertURLDialogButtonTooltip="SearchWidget.SearchKMArticles.InsertURLDialogButtonTooltip";Constants.InsertURLDialogButtonLabel="SearchWidget.SearchKMArticles.InsertURLDialogButtonLabel";Constants.CopyLinkSuccessMsg="SearchWidget.SearchKMArticles.CopyLinkSuccessMsg";Constants.CopyLinkFailedMsg="SearchWidget.SearchKMArticles.CopyLinkFailedMsg";Constants.ConfirmDialogTitleForImageLoad="SearchWidget.SearchKMArticles.ConfirmDialogTitleForImageLoad";Constants.ConfirmDialogTextForImageLoadFailure="SearchWidget.SearchKMArticles.ConfirmDialogTextForImageLoadFailure";Constants.Incident="incident";Constants.ConversationEntityName="msdyn_ocliveworkitem";Constants.StatusCodeAttribute="statuscode";Constants.StatusCodeValue="statuscode@OData.Community.Display.V1.FormattedValue";Constants.ShowArticle="article";Constants.KnowledgeArticleIncident="knowledgearticleincident";Constants.KnowledgeSearchEntityName="msdyn_knowledgesearchinsight";Constants.KnowledgeInteractionEntityName="msdyn_knowledgeinteractioninsight";Constants.KMSuggestionForCase="kmsuggestionforcase";Constants.Email="email";Constants.Feedback="feedback";Constants.RegardingObjectId="regardingobjectid";Constants.ContextObjectId="msdyn_contextobjectid";Constants.DefaultEnableKMRatingKMSettingValue="true";Constants.AllDraftArticlesResourceName="SearchWidget.Filters.AllDraftArticles";Constants.AllPublishedArticlesResourceName="SearchWidget.Filters.AllPublishedArticles";Constants.AllApprovedArticlesResourceName="SearchWidget.Filters.AllApprovedArticles";Constants.AllScheduledArticlesResourceName="SearchWidget.Filters.AllScheduledArticles";Constants.AllExpiredArticlesResourceName="SearchWidget.Filters.AllExpiredArticles";Constants.AllArchivedArticlesResourceName="SearchWidget.Filters.AllArchivedArticles";Constants.AllDiscardedArticlesResourceName="SearchWidget.Filters.AllDiscardedArticles";Constants.ConfirmDialogTitle="SearchWidget.SearchKMArticles.ConfirmDialogTitle";Constants.ConfirmDialogTextResourceName="SearchWidget.SearchKMArticles.ConfirmDialogText";Constants.RecordDoesNotExistErrorMessageResourceName="SearchWidget.SearchKMArticles.RecordDoesNotExistErrorMessageResourceName";Constants.CTIFailedMessageForConversationStateResourceName="KMControl.SearchKMArticles.CTIFailedMessageForConversationStateMessage";Constants.CTIFailedMessageForConversationStateTitleResourceName="KMControl.SearchKMArticles.CTIFailedMessageForConversationStateTitle";Constants.WebresourceNameArticleActions="ArticleActions";Constants.EnterKeyValue="Enter";Constants.ServerSearchFailure="SearchWidget.SearchKMArticles.ServerFailure";Constants.KBArticleControlID="kbarticle";Constants.GLOBAL_NOTIFICATION_TYPE_TOAST=1;Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS=1;Constants.UCKMControlRelevanceSearch="UCKMControlRelevanceSearch";Constants.COLOR_ACTION_ICON="#3B79B7";Constants.COLOR_ACTION_TITLE="#323130";Constants.BGCOLOR_ACTION="#F3F2F1";Constants.COLOR_HOVER_ACTION="#2E5FA4";Constants.COLOR_SEARCH_RESULT_LABEL="#323130";Constants.COLOR_SEARCH_RESULT_LABEL_CONTAINER="#FFF";Constants.BGCOLOR_SEARCH_RESULT_LABEL_CONTAINER="#CCDEFF";Constants.MiddleDotUnicode="\u00b7";Constants.Rating="Rating";Constants.NumberOfViews="NumberOfViews";Constants.KBArticleImageTagRegex=/<img\s+[^>]*msdyn_knowledgearticleimages[^>]*>/gm;Constants.KBArticleImageTagSrcRegex=/src\s*=\s*"([^"]+)"/;Constants.KBArticleImageTagmsdyntypeRegex=/data-msdyntype\s*=\s*"([^"]+)"/;Constants.ExtraQueryString="extraqs";Constants.KnowledgeOperationIdParameter="knowledgeOperationId";Constants.ArticleRankParameter="articlerank";Constants.UnknownApp="unknownapp";Constants.DefaultSearchprovidername="CurrentOrg";Constants.AccessibilityLabelStyle={border:"0",clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:"0",position:"absolute",width:"1px"};Constants.ArticleState={Draft:"0",Approved:"1",Scheduled:"2",Published:"3",Expired:"4",Archived:"5",Discarded:"6"};Constants.PopOutArticleUri="/main.aspx?pagetype=kbarticle&navbar=off&forceUCI=1&articleId=";Constants.KmSearchServiceAppIFrameId="KbSearchControl_KmSearchServiceApp";Constants.KmSearchServiceAppIFrameTitle="KbSearchControl KmSearchServiceApp Frame";Constants.CrossDynamicsOrgApiCall="DynamicsOdataApi";Constants.MicrosoftSearchApiCall="ExternalRESTOdataApi";Constants.MicrosoftSearchSharePointEntityType="driveItem";Constants.MicrosoftSearchConnectorEntityType="externalItem";Constants.FederatedSearchConfig="msdyn_kmfederatedsearchconfigs";Constants.FederatedArticle="msdyn_federatedarticle";Constants.FederatedArticleIncident="msdyn_federatedarticleincident";Constants.FederatedArticleIncidents="msdyn_federatedarticleincidents";Constants.RetrieveSearchProviders="msdyn_RetrieveSearchProviders";Constants.FederatedSearchConfigId="Kmfederatedsearchconfigid";Constants.FederatedSearchProviderName="Msdyn_name";Constants.FederatedSearchIsDefault="Isdefault";Constants.FederatedSearchProviderType="Searchtype";Constants.FederatedSearchOrganizationUrl="Organization";Constants.FederatedSearchConnectionId="Connectionid";Constants.FederatedSearchSharepointUrl="Sharepointurl";Constants.FederatedArticleId="msdyn_federatedarticleid";Constants.FederatedArticleIdValue="_msdyn_federatedarticleid_value";Constants.FederatedArticleIncidentId="msdyn_federatedarticleincidentid";Constants.FederatedSearchProviderArticleId="msdyn_searchproviderarticleid";Constants.MAX_TAB_FAILURE="maxTabFailure";Constants.MaxTabFailureTitle="Error_Title_0x90000008";Constants.MaxTabFailureMessage="Error_Message_0x90000008";Constants.SuccessMessage="successMessage";Constants.FailureMessage="failureMessage";Constants.Browser="browser";Constants.ActionCallback="actionCallback";Constants.AssociatedEntityId="associatedEntityId";Constants.AssociatedEntityType="associatedEntityType";Constants.AssociationRelationshipName="associationRelationshipName";Constants.FetchApiWrapper="fetchApiWrapper";Constants.ActionName="actionName";Constants.RefreshCallback="refreshCallback";Constants.SelectPrimaryCustomer="selectPrimaryCustomer";Constants.IsRelevanceSearchEnabled="isRelevanceSearchEnabled";Constants.IsAssociated="isAssociated";Constants.ContentToMail="contentToMail";Constants.ResourceUri="resourceUri";Constants.SearchProviderType="searchProviderType";Constants.ShowResultNotification="showResultNotification";Constants.KmPrivileges="kmPrivileges";Constants.UseExternalKMPortal="useExternalKMPortal";Constants.StateCode="stateCode";Constants.ExternalKMPortalURL="externalKMPortalURL";Constants.ArticlePublicNumber="articlePublicNumber";Constants.AssociatedEntityReference="associatedEntityReference";Constants.UserId="userId";Constants.MarkSentToCustomer="markSentToCustomer";Constants.IsExternalSearchIndexEnabled="isExternalSearchIndexEnabled";Constants.SuggestionForEntityLogicalName="suggestionForEntityLogicalName";Constants.SuggestionForEntityId="suggestionForEntityId";Constants.SuggestionRequestId="suggestionRequestId";Constants.TabContext="tabContext";Constants.SessionContext="sessionContext";Constants.LocDictionary="locDictionary";Constants.ExternalArticleUrlIframeViewKey="iframe=1";Constants.RetrieveKnowledgeSearchFilters="msdyn_RetrieveKnowledgeSearchFilters";Constants.RetrieveKnowledgeSearchModifiers="msdyn_RetrieveKnowledgeSearchModifiers";return Constants}();KbCommonUtils.Constants=Constants;var KnowledgeArticleState;(function(KnowledgeArticleState){KnowledgeArticleState[KnowledgeArticleState["Draft"]=0]="Draft";KnowledgeArticleState[KnowledgeArticleState["Approved"]=1]="Approved";KnowledgeArticleState[KnowledgeArticleState["Scheduled"]=2]="Scheduled";KnowledgeArticleState[KnowledgeArticleState["Published"]=3]="Published";KnowledgeArticleState[KnowledgeArticleState["Expired"]=4]="Expired";KnowledgeArticleState[KnowledgeArticleState["Archived"]=5]="Archived";KnowledgeArticleState[KnowledgeArticleState["Discarded"]=6]="Discarded"})(KnowledgeArticleState=KbCommonUtils.KnowledgeArticleState||(KbCommonUtils.KnowledgeArticleState={}))})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KmAppServiceHelper=function(){function KmAppServiceHelper(){}KmAppServiceHelper.loadKmServiceAppIframe=function(context,methodName){var deferred=$.Deferred(),kmSearchServiceAppIframeElement,watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(context,methodName,methodName+".loadKmServiceAppIframe");kmSearchServiceAppIframeElement=document.getElementById(KbCommonUtils.Constants.KmSearchServiceAppIFrameId);if(kmSearchServiceAppIframeElement==null){var kmSearchServiceIframeNewElement=document.createElement("iframe");kmSearchServiceIframeNewElement.style.height="0";kmSearchServiceIframeNewElement.style.width="0";kmSearchServiceIframeNewElement.name=KbCommonUtils.Constants.KmSearchServiceAppIFrameId;kmSearchServiceIframeNewElement.id=KbCommonUtils.Constants.KmSearchServiceAppIFrameId;kmSearchServiceIframeNewElement.src=KbCommonUtils.OrganizationSettings.FirstPartyEndpoint;kmSearchServiceIframeNewElement.title=KbCommonUtils.Constants.KmSearchServiceAppIFrameTitle;kmSearchServiceIframeNewElement.onload=function(){KbCommonUtils.WindowPostMessageProxy.Instance(kmSearchServiceIframeNewElement).register();watermarkTelemetryEvent.End();deferred.resolve()};kmSearchServiceIframeNewElement.onerror=function(error){watermarkTelemetryEvent.EndAndLogError({controlType:KbCommonUtils.TelemetryControlType.KbEnvironmentSelector,errorMessage:"KmAppServiceHelper.loadKmServiceAppIframe - KmApp Frame Load"+error});kmSearchServiceIframeNewElement.parentNode.removeChild(kmSearchServiceIframeNewElement);deferred.resolve()};document.body.appendChild(kmSearchServiceIframeNewElement)}else{MscrmControls.KbCommonUtils.WindowPostMessageProxy.Instance(kmSearchServiceAppIframeElement).register();watermarkTelemetryEvent.End();deferred.resolve()}return deferred.promise()};return KmAppServiceHelper}();KbCommonUtils.KmAppServiceHelper=KmAppServiceHelper})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var FetchWrapperFactory=function(){function FetchWrapperFactory(){}FetchWrapperFactory.prototype.GetWrapper=function(){if(this.wrapper===undefined)this.wrapper=new KbCommonUtils.CancelableFetchApiWrapper;return this.wrapper};return FetchWrapperFactory}();KbCommonUtils.FetchWrapperFactory=FetchWrapperFactory})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var RetrieveKMSettingsResponse=function(){function RetrieveKMSettingsResponse(){}return RetrieveKMSettingsResponse}();KbCommonUtils.RetrieveKMSettingsResponse=RetrieveKMSettingsResponse;var KMSettings=function(){function KMSettings(){}return KMSettings}();KbCommonUtils.KMSettings=KMSettings})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var WindowPostMessageProxy=function(){function WindowPostMessageProxy(){this.pendingRequestPromises={};this.pendingRequestTimers={};this.counter=0}WindowPostMessageProxy.defaultAddTrackingProperties=function(message,trackingProperties){message[WindowPostMessageProxy.messagePropertyName]=trackingProperties;return message};WindowPostMessageProxy.defaultGetTrackingProperties=function(message){return message[WindowPostMessageProxy.messagePropertyName]};WindowPostMessageProxy.defaultIsErrorMessage=function(message){return !!message.error||!!message.data.error};WindowPostMessageProxy.createGUID=function(){return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};WindowPostMessageProxy.prototype.initialize=function(){var _this_1=this;this.addTrackingProperties=WindowPostMessageProxy.defaultAddTrackingProperties;this.getTrackingProperties=WindowPostMessageProxy.defaultGetTrackingProperties;this.isErrorMessage=WindowPostMessageProxy.defaultIsErrorMessage;this.receiveWindow=window;this.name=WindowPostMessageProxy.createGUID();this.windowMessageHandler=function(event){return _this_1.onMessageReceived(event)}};WindowPostMessageProxy.Instance=function(targetWindow){if(!WindowPostMessageProxy._instance&&targetWindow){WindowPostMessageProxy._instance=new WindowPostMessageProxy;WindowPostMessageProxy._instance.initialize();WindowPostMessageProxy._instance.targetWindow=targetWindow}return WindowPostMessageProxy._instance};WindowPostMessageProxy.prototype.register=function(){0==this.counter++&&this.receiveWindow.addEventListener("message",this.windowMessageHandler)};WindowPostMessageProxy.prototype.deregister=function(){0==--this.counter&&this.receiveWindow.removeEventListener("message",this.windowMessageHandler)};WindowPostMessageProxy.prototype.postMessage=function(message){var trackingProperties={id:WindowPostMessageProxy.createGUID()};this.addTrackingProperties(message,trackingProperties);this.targetWindow.contentWindow.postMessage(message,this.targetWindow.src);var deferred=$.Deferred();this.pendingRequestPromises[trackingProperties.id]=deferred;var _this=this;this.pendingRequestTimers[trackingProperties.id]=setTimeout(function(){_this.pendingRequestTimers[trackingProperties.id]&&clearTimeout(_this.pendingRequestTimers[trackingProperties.id]);if(_this.pendingRequestPromises[trackingProperties.id]){delete _this.pendingRequestPromises[trackingProperties.id];deferred.reject({message:"Request Timed out."})}},3e4);return deferred.promise()};WindowPostMessageProxy.prototype.onMessageReceived=function(event){if(event.origin!==KbCommonUtils.OrganizationSettings.FirstPartyEndpoint)return;var message=event.data;if(typeof message!=="object")return;var trackingProperties;try{trackingProperties=this.getTrackingProperties(message)}catch(e){}var deferred;if(trackingProperties)deferred=this.pendingRequestPromises[trackingProperties.id];if(deferred){delete this.pendingRequestPromises[trackingProperties.id];this.pendingRequestTimers[trackingProperties.id]&&clearTimeout(this.pendingRequestTimers[trackingProperties.id]);var isErrorMessage=true;try{isErrorMessage=this.isErrorMessage(message)}catch(e){console.warn("Proxy("+this.name+") Error occurred when trying to determine if message is consider an error response. Message: ",JSON.stringify(message,null,""),"Error: ",e)}if(isErrorMessage)deferred.reject(message.error||message.data.error);else deferred.resolve(message.data)}};WindowPostMessageProxy.messagePropertyName="windowPostMessageProxy";return WindowPostMessageProxy}();KbCommonUtils.WindowPostMessageProxy=WindowPostMessageProxy})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var ArticleAction;(function(ArticleAction){ArticleAction[ArticleAction["LinkArticle"]=0]="LinkArticle";ArticleAction[ArticleAction["UnlinkArticle"]=1]="UnlinkArticle";ArticleAction[ArticleAction["CopyLink"]=2]="CopyLink";ArticleAction[ArticleAction["EmailArticle"]=3]="EmailArticle";ArticleAction[ArticleAction["PopoutArticle"]=4]="PopoutArticle";ArticleAction[ArticleAction["EmailArticleContent"]=5]="EmailArticleContent";ArticleAction[ArticleAction["OpenResult"]=6]="OpenResult";ArticleAction[ArticleAction["SelectedResult"]=7]="SelectedResult";ArticleAction[ArticleAction["SendToCTI"]=8]="SendToCTI";ArticleAction[ArticleAction["PrintArticle"]=9]="PrintArticle";ArticleAction[ArticleAction["SelectContent"]=10]="SelectContent";ArticleAction[ArticleAction["UnselectContent"]=11]="UnselectContent";ArticleAction[ArticleAction["SelectUrl"]=12]="SelectUrl";ArticleAction[ArticleAction["UnselectUrl"]=13]="UnselectUrl";ArticleAction[ArticleAction["IncreaseView"]=14]="IncreaseView";ArticleAction[ArticleAction["SendFeedback"]=15]="SendFeedback"})(ArticleAction=KbCommonUtils.ArticleAction||(KbCommonUtils.ArticleAction={}));var IconSymbolCode;(function(IconSymbolCode){IconSymbolCode[IconSymbolCode["More"]=12]="More";IconSymbolCode[IconSymbolCode["Lock"]=26]="Lock";IconSymbolCode[IconSymbolCode["LinkArticle"]=74]="LinkArticle";IconSymbolCode[IconSymbolCode["UnlinkArticle"]=75]="UnlinkArticle";IconSymbolCode[IconSymbolCode["CopyLink"]=76]="CopyLink";IconSymbolCode[IconSymbolCode["EmailLink"]=77]="EmailLink";IconSymbolCode[IconSymbolCode["PrintArticle"]=456]="PrintArticle";IconSymbolCode[IconSymbolCode["SendEmail"]=63]="SendEmail";IconSymbolCode[IconSymbolCode["OpenInBrowser"]=120]="OpenInBrowser";IconSymbolCode[IconSymbolCode["Default"]=128]="Default";IconSymbolCode[IconSymbolCode["PopoutArticle"]=234]="PopoutArticle";IconSymbolCode[IconSymbolCode["CopyLinkNew"]=235]="CopyLinkNew";IconSymbolCode[IconSymbolCode["LinkArticleNew"]=461]="LinkArticleNew";IconSymbolCode[IconSymbolCode["UnlinkArticleNew"]=462]="UnlinkArticleNew";IconSymbolCode[IconSymbolCode["PopoutArticleNew"]=459]="PopoutArticleNew";IconSymbolCode[IconSymbolCode["NumberOfViews"]=176]="NumberOfViews";IconSymbolCode[IconSymbolCode["Rating"]=431]="Rating";IconSymbolCode[IconSymbolCode["SelectContent"]=408]="SelectContent";IconSymbolCode[IconSymbolCode["SelectUrl"]=74]="SelectUrl";IconSymbolCode[IconSymbolCode["UnselectContent"]=100]="UnselectContent";IconSymbolCode[IconSymbolCode["UnselectUrl"]=75]="UnselectUrl";IconSymbolCode[IconSymbolCode["Plus"]=198]="Plus";IconSymbolCode[IconSymbolCode["Close"]=97]="Close"})(IconSymbolCode=KbCommonUtils.IconSymbolCode||(KbCommonUtils.IconSymbolCode={}));var Browsers;(function(Browsers){Browsers[Browsers["Others"]=0]="Others";Browsers[Browsers["Chrome"]=1]="Chrome";Browsers[Browsers["Firefox"]=2]="Firefox";Browsers[Browsers["IE"]=3]="IE";Browsers[Browsers["Safari"]=4]="Safari";Browsers[Browsers["Edge"]=5]="Edge"})(Browsers=KbCommonUtils.Browsers||(KbCommonUtils.Browsers={}));var SearchProviderType;(function(SearchProviderType){SearchProviderType[SearchProviderType["InternalDynamicsOrg"]=1]="InternalDynamicsOrg";SearchProviderType[SearchProviderType["CrossDynamicsOrg"]=1e8]="CrossDynamicsOrg";SearchProviderType[SearchProviderType["MSSearchSharePoint"]=100000001]="MSSearchSharePoint";SearchProviderType[SearchProviderType["MSSearchConnector"]=100000002]="MSSearchConnector"})(SearchProviderType=KbCommonUtils.SearchProviderType||(KbCommonUtils.SearchProviderType={}));var InitiatedBy;(function(InitiatedBy){InitiatedBy["AutoSearch"]="Auto search";InitiatedBy["ManualSearch"]="Manual search"})(InitiatedBy=KbCommonUtils.InitiatedBy||(KbCommonUtils.InitiatedBy={}));var InteractionType;(function(InteractionType){InteractionType["ViewArticle"]="ViewArticle";InteractionType["LinkArticle"]="LinkArticle";InteractionType["UnlinkArticle"]="UnlinkArticle";InteractionType["EmailArticleContent"]="EmailArticleContent";InteractionType["EmailArticleURL"]="EmailArticleURL";InteractionType["PopoutArticle"]="PopoutArticle";InteractionType["CopyLink"]="CopyLink";InteractionType["PrintArticle"]="PrintArticle";InteractionType["SendLink"]="SendLink"})(InteractionType=KbCommonUtils.InteractionType||(KbCommonUtils.InteractionType={}));var KnowledgeOperationType;(function(KnowledgeOperationType){KnowledgeOperationType["KnowledgeSearch"]="search";KnowledgeOperationType["KnowledgeRecommendation"]="recommendation"})(KnowledgeOperationType=KbCommonUtils.KnowledgeOperationType||(KbCommonUtils.KnowledgeOperationType={}));var ActionSource;(function(ActionSource){ActionSource[ActionSource["Suggestion"]=0]="Suggestion";ActionSource[ActionSource["Search"]=1]="Search";ActionSource[ActionSource["Unknown"]=2]="Unknown"})(ActionSource=KbCommonUtils.ActionSource||(KbCommonUtils.ActionSource={}));var HelpfulFeedbackValues;(function(HelpfulFeedbackValues){HelpfulFeedbackValues["Yes"]="yes";HelpfulFeedbackValues["No"]="no";HelpfulFeedbackValues["NotAvailable"]="notavailable"})(HelpfulFeedbackValues=KbCommonUtils.HelpfulFeedbackValues||(KbCommonUtils.HelpfulFeedbackValues={}));var FiltersRuntimeMode;(function(FiltersRuntimeMode){FiltersRuntimeMode["Customization"]="Customization";FiltersRuntimeMode["Personalization"]="Personalization";FiltersRuntimeMode["SearchControl"]="SearchControl"})(FiltersRuntimeMode=KbCommonUtils.FiltersRuntimeMode||(KbCommonUtils.FiltersRuntimeMode={}))})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOperationFactory=function(){function ActionOperationFactory(){this.ClearRegisteredActions()}ActionOperationFactory.prototype.ClearRegisteredActions=function(){this.instanceCreatorList={}};ActionOperationFactory.prototype.Register=function(actionSource,articleAction,instanceCreator){var actionsMap=this.instanceCreatorList[actionSource];if(actionsMap==null||actionsMap==undefined){actionsMap={};this.instanceCreatorList[actionSource]=actionsMap}actionsMap[articleAction]=instanceCreator};ActionOperationFactory.prototype.GetLabel=function(articleAction){var actionMap=this.instanceCreatorList[KbCommonUtils.ActionSource.Search];if(actionMap&&actionMap[articleAction])return actionMap[articleAction]().Label;return ""};ActionOperationFactory.prototype.GetTooltip=function(articleAction){var actionMap=this.instanceCreatorList[KbCommonUtils.ActionSource.Search];if(actionMap&&actionMap[articleAction])return actionMap[articleAction]().Tooltip;return ""};ActionOperationFactory.prototype.GetSymbolCode=function(articleAction){var actionMap=this.instanceCreatorList[KbCommonUtils.ActionSource.Search],symbolCode=-1;if(actionMap&&actionMap[articleAction])symbolCode=actionMap[articleAction]().SymbolCode;return symbolCode&&symbolCode>=0?symbolCode:KbCommonUtils.IconSymbolCode.Default};ActionOperationFactory.prototype.Validate=function(articleAction,validationPayload){var actionSource=KbCommonUtils.ActionOperationUtils.GetActionSource(validationPayload),actionMap=this.instanceCreatorList[actionSource];if(actionMap&&actionMap[articleAction]){var payload=actionMap[articleAction]().ParseValidationRawPayload(validationPayload);return actionMap[articleAction]().ValidateOperation(payload)}return false};ActionOperationFactory.prototype.ExecuteAction=function(operationPayload){var actionName=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ActionName,operationPayload);return ActionOperationFactory.Instance.Execute(KbCommonUtils.ActionOperationUtils.getActionTypeByName(actionName),operationPayload)};ActionOperationFactory.prototype.Execute=function(articleAction,operationPayload){var actionPromise=$.Deferred(),actionSource=KbCommonUtils.ActionOperationUtils.GetActionSource(operationPayload),actionMap=this.instanceCreatorList[actionSource];if(actionMap&&actionMap[articleAction]){var actionOperation_1=actionMap[articleAction]();this.GetPayload(actionOperation_1,operationPayload).then(function(actionPayload){actionOperation_1.PreExecuteOperation(actionPayload).then(function(preActionOutput){if(!preActionOutput.status){actionPromise.reject(preActionOutput.payload);return}actionOperation_1.ExecuteOperation(actionPayload).then(function(executionOutput){if(!executionOutput.status){actionPromise.reject(executionOutput.payload);return}actionOperation_1.PostExecuteOperation(actionPayload).then(function(postExecutionOutput){if(!postExecutionOutput.status){actionPromise.reject(postExecutionOutput.payload);return}actionPromise.resolve(executionOutput.payload)})})})})}return actionPromise.promise()};ActionOperationFactory.prototype.GetPayload=function(actionOperation,operationPayload){if(operationPayload instanceof KbCommonUtils.ActionPayload){var contentPromise=$.Deferred();contentPromise.resolve(operationPayload);return contentPromise.promise()}return actionOperation.ParseRawPayload(operationPayload)};ActionOperationFactory.Instance=new ActionOperationFactory;return ActionOperationFactory}();KbCommonUtils.ActionOperationFactory=ActionOperationFactory})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOperationRegistration=function(){function ActionOperationRegistration(){}ActionOperationRegistration.RegisterAllActions=function(){KbCommonUtils.ActionOperationFactory.Instance.ClearRegisteredActions();KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.LinkArticle,function(){return new KbCommonUtils.LinkActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.UnlinkArticle,function(){return new KbCommonUtils.UnlinkActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.CopyLink,function(){return new KbCommonUtils.CopyActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.EmailArticle,function(){return new KbCommonUtils.EmailActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.EmailArticleContent,function(){return new KbCommonUtils.EmailContentActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.SelectedResult,function(){return new KbCommonUtils.SelectResultActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.OpenResult,function(){return new KbCommonUtils.OpenResultActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.SendToCTI,function(){return new KbCommonUtils.CTIActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.PrintArticle,function(){return new KbCommonUtils.PrintArticleActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.PopoutArticle,function(){return new KbCommonUtils.PopoutActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.SelectContent,function(){return new KbCommonUtils.SelectContentDialogOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.SelectUrl,function(){return new KbCommonUtils.SelectUrlDialogOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.UnselectContent,function(){return new KbCommonUtils.UnselectContentDialogOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.UnselectUrl,function(){return new KbCommonUtils.UnselectUrlDialogOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Search,KbCommonUtils.ArticleAction.IncreaseView,function(){return new KbCommonUtils.IncreaseViewActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Suggestion,KbCommonUtils.ArticleAction.LinkArticle,function(){return new KbCommonUtils.SuggestionLinkAction});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Suggestion,KbCommonUtils.ArticleAction.UnlinkArticle,function(){return new KbCommonUtils.SuggestionUnlinkAction});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Suggestion,KbCommonUtils.ArticleAction.CopyLink,function(){return new KbCommonUtils.SuggestionCopyAction});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Suggestion,KbCommonUtils.ArticleAction.EmailArticle,function(){return new KbCommonUtils.SuggestionEmailAction});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Suggestion,KbCommonUtils.ArticleAction.EmailArticleContent,function(){return new KbCommonUtils.SuggestionEmailContentAction});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Suggestion,KbCommonUtils.ArticleAction.OpenResult,function(){return new KbCommonUtils.SuggestionOpenArticleAction});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Suggestion,KbCommonUtils.ArticleAction.SendToCTI,function(){return new KbCommonUtils.SuggestionCTIAction});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ActionSource.Suggestion,KbCommonUtils.ArticleAction.SendFeedback,function(){return new KbCommonUtils.SuggestionFeedbackAction})};return ActionOperationRegistration}();KbCommonUtils.ActionOperationRegistration=ActionOperationRegistration})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var CopyActionOperation=function(_super){__extends(CopyActionOperation,_super);function CopyActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(CopyActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.CopyLinkButtonLabel"},enumerable:false,configurable:true});Object.defineProperty(CopyActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.CopyLinkButtonTooltip"},enumerable:false,configurable:true});Object.defineProperty(CopyActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?KbCommonUtils.IconSymbolCode.CopyLinkNew:KbCommonUtils.IconSymbolCode.CopyLink},enumerable:false,configurable:true});CopyActionOperation.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(payload){payload.SuccessMessage=payload.ControlContext.resources.getString(KbCommonUtils.Constants.CopyLinkSuccessMsg);payload.FailureMessage=payload.ControlContext.resources.getString(KbCommonUtils.Constants.CopyLinkFailedMsg);payload.Browser=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.BrowserType,operationPayload);payload[KbCommonUtils.Constants.KmPrivileges]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.KmPrivileges,operationPayload);payload[KbCommonUtils.Constants.ExternalKMPortalURL]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ExternalKMPortalURL,operationPayload);payload[KbCommonUtils.Constants.ArticlePublicNumber]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ArticlePublicNumber,operationPayload);payload[KbCommonUtils.Constants.UseExternalKMPortal]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.UseExternalKMPortal,operationPayload);payload[KbCommonUtils.Constants.StateCode]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.StateCode,operationPayload);payload[KbCommonUtils.Constants.ShowResultNotification]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ShowResultNotification,operationPayload);contentPromise.resolve(payload)});return contentPromise.promise()};CopyActionOperation.prototype.ValidateOperation=function(validationPayload){var kmPrivileges=validationPayload[KbCommonUtils.Constants.KmPrivileges];return kmPrivileges&&kmPrivileges.CanCopyLink&&(validationPayload[KbCommonUtils.Constants.UseExternalKMPortal]||validationPayload.Record.isIngestedArticle||validationPayload.IsSearchScenario&&KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(validationPayload.Record))&&this.isClipboardAPISupported(validationPayload.ControlContext.client.userAgent)&&KbCommonUtils.ActionOperationUtils.GetStateOfArticle(validationPayload)===3&&!window.IsUSD};CopyActionOperation.prototype.ExecuteOperation=function(operationPayload){var actionPromise=$.Deferred(),controlContext=operationPayload.ControlContext,publicPortalUrl=KbCommonUtils.ActionOperationUtils.GetKMExternalPortalUrl(operationPayload),isSuccessfull=true,watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(controlContext,operationPayload[KbCommonUtils.Constants.WebresourceNameArticleActions],KbCommonUtils.TelemetryActionName.Copy_Link);switch(operationPayload.Browser){case KbCommonUtils.Browsers.Chrome:window.navigator.clipboard.writeText(publicPortalUrl);break;case KbCommonUtils.Browsers.IE:window.clipboardData.setData("text",publicPortalUrl);break;case KbCommonUtils.Browsers.Edge:case KbCommonUtils.Browsers.Firefox:isSuccessfull=this.copyTextToClipboard(publicPortalUrl,controlContext);default:}actionPromise.resolve(this.GetActionOutput(isSuccessfull,operationPayload,null));if(operationPayload[KbCommonUtils.Constants.ShowResultNotification])if(isSuccessfull)Xrm.UI.addGlobalNotification(KbCommonUtils.Constants.GLOBAL_NOTIFICATION_TYPE_TOAST,KbCommonUtils.Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS,operationPayload.SuccessMessage,null,null,null);else{var alertMessage={text:operationPayload.FailureMessage};Xrm.Navigation.openAlertDialog(alertMessage)}watermarkTelemetryEvent.End();return actionPromise.promise()};CopyActionOperation.prototype.isClipboardAPISupported=function(userAgent){switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(userAgent)){case KbCommonUtils.Browsers.Chrome:return window&&window.navigator&&window.navigator.clipboard&&window.navigator.clipboard.writeText;case KbCommonUtils.Browsers.IE:return window&&window.clipboardData&&window.clipboardData.setData;case KbCommonUtils.Browsers.Edge:return true;case KbCommonUtils.Browsers.Firefox:return true;default:return false}};CopyActionOperation.prototype.copyTextToClipboard=function(text,context){var textArea=document.createElement("textarea");textArea.style.position="fixed";textArea.style.width="2em";textArea.style.height="2em";textArea.style.border="none";textArea.style.outline="none";textArea.style.boxShadow="none";textArea.style.background="transparent";textArea.value=text;document.body.appendChild(textArea);textArea.select();var isSuccessfull=document.execCommand("copy");document.body.removeChild(textArea);return isSuccessfull};return CopyActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.CopyActionOperation=CopyActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var PrintArticleActionOperation=function(_super){__extends(PrintArticleActionOperation,_super);function PrintArticleActionOperation(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(PrintArticleActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.PrintArticleButtonLabel"},enumerable:false,configurable:true});Object.defineProperty(PrintArticleActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.PrintArticleButtonTooltip"},enumerable:false,configurable:true});Object.defineProperty(PrintArticleActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.PrintArticle},enumerable:false,configurable:true});PrintArticleActionOperation.prototype.ValidateOperation=function(validationPayload){return validationPayload.ControlContext.client.getClient()!=="Mobile"&&this.IsInSupportedBrowsers(validationPayload)&&KbCommonUtils.CommonUtils.IsInArticlePageContext()&&!window.IsUSD};PrintArticleActionOperation.prototype.ExecuteOperation=function(operationPayload){var actionButtons=document.getElementById("MscrmControls.KbArticleControl.KbArticleControl-contentPaneArticleActionsContainer"),ratingDiv=document.getElementById("MscrmControls.KbContentControl.KbContentControl-KbRatingControlContainer");if(actionButtons)actionButtons.style.display="none";if(ratingDiv)ratingDiv.style.display="none";var iframeId="articleContent"+operationPayload.KnowledgeArticleId,iframeDocument=this.GetContentIframe(operationPayload),contentHeight=iframeDocument.contentWindow.document.body.scrollHeight+iframeDocument.contentWindow.outerHeight-iframeDocument.contentWindow.innerHeight+"px",css='.e, body, #shell-container {overflow: visible !important;}\n\t\t\t\t\t\tdiv[data-lp-id*="KbContentControl"] { display: block !important;}\n\t\t\t\t\t\t#MscrmControls.KbArticleControl.KbArticleControl-contentPaneArticleActionsContainer, #MscrmControls.KbContentControl.KbContentControl-KbRatingControlContainer {display: none !important;}\n\t\t\t\t\t\t#'+iframeId+" { height: "+contentHeight+" !important;}",head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");head.appendChild(style);style.type="text/css";style.appendChild(document.createTextNode(css));this.PrintInternal(operationPayload);head.removeChild(style);if(actionButtons)actionButtons.style.display="block";if(ratingDiv)ratingDiv.style.display="block";var actionPromise=$.Deferred();actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};PrintArticleActionOperation.prototype.GetContentIframe=function(operationPayload){var iframeId="articleContent"+operationPayload.KnowledgeArticleId;return document.getElementById(iframeId)};PrintArticleActionOperation.prototype.PrintInternal=function(operationPayload){switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.ControlContext.client.userAgent)){case KbCommonUtils.Browsers.Chrome:case KbCommonUtils.Browsers.Edge:case KbCommonUtils.Browsers.Firefox:case KbCommonUtils.Browsers.IE:var iframeDocument=this.GetContentIframe(operationPayload);iframeDocument.contentWindow.print();break;default:}};PrintArticleActionOperation.prototype.IsInSupportedBrowsers=function(operationPayload){switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.ControlContext.client.userAgent)){case KbCommonUtils.Browsers.Chrome:case KbCommonUtils.Browsers.Edge:case KbCommonUtils.Browsers.Firefox:case KbCommonUtils.Browsers.IE:return true;default:return false}};return PrintArticleActionOperation}(KbCommonUtils.ActionOperationBase);KbCommonUtils.PrintArticleActionOperation=PrintArticleActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionCopyAction=function(_super){__extends(SuggestionCopyAction,_super);function SuggestionCopyAction(){return _super!==null&&_super.apply(this,arguments)||this}SuggestionCopyAction.prototype.ParseRawPayload=function(operationPayload){var contentPromise=$.Deferred();_super.prototype.ParseRawPayload.call(this,operationPayload).then(function(actionPayload){KbCommonUtils.SuggestionActionUtils.PopulateDefaultSuggestionPayload(operationPayload,actionPayload,KbCommonUtils.KnowledgeSuggestionConstants.CopyUrlSuccessMessage,KbCommonUtils.KnowledgeSuggestionConstants.CopyUrlFailedMessage).then(function(status){contentPromise.resolve(actionPayload)})});return contentPromise.promise()};SuggestionCopyAction.prototype.PreExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.PushSuggestionInteraction(operationPayload)};SuggestionCopyAction.prototype.GetActionOutput=function(status,operationPayload,error){return KbCommonUtils.SuggestionActionUtils.GetActionOutput(status,operationPayload,error)};SuggestionCopyAction.prototype.PostExecuteOperation=function(operationPayload){return KbCommonUtils.SuggestionActionUtils.AddUsageTelemetry("CopyUrlAction",operationPayload)};return SuggestionCopyAction}(KbCommonUtils.CopyActionOperation);KbCommonUtils.SuggestionCopyAction=SuggestionCopyAction})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var Md5=function(){function Md5(){this._state=new Int32Array(4);this._buffer=new ArrayBuffer(68);this._buffer8=new Uint8Array(this._buffer,0,68);this._buffer32=new Uint32Array(this._buffer,0,17);this.start()}Md5.hashStr=function(str,raw){if(raw===void 0)raw=false;return this.onePassHasher.start().appendStr(str).end(raw)};Md5.hashAsciiStr=function(str,raw){if(raw===void 0)raw=false;return this.onePassHasher.start().appendAsciiStr(str).end(raw)};Md5._hex=function(x){for(var hc=Md5.hexChars,ho=Md5.hexOut,n,offset,j,i=0;i<4;i+=1){offset=i*8;n=x[i];for(j=0;j<8;j+=2){ho[offset+1+j]=hc.charAt(n&15);n>>>=4;ho[offset+0+j]=hc.charAt(n&15);n>>>=4}}return ho.join("")};Md5._md5cycle=function(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a+=(b&c|~b&d)+k[0]-680876936|0;a=(a<<7|a>>>25)+b|0;d+=(a&b|~a&c)+k[1]-389564586|0;d=(d<<12|d>>>20)+a|0;c+=(d&a|~d&b)+k[2]+606105819|0;c=(c<<17|c>>>15)+d|0;b+=(c&d|~c&a)+k[3]-1044525330|0;b=(b<<22|b>>>10)+c|0;a+=(b&c|~b&d)+k[4]-176418897|0;a=(a<<7|a>>>25)+b|0;d+=(a&b|~a&c)+k[5]+1200080426|0;d=(d<<12|d>>>20)+a|0;c+=(d&a|~d&b)+k[6]-1473231341|0;c=(c<<17|c>>>15)+d|0;b+=(c&d|~c&a)+k[7]-45705983|0;b=(b<<22|b>>>10)+c|0;a+=(b&c|~b&d)+k[8]+1770035416|0;a=(a<<7|a>>>25)+b|0;d+=(a&b|~a&c)+k[9]-1958414417|0;d=(d<<12|d>>>20)+a|0;c+=(d&a|~d&b)+k[10]-42063|0;c=(c<<17|c>>>15)+d|0;b+=(c&d|~c&a)+k[11]-1990404162|0;b=(b<<22|b>>>10)+c|0;a+=(b&c|~b&d)+k[12]+1804603682|0;a=(a<<7|a>>>25)+b|0;d+=(a&b|~a&c)+k[13]-40341101|0;d=(d<<12|d>>>20)+a|0;c+=(d&a|~d&b)+k[14]-1502002290|0;c=(c<<17|c>>>15)+d|0;b+=(c&d|~c&a)+k[15]+1236535329|0;b=(b<<22|b>>>10)+c|0;a+=(b&d|c&~d)+k[1]-165796510|0;a=(a<<5|a>>>27)+b|0;d+=(a&c|b&~c)+k[6]-1069501632|0;d=(d<<9|d>>>23)+a|0;c+=(d&b|a&~b)+k[11]+643717713|0;c=(c<<14|c>>>18)+d|0;b+=(c&a|d&~a)+k[0]-373897302|0;b=(b<<20|b>>>12)+c|0;a+=(b&d|c&~d)+k[5]-701558691|0;a=(a<<5|a>>>27)+b|0;d+=(a&c|b&~c)+k[10]+38016083|0;d=(d<<9|d>>>23)+a|0;c+=(d&b|a&~b)+k[15]-660478335|0;c=(c<<14|c>>>18)+d|0;b+=(c&a|d&~a)+k[4]-405537848|0;b=(b<<20|b>>>12)+c|0;a+=(b&d|c&~d)+k[9]+568446438|0;a=(a<<5|a>>>27)+b|0;d+=(a&c|b&~c)+k[14]-1019803690|0;d=(d<<9|d>>>23)+a|0;c+=(d&b|a&~b)+k[3]-187363961|0;c=(c<<14|c>>>18)+d|0;b+=(c&a|d&~a)+k[8]+1163531501|0;b=(b<<20|b>>>12)+c|0;a+=(b&d|c&~d)+k[13]-1444681467|0;a=(a<<5|a>>>27)+b|0;d+=(a&c|b&~c)+k[2]-51403784|0;d=(d<<9|d>>>23)+a|0;c+=(d&b|a&~b)+k[7]+1735328473|0;c=(c<<14|c>>>18)+d|0;b+=(c&a|d&~a)+k[12]-1926607734|0;b=(b<<20|b>>>12)+c|0;a+=(b^c^d)+k[5]-378558|0;a=(a<<4|a>>>28)+b|0;d+=(a^b^c)+k[8]-2022574463|0;d=(d<<11|d>>>21)+a|0;c+=(d^a^b)+k[11]+1839030562|0;c=(c<<16|c>>>16)+d|0;b+=(c^d^a)+k[14]-35309556|0;b=(b<<23|b>>>9)+c|0;a+=(b^c^d)+k[1]-1530992060|0;a=(a<<4|a>>>28)+b|0;d+=(a^b^c)+k[4]+1272893353|0;d=(d<<11|d>>>21)+a|0;c+=(d^a^b)+k[7]-155497632|0;c=(c<<16|c>>>16)+d|0;b+=(c^d^a)+k[10]-1094730640|0;b=(b<<23|b>>>9)+c|0;a+=(b^c^d)+k[13]+681279174|0;a=(a<<4|a>>>28)+b|0;d+=(a^b^c)+k[0]-358537222|0;d=(d<<11|d>>>21)+a|0;c+=(d^a^b)+k[3]-722521979|0;c=(c<<16|c>>>16)+d|0;b+=(c^d^a)+k[6]+76029189|0;b=(b<<23|b>>>9)+c|0;a+=(b^c^d)+k[9]-640364487|0;a=(a<<4|a>>>28)+b|0;d+=(a^b^c)+k[12]-421815835|0;d=(d<<11|d>>>21)+a|0;c+=(d^a^b)+k[15]+530742520|0;c=(c<<16|c>>>16)+d|0;b+=(c^d^a)+k[2]-995338651|0;b=(b<<23|b>>>9)+c|0;a+=(c^(b|~d))+k[0]-198630844|0;a=(a<<6|a>>>26)+b|0;d+=(b^(a|~c))+k[7]+1126891415|0;d=(d<<10|d>>>22)+a|0;c+=(a^(d|~b))+k[14]-1416354905|0;c=(c<<15|c>>>17)+d|0;b+=(d^(c|~a))+k[5]-57434055|0;b=(b<<21|b>>>11)+c|0;a+=(c^(b|~d))+k[12]+1700485571|0;a=(a<<6|a>>>26)+b|0;d+=(b^(a|~c))+k[3]-1894986606|0;d=(d<<10|d>>>22)+a|0;c+=(a^(d|~b))+k[10]-1051523|0;c=(c<<15|c>>>17)+d|0;b+=(d^(c|~a))+k[1]-2054922799|0;b=(b<<21|b>>>11)+c|0;a+=(c^(b|~d))+k[8]+1873313359|0;a=(a<<6|a>>>26)+b|0;d+=(b^(a|~c))+k[15]-30611744|0;d=(d<<10|d>>>22)+a|0;c+=(a^(d|~b))+k[6]-1560198380|0;c=(c<<15|c>>>17)+d|0;b+=(d^(c|~a))+k[13]+1309151649|0;b=(b<<21|b>>>11)+c|0;a+=(c^(b|~d))+k[4]-145523070|0;a=(a<<6|a>>>26)+b|0;d+=(b^(a|~c))+k[11]-1120210379|0;d=(d<<10|d>>>22)+a|0;c+=(a^(d|~b))+k[2]+718787259|0;c=(c<<15|c>>>17)+d|0;b+=(d^(c|~a))+k[9]-343485551|0;b=(b<<21|b>>>11)+c|0;x[0]=a+x[0]|0;x[1]=b+x[1]|0;x[2]=c+x[2]|0;x[3]=d+x[3]|0};Md5.prototype.start=function(){this._dataLength=0;this._bufferLength=0;this._state.set(Md5.stateIdentity);return this};Md5.prototype.appendStr=function(str){for(var buf8=this._buffer8,buf32=this._buffer32,bufLen=this._bufferLength,code,i=0;i<str.length;i+=1){code=str.charCodeAt(i);if(code<128)buf8[bufLen++]=code;else if(code<2048){buf8[bufLen++]=(code>>>6)+192;buf8[bufLen++]=code&63|128}else if(code<55296||code>56319){buf8[bufLen++]=(code>>>12)+224;buf8[bufLen++]=code>>>6&63|128;buf8[bufLen++]=code&63|128}else{code=(code-55296)*1024+(str.charCodeAt(++i)-56320)+65536;if(code>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");buf8[bufLen++]=(code>>>18)+240;buf8[bufLen++]=code>>>12&63|128;buf8[bufLen++]=code>>>6&63|128;buf8[bufLen++]=code&63|128}if(bufLen>=64){this._dataLength+=64;Md5._md5cycle(this._state,buf32);bufLen-=64;buf32[0]=buf32[16]}}this._bufferLength=bufLen;return this};Md5.prototype.appendAsciiStr=function(str){for(var buf8=this._buffer8,buf32=this._buffer32,bufLen=this._bufferLength,i,j=0;true;){i=Math.min(str.length-j,64-bufLen);while(i--)buf8[bufLen++]=str.charCodeAt(j++);if(bufLen<64)break;this._dataLength+=64;Md5._md5cycle(this._state,buf32);bufLen=0}this._bufferLength=bufLen;return this};Md5.prototype.appendByteArray=function(input){for(var buf8=this._buffer8,buf32=this._buffer32,bufLen=this._bufferLength,i,j=0;true;){i=Math.min(input.length-j,64-bufLen);while(i--)buf8[bufLen++]=input[j++];if(bufLen<64)break;this._dataLength+=64;Md5._md5cycle(this._state,buf32);bufLen=0}this._bufferLength=bufLen;return this};Md5.prototype.getState=function(){var self=this,s=self._state;return {buffer:String.fromCharCode.apply(null,self._buffer8),buflen:self._bufferLength,length:self._dataLength,state:[s[0],s[1],s[2],s[3]]}};Md5.prototype.setState=function(state){var buf=state.buffer,x=state.state,s=this._state,i;this._dataLength=state.length;this._bufferLength=state.buflen;s[0]=x[0];s[1]=x[1];s[2]=x[2];s[3]=x[3];for(i=0;i<buf.length;i+=1)this._buffer8[i]=buf.charCodeAt(i)};Md5.prototype.end=function(raw){if(raw===void 0)raw=false;var bufLen=this._bufferLength,buf8=this._buffer8,buf32=this._buffer32,i=(bufLen>>2)+1,dataBitsLen;this._dataLength+=bufLen;buf8[bufLen]=128;buf8[bufLen+1]=buf8[bufLen+2]=buf8[bufLen+3]=0;buf32.set(Md5.buffer32Identity.subarray(i),i);if(bufLen>55){Md5._md5cycle(this._state,buf32);buf32.set(Md5.buffer32Identity)}dataBitsLen=this._dataLength*8;if(dataBitsLen<=4294967295)buf32[14]=dataBitsLen;else{var matches=dataBitsLen.toString(16).match(/(.*?)(.{0,8})$/);if(matches===null)return;var lo=parseInt(matches[2],16),hi=parseInt(matches[1],16)||0;buf32[14]=lo;buf32[15]=hi}Md5._md5cycle(this._state,buf32);return raw?this._state:Md5._hex(this._state)};Md5.prototype.getGuid=function(){var hash=this.end().toString(),m=hash.match(/(.{8})(.{4})(.{4})(.{4})(.{12})/);return m[1]+"-"+m[2]+"-"+m[3]+"-"+m[4]+"-"+m[5]};Md5.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);Md5.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);Md5.hexChars="0123456789abcdef";Md5.hexOut=[];Md5.onePassHasher=new Md5;return Md5}();KbCommonUtils.Md5=Md5})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SupportedActionFlags=function(){function SupportedActionFlags(){}return SupportedActionFlags}();KbCommonUtils.SupportedActionFlags=SupportedActionFlags})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var LiveWorkItemStatus;(function(LiveWorkItemStatus){LiveWorkItemStatus[LiveWorkItemStatus["Open"]=1]="Open";LiveWorkItemStatus[LiveWorkItemStatus["Active"]=2]="Active";LiveWorkItemStatus[LiveWorkItemStatus["Waiting"]=3]="Waiting";LiveWorkItemStatus[LiveWorkItemStatus["Closed"]=4]="Closed";LiveWorkItemStatus[LiveWorkItemStatus["WrapUp"]=5]="WrapUp"})(LiveWorkItemStatus=KbCommonUtils.LiveWorkItemStatus||(KbCommonUtils.LiveWorkItemStatus={}))})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var InteractionTypes;(function(InteractionTypes){InteractionTypes[InteractionTypes["linkarticle"]=0]="linkarticle";InteractionTypes[InteractionTypes["unlinkarticle"]=1]="unlinkarticle";InteractionTypes[InteractionTypes["copylink"]=2]="copylink";InteractionTypes[InteractionTypes["emailarticle"]=3]="emailarticle";InteractionTypes[InteractionTypes["emailarticlecontent"]=5]="emailarticlecontent";InteractionTypes[InteractionTypes["openarticle"]=6]="openarticle";InteractionTypes[InteractionTypes["sendurl"]=8]="sendurl";InteractionTypes[InteractionTypes["helpfulfeedback"]=15]="helpfulfeedback"})(InteractionTypes=KbCommonUtils.InteractionTypes||(KbCommonUtils.InteractionTypes={}))})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KnowledgeSearchInsight=function(){function KnowledgeSearchInsight(){this.ResultCount=0;this.ResponseTime=-1}return KnowledgeSearchInsight}();KbCommonUtils.KnowledgeSearchInsight=KnowledgeSearchInsight})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var RetrieveKnowledgeSearchModifiersRequest=function(){function RetrieveKnowledgeSearchModifiersRequest(runtimeMode){this.RuntimeMode=runtimeMode}return RetrieveKnowledgeSearchModifiersRequest}();KbCommonUtils.RetrieveKnowledgeSearchModifiersRequest=RetrieveKnowledgeSearchModifiersRequest})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var RetrieveKnowledgeSearchFiltersRequest=function(){function RetrieveKnowledgeSearchFiltersRequest(searchFiltersMetadata){this.SearchFiltersMetadata=searchFiltersMetadata}return RetrieveKnowledgeSearchFiltersRequest}();KbCommonUtils.RetrieveKnowledgeSearchFiltersRequest=RetrieveKnowledgeSearchFiltersRequest})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var FeedbackInteractionContext=function(){function FeedbackInteractionContext(){}return FeedbackInteractionContext}();KbCommonUtils.FeedbackInteractionContext=FeedbackInteractionContext})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var MultisessionUtils=function(){function MultisessionUtils(){}MultisessionUtils.getAnchorTabTitle=function(context){var def=$.Deferred();this.GetSessionContext(context).then(function(sessionContext){if(!sessionContext)if(context.parameters&&context.parameters.AutoSuggestionField){var originalTitle=context.parameters.AutoSuggestionField.formatted;def.resolve(originalTitle)}else def.resolve("");else{var title=sessionContext.parameters?sessionContext.parameters["anchor.title"]:null;def.resolve(title)}},function(err){def.reject(err)});return def.promise()};MultisessionUtils.OpenEmailAppTab=function(emailObject){var pageInput={pageType:"entityrecord",entityName:KbCommonUtils.Constants.Email,data:emailObject},tabOptions={canBeClosed:true,isFocused:true},tabInput={pageInput:pageInput,options:tabOptions};MultisessionUtils.OpenAppTab(tabInput)};MultisessionUtils.OpenArticleAppTab=function(operationPayload){var tabPromise=$.Deferred(),pageInput={pageType:"control",controlName:"MscrmControls.KnowledgeControl.KnowledgeControl",data:{showControl:"article",articleId:operationPayload.KnowledgeArticleId,resourceUri:operationPayload[KbCommonUtils.Constants.ResourceUri],isCrossDynamicsOrgArticle:operationPayload[KbCommonUtils.Constants.SearchProviderType]==KbCommonUtils.SearchProviderType.CrossDynamicsOrg,systemUserId:operationPayload[KbCommonUtils.Constants.UserId],searchProviderType:operationPayload[KbCommonUtils.Constants.SearchProviderType]}},tabOptions={canBeClosed:true,isFocused:true,title:operationPayload.Title},tabInput={pageInput:pageInput,options:tabOptions};MultisessionUtils.OpenAppTab(tabInput,operationPayload.KnowledgeArticleId,operationPayload.ControlContext).then(function(status){tabPromise.resolve(status)},function(error){tabPromise.reject(error)});return tabPromise.promise()};MultisessionUtils.OpenAppTab=function(tabInput,knowledgearticleid,context){var tabPromise=$.Deferred();Xrm.App.sessions.getSession(Xrm.App.sessions.getFocusedSession().sessionId).tabs.createTab(tabInput).then(function(tabId){tabPromise.resolve(true);knowledgearticleid&&context&&MultisessionUtils.GetSessionContext(context).then(function(sessionContext){sessionContext.set(knowledgearticleid,tabId)})},function(error){tabPromise.reject(error)});return tabPromise.promise()};MultisessionUtils.SetAppTabTitle=function(title){Xrm.App.sessions.getSession(Xrm.App.sessions.getFocusedSession().sessionId).tabs.getFocusedTab().title=title};MultisessionUtils.CanCreateNewAppTab=function(){var sessionId=Xrm.App.sessions.getFocusedSession().sessionId,tabs=Xrm.App.sessions.getSession(sessionId).tabs;return tabs.canCreateTab()};MultisessionUtils.OpenErrorDialog=function(title,message){var alertMessage={text:message,title:title};return Xrm.Navigation.openAlertDialog(alertMessage)};MultisessionUtils.GetSession=function(context){if(context.parameters&&context.parameters.WrapperContext){var multisessionContext=context.parameters.WrapperContext.MultisessionContext;if(multisessionContext)return multisessionContext.Session}return Microsoft.AppRuntime.Sessions.getFocusedSession()};MultisessionUtils.GetSessionContext=function(context){return __awaiter(this,void 0,void 0,function(){var multisessionContext,session,sessionContext;return __generator(this,function(_a){switch(_a.label){case 0:if(context.parameters&&context.parameters.WrapperContext){multisessionContext=context.parameters.WrapperContext.MultisessionContext;if(multisessionContext&&multisessionContext.SessionContext)return [2,multisessionContext.SessionContext]}session=Microsoft.AppRuntime.Sessions.getFocusedSession();return [4,session.getContext()];case 1:sessionContext=_a.sent();return [2,sessionContext]}})})};MultisessionUtils.GetTabIfOpened=function(context,knowledgeArticleId){return __awaiter(this,void 0,void 0,function(){var sessionContext,tabId,tab;return __generator(this,function(_a){switch(_a.label){case 0:return [4,this.GetSessionContext(context)];case 1:sessionContext=_a.sent();tabId=sessionContext.get(knowledgeArticleId);if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(tabId))return [2,null];tab=null;try{tab=this.GetSession(context).getTab(tabId)}catch(ex){return [2,null]}return [2,tab]}})})};return MultisessionUtils}();KbCommonUtils.MultisessionUtils=MultisessionUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var OrganizationSettings=function(){function OrganizationSettings(){}Object.defineProperty(OrganizationSettings,"geoName",{"get":function(){var organizationGeoName="",organizationSettings=null;if(Xrm&&Xrm.Utility&&Xrm.Utility.getGlobalContext)organizationSettings=Xrm.Utility.getGlobalContext().organizationSettings;if(organizationSettings){organizationGeoName=organizationSettings.organizationGeo;if(organizationGeoName&&organizationGeoName.toUpperCase()==="NA")organizationGeoName=organizationSettings.isSovereignCloud?"GCC":organizationGeoName}return organizationGeoName},enumerable:false,configurable:true});Object.defineProperty(OrganizationSettings,"IsSupportedCloudType",{"get":function(){var isAllowed=true;switch(this.geoName){case "GCC":case "USG":case "CHN":isAllowed=false;break}return isAllowed},enumerable:false,configurable:true});Object.defineProperty(OrganizationSettings,"FirstPartyEndpoint",{"get":function(){var endpoint="https://www.d365ccafpi.com";switch(this.geoName){case "TIP":endpoint="https://www.d365ccafpi-dev.com";break;case "GCC":endpoint="https://www.d365ccafpi-gcc.com";break;case "USG":endpoint="https://www.d365ccafpi-gcc.com";break;case "CHN":endpoint="https://www.d365ccafpi.chn";break}return endpoint},enumerable:false,configurable:true});Object.defineProperty(OrganizationSettings,"DiscoveryServiceEndpoint",{"get":function(){var endpoint="https://globaldisco.crm.dynamics.com";switch(this.geoName){case "TIP":endpoint="https://globaldisco.crm10.dynamics.com";break;case "GCC":endpoint="https://globaldisco.crm9.dynamics.com";break;case "USG":endpoint="https://globaldisco.crm.microsoftdynamics.us";break}return endpoint},enumerable:false,configurable:true});return OrganizationSettings}();KbCommonUtils.OrganizationSettings=OrganizationSettings})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KbCommonControlLocale=function(){function KbCommonControlLocale(){}KbCommonControlLocale.initialize=function(getString){KbCommonControlLocale.AllDraftArticlesLocale=getString(KbCommonUtils.Constants.AllDraftArticlesResourceName);KbCommonControlLocale.AllPublishedArticlesLocale=getString(KbCommonUtils.Constants.AllPublishedArticlesResourceName);KbCommonControlLocale.AllApprovedArticlesLocale=getString(KbCommonUtils.Constants.AllApprovedArticlesResourceName);KbCommonControlLocale.AllExpiredArticlesLocale=getString(KbCommonUtils.Constants.AllExpiredArticlesResourceName);KbCommonControlLocale.AllArchivedArticlesLocale=getString(KbCommonUtils.Constants.AllArchivedArticlesResourceName);KbCommonControlLocale.AllDiscardedArticlesLocale=getString(KbCommonUtils.Constants.AllDiscardedArticlesResourceName);KbCommonControlLocale.AllScheduledArticlesLocale=getString(KbCommonUtils.Constants.AllScheduledArticlesResourceName);KbCommonControlLocale.ConfirmDialogTitle=getString(KbCommonUtils.Constants.ConfirmDialogTitle);KbCommonControlLocale.ConfirmDialogText=getString(KbCommonUtils.Constants.ConfirmDialogTextResourceName);KbCommonControlLocale.RecordDoesNotExistErrorMessage=getString(KbCommonUtils.Constants.RecordDoesNotExistErrorMessageResourceName);KbCommonControlLocale.ConfirmDialogTitleForImageLoad=getString(KbCommonUtils.Constants.ConfirmDialogTitleForImageLoad);KbCommonControlLocale.ConfirmDialogForImageLoadFailureText=getString(KbCommonUtils.Constants.ConfirmDialogTextForImageLoadFailure);KbCommonControlLocale.CTIFailedMessageForConversationStateText=getString(KbCommonUtils.Constants.CTIFailedMessageForConversationStateResourceName);KbCommonControlLocale.CTIFailedMessageForConversationStateTitle=getString(KbCommonUtils.Constants.CTIFailedMessageForConversationStateTitleResourceName)};return KbCommonControlLocale}();KbCommonUtils.KbCommonControlLocale=KbCommonControlLocale})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var AssociateDisassociateKnowledgeArticleRequest=function(){function AssociateDisassociateKnowledgeArticleRequest(regardingObjectId,regardingObjectTypeCode,associationRelationshipName,knowledgeArticleId,entityName){this.RegardingObjectId=regardingObjectId;this.RegardingObjectTypeCode=regardingObjectTypeCode;this.AssociationRelationshipName=associationRelationshipName;this.KnowledgeArticleId=knowledgeArticleId;this.EntityName=entityName}return AssociateDisassociateKnowledgeArticleRequest}();KbCommonUtils.AssociateDisassociateKnowledgeArticleRequest=AssociateDisassociateKnowledgeArticleRequest})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KMPrivileges=function(){function KMPrivileges(){}return KMPrivileges}();KbCommonUtils.KMPrivileges=KMPrivileges})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var TelemetryConstants=function(){function TelemetryConstants(){}TelemetryConstants.WebresourceNameKbSearchActions="KbSearchActions";TelemetryConstants.WebresourceNameKbSuggestionActions="KbSuggestionActions";TelemetryConstants.LookupTypeFiltersCount="LookupTypeFiltersCount";TelemetryConstants.OptionsetTypeFiltersCount="OptionsetTypeFiltersCount";TelemetryConstants.DateTimeTypeFiltersCount="DateTimeTypeFiltersCount";TelemetryConstants.TwoChoiceTypeFiltersCount="TwoChoiceTypeFiltersCount";TelemetryConstants.MultiselectePickListTypeFiltersCount="MultiselectePickListTypeFiltersCount";TelemetryConstants.DisabledOptionsetFiltersCount="DisabledOptionsetFiltersCount";TelemetryConstants.DisabledMultiselectePickListFiltersCount="DisabledMultiselectePickListFiltersCount";TelemetryConstants.DisabledDateTimeFiltersCount="DisabledDateTimeFiltersCount";TelemetryConstants.DisabledTwoChoiceFiltersCount="DisabledTwoChoiceFiltersCount";TelemetryConstants.DisabledLookupFiltersCount="DisabledLookupFiltersCount";TelemetryConstants.CustomFiltersCount="CustomFiltersCount";TelemetryConstants.CustomFieldFiltersCount="CustomFieldFiltersCount";return TelemetryConstants}();KbCommonUtils.TelemetryConstants=TelemetryConstants;var TelemetryComponentName;(function(TelemetryComponentName){TelemetryComponentName["KnowledgeManagement_Usage"]="KnowledgeManagement.Usage";TelemetryComponentName["KnowledgeManagement_Info"]="KnowledgeManagement.Info";TelemetryComponentName["KnowledgeManagement_Error"]="KnowledgeManagement.Error";TelemetryComponentName["KbArticleControl_General"]="KnowledgeManagement.KbArticleControl";TelemetryComponentName["KMInsights_FailedCreateSearchRecord"]="KnowledgeManagement.KMInsights.FailedCreateSearchRecord";TelemetryComponentName["KMInsights_FailedCreateInteractionRecord"]="KnowledgeManagement.KMInsights.FailedCreateInteractionRecord";TelemetryComponentName["KnowledgeManagement_SendEmailContent"]="KnowledgeManagement.SendEmailContent"})(TelemetryComponentName=KbCommonUtils.TelemetryComponentName||(KbCommonUtils.TelemetryComponentName={}));var TelemetryActionName;(function(TelemetryActionName){TelemetryActionName["KMInsights_Search"]="KMInsights_Search";TelemetryActionName["KMInsights_Interaction"]="KMInsights_Interaction";TelemetryActionName["EditorPlugin"]="EditorPlugin";TelemetryActionName["KbSearch_Control_Initialized"]="KbSearchControl_Initialized";TelemetryActionName["KbEditor_Control_Initialized"]="KbEditorControl_Initialized";TelemetryActionName["KbArticle_Control_Initialized"]="KbArticleControl_Initialized";TelemetryActionName["KbFilterConfig_Control_Initialized"]="KbFilterConfigControl_Initialized";TelemetryActionName["KbLanguageSettings_Control_Initialized"]="KbLanguageSettingsControl_Initialized";TelemetryActionName["KbSearch_Performed"]="KbSearch_Performed";TelemetryActionName["Load_KbSearch_Control"]="Load_KbSearch_Control";TelemetryActionName["Load_Search_Results"]="Load_Search_Results";TelemetryActionName["Open_Article_To_Read"]="Open_Article_To_Read";TelemetryActionName["SeeMore_Option_Clicked"]="SeeMore_Option_Clicked";TelemetryActionName["Sort_Order_Changed"]="Article_Sort_Order_Changed";TelemetryActionName["Status_Filter_Changed"]="Article_Status_Filter_Changed";TelemetryActionName["Language_Filter_Changed"]="Article_Language_Filter_Changed";TelemetryActionName["Link_KbArticle"]="Link_Article";TelemetryActionName["Unlink_KbArticle"]="Unlink_Article";TelemetryActionName["Email_Article_Content"]="Email_Content";TelemetryActionName["Email_Article_URL"]="Email_URL";TelemetryActionName["Popout_KbArticle"]="Popout_Article";TelemetryActionName["Print_Article"]="Print_Article";TelemetryActionName["Copy_Link"]="Copy_Link";TelemetryActionName["Send_Link_ToCTI"]="Send_Link_ToCTI";TelemetryActionName["Select_Content"]="Select_Content";TelemetryActionName["Unselect_Content"]="Unselect_Content";TelemetryActionName["Select_Url"]="Select_Url";TelemetryActionName["Unselect_Url"]="Unselect_Url";TelemetryActionName["Increase_View_Count"]="Increase_View_Count";TelemetryActionName["Federation_Search_Initialized"]="Federation_Search_Initialized";TelemetryActionName["Federation_Search_Provider_Change"]="Federation_Search_Provider_Change";TelemetryActionName["KbRatingControl_FetchRatingAdminSetting"]="KbRatingControl_FetchRatingAdminSetting";TelemetryActionName["KbRatingControl_CreateFeedbackRecord"]="KbRatingControl_CreateFeedbackRecord";TelemetryActionName["KbRatingControl_UpdateFeedbackRecord"]="KbRatingControl_UpdateFeedbackRecord";TelemetryActionName["SendEmailContent_CheckIfEmailHasRegardingRelationshipsToEntity"]="SendEmailContent_CheckIfEmailHasRegardingRelationshipsToEntity";TelemetryActionName["Init_Search_Filter"]="Init_Search_Filter";TelemetryActionName["Clear_Search_Filters"]="Clear_Search_Filters";TelemetryActionName["Update_Search_Filters"]="Update_Search_Filters";TelemetryActionName["Add_New_Filter"]="Add_New_Filter";TelemetryActionName["Save_Filter_Configurations"]="Save_Filter_Configurations"})(TelemetryActionName=KbCommonUtils.TelemetryActionName||(KbCommonUtils.TelemetryActionName={}));var TelemetrySourceType;(function(TelemetrySourceType){TelemetrySourceType["SiteMap"]="SiteMap";TelemetrySourceType["Dialog"]="Dialog";TelemetrySourceType["EntityForm"]="EntityForm";TelemetrySourceType["ProductivityPanel"]="MultiSession_ProductivityPanel";TelemetrySourceType["AppTab"]="MultiSession_AppTab";TelemetrySourceType["ArticlePage"]="ArticlePage"})(TelemetrySourceType=KbCommonUtils.TelemetrySourceType||(KbCommonUtils.TelemetrySourceType={}));var TelemetryControlType;(function(TelemetryControlType){TelemetryControlType["KbArticleControl"]="KbArticleControl";TelemetryControlType["KbSearchControl"]="KbSearchControl";TelemetryControlType["KbEditorControl"]="KbEditorControl";TelemetryControlType["KbContentControl"]="KbContentControl";TelemetryControlType["KbRatingControl"]="KbRatingControl";TelemetryControlType["KnowledgeControl"]="KnowledgeControl";TelemetryControlType["KbEnvironmentSelector"]="KbEnvironmentSelector";TelemetryControlType["SmartAssistControl"]="SAForKnowledgeSuggestion";TelemetryControlType["KbCommonUtils"]="KbEnvironmentSelector";TelemetryControlType["KbFilterConfigControl"]="KbFilterConfigControl";TelemetryControlType["KbLanguageSettingsControl"]="KbLanguageSettingsControl"})(TelemetryControlType=KbCommonUtils.TelemetryControlType||(KbCommonUtils.TelemetryControlType={}));var TelemetryReleaseWave;(function(TelemetryReleaseWave){TelemetryReleaseWave["October2019"]="October 2019";TelemetryReleaseWave["April2020"]="April 2020";TelemetryReleaseWave["October2020"]="October 2020";TelemetryReleaseWave["April2021"]="April 2021"})(TelemetryReleaseWave=KbCommonUtils.TelemetryReleaseWave||(KbCommonUtils.TelemetryReleaseWave={}));var TelemetryFeatureName;(function(TelemetryFeatureName){TelemetryFeatureName["KbSearch"]="KB Search";TelemetryFeatureName["ArticleActions"]="Article Actions";TelemetryFeatureName["KMInsights"]="KM Insights";TelemetryFeatureName["KMSuggestion"]="KM Suggestion";TelemetryFeatureName["FederationSearch"]="Federation Search";TelemetryFeatureName["ExpandCollapse"]="Expand Collapse";TelemetryFeatureName["KMRichTextEditor"]="KM RichTextEditor";TelemetryFeatureName["KMFilterCustomization"]="KM FilterCustomization";TelemetryFeatureName["KMPersonalization"]="KM Personalization"})(TelemetryFeatureName=KbCommonUtils.TelemetryFeatureName||(KbCommonUtils.TelemetryFeatureName={}));var TelemetrySubFeatureName;(function(TelemetrySubFeatureName){TelemetrySubFeatureName["AutoSearch"]="AutoSearch";TelemetrySubFeatureName["ManualSearch"]="ManualSearch"})(TelemetrySubFeatureName=KbCommonUtils.TelemetrySubFeatureName||(KbCommonUtils.TelemetrySubFeatureName={}))})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var FCBUtil=function(){function FCBUtil(){}FCBUtil.SetCustomerEnabledWaves=function(context){KbCommonUtils.FCBUtil._isCustomerEnabledForOct2020Wave=KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(context)};FCBUtil.IsCustomerEnabledForOct2020Wave=function(){return KbCommonUtils.FCBUtil._isCustomerEnabledForOct2020Wave};FCBUtil.IsCustomerEnabledForApril2021Wave=function(context){return context.utils.isFeatureEnabled(this.April2021Wave)};FCBUtil.isCustomerEnabledForCurrentWave=function(context){return context.utils.isFeatureEnabled(this.CurrentWave)};FCBUtil.IsCustomerEnabledForFilterCustomization=function(context){return this.IsCustomerEnabledForApril2021Wave(context)&&context.utils.isFeatureEnabled(this.KMFilterCustomizationEnabled)};FCBUtil.IsCustomerEnabledForFilterCustomizationForDFM=function(context){return this.IsCustomerEnabledForFilterCustomization(context)&&context.utils.isFeatureEnabled(this.KMApril2021ForDFMEnabled)};FCBUtil.IsCustomerEnabledForPersonalization=function(context){return this.IsCustomerEnabledForApril2021Wave(context)&&context.utils.isFeatureEnabled(this.KMPersonalizedSettingsEnabled)};FCBUtil.IsCustomerEnabledForOctWave=function(context){return context.utils.isFeatureEnabled(this.October2020Wave)};FCBUtil.IsFeatureEnabled=function(context,feature,checkCurrentWave){if(checkCurrentWave===void 0)checkCurrentWave=true;if(checkCurrentWave)return context.utils.isFeatureEnabled(feature)&&this.isCustomerEnabledForCurrentWave(context);return context.utils.isFeatureEnabled(feature)};FCBUtil.AreAllFeaturesEnabled=function(context,features){if(!features||features.length==0)return false;return features.every(function(feature){return context.utils.isFeatureEnabled(feature)})};FCBUtil.IsStatePersistenceEnabled=function(context){return FCBUtil.AreAllFeaturesEnabled(context,[FCBUtil.October2020Wave,FCBUtil.KMStatePersistence])||KbCommonUtils.CommonUtils.IsMultisessionHost(context)};FCBUtil.CurrentWave="April2020Update";FCBUtil.October2020Wave="October2020Update";FCBUtil.KMExpandCollapse="KMExpandCollapseEnabled";FCBUtil.KMInsertArticle="KMInsertArticleEnabled";FCBUtil.KMCopyPasteImage="KMCopyPasteImageEnabled";FCBUtil.KMCopyPasteImageWithDefaultDialog="KMCopyPasteImageEnabledWithDefaultDialog";FCBUtil.KMStatePersistence="KMStatePersistence";FCBUtil.KMRichTextEditorEnabled="KMRichTextEditorEnabled";FCBUtil.KMFederatedSearch="KMFederatedSearch";FCBUtil.KMFederatedSearchRefreshUI="KMFederatedSearchRefreshUI";FCBUtil.KMRelevanceSearchDisplayDateEnabled="KMRelevanceSearchDisplayDateEnabled";FCBUtil.KMRelevanceSearchPublicAPI="KMRelevanceSearchPublicAPI";FCBUtil.April2021Wave="April2021Update";FCBUtil.KMPersonalizedSettingsEnabled="KMPersonalizedSettingsEnabled";FCBUtil.KMFilterCustomizationEnabled="KMFilterCustomizationEnabled";FCBUtil.KMApril2021ForDFMEnabled="KMApril2021ForDFM";return FCBUtil}();KbCommonUtils.FCBUtil=FCBUtil})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var TelemetryReporter=function(){function TelemetryReporter(){}TelemetryReporter.LogError=function(context,params){if(!context)return;var eventParameters=[];eventParameters.push({name:"ControlType",value:params.controlType});eventParameters.push({name:"EntityType",value:this.GetEntityTypeName(context)});eventParameters.push({name:"SourceType",value:TelemetryReporter.GetSourceType(context,params.controlType)});params.eventParams&&params.eventParams.forEach(function(element){eventParameters.push({name:element.name,value:element.value})});var componentName=params.componentName==null?KbCommonUtils.TelemetryComponentName.KnowledgeManagement_Error:params.componentName;context.reporting.reportFailure(componentName,new Error(params.errorMessage),"",eventParameters)};TelemetryReporter.LogInfo=function(context,params){if(!context)return;var eventParameters=TelemetryReporter.CreateEventParameters(context,params),componentName=params.componentName==null?KbCommonUtils.TelemetryComponentName.KnowledgeManagement_Info:params.componentName;context.reporting.reportSuccess(componentName,eventParameters)};TelemetryReporter.LogUsage=function(context,params){if(!context)return;var eventParameters=TelemetryReporter.CreateEventParameters(context,params),componentName=params.componentName==null?KbCommonUtils.TelemetryComponentName.KnowledgeManagement_Usage:params.componentName;context.reporting.reportSuccess(componentName,eventParameters)};TelemetryReporter.CreateEventParameters=function(context,params){var eventParameters=[];eventParameters.push({name:"ActionName",value:params.actionName});eventParameters.push({name:"ControlType",value:params.controlType});eventParameters.push({name:"EntityType",value:this.GetEntityTypeName(context)});eventParameters.push({name:"SourceType",value:params.sourceType==null?TelemetryReporter.GetSourceType(context,params.controlType):params.sourceType});eventParameters.push({name:"ReleaseWave",value:params.releaseWave==null?"":params.releaseWave});eventParameters.push({name:"FeatureName",value:params.featureName==null?"":params.featureName});eventParameters.push({name:"SubFeatureName",value:params.subFeatureName==null?"":params.subFeatureName});params.eventParams&&params.eventParams.forEach(function(element){eventParameters.push({name:element.name,value:element.value})});return eventParameters};TelemetryReporter.GetSourceType=function(context,controlType){var sourceType="";if(KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(context))sourceType=KbCommonUtils.TelemetrySourceType.ProductivityPanel;else if(KbCommonUtils.CommonUtils.IsHostedInMultisessionStandaloneMode(context))sourceType=KbCommonUtils.TelemetrySourceType.AppTab;else if(KbCommonUtils.CommonUtils.IsHostedInEntityContext(context))sourceType=KbCommonUtils.TelemetrySourceType.EntityForm;else if(KbCommonUtils.CommonUtils.IsInSearchPageContext())sourceType=KbCommonUtils.TelemetrySourceType.SiteMap;else if(KbCommonUtils.CommonUtils.IsLoadedInDialog(context))sourceType=KbCommonUtils.TelemetrySourceType.Dialog;else if(KbCommonUtils.CommonUtils.IsInArticlePageContext())sourceType=KbCommonUtils.TelemetrySourceType.ArticlePage;return sourceType};TelemetryReporter.GetEntityTypeName=function(context){var entityTypeName="";if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.page.entityTypeName))entityTypeName=context.page.entityTypeName;else if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(context.page.entityTypeName)&&KbCommonUtils.CommonUtils.IsLoadedInDialog(context)&&context.parameters.WrapperContext.DialogContext.EntityTypeName)entityTypeName=context.parameters.WrapperContext.DialogContext.EntityTypeName;return entityTypeName};return TelemetryReporter}();KbCommonUtils.TelemetryReporter=TelemetryReporter})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var CommonUtils=function(){function CommonUtils(){}CommonUtils.isUci=function(){var winObj=window;if(winObj.Xrm&&winObj.Xrm.Internal&&winObj.Xrm.Internal.isUci)return winObj.Xrm.Internal.isUci();return false};CommonUtils.getRatingIcon=function(){return KbCommonUtils.IconSymbolCode.Rating};CommonUtils.getUserId=function(){var userId=Xrm.Utility.getGlobalContext().userSettings.userId;userId=userId.replace(/[{}]/g,"");return userId};CommonUtils.getScrollPos=function(id,context){var divId=context.accessibility.getUniqueId(id);if(divId!=null){var element=document.getElementById(divId);if(divId.indexOf("VirtualFilterControlContainer")>=0&&element!=null)element=element.querySelector(".webkitScroll");if(element!=null)return element.scrollTop}return 0};CommonUtils.IsExpandedMode=function(context){return context.client.allocatedWidth>=parseInt(context.theming.breakpoints.dimensionm,10)};CommonUtils.IsStandaloneMode=function(context){return MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(context.page.entityTypeName)||this.IsExpandedMode(context)};CommonUtils.IsHostedInEntityContext=function(context){var isHostedInEntityPageContext=!MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(context.page.entityTypeName)&&!MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(context.page.entityId),isHostedInEntityDialogContext=this.IsLoadedInDialog(context)&&!MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(context.parameters.WrapperContext.DialogContext.EntityTypeName)&&!MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(context.parameters.WrapperContext.DialogContext.EntityId);return isHostedInEntityPageContext||isHostedInEntityDialogContext};CommonUtils.IsReferencePanel=function(context){return CommonUtils.IsHostedInEntityContext(context)&&!CommonUtils.IsLoadedInProductivityPanel(context)&&!CommonUtils.IsLoadedInDialog(context)};CommonUtils.IsInSearchPageContext=function(){return window&&window.location&&window.location.href&&window.location.href.toLowerCase().indexOf("kbsearch")>-1};CommonUtils.IsInArticlePageContext=function(){return window&&window.location&&window.location.href&&window.location.href.toLowerCase().indexOf("kbarticle")>-1};CommonUtils.IsMultisessionHost=function(context){return context.parameters.WrapperContext&&context.parameters.WrapperContext.MultisessionContext};CommonUtils.IsLoadedInProductivityPanel=function(context){return CommonUtils.IsMultisessionHost(context)&&context.parameters.WrapperContext.MultisessionContext.IsProductivityPane};CommonUtils.IsLoadedInDialog=function(context){return context.parameters.WrapperContext&&context.parameters.WrapperContext.DialogContext};CommonUtils.GetDialogUniqueName=function(context){if(this.IsLoadedInDialog(context)&&context.parameters.WrapperContext.DialogContext.DialogUniqueName)return context.parameters.WrapperContext.DialogContext.DialogUniqueName;return ""};CommonUtils.IsHostedInMultisessionStandaloneMode=function(context){return CommonUtils.IsMultisessionHost(context)&&!CommonUtils.IsLoadedInProductivityPanel(context)};CommonUtils.IsArticleOpenInMultisessionAppTab=function(context){return CommonUtils.IsMultisessionHost(context)&&context.mode&&context.mode.fullPageParam&&context.mode.fullPageParam.showControl==KbCommonUtils.Constants.ShowArticle};CommonUtils.IsEntityTypeConversation=function(context){if(context.parameters&&context.parameters.AnchorTabContext&&context.parameters.AnchorTabContext.raw){var anchorTabData=JSON.parse(context.parameters.AnchorTabContext.raw);if(anchorTabData.entityName!=KbCommonUtils.Constants.ConversationEntityName)return false}return true};CommonUtils.IsEntityTypeConversationHostedInProductivityPane=function(context){return CommonUtils.IsLoadedInProductivityPanel(context)&&CommonUtils.IsEntityTypeConversation(context)};CommonUtils.IsRecordFromMicrosoftSearch=function(record){return KbCommonUtils.SearchProviderType.MSSearchConnector===record.searchProviderType||KbCommonUtils.SearchProviderType.MSSearchSharePoint===record.searchProviderType};CommonUtils.IsRecordFromDynamicsSearch=function(record){return KbCommonUtils.SearchProviderType.InternalDynamicsOrg===record.searchProviderType||KbCommonUtils.SearchProviderType.CrossDynamicsOrg===record.searchProviderType};CommonUtils.IsRecordFromCrossDynamicsOrgSearch=function(record){return KbCommonUtils.SearchProviderType.CrossDynamicsOrg===record.searchProviderType};CommonUtils.IsRecordFromFederatedSearch=function(record){return this.IsRecordFromCrossDynamicsOrgSearch(record)||this.IsRecordFromMicrosoftSearch(record)};CommonUtils.IsNetworkAvailable=function(){var globalContext=window.Xrm.Utility&&window.Xrm.Utility.getGlobalContext(),client=globalContext&&globalContext.client;if(client)if(client.isNetworkAvailable)return client.isNetworkAvailable();return false};CommonUtils.IncrementKnowledgeArticleViewCountOfCurrentOrg=function(context,articleId){var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(context,KbCommonUtils.TelemetryControlType.KbArticleControl,KbCommonUtils.TelemetryActionName.Increase_View_Count),entityReference={id:articleId,entityType:KbCommonUtils.Constants.KnowledgeArticleEntityType},viewDate=moment().format(KbCommonUtils.Constants.ViewDateFormat),count=1,location=1,url=KbCommonUtils.Constants.ODATA_PATH+KbCommonUtils.Constants.IncreaseViewEndpoint,knowledgearticleId=entityReference.id;url=MscrmCommon.ControlUtils.String.Format(url,knowledgearticleId,viewDate,location,count);KbCommonUtils.FetchApiHelper.Fetch(context,KbCommonUtils.GET_METHOD,url,"").then(function(response){watermarkTelemetryEvent.End()},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||"";watermarkTelemetryEvent.EndAndLogError({errorMessage:"IncrementKnowledgeArticleViewCountOfCurrentOrg: "+errorMessage,eventParams:[{name:"errorDetail",value:JSON.stringify(error?error:"")}]})})};CommonUtils.GetAppIdInCIFramework=function(){try{return window&&window.top&&window.top["Microsoft"]&&window.top["Microsoft"].hasOwnProperty("CIFramework")&&window.top["Microsoft"]["CIFramework"].hasOwnProperty("Internal")?window.top["Microsoft"]["CIFramework"]["Internal"].appId:""}catch(e){return ""}};CommonUtils.GetMaxString=function(value,maxLength){var result=value;if(result&&result.length>maxLength)result=value.substring(0,maxLength-1);return result};CommonUtils.GenerateUUID=function(){var d=(new Date).getTime(),d2=performance&&performance.now&&performance.now()*1e3||0;return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16;if(d>0){r=(d+r)%16|0;d=Math.floor(d/16)}else{r=(d2+r)%16|0;d2=Math.floor(d2/16)}return (c==="x"?r:r&3|8).toString(16)})};CommonUtils.CreateKnowledgeInteractionRecord=function(context,knowledgeoperationid,interactiontype,articlerecordid,articlerank,controlType,knowledgeoperationtype,articlerelevance,interactioncontext){if(controlType===void 0)controlType=KbCommonUtils.TelemetryControlType.KbSearchControl;if(knowledgeoperationtype===void 0)knowledgeoperationtype=KbCommonUtils.KnowledgeOperationType.KnowledgeSearch;if(articlerelevance===void 0)articlerelevance=null;if(interactioncontext===void 0)interactioncontext=null;var deferred=$.Deferred(),eventParams=[];eventParams.push({name:"KnowledgeOperationType",value:knowledgeoperationtype});eventParams.push({name:"InteractionType",value:interactiontype});if(!knowledgeoperationid||!articlerank){KbCommonUtils.TelemetryReporter.LogError(context,{componentName:KbCommonUtils.TelemetryComponentName.KMInsights_FailedCreateInteractionRecord,controlType:controlType,errorMessage:"Invalid knowledgeoperationid or articlerank. knowledgeoperationid:"+knowledgeoperationid+", articlerank:"+articlerank,eventParams:eventParams});deferred.reject()}else{var recordPayload={KnowledgeOperationId:knowledgeoperationid,KnowledgeOperationType:knowledgeoperationtype,Timestamp:new Date,InteractionType:interactiontype,ArticleRecordId:articlerecordid,ArticleRelevance:articlerelevance,ArticleRank:articlerank,InteractionContext:CommonUtils.GetMaxString(interactioncontext,2e3)},requestData={InteractionRecordPayload:JSON.stringify(recordPayload)},OdataUri=KbCommonUtils.Constants.ODATA_PATH+"/CreateKMInsightRecord";KbCommonUtils.FetchApiHelper.Fetch(context,KbCommonUtils.POST_METHOD,OdataUri,JSON.stringify(requestData)).then(function(result){eventParams.push({name:"InteractionInsightRecordId",value:result.RecordId});KbCommonUtils.TelemetryReporter.LogUsage(context,{actionName:KbCommonUtils.TelemetryActionName.KMInsights_Interaction,controlType:controlType,releaseWave:KbCommonUtils.TelemetryReleaseWave.October2020,featureName:knowledgeoperationtype==KbCommonUtils.KnowledgeOperationType.KnowledgeSearch?KbCommonUtils.TelemetryFeatureName.KMInsights:KbCommonUtils.TelemetryFeatureName.KMSuggestion,eventParams:eventParams});deferred.resolve()},function(errorResponse){KbCommonUtils.TelemetryReporter.LogError(context,{componentName:KbCommonUtils.TelemetryComponentName.KMInsights_FailedCreateInteractionRecord,controlType:controlType,errorMessage:errorResponse.message,eventParams:eventParams});deferred.reject()})}return deferred.promise()};CommonUtils.ConvertArticleActionToInteractionType=function(articleActionId){switch(articleActionId){case KbCommonUtils.ArticleAction.LinkArticle:return KbCommonUtils.InteractionType.LinkArticle;case KbCommonUtils.ArticleAction.UnlinkArticle:return KbCommonUtils.InteractionType.UnlinkArticle;case KbCommonUtils.ArticleAction.EmailArticle:return KbCommonUtils.InteractionType.EmailArticleURL;case KbCommonUtils.ArticleAction.EmailArticleContent:return KbCommonUtils.InteractionType.EmailArticleContent;case KbCommonUtils.ArticleAction.CopyLink:return KbCommonUtils.InteractionType.CopyLink;case KbCommonUtils.ArticleAction.PopoutArticle:return KbCommonUtils.InteractionType.PopoutArticle;case KbCommonUtils.ArticleAction.PrintArticle:return KbCommonUtils.InteractionType.PrintArticle;case KbCommonUtils.ArticleAction.SendToCTI:return KbCommonUtils.InteractionType.SendLink;default:return KbCommonUtils.InteractionType.ViewArticle}};CommonUtils.GetKMSettings=function(context,controlType){return KbCommonUtils.KbCommonDataHandler.GetKMSettings(context).then(function(kmSettingsResponse){return kmSettingsResponse.kmSettings},function(error){KbCommonUtils.TelemetryReporter.LogError(context,{errorMessage:error,controlType:controlType});throw error})};return CommonUtils}();KbCommonUtils.CommonUtils=CommonUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var WatermarkTelemetryEvent=function(){function WatermarkTelemetryEvent(context,webResourceName,functionName,additionalEventParameters){this.context=context;this.webResourceName=webResourceName;this.functionName=functionName;this.additionalEventParameters=additionalEventParameters;this.startTime=new Date}WatermarkTelemetryEvent.Start=function(context,webResourceName,functionName,additionalEventParameters){var telemetryEventObj=new WatermarkTelemetryEvent(context,webResourceName,functionName,additionalEventParameters);if(!context)return telemetryEventObj;var telemetryevent=telemetryEventObj.CreateWatermarkTelemetryEvent();telemetryEventObj.context.reporting.reportEvent(telemetryevent);return telemetryEventObj};WatermarkTelemetryEvent.prototype.End=function(){if(!this.context)return;var endTime=new Date,telemetryevent=this.CreateWatermarkTelemetryEvent(),executionTime=endTime.getTime()-this.startTime.getTime();telemetryevent.eventParameters.push({name:"executionTime",value:executionTime});this.context.reporting.reportEvent(telemetryevent)};WatermarkTelemetryEvent.prototype.EndAndLogError=function(errorParams){this.End();KbCommonUtils.TelemetryReporter.LogError(this.context,errorParams)};WatermarkTelemetryEvent.prototype.CreateWatermarkTelemetryEvent=function(){var eventParameters=[];eventParameters.push({name:"webResourceName",value:this.webResourceName});eventParameters.push({name:"functionName",value:this.functionName});this.additionalEventParameters&&this.additionalEventParameters.forEach(function(additionalEventParameter){eventParameters.push(additionalEventParameter)});var telemetryevent={eventName:"ServiceWebResources",eventParameters:eventParameters};return telemetryevent};return WatermarkTelemetryEvent}();KbCommonUtils.WatermarkTelemetryEvent=WatermarkTelemetryEvent})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOperationUtils=function(){function ActionOperationUtils(){}ActionOperationUtils.GetKMExternalPortalUrl=function(operationPayload){if(KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(operationPayload.Record)||operationPayload.Record.isIngestedArticle)return operationPayload.Record.articleUrl;var kmExternalPortalUrl=operationPayload[KbCommonUtils.Constants.ExternalKMPortalURL];if(kmExternalPortalUrl){var articleRE=new RegExp("{kbnum}","g");return kmExternalPortalUrl.replace(articleRE,operationPayload[KbCommonUtils.Constants.ArticlePublicNumber])}else return ""};ActionOperationUtils.GetStateOfArticle=function(operationPayload){var isRelevanceSearchEnabled=operationPayload[KbCommonUtils.Constants.IsRelevanceSearchEnabled];if(isRelevanceSearchEnabled)switch(operationPayload[KbCommonUtils.Constants.StateCode]){case KbCommonUtils.KbCommonControlLocale.AllDraftArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Draft"],10);case KbCommonUtils.KbCommonControlLocale.AllApprovedArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Approved"],10);case KbCommonUtils.KbCommonControlLocale.AllDiscardedArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Discarded"],10);case KbCommonUtils.KbCommonControlLocale.AllExpiredArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Expired"],10);case KbCommonUtils.KbCommonControlLocale.AllScheduledArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Scheduled"],10);case KbCommonUtils.KbCommonControlLocale.AllArchivedArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Archived"],10);case KbCommonUtils.KbCommonControlLocale.AllPublishedArticlesLocale:default:return parseInt(KbCommonUtils.Constants.ArticleState["Published"],10)}else return operationPayload[KbCommonUtils.Constants.StateCode]};ActionOperationUtils.ShouldShowConfirmationDialog=function(operationPayload){return operationPayload.IsSearchScenario&&operationPayload[KbCommonUtils.Constants.IsAssociated]&&!KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()};ActionOperationUtils.ShowConfirmationDialog=function(operationPayload){var deferred=$.Deferred(),dialogTitle=KbCommonUtils.KbCommonControlLocale.ConfirmDialogTitle,dialogText=MscrmCommon.ControlUtils.String.Format(KbCommonUtils.KbCommonControlLocale.ConfirmDialogText,operationPayload.ControlContext.parameters.value.entityReference.LogicalName),dialogPromise=operationPayload.ControlContext.navigation.openConfirmDialog({title:dialogTitle,text:dialogText},null);dialogPromise.then(function(value){if(value&&value.confirmed)deferred.resolve();else deferred.reject()});return deferred.promise()};ActionOperationUtils.GetBrowserType=function(userAgent){var userAgentString=window.navigator.userAgent.toLowerCase();if(userAgentString.indexOf("edge")>-1&&userAgentString.indexOf("windows nt")>-1)return KbCommonUtils.Browsers.Edge;if(userAgent.isBrowserChrome)return KbCommonUtils.Browsers.Chrome;if(userAgent.isBrowserFirefox)return KbCommonUtils.Browsers.Firefox;if(userAgent.isBrowserIE)return KbCommonUtils.Browsers.IE;if(userAgent.isBrowserSafari)return KbCommonUtils.Browsers.Safari};ActionOperationUtils.GetActionSource=function(operationPayload){if(!operationPayload)return KbCommonUtils.ActionSource.Unknown;if(operationPayload.customActionParams!=null||operationPayload instanceof KbCommonUtils.ActionPayload&&!operationPayload.IsSearchScenario)return KbCommonUtils.ActionSource.Suggestion;return KbCommonUtils.ActionSource.Search};ActionOperationUtils.getActionTypeByName=function(actionName){if(this.actionNameTypeMap==null){this.actionNameTypeMap={};for(var action in KbCommonUtils.ArticleAction){var value=parseInt(KbCommonUtils.ArticleAction[action]);if(!isNaN(value))this.actionNameTypeMap[action]=value}}return this.actionNameTypeMap[actionName]};ActionOperationUtils.GetDefaultOutputForTabOpenActions=function(status,operationPayload,error){var actionOutput=new KbCommonUtils.ActionOutput;actionOutput.status=status;error.message==KbCommonUtils.Constants.MAX_TAB_FAILURE&&KbCommonUtils.MultisessionUtils.OpenErrorDialog(operationPayload.ControlContext.resources.getString(KbCommonUtils.Constants.MaxTabFailureTitle),operationPayload.ControlContext.resources.getString(KbCommonUtils.Constants.MaxTabFailureMessage));return actionOutput};ActionOperationUtils.actionNameTypeMap=null;return ActionOperationUtils}();KbCommonUtils.ActionOperationUtils=ActionOperationUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var EmailActionUtils=function(){function EmailActionUtils(){}EmailActionUtils.sendEmailContent=function(operationPayload,emailArticleContent,isDynamicsOrg,dynamicsOrgResourceUri){return EmailActionUtils.getContentToMail(operationPayload,emailArticleContent,isDynamicsOrg,dynamicsOrgResourceUri).done(function(contentToMail){var articleTitle=operationPayload.Title,knowledgeArticleId=operationPayload.KnowledgeArticleId,currentBaseEntityReference=operationPayload[KbCommonUtils.Constants.AssociatedEntityReference],primaryCustomerField=operationPayload[KbCommonUtils.Constants.SelectPrimaryCustomer],recepientTargetField=[];if(primaryCustomerField){recepientTargetField=Xrm.Page.getAttribute(primaryCustomerField).getValue();recepientTargetField[0].fieldname="to"}var emailObject={to:recepientTargetField,description:contentToMail,subject:articleTitle,id:knowledgeArticleId};EmailActionUtils.CheckIfEmailHasRegardingRelationshipsToEntity(operationPayload[KbCommonUtils.Constants.AssociatedEntityType],operationPayload.ControlContext).then(function(regardingRelationshipExists){if(operationPayload.IsLoadedInProductivityPane)if(regardingRelationshipExists){var promise=KbCommonUtils.MultisessionUtils.getAnchorTabTitle(operationPayload.ControlContext);promise.then(function(anchorTabTitle){EmailActionUtils.updateEmailRegardingObject(emailObject,currentBaseEntityReference,anchorTabTitle);KbCommonUtils.MultisessionUtils.OpenEmailAppTab(emailObject)},function(err){KbCommonUtils.TelemetryReporter.LogError(operationPayload.ControlContext,{controlType:operationPayload.ControlType,errorMessage:"Failed to get anchor tab title",eventParams:[{name:"ErrorDetails",value:err?err.toString():""}]});KbCommonUtils.MultisessionUtils.OpenEmailAppTab(emailObject)})}else KbCommonUtils.MultisessionUtils.OpenEmailAppTab(emailObject);else{if(regardingRelationshipExists){var entityReferenceName=Xrm.Page.data.entity.getPrimaryAttributeValue();EmailActionUtils.updateEmailRegardingObject(emailObject,currentBaseEntityReference,entityReferenceName)}var formOptions={entityName:KbCommonUtils.Constants.Email,useQuickCreateForm:true};operationPayload.ControlContext.navigation.openForm(formOptions,emailObject)}})})};EmailActionUtils.updateEmailRegardingObject=function(emailObject,currentBaseEntityReference,entityReferenceName){emailObject[KbCommonUtils.Constants.RegardingObjectId]={fieldname:KbCommonUtils.Constants.RegardingObjectId,id:currentBaseEntityReference.Id.guid,entityType:currentBaseEntityReference.LogicalName,name:entityReferenceName}};EmailActionUtils.CheckIfEmailHasRegardingRelationshipsToEntity=function(entityLogicalName,controlContext){var promise=$.Deferred();Xrm.Utility.getEntityMetadata(KbCommonUtils.Constants.Email).then(function(entityMetadata){var regardingRelationships=[];if(entityMetadata&&entityMetadata.ManyToOneRelationships)regardingRelationships=entityMetadata.ManyToOneRelationships.getByFilter(function(relationship){return relationship.ReferencingAttribute.toLowerCase()==KbCommonUtils.Constants.RegardingObjectId&&relationship.ReferencedEntity.toLowerCase()==entityLogicalName.toLowerCase()});var params=[];params.push({name:"entity",value:entityLogicalName});params.push({name:"relationshipExists",value:regardingRelationships.length>0});KbCommonUtils.TelemetryReporter.LogInfo(controlContext,{componentName:KbCommonUtils.TelemetryComponentName.KnowledgeManagement_SendEmailContent,actionName:KbCommonUtils.TelemetryActionName.SendEmailContent_CheckIfEmailHasRegardingRelationshipsToEntity,controlType:KbCommonUtils.TelemetryControlType.KbSearchControl,eventParams:params});return promise.resolve(regardingRelationships.length>0)},function(errorResponse){KbCommonUtils.TelemetryReporter.LogError(controlContext,{componentName:KbCommonUtils.TelemetryComponentName.KnowledgeManagement_SendEmailContent,controlType:KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:"KbSearchControl.sendEmailContent.getEntityMetadata: "+errorResponse.message});return promise.resolve(false)});return promise};EmailActionUtils.getContentToMail=function(operationPayload,emailArticleContent,isDynamicsOrg,dynamicsOrgResourceUri){var contentPromise=$.Deferred(),isSearchScenario=operationPayload.IsSearchScenario,isRelevanceSearchEnabled=operationPayload[KbCommonUtils.Constants.IsRelevanceSearchEnabled];if(!emailArticleContent)contentPromise.resolve(KbCommonUtils.ActionOperationUtils.GetKMExternalPortalUrl(operationPayload));else if(isSearchScenario&&isRelevanceSearchEnabled)EmailActionUtils.GetFormattedContent(operationPayload.ControlContext,operationPayload.KnowledgeArticleId,isDynamicsOrg,dynamicsOrgResourceUri).done(function(formattedContent){contentPromise.resolve(formattedContent)}).fail(function(errorResponse){contentPromise.reject(errorResponse)});else EmailActionUtils.GetContentWithDynamicsImageInline(operationPayload[KbCommonUtils.Constants.ContentToMail],operationPayload.ControlContext,contentPromise,isDynamicsOrg,dynamicsOrgResourceUri);return contentPromise.promise()};EmailActionUtils.markArticleSentToCustomer=function(operationPayload){var knowledgeArticleIncidents=null,fetchXml="<fetch version='1.0' mapping='logical'><entity name='knowledgearticleincident'><attribute name='issenttocustomer'/><filter type='and'><condition attribute='incidentid' operator='eq' value='"+operationPayload[KbCommonUtils.Constants.AssociatedEntityId]+"' /><condition attribute='knowledgearticleid' operator='eq' value='"+operationPayload.KnowledgeArticleId+"' /></filter></entity></fetch>";operationPayload[KbCommonUtils.Constants.AssociatedEntityType]==KbCommonUtils.Constants.Incident&&operationPayload.ControlContext.webAPI.retrieveMultipleRecords(KbCommonUtils.Constants.KnowledgeArticleIncident,"?fetchXml="+fetchXml).then(function(retrieveContractDetailResponse){knowledgeArticleIncidents=retrieveContractDetailResponse.entities;if(knowledgeArticleIncidents.length>0&&!knowledgeArticleIncidents[0].issenttocustomer){var dataToUpdate={issenttocustomer:true};operationPayload.ControlContext.webAPI.updateRecord(KbCommonUtils.Constants.KnowledgeArticleIncident,knowledgeArticleIncidents[0].knowledgearticleincidentid,dataToUpdate).then(function(result){},function(errorResponse){console.error(errorResponse)})}},function(errorResponse){console.error(errorResponse)})};EmailActionUtils.SetFormattedContent=function(context,kbSearchRecord){var _this=this,deferred=$.Deferred();EmailActionUtils.GetFormattedContent(context,kbSearchRecord.knowledgeArticleId,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==kbSearchRecord.searchProviderType,kbSearchRecord.resourceUri).done(function(response){kbSearchRecord.content=response;deferred.resolve(kbSearchRecord)}).fail(function(error){if(typeof error==="string"){kbSearchRecord.content=error;deferred.rejectWith(_this,[kbSearchRecord])}else{console.error(error);deferred.reject()}});return deferred.promise()};EmailActionUtils.GetFormattedContent=function(context,knowledgeArticleId,isDynamicsOrg,dynamicsOrgResourceUri){var ODataEndPointUri=MscrmCommon.ControlUtils.String.Format(KbCommonUtils.Constants.URL_KA_TITLE_CONTENT,knowledgeArticleId),deferred=$.Deferred();KbCommonUtils.FetchApiHelper.Fetch(context,KbCommonUtils.GET_METHOD,KbCommonUtils.Constants.ODATA_PATH+ODataEndPointUri,"",isDynamicsOrg,dynamicsOrgResourceUri,KbCommonUtils.Constants.CrossDynamicsOrgApiCall).then(function(response){if(response.value.length>0){var searchResult=response.value[0];EmailActionUtils.GetContentWithDynamicsImageInline(searchResult.content,context,deferred,isDynamicsOrg,dynamicsOrgResourceUri)}else{Xrm.Navigation.openAlertDialog(KbCommonUtils.KbCommonControlLocale.RecordDoesNotExistErrorMessage);deferred.reject()}},function(errorResponse){deferred.reject(errorResponse)});return deferred.promise()};EmailActionUtils.GetContentWithDynamicsImageInline=function(contentToMail,context,deferred,isDynamicsOrg,dynamicsOrgResourceUri){if(contentToMail==null)return deferred.resolve(contentToMail);var dynamicsImageUrlsTobeParsed=contentToMail.match(KbCommonUtils.Constants.KBArticleImageTagRegex);if(dynamicsImageUrlsTobeParsed!=null)EmailActionUtils.ReplaceBase64InlineAllImages(dynamicsImageUrlsTobeParsed,context,contentToMail,isDynamicsOrg,dynamicsOrgResourceUri).then(function(formattedContent){return deferred.resolve(formattedContent)},function(errorResponse){return deferred.reject(errorResponse)});else deferred.resolve(contentToMail)};EmailActionUtils.IsValidToSendEmail=function(operationPayload){var canSendMail=KbCommonUtils.ActionOperationUtils.GetStateOfArticle(operationPayload)===3&&operationPayload[KbCommonUtils.Constants.KmPrivileges]&&operationPayload[KbCommonUtils.Constants.KmPrivileges].CanEmail;return operationPayload[KbCommonUtils.Constants.IsAssociated]?canSendMail:canSendMail&&operationPayload[KbCommonUtils.Constants.KmPrivileges].CanAssociateAndDisassociate};EmailActionUtils.ReplaceBase64InlineAllImages=function(base64InlineAllImages,context,contentToMail,isDynamicsOrg,dynamicsOrgResourceUri){for(var base64InlineImagesDeffered=$.Deferred(),promises=[],_i=0,base64InlineAllImages_1=base64InlineAllImages;_i<base64InlineAllImages_1.length;_i++){var base64image=base64InlineAllImages_1[_i],promise=EmailActionUtils.GetBase64InlineImage(base64image,context,isDynamicsOrg,dynamicsOrgResourceUri);promises.push(promise)}if(promises.length==0)return base64InlineImagesDeffered.resolve(contentToMail);Promise.all(promises).then(function(successResponse){successResponse.forEach(function(returnValue){var inlineImageSrcTag=returnValue.inlineImageUrlSent.match(KbCommonUtils.Constants.KBArticleImageTagSrcRegex),inlineImagMsdynTag=returnValue.inlineImageUrlSent.match(KbCommonUtils.Constants.KBArticleImageTagmsdyntypeRegex);if(inlineImageSrcTag!=null&&inlineImageSrcTag.length>1&&inlineImagMsdynTag!=null&&inlineImagMsdynTag.length>1)contentToMail=contentToMail.replace(inlineImageSrcTag[1],inlineImagMsdynTag[1]+","+returnValue.response)});return base64InlineImagesDeffered.resolve(contentToMail)},function(errorResponse){var dialogTitle=KbCommonUtils.KbCommonControlLocale.ConfirmDialogTitleForImageLoad,dialogText=KbCommonUtils.KbCommonControlLocale.ConfirmDialogForImageLoadFailureText,associationPromise=context.navigation.openConfirmDialog({title:dialogTitle,text:dialogText},null);associationPromise.then(function(value){if(value&&value.confirmed)return base64InlineImagesDeffered.resolve(contentToMail);else return base64InlineImagesDeffered.reject(errorResponse)})});return base64InlineImagesDeffered.promise()};EmailActionUtils.GetBase64InlineImage=function(inlineImageUrl,context,isDynamicsOrg,dynamicsOrgResourceUri){var base64InlineImageDeferred=$.Deferred();try{var inlineImageSrcTag=inlineImageUrl.match(KbCommonUtils.Constants.KBArticleImageTagSrcRegex);inlineImageSrcTag!=null&&inlineImageSrcTag.length>1&&KbCommonUtils.FetchApiHelper.Fetch(context,KbCommonUtils.GET_METHOD,inlineImageSrcTag[1].replace("$value",""),"",isDynamicsOrg,dynamicsOrgResourceUri,KbCommonUtils.Constants.CrossDynamicsOrgApiCall).then(function(response){if(response.value.length>0){var returnValue={response:response.value,inlineImageUrlSent:inlineImageUrl};base64InlineImageDeferred.resolve(returnValue)}else base64InlineImageDeferred.reject(KbCommonUtils.KbCommonControlLocale.RecordDoesNotExistErrorMessage)},function(errorResponse){KbCommonUtils.TelemetryReporter.LogError(context,{componentName:KbCommonUtils.TelemetryComponentName.KnowledgeManagement_SendEmailContent,controlType:KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:"KbSearchControl.sendEmailContent: "+errorResponse.message});base64InlineImageDeferred.reject(errorResponse)})}catch(errorResponse){KbCommonUtils.TelemetryReporter.LogError(context,{componentName:KbCommonUtils.TelemetryComponentName.KnowledgeManagement_SendEmailContent,controlType:KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:"KbSearchControl.sendEmailContent: "+errorResponse.message});base64InlineImageDeferred.reject(errorResponse)}return base64InlineImageDeferred.promise()};EmailActionUtils.PreExecuteEmailOperation=function(actionOperation,operationPayload){var actionPromise=$.Deferred(),actionOutput=new KbCommonUtils.ActionOutput;!operationPayload[KbCommonUtils.Constants.IsAssociated]&&EmailActionUtils.AssociateRecordwithKnowledgeArticle(operationPayload);if(operationPayload.IsLoadedInProductivityPane&&!KbCommonUtils.MultisessionUtils.CanCreateNewAppTab())actionOutput=actionOperation.GetActionOutput(false,operationPayload,new Error(KbCommonUtils.Constants.MAX_TAB_FAILURE));actionPromise.resolve(actionOutput);return actionPromise.promise()};EmailActionUtils.AssociateRecordwithKnowledgeArticle=function(operationPayload){var linkOperationPayload=new KbCommonUtils.ActionPayload;linkOperationPayload.ControlContext=operationPayload.ControlContext;linkOperationPayload.KnowledgeArticleId=operationPayload.KnowledgeArticleId;linkOperationPayload.Title=operationPayload.Title;linkOperationPayload.IsSearchScenario=operationPayload.IsSearchScenario;linkOperationPayload.IsLoadedInProductivityPane=operationPayload.IsLoadedInProductivityPane;linkOperationPayload.Record=operationPayload.Record;linkOperationPayload.StateManager=operationPayload.StateManager;linkOperationPayload.Browser=operationPayload.Browser;linkOperationPayload.ControlType=operationPayload.ControlType;linkOperationPayload.SuccessMessage="";linkOperationPayload.FailureMessage=operationPayload.FailureMessage;linkOperationPayload[KbCommonUtils.Constants.FetchApiWrapper]=operationPayload[KbCommonUtils.Constants.FetchApiWrapper];linkOperationPayload[KbCommonUtils.Constants.SearchProviderType]=operationPayload[KbCommonUtils.Constants.SearchProviderType];linkOperationPayload[KbCommonUtils.Constants.AssociatedEntityType]=operationPayload[KbCommonUtils.Constants.AssociatedEntityType];linkOperationPayload[KbCommonUtils.Constants.AssociatedEntityId]=operationPayload[KbCommonUtils.Constants.AssociatedEntityId];linkOperationPayload[KbCommonUtils.Constants.AssociationRelationshipName]=operationPayload[KbCommonUtils.Constants.AssociationRelationshipName];linkOperationPayload[KbCommonUtils.Constants.RefreshCallback]=operationPayload[KbCommonUtils.Constants.RefreshCallback];linkOperationPayload[KbCommonUtils.Constants.MarkSentToCustomer]=true;linkOperationPayload[KbCommonUtils.Constants.IsExternalSearchIndexEnabled]=operationPayload[KbCommonUtils.Constants.IsExternalSearchIndexEnabled];if(operationPayload[KbCommonUtils.Constants.ActionCallback]!=null){var emailCallback_1=operationPayload[KbCommonUtils.Constants.ActionCallback],linkActionCallback={successCallback:function(linkOperationPayload,response){EmailActionUtils.markArticleSentToCustomer(linkOperationPayload);emailCallback_1.successCallback(linkOperationPayload,response)},failureCallback:function(linkOperationPayload,error){error.isCanceled===true&&EmailActionUtils.markArticleSentToCustomer(linkOperationPayload);emailCallback_1.failureCallback(linkOperationPayload,error)}};linkOperationPayload[KbCommonUtils.Constants.ActionCallback]=linkActionCallback}return KbCommonUtils.ActionOperationFactory.Instance.Execute(KbCommonUtils.ArticleAction.LinkArticle,linkOperationPayload)};return EmailActionUtils}();KbCommonUtils.EmailActionUtils=EmailActionUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SuggestionActionUtils=function(){function SuggestionActionUtils(){}SuggestionActionUtils.GetAnchorTabContext=function(sessionContext){var tabContext=sessionContext.getTabContext("anchor");return tabContext};SuggestionActionUtils.GetEntityId=function(tabContext){if(tabContext.entityId!=null&&tabContext.entityId!=undefined)return tabContext.entityId;return tabContext.data.ocContext.config.sessionParams.LiveWorkItemId};SuggestionActionUtils.GetSessionContext=function(){return __awaiter(this,void 0,void 0,function(){var session,context;return __generator(this,function(_a){switch(_a.label){case 0:session=Microsoft.AppRuntime.Sessions.getFocusedSession();return [4,session.getContext()];case 1:context=_a.sent();return [2,context]}})})};SuggestionActionUtils.GetInteractionObject=function(operationPayload){var suggestionForEntity=new Guid(operationPayload[KbCommonUtils.Constants.SuggestionForEntityId]),suggestionForEntityLogicalName=operationPayload[KbCommonUtils.Constants.SuggestionForEntityLogicalName],feedbackInteaction={SuggestionRequestId:operationPayload[KbCommonUtils.Constants.SuggestionRequestId],SuggestionForEntityId:suggestionForEntity.toString(),SuggestionForEntityLogicalName:suggestionForEntityLogicalName,SuggestedEntityId:operationPayload.KnowledgeArticleId,InteractionType:this.getInteractionTypeByName(operationPayload[KbCommonUtils.Constants.ActionName]),InteractionContext:this.getInteractionContext(operationPayload)};return feedbackInteaction};SuggestionActionUtils.getInteractionContext=function(operationPayload){var actionName=operationPayload[KbCommonUtils.Constants.ActionName];if(KbCommonUtils.ActionOperationUtils.getActionTypeByName(actionName)==KbCommonUtils.ArticleAction.SendFeedback)return this.getFeedbackInteractionContext(operationPayload);else return ""};SuggestionActionUtils.getFeedbackInteractionContext=function(operationPayload){var context=new KbCommonUtils.FeedbackInteractionContext;context.feedbackvalue=operationPayload[KbCommonUtils.Constants.Feedback]=="1"?KbCommonUtils.HelpfulFeedbackValues.Yes:KbCommonUtils.HelpfulFeedbackValues.No;return JSON.stringify(context)};SuggestionActionUtils.getInteractionTypeByName=function(actionName){if(this.interactionNameTypeMap==null||Object.keys(this.interactionNameTypeMap).length==0){this.interactionNameTypeMap={};for(var action in KbCommonUtils.ArticleAction)this.interactionNameTypeMap[KbCommonUtils.ArticleAction[action]]=KbCommonUtils.InteractionTypes[action]}return this.interactionNameTypeMap[actionName]};SuggestionActionUtils.getCustomActionReturnObject=function(operationPayload,additionalTelemetryParams,successMessage,failureMessage){if(failureMessage===void 0)failureMessage=KbCommonUtils.KnowledgeSuggestionConstants.EmptyString;var telemetryParameters={suggestedEntityId:operationPayload.KnowledgeArticleId,suggestedEntityLogicalName:KbCommonUtils.KnowledgeSuggestionConstants.KAEntityName,sourceType:this.SourceType,interactionType:this.getInteractionTypeByName(operationPayload[KbCommonUtils.Constants.ActionName])},telemetryContext={telemetryParameters:telemetryParameters,additionalTelemetryParameters:additionalTelemetryParams},notificationMessage=successMessage;if(failureMessage!=KbCommonUtils.KnowledgeSuggestionConstants.EmptyString)notificationMessage=failureMessage;var customActionReturn={notificationMessage:notificationMessage,telemetryContext:telemetryContext};return customActionReturn};SuggestionActionUtils.getLocalizedString=function(messageKey,operationPayload){var localizedString="";if(KnowledgeManagement.ResourceStringProvider)localizedString=KnowledgeManagement.ResourceStringProvider.getResourceString(messageKey);if((localizedString==null||localizedString=="")&&(operationPayload&&operationPayload[KbCommonUtils.Constants.LocDictionary]))localizedString=operationPayload[KbCommonUtils.Constants.LocDictionary][messageKey];if(localizedString==null||localizedString=="")localizedString=this.getDefaultLocalizedString(messageKey);return localizedString};SuggestionActionUtils.convertHelpfulFeedbackValueToNumber=function(helpfulfeedback){switch(helpfulfeedback){case KbCommonUtils.HelpfulFeedbackValues.No:return 0;case KbCommonUtils.HelpfulFeedbackValues.Yes:return 1;default:return 2}};SuggestionActionUtils.getDefaultLocalizedString=function(messageKey){if(this.messagesMap==null){this.messagesMap={};var operationFailureString="We're unable to complete the action. Please try again.";this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.SendFeedbackFailedMessage]=operationFailureString;this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.EmailArticleFailedMessage]=operationFailureString;this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.OpenArticleFailedMessage]=operationFailureString;this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.EmailArticleContentFailedMessage]=operationFailureString;this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.LinkArticleFailedMessage]="We're unable to link to the article. Please try again.";this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.UnlinkArticleFailedMessage]="We're unable to unlink the article. Please try again.";this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.CopyUrlSuccessMessage]="URL was copied to the clipboard.";this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.CopyUrlFailedMessage]="We're unable to copy the URL. Please try again.";this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.CTIFailedMessage]=operationFailureString;this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.MaxTabFailureTitle]="Maximum tabs reached";this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.MaxTabFailureMessage]="Close a tab in this session before opening another.";this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.CTIFailedMessageForConversationState]="Unavailable for conversations in {0} state.";this.messagesMap[KbCommonUtils.KnowledgeSuggestionConstants.MaxTabsReachedFailureMessage]="Close a tab in this session and try again."}return this.messagesMap[messageKey]};SuggestionActionUtils.AddUsageTelemetry=function(actionName,actionPayload){var actionPromise=$.Deferred(),payload={actionName:actionName,controlType:actionPayload.ControlType,sourceType:this.SourceType,releaseWave:this.ReleaseWave,featureName:this.FeatureName,eventParams:null};KbCommonUtils.TelemetryReporter.LogUsage(actionPayload.ControlContext,payload);actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};SuggestionActionUtils.PopulateDefaultSuggestionPayload=function(operationPayload,actionPayload,successMessageKey,failureMessageKey){var payloadPromise=$.Deferred();actionPayload.IsSearchScenario=false;actionPayload.IsLoadedInProductivityPane=true;actionPayload[KbCommonUtils.Constants.LocDictionary]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.LocDictionary,operationPayload);actionPayload[KbCommonUtils.Constants.SuggestionForEntityId]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SuggestionForEntityId,operationPayload);actionPayload[KbCommonUtils.Constants.SuggestionForEntityLogicalName]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SuggestionForEntityLogicalName,operationPayload);actionPayload[KbCommonUtils.Constants.SuggestionRequestId]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.SuggestionRequestId,operationPayload);actionPayload[KbCommonUtils.Constants.ActionName]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.ActionName,operationPayload);actionPayload.SuccessMessage=SuggestionActionUtils.getLocalizedString(successMessageKey,actionPayload);actionPayload.FailureMessage=SuggestionActionUtils.getLocalizedString(failureMessageKey,actionPayload);actionPayload[KbCommonUtils.Constants.WebresourceNameArticleActions]=KbCommonUtils.TelemetryConstants.WebresourceNameKbSuggestionActions;actionPayload.ControlType=KbCommonUtils.TelemetryControlType.SmartAssistControl;SuggestionActionUtils.GetSessionContext().then(function(sessionContext){operationPayload[KbCommonUtils.Constants.SessionContext]=sessionContext;operationPayload[KbCommonUtils.Constants.TabContext]=SuggestionActionUtils.GetAnchorTabContext(sessionContext);payloadPromise.resolve()});return payloadPromise.promise()};SuggestionActionUtils.GetActionOutput=function(status,operationPayload,error){var customActionReturn=null;if(!status){var isMaxTabFailure=error&&error.message==KbCommonUtils.Constants.MAX_TAB_FAILURE,failureMessage=isMaxTabFailure?this.getLocalizedString(KbCommonUtils.KnowledgeSuggestionConstants.MaxTabsReachedFailureMessage,operationPayload):operationPayload.FailureMessage;customActionReturn=SuggestionActionUtils.getCustomActionReturnObject(operationPayload,{},KbCommonUtils.KnowledgeSuggestionConstants.EmptyString,failureMessage);customActionReturn.telemetryContext.telemetryParameters.exception=error;isMaxTabFailure&&KbCommonUtils.MultisessionUtils.OpenErrorDialog(this.getLocalizedString(KbCommonUtils.Constants.MaxTabFailureTitle,operationPayload),this.getLocalizedString(KbCommonUtils.Constants.MaxTabFailureMessage,operationPayload))}else customActionReturn=SuggestionActionUtils.getCustomActionReturnObject(operationPayload,{},operationPayload.SuccessMessage);var output=new KbCommonUtils.ActionOutput;output.status=status;output.payload=customActionReturn;return output};SuggestionActionUtils.ParseRawPayloadForEmailAndLinkActions=function(contentPromise,operationPayload,actionPayload,isEmail){SuggestionActionUtils.PopulateDefaultSuggestionPayload(operationPayload,actionPayload,KbCommonUtils.KnowledgeSuggestionConstants.EmptyString,KbCommonUtils.KnowledgeSuggestionConstants.EmailArticleFailedMessage).then(function(){actionPayload[KbCommonUtils.Constants.AssociatedEntityId]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityId,operationPayload);actionPayload[KbCommonUtils.Constants.AssociatedEntityType]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityTypeName,operationPayload);actionPayload[KbCommonUtils.Constants.RefreshCallback]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.RefreshCallback,operationPayload);if(isEmail)actionPayload[KbCommonUtils.Constants.AssociatedEntityReference]=KbCommonUtils.ActionInputAccessorBase.GetProperty(KbCommonUtils.ActionProperty.AssociatedEntityReference,operationPayload);contentPromise.resolve(actionPayload)})};SuggestionActionUtils.FeatureName="Knowledge Suggestions";SuggestionActionUtils.ReleaseWave="October 2020";SuggestionActionUtils.SourceType="KBSuggestionsWebResource";SuggestionActionUtils.messagesMap=null;SuggestionActionUtils.interactionNameTypeMap=null;SuggestionActionUtils.actionNameTypeMap=null;SuggestionActionUtils.PushSuggestionInteraction=function(operationPayload){var actionPromise=$.Deferred();try{var suggestionInteraction=this.GetInteractionObject(operationPayload);KbCommonUtils.PostKnowledgeSuggestionInteraction.ExecuteOperation(suggestionInteraction)}catch(error){var payload={controlType:operationPayload.ControlType,errorMessage:error.message,eventParams:null};KbCommonUtils.TelemetryReporter.LogError(operationPayload.ControlContext,payload)}actionPromise.resolve(new KbCommonUtils.ActionOutput);return actionPromise.promise()};return SuggestionActionUtils}();KbCommonUtils.SuggestionActionUtils=SuggestionActionUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}))