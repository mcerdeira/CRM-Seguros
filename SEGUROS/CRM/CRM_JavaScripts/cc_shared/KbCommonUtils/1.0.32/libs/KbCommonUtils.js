var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionCallbackFactory=function(){function ActionCallbackFactory(){}ActionCallbackFactory.Register=function(articleAction,callback){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(ActionCallbackFactory.callbackList[articleAction])){ActionCallbackFactory.callbackList[articleAction]=callback;return true}return false};ActionCallbackFactory.prototype.GetActionCallback=function(articleAction){var callback=ActionCallbackFactory.callbackList[articleAction];if(callback)return callback;var dummyCallback={successCallback:function(operationPayload,response){},failureCallback:function(operationPayload,error){}};return function(){return dummyCallback}};ActionCallbackFactory.Instance=new ActionCallbackFactory;ActionCallbackFactory.callbackList={};return ActionCallbackFactory}();KbCommonUtils.ActionCallbackFactory=ActionCallbackFactory})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var CTIActionOperation=function(){function CTIActionOperation(){}Object.defineProperty(CTIActionOperation.prototype,"Label",{"get":function(){return "KMControl.SearchKMArticles.SendToCTILabel"},enumerable:true,configurable:true});Object.defineProperty(CTIActionOperation.prototype,"Tooltip",{"get":function(){return "KMControl.SearchKMArticles.SendToCTITooltip"},enumerable:true,configurable:true});Object.defineProperty(CTIActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SendEmail},enumerable:true,configurable:true});CTIActionOperation.prototype.ValidateOperation=function(validationPayload){var stateManager=validationPayload.stateManager;if(KbCommonUtils.CommonUtils.IsArticleOpenInMultisessionAppTab(validationPayload.controlContext)||KbCommonUtils.CommonUtils.IsHostedInMultisessionStandaloneMode(validationPayload.controlContext)||KbCommonUtils.CommonUtils.IsMultisessionHost(validationPayload.controlContext)&&(!stateManager.useExternalKMPortal||!KbCommonUtils.CommonUtils.IsEntityTypeConversation(validationPayload.controlContext)))return false;return window&&window.top&&window.top["Microsoft"]&&window.top["Microsoft"].hasOwnProperty("CIFramework")&&window.top["Microsoft"]["CIFramework"].hasOwnProperty("External")||false};CTIActionOperation.prototype.ExecuteOperation=function(operationPayload){if(KbCommonUtils.CommonUtils.IsMultisessionHost(operationPayload.controlContext)&&KbCommonUtils.CommonUtils.IsEntityTypeConversation(operationPayload.controlContext)){var anchorTabData=JSON.parse(operationPayload.controlContext.parameters.AnchorTabContext.raw),entityId=anchorTabData.entityId;if(entityId==null)if(anchorTabData.data!=null&&anchorTabData.data.ocContext!=null&&anchorTabData.data.ocContext.config&&anchorTabData.data.ocContext.config.sessionParams)entityId=anchorTabData.data.ocContext.config.sessionParams.LiveWorkItemId;entityId!=null&&operationPayload.controlContext.webAPI.retrieveRecord(KbCommonUtils.Constants.ConversationEntityName,entityId,"?$select=statuscode").then(function(record){if(record[KbCommonUtils.Constants.StatusCodeAttribute]==MscrmControls.KbCommonUtils.LiveWorkItemStatus.Open||record[KbCommonUtils.Constants.StatusCodeAttribute]==MscrmControls.KbCommonUtils.LiveWorkItemStatus.Active)window.top.dispatchEvent(KbCommonUtils.ActionOperationUtils.GetCTIEventPayload(operationPayload));else{var title=KbCommonUtils.KbCommonControlLocale.CTIFailedMessageForConversationStateTitle,message=KbCommonUtils.KbCommonControlLocale.CTIFailedMessageForConversationStateText,status_1=record[KbCommonUtils.Constants.StatusCodeValue].toLowerCase(),failureMessage=MscrmCommon.ControlUtils.String.Format(message,status_1),alertMessage={text:failureMessage,title:title};return Xrm.Navigation.openAlertDialog(alertMessage)}})}else window.top.dispatchEvent(KbCommonUtils.ActionOperationUtils.GetCTIEventPayload(operationPayload))};return CTIActionOperation}();KbCommonUtils.CTIActionOperation=CTIActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var EmailActionOperation=function(){function EmailActionOperation(){}Object.defineProperty(EmailActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.EmailArticleIconLabel"},enumerable:true,configurable:true});Object.defineProperty(EmailActionOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"SearchWidget.SearchKMArticles.EmailArticleIconToolTipNew":"SearchWidget.SearchKMArticles.EmailArticleIconToolTip"},enumerable:true,configurable:true});Object.defineProperty(EmailActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.EmailLink},enumerable:true,configurable:true});EmailActionOperation.prototype.ValidateOperation=function(validationPayload){if(KbCommonUtils.CommonUtils.IsEntityTypeConversationHostedInProductivityPane(validationPayload.controlContext))return false;var stateManager=validationPayload.stateManager;return KbCommonUtils.CommonUtils.IsHostedInEntityContext(validationPayload.controlContext)&&stateManager.useExternalKMPortal&&KbCommonUtils.ActionOperationUtils.IsValidToSendEmail(validationPayload)};EmailActionOperation.prototype.ExecuteOperation=function(operationPayload){var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.controlContext,KbCommonUtils.TelemetryConstants.WebresourceNameKbSearchActions,KbCommonUtils.TelemetryActionName.Email_Article_URL);if(operationPayload.record.isAssociated)if(KbCommonUtils.ActionOperationUtils.ShouldShowConfirmationDialog(operationPayload)){var dialogPromise=KbCommonUtils.ActionOperationUtils.ShowConfirmationDialog(operationPayload);dialogPromise.then(function(){KbCommonUtils.ActionOperationUtils.sendEmailContent(operationPayload,false,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload.record.searchProviderType,operationPayload.record.resourceUri);watermarkTelemetryEvent.End()},function(){watermarkTelemetryEvent.End()})}else{KbCommonUtils.ActionOperationUtils.sendEmailContent(operationPayload,false,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload.record.searchProviderType,operationPayload.record.resourceUri);watermarkTelemetryEvent.End()}else{var emailCallback_1=operationPayload.actionOperationCallback(),linkActionCallback_1={successCallback:function(linkOperationPayload,response){KbCommonUtils.ActionOperationUtils.markArticleSentToCustomer(linkOperationPayload);emailCallback_1.successCallback(linkOperationPayload,response)},failureCallback:function(linkOperationPayload,error){error.isCanceled===true&&KbCommonUtils.ActionOperationUtils.markArticleSentToCustomer(linkOperationPayload);emailCallback_1.failureCallback(linkOperationPayload,error)}},linkOperationPayload={controlContext:operationPayload.controlContext,stateManager:operationPayload.stateManager,record:operationPayload.record,fetchApiWrapper:operationPayload.fetchApiWrapper,actionOperationCallback:function(){return linkActionCallback_1}};KbCommonUtils.ActionOperationFactory.Instance.Execute(KbCommonUtils.ArticleAction.LinkArticle,linkOperationPayload);KbCommonUtils.ActionOperationUtils.sendEmailContent(operationPayload,false,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload.record.searchProviderType,operationPayload.record.resourceUri);watermarkTelemetryEvent.End()}};return EmailActionOperation}();KbCommonUtils.EmailActionOperation=EmailActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var EmailContentActionOperation=function(){function EmailContentActionOperation(){}Object.defineProperty(EmailContentActionOperation.prototype,"Label",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"SearchWidget.SearchKMArticles.EmailArticleContentIconLabelNew":"SearchWidget.SearchKMArticles.EmailArticleContentIconLabel"},enumerable:true,configurable:true});Object.defineProperty(EmailContentActionOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"SearchWidget.SearchKMArticles.EmailArticleContentIconToolTipNew":"SearchWidget.SearchKMArticles.EmailArticleContentIconToolTip"},enumerable:true,configurable:true});Object.defineProperty(EmailContentActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SendEmail},enumerable:true,configurable:true});EmailContentActionOperation.prototype.ValidateOperation=function(validationPayload){if(KbCommonUtils.CommonUtils.IsEntityTypeConversationHostedInProductivityPane(validationPayload.controlContext))return false;return KbCommonUtils.CommonUtils.IsHostedInEntityContext(validationPayload.controlContext)&&KbCommonUtils.ActionOperationUtils.IsValidToSendEmail(validationPayload)};EmailContentActionOperation.prototype.ExecuteOperation=function(operationPayload){var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.controlContext,KbCommonUtils.TelemetryConstants.WebresourceNameKbSearchActions,KbCommonUtils.TelemetryActionName.Email_Article_Content);if(operationPayload.record.isAssociated)if(KbCommonUtils.ActionOperationUtils.ShouldShowConfirmationDialog(operationPayload)){var dialogPromise=KbCommonUtils.ActionOperationUtils.ShowConfirmationDialog(operationPayload);dialogPromise.then(function(){KbCommonUtils.ActionOperationUtils.sendEmailContent(operationPayload,true,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload.record.searchProviderType,operationPayload.record.resourceUri);watermarkTelemetryEvent.End()},function(){watermarkTelemetryEvent.End()})}else{KbCommonUtils.ActionOperationUtils.sendEmailContent(operationPayload,true,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload.record.searchProviderType,operationPayload.record.resourceUri);watermarkTelemetryEvent.End()}else{var emailCallback_2=operationPayload.actionOperationCallback(),linkActionCallback_2={successCallback:function(linkOperationPayload,response){KbCommonUtils.ActionOperationUtils.markArticleSentToCustomer(linkOperationPayload);emailCallback_2.successCallback(linkOperationPayload,response)},failureCallback:function(linkOperationPayload,error){error.isCanceled===true&&KbCommonUtils.ActionOperationUtils.markArticleSentToCustomer(linkOperationPayload);emailCallback_2.failureCallback(linkOperationPayload,error)}},linkOperationPayload={controlContext:operationPayload.controlContext,stateManager:operationPayload.stateManager,record:operationPayload.record,fetchApiWrapper:operationPayload.fetchApiWrapper,actionOperationCallback:function(){return linkActionCallback_2}};KbCommonUtils.ActionOperationFactory.Instance.Execute(KbCommonUtils.ArticleAction.LinkArticle,linkOperationPayload);KbCommonUtils.ActionOperationUtils.sendEmailContent(operationPayload,true,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload.record.searchProviderType,operationPayload.record.resourceUri);watermarkTelemetryEvent.End()}};return EmailContentActionOperation}();KbCommonUtils.EmailContentActionOperation=EmailContentActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var IncreaseViewActionOperation=function(){function IncreaseViewActionOperation(){}Object.defineProperty(IncreaseViewActionOperation.prototype,"Label",{"get":function(){throw"Not Implemented"},enumerable:true,configurable:true});Object.defineProperty(IncreaseViewActionOperation.prototype,"Tooltip",{"get":function(){throw"Not Implemented"},enumerable:true,configurable:true});Object.defineProperty(IncreaseViewActionOperation.prototype,"SymbolCode",{"get":function(){throw"Not Implemented"},enumerable:true,configurable:true});IncreaseViewActionOperation.prototype.ValidateOperation=function(validationPayload){return false};IncreaseViewActionOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.controlContext,watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.controlContext,KbCommonUtils.TelemetryConstants.WebresourceNameKbSearchActions,KbCommonUtils.TelemetryActionName.Increase_View_Count),entityReference={id:operationPayload.record.knowledgeArticleId,entityType:KbCommonUtils.Constants.KnowledgeArticleEntityType},viewDate=moment().format(KbCommonUtils.Constants.ViewDateFormat),count=1,location=1,url=KbCommonUtils.Constants.ODATA_PATH+KbCommonUtils.Constants.IncreaseViewEndpoint,knowledgearticleId=entityReference.id;url=MscrmCommon.ControlUtils.String.Format(url,knowledgearticleId,viewDate,location,count);operationPayload.fetchApiWrapper.Fetch(context,KbCommonUtils.GET_METHOD,url,"",KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload.record.searchProviderType,operationPayload.record.resourceUri,KbCommonUtils.Constants.CrossDynamicsOrgApiCall).then(function(response){operationPayload.actionOperationCallback().successCallback(operationPayload,response);watermarkTelemetryEvent.End()},function(error){operationPayload.actionOperationCallback().failureCallback(operationPayload,error);watermarkTelemetryEvent.EndAndLogError({errorMessage:error})})};return IncreaseViewActionOperation}();KbCommonUtils.IncreaseViewActionOperation=IncreaseViewActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var LinkActionOperation=function(){function LinkActionOperation(){}Object.defineProperty(LinkActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.AssociateArticleIconLabel"},enumerable:true,configurable:true});Object.defineProperty(LinkActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.AssociateArticleIconToolTip"},enumerable:true,configurable:true});Object.defineProperty(LinkActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?KbCommonUtils.IconSymbolCode.LinkArticleNew:KbCommonUtils.IconSymbolCode.LinkArticle},enumerable:true,configurable:true});LinkActionOperation.prototype.ValidateOperation=function(validationPayload){var stateManager=validationPayload.stateManager;if(KbCommonUtils.CommonUtils.IsEntityTypeConversationHostedInProductivityPane(validationPayload.controlContext))return false;if(validationPayload.controlContext.page.entityTypeName!==KbCommonUtils.Constants.Incident&&KbCommonUtils.CommonUtils.IsRecordFromFederatedSearch(validationPayload.record))return false;return KbCommonUtils.CommonUtils.IsHostedInEntityContext(validationPayload.controlContext)&&stateManager.kmPrivileges&&stateManager.kmPrivileges.CanAssociateAndDisassociate&&!validationPayload.record.isAssociated};LinkActionOperation.prototype.ExecuteOperation=function(operationPayload){var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.controlContext,KbCommonUtils.TelemetryConstants.WebresourceNameKbSearchActions,KbCommonUtils.TelemetryActionName.Link_KbArticle),promise=null;if(KbCommonUtils.SearchProviderType.InternalDynamicsOrg!=operationPayload.record.searchProviderType){if(!operationPayload.record.federatedArticleId){this.saveFederatedKnowledgeArticle(operationPayload);watermarkTelemetryEvent.End();return}if(!operationPayload.record.federatedArticleIncidentId){var data={"msdyn_federatedarticleid@odata.bind":"/msdyn_federatedarticles("+operationPayload.record.federatedArticleId+")","msdyn_incidentid@odata.bind":"/incidents("+operationPayload.controlContext.page.entityId+")",statuscode:1,statecode:0,msdyn_searchproviderarticleid:operationPayload.record.knowledgeArticleId};promise=operationPayload.controlContext.webAPI.createRecord(KbCommonUtils.Constants.FederatedArticleIncident,data)}else promise=operationPayload.controlContext.webAPI.updateRecord(KbCommonUtils.Constants.FederatedArticleIncident,operationPayload.record.federatedArticleIncidentId,{statecode:0})}else{var ODataEndPointUri=KbCommonUtils.Constants.ODATA_PATH+KbCommonUtils.Constants.AssociateEndpoint,associateDisassociateKARequest=new KbCommonUtils.AssociateDisassociateKnowledgeArticleRequest(operationPayload.controlContext.parameters.value.entityReference.Id.guid,-1,operationPayload.controlContext.page.entityTypeName===KbCommonUtils.Constants.Incident?KbCommonUtils.Constants.IncidentRelationshipName:operationPayload.stateManager.relations.SchemaName,operationPayload.record.knowledgeArticleId,operationPayload.controlContext.parameters.value.entityReference.LogicalName);promise=operationPayload.fetchApiWrapper.Fetch(operationPayload.controlContext,KbCommonUtils.POST_METHOD,ODataEndPointUri,JSON.stringify(associateDisassociateKARequest))}promise.then(function(response){operationPayload.actionOperationCallback().successCallback(operationPayload,response);watermarkTelemetryEvent.End()},function(error){operationPayload.actionOperationCallback().failureCallback(operationPayload,error);watermarkTelemetryEvent.EndAndLogError({errorMessage:error})})};LinkActionOperation.prototype.saveFederatedKnowledgeArticle=function(operationPayload){var _this=this,data={msdyn_title:operationPayload.record.title,msdyn_searchproviderarticleid:operationPayload.record.knowledgeArticleId,msdyn_url:operationPayload.record.articleUrl,"msdyn_searchproviderid@odata.bind":"/msdyn_kmfederatedsearchconfigs("+operationPayload.record.searchProviderId+")"};operationPayload.controlContext.webAPI.createRecord(KbCommonUtils.Constants.FederatedArticle,data).then(function(response){if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(response)){operationPayload.record.federatedArticleId=response.id;_this.ExecuteOperation(operationPayload)}},function(error){var errorMessage=error&&error.message||error&&error.error&&error.error.message||""})};return LinkActionOperation}();KbCommonUtils.LinkActionOperation=LinkActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var OpenResultActionOperation=function(){function OpenResultActionOperation(){}Object.defineProperty(OpenResultActionOperation.prototype,"Label",{"get":function(){return "KMControl.SearchKMArticles.OpenResult"},enumerable:true,configurable:true});Object.defineProperty(OpenResultActionOperation.prototype,"Tooltip",{"get":function(){return "KMControl.SearchKMArticles.OpenResult"},enumerable:true,configurable:true});Object.defineProperty(OpenResultActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.Default},enumerable:true,configurable:true});OpenResultActionOperation.prototype.ValidateOperation=function(validationPayload){return false};OpenResultActionOperation.prototype.ExecuteOperation=function(operationPayload){var stateManager=operationPayload.stateManager;stateManager.SetSelectedArticle(operationPayload.record,operationPayload.controlContext);stateManager.popupEnabled=operationPayload.controlContext.client.disableScroll;if(KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(operationPayload.controlContext))this.OpenArticleAppTabIfPossible(operationPayload.record,operationPayload.controlContext);else{stateManager.SetIsSearchMode(false,operationPayload.controlContext);this.RequestRender(operationPayload.controlContext)}};OpenResultActionOperation.prototype.OpenArticleAppTabIfPossible=function(record,context){if(KbCommonUtils.MultisessionUtils.CanCreateNewAppTab())KbCommonUtils.MultisessionUtils.OpenArticleAppTab(record,context);else KbCommonUtils.MultisessionUtils.OpenErrorDialog(context)};OpenResultActionOperation.prototype.RequestRender=function(context){context.utils.requestRender(function(){var backButton=document.getElementById(context.accessibility.getUniqueId("ContentPaneBackButtonContainer"));backButton&&backButton.focus()})};return OpenResultActionOperation}();KbCommonUtils.OpenResultActionOperation=OpenResultActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var PopoutActionOperation=function(){function PopoutActionOperation(){}Object.defineProperty(PopoutActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.PopoutArticleIconLabel"},enumerable:true,configurable:true});Object.defineProperty(PopoutActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.PopoutArticleIconTooltip"},enumerable:true,configurable:true});Object.defineProperty(PopoutActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?KbCommonUtils.IconSymbolCode.PopoutArticleNew:KbCommonUtils.IconSymbolCode.PopoutArticle},enumerable:true,configurable:true});PopoutActionOperation.prototype.ValidateOperation=function(validationPayload){return !KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(validationPayload.record)&&validationPayload.controlContext.client.getClient()!=="Mobile"&&!KbCommonUtils.CommonUtils.IsInArticlePageContext()&&!KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(validationPayload.controlContext)&&!KbCommonUtils.CommonUtils.IsHostedInMultisessionStandaloneMode(validationPayload.controlContext)&&!KbCommonUtils.CommonUtils.IsArticleOpenInMultisessionAppTab(validationPayload.controlContext)&&!window.IsUSD};PopoutActionOperation.prototype.ExecuteOperation=function(operationPayload){var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.controlContext,KbCommonUtils.TelemetryConstants.WebresourceNameKbSearchActions,KbCommonUtils.TelemetryActionName.Popout_KbArticle),knowledgeArticleId=operationPayload.record.knowledgeArticleId,appid=operationPayload.controlContext.page.appId,url="",extraqsUrl="";if(operationPayload.stateManager.isKnowledgeSearchInsightsEnabled){var knowledgeOperationId=operationPayload.record.knowledgeOperationId,articleRank=operationPayload.record.articleRank;if(knowledgeOperationId&&articleRank){var extraqs=KbCommonUtils.Constants.KnowledgeOperationIdParameter+"="+knowledgeOperationId+"&"+KbCommonUtils.Constants.ArticleRankParameter+"="+articleRank;extraqsUrl="&"+KbCommonUtils.Constants.ExtraQueryString+"="+encodeURIComponent(extraqs)}}if(KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(operationPayload.record))url=operationPayload.record.articleUrl;else url=operationPayload.record.resourceUri+KbCommonUtils.Constants.PopOutArticleUri+knowledgeArticleId+extraqsUrl;window.open(url,"KnowledgeArticle"+knowledgeArticleId);watermarkTelemetryEvent.End()};return PopoutActionOperation}();KbCommonUtils.PopoutActionOperation=PopoutActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SelectContentDialogOperation=function(){function SelectContentDialogOperation(){}Object.defineProperty(SelectContentDialogOperation.prototype,"Label",{"get":function(){return KbCommonUtils.Constants.InsertContentDialogButtonLabel},enumerable:true,configurable:true});Object.defineProperty(SelectContentDialogOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.Constants.InsertContentDialogButtonTooltip},enumerable:true,configurable:true});Object.defineProperty(SelectContentDialogOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SelectContent},enumerable:true,configurable:true});SelectContentDialogOperation.prototype.ValidateOperation=function(validationPayload){var context=validationPayload.controlContext;if(!KbCommonUtils.CommonUtils.IsLoadedInDialog(context))return false;var dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;return KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(validationPayload.controlContext)&&KbCommonUtils.FCBUtil.IsFeatureEnabled(validationPayload.controlContext,KbCommonUtils.FCBUtil.KMInsertArticle)&&!window.IsUSD&&!KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(validationPayload.record)&&!(dictionary[validationPayload.record.knowledgeArticleId]&&dictionary[validationPayload.record.knowledgeArticleId].content)};SelectContentDialogOperation.prototype.ExecuteOperation=function(operationPayload){KbCommonUtils.ActionOperationUtils.getContentToMail(operationPayload,true,KbCommonUtils.SearchProviderType.CrossDynamicsOrg==operationPayload.record.searchProviderType,operationPayload.record.resourceUri).then(function(contentToMail){var context=operationPayload.controlContext,dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;if(dictionary[operationPayload.record.knowledgeArticleId])dictionary[operationPayload.record.knowledgeArticleId].content=true;else{if(context.parameters.WrapperContext.DialogContext.isMultiSelect)if(Object.keys(dictionary).length>=3){window.Xrm.UI.addGlobalNotification(1,3,"Allowed limit of 3 articles already selected",null,null,null);return}dictionary[operationPayload.record.knowledgeArticleId]={content:true,url:false,record:operationPayload.record,contentToMail:contentToMail}}if(context.parameters.WrapperContext.DialogContext.OutputParameter.raw!=null){var control=window.Xrm.Page.getControl(context.parameters.WrapperContext.DialogContext.OutputParameter.raw);if(control){control.getAttribute().setValue(JSON.stringify(dictionary));control.getAttribute().fireOnChange()}}context.parameters.WrapperContext.DialogContext.isMultiSelect&&context.utils.requestRender()})};return SelectContentDialogOperation}();KbCommonUtils.SelectContentDialogOperation=SelectContentDialogOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SelectUrlDialogOperation=function(){function SelectUrlDialogOperation(){}Object.defineProperty(SelectUrlDialogOperation.prototype,"Label",{"get":function(){return KbCommonUtils.Constants.InsertURLDialogButtonLabel},enumerable:true,configurable:true});Object.defineProperty(SelectUrlDialogOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.Constants.InsertURLDialogButtonTooltip},enumerable:true,configurable:true});Object.defineProperty(SelectUrlDialogOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SelectUrl},enumerable:true,configurable:true});SelectUrlDialogOperation.prototype.ValidateOperation=function(validationPayload){var context=validationPayload.controlContext;if(!KbCommonUtils.CommonUtils.IsLoadedInDialog(context))return false;var dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords,stateManager=validationPayload.stateManager;return stateManager.kmPrivileges&&stateManager.kmPrivileges.CanCopyLink&&(stateManager.useExternalKMPortal||KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(validationPayload.record))&&KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(validationPayload.controlContext)&&KbCommonUtils.FCBUtil.IsFeatureEnabled(validationPayload.controlContext,KbCommonUtils.FCBUtil.KMInsertArticle)&&!window.IsUSD&&!(dictionary[validationPayload.record.knowledgeArticleId]&&dictionary[validationPayload.record.knowledgeArticleId].url)};SelectUrlDialogOperation.prototype.ExecuteOperation=function(operationPayload){var publicPortalUrl=KbCommonUtils.ActionOperationUtils.GetKMExternalPortalUrl(operationPayload),context=operationPayload.controlContext,dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;if(dictionary[operationPayload.record.knowledgeArticleId]){dictionary[operationPayload.record.knowledgeArticleId].url=!dictionary[operationPayload.record.knowledgeArticleId].url;dictionary[operationPayload.record.knowledgeArticleId].publicUrl=publicPortalUrl;if(!dictionary[operationPayload.record.knowledgeArticleId].content&&!dictionary[operationPayload.record.knowledgeArticleId].url)delete dictionary[operationPayload.record.knowledgeArticleId]}else{if(context.parameters.WrapperContext.DialogContext.isMultiSelect)if(Object.keys(dictionary).length>=3){window.Xrm.UI.addGlobalNotification(1,3,"Allowed limit of 3 articles already selected",null,null,null);return}dictionary[operationPayload.record.knowledgeArticleId]={content:false,url:true,record:operationPayload.record,publicUrl:publicPortalUrl}}if(context.parameters.WrapperContext.DialogContext!=null&&context.parameters.WrapperContext.DialogContext.OutputParameter.raw!=null){var control=window.Xrm.Page.getControl(context.parameters.WrapperContext.DialogContext.OutputParameter.raw);if(control){control.getAttribute().setValue(JSON.stringify(dictionary));control.getAttribute().fireOnChange()}}context.parameters.WrapperContext.DialogContext.isMultiSelect&&context.utils.requestRender()};return SelectUrlDialogOperation}();KbCommonUtils.SelectUrlDialogOperation=SelectUrlDialogOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var UnselectContentDialogOperation=function(){function UnselectContentDialogOperation(){}Object.defineProperty(UnselectContentDialogOperation.prototype,"Label",{"get":function(){return "Unselect Content"},enumerable:true,configurable:true});Object.defineProperty(UnselectContentDialogOperation.prototype,"Tooltip",{"get":function(){return "Unselect Content"},enumerable:true,configurable:true});Object.defineProperty(UnselectContentDialogOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.UnselectContent},enumerable:true,configurable:true});UnselectContentDialogOperation.prototype.ValidateOperation=function(validationPayload){var context=validationPayload.controlContext;if(!KbCommonUtils.CommonUtils.IsLoadedInDialog(context))return false;var dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;return KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(validationPayload.controlContext)&&KbCommonUtils.FCBUtil.IsFeatureEnabled(validationPayload.controlContext,KbCommonUtils.FCBUtil.KMInsertArticle)&&!window.IsUSD&&context.parameters.WrapperContext.DialogContext.isMultiSelect&&dictionary[validationPayload.record.knowledgeArticleId]&&dictionary[validationPayload.record.knowledgeArticleId].content};UnselectContentDialogOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.controlContext,dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;dictionary[operationPayload.record.knowledgeArticleId].content=false;if(!dictionary[operationPayload.record.knowledgeArticleId].url)delete dictionary[operationPayload.record.knowledgeArticleId];if(context.parameters.WrapperContext.DialogContext!=null&&context.parameters.WrapperContext.DialogContext.OutputParameter.raw!=null){var control=window.Xrm.Page.getControl(context.parameters.WrapperContext.DialogContext.OutputParameter.raw);if(control){control.getAttribute().setValue(JSON.stringify(dictionary));control.getAttribute().fireOnChange()}}context.utils.requestRender()};return UnselectContentDialogOperation}();KbCommonUtils.UnselectContentDialogOperation=UnselectContentDialogOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var UnselectUrlDialogOperation=function(){function UnselectUrlDialogOperation(){}Object.defineProperty(UnselectUrlDialogOperation.prototype,"Label",{"get":function(){return "Unselect Url"},enumerable:true,configurable:true});Object.defineProperty(UnselectUrlDialogOperation.prototype,"Tooltip",{"get":function(){return "Unselect Url"},enumerable:true,configurable:true});Object.defineProperty(UnselectUrlDialogOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.UnselectUrl},enumerable:true,configurable:true});UnselectUrlDialogOperation.prototype.ValidateOperation=function(validationPayload){var context=validationPayload.controlContext;if(!KbCommonUtils.CommonUtils.IsLoadedInDialog(context))return false;var dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords,stateManager=validationPayload.stateManager;return stateManager.kmPrivileges&&stateManager.kmPrivileges.CanCopyLink&&stateManager.useExternalKMPortal&&KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(validationPayload.controlContext)&&KbCommonUtils.FCBUtil.IsFeatureEnabled(validationPayload.controlContext,KbCommonUtils.FCBUtil.KMInsertArticle)&&!window.IsUSD&&context.parameters.WrapperContext.DialogContext.isMultiSelect&&dictionary[validationPayload.record.knowledgeArticleId]&&dictionary[validationPayload.record.knowledgeArticleId].url};UnselectUrlDialogOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.controlContext,dictionary=context.parameters.WrapperContext.DialogContext.SelectedRecords;dictionary[operationPayload.record.knowledgeArticleId].url=false;if(!dictionary[operationPayload.record.knowledgeArticleId].content)delete dictionary[operationPayload.record.knowledgeArticleId];if(context.parameters.WrapperContext.DialogContext!=null&&context.parameters.WrapperContext.DialogContext.OutputParameter.raw!=null){var control=window.Xrm.Page.getControl(context.parameters.WrapperContext.DialogContext.OutputParameter.raw);if(control){control.getAttribute().setValue(JSON.stringify(dictionary));control.getAttribute().fireOnChange()}}context.utils.requestRender()};return UnselectUrlDialogOperation}();KbCommonUtils.UnselectUrlDialogOperation=UnselectUrlDialogOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SelectResultActionOperation=function(){function SelectResultActionOperation(){}Object.defineProperty(SelectResultActionOperation.prototype,"Label",{"get":function(){return "KMControl.SearchKMArticles.SelectedResult"},enumerable:true,configurable:true});Object.defineProperty(SelectResultActionOperation.prototype,"Tooltip",{"get":function(){return "KMControl.SearchKMArticles.SelectedResult"},enumerable:true,configurable:true});Object.defineProperty(SelectResultActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.Default},enumerable:true,configurable:true});SelectResultActionOperation.prototype.ValidateOperation=function(validationPayload){return false};SelectResultActionOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.controlContext;context.parameters.value.executeUpdateSelectedResult(context.parameters.value.contextToken,operationPayload.record.knowledgeArticleId)};return SelectResultActionOperation}();KbCommonUtils.SelectResultActionOperation=SelectResultActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var UnlinkActionOperation=function(){function UnlinkActionOperation(){}Object.defineProperty(UnlinkActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.DisassociateArticleIconLabel"},enumerable:true,configurable:true});Object.defineProperty(UnlinkActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.DisassociateArticleIconToolTip"},enumerable:true,configurable:true});Object.defineProperty(UnlinkActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?KbCommonUtils.IconSymbolCode.UnlinkArticleNew:KbCommonUtils.IconSymbolCode.UnlinkArticle},enumerable:true,configurable:true});UnlinkActionOperation.prototype.ValidateOperation=function(validationPayload){var stateManager=validationPayload.stateManager;if(KbCommonUtils.CommonUtils.IsEntityTypeConversationHostedInProductivityPane(validationPayload.controlContext))return false;if(validationPayload.controlContext.page.entityTypeName!==KbCommonUtils.Constants.Incident&&KbCommonUtils.CommonUtils.IsRecordFromFederatedSearch(validationPayload.record))return false;return KbCommonUtils.CommonUtils.IsHostedInEntityContext(validationPayload.controlContext)&&stateManager.kmPrivileges&&stateManager.kmPrivileges.CanAssociateAndDisassociate&&validationPayload.record.isAssociated};UnlinkActionOperation.prototype.ExecuteOperation=function(operationPayload){var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.controlContext,KbCommonUtils.TelemetryConstants.WebresourceNameKbSearchActions,KbCommonUtils.TelemetryActionName.Unlink_KbArticle),promise=null;if(KbCommonUtils.SearchProviderType.InternalDynamicsOrg!=operationPayload.record.searchProviderType)promise=operationPayload.controlContext.webAPI.updateRecord(KbCommonUtils.Constants.FederatedArticleIncident,operationPayload.record.federatedArticleIncidentId,{statecode:1});else{var ODataEndPointUri=KbCommonUtils.Constants.ODATA_PATH+KbCommonUtils.Constants.DisassociateEndpoint,associateDisassociateKARequest=new KbCommonUtils.AssociateDisassociateKnowledgeArticleRequest(operationPayload.controlContext.parameters.value.entityReference.Id.guid,-1,operationPayload.controlContext.page.entityTypeName===KbCommonUtils.Constants.Incident?KbCommonUtils.Constants.IncidentRelationshipName:operationPayload.stateManager.relations.SchemaName,operationPayload.record.knowledgeArticleId,operationPayload.controlContext.parameters.value.entityReference.LogicalName);promise=operationPayload.fetchApiWrapper.Fetch(operationPayload.controlContext,KbCommonUtils.POST_METHOD,ODataEndPointUri,JSON.stringify(associateDisassociateKARequest))}promise.then(function(response){operationPayload.actionOperationCallback().successCallback(operationPayload,response);watermarkTelemetryEvent.End()},function(error){operationPayload.actionOperationCallback().failureCallback(operationPayload,error);watermarkTelemetryEvent.EndAndLogError({errorMessage:error})})};return UnlinkActionOperation}();KbCommonUtils.UnlinkActionOperation=UnlinkActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var FetchApiHelper=function(){function FetchApiHelper(){}FetchApiHelper.ProcessInnerException=function(error){var innerExceptionStringParts=[];error.type&&innerExceptionStringParts.push(error.type);error.message&&innerExceptionStringParts.push(error.message);error.stacktrace&&innerExceptionStringParts.push(error.stacktrace);return innerExceptionStringParts.join("\r\n")};FetchApiHelper.ShowErrorMessage=function(error){if(error){if(error.error)error=error.error;var errorMessage=error.message,errorCode=error.code,details="";if(error.innererror)details=FetchApiHelper.ProcessInnerException(error.innererror);if(errorMessage&&errorCode){var errorDialogOptions={errorCode:parseInt(errorCode),message:errorMessage,details:details};window.Xrm.Navigation.openErrorDialog(errorDialogOptions)}}};FetchApiHelper.Fetch=function(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders){var additionalTelemetryEventParameters=[],queryStr=odataUri,queryStrIndex=queryStr.indexOf("?");if(queryStrIndex!==-1)queryStr=queryStr.substr(0,queryStrIndex);additionalTelemetryEventParameters.push({name:"queryUri",value:queryStr});resourceUri&&additionalTelemetryEventParameters.push({name:"resourceUrl",value:resourceUri});kmAppMethod&&additionalTelemetryEventParameters.push({name:"kmAppMethod",value:kmAppMethod});var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(context,"KnowledgeManagement","KbCommonUtils.FetchApiWrapper.Fetch",additionalTelemetryEventParameters);if(loadUsingProxy){var deferred_1=$.Deferred(),jsonData={method:kmAppMethod,data:{resourceUri:resourceUri,methodType:method,apiUrl:resourceUri+odataUri,clientUri:context.page.getClientUrl(),additionalHeaders:additionalHeaders||{}}};if(data&&data!="")jsonData.data.postdata=data;MscrmControls.KbCommonUtils.WindowPostMessageProxy.Instance().postMessage(jsonData).then(function(response){watermarkTelemetryEvent.End();return deferred_1.resolve(response)},function(error){watermarkTelemetryEvent.End();context.reporting.reportFailure("KbCommonUtils.FetchApiWrapper.Fetch",error);return deferred_1.reject(error)});return deferred_1.promise()}else if(!context.client.userAgent.isIos&&typeof window.fetch==="function"){var input=null,init=null;if(method==KbCommonUtils.GET_METHOD)input=new Request(context.page.getClientUrl()+odataUri,{method:method,credentials:"same-origin"});else{input=context.page.getClientUrl()+odataUri;init={method:method,credentials:"same-origin",headers:{"Content-Type":"application/json",prefer:'odata.include-annotations="*"',"odata-maxversion":"4.0","odata-version":"4.0"},body:data}}return fetch(input,init).then(function(res){watermarkTelemetryEvent.End();if(res.ok){if(res.status===204)return "";return res.json()}else{var errorReader_1=res.body.getReader(),errorString_1="",errorDeferred_1=$.Deferred();errorReader_1.read().then(function processText(streamResponse){if(streamResponse.done){var errorObject=JSON.parse(errorString_1);context.reporting.reportFailure("KbCommonUtils.FetchApiWrapper.Fetch",errorObject);FetchApiHelper.ShowErrorMessage(errorObject);errorDeferred_1.reject(errorObject);return}errorString_1+=String.fromCharCode.apply(null,streamResponse.value);return errorReader_1.read().then(processText)});return errorDeferred_1.promise()}})}else{var deferred_2=$.Deferred(),xhr_1=new XMLHttpRequest;xhr_1.onreadystatechange=function(){if(xhr_1.readyState!==4)return;watermarkTelemetryEvent.End();if(xhr_1.status===204)deferred_2.resolve("");else if(xhr_1.status>=200&&xhr_1.status<300&&xhr_1.responseText&&xhr_1.responseText.length>0)deferred_2.resolve(JSON.parse(xhr_1.responseText));else{var errorObject=JSON.parse(xhr_1.responseText);context.reporting.reportFailure("KbCommonUtils.FetchApiWrapper.Fetch",errorObject);FetchApiHelper.ShowErrorMessage(errorObject);deferred_2.reject(errorObject);return}};xhr_1.open(method,context.page.getClientUrl()+odataUri);if(method==KbCommonUtils.GET_METHOD)xhr_1.send();else{xhr_1.setRequestHeader("Content-Type","application/json; charset=UTF-8");xhr_1.setRequestHeader("accept","application/json");xhr_1.setRequestHeader("prefer",'odata.include-annotations="*"');xhr_1.setRequestHeader("odata-maxversion","4.0");xhr_1.setRequestHeader("odata-version","4.0");xhr_1.send(data)}return deferred_2.promise()}};return FetchApiHelper}();KbCommonUtils.FetchApiHelper=FetchApiHelper})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";KbCommonUtils.GET_METHOD="GET";KbCommonUtils.POST_METHOD="POST";var StreamResponseStructure=function(){function StreamResponseStructure(){}return StreamResponseStructure}();KbCommonUtils.StreamResponseStructure=StreamResponseStructure;var CancelableFetchApiWrapper=function(){function CancelableFetchApiWrapper(){this.activePromises={}}CancelableFetchApiWrapper.prototype.GetCancelablePromise=function(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders){var isCanceled=false,deffered=$.Deferred(),wrappedPromise=KbCommonUtils.FetchApiHelper.Fetch(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders);wrappedPromise.then(function(response){if(isCanceled)deffered.reject({isCanceled:true,error:response});else deffered.resolve(response)},function(error){if(isCanceled)deffered.reject({isCanceled:true,error:error});else deffered.reject(error)});var promise=deffered.promise();return {promise:promise,cancel:function(){isCanceled=true}}};CancelableFetchApiWrapper.prototype.hasKey=function(key){return Object.keys(this.activePromises).indexOf(key)!==-1};CancelableFetchApiWrapper.prototype.makeid=function(length){for(var result,count=0;count<10;count++){result="";for(var characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",charactersLength=characters.length,i=0;i<length;i++)result+=characters.charAt(Math.floor(Math.random()*charactersLength));if(!this.hasKey(result))return result}throw"Unique key generation for maintaing active promises failed."};CancelableFetchApiWrapper.prototype.AddCancelablePromise=function(cancelablePromise){var _this=this,key=this.makeid(10);this.activePromises[key]=cancelablePromise;cancelablePromise.promise.then(function(){return delete _this.activePromises[key]},function(){return delete _this.activePromises[key]});return cancelablePromise};CancelableFetchApiWrapper.prototype.Fetch=function(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders){var cancelablePromise=this.GetCancelablePromise(context,method,odataUri,data,loadUsingProxy,resourceUri,kmAppMethod,additionalHeaders);cancelablePromise=this.AddCancelablePromise(cancelablePromise);return cancelablePromise.promise};CancelableFetchApiWrapper.prototype.Destroy=function(){for(var _i=0,_a=Object.keys(this.activePromises);_i<_a.length;_i++){var key=_a[_i],cancelablePromise=this.activePromises[key];cancelablePromise.cancel();delete this.activePromises[key]}};return CancelableFetchApiWrapper}();KbCommonUtils.CancelableFetchApiWrapper=CancelableFetchApiWrapper})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var Constants=function(){function Constants(){}Constants.ODATA_PATH="/api/data/v9.0";Constants.URL_KA_TITLE_CONTENT="/knowledgearticles?$select=content&$filter=knowledgearticleid eq {0}";Constants.AssociateEndpoint="/AssociateKnowledgeArticle";Constants.DisassociateEndpoint="/DisassociateKnowledgeArticle";Constants.IncreaseViewEndpoint="/IncrementKnowledgeArticleViewCount(Source=@Source,ViewDate=@ViewDate,Location=@Location,Count=@Count)?@Source={'@odata.id':'knowledgearticles({0})'}&@ViewDate={1}&@Location={2}&@Count={3}";Constants.RetrieveKMControlSettingsEndpoint="/RetrieveKMControlInitializationSettings";Constants.ViewDateFormat="YYYY-MM-DD";Constants.KnowledgeArticleEntityType="knowledgearticle";Constants.IncidentRelationshipName="knowledgearticlescategories";Constants.NumberOfViewsIconToolTip="SearchWidget.SearchKMArticles.NumberOfViewsToolTip";Constants.ModifiedOnLabelToolTip="SearchWidget.SearchKMArticles.LastModifiedDateLabelToolTip";Constants.RatingIconToolTip="SearchWidget.SearchKMArticles.RatingIconToolTip";Constants.ModifiedOnLabel="SearchWidget.SearchKMArticles.LastModifiedDateLabel";Constants.CopyLinkButtonLabel="SearchWidget.SearchKMArticles.CopyLinkButtonLabel";Constants.CopyLinkButtonTooltip="SearchWidget.SearchKMArticles.CopyLinkButtonTooltip";Constants.PrintArticleButtonLabel="SearchWidget.SearchKMArticles.PrintArticleButtonLabel";Constants.PrintArticleButtonTooltip="SearchWidget.SearchKMArticles.PrintArticleButtonTooltip";Constants.InsertContentDialogButtonTooltip="SearchWidget.SearchKMArticles.InsertContentDialogButtonTooltip";Constants.InsertContentDialogButtonLabel="SearchWidget.SearchKMArticles.InsertContentDialogButtonLabel";Constants.InsertURLDialogButtonTooltip="SearchWidget.SearchKMArticles.InsertURLDialogButtonTooltip";Constants.InsertURLDialogButtonLabel="SearchWidget.SearchKMArticles.InsertURLDialogButtonLabel";Constants.CopyLinkSuccessMsg="SearchWidget.SearchKMArticles.CopyLinkSuccessMsg";Constants.CopyLinkFailedMsg="SearchWidget.SearchKMArticles.CopyLinkFailedMsg";Constants.ConfirmDialogTitleForImageLoad="SearchWidget.SearchKMArticles.ConfirmDialogTitleForImageLoad";Constants.ConfirmDialogTextForImageLoadFailure="SearchWidget.SearchKMArticles.ConfirmDialogTextForImageLoadFailure";Constants.Incident="incident";Constants.ConversationEntityName="msdyn_ocliveworkitem";Constants.StatusCodeAttribute="statuscode";Constants.StatusCodeValue="statuscode@OData.Community.Display.V1.FormattedValue";Constants.ShowArticle="article";Constants.KnowledgeArticleIncident="knowledgearticleincident";Constants.KnowledgeSearchEntityName="msdyn_knowledgesearchinsight";Constants.KnowledgeInteractionEntityName="msdyn_knowledgeinteractioninsight";Constants.KMSuggestionForCase="kmsuggestionforcase";Constants.Email="email";Constants.RegardingObjectId="regardingobjectid";Constants.AllDraftArticlesResourceName="SearchWidget.Filters.AllDraftArticles";Constants.AllPublishedArticlesResourceName="SearchWidget.Filters.AllPublishedArticles";Constants.AllApprovedArticlesResourceName="SearchWidget.Filters.AllApprovedArticles";Constants.ConfirmDialogTitle="SearchWidget.SearchKMArticles.ConfirmDialogTitle";Constants.ConfirmDialogTextResourceName="SearchWidget.SearchKMArticles.ConfirmDialogText";Constants.RecordDoesNotExistErrorMessageResourceName="SearchWidget.SearchKMArticles.RecordDoesNotExistErrorMessageResourceName";Constants.CTIFailedMessageForConversationStateResourceName="KMControl.SearchKMArticles.CTIFailedMessageForConversationStateMessage";Constants.CTIFailedMessageForConversationStateTitleResourceName="KMControl.SearchKMArticles.CTIFailedMessageForConversationStateTitle";Constants.WebresourceNameArticleActions="ArticleActions";Constants.EnterKeyValue="Enter";Constants.ServerSearchFailure="SearchWidget.SearchKMArticles.ServerFailure";Constants.KBArticleControlID="kbarticle";Constants.GLOBAL_NOTIFICATION_TYPE_TOAST=1;Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS=1;Constants.UCKMControlRelevanceSearch="UCKMControlRelevanceSearch";Constants.COLOR_ACTION_ICON="#3B79B7";Constants.COLOR_ACTION_TITLE="#323130";Constants.BGCOLOR_ACTION="#F3F2F1";Constants.COLOR_HOVER_ACTION="#2E5FA4";Constants.COLOR_SEARCH_RESULT_LABEL="#323130";Constants.COLOR_SEARCH_RESULT_LABEL_CONTAINER="#FFF";Constants.BGCOLOR_SEARCH_RESULT_LABEL_CONTAINER="#CCDEFF";Constants.MiddleDotUnicode="\u00b7";Constants.Rating="Rating";Constants.NumberOfViews="NumberOfViews";Constants.KBArticleImageTagRegex=/<img\s+[^>]*msdyn_knowledgearticleimages[^>]*>/gm;Constants.KBArticleImageTagSrcRegex=/src\s*=\s*"([^"]+)"/;Constants.KBArticleImageTagmsdyntypeRegex=/data-msdyntype\s*=\s*"([^"]+)"/;Constants.ExtraQueryString="extraqs";Constants.KnowledgeOperationIdParameter="knowledgeOperationId";Constants.ArticleRankParameter="articlerank";Constants.UnknownApp="unknownapp";Constants.DefaultSearchprovidername="CurrentOrg";Constants.AccessibilityLabelStyle={border:"0",clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:"0",position:"absolute",width:"1px"};Constants.ArticleState={Draft:"0",Approved:"1",Published:"3"};Constants.PopOutArticleUri="/main.aspx?pagetype=kbarticle&navbar=off&forceUCI=1&articleId=";Constants.KmSearchServiceAppIFrameId="KbSearchControl_KmSearchServiceApp";Constants.KmSearchServiceAppIFrameTitle="KbSearchControl KmSearchServiceApp Frame";Constants.CrossDynamicsOrgApiCall="DynamicsOdataApi";Constants.MicrosoftSearchApiCall="ExternalRESTOdataApi";Constants.MicrosoftSearchSharePointEntityType="driveItem";Constants.MicrosoftSearchConnectorEntityType="externalItem";Constants.FederatedSearchConfig="msdyn_kmfederatedsearchconfigs";Constants.FederatedArticle="msdyn_federatedarticle";Constants.FederatedArticleIncident="msdyn_federatedarticleincident";Constants.FederatedArticleIncidents="msdyn_federatedarticleincidents";Constants.RetrieveSearchProviders="msdyn_RetrieveSearchProviders";Constants.FederatedSearchConfigId="Kmfederatedsearchconfigid";Constants.FederatedSearchProviderName="Msdyn_name";Constants.FederatedSearchIsDefault="Isdefault";Constants.FederatedSearchProviderType="Searchtype";Constants.FederatedSearchOrganizationUrl="Organization";Constants.FederatedSearchConnectionId="Connectionid";Constants.FederatedSearchSharepointUrl="Sharepointurl";Constants.FederatedArticleId="msdyn_federatedarticleid";Constants.FederatedArticleIdValue="_msdyn_federatedarticleid_value";Constants.FederatedArticleIncidentId="msdyn_federatedarticleincidentid";Constants.FederatedSearchProviderArticleId="msdyn_searchproviderarticleid";return Constants}();KbCommonUtils.Constants=Constants})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KmAppServiceHelper=function(){function KmAppServiceHelper(){}KmAppServiceHelper.loadKmServiceAppIframe=function(context,methodName){var deferred=$.Deferred(),kmSearchServiceAppIframeElement,watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(context,methodName,methodName+".loadKmServiceAppIframe");kmSearchServiceAppIframeElement=document.getElementById(KbCommonUtils.Constants.KmSearchServiceAppIFrameId);if(kmSearchServiceAppIframeElement==null){var kmSearchServiceIframeNewElement=document.createElement("iframe");kmSearchServiceIframeNewElement.style.height="0";kmSearchServiceIframeNewElement.style.width="0";kmSearchServiceIframeNewElement.name=KbCommonUtils.Constants.KmSearchServiceAppIFrameId;kmSearchServiceIframeNewElement.id=KbCommonUtils.Constants.KmSearchServiceAppIFrameId;kmSearchServiceIframeNewElement.src=KbCommonUtils.OrganizationSettings.FirstPartyEndpoint;kmSearchServiceIframeNewElement.title=KbCommonUtils.Constants.KmSearchServiceAppIFrameTitle;kmSearchServiceIframeNewElement.onload=function(){KbCommonUtils.WindowPostMessageProxy.Instance(kmSearchServiceIframeNewElement).register();watermarkTelemetryEvent.End();deferred.resolve()};kmSearchServiceIframeNewElement.onerror=function(error){watermarkTelemetryEvent.EndAndLogError({controlType:KbCommonUtils.TelemetryControlType.KbEnvironmentSelector,errorMessage:"KmAppServiceHelper.loadKmServiceAppIframe - KmApp Frame Load"+error});kmSearchServiceIframeNewElement.parentNode.removeChild(kmSearchServiceIframeNewElement);deferred.resolve()};document.body.appendChild(kmSearchServiceIframeNewElement)}else{MscrmControls.KbCommonUtils.WindowPostMessageProxy.Instance(kmSearchServiceAppIframeElement).register();watermarkTelemetryEvent.End();deferred.resolve()}return deferred.promise()};return KmAppServiceHelper}();KbCommonUtils.KmAppServiceHelper=KmAppServiceHelper})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var FetchWrapperFactory=function(){function FetchWrapperFactory(){}FetchWrapperFactory.prototype.GetWrapper=function(){if(this.wrapper===undefined)this.wrapper=new KbCommonUtils.CancelableFetchApiWrapper;return this.wrapper};return FetchWrapperFactory}();KbCommonUtils.FetchWrapperFactory=FetchWrapperFactory})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var WindowPostMessageProxy=function(){function WindowPostMessageProxy(){this.pendingRequestPromises={};this.pendingRequestTimers={};this.counter=0}WindowPostMessageProxy.defaultAddTrackingProperties=function(message,trackingProperties){message[WindowPostMessageProxy.messagePropertyName]=trackingProperties;return message};WindowPostMessageProxy.defaultGetTrackingProperties=function(message){return message[WindowPostMessageProxy.messagePropertyName]};WindowPostMessageProxy.defaultIsErrorMessage=function(message){return !!message.error||!!message.data.error};WindowPostMessageProxy.createGUID=function(){return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};WindowPostMessageProxy.prototype.initialize=function(){var _this_1=this;this.addTrackingProperties=WindowPostMessageProxy.defaultAddTrackingProperties;this.getTrackingProperties=WindowPostMessageProxy.defaultGetTrackingProperties;this.isErrorMessage=WindowPostMessageProxy.defaultIsErrorMessage;this.receiveWindow=window;this.name=WindowPostMessageProxy.createGUID();this.windowMessageHandler=function(event){return _this_1.onMessageReceived(event)}};WindowPostMessageProxy.Instance=function(targetWindow){if(!WindowPostMessageProxy._instance&&targetWindow){WindowPostMessageProxy._instance=new WindowPostMessageProxy;WindowPostMessageProxy._instance.initialize();WindowPostMessageProxy._instance.targetWindow=targetWindow}return WindowPostMessageProxy._instance};WindowPostMessageProxy.prototype.register=function(){0==this.counter++&&this.receiveWindow.addEventListener("message",this.windowMessageHandler)};WindowPostMessageProxy.prototype.deregister=function(){0==--this.counter&&this.receiveWindow.removeEventListener("message",this.windowMessageHandler)};WindowPostMessageProxy.prototype.postMessage=function(message){var trackingProperties={id:WindowPostMessageProxy.createGUID()};this.addTrackingProperties(message,trackingProperties);this.targetWindow.contentWindow.postMessage(message,this.targetWindow.src);var deferred=$.Deferred();this.pendingRequestPromises[trackingProperties.id]=deferred;var _this=this;this.pendingRequestTimers[trackingProperties.id]=setTimeout(function(){_this.pendingRequestTimers[trackingProperties.id]&&clearTimeout(_this.pendingRequestTimers[trackingProperties.id]);if(_this.pendingRequestPromises[trackingProperties.id]){delete _this.pendingRequestPromises[trackingProperties.id];deferred.reject({message:"Request Timed out."})}},3e4);return deferred.promise()};WindowPostMessageProxy.prototype.onMessageReceived=function(event){if(event.origin!==KbCommonUtils.OrganizationSettings.FirstPartyEndpoint)return;var message=event.data;if(typeof message!=="object")return;var trackingProperties;try{trackingProperties=this.getTrackingProperties(message)}catch(e){}var deferred;if(trackingProperties)deferred=this.pendingRequestPromises[trackingProperties.id];if(deferred){delete this.pendingRequestPromises[trackingProperties.id];this.pendingRequestTimers[trackingProperties.id]&&clearTimeout(this.pendingRequestTimers[trackingProperties.id]);var isErrorMessage=true;try{isErrorMessage=this.isErrorMessage(message)}catch(e){console.warn("Proxy("+this.name+") Error occurred when trying to determine if message is consider an error response. Message: ",JSON.stringify(message,null,""),"Error: ",e)}if(isErrorMessage)deferred.reject(message.error||message.data.error);else deferred.resolve(message.data)}};WindowPostMessageProxy.messagePropertyName="windowPostMessageProxy";return WindowPostMessageProxy}();KbCommonUtils.WindowPostMessageProxy=WindowPostMessageProxy})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var ArticleAction;(function(ArticleAction){ArticleAction[ArticleAction["LinkArticle"]=0]="LinkArticle";ArticleAction[ArticleAction["UnlinkArticle"]=1]="UnlinkArticle";ArticleAction[ArticleAction["CopyLink"]=2]="CopyLink";ArticleAction[ArticleAction["EmailArticle"]=3]="EmailArticle";ArticleAction[ArticleAction["PopoutArticle"]=4]="PopoutArticle";ArticleAction[ArticleAction["EmailArticleContent"]=5]="EmailArticleContent";ArticleAction[ArticleAction["OpenResult"]=6]="OpenResult";ArticleAction[ArticleAction["SelectedResult"]=7]="SelectedResult";ArticleAction[ArticleAction["SendToCTI"]=8]="SendToCTI";ArticleAction[ArticleAction["PrintArticle"]=9]="PrintArticle";ArticleAction[ArticleAction["SelectContent"]=10]="SelectContent";ArticleAction[ArticleAction["UnselectContent"]=11]="UnselectContent";ArticleAction[ArticleAction["SelectUrl"]=12]="SelectUrl";ArticleAction[ArticleAction["UnselectUrl"]=13]="UnselectUrl";ArticleAction[ArticleAction["IncreaseView"]=14]="IncreaseView"})(ArticleAction=KbCommonUtils.ArticleAction||(KbCommonUtils.ArticleAction={}));var IconSymbolCode;(function(IconSymbolCode){IconSymbolCode[IconSymbolCode["More"]=12]="More";IconSymbolCode[IconSymbolCode["LinkArticle"]=74]="LinkArticle";IconSymbolCode[IconSymbolCode["UnlinkArticle"]=75]="UnlinkArticle";IconSymbolCode[IconSymbolCode["CopyLink"]=76]="CopyLink";IconSymbolCode[IconSymbolCode["EmailLink"]=77]="EmailLink";IconSymbolCode[IconSymbolCode["PrintArticle"]=456]="PrintArticle";IconSymbolCode[IconSymbolCode["SendEmail"]=63]="SendEmail";IconSymbolCode[IconSymbolCode["OpenInBrowser"]=120]="OpenInBrowser";IconSymbolCode[IconSymbolCode["Default"]=128]="Default";IconSymbolCode[IconSymbolCode["PopoutArticle"]=234]="PopoutArticle";IconSymbolCode[IconSymbolCode["CopyLinkNew"]=235]="CopyLinkNew";IconSymbolCode[IconSymbolCode["LinkArticleNew"]=461]="LinkArticleNew";IconSymbolCode[IconSymbolCode["UnlinkArticleNew"]=462]="UnlinkArticleNew";IconSymbolCode[IconSymbolCode["PopoutArticleNew"]=459]="PopoutArticleNew";IconSymbolCode[IconSymbolCode["NumberOfViews"]=176]="NumberOfViews";IconSymbolCode[IconSymbolCode["Rating"]=431]="Rating";IconSymbolCode[IconSymbolCode["SelectContent"]=408]="SelectContent";IconSymbolCode[IconSymbolCode["SelectUrl"]=74]="SelectUrl";IconSymbolCode[IconSymbolCode["UnselectContent"]=100]="UnselectContent";IconSymbolCode[IconSymbolCode["UnselectUrl"]=75]="UnselectUrl";IconSymbolCode[IconSymbolCode["Plus"]=198]="Plus";IconSymbolCode[IconSymbolCode["Close"]=97]="Close"})(IconSymbolCode=KbCommonUtils.IconSymbolCode||(KbCommonUtils.IconSymbolCode={}));var Browsers;(function(Browsers){Browsers[Browsers["Others"]=0]="Others";Browsers[Browsers["Chrome"]=1]="Chrome";Browsers[Browsers["Firefox"]=2]="Firefox";Browsers[Browsers["IE"]=3]="IE";Browsers[Browsers["Safari"]=4]="Safari";Browsers[Browsers["Edge"]=5]="Edge"})(Browsers=KbCommonUtils.Browsers||(KbCommonUtils.Browsers={}));var SearchProviderType;(function(SearchProviderType){SearchProviderType[SearchProviderType["InternalDynamicsOrg"]=1]="InternalDynamicsOrg";SearchProviderType[SearchProviderType["CrossDynamicsOrg"]=1e8]="CrossDynamicsOrg";SearchProviderType[SearchProviderType["MSSearchSharePoint"]=100000001]="MSSearchSharePoint";SearchProviderType[SearchProviderType["MSSearchConnector"]=100000002]="MSSearchConnector"})(SearchProviderType=KbCommonUtils.SearchProviderType||(KbCommonUtils.SearchProviderType={}));var InitiatedBy;(function(InitiatedBy){InitiatedBy["AutoSearch"]="Auto search";InitiatedBy["ManualSearch"]="Manual search"})(InitiatedBy=KbCommonUtils.InitiatedBy||(KbCommonUtils.InitiatedBy={}));var InteractionType;(function(InteractionType){InteractionType["ViewArticle"]="ViewArticle";InteractionType["LinkArticle"]="LinkArticle";InteractionType["UnlinkArticle"]="UnlinkArticle";InteractionType["EmailArticleContent"]="EmailArticleContent";InteractionType["EmailArticleURL"]="EmailArticleURL";InteractionType["PopoutArticle"]="PopoutArticle";InteractionType["CopyLink"]="CopyLink";InteractionType["PrintArticle"]="PrintArticle";InteractionType["SendLink"]="SendLink"})(InteractionType=KbCommonUtils.InteractionType||(KbCommonUtils.InteractionType={}));var KnowledgeOperationType;(function(KnowledgeOperationType){KnowledgeOperationType["KnowledgeSearch"]="search";KnowledgeOperationType["KnowledgeRecommendation"]="recommendation"})(KnowledgeOperationType=KbCommonUtils.KnowledgeOperationType||(KbCommonUtils.KnowledgeOperationType={}));var LiveWorkItemStatus;(function(LiveWorkItemStatus){LiveWorkItemStatus[LiveWorkItemStatus["Open"]=1]="Open";LiveWorkItemStatus[LiveWorkItemStatus["Active"]=2]="Active";LiveWorkItemStatus[LiveWorkItemStatus["Waiting"]=3]="Waiting";LiveWorkItemStatus[LiveWorkItemStatus["Closed"]=4]="Closed";LiveWorkItemStatus[LiveWorkItemStatus["WrapUp"]=5]="WrapUp"})(LiveWorkItemStatus=KbCommonUtils.LiveWorkItemStatus||(KbCommonUtils.LiveWorkItemStatus={}))})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOperationFactory=function(){function ActionOperationFactory(){this.ClearRegisteredActions()}ActionOperationFactory.prototype.ClearRegisteredActions=function(){this.instanceCreatorList={}};ActionOperationFactory.prototype.Register=function(articleAction,instanceCreator){this.instanceCreatorList[articleAction]=instanceCreator};ActionOperationFactory.prototype.GetLabel=function(articleAction){var operationAction=this.instanceCreatorList[articleAction];if(operationAction)return operationAction().Label;return ""};ActionOperationFactory.prototype.GetTooltip=function(articleAction){var operationAction=this.instanceCreatorList[articleAction];if(operationAction)return operationAction().Tooltip;return ""};ActionOperationFactory.prototype.GetSymbolCode=function(articleAction){var operationAction=this.instanceCreatorList[articleAction],symbolCode=-1;if(operationAction)symbolCode=operationAction().SymbolCode;return symbolCode&&symbolCode>=0?symbolCode:KbCommonUtils.IconSymbolCode.Default};ActionOperationFactory.prototype.Validate=function(articleAction,validationPayload){var operationAction=this.instanceCreatorList[articleAction];if(operationAction)return operationAction().ValidateOperation(validationPayload);return false};ActionOperationFactory.prototype.Execute=function(articleAction,operationPayload){var operationAction=this.instanceCreatorList[articleAction];operationAction&&operationAction().ExecuteOperation(operationPayload)};ActionOperationFactory.Instance=new ActionOperationFactory;return ActionOperationFactory}();KbCommonUtils.ActionOperationFactory=ActionOperationFactory})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOperationRegistration=function(){function ActionOperationRegistration(){}ActionOperationRegistration.RegisterAllActions=function(){KbCommonUtils.ActionOperationFactory.Instance.ClearRegisteredActions();KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.LinkArticle,function(){return new KbCommonUtils.LinkActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.UnlinkArticle,function(){return new KbCommonUtils.UnlinkActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.CopyLink,function(){return new KbCommonUtils.CopyActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.EmailArticle,function(){return new KbCommonUtils.EmailActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.EmailArticleContent,function(){return new KbCommonUtils.EmailContentActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.SelectedResult,function(){return new KbCommonUtils.SelectResultActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.OpenResult,function(){return new KbCommonUtils.OpenResultActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.SendToCTI,function(){return new KbCommonUtils.CTIActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.PrintArticle,function(){return new KbCommonUtils.PrintArticleActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.PopoutArticle,function(){return new KbCommonUtils.PopoutActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.SelectContent,function(){return new KbCommonUtils.SelectContentDialogOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.SelectUrl,function(){return new KbCommonUtils.SelectUrlDialogOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.UnselectContent,function(){return new KbCommonUtils.UnselectContentDialogOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.UnselectUrl,function(){return new KbCommonUtils.UnselectUrlDialogOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.IncreaseView,function(){return new KbCommonUtils.IncreaseViewActionOperation})};return ActionOperationRegistration}();KbCommonUtils.ActionOperationRegistration=ActionOperationRegistration})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var CopyActionOperation=function(){function CopyActionOperation(){}Object.defineProperty(CopyActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.CopyLinkButtonLabel"},enumerable:true,configurable:true});Object.defineProperty(CopyActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.CopyLinkButtonTooltip"},enumerable:true,configurable:true});Object.defineProperty(CopyActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?KbCommonUtils.IconSymbolCode.CopyLinkNew:KbCommonUtils.IconSymbolCode.CopyLink},enumerable:true,configurable:true});CopyActionOperation.prototype.ValidateOperation=function(validationPayload){var stateManager=validationPayload.stateManager;return stateManager.kmPrivileges&&stateManager.kmPrivileges.CanCopyLink&&(stateManager.useExternalKMPortal||KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(validationPayload.record))&&this.isClipboardAPISupported(validationPayload.controlContext.client.userAgent)&&KbCommonUtils.ActionOperationUtils.GetStateOfArticle(validationPayload)===3&&!window.IsUSD};CopyActionOperation.prototype.copyTextToClipboard=function(text,context){var textArea=document.createElement("textarea");textArea.style.position="fixed";textArea.style.width="2em";textArea.style.height="2em";textArea.style.border="none";textArea.style.outline="none";textArea.style.boxShadow="none";textArea.style.background="transparent";textArea.value=text;document.body.appendChild(textArea);textArea.select();try{var successful=document.execCommand("copy");if(successful){var message=context.resources.getString("SearchWidget.SearchKMArticles.CopyLinkSuccessMsg");Xrm.UI.addGlobalNotification(KbCommonUtils.Constants.GLOBAL_NOTIFICATION_TYPE_TOAST,KbCommonUtils.Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS,message,null,null,null)}else{var alertMessage={text:context.resources.getString("SearchWidget.SearchKMArticles.CopyLinkFailedMsg")};Xrm.Navigation.openAlertDialog(alertMessage)}document.body.removeChild(textArea)}catch(err){var alertMessage={text:context.resources.getString("SearchWidget.SearchKMArticles.CopyLinkFailedMsg")};Xrm.Navigation.openAlertDialog(alertMessage);document.body.removeChild(textArea)}};CopyActionOperation.prototype.ExecuteOperation=function(operationPayload){var watermarkTelemetryEvent=KbCommonUtils.WatermarkTelemetryEvent.Start(operationPayload.controlContext,KbCommonUtils.TelemetryConstants.WebresourceNameKbSearchActions,KbCommonUtils.TelemetryActionName.Copy_Link),publicPortalUrl=KbCommonUtils.ActionOperationUtils.GetKMExternalPortalUrl(operationPayload),message=operationPayload.controlContext.resources.getString("SearchWidget.SearchKMArticles.CopyLinkSuccessMsg");switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.controlContext.client.userAgent)){case KbCommonUtils.Browsers.Chrome:window.navigator.clipboard.writeText(publicPortalUrl);Xrm.UI.addGlobalNotification(KbCommonUtils.Constants.GLOBAL_NOTIFICATION_TYPE_TOAST,KbCommonUtils.Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS,message,null,null,null);break;case KbCommonUtils.Browsers.IE:window.clipboardData.setData("text",publicPortalUrl);Xrm.UI.addGlobalNotification(KbCommonUtils.Constants.GLOBAL_NOTIFICATION_TYPE_TOAST,KbCommonUtils.Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS,message,null,null,null);break;case KbCommonUtils.Browsers.Edge:case KbCommonUtils.Browsers.Firefox:this.copyTextToClipboard(publicPortalUrl,operationPayload.controlContext);default:}watermarkTelemetryEvent.End()};CopyActionOperation.prototype.isClipboardAPISupported=function(userAgent){switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(userAgent)){case KbCommonUtils.Browsers.Chrome:return window&&window.navigator&&window.navigator.clipboard&&window.navigator.clipboard.writeText;case KbCommonUtils.Browsers.IE:return window&&window.clipboardData&&window.clipboardData.setData;case KbCommonUtils.Browsers.Edge:return true;case KbCommonUtils.Browsers.Firefox:return true;default:return false}};return CopyActionOperation}();KbCommonUtils.CopyActionOperation=CopyActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var PrintArticleActionOperation=function(){function PrintArticleActionOperation(){}Object.defineProperty(PrintArticleActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.PrintArticleButtonLabel"},enumerable:true,configurable:true});Object.defineProperty(PrintArticleActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.PrintArticleButtonTooltip"},enumerable:true,configurable:true});Object.defineProperty(PrintArticleActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.PrintArticle},enumerable:true,configurable:true});PrintArticleActionOperation.prototype.ValidateOperation=function(validationPayload){return validationPayload.controlContext.client.getClient()!=="Mobile"&&this.IsInSupportedBrowsers(validationPayload)&&KbCommonUtils.CommonUtils.IsInArticlePageContext()&&!window.IsUSD};PrintArticleActionOperation.prototype.ExecuteOperation=function(operationPayload){var actionButtons=document.getElementById("MscrmControls.KbArticleControl.KbArticleControl-contentPaneArticleActionsContainer"),ratingDiv=document.getElementById("MscrmControls.KbContentControl.KbContentControl-KbRatingControlContainer");if(actionButtons)actionButtons.style.display="none";if(ratingDiv)ratingDiv.style.display="none";var iframeId="articleContent"+operationPayload.record.knowledgeArticleId,iframeDocument=this.GetContentIframe(operationPayload),contentHeight=iframeDocument.contentWindow.document.body.scrollHeight+iframeDocument.contentWindow.outerHeight-iframeDocument.contentWindow.innerHeight+"px",css='.e, body, #shell-container {overflow: visible !important;}\n\t\t\t\t\t\tdiv[data-lp-id*="KbContentControl"] { display: block !important;}\n\t\t\t\t\t\t#MscrmControls.KbArticleControl.KbArticleControl-contentPaneArticleActionsContainer, #MscrmControls.KbContentControl.KbContentControl-KbRatingControlContainer {display: none !important;}\n\t\t\t\t\t\t#'+iframeId+" { height: "+contentHeight+" !important;}",head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");head.appendChild(style);style.type="text/css";style.appendChild(document.createTextNode(css));this.PrintInternal(operationPayload);head.removeChild(style);if(actionButtons)actionButtons.style.display="block";if(ratingDiv)ratingDiv.style.display="block"};PrintArticleActionOperation.prototype.GetContentIframe=function(operationPayload){var iframeId="articleContent"+operationPayload.record.knowledgeArticleId;return document.getElementById(iframeId)};PrintArticleActionOperation.prototype.PrintInternal=function(operationPayload){switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.controlContext.client.userAgent)){case KbCommonUtils.Browsers.Chrome:window.print();break;case KbCommonUtils.Browsers.Edge:case KbCommonUtils.Browsers.Firefox:case KbCommonUtils.Browsers.IE:var iframeDocument=this.GetContentIframe(operationPayload);iframeDocument.contentWindow.print();break;default:}};PrintArticleActionOperation.prototype.IsInSupportedBrowsers=function(operationPayload){switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.controlContext.client.userAgent)){case KbCommonUtils.Browsers.Chrome:case KbCommonUtils.Browsers.Edge:case KbCommonUtils.Browsers.Firefox:case KbCommonUtils.Browsers.IE:return true;default:return false}};return PrintArticleActionOperation}();KbCommonUtils.PrintArticleActionOperation=PrintArticleActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var TIME_DELAY=5e3,ActionOperationUtils=function(){function ActionOperationUtils(){}ActionOperationUtils.sendEmailContent=function(operationPayload,emailArticleContent,isDynamicsOrg,dynamicsOrgResourceUri){var _this=this;return this.getContentToMail(operationPayload,emailArticleContent,isDynamicsOrg,dynamicsOrgResourceUri).done(function(contentToMail){var selectedArticle=operationPayload.record,knowledgeArticleId=selectedArticle.knowledgeArticleId,currentBaseEntityReference=operationPayload.controlContext.parameters.value.entityReference,primaryCustomerField=operationPayload.controlContext.parameters.value.descriptors.selectPrimaryCustomer,recepientTargetField=[];if(primaryCustomerField){recepientTargetField=Xrm.Page.getAttribute(primaryCustomerField).getValue();recepientTargetField[0].fieldname="to"}var emailObject={to:recepientTargetField,description:contentToMail,subject:selectedArticle.title,id:knowledgeArticleId};_this.CheckIfEmailHasRegardingRelationshipsToEntity(operationPayload.controlContext.parameters.value.entityReference.LogicalName,operationPayload.controlContext).then(function(regardingRelationshipExists){if(KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(operationPayload.controlContext))if(regardingRelationshipExists){var promise=KbCommonUtils.MultisessionUtils.getAnchorTabTitle(operationPayload.controlContext);promise.then(function(anchorTabTitle){ActionOperationUtils.updateEmailRegardingObject(emailObject,currentBaseEntityReference,anchorTabTitle);ActionOperationUtils.OpenEmailAppTabIfPossible(emailObject,operationPayload.controlContext)},function(err){KbCommonUtils.TelemetryReporter.LogError(operationPayload.controlContext,{controlType:KbCommonUtils.TelemetryControlType.KbSearchControl,errorMessage:"Failed to get anchor tab title",eventParams:[{name:"ErrorDetails",value:err?err.toString():""}]});ActionOperationUtils.OpenEmailAppTabIfPossible(emailObject,operationPayload.controlContext)})}else ActionOperationUtils.OpenEmailAppTabIfPossible(emailObject,operationPayload.controlContext);else{if(regardingRelationshipExists){var entityReferenceName=Xrm.Page.data.entity.getPrimaryAttributeValue();ActionOperationUtils.updateEmailRegardingObject(emailObject,currentBaseEntityReference,entityReferenceName)}var formOptions={entityName:KbCommonUtils.Constants.Email,useQuickCreateForm:true};operationPayload.controlContext.navigation.openForm(formOptions,emailObject)}})})};ActionOperationUtils.OpenEmailAppTabIfPossible=function(emailObject,context){if(KbCommonUtils.MultisessionUtils.CanCreateNewAppTab())KbCommonUtils.MultisessionUtils.OpenEmailAppTab(emailObject);else KbCommonUtils.MultisessionUtils.OpenErrorDialog(context)};ActionOperationUtils.updateEmailRegardingObject=function(emailObject,currentBaseEntityReference,entityReferenceName){emailObject[KbCommonUtils.Constants.RegardingObjectId]={fieldname:KbCommonUtils.Constants.RegardingObjectId,id:currentBaseEntityReference.Id.guid,entityType:currentBaseEntityReference.LogicalName,name:entityReferenceName}};ActionOperationUtils.CheckIfEmailHasRegardingRelationshipsToEntity=function(entityLogicalName,controlContext){var promise=$.Deferred();Xrm.Utility.getEntityMetadata(KbCommonUtils.Constants.Email).then(function(entityMetadata){var regardingRelationships=[];if(entityMetadata&&entityMetadata.ManyToOneRelationships)regardingRelationships=entityMetadata.ManyToOneRelationships.getByFilter(function(relationship){return relationship.ReferencingAttribute.toLowerCase()==KbCommonUtils.Constants.RegardingObjectId&&relationship.ReferencedEntity.toLowerCase()==entityLogicalName.toLowerCase()});var params=[];params.push({name:"entity",value:entityLogicalName});params.push({name:"relationshipExists",value:regardingRelationships.length>0});controlContext.reporting.reportSuccess("KbSearchControl.sendEmailContent.CheckIfEmailHasRegardingRelationshipsToEntity",params);return promise.resolve(regardingRelationships.length>0)},function(errorResponse){controlContext.reporting.reportFailure("KbSearchControl.sendEmailContent.getEntityMetadata",new Error(errorResponse.message));return promise.resolve(false)});return promise};ActionOperationUtils.getContentToMail=function(operationPayload,emailArticleContent,isDynamicsOrg,dynamicsOrgResourceUri){var contentPromise=$.Deferred(),isRelevanceSearchEnabled=operationPayload.controlContext.utils.isFeatureEnabled(KbCommonUtils.Constants.UCKMControlRelevanceSearch)&&operationPayload.stateManager.isExternalSearchIndexEnabled;if(!emailArticleContent)contentPromise.resolve(this.GetKMExternalPortalUrl(operationPayload));else if(isRelevanceSearchEnabled)this.GetFormattedContent(operationPayload.controlContext,operationPayload.record.knowledgeArticleId,isDynamicsOrg,dynamicsOrgResourceUri).done(function(formattedContent){contentPromise.resolve(formattedContent)}).fail(function(errorResponse){contentPromise.reject(errorResponse)});else ActionOperationUtils.GetContentWithDynamicsImageInline(operationPayload.record,operationPayload.controlContext,contentPromise,isDynamicsOrg,dynamicsOrgResourceUri);return contentPromise.promise()};ActionOperationUtils.markArticleSentToCustomer=function(operationPayload){var knowledgeArticleIncidents=null,entityReference=operationPayload.controlContext.parameters.value.entityReference,fetchXml="<fetch version='1.0' mapping='logical'><entity name='knowledgearticleincident'><attribute name='issenttocustomer'/><filter type='and'><condition attribute='incidentid' operator='eq' value='"+entityReference.Id.guid+"' /><condition attribute='knowledgearticleid' operator='eq' value='"+operationPayload.record.knowledgeArticleId+"' /></filter></entity></fetch>";entityReference.LogicalName==KbCommonUtils.Constants.Incident&&operationPayload.controlContext.webAPI.retrieveMultipleRecords(KbCommonUtils.Constants.KnowledgeArticleIncident,"?fetchXml="+fetchXml).then(function(retrieveContractDetailResponse){knowledgeArticleIncidents=retrieveContractDetailResponse.entities;if(knowledgeArticleIncidents.length>0&&!knowledgeArticleIncidents[0].issenttocustomer){var dataToUpdate={issenttocustomer:true};operationPayload.controlContext.webAPI.updateRecord(KbCommonUtils.Constants.KnowledgeArticleIncident,knowledgeArticleIncidents[0].knowledgearticleincidentid,dataToUpdate).then(function(result){},function(errorResponse){console.error(errorResponse)})}},function(errorResponse){console.error(errorResponse)})};ActionOperationUtils.GetKMExternalPortalUrl=function(operationPayload){if(KbCommonUtils.CommonUtils.IsRecordFromMicrosoftSearch(operationPayload.record))return operationPayload.record.articleUrl;var kmExternalPortalUrl=operationPayload.stateManager.externalKMPortalURL;if(kmExternalPortalUrl){var articleRE=new RegExp("{kbnum}","g");return kmExternalPortalUrl.replace(articleRE,operationPayload.record.articlePublicNumber)}else return ""};ActionOperationUtils.GetStateOfArticle=function(operationPayload){var isRelevanceSearchEnabled=operationPayload.record.hasOwnProperty("highlights");if(isRelevanceSearchEnabled)switch(operationPayload.record.stateCode){case KbCommonUtils.KbCommonControlLocale.AllDraftArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Draft"],10);case KbCommonUtils.KbCommonControlLocale.AllApprovedArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Approved"],10);case KbCommonUtils.KbCommonControlLocale.AllPublishedArticlesLocale:default:return parseInt(KbCommonUtils.Constants.ArticleState["Published"],10)}else return operationPayload.record.stateCode};ActionOperationUtils.GetCTIEventPayload=function(operationPayload){var ctiDataPayload={detail:{title:operationPayload.record.title,link:this.GetKMExternalPortalUrl(operationPayload)}};return new CustomEvent("KMClickToSend",ctiDataPayload)};ActionOperationUtils.ShouldShowConfirmationDialog=function(operationPayload){return operationPayload.record.isAssociated&&!KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()};ActionOperationUtils.ShowConfirmationDialog=function(operationPayload){var deferred=$.Deferred(),dialogTitle=KbCommonUtils.KbCommonControlLocale.ConfirmDialogTitle,dialogText=MscrmCommon.ControlUtils.String.Format(KbCommonUtils.KbCommonControlLocale.ConfirmDialogText,operationPayload.controlContext.parameters.value.entityReference.LogicalName),dialogPromise=operationPayload.controlContext.navigation.openConfirmDialog({title:dialogTitle,text:dialogText},null);dialogPromise.then(function(value){if(value&&value.confirmed)deferred.resolve();else deferred.reject()});return deferred.promise()};ActionOperationUtils.GetFormattedContent=function(context,knowledgeArticleId,isDynamicsOrg,dynamicsOrgResourceUri){var ODataEndPointUri=MscrmCommon.ControlUtils.String.Format(KbCommonUtils.Constants.URL_KA_TITLE_CONTENT,knowledgeArticleId),deferred=$.Deferred();KbCommonUtils.FetchApiHelper.Fetch(context,KbCommonUtils.GET_METHOD,KbCommonUtils.Constants.ODATA_PATH+ODataEndPointUri,"",isDynamicsOrg,dynamicsOrgResourceUri,KbCommonUtils.Constants.CrossDynamicsOrgApiCall).then(function(response){if(response.value.length>0){var searchResult=response.value[0];ActionOperationUtils.GetContentWithDynamicsImageInline(searchResult,context,deferred,isDynamicsOrg,dynamicsOrgResourceUri)}else{Xrm.Navigation.openAlertDialog(KbCommonUtils.KbCommonControlLocale.RecordDoesNotExistErrorMessage);deferred.reject()}},function(errorResponse){deferred.reject(errorResponse)});return deferred.promise()};ActionOperationUtils.GetContentWithDynamicsImageInline=function(searchResult,context,deferred,isDynamicsOrg,dynamicsOrgResourceUri){if(searchResult.content==null)return deferred.resolve(searchResult["content"]);var dynamicsImageUrlsTobeParsed=searchResult.content.match(KbCommonUtils.Constants.KBArticleImageTagRegex);if(dynamicsImageUrlsTobeParsed!=null)ActionOperationUtils.ReplaceBase64InlineAllImages(dynamicsImageUrlsTobeParsed,context,searchResult,isDynamicsOrg,dynamicsOrgResourceUri).then(function(formattedContent){return deferred.resolve(formattedContent)},function(errorResponse){return deferred.reject(errorResponse)});else deferred.resolve(searchResult["content"])};ActionOperationUtils.IsValidToSendEmail=function(operationPayload){var stateManager=operationPayload.stateManager,canSendMail=this.GetStateOfArticle(operationPayload)===3&&stateManager.kmPrivileges&&stateManager.kmPrivileges.CanEmail;return operationPayload.record.isAssociated?canSendMail:canSendMail&&stateManager.kmPrivileges&&stateManager.kmPrivileges.CanAssociateAndDisassociate};ActionOperationUtils.GetBrowserType=function(userAgent){var userAgentString=window.navigator.userAgent.toLowerCase();if(userAgentString.indexOf("edge")>-1&&userAgentString.indexOf("windows nt")>-1)return KbCommonUtils.Browsers.Edge;if(userAgent.isBrowserChrome)return KbCommonUtils.Browsers.Chrome;if(userAgent.isBrowserFirefox)return KbCommonUtils.Browsers.Firefox;if(userAgent.isBrowserIE)return KbCommonUtils.Browsers.IE;if(userAgent.isBrowserSafari)return KbCommonUtils.Browsers.Safari};ActionOperationUtils.ReplaceBase64InlineAllImages=function(base64InlineAllImages,context,searchResult,isDynamicsOrg,dynamicsOrgResourceUri){for(var base64InlineImagesDeffered=$.Deferred(),promises=[],_i=0,base64InlineAllImages_1=base64InlineAllImages;_i<base64InlineAllImages_1.length;_i++){var base64image=base64InlineAllImages_1[_i],promise=ActionOperationUtils.GetBase64InlineImage(base64image,context,isDynamicsOrg,dynamicsOrgResourceUri);promises.push(promise)}if(promises.length==0)return base64InlineImagesDeffered.resolve(searchResult.content);Promise.all(promises).then(function(successResponse){successResponse.forEach(function(returnValue){var inlineImageSrcTag=returnValue.inlineImageUrlSent.match(KbCommonUtils.Constants.KBArticleImageTagSrcRegex),inlineImagMsdynTag=returnValue.inlineImageUrlSent.match(KbCommonUtils.Constants.KBArticleImageTagmsdyntypeRegex);if(inlineImageSrcTag!=null&&inlineImageSrcTag.length>1&&inlineImagMsdynTag!=null&&inlineImagMsdynTag.length>1)searchResult.content=searchResult.content.replace(inlineImageSrcTag[1],inlineImagMsdynTag[1]+","+returnValue.response)});return base64InlineImagesDeffered.resolve(searchResult.content)},function(errorResponse){var dialogTitle=KbCommonUtils.KbCommonControlLocale.ConfirmDialogTitleForImageLoad,dialogText=KbCommonUtils.KbCommonControlLocale.ConfirmDialogForImageLoadFailureText,associationPromise=context.navigation.openConfirmDialog({title:dialogTitle,text:dialogText},null);associationPromise.then(function(value){if(value&&value.confirmed)return base64InlineImagesDeffered.resolve(searchResult.content);else return base64InlineImagesDeffered.reject(errorResponse)})});return base64InlineImagesDeffered.promise()};ActionOperationUtils.GetBase64InlineImage=function(inlineImageUrl,context,isDynamicsOrg,dynamicsOrgResourceUri){var base64InlineImageDeferred=$.Deferred();try{var inlineImageSrcTag=inlineImageUrl.match(KbCommonUtils.Constants.KBArticleImageTagSrcRegex);inlineImageSrcTag!=null&&inlineImageSrcTag.length>1&&KbCommonUtils.FetchApiHelper.Fetch(context,KbCommonUtils.GET_METHOD,inlineImageSrcTag[1].replace("$value",""),"",isDynamicsOrg,dynamicsOrgResourceUri,KbCommonUtils.Constants.CrossDynamicsOrgApiCall).then(function(response){if(response.value.length>0){var returnValue={response:response.value,inlineImageUrlSent:inlineImageUrl};base64InlineImageDeferred.resolve(returnValue)}else base64InlineImageDeferred.reject(KbCommonUtils.KbCommonControlLocale.RecordDoesNotExistErrorMessage)},function(errorResponse){context.reporting.reportFailure("KbSearchControl.sendEmailContent",new Error(errorResponse.message));base64InlineImageDeferred.reject(errorResponse)})}catch(errorResponse){context.reporting.reportFailure("KbSearchControl.sendEmailContent",new Error(errorResponse.message));base64InlineImageDeferred.reject(errorResponse)}return base64InlineImageDeferred.promise()};return ActionOperationUtils}();KbCommonUtils.ActionOperationUtils=ActionOperationUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var Md5=function(){function Md5(){this._state=new Int32Array(4);this._buffer=new ArrayBuffer(68);this._buffer8=new Uint8Array(this._buffer,0,68);this._buffer32=new Uint32Array(this._buffer,0,17);this.start()}Md5.hashStr=function(str,raw){if(raw===void 0)raw=false;return this.onePassHasher.start().appendStr(str).end(raw)};Md5.hashAsciiStr=function(str,raw){if(raw===void 0)raw=false;return this.onePassHasher.start().appendAsciiStr(str).end(raw)};Md5._hex=function(x){for(var hc=Md5.hexChars,ho=Md5.hexOut,n,offset,j,i=0;i<4;i+=1){offset=i*8;n=x[i];for(j=0;j<8;j+=2){ho[offset+1+j]=hc.charAt(n&15);n>>>=4;ho[offset+0+j]=hc.charAt(n&15);n>>>=4}}return ho.join("")};Md5._md5cycle=function(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a+=(b&c|~b&d)+k[0]-680876936|0;a=(a<<7|a>>>25)+b|0;d+=(a&b|~a&c)+k[1]-389564586|0;d=(d<<12|d>>>20)+a|0;c+=(d&a|~d&b)+k[2]+606105819|0;c=(c<<17|c>>>15)+d|0;b+=(c&d|~c&a)+k[3]-1044525330|0;b=(b<<22|b>>>10)+c|0;a+=(b&c|~b&d)+k[4]-176418897|0;a=(a<<7|a>>>25)+b|0;d+=(a&b|~a&c)+k[5]+1200080426|0;d=(d<<12|d>>>20)+a|0;c+=(d&a|~d&b)+k[6]-1473231341|0;c=(c<<17|c>>>15)+d|0;b+=(c&d|~c&a)+k[7]-45705983|0;b=(b<<22|b>>>10)+c|0;a+=(b&c|~b&d)+k[8]+1770035416|0;a=(a<<7|a>>>25)+b|0;d+=(a&b|~a&c)+k[9]-1958414417|0;d=(d<<12|d>>>20)+a|0;c+=(d&a|~d&b)+k[10]-42063|0;c=(c<<17|c>>>15)+d|0;b+=(c&d|~c&a)+k[11]-1990404162|0;b=(b<<22|b>>>10)+c|0;a+=(b&c|~b&d)+k[12]+1804603682|0;a=(a<<7|a>>>25)+b|0;d+=(a&b|~a&c)+k[13]-40341101|0;d=(d<<12|d>>>20)+a|0;c+=(d&a|~d&b)+k[14]-1502002290|0;c=(c<<17|c>>>15)+d|0;b+=(c&d|~c&a)+k[15]+1236535329|0;b=(b<<22|b>>>10)+c|0;a+=(b&d|c&~d)+k[1]-165796510|0;a=(a<<5|a>>>27)+b|0;d+=(a&c|b&~c)+k[6]-1069501632|0;d=(d<<9|d>>>23)+a|0;c+=(d&b|a&~b)+k[11]+643717713|0;c=(c<<14|c>>>18)+d|0;b+=(c&a|d&~a)+k[0]-373897302|0;b=(b<<20|b>>>12)+c|0;a+=(b&d|c&~d)+k[5]-701558691|0;a=(a<<5|a>>>27)+b|0;d+=(a&c|b&~c)+k[10]+38016083|0;d=(d<<9|d>>>23)+a|0;c+=(d&b|a&~b)+k[15]-660478335|0;c=(c<<14|c>>>18)+d|0;b+=(c&a|d&~a)+k[4]-405537848|0;b=(b<<20|b>>>12)+c|0;a+=(b&d|c&~d)+k[9]+568446438|0;a=(a<<5|a>>>27)+b|0;d+=(a&c|b&~c)+k[14]-1019803690|0;d=(d<<9|d>>>23)+a|0;c+=(d&b|a&~b)+k[3]-187363961|0;c=(c<<14|c>>>18)+d|0;b+=(c&a|d&~a)+k[8]+1163531501|0;b=(b<<20|b>>>12)+c|0;a+=(b&d|c&~d)+k[13]-1444681467|0;a=(a<<5|a>>>27)+b|0;d+=(a&c|b&~c)+k[2]-51403784|0;d=(d<<9|d>>>23)+a|0;c+=(d&b|a&~b)+k[7]+1735328473|0;c=(c<<14|c>>>18)+d|0;b+=(c&a|d&~a)+k[12]-1926607734|0;b=(b<<20|b>>>12)+c|0;a+=(b^c^d)+k[5]-378558|0;a=(a<<4|a>>>28)+b|0;d+=(a^b^c)+k[8]-2022574463|0;d=(d<<11|d>>>21)+a|0;c+=(d^a^b)+k[11]+1839030562|0;c=(c<<16|c>>>16)+d|0;b+=(c^d^a)+k[14]-35309556|0;b=(b<<23|b>>>9)+c|0;a+=(b^c^d)+k[1]-1530992060|0;a=(a<<4|a>>>28)+b|0;d+=(a^b^c)+k[4]+1272893353|0;d=(d<<11|d>>>21)+a|0;c+=(d^a^b)+k[7]-155497632|0;c=(c<<16|c>>>16)+d|0;b+=(c^d^a)+k[10]-1094730640|0;b=(b<<23|b>>>9)+c|0;a+=(b^c^d)+k[13]+681279174|0;a=(a<<4|a>>>28)+b|0;d+=(a^b^c)+k[0]-358537222|0;d=(d<<11|d>>>21)+a|0;c+=(d^a^b)+k[3]-722521979|0;c=(c<<16|c>>>16)+d|0;b+=(c^d^a)+k[6]+76029189|0;b=(b<<23|b>>>9)+c|0;a+=(b^c^d)+k[9]-640364487|0;a=(a<<4|a>>>28)+b|0;d+=(a^b^c)+k[12]-421815835|0;d=(d<<11|d>>>21)+a|0;c+=(d^a^b)+k[15]+530742520|0;c=(c<<16|c>>>16)+d|0;b+=(c^d^a)+k[2]-995338651|0;b=(b<<23|b>>>9)+c|0;a+=(c^(b|~d))+k[0]-198630844|0;a=(a<<6|a>>>26)+b|0;d+=(b^(a|~c))+k[7]+1126891415|0;d=(d<<10|d>>>22)+a|0;c+=(a^(d|~b))+k[14]-1416354905|0;c=(c<<15|c>>>17)+d|0;b+=(d^(c|~a))+k[5]-57434055|0;b=(b<<21|b>>>11)+c|0;a+=(c^(b|~d))+k[12]+1700485571|0;a=(a<<6|a>>>26)+b|0;d+=(b^(a|~c))+k[3]-1894986606|0;d=(d<<10|d>>>22)+a|0;c+=(a^(d|~b))+k[10]-1051523|0;c=(c<<15|c>>>17)+d|0;b+=(d^(c|~a))+k[1]-2054922799|0;b=(b<<21|b>>>11)+c|0;a+=(c^(b|~d))+k[8]+1873313359|0;a=(a<<6|a>>>26)+b|0;d+=(b^(a|~c))+k[15]-30611744|0;d=(d<<10|d>>>22)+a|0;c+=(a^(d|~b))+k[6]-1560198380|0;c=(c<<15|c>>>17)+d|0;b+=(d^(c|~a))+k[13]+1309151649|0;b=(b<<21|b>>>11)+c|0;a+=(c^(b|~d))+k[4]-145523070|0;a=(a<<6|a>>>26)+b|0;d+=(b^(a|~c))+k[11]-1120210379|0;d=(d<<10|d>>>22)+a|0;c+=(a^(d|~b))+k[2]+718787259|0;c=(c<<15|c>>>17)+d|0;b+=(d^(c|~a))+k[9]-343485551|0;b=(b<<21|b>>>11)+c|0;x[0]=a+x[0]|0;x[1]=b+x[1]|0;x[2]=c+x[2]|0;x[3]=d+x[3]|0};Md5.prototype.start=function(){this._dataLength=0;this._bufferLength=0;this._state.set(Md5.stateIdentity);return this};Md5.prototype.appendStr=function(str){for(var buf8=this._buffer8,buf32=this._buffer32,bufLen=this._bufferLength,code,i=0;i<str.length;i+=1){code=str.charCodeAt(i);if(code<128)buf8[bufLen++]=code;else if(code<2048){buf8[bufLen++]=(code>>>6)+192;buf8[bufLen++]=code&63|128}else if(code<55296||code>56319){buf8[bufLen++]=(code>>>12)+224;buf8[bufLen++]=code>>>6&63|128;buf8[bufLen++]=code&63|128}else{code=(code-55296)*1024+(str.charCodeAt(++i)-56320)+65536;if(code>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");buf8[bufLen++]=(code>>>18)+240;buf8[bufLen++]=code>>>12&63|128;buf8[bufLen++]=code>>>6&63|128;buf8[bufLen++]=code&63|128}if(bufLen>=64){this._dataLength+=64;Md5._md5cycle(this._state,buf32);bufLen-=64;buf32[0]=buf32[16]}}this._bufferLength=bufLen;return this};Md5.prototype.appendAsciiStr=function(str){for(var buf8=this._buffer8,buf32=this._buffer32,bufLen=this._bufferLength,i,j=0;true;){i=Math.min(str.length-j,64-bufLen);while(i--)buf8[bufLen++]=str.charCodeAt(j++);if(bufLen<64)break;this._dataLength+=64;Md5._md5cycle(this._state,buf32);bufLen=0}this._bufferLength=bufLen;return this};Md5.prototype.appendByteArray=function(input){for(var buf8=this._buffer8,buf32=this._buffer32,bufLen=this._bufferLength,i,j=0;true;){i=Math.min(input.length-j,64-bufLen);while(i--)buf8[bufLen++]=input[j++];if(bufLen<64)break;this._dataLength+=64;Md5._md5cycle(this._state,buf32);bufLen=0}this._bufferLength=bufLen;return this};Md5.prototype.getState=function(){var self=this,s=self._state;return {buffer:String.fromCharCode.apply(null,self._buffer8),buflen:self._bufferLength,length:self._dataLength,state:[s[0],s[1],s[2],s[3]]}};Md5.prototype.setState=function(state){var buf=state.buffer,x=state.state,s=this._state,i;this._dataLength=state.length;this._bufferLength=state.buflen;s[0]=x[0];s[1]=x[1];s[2]=x[2];s[3]=x[3];for(i=0;i<buf.length;i+=1)this._buffer8[i]=buf.charCodeAt(i)};Md5.prototype.end=function(raw){if(raw===void 0)raw=false;var bufLen=this._bufferLength,buf8=this._buffer8,buf32=this._buffer32,i=(bufLen>>2)+1,dataBitsLen;this._dataLength+=bufLen;buf8[bufLen]=128;buf8[bufLen+1]=buf8[bufLen+2]=buf8[bufLen+3]=0;buf32.set(Md5.buffer32Identity.subarray(i),i);if(bufLen>55){Md5._md5cycle(this._state,buf32);buf32.set(Md5.buffer32Identity)}dataBitsLen=this._dataLength*8;if(dataBitsLen<=4294967295)buf32[14]=dataBitsLen;else{var matches=dataBitsLen.toString(16).match(/(.*?)(.{0,8})$/);if(matches===null)return;var lo=parseInt(matches[2],16),hi=parseInt(matches[1],16)||0;buf32[14]=lo;buf32[15]=hi}Md5._md5cycle(this._state,buf32);return raw?this._state:Md5._hex(this._state)};Md5.prototype.getGuid=function(){var hash=this.end().toString(),m=hash.match(/(.{8})(.{4})(.{4})(.{4})(.{12})/);return m[1]+"-"+m[2]+"-"+m[3]+"-"+m[4]+"-"+m[5]};Md5.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);Md5.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);Md5.hexChars="0123456789abcdef";Md5.hexOut=[];Md5.onePassHasher=new Md5;return Md5}();KbCommonUtils.Md5=Md5})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KnowledgeSearchInsight=function(){function KnowledgeSearchInsight(){this.ResultCount=0;this.ResponseTime=-1}return KnowledgeSearchInsight}();KbCommonUtils.KnowledgeSearchInsight=KnowledgeSearchInsight})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var MultisessionUtils=function(){function MultisessionUtils(){}MultisessionUtils.getAnchorTabTitle=function(context){var def=$.Deferred(),fromContext=false;if(context.parameters&&context.parameters.WrapperContext){var multisessionContext=context.parameters.WrapperContext.MultisessionContext;if(multisessionContext&&multisessionContext.Session){fromContext=true;multisessionContext.Session.getContext().then(function(context){var title=context.parameters?context.parameters["anchor.title"]:null;def.resolve(title)},function(err){def.reject(err)})}}if(!fromContext)if(context.parameters&&context.parameters.AutoSuggestionField){var originalTitle=context.parameters.AutoSuggestionField.formatted;def.resolve(originalTitle)}else def.resolve("");return def.promise()};MultisessionUtils.OpenEmailAppTab=function(emailObject){var pageInput={pageType:"entityrecord",entityName:KbCommonUtils.Constants.Email,data:emailObject},tabOptions={canBeClosed:true,isFocused:true},tabInput={pageInput:pageInput,options:tabOptions};MultisessionUtils.OpenAppTab(tabInput)};MultisessionUtils.OpenArticleAppTab=function(record,context){var tab=MultisessionUtils.GetTabIfOpened(context,record.knowledgeArticleId);if(tab!=null){tab.focus();return}var pageInput={pageType:"control",controlName:"MscrmControls.KnowledgeControl.KnowledgeControl",data:{showControl:"article",articleId:record.knowledgeArticleId,resourceUri:record.resourceUri,isCrossDynamicsOrgArticle:KbCommonUtils.CommonUtils.IsRecordFromCrossDynamicsOrgSearch(record),systemUserId:record.systemUserId,searchProviderType:record.searchProviderType}},tabOptions={canBeClosed:true,isFocused:true,title:record.title},tabInput={pageInput:pageInput,options:tabOptions};MultisessionUtils.OpenAppTab(tabInput,record.knowledgeArticleId,context)};MultisessionUtils.OpenAppTab=function(tabInput,knowledgearticleid,context){Xrm.App.sessions.getSession(Xrm.App.sessions.getFocusedSession().sessionId).tabs.createTab(tabInput).then(function(tabId){if(context.parameters&&context.parameters.WrapperContext){var multisessionContext=context.parameters.WrapperContext.MultisessionContext;multisessionContext&&multisessionContext.SessionContext&&knowledgearticleid&&multisessionContext.SessionContext.set(knowledgearticleid,tabId)}})};MultisessionUtils.SetAppTabTitle=function(title){Xrm.App.sessions.getSession(Xrm.App.sessions.getFocusedSession().sessionId).tabs.getFocusedTab().title=title};MultisessionUtils.CanCreateNewAppTab=function(){var sessionId=Xrm.App.sessions.getFocusedSession().sessionId,tabs=Xrm.App.sessions.getSession(sessionId).tabs;return tabs.canCreateTab()};MultisessionUtils.OpenErrorDialog=function(context){var title=context.resources.getString("Error_Title_0x90000008"),message=context.resources.getString("Error_Message_0x90000008"),alertMessage={text:message,title:title};return Xrm.Navigation.openAlertDialog(alertMessage)};MultisessionUtils.GetTabIfOpened=function(context,id){if(context.parameters&&context.parameters.WrapperContext){var multisessionContext=context.parameters.WrapperContext.MultisessionContext;if(multisessionContext&&multisessionContext.SessionContext){var tabId=multisessionContext.SessionContext.get(id);if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(tabId))return null;var tab=null;try{tab=multisessionContext.Session.getTab(tabId)}catch(ex){return null}return tab}}};return MultisessionUtils}();KbCommonUtils.MultisessionUtils=MultisessionUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var OrganizationSettings=function(){function OrganizationSettings(){}Object.defineProperty(OrganizationSettings,"geoName",{"get":function(){var organizationGeoName="",organizationSettings=null;if(Xrm&&Xrm.Utility&&Xrm.Utility.getGlobalContext)organizationSettings=Xrm.Utility.getGlobalContext().organizationSettings;if(organizationSettings){organizationGeoName=organizationSettings.organizationGeo;if(organizationGeoName&&organizationGeoName.toUpperCase()==="NA")organizationGeoName=organizationSettings.isSovereignCloud?"GCC":organizationGeoName}return organizationGeoName},enumerable:true,configurable:true});Object.defineProperty(OrganizationSettings,"IsSupportedCloudType",{"get":function(){var isAllowed=true;switch(this.geoName){case "GCC":case "USG":case "CHN":isAllowed=false;break}return isAllowed},enumerable:true,configurable:true});Object.defineProperty(OrganizationSettings,"FirstPartyEndpoint",{"get":function(){var endpoint="https://www.d365ccafpi.com";switch(this.geoName){case "TIP":endpoint="https://www.d365ccafpi-dev.com";break;case "GCC":endpoint="https://www.d365ccafpi-gcc.com";break;case "USG":endpoint="https://www.d365ccafpi-gcc.com";break;case "CHN":endpoint="https://www.d365ccafpi.chn";break}return endpoint},enumerable:true,configurable:true});Object.defineProperty(OrganizationSettings,"DiscoveryServiceEndpoint",{"get":function(){var endpoint="https://globaldisco.crm.dynamics.com";switch(this.geoName){case "TIP":endpoint="https://globaldisco.crm10.dynamics.com";break;case "GCC":endpoint="https://globaldisco.crm9.dynamics.com";break;case "USG":endpoint="https://globaldisco.crm.microsoftdynamics.us";break}return endpoint},enumerable:true,configurable:true});return OrganizationSettings}();KbCommonUtils.OrganizationSettings=OrganizationSettings})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KbCommonControlLocale=function(){function KbCommonControlLocale(){}KbCommonControlLocale.initialize=function(getString){KbCommonControlLocale.AllDraftArticlesLocale=getString(KbCommonUtils.Constants.AllDraftArticlesResourceName);KbCommonControlLocale.AllPublishedArticlesLocale=getString(KbCommonUtils.Constants.AllPublishedArticlesResourceName);KbCommonControlLocale.AllApprovedArticlesLocale=getString(KbCommonUtils.Constants.AllApprovedArticlesResourceName);KbCommonControlLocale.ConfirmDialogTitle=getString(KbCommonUtils.Constants.ConfirmDialogTitle);KbCommonControlLocale.ConfirmDialogText=getString(KbCommonUtils.Constants.ConfirmDialogTextResourceName);KbCommonControlLocale.RecordDoesNotExistErrorMessage=getString(KbCommonUtils.Constants.RecordDoesNotExistErrorMessageResourceName);KbCommonControlLocale.ConfirmDialogTitleForImageLoad=getString(KbCommonUtils.Constants.ConfirmDialogTitleForImageLoad);KbCommonControlLocale.ConfirmDialogForImageLoadFailureText=getString(KbCommonUtils.Constants.ConfirmDialogTextForImageLoadFailure);KbCommonControlLocale.CTIFailedMessageForConversationStateText=getString(KbCommonUtils.Constants.CTIFailedMessageForConversationStateResourceName);KbCommonControlLocale.CTIFailedMessageForConversationStateTitle=getString(KbCommonUtils.Constants.CTIFailedMessageForConversationStateTitleResourceName)};return KbCommonControlLocale}();KbCommonUtils.KbCommonControlLocale=KbCommonControlLocale})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var AssociateDisassociateKnowledgeArticleRequest=function(){function AssociateDisassociateKnowledgeArticleRequest(regardingObjectId,regardingObjectTypeCode,associationRelationshipName,knowledgeArticleId,entityName){this.RegardingObjectId=regardingObjectId;this.RegardingObjectTypeCode=regardingObjectTypeCode;this.AssociationRelationshipName=associationRelationshipName;this.KnowledgeArticleId=knowledgeArticleId;this.EntityName=entityName}return AssociateDisassociateKnowledgeArticleRequest}();KbCommonUtils.AssociateDisassociateKnowledgeArticleRequest=AssociateDisassociateKnowledgeArticleRequest})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KMPrivileges=function(){function KMPrivileges(){}return KMPrivileges}();KbCommonUtils.KMPrivileges=KMPrivileges})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var TelemetryConstants=function(){function TelemetryConstants(){}TelemetryConstants.WebresourceNameKbSearchActions="KbSearchActions";return TelemetryConstants}();KbCommonUtils.TelemetryConstants=TelemetryConstants;var TelemetryComponentName;(function(TelemetryComponentName){TelemetryComponentName["KnowledgeManagement_Usage"]="KnowledgeManagement.Usage";TelemetryComponentName["KnowledgeManagement_Info"]="KnowledgeManagement.Info";TelemetryComponentName["KnowledgeManagement_Error"]="KnowledgeManagement.Error";TelemetryComponentName["KbArticleControl_General"]="KnowledgeManagement.KbArticleControl";TelemetryComponentName["KMInsights_FailedCreateSearchRecord"]="KnowledgeManagement.KMInsights.FailedCreateSearchRecord";TelemetryComponentName["KMInsights_FailedCreateInteractionRecord"]="KnowledgeManagement.KMInsights.FailedCreateInteractionRecord"})(TelemetryComponentName=KbCommonUtils.TelemetryComponentName||(KbCommonUtils.TelemetryComponentName={}));var TelemetryActionName;(function(TelemetryActionName){TelemetryActionName["KMInsights_Search"]="KMInsights_Search";TelemetryActionName["KMInsights_Interaction"]="KMInsights_Interaction";TelemetryActionName["EditorPlugin"]="EditorPlugin";TelemetryActionName["KbSearch_Control_Initialized"]="KbSearchControl_Initialized";TelemetryActionName["KbEditor_Control_Initialized"]="KbEditorControl_Initialized";TelemetryActionName["KbArticle_Control_Initialized"]="KbArticleControl_Initialized";TelemetryActionName["KbSearch_Performed"]="KbSearch_Performed";TelemetryActionName["Load_KbSearch_Control"]="Load_KbSearch_Control";TelemetryActionName["Load_Search_Results"]="Load_Search_Results";TelemetryActionName["Open_Article_To_Read"]="Open_Article_To_Read";TelemetryActionName["SeeMore_Option_Clicked"]="SeeMore_Option_Clicked";TelemetryActionName["Sort_Order_Changed"]="Article_Sort_Order_Changed";TelemetryActionName["Status_Filter_Changed"]="Article_Status_Filter_Changed";TelemetryActionName["Language_Filter_Changed"]="Article_Language_Filter_Changed";TelemetryActionName["Link_KbArticle"]="Link_Article";TelemetryActionName["Unlink_KbArticle"]="Unlink_Article";TelemetryActionName["Email_Article_Content"]="Email_Content";TelemetryActionName["Email_Article_URL"]="Email_URL";TelemetryActionName["Popout_KbArticle"]="Popout_Article";TelemetryActionName["Print_Article"]="Print_Article";TelemetryActionName["Copy_Link"]="Copy_Link";TelemetryActionName["Send_Link_ToCTI"]="Send_Link_ToCTI";TelemetryActionName["Select_Content"]="Select_Content";TelemetryActionName["Unselect_Content"]="Unselect_Content";TelemetryActionName["Select_Url"]="Select_Url";TelemetryActionName["Unselect_Url"]="Unselect_Url";TelemetryActionName["Increase_View_Count"]="Increase_View_Count";TelemetryActionName["Federation_Search_Initialized"]="Federation_Search_Initialized";TelemetryActionName["Federation_Search_Provider_Change"]="Federation_Search_Provider_Change"})(TelemetryActionName=KbCommonUtils.TelemetryActionName||(KbCommonUtils.TelemetryActionName={}));var TelemetrySourceType;(function(TelemetrySourceType){TelemetrySourceType["SiteMap"]="SiteMap";TelemetrySourceType["Dialog"]="Dialog";TelemetrySourceType["EntityForm"]="EntityForm";TelemetrySourceType["ProductivityPanel"]="MultiSession_ProductivityPanel";TelemetrySourceType["AppTab"]="MultiSession_AppTab";TelemetrySourceType["ArticlePage"]="ArticlePage"})(TelemetrySourceType=KbCommonUtils.TelemetrySourceType||(KbCommonUtils.TelemetrySourceType={}));var TelemetryControlType;(function(TelemetryControlType){TelemetryControlType["KbArticleControl"]="KbArticleControl";TelemetryControlType["KbSearchControl"]="KbSearchControl";TelemetryControlType["KbEditorControl"]="KbEditorControl";TelemetryControlType["KbContentControl"]="KbContentControl";TelemetryControlType["KbRatingControl"]="KbRatingControl";TelemetryControlType["KnowledgeControl"]="KnowledgeControl";TelemetryControlType["KbEnvironmentSelector"]="KbEnvironmentSelector"})(TelemetryControlType=KbCommonUtils.TelemetryControlType||(KbCommonUtils.TelemetryControlType={}));var TelemetryReleaseWave;(function(TelemetryReleaseWave){TelemetryReleaseWave["October2019"]="October 2019";TelemetryReleaseWave["April2020"]="April 2020";TelemetryReleaseWave["October2020"]="October 2020"})(TelemetryReleaseWave=KbCommonUtils.TelemetryReleaseWave||(KbCommonUtils.TelemetryReleaseWave={}));var TelemetryFeatureName;(function(TelemetryFeatureName){TelemetryFeatureName["KbSearch"]="KB Search";TelemetryFeatureName["ArticleActions"]="Article Actions";TelemetryFeatureName["KMInsights"]="KM Insights";TelemetryFeatureName["KMSuggestion"]="KM Suggestion";TelemetryFeatureName["FederationSearch"]="Federation Search";TelemetryFeatureName["ExpandCollapse"]="Expand Collapse";TelemetryFeatureName["KMRichTextEditor"]="KM RichTextEditor"})(TelemetryFeatureName=KbCommonUtils.TelemetryFeatureName||(KbCommonUtils.TelemetryFeatureName={}));var TelemetrySubFeatureName;(function(TelemetrySubFeatureName){TelemetrySubFeatureName["AutoSearch"]="AutoSearch";TelemetrySubFeatureName["ManualSearch"]="ManualSearch"})(TelemetrySubFeatureName=KbCommonUtils.TelemetrySubFeatureName||(KbCommonUtils.TelemetrySubFeatureName={}))})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var FCBUtil=function(){function FCBUtil(){}FCBUtil.SetCustomerEnabledWaves=function(context){KbCommonUtils.FCBUtil._isCustomerEnabledForOct2020Wave=KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(context)};FCBUtil.IsCustomerEnabledForOct2020Wave=function(){return KbCommonUtils.FCBUtil._isCustomerEnabledForOct2020Wave};FCBUtil.isCustomerEnabledForCurrentWave=function(context){return context.utils.isFeatureEnabled(this.CurrentWave)};FCBUtil.IsCustomerEnabledForOctWave=function(context){return context.utils.isFeatureEnabled(this.October2020Wave)};FCBUtil.IsFeatureEnabled=function(context,feature,checkCurrentWave){if(checkCurrentWave===void 0)checkCurrentWave=true;if(checkCurrentWave)return context.utils.isFeatureEnabled(feature)&&this.isCustomerEnabledForCurrentWave(context);return context.utils.isFeatureEnabled(feature)};FCBUtil.AreAllFeaturesEnabled=function(context,features){if(!features||features.length==0)return false;return features.every(function(feature){return context.utils.isFeatureEnabled(feature)})};FCBUtil.IsStatePersistenceEnabled=function(context){return FCBUtil.AreAllFeaturesEnabled(context,[FCBUtil.October2020Wave,FCBUtil.KMStatePersistence])||KbCommonUtils.CommonUtils.IsMultisessionHost(context)};FCBUtil.CurrentWave="April2020Update";FCBUtil.October2020Wave="October2020Update";FCBUtil.KMExpandCollapse="KMExpandCollapseEnabled";FCBUtil.KMInsertArticle="KMInsertArticleEnabled";FCBUtil.KMCopyPasteImage="KMCopyPasteImageEnabled";FCBUtil.KMCopyPasteImageWithDefaultDialog="KMCopyPasteImageEnabledWithDefaultDialog";FCBUtil.KMStatePersistence="KMStatePersistence";FCBUtil.KMRichTextEditorEnabled="KMRichTextEditorEnabled";FCBUtil.KMFederatedSearch="KMFederatedSearch";return FCBUtil}();KbCommonUtils.FCBUtil=FCBUtil})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var TelemetryReporter=function(){function TelemetryReporter(){}TelemetryReporter.LogError=function(context,params){if(!context)return;var eventParameters=[];eventParameters.push({name:"ControlType",value:params.controlType});eventParameters.push({name:"EntityType",value:context.page.entityTypeName==null?"":context.page.entityTypeName});eventParameters.push({name:"SourceType",value:TelemetryReporter.GetSourceType(context,params.controlType)});params.eventParams&&params.eventParams.forEach(function(element){eventParameters.push({name:element.name,value:element.value})});var componentName=params.componentName==null?KbCommonUtils.TelemetryComponentName.KnowledgeManagement_Error:params.componentName;context.reporting.reportFailure(componentName,new Error(params.errorMessage),"",eventParameters)};TelemetryReporter.LogInfo=function(context,params){if(!context)return;var eventParameters=TelemetryReporter.CreateEventParameters(context,params),componentName=params.componentName==null?KbCommonUtils.TelemetryComponentName.KnowledgeManagement_Info:params.componentName;context.reporting.reportSuccess(componentName,eventParameters)};TelemetryReporter.LogUsage=function(context,params){if(!context)return;var eventParameters=TelemetryReporter.CreateEventParameters(context,params),componentName=params.componentName==null?KbCommonUtils.TelemetryComponentName.KnowledgeManagement_Usage:params.componentName;context.reporting.reportSuccess(componentName,eventParameters)};TelemetryReporter.CreateEventParameters=function(context,params){var eventParameters=[];eventParameters.push({name:"ActionName",value:params.actionName});eventParameters.push({name:"ControlType",value:params.controlType});eventParameters.push({name:"EntityType",value:context.page.entityTypeName==null?"":context.page.entityTypeName});eventParameters.push({name:"SourceType",value:params.sourceType==null?TelemetryReporter.GetSourceType(context,params.controlType):params.sourceType});eventParameters.push({name:"ReleaseWave",value:params.releaseWave==null?"":params.releaseWave});eventParameters.push({name:"FeatureName",value:params.featureName==null?"":params.featureName});eventParameters.push({name:"SubFeatureName",value:params.subFeatureName==null?"":params.subFeatureName});params.eventParams&&params.eventParams.forEach(function(element){eventParameters.push({name:element.name,value:element.value})});return eventParameters};TelemetryReporter.GetSourceType=function(context,controlType){var sourceType="";if(KbCommonUtils.CommonUtils.IsLoadedInProductivityPanel(context))sourceType=KbCommonUtils.TelemetrySourceType.ProductivityPanel;else if(KbCommonUtils.CommonUtils.IsHostedInMultisessionStandaloneMode(context))sourceType=KbCommonUtils.TelemetrySourceType.AppTab;else if(KbCommonUtils.CommonUtils.IsHostedInEntityContext(context))sourceType=KbCommonUtils.TelemetrySourceType.EntityForm;else if(KbCommonUtils.CommonUtils.IsInSearchPageContext())sourceType=KbCommonUtils.TelemetrySourceType.SiteMap;else if(KbCommonUtils.CommonUtils.IsLoadedInDialog(context))sourceType=KbCommonUtils.TelemetrySourceType.Dialog;else if(KbCommonUtils.CommonUtils.IsInArticlePageContext())sourceType=KbCommonUtils.TelemetrySourceType.ArticlePage;return sourceType};return TelemetryReporter}();KbCommonUtils.TelemetryReporter=TelemetryReporter})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var CommonUtils=function(){function CommonUtils(){}CommonUtils.isUci=function(){var winObj=window;if(winObj.Xrm&&winObj.Xrm.Internal&&winObj.Xrm.Internal.isUci)return winObj.Xrm.Internal.isUci();return false};CommonUtils.getRatingIcon=function(){return KbCommonUtils.IconSymbolCode.Rating};CommonUtils.getScrollPos=function(id,context){var divId=context.accessibility.getUniqueId(id);if(divId!=null){var element=document.getElementById(divId);if(divId.indexOf("VirtualFilterControlContainer")>=0&&element!=null)element=element.querySelector(".webkitScroll");if(element!=null)return element.scrollTop}return 0};CommonUtils.IsHostedInEntityContext=function(context){return !MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(context.page.entityTypeName)&&!MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(context.page.entityId)};CommonUtils.IsReferencePanel=function(context){return CommonUtils.IsHostedInEntityContext(context)&&!CommonUtils.IsLoadedInProductivityPanel(context)};CommonUtils.IsInSearchPageContext=function(){return window&&window.location&&window.location.href&&window.location.href.toLowerCase().indexOf("kbsearch")>-1};CommonUtils.IsInArticlePageContext=function(){return window&&window.location&&window.location.href&&window.location.href.toLowerCase().indexOf("kbarticle")>-1};CommonUtils.IsMultisessionHost=function(context){return context.parameters.WrapperContext&&context.parameters.WrapperContext.MultisessionContext};CommonUtils.IsLoadedInProductivityPanel=function(context){return CommonUtils.IsMultisessionHost(context)&&context.parameters.WrapperContext.MultisessionContext.IsProductivityPane};CommonUtils.IsLoadedInDialog=function(context){return context.parameters.WrapperContext&&context.parameters.WrapperContext.DialogContext};CommonUtils.IsHostedInMultisessionStandaloneMode=function(context){return CommonUtils.IsMultisessionHost(context)&&!CommonUtils.IsLoadedInProductivityPanel(context)};CommonUtils.IsArticleOpenInMultisessionAppTab=function(context){return CommonUtils.IsMultisessionHost(context)&&context.mode&&context.mode.fullPageParam&&context.mode.fullPageParam.showControl==KbCommonUtils.Constants.ShowArticle};CommonUtils.IsEntityTypeConversation=function(context){if(context.parameters&&context.parameters.AnchorTabContext&&context.parameters.AnchorTabContext.raw){var anchorTabData=JSON.parse(context.parameters.AnchorTabContext.raw);if(anchorTabData.entityName!=KbCommonUtils.Constants.ConversationEntityName)return false}return true};CommonUtils.IsEntityTypeConversationHostedInProductivityPane=function(context){return CommonUtils.IsLoadedInProductivityPanel(context)&&CommonUtils.IsEntityTypeConversation(context)};CommonUtils.IsRecordFromMicrosoftSearch=function(record){return KbCommonUtils.SearchProviderType.MSSearchConnector===record.searchProviderType||KbCommonUtils.SearchProviderType.MSSearchSharePoint===record.searchProviderType};CommonUtils.IsRecordFromDynamicsSearch=function(record){return KbCommonUtils.SearchProviderType.InternalDynamicsOrg===record.searchProviderType||KbCommonUtils.SearchProviderType.CrossDynamicsOrg===record.searchProviderType};CommonUtils.IsRecordFromCrossDynamicsOrgSearch=function(record){return KbCommonUtils.SearchProviderType.CrossDynamicsOrg===record.searchProviderType};CommonUtils.IsRecordFromFederatedSearch=function(record){return this.IsRecordFromCrossDynamicsOrgSearch(record)||this.IsRecordFromMicrosoftSearch(record)};CommonUtils.GetAppIdInCIFramework=function(){return window&&window.top&&window.top["Microsoft"]&&window.top["Microsoft"].hasOwnProperty("CIFramework")&&window.top["Microsoft"]["CIFramework"].hasOwnProperty("Internal")?window.top["Microsoft"]["CIFramework"]["Internal"].appId:""};CommonUtils.GetMaxString=function(value,maxLength){var result=value;if(result&&result.length>maxLength)result=value.substring(0,maxLength-1);return result};CommonUtils.GenerateUUID=function(){var d=(new Date).getTime(),d2=performance&&performance.now&&performance.now()*1e3||0;return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16;if(d>0){r=(d+r)%16|0;d=Math.floor(d/16)}else{r=(d2+r)%16|0;d2=Math.floor(d2/16)}return (c==="x"?r:r&3|8).toString(16)})};CommonUtils.CreateKnowledgeInteractionRecord=function(context,knowledgeoperationid,interactiontype,articlerecordid,articlerank,controlType,knowledgeoperationtype,articlerelevance,interactioncontext){if(controlType===void 0)controlType=KbCommonUtils.TelemetryControlType.KbSearchControl;if(knowledgeoperationtype===void 0)knowledgeoperationtype=KbCommonUtils.KnowledgeOperationType.KnowledgeSearch;if(articlerelevance===void 0)articlerelevance=null;if(interactioncontext===void 0)interactioncontext=null;var deferred=$.Deferred(),eventParams=[];eventParams.push({name:"KnowledgeOperationType",value:knowledgeoperationtype});eventParams.push({name:"InteractionType",value:interactiontype});if(!knowledgeoperationid||!articlerank){KbCommonUtils.TelemetryReporter.LogError(context,{componentName:KbCommonUtils.TelemetryComponentName.KMInsights_FailedCreateInteractionRecord,controlType:controlType,errorMessage:"Invalid knowledgeoperationid or articlerank. knowledgeoperationid:"+knowledgeoperationid+", articlerank:"+articlerank,eventParams:eventParams});deferred.reject()}else{var recordPayload={KnowledgeOperationId:knowledgeoperationid,KnowledgeOperationType:knowledgeoperationtype,Timestamp:new Date,InteractionType:interactiontype,ArticleRecordId:articlerecordid,ArticleRelevance:articlerelevance,ArticleRank:articlerank,InteractionContext:CommonUtils.GetMaxString(interactioncontext,2e3)},requestData={InteractionRecordPayload:JSON.stringify(recordPayload)},OdataUri=KbCommonUtils.Constants.ODATA_PATH+"/CreateKMInsightRecord";KbCommonUtils.FetchApiHelper.Fetch(context,KbCommonUtils.POST_METHOD,OdataUri,JSON.stringify(requestData)).then(function(result){eventParams.push({name:"InteractionInsightRecordId",value:result.RecordId});KbCommonUtils.TelemetryReporter.LogUsage(context,{actionName:KbCommonUtils.TelemetryActionName.KMInsights_Interaction,controlType:controlType,releaseWave:KbCommonUtils.TelemetryReleaseWave.October2020,featureName:knowledgeoperationtype==KbCommonUtils.KnowledgeOperationType.KnowledgeSearch?KbCommonUtils.TelemetryFeatureName.KMInsights:KbCommonUtils.TelemetryFeatureName.KMSuggestion,eventParams:eventParams});deferred.resolve()},function(errorResponse){KbCommonUtils.TelemetryReporter.LogError(context,{componentName:KbCommonUtils.TelemetryComponentName.KMInsights_FailedCreateInteractionRecord,controlType:controlType,errorMessage:errorResponse.message,eventParams:eventParams});deferred.reject()})}return deferred.promise()};CommonUtils.ConvertArticleActionToInteractionType=function(articleActionId){switch(articleActionId){case KbCommonUtils.ArticleAction.LinkArticle:return KbCommonUtils.InteractionType.LinkArticle;case KbCommonUtils.ArticleAction.UnlinkArticle:return KbCommonUtils.InteractionType.UnlinkArticle;case KbCommonUtils.ArticleAction.EmailArticle:return KbCommonUtils.InteractionType.EmailArticleURL;case KbCommonUtils.ArticleAction.EmailArticleContent:return KbCommonUtils.InteractionType.EmailArticleContent;case KbCommonUtils.ArticleAction.CopyLink:return KbCommonUtils.InteractionType.CopyLink;case KbCommonUtils.ArticleAction.PopoutArticle:return KbCommonUtils.InteractionType.PopoutArticle;case KbCommonUtils.ArticleAction.PrintArticle:return KbCommonUtils.InteractionType.PrintArticle;case KbCommonUtils.ArticleAction.SendToCTI:return KbCommonUtils.InteractionType.SendLink;default:return KbCommonUtils.InteractionType.ViewArticle}};return CommonUtils}();KbCommonUtils.CommonUtils=CommonUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var WatermarkTelemetryEvent=function(){function WatermarkTelemetryEvent(context,webResourceName,functionName,additionalEventParameters){this.context=context;this.webResourceName=webResourceName;this.functionName=functionName;this.additionalEventParameters=additionalEventParameters;this.startTime=new Date}WatermarkTelemetryEvent.Start=function(context,webResourceName,functionName,additionalEventParameters){var telemetryEventObj=new WatermarkTelemetryEvent(context,webResourceName,functionName,additionalEventParameters);if(!context)return telemetryEventObj;var telemetryevent=telemetryEventObj.CreateWatermarkTelemetryEvent();telemetryEventObj.context.reporting.reportEvent(telemetryevent);return telemetryEventObj};WatermarkTelemetryEvent.prototype.End=function(){if(!this.context)return;var endTime=new Date,telemetryevent=this.CreateWatermarkTelemetryEvent(),executionTime=endTime.getTime()-this.startTime.getTime();telemetryevent.eventParameters.push({name:"executionTime",value:executionTime});this.context.reporting.reportEvent(telemetryevent)};WatermarkTelemetryEvent.prototype.EndAndLogError=function(errorParams){this.End();KbCommonUtils.TelemetryReporter.LogError(this.context,errorParams)};WatermarkTelemetryEvent.prototype.CreateWatermarkTelemetryEvent=function(){var eventParameters=[];eventParameters.push({name:"webResourceName",value:this.webResourceName});eventParameters.push({name:"functionName",value:this.functionName});this.additionalEventParameters&&this.additionalEventParameters.forEach(function(additionalEventParameter){eventParameters.push(additionalEventParameter)});var telemetryevent={eventName:"ServiceWebResources",eventParameters:eventParameters};return telemetryevent};return WatermarkTelemetryEvent}();KbCommonUtils.WatermarkTelemetryEvent=WatermarkTelemetryEvent})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}))