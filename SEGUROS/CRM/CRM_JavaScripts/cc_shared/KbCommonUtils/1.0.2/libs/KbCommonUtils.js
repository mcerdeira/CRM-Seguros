var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var CTIActionOperation=function(){function CTIActionOperation(){}Object.defineProperty(CTIActionOperation.prototype,"Label",{"get":function(){return "KMControl.SearchKMArticles.SendToCTILabel"},enumerable:true,configurable:true});Object.defineProperty(CTIActionOperation.prototype,"Tooltip",{"get":function(){return "KMControl.SearchKMArticles.SendToCTITooltip"},enumerable:true,configurable:true});Object.defineProperty(CTIActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SendEmail},enumerable:true,configurable:true});CTIActionOperation.prototype.ValidateOperation=function(validationPayload){return window&&window.top&&window.top["Microsoft"]&&window.top["Microsoft"].hasOwnProperty("CIFramework")||false};CTIActionOperation.prototype.ExecuteOperation=function(operationPayload){window.top.dispatchEvent(KbCommonUtils.ActionOperationUtils.GetCTIEventPayload(operationPayload))};return CTIActionOperation}();KbCommonUtils.CTIActionOperation=CTIActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var EmailActionOperation=function(){function EmailActionOperation(){}Object.defineProperty(EmailActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.EmailArticleIconLabel"},enumerable:true,configurable:true});Object.defineProperty(EmailActionOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"SearchWidget.SearchKMArticles.EmailArticleIconToolTipNew":"SearchWidget.SearchKMArticles.EmailArticleIconToolTip"},enumerable:true,configurable:true});Object.defineProperty(EmailActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.EmailLink},enumerable:true,configurable:true});EmailActionOperation.prototype.ValidateOperation=function(validationPayload){var stateManager=validationPayload.stateManager;return KbCommonUtils.ActionOperationUtils.IsInExistingFormContent(validationPayload)&&stateManager.useExternalKMPortal&&KbCommonUtils.ActionOperationUtils.IsValidToSendEmail(validationPayload)};EmailActionOperation.prototype.ExecuteOperation=function(operationPayload){KbCommonUtils.ActionOperationUtils.AssociateAndSendMail(operationPayload,false).then(function(){KbCommonUtils.PerformanceTelemetry.Instance.AddEndMarker(KbCommonUtils.TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_URL,operationPayload.controlContext)})};return EmailActionOperation}();KbCommonUtils.EmailActionOperation=EmailActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var EmailContentActionOperation=function(){function EmailContentActionOperation(){}Object.defineProperty(EmailContentActionOperation.prototype,"Label",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"SearchWidget.SearchKMArticles.EmailArticleContentIconLabelNew":"SearchWidget.SearchKMArticles.EmailArticleContentIconLabel"},enumerable:true,configurable:true});Object.defineProperty(EmailContentActionOperation.prototype,"Tooltip",{"get":function(){return KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave()?"SearchWidget.SearchKMArticles.EmailArticleContentIconToolTipNew":"SearchWidget.SearchKMArticles.EmailArticleContentIconToolTip"},enumerable:true,configurable:true});Object.defineProperty(EmailContentActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.SendEmail},enumerable:true,configurable:true});EmailContentActionOperation.prototype.ValidateOperation=function(validationPayload){return KbCommonUtils.ActionOperationUtils.IsInExistingFormContent(validationPayload)&&KbCommonUtils.ActionOperationUtils.IsValidToSendEmail(validationPayload)};EmailContentActionOperation.prototype.ExecuteOperation=function(operationPayload){KbCommonUtils.ActionOperationUtils.AssociateAndSendMail(operationPayload,true).then(function(){KbCommonUtils.PerformanceTelemetry.Instance.AddEndMarker(KbCommonUtils.TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_CONTENT,operationPayload.controlContext)})};return EmailContentActionOperation}();KbCommonUtils.EmailContentActionOperation=EmailContentActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var LinkActionOperation=function(){function LinkActionOperation(){}Object.defineProperty(LinkActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.AssociateArticleIconLabel"},enumerable:true,configurable:true});Object.defineProperty(LinkActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.AssociateArticleIconToolTip"},enumerable:true,configurable:true});Object.defineProperty(LinkActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.LinkArticle},enumerable:true,configurable:true});LinkActionOperation.prototype.ValidateOperation=function(validationPayload){var stateManager=validationPayload.stateManager;return KbCommonUtils.ActionOperationUtils.IsInExistingFormContent(validationPayload)&&stateManager.kmPrivileges&&stateManager.kmPrivileges.CanAssociateAndDisassociate&&!validationPayload.record.isAssociated};LinkActionOperation.prototype.ExecuteOperation=function(operationPayload){};return LinkActionOperation}();KbCommonUtils.LinkActionOperation=LinkActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var OpenResultActionOperation=function(){function OpenResultActionOperation(){}Object.defineProperty(OpenResultActionOperation.prototype,"Label",{"get":function(){return "KMControl.SearchKMArticles.OpenResult"},enumerable:true,configurable:true});Object.defineProperty(OpenResultActionOperation.prototype,"Tooltip",{"get":function(){return "KMControl.SearchKMArticles.OpenResult"},enumerable:true,configurable:true});Object.defineProperty(OpenResultActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.Default},enumerable:true,configurable:true});OpenResultActionOperation.prototype.ValidateOperation=function(validationPayload){return false};OpenResultActionOperation.prototype.ExecuteOperation=function(operationPayload){var stateManager=operationPayload.stateManager;if(operationPayload.record){stateManager.SetSelectedArticle(operationPayload.record,operationPayload.controlContext);stateManager.SetIsSearchMode(false,operationPayload.controlContext);operationPayload.controlContext.utils.requestRender(stateManager.GetkbSearchResultContentPaneObject().updateIframe.bind(this))}};return OpenResultActionOperation}();KbCommonUtils.OpenResultActionOperation=OpenResultActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var PopoutActionOperation=function(){function PopoutActionOperation(){}Object.defineProperty(PopoutActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.PopoutArticleIconLabel"},enumerable:true,configurable:true});Object.defineProperty(PopoutActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.PopoutArticleIconTooltip"},enumerable:true,configurable:true});Object.defineProperty(PopoutActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.PopoutArticle},enumerable:true,configurable:true});PopoutActionOperation.prototype.ValidateOperation=function(validationPayload){return validationPayload.controlContext.client.getClient()!=="Mobile"&&!KbCommonUtils.ActionOperationUtils.IsInArticlePageContext()&&KbCommonUtils.FCBUtil.IsFeatureEnabled(validationPayload.controlContext,KbCommonUtils.FCBUtil.SearchUIEnhancements)&&!window.IsUSD};PopoutActionOperation.prototype.ExecuteOperation=function(operationPayload){var knowledgeArticleId=operationPayload.record.knowledgeArticleId,appid=operationPayload.controlContext.page.appId;window.open("main.aspx?appid="+appid+"&pagetype=kbarticle&navbar=off&articleId="+knowledgeArticleId,"KnowledgeArticle"+knowledgeArticleId);KbCommonUtils.PerformanceTelemetry.Instance.AddEndMarker(KbCommonUtils.TelemetryConstants.WATERMARK_ACTION_POPOUT_KBARTICLE,operationPayload.controlContext,knowledgeArticleId)};return PopoutActionOperation}();KbCommonUtils.PopoutActionOperation=PopoutActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var SelectResultActionOperation=function(){function SelectResultActionOperation(){}Object.defineProperty(SelectResultActionOperation.prototype,"Label",{"get":function(){return "KMControl.SearchKMArticles.SelectedResult"},enumerable:true,configurable:true});Object.defineProperty(SelectResultActionOperation.prototype,"Tooltip",{"get":function(){return "KMControl.SearchKMArticles.SelectedResult"},enumerable:true,configurable:true});Object.defineProperty(SelectResultActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.Default},enumerable:true,configurable:true});SelectResultActionOperation.prototype.ValidateOperation=function(validationPayload){return false};SelectResultActionOperation.prototype.ExecuteOperation=function(operationPayload){var context=operationPayload.controlContext;context.parameters.value.executeUpdateSelectedResult(context.parameters.value.contextToken,operationPayload.record.knowledgeArticleId)};return SelectResultActionOperation}();KbCommonUtils.SelectResultActionOperation=SelectResultActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var UnlinkActionOperation=function(){function UnlinkActionOperation(){}Object.defineProperty(UnlinkActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.DisassociateArticleIconLabel"},enumerable:true,configurable:true});Object.defineProperty(UnlinkActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.DisassociateArticleIconToolTip"},enumerable:true,configurable:true});Object.defineProperty(UnlinkActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.UnlinkArticle},enumerable:true,configurable:true});UnlinkActionOperation.prototype.ValidateOperation=function(validationPayload){var stateManager=validationPayload.stateManager;return KbCommonUtils.ActionOperationUtils.IsInExistingFormContent(validationPayload)&&stateManager.kmPrivileges&&stateManager.kmPrivileges.CanAssociateAndDisassociate&&validationPayload.record.isAssociated};UnlinkActionOperation.prototype.ExecuteOperation=function(operationPayload){};return UnlinkActionOperation}();KbCommonUtils.UnlinkActionOperation=UnlinkActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";KbCommonUtils.GET_METHOD="GET";KbCommonUtils.POST_METHOD="POST";var StreamResponseStructure=function(){function StreamResponseStructure(){}return StreamResponseStructure}();function ProcessInnerException(error){var innerExceptionStringParts=[];error.type&&innerExceptionStringParts.push(error.type);error.message&&innerExceptionStringParts.push(error.message);error.stacktrace&&innerExceptionStringParts.push(error.stacktrace);return innerExceptionStringParts.join("\r\n")}function ShowErrorMessage(error){if(error){if(error.error)error=error.error;var errorMessage=error.message,errorCode=error.code,details="";if(error.innererror)details=ProcessInnerException(error.innererror);if(errorMessage&&errorCode){var errorDialogOptions={errorCode:parseInt(errorCode),message:errorMessage,details:details};window.Xrm.Navigation.openErrorDialog(errorDialogOptions)}}}function Fetch(userAgent,method,odataUri,data){if(!userAgent.isIos&&typeof window.fetch==="function"){var input=null,init=null;if(method==KbCommonUtils.GET_METHOD)input=new Request(odataUri,{method:method,credentials:"same-origin"});else{input=odataUri;init={method:method,credentials:"same-origin",headers:{"Content-Type":"application/json",prefer:'odata.include-annotations="*"',"odata-maxversion":"4.0","odata-version":"4.0"},body:data}}return fetch(input,init).then(function(res){if(res.ok){if(res.status===204)return "";return res.json()}else{var errorReader_1=res.body.getReader(),errorString_1="",errorDeferred_1=$.Deferred();errorReader_1.read().then(function processText(streamResponse){if(streamResponse.done){var errorObject=JSON.parse(errorString_1);ShowErrorMessage(errorObject);errorDeferred_1.reject(errorObject);return}errorString_1+=String.fromCharCode.apply(null,streamResponse.value);return errorReader_1.read().then(processText)});return errorDeferred_1.promise()}})}else{var deferred_1=$.Deferred(),xhr_1=new XMLHttpRequest;xhr_1.onreadystatechange=function(){if(xhr_1.readyState!==4)return;if(xhr_1.status===204)deferred_1.resolve("");else if(xhr_1.status>=200&&xhr_1.status<300&&xhr_1.responseText&&xhr_1.responseText.length>0)deferred_1.resolve(JSON.parse(xhr_1.responseText));else{var errorObject=JSON.parse(xhr_1.responseText);ShowErrorMessage(errorObject);deferred_1.reject(errorObject);return}};xhr_1.open(method,odataUri);if(method==KbCommonUtils.GET_METHOD)xhr_1.send();else{xhr_1.setRequestHeader("Content-Type","application/json; charset=UTF-8");xhr_1.setRequestHeader("accept","application/json");xhr_1.setRequestHeader("prefer",'odata.include-annotations="*"');xhr_1.setRequestHeader("odata-maxversion","4.0");xhr_1.setRequestHeader("odata-version","4.0");xhr_1.send(data)}return deferred_1.promise()}}KbCommonUtils.Fetch=Fetch})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var Constants=function(){function Constants(){}Constants.ODATA_PATH="/api/data/v9.0";Constants.URL_KA_TITLE_CONTENT="/knowledgearticles?$select=content&$filter=knowledgearticleid eq {0}";Constants.NumberOfViewsIconToolTip="SearchWidget.SearchKMArticles.NumberOfViewsToolTip";Constants.ModifiedOnLabelToolTip="SearchWidget.SearchKMArticles.LastModifiedDateLabelToolTip";Constants.RatingIconToolTip="SearchWidget.SearchKMArticles.RatingIconToolTip";Constants.ModifiedOnLabel="SearchWidget.SearchKMArticles.LastModifiedDateLabel";Constants.CopyLinkButtonLabel="SearchWidget.SearchKMArticles.CopyLinkButtonLabel";Constants.CopyLinkButtonTooltip="SearchWidget.SearchKMArticles.CopyLinkButtonTooltip";Constants.PrintArticleButtonLabel="SearchWidget.SearchKMArticles.PrintArticleButtonLabel";Constants.PrintArticleButtonTooltip="SearchWidget.SearchKMArticles.PrintArticleButtonTooltip";Constants.CopyLinkSuccessMsg="SearchWidget.SearchKMArticles.CopyLinkSuccessMsg";Constants.CopyLinkFailedMsg="SearchWidget.SearchKMArticles.CopyLinkFailedMsg";Constants.ConfirmDialogTitleForImageLoad="SearchWidget.SearchKMArticles.ConfirmDialogTitleForImageLoad";Constants.ConfirmDialogTextForImageLoadFailure="SearchWidget.SearchKMArticles.ConfirmDialogTextForImageLoadFailure";Constants.Incident="incident";Constants.KnowledgeArticleIncident="knowledgearticleincident";Constants.AllDraftArticlesResourceName="SearchWidget.Filters.AllDraftArticles";Constants.AllPublishedArticlesResourceName="SearchWidget.Filters.AllPublishedArticles";Constants.AllApprovedArticlesResourceName="SearchWidget.Filters.AllApprovedArticles";Constants.ConfirmDialogTitle="SearchWidget.SearchKMArticles.ConfirmDialogTitle";Constants.ConfirmDialogTextResourceName="SearchWidget.SearchKMArticles.ConfirmDialogText";Constants.RecordDoesNotExistErrorMessageResourceName="SearchWidget.SearchKMArticles.RecordDoesNotExistErrorMessageResourceName";Constants.WebresourceNameArticleActions="ArticleActions";Constants.EnterKeyValue="Enter";Constants.ServerSearchFailure="SearchWidget.SearchKMArticles.ServerFailure";Constants.KBArticleControlID="kbarticle";Constants.GLOBAL_NOTIFICATION_TYPE_TOAST=1;Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS=1;Constants.UCKMControlRelevanceSearch="UCKMControlRelevanceSearch";Constants.COLOR_ACTION_ICON="#3B79B7";Constants.COLOR_ACTION_TITLE="#323130";Constants.BGCOLOR_ACTION="#F3F2F1";Constants.COLOR_HOVER_ACTION="#2E5FA4";Constants.MiddleDotUnicode="\u00b7";Constants.Rating="Rating";Constants.NumberOfViews="NumberOfViews";Constants.KBArticleImageTagRegex=/<img\s+[^>]*msdyn_knowledgearticleimages[^>]*>/gm;Constants.KBArticleImageTagSrcRegex=/src\s*=\s*"([^"]+)"/;Constants.KBArticleImageTagmsdyntypeRegex=/data-msdyntype\s*=\s*"([^"]+)"/;Constants.AccessibilityLabelStyle={width:"0px",height:"0px",position:"absolute",left:"-10000px",overflow:"hidden"};Constants.ArticleState={Draft:"0",Approved:"1",Published:"3"};return Constants}();KbCommonUtils.Constants=Constants})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var ArticleAction;(function(ArticleAction){ArticleAction[ArticleAction["LinkArticle"]=0]="LinkArticle";ArticleAction[ArticleAction["UnlinkArticle"]=1]="UnlinkArticle";ArticleAction[ArticleAction["CopyLink"]=2]="CopyLink";ArticleAction[ArticleAction["EmailArticle"]=3]="EmailArticle";ArticleAction[ArticleAction["PopoutArticle"]=4]="PopoutArticle";ArticleAction[ArticleAction["EmailArticleContent"]=5]="EmailArticleContent";ArticleAction[ArticleAction["OpenResult"]=6]="OpenResult";ArticleAction[ArticleAction["SelectedResult"]=7]="SelectedResult";ArticleAction[ArticleAction["SendToCTI"]=8]="SendToCTI";ArticleAction[ArticleAction["PrintArticle"]=9]="PrintArticle"})(ArticleAction=KbCommonUtils.ArticleAction||(KbCommonUtils.ArticleAction={}));var IconSymbolCode;(function(IconSymbolCode){IconSymbolCode[IconSymbolCode["More"]=12]="More";IconSymbolCode[IconSymbolCode["LinkArticle"]=74]="LinkArticle";IconSymbolCode[IconSymbolCode["UnlinkArticle"]=75]="UnlinkArticle";IconSymbolCode[IconSymbolCode["CopyLink"]=76]="CopyLink";IconSymbolCode[IconSymbolCode["EmailLink"]=77]="EmailLink";IconSymbolCode[IconSymbolCode["PrintArticle"]=456]="PrintArticle";IconSymbolCode[IconSymbolCode["SendEmail"]=89]="SendEmail";IconSymbolCode[IconSymbolCode["OpenInBrowser"]=120]="OpenInBrowser";IconSymbolCode[IconSymbolCode["Default"]=128]="Default";IconSymbolCode[IconSymbolCode["PopoutArticle"]=234]="PopoutArticle"})(IconSymbolCode=KbCommonUtils.IconSymbolCode||(KbCommonUtils.IconSymbolCode={}));var Browsers;(function(Browsers){Browsers[Browsers["Others"]=0]="Others";Browsers[Browsers["Chrome"]=1]="Chrome";Browsers[Browsers["Firefox"]=2]="Firefox";Browsers[Browsers["IE"]=3]="IE";Browsers[Browsers["Safari"]=4]="Safari";Browsers[Browsers["Edge"]=5]="Edge"})(Browsers=KbCommonUtils.Browsers||(KbCommonUtils.Browsers={}))})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOperationFactory=function(){function ActionOperationFactory(){this.ClearRegisteredActions()}ActionOperationFactory.prototype.ClearRegisteredActions=function(){this.instanceCreatorList={}};ActionOperationFactory.prototype.Register=function(articleAction,instanceCreator){this.instanceCreatorList[articleAction]=instanceCreator};ActionOperationFactory.prototype.GetLabel=function(articleAction){var operationAction=this.instanceCreatorList[articleAction];if(operationAction)return operationAction().Label;return ""};ActionOperationFactory.prototype.GetTooltip=function(articleAction){var operationAction=this.instanceCreatorList[articleAction];if(operationAction)return operationAction().Tooltip;return ""};ActionOperationFactory.prototype.GetSymbolCode=function(articleAction){var operationAction=this.instanceCreatorList[articleAction],symbolCode=-1;if(operationAction)symbolCode=operationAction().SymbolCode;return symbolCode&&symbolCode>=0?symbolCode:KbCommonUtils.IconSymbolCode.Default};ActionOperationFactory.prototype.Validate=function(articleAction,validationPayload){var operationAction=this.instanceCreatorList[articleAction];if(operationAction)return operationAction().ValidateOperation(validationPayload);return false};ActionOperationFactory.prototype.Execute=function(articleAction,operationPayload){var operationAction=this.instanceCreatorList[articleAction];operationAction&&operationAction().ExecuteOperation(operationPayload)};ActionOperationFactory.Instance=new ActionOperationFactory;return ActionOperationFactory}();KbCommonUtils.ActionOperationFactory=ActionOperationFactory})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOperationRegistration=function(){function ActionOperationRegistration(){}ActionOperationRegistration.RegisterAllActions=function(){KbCommonUtils.ActionOperationFactory.Instance.ClearRegisteredActions();KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.LinkArticle,function(){return new KbCommonUtils.LinkActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.UnlinkArticle,function(){return new KbCommonUtils.UnlinkActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.CopyLink,function(){return new KbCommonUtils.CopyActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.EmailArticle,function(){return new KbCommonUtils.EmailActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.EmailArticleContent,function(){return new KbCommonUtils.EmailContentActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.SelectedResult,function(){return new KbCommonUtils.SelectResultActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.OpenResult,function(){return new KbCommonUtils.OpenResultActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.SendToCTI,function(){return new KbCommonUtils.CTIActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.PrintArticle,function(){return new KbCommonUtils.PrintArticleActionOperation});KbCommonUtils.ActionOperationFactory.Instance.Register(KbCommonUtils.ArticleAction.PopoutArticle,function(){return new KbCommonUtils.PopoutActionOperation})};return ActionOperationRegistration}();KbCommonUtils.ActionOperationRegistration=ActionOperationRegistration})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var CopyActionOperation=function(){function CopyActionOperation(){}Object.defineProperty(CopyActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.CopyLinkButtonLabel"},enumerable:true,configurable:true});Object.defineProperty(CopyActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.CopyLinkButtonTooltip"},enumerable:true,configurable:true});Object.defineProperty(CopyActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.CopyLink},enumerable:true,configurable:true});CopyActionOperation.prototype.ValidateOperation=function(validationPayload){var stateManager=validationPayload.stateManager;return stateManager.kmPrivileges&&stateManager.kmPrivileges.CanCopyLink&&stateManager.useExternalKMPortal&&this.isClipboardAPISupported(validationPayload.controlContext.client.userAgent)&&KbCommonUtils.ActionOperationUtils.GetStateOfArticle(validationPayload)===3&&!window.IsUSD};CopyActionOperation.prototype.copyTextToClipboard=function(text,context){var textArea=document.createElement("textarea");textArea.style.position="fixed";textArea.style.width="2em";textArea.style.height="2em";textArea.style.border="none";textArea.style.outline="none";textArea.style.boxShadow="none";textArea.style.background="transparent";textArea.value=text;document.body.appendChild(textArea);textArea.select();try{var successful=document.execCommand("copy");if(successful){var message=context.resources.getString("SearchWidget.SearchKMArticles.CopyLinkSuccessMsg");Xrm.UI.addGlobalNotification(KbCommonUtils.Constants.GLOBAL_NOTIFICATION_TYPE_TOAST,KbCommonUtils.Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS,message,null,null,null)}else{var alertMessage={text:context.resources.getString("SearchWidget.SearchKMArticles.CopyLinkFailedMsg")};Xrm.Navigation.openAlertDialog(alertMessage)}document.body.removeChild(textArea)}catch(err){var alertMessage={text:context.resources.getString("SearchWidget.SearchKMArticles.CopyLinkFailedMsg")};Xrm.Navigation.openAlertDialog(alertMessage);document.body.removeChild(textArea)}};CopyActionOperation.prototype.ExecuteOperation=function(operationPayload){var publicPortalUrl=KbCommonUtils.ActionOperationUtils.GetKMExternalPortalUrl(operationPayload),message=operationPayload.controlContext.resources.getString("SearchWidget.SearchKMArticles.CopyLinkSuccessMsg");switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.controlContext.client.userAgent)){case KbCommonUtils.Browsers.Chrome:window.navigator.clipboard.writeText(publicPortalUrl);Xrm.UI.addGlobalNotification(KbCommonUtils.Constants.GLOBAL_NOTIFICATION_TYPE_TOAST,KbCommonUtils.Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS,message,null,null,null);break;case KbCommonUtils.Browsers.IE:window.clipboardData.setData("text",publicPortalUrl);Xrm.UI.addGlobalNotification(KbCommonUtils.Constants.GLOBAL_NOTIFICATION_TYPE_TOAST,KbCommonUtils.Constants.GLOBAL_NOTIFICATION_LEVEL_SUCCESS,message,null,null,null);break;case KbCommonUtils.Browsers.Edge:case KbCommonUtils.Browsers.Firefox:this.copyTextToClipboard(publicPortalUrl,operationPayload.controlContext);default:}};CopyActionOperation.prototype.isClipboardAPISupported=function(userAgent){switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(userAgent)){case KbCommonUtils.Browsers.Chrome:return window&&window.navigator&&window.navigator.clipboard&&window.navigator.clipboard.writeText;case KbCommonUtils.Browsers.IE:return window&&window.clipboardData&&window.clipboardData.setData;case KbCommonUtils.Browsers.Edge:return true;case KbCommonUtils.Browsers.Firefox:return true;default:return false}};return CopyActionOperation}();KbCommonUtils.CopyActionOperation=CopyActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var PrintArticleActionOperation=function(){function PrintArticleActionOperation(){}Object.defineProperty(PrintArticleActionOperation.prototype,"Label",{"get":function(){return "SearchWidget.SearchKMArticles.PrintArticleButtonLabel"},enumerable:true,configurable:true});Object.defineProperty(PrintArticleActionOperation.prototype,"Tooltip",{"get":function(){return "SearchWidget.SearchKMArticles.PrintArticleButtonTooltip"},enumerable:true,configurable:true});Object.defineProperty(PrintArticleActionOperation.prototype,"SymbolCode",{"get":function(){return KbCommonUtils.IconSymbolCode.PrintArticle},enumerable:true,configurable:true});PrintArticleActionOperation.prototype.ValidateOperation=function(validationPayload){return validationPayload.controlContext.client.getClient()!=="Mobile"&&this.IsInSupportedBrowsers(validationPayload)&&KbCommonUtils.ActionOperationUtils.IsInArticlePageContext()&&KbCommonUtils.FCBUtil.IsFeatureEnabled(validationPayload.controlContext,KbCommonUtils.FCBUtil.SearchUIEnhancements)&&!window.IsUSD};PrintArticleActionOperation.prototype.ExecuteOperation=function(operationPayload){var actionButtons=document.getElementById("MscrmControls.KbArticleControl.KbArticleControl-contentPaneArticleActionsContainer"),ratingDiv=document.getElementById("MscrmControls.KbContentControl.KbContentControl-KbRatingControlContainer");if(actionButtons)actionButtons.style.display="none";if(ratingDiv)ratingDiv.style.display="none";var iframeId="articleContent"+operationPayload.record.knowledgeArticleId,iframeDocument=this.GetContentIframe(operationPayload),contentHeight=iframeDocument.contentWindow.document.body.scrollHeight+iframeDocument.contentWindow.outerHeight-iframeDocument.contentWindow.innerHeight+"px",css='.e, body, #shell-container {overflow: visible !important;}\n\t\t\t\t\t\tdiv[data-lp-id*="KbContentControl"] { display: block !important;}\n\t\t\t\t\t\t#MscrmControls.KbArticleControl.KbArticleControl-contentPaneArticleActionsContainer, #MscrmControls.KbContentControl.KbContentControl-KbRatingControlContainer {display: none !important;}\n\t\t\t\t\t\t#'+iframeId+" { height: "+contentHeight+" !important;}",head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");head.appendChild(style);style.type="text/css";style.appendChild(document.createTextNode(css));this.PrintInternal(operationPayload);head.removeChild(style);if(actionButtons)actionButtons.style.display="block";if(ratingDiv)ratingDiv.style.display="block"};PrintArticleActionOperation.prototype.GetContentIframe=function(operationPayload){var iframeId="articleContent"+operationPayload.record.knowledgeArticleId;return document.getElementById(iframeId)};PrintArticleActionOperation.prototype.PrintInternal=function(operationPayload){switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.controlContext.client.userAgent)){case KbCommonUtils.Browsers.Chrome:window.print();break;case KbCommonUtils.Browsers.Edge:case KbCommonUtils.Browsers.Firefox:case KbCommonUtils.Browsers.IE:var iframeDocument=this.GetContentIframe(operationPayload);iframeDocument.contentWindow.print();break;default:}};PrintArticleActionOperation.prototype.IsInSupportedBrowsers=function(operationPayload){switch(KbCommonUtils.ActionOperationUtils.GetBrowserType(operationPayload.controlContext.client.userAgent)){case KbCommonUtils.Browsers.Chrome:case KbCommonUtils.Browsers.Edge:case KbCommonUtils.Browsers.Firefox:case KbCommonUtils.Browsers.IE:return true;default:return false}};return PrintArticleActionOperation}();KbCommonUtils.PrintArticleActionOperation=PrintArticleActionOperation})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var ActionOperationUtils=function(){function ActionOperationUtils(){}ActionOperationUtils.sendEmailContent=function(operationPayload,emailArticleContent){return this.getContentToMail(operationPayload,emailArticleContent).done(function(contentToMail){var selectedArticle=operationPayload.record,knowledgeArticleId=selectedArticle.knowledgeArticleId,currentBaseEntityReference=operationPayload.controlContext.parameters.value.entityReference,primaryCustomerField=operationPayload.controlContext.parameters.value.descriptors.selectPrimaryCustomer,recepientTargetField=[];if(primaryCustomerField){recepientTargetField=Xrm.Page.getAttribute(primaryCustomerField).getValue();recepientTargetField[0].fieldname="to"}var regardingNameAttrValue=Xrm.Page.data.entity.getPrimaryAttributeValue(),emailObject={to:recepientTargetField,regardingobjectid:{fieldname:"regardingobjectid",id:currentBaseEntityReference.Id.guid,entityType:currentBaseEntityReference.LogicalName,name:regardingNameAttrValue},description:contentToMail,subject:selectedArticle.title,id:knowledgeArticleId},formOptions={entityName:"email",useQuickCreateForm:true};operationPayload.controlContext.navigation.openForm(formOptions,emailObject)})};ActionOperationUtils.getContentToMail=function(operationPayload,emailArticleContent){var contentPromise=$.Deferred(),isRelevanceSearchEnabled=operationPayload.controlContext.utils.isFeatureEnabled(KbCommonUtils.Constants.UCKMControlRelevanceSearch)&&operationPayload.stateManager.isExternalSearchIndexEnabled;if(!emailArticleContent)contentPromise.resolve(this.GetKMExternalPortalUrl(operationPayload));else if(isRelevanceSearchEnabled)this.GetFormattedContent(operationPayload.controlContext,operationPayload.record.knowledgeArticleId).done(function(formattedContent){contentPromise.resolve(formattedContent)}).fail(function(errorResponse){contentPromise.reject(errorResponse)});else ActionOperationUtils.GetContentWithDynamicsImageInline(operationPayload.record,operationPayload.controlContext,contentPromise);return contentPromise.promise()};ActionOperationUtils.markArticleSentToCustomer=function(){var that=this,knowledgeArticleIncidents=null,entityReference=that.controlContext.parameters.value.entityReference,fetchXml="<fetch version='1.0' mapping='logical'><entity name='knowledgearticleincident'><attribute name='issenttocustomer'/><filter type='and'><condition attribute='incidentid' operator='eq' value='"+entityReference.Id.guid+"' /><condition attribute='knowledgearticleid' operator='eq' value='"+that.record.knowledgeArticleId+"' /></filter></entity></fetch>";entityReference.LogicalName==KbCommonUtils.Constants.Incident&&that.controlContext.webAPI.retrieveMultipleRecords(KbCommonUtils.Constants.KnowledgeArticleIncident,"?fetchXml="+fetchXml).then(function(retrieveContractDetailResponse){knowledgeArticleIncidents=retrieveContractDetailResponse.entities;if(knowledgeArticleIncidents.length>0&&!knowledgeArticleIncidents[0].issenttocustomer){var dataToUpdate={issenttocustomer:true};that.controlContext.webAPI.updateRecord(KbCommonUtils.Constants.KnowledgeArticleIncident,knowledgeArticleIncidents[0].knowledgearticleincidentid,dataToUpdate).then(function(result){},function(errorResponse){console.error(errorResponse)})}},function(errorResponse){console.error(errorResponse)})};ActionOperationUtils.GetKMExternalPortalUrl=function(operationPayload){var kmExternalPortalUrl=operationPayload.stateManager.externalKMPortalURL;if(kmExternalPortalUrl){var articleRE=new RegExp("{kbnum}","g");return kmExternalPortalUrl.replace(articleRE,operationPayload.record.articlePublicNumber)}else return ""};ActionOperationUtils.GetStateOfArticle=function(operationPayload){var isRelevanceSearchEnabled=operationPayload.record.hasOwnProperty("highlights");if(isRelevanceSearchEnabled)switch(operationPayload.record.stateCode){case KbCommonUtils.KbCommonControlLocale.AllDraftArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Draft"],10);case KbCommonUtils.KbCommonControlLocale.AllApprovedArticlesLocale:return parseInt(KbCommonUtils.Constants.ArticleState["Approved"],10);case KbCommonUtils.KbCommonControlLocale.AllPublishedArticlesLocale:default:return parseInt(KbCommonUtils.Constants.ArticleState["Published"],10)}else return operationPayload.record.stateCode};ActionOperationUtils.GetCTIEventPayload=function(operationPayload){var ctiDataPayload={detail:{title:operationPayload.record.title,link:this.GetKMExternalPortalUrl(operationPayload)}};return new CustomEvent("KMClickToSend",ctiDataPayload)};ActionOperationUtils.AssociateAndSendMail=function(operationPayload,emailArticleContent){var _this=this,deferred=$.Deferred(),showConfirmationDialog=operationPayload.record.isAssociated&&!KbCommonUtils.FCBUtil.IsCustomerEnabledForOct2020Wave();if(showConfirmationDialog){var dialogTitle=KbCommonUtils.KbCommonControlLocale.ConfirmDialogTitle,dialogText=MscrmCommon.ControlUtils.String.Format(KbCommonUtils.KbCommonControlLocale.ConfirmDialogText,operationPayload.controlContext.parameters.value.entityReference.LogicalName),associationPromise=operationPayload.controlContext.navigation.openConfirmDialog({title:dialogTitle,text:dialogText},null);associationPromise.then(function(value){value&&value.confirmed&&_this.sendEmailContent(operationPayload,emailArticleContent);deferred.resolve()})}else{if(!operationPayload.record.isAssociated){operationPayload.actionOperationCallback=this.markArticleSentToCustomer.bind(operationPayload);KbCommonUtils.ActionOperationFactory.Instance.Execute(KbCommonUtils.ArticleAction.LinkArticle,operationPayload)}this.sendEmailContent(operationPayload,emailArticleContent);deferred.resolve()}return deferred.promise()};ActionOperationUtils.GetFormattedContent=function(context,knowledgeArticleId){var ODataEndPointUri=MscrmCommon.ControlUtils.String.Format(KbCommonUtils.Constants.URL_KA_TITLE_CONTENT,knowledgeArticleId),deferred=$.Deferred();window.$.getJSON(context.page.getClientUrl()+KbCommonUtils.Constants.ODATA_PATH+ODataEndPointUri).done(function(response){if(response.value.length>0){var searchResult=response.value[0];ActionOperationUtils.GetContentWithDynamicsImageInline(searchResult,context,deferred)}else{Xrm.Navigation.openAlertDialog(KbCommonUtils.KbCommonControlLocale.RecordDoesNotExistErrorMessage);deferred.reject()}}).fail(function(errorResponse){deferred.reject(errorResponse)});return deferred.promise()};ActionOperationUtils.GetContentWithDynamicsImageInline=function(searchResult,context,deferred){var dynamicsImageUrlsTobeParsed=searchResult.content.match(KbCommonUtils.Constants.KBArticleImageTagRegex);if(dynamicsImageUrlsTobeParsed!=null)ActionOperationUtils.ReplaceBase64InlineAllImages(dynamicsImageUrlsTobeParsed,context,searchResult).then(function(formattedContent){return deferred.resolve(formattedContent)},function(errorResponse){return deferred.reject(errorResponse)});else deferred.resolve(searchResult["content"])};ActionOperationUtils.IsValidToSendEmail=function(operationPayload){var stateManager=operationPayload.stateManager,canSendMail=this.GetStateOfArticle(operationPayload)===3&&stateManager.kmPrivileges&&stateManager.kmPrivileges.CanEmail;return operationPayload.record.isAssociated?canSendMail:canSendMail&&stateManager.kmPrivileges&&stateManager.kmPrivileges.CanAssociateAndDisassociate};ActionOperationUtils.IsInValidFormContext=function(operationPayload){return !MscrmCommon.ControlUtils.Object.isNullOrUndefined(operationPayload.controlContext.page.entityTypeName)?true:false};ActionOperationUtils.IsInExistingFormContent=function(operationPayload){return this.IsInValidFormContext(operationPayload)&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(operationPayload.controlContext.page.entityId)?true:false};ActionOperationUtils.IsInSearchPageContext=function(){return window&&window.location&&window.location.href&&window.location.href.toLowerCase().indexOf("kbsearch")>-1};ActionOperationUtils.IsInArticlePageContext=function(){return window&&window.location&&window.location.href&&window.location.href.toLowerCase().indexOf("kbarticle")>-1};ActionOperationUtils.GetBrowserType=function(userAgent){var userAgentString=window.navigator.userAgent.toLowerCase();if(userAgentString.indexOf("edge")>-1&&userAgentString.indexOf("windows nt")>-1)return KbCommonUtils.Browsers.Edge;if(userAgent.isBrowserChrome)return KbCommonUtils.Browsers.Chrome;if(userAgent.isBrowserFirefox)return KbCommonUtils.Browsers.Firefox;if(userAgent.isBrowserIE)return KbCommonUtils.Browsers.IE;if(userAgent.isBrowserSafari)return KbCommonUtils.Browsers.Safari};ActionOperationUtils.ReplaceBase64InlineAllImages=function(base64InlineAllImages,context,searchResult){for(var base64InlineImagesDeffered=$.Deferred(),promises=[],_i=0,base64InlineAllImages_1=base64InlineAllImages;_i<base64InlineAllImages_1.length;_i++){var base64image=base64InlineAllImages_1[_i],promise=ActionOperationUtils.GetBase64InlineImage(base64image,context);promises.push(promise)}if(promises.length==0)return base64InlineImagesDeffered.resolve(searchResult.content);Promise.all(promises).then(function(successResponse){successResponse.forEach(function(returnValue){var inlineImageSrcTag=returnValue.inlineImageUrlSent.match(KbCommonUtils.Constants.KBArticleImageTagSrcRegex),inlineImagMsdynTag=returnValue.inlineImageUrlSent.match(KbCommonUtils.Constants.KBArticleImageTagmsdyntypeRegex);if(inlineImageSrcTag!=null&&inlineImageSrcTag.length>1&&inlineImagMsdynTag!=null&&inlineImagMsdynTag.length>1)searchResult.content=searchResult.content.replace(inlineImageSrcTag[1],inlineImagMsdynTag[1]+","+returnValue.response)});return base64InlineImagesDeffered.resolve(searchResult.content)},function(errorResponse){var dialogTitle=KbCommonUtils.KbCommonControlLocale.ConfirmDialogTitleForImageLoad,dialogText=KbCommonUtils.KbCommonControlLocale.ConfirmDialogForImageLoadFailureText,associationPromise=context.navigation.openConfirmDialog({title:dialogTitle,text:dialogText},null);associationPromise.then(function(value){if(value&&value.confirmed)return base64InlineImagesDeffered.resolve(searchResult.content);else return base64InlineImagesDeffered.reject(errorResponse)})});return base64InlineImagesDeffered.promise()};ActionOperationUtils.GetBase64InlineImage=function(inlineImageUrl,context){var base64InlineImageDeferred=$.Deferred();try{var inlineImageSrcTag=inlineImageUrl.match(KbCommonUtils.Constants.KBArticleImageTagSrcRegex);inlineImageSrcTag!=null&&inlineImageSrcTag.length>1&&window.$.getJSON(window.location.origin+inlineImageSrcTag[1].replace("$value","")).done(function(response){if(response.value.length>0){var returnValue={response:response.value,inlineImageUrlSent:inlineImageUrl};base64InlineImageDeferred.resolve(returnValue)}else base64InlineImageDeferred.reject(KbCommonUtils.KbCommonControlLocale.RecordDoesNotExistErrorMessage)}).fail(function(errorResponse){context.reporting.reportFailure("KbSearchControl.sendEmailContent",new Error(errorResponse.message));base64InlineImageDeferred.reject(errorResponse)})}catch(errorResponse){context.reporting.reportFailure("KbSearchControl.sendEmailContent",new Error(errorResponse.message));base64InlineImageDeferred.reject(errorResponse)}return base64InlineImageDeferred.promise()};return ActionOperationUtils}();KbCommonUtils.ActionOperationUtils=ActionOperationUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict"})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KbCommonControlLocale=function(){function KbCommonControlLocale(){}KbCommonControlLocale.initialize=function(getString){KbCommonControlLocale.AllDraftArticlesLocale=getString(KbCommonUtils.Constants.AllDraftArticlesResourceName);KbCommonControlLocale.AllPublishedArticlesLocale=getString(KbCommonUtils.Constants.AllPublishedArticlesResourceName);KbCommonControlLocale.AllApprovedArticlesLocale=getString(KbCommonUtils.Constants.AllApprovedArticlesResourceName);KbCommonControlLocale.ConfirmDialogTitle=getString(KbCommonUtils.Constants.ConfirmDialogTitle);KbCommonControlLocale.ConfirmDialogText=getString(KbCommonUtils.Constants.ConfirmDialogTextResourceName);KbCommonControlLocale.RecordDoesNotExistErrorMessage=getString(KbCommonUtils.Constants.RecordDoesNotExistErrorMessageResourceName);KbCommonControlLocale.ConfirmDialogTitleForImageLoad=getString(KbCommonUtils.Constants.ConfirmDialogTitleForImageLoad);KbCommonControlLocale.ConfirmDialogForImageLoadFailureText=getString(KbCommonUtils.Constants.ConfirmDialogTextForImageLoadFailure)};return KbCommonControlLocale}();KbCommonUtils.KbCommonControlLocale=KbCommonControlLocale})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var KMPrivileges=function(){function KMPrivileges(){}return KMPrivileges}();KbCommonUtils.KMPrivileges=KMPrivileges})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var PerformanceTelemetry=function(){function PerformanceTelemetry(){this.perfEndMarkerCallbacks={}}Object.defineProperty(PerformanceTelemetry,"Instance",{"get":function(){if(!PerformanceTelemetry.instance)PerformanceTelemetry.instance=new PerformanceTelemetry;return PerformanceTelemetry.instance},enumerable:true,configurable:true});PerformanceTelemetry.prototype.GetStopwatchKeys=function(){return Object.keys(this.perfEndMarkerCallbacks)};PerformanceTelemetry.prototype.AddStartMarker=function(eventId,context){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];var key=eventId+params.join("");this.perfEndMarkerCallbacks[key]=this.perfEndMarkerCallbacks[key]||context.performance.createPerformanceStopwatch(eventId)};PerformanceTelemetry.prototype.AddEndMarker=function(eventId,context){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];var key=eventId+params.join("");if(this.perfEndMarkerCallbacks[key]){this.perfEndMarkerCallbacks[key]();delete this.perfEndMarkerCallbacks[key]}};PerformanceTelemetry.prototype.AddActionLogForUsageCalculations=function(actionName,context){for(var params=[],_i=2;_i<arguments.length;_i++)params[_i-2]=arguments[_i];var event={eventName:"KbSearchControlUsage",eventParameters:[]};event.eventParameters.push({name:"ActionName",value:actionName});event.eventParameters.push({name:"UserId",value:context.userSettings.userId});if(actionName===KbCommonUtils.TelemetryConstants.WATERMARK_ACTION_KBSEARCH_PERFORMED&&params.length>0)event.eventParameters.push({name:"IsManualSearch",value:params[0]});else if(actionName===KbCommonUtils.TelemetryConstants.WATERMARK_ACTION_OPEN_ARTICLE_TO_READ&&params.length>0)event.eventParameters.push({name:"KbArticleIndex",value:params[0]});else if(actionName===KbCommonUtils.TelemetryConstants.WATERMARK_ACTION_SORT_ORDER_CHANGED&&params.length>0)event.eventParameters.push({name:"SelectedSortOrder",value:params[0]});else if(actionName===KbCommonUtils.TelemetryConstants.WATERMARK_ACTION_STATUS_FILTER_CHANGED&&params.length>0)event.eventParameters.push({name:"SelectedStatusFilter",value:params[0]});else actionName===KbCommonUtils.TelemetryConstants.WATERMARK_ACTION_LANGUAGE_FILTER_CHANGED&&params.length>0&&event.eventParameters.push({name:"SelectedLanguageFilter",value:params[0]});context&&context.reporting.reportEvent(event)};PerformanceTelemetry.prototype.AddErrorLog=function(context,errorMessage,errorDetails){var event={eventName:"KbSearchControlError",eventParameters:[]};event.eventParameters.push({name:"ErrorMessage",value:errorMessage});event.eventParameters.push({name:"ErrorDetails",value:errorDetails});context&&context.reporting.reportEvent(event)};return PerformanceTelemetry}();KbCommonUtils.PerformanceTelemetry=PerformanceTelemetry})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var TelemetryConstants=function(){function TelemetryConstants(){}TelemetryConstants.KBSEARCH_CONTROL_PERFORMANCE="KbSearchControlPerformance";TelemetryConstants.WATERMARK_ACTION_LOAD_KBSEARCH_CONTROL="Load_KBSearch_Control";TelemetryConstants.WATERMARK_ACTION_LOAD_SEARCH_RESULTS="Load_Search_Results";TelemetryConstants.WATERMARK_ACTION_OPEN_ARTICLE_TO_READ="Open_Article_To_Read";TelemetryConstants.WATERMARK_ACTION_LINK_KBARTICLE="Link_Knowledge_Article_To_Entity";TelemetryConstants.WATERMARK_ACTION_UNLINK_KBARTICLE="Unlink_Knowledge_Article_To_Entity";TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_CONTENT="Email_Article_Content";TelemetryConstants.WATERMARK_ACTION_EMAIL_ARTICLE_URL="Email_Article_URL";TelemetryConstants.WATERMARK_ACTION_SEE_MORE_OPTION_CLICKED="SeeMore_Option_Clicked";TelemetryConstants.WATERMARK_ACTION_KBSEARCH_PERFORMED="KbSearch_Performed";TelemetryConstants.WATERMARK_ACTION_KBSEARCH_CONTROL_INITIALIZED="KBSearchControl_Initialized";TelemetryConstants.WATERMARK_ACTION_SORT_ORDER_CHANGED="Article_Sort_Order_Changed";TelemetryConstants.WATERMARK_ACTION_STATUS_FILTER_CHANGED="Article_Status_Filter_Changed";TelemetryConstants.WATERMARK_ACTION_LANGUAGE_FILTER_CHANGED="Article_Language_Filter_Changed";TelemetryConstants.WATERMARK_ACTION_POPOUT_KBARTICLE="Popout_Knowledge_Article_To_New_Window";return TelemetryConstants}();KbCommonUtils.TelemetryConstants=TelemetryConstants})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var FCBUtil=function(){function FCBUtil(){}FCBUtil.SetCustomerEnabledWaves=function(context){KbCommonUtils.FCBUtil._isCustomerEnabledForOct2020Wave=KbCommonUtils.FCBUtil.IsCustomerEnabledForOctWave(context)};FCBUtil.IsCustomerEnabledForOct2020Wave=function(){return KbCommonUtils.FCBUtil._isCustomerEnabledForOct2020Wave};FCBUtil.isCustomerEnabledForCurrentWave=function(context){return context.utils.isFeatureEnabled(this.CurrentWave)};FCBUtil.IsCustomerEnabledForOctWave=function(context){return context.utils.isFeatureEnabled(this.October2020Wave)};FCBUtil.IsFeatureEnabled=function(context,feature,checkCurrentWave){if(checkCurrentWave===void 0)checkCurrentWave=true;if(checkCurrentWave)return context.utils.isFeatureEnabled(feature)&&this.isCustomerEnabledForCurrentWave(context);return context.utils.isFeatureEnabled(feature)};FCBUtil.CurrentWave="April2020Update";FCBUtil.October2020Wave="October2020Update";FCBUtil.SearchUIEnhancements="KMSearchUIEnhancements";FCBUtil.KMExpandCollapse="KMExpandCollapseEnabled";FCBUtil.KMCopyPasteImage="KMCopyPasteImageEnabled";FCBUtil.KMCopyPasteImageWithDefaultDialog="KMCopyPasteImageEnabledWithDefaultDialog";return FCBUtil}();KbCommonUtils.FCBUtil=FCBUtil})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){var TelemetryReporter=function(){function TelemetryReporter(){this.eventStartMarkers={}}Object.defineProperty(TelemetryReporter,"Instance",{"get":function(){if(!TelemetryReporter.instance)TelemetryReporter.instance=new TelemetryReporter;return TelemetryReporter.instance},enumerable:true,configurable:true});TelemetryReporter.prototype.PostStartMarker=function(context,webResourceName,functionName,currentId,parentId){if(!context)return;var telemetryevent=this.CreateTelemetryEvent(context,webResourceName,functionName,currentId,parentId),eventKey=webResourceName+"_"+functionName;this.eventStartMarkers[eventKey]=new Date;context.reporting.reportEvent(telemetryevent)};TelemetryReporter.prototype.PostEndMarker=function(context,webResourceName,functionName,currentId,parentId,isAsync){if(isAsync===void 0)isAsync=false;if(!context)return;var endTime=new Date,telemetryevent=this.CreateTelemetryEvent(context,webResourceName,functionName,currentId,parentId),eventKey=webResourceName+"_"+functionName;if(this.eventStartMarkers[eventKey]){var startTime=this.eventStartMarkers[eventKey],executionTime=endTime.getTime()-startTime.getTime();telemetryevent.eventParameters.push({name:"executionTime",value:executionTime});telemetryevent.eventParameters.push({name:"async",value:isAsync})}context.reporting.reportEvent(telemetryevent)};TelemetryReporter.prototype.CreateTelemetryEvent=function(context,webResourceName,functionName,currentId,parentId){var telemetryevent={eventName:"ServiceWebResources",eventParameters:[]};telemetryevent.eventParameters.push({name:"webResourceName",value:webResourceName});telemetryevent.eventParameters.push({name:"functionName",value:functionName});telemetryevent.eventParameters.push({name:"currentId",value:currentId});parentId&&parentId!=""&&telemetryevent.eventParameters.push({name:"parentId",value:parentId});telemetryevent.eventParameters.push({name:"userId",value:context.userSettings.userId});return telemetryevent};return TelemetryReporter}();KbCommonUtils.TelemetryReporter=TelemetryReporter})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var KbCommonUtils;(function(KbCommonUtils){"use strict";var CommonUtils=function(){function CommonUtils(){}CommonUtils.isUci=function(){var winObj=window;if(winObj.Xrm&&winObj.Xrm.Internal&&winObj.Xrm.Internal.isUci)return winObj.Xrm.Internal.isUci();return false};return CommonUtils}();KbCommonUtils.CommonUtils=CommonUtils})(KbCommonUtils=MscrmControls.KbCommonUtils||(MscrmControls.KbCommonUtils={}))})(MscrmControls||(MscrmControls={}))